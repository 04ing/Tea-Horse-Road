/*!
 * 
 *          iclient-plot-leaflet.(https://iclient.supermap.io)
 *          Copyright© 2000 - 2024 SuperMap Software Co.Ltd
 *          license: Apache-2.0
 *          version: v11.3.0
 *
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["L.supermap.plotting"]=e():t["L.supermap.plotting"]=e()}(self,function(){return function(){var t={580:function(){L.Path.include({onBefore:function(t){this._renderer._beforePath(this,t),this._reset(),this._renderer._addPath(this)}})},713:function(){L.SVG.include({_drawPlottingLayers:function(t){t.map(function(e){return e instanceof L.Polyline&&e._update(),e instanceof L.Polygon&&e._update(),t})},getEvents:function(){var t=this;this._map.on("layeradd",function(e){e.layer===t&&(L.DomEvent.on(t._container,"mousemove",L.Util.throttle(t._onMouseMove,32,t),t),L.DomEvent.on(t._container,"mouseout",t._handleMouseOut,t))});var e=L.Renderer.prototype.getEvents.call(this);return e.zoomstart=this._onZoomStart,e},_onClick:function(t){var e,i=this._map.mouseEventToLayerPoint(t),o=[],n=[];for(var l in this._layers){var s=this._layers[l];if(s.options.interactive&&"function"==typeof s._containsPoint&&s._containsPoint(i)&&!this._map._draggableMoved(s)&&(e=s,Object.prototype.hasOwnProperty.call(e,"_eventParents")&&null!=e._eventParents))for(var a in e._eventParents)n.push(e),o.push(e._eventParents[a])}if(e&&n.length>1){if(o.length>0){for(var r=!1,u=[],p=[],h=0,c=o.length;h<c;h++)o[h].isSelected&&o[h].moveend&&(r=!0),o[h].enableEdit&&(u.push(o[h]),p.push(n[h]));for(var y=0,g=u.length;y<g;y++){if(u[y].isSelected&&u[y].moveend){u[y].moveend=!1,this._fireEvent([p[y]],t),u[y].moveend=!0;break}if(u[y].isSelected&&u.length>1){this._fireEvent([p[y]],t);break}if(!r){this._fireEvent([p[p.length-1]],t);break}}}}else e&&e._eventParents[0]&&e._eventParents[0].fire(t.type,t)},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(L.DomUtil.removeClass(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(t,e){var i,o;for(var n in this._layers)(i=this._layers[n]).options.interactive&&"function"==typeof i._containsPoint&&i._containsPoint(e)&&(o=i);o!==this._hoveredLayer&&(this._handleMouseOut(t),o&&(L.DomUtil.addClass(this._container,"leaflet-interactive"),this._fireEvent([o],t,"mouseover"),this._hoveredLayer=o)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t)},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_updateTextPt:function(t,e,i,o){var n;if(t.setAttributeNS(null,"x",e.x),t.setAttributeNS(null,"y",e.y),i.options.display&&t.setAttributeNS(null,"display",i.options.display),!0===i.options.fontStroke&&(i.options.fontStrokeColor&&t.setAttributeNS(null,"stroke",i.options.fontStrokeColor),i.options.fontStrokeWidth&&t.setAttributeNS(null,"stroke-width",i.options.fontStrokeWidth)),i.options.labelRotation&&t.setAttributeNS(null,"transform","rotate("+i.options.labelRotation+" "+e.x+","+e.y+")"),i.options.fontColor&&t.setAttributeNS(null,"fill",i.options.fontColor),i.options.fontOpacity&&t.setAttributeNS(null,"opacity",i.options.fontOpacity),i.options.fontFamily&&t.setAttributeNS(null,"font-family",i.options.fontFamily),i.options.fontSize&&t.setAttributeNS(null,"font-size",i.options.fontSize),i.options.fontWeight&&t.setAttributeNS(null,"font-weight",i.options.fontWeight),i.options.fontStyle&&t.setAttributeNS(null,"font-layer.options",i.options.fontStyle),L.Browser.gecko){if(100!==i.options.fontPercent&&0!==i.options.fontSpace&&(n=i.options.fontSpace+i.options.fontPercent/100*parseFloat(i.options.fontSize)*i.options.text.length),100!==i.options.fontPercent&&0===i.options.fontSpace){var l=document.createElement("span");document.body.appendChild(l),l.style.width="auto",l.style.height="auto",i.options.fontSize&&(l.style.fontSize=new String(i.options.fontSize)+"px"),i.options.fontFamily&&(l.style.fontFamily=i.options.fontFamily),i.options.fontWeight&&(l.style.fontWeight=i.options.fontWeight),l.style.position="absolute",l.style.visibility="hidden",l.innerHTML=i.options.text;var s=l.clientWidth;n=i.options.fontPercent/100*s+i.options.text.length}t.setAttributeNS(null,"textLength",n),t.setAttributeNS(null,"lengthAdjust","spacingAndGlyphs")}t.setAttributeNS(null,"pointer-events","visible");var a=i.options.labelAlign||"cm";t.setAttributeNS(null,"text-anchor",L.SVG.LABEL_ALIGN[a[0]]||"middle"),!0===L.Browser.gecko&&t.setAttributeNS(null,"dominant-baseline",L.SVG.LABEL_ALIGN[a[1]]||"central");var r=function(){var t=L.SVG.LABEL_VFACTOR[a[1]];null==t&&(t=-.5);var e=t*(u-1);return L.Browser.ie&&(null===(t=L.SVG.LABEL_IE_VOFFSET[a[1]])&&(t=.35),e+=t),e},u=0,p=[];for(i.options.text instanceof Array?(p=i.options.text,u=p.length):i.options.text.indexOf(";")>-1?(p=i.options.text.split(";"),u=p.length):i.options.text.indexOf("；")>-1?(p=i.options.text.split("；"),u=p.length):(p=i.options.text.split("\n"),u=p.length);t.childNodes.length>u;)t.removeChild(t.lastChild);for(var h=0;h<u;h++){var c=e.x;if(0!==i.options.fontSpace||100!==i.options.fontPercent&&L.Browser.ie){var y=SuperMap.Plot.PlottingUtil.getTextWidth(i.options,p[h]);"c"===a[0]?c-=y/2:"r"===a[0]&&(c-=y);for(var g=0,f=p[h].split(""),d="",m=0;m<f.length;m++){var S=o+"tspan"+h+m;i._tspanNodeObj&&i._tspanNodeObj[S]||(i._tspanNodeObj[S]=L.SVG.create("tspan"));var P=i._tspanNodeObj[S];!1===L.Browser.gecko&&P.setAttributeNS(null,"baseline-shift",L.SVG.LABEL_VSHIFT[a[1]]||"-35%");var b=SuperMap.Plot.PlottingUtil.getTextWidth(i.options,f[m]);P.setAttributeNS(null,"textLength",b),P.setAttributeNS(null,"lengthAdjust","spacingAndGlyphs"),P.setAttribute("x",c+g+(0===h?0:b>>>1)),0!==m?P.setAttribute("dy","0em"):0===h?P.setAttribute("dy",r()+"em"):P.setAttribute("dy","1em");var v=""===f[m]?" ":f[m];i.options.isUnicode?L.Browser.ie||L.Browser.ielt9?(this.element.innerHTML=v,P.textContent=this.element.innerHTML):P.innerHTML=v:P.textContent=v,P.parentNode||t.appendChild(P),d+=f[m],g=SuperMap.Plot.PlottingUtil.getTextWidth(i.options,d)+parseFloat(i.options.fontSpace)*(i.options.fontPercent/100)}}else{var M=o+"tspan"+h;i._tspanNodeObj&&i._tspanNodeObj[M]||(i._tspanNodeObj[M]=L.SVG.create("tspan"));var _=i._tspanNodeObj[M];if(!1===L.Browser.gecko&&_.setAttributeNS(null,"baseline-shift",L.SVG.LABEL_VSHIFT[a[1]]||"-35%"),100!==i.options.fontPercent){var A=SuperMap.Plot.PlottingUtil.getTextWidth(i.options,p[h]);_.setAttributeNS(null,"textLength",A),_.setAttributeNS(null,"lengthAdjust","spacingAndGlyphs")}_.setAttribute("x",e.x),0==h?_.setAttribute("dy",r()+"em"):_.setAttribute("dy","1em");var T=""===p[h]?" ":p[h];i.options.isUnicode?L.Browser.ie||L.Browser.ielt9?(this.element.innerHTML=T,_.textContent=this.element.innerHTML):_.innerHTML=T:_.textContent=T,_.parentNode||t.appendChild(_)}}t.parentNode||this._rootGroup.appendChild(t)},_updateText:function(t){if(t.options.text&&0!==t.options.text.length)if(t.options.fontSize<6||t.options.fontPercent<=0)t._removeNode();else{for(var e in t._eventParents)if(t._eventParents[e].symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&!1===t._eventParents[e].textDisplay)return void t._removeNode();void 0===t.options.fontPercent&&(t.options.fontPercent=100),t.options.fontPercent<0&&(t.options.fontPercent=0),t.options.fontPercent>400&&(t.options.fontPercent=400),void 0===t.options.fontSpace&&(t.options.fontSpace=0),t.options.fontSpace>30?t.options.fontSpace=30:t.options.fontSpace<0&&(t.options.fontSpace=0);var i=t._latlng,o=this._map.latLngToLayerPoint(i);if(void 0!=o){if(t.options.labelXOffset||t.options.labelYOffset){var n=isNaN(t.options.labelXOffset)?0:t.options.labelXOffset,l=isNaN(t.options.labelYOffset)?0:t.options.labelYOffset;o.x+=n,o.y-=l}if(!0===t.options.fontShadow){t._shadowTextNode&&t._shadowTextNode.parentNode||(t._shadowTextNode=L.SVG.create("text"),this._rootGroup.appendChild(t._shadowTextNode));var s=L.point(o.x,o.y);if(t.options.fontShadowOffsetX&&(s.x+=t.options.fontShadowOffsetX),t.options.fontShadowOffsetY&&(s.y+=t.options.fontShadowOffsetY),0!==t.options.labelRotation){var a=o.x,r=o.y,u=t.options.labelRotation*Math.PI/180,p=Math.sqrt(Math.pow(s.x-a,2)+Math.pow(s.y-r,2)),h=u+Math.atan2(s.y-r,s.x-a);s.x=a+p*Math.cos(h),s.y=r+p*Math.sin(h)}var c=t.options.fontStroke;t.options.fontStroke=!1;var y=t.options.fontColor;t.options.fontColor=t.options.fontShadowColor,this._updateTextPt(t._shadowTextNode,s,t,"shadow"),t.options.fontColor=y,t.options.fontStroke=c}else t._shadowTextNode&&t._shadowTextNode.parentNode&&(this._rootGroup.removeChild(t._shadowTextNode),delete t._shadowTextNode);if(t._textNode&&t._textNode.parentNode||(t._textNode=L.SVG.create("text"),this._rootGroup.appendChild(t._textNode),t.options.interactive&&L.DomUtil.addClass(t._textNode,"leaflet-interactive"),t.addInteractiveTarget(t._textNode)),this._updateTextPt(t._textNode,o,t,"label"),!0===t.options.fontBackground){var g=t._shadowTextNode;if(g&&g.parentNode||(g=t._textNode),!g||!g.parentNode)return;t._backgroundTextNode&&t._backgroundTextNode.parentNode||(t._backgroundTextNode=L.SVG.create("rect"),!0===t.options.fontShadow?this._rootGroup.insertBefore(t._backgroundTextNode,t._shadowTextNode):this._rootGroup.insertBefore(t._backgroundTextNode,t._textNode));var f=t._textNode.getBBox();t._backgroundTextNode.x.baseVal.value=f.x,t._backgroundTextNode.y.baseVal.value=f.y,t._backgroundTextNode.width.baseVal.value=f.width,t._backgroundTextNode.height.baseVal.value=f.height,t._backgroundTextNode.style.fill=t.options.fontBackgroundColor,t.options.labelRotation&&t._backgroundTextNode.setAttributeNS(null,"transform","rotate("+t.options.labelRotation+" "+o.x+","+o.y+")")}else t._backgroundTextNode&&t._backgroundTextNode.parentNode&&(this._rootGroup.removeChild(t._backgroundTextNode),delete t._backgroundTextNode)}else t._removeNode()}else t._removeNode()},_updateImage:function(t){if(t._imageNode&&t._imageNode.parentNode||(t._imageNode=L.SVG.create("image"),this._rootGroup.appendChild(t._imageNode)),t._imageNode.setAttributeNS(null,"cx",t._point.x),t._imageNode.setAttributeNS(null,"cy",t._point.y),t._imageNode.setAttributeNS(null,"r",1),t._imageNode.style.visibility="",t.options.graphicTitle){t._imageNode.setAttributeNS(null,"title",t.options.graphicTitle);var e=L.SVG.create("title");e.textContent=style.graphicTitle,t._imageNode.appendChild(e)}t.options.graphicWidth&&t.options.graphicHeight&&t._imageNode.setAttributeNS(null,"preserveAspectRatio","none");var i=t.options.graphicWidth||t.options.graphicHeight,o=t.options.graphicHeight||t.options.graphicWidth;i=i>=0?i:2*t.options.pointRadius,o=o>=0?o:2*t.options.pointRadius;var n=void 0!=t.options.graphicXOffset&&t.options.graphicXOffset,l=void 0!=t.options.graphicYOffset&&t.options.graphicYOffset;n=-i/2,l=-o/2;var s=t.options.graphicOpacity||t.options.fillOpacity;t._imageNode.setAttributeNS(null,"x",(t._point.x+n).toFixed()),t._imageNode.setAttributeNS(null,"y",(t._point.y+l).toFixed()),t._imageNode.setAttributeNS(null,"width",i),t._imageNode.setAttributeNS(null,"height",o),t._imageNode.setAttributeNS("http://www.w3.org/1999/xlink","href",t.options.externalGraphic),t._imageNode.setAttributeNS(null,"style","opacity: "+s),t._imageNode.onclick=L.SVG.preventDefault;var a=t.options.rotation;void 0===a&&void 0===t._imageNode._rotation||!t._point||(t._imageNode._rotation=a,a|=0,t._imageNode.setAttributeNS(null,"transform","rotate("+a+" "+t._point.x+" "+t._point.y+")")),t._imageNode.setAttributeNS(null,"fill","none"),t._imageNode.setAttributeNS(null,"stroke","none"),t.options.pointerEvents?(t._imageNode.setAttributeNS(null,"pointer-events",t.options.pointerEvents),t._imageNode.style.pointerEvents=t.options.pointerEvents):(t._imageNode.setAttributeNS(null,"pointer-events","visiblepainted"),t._imageNode.style.pointerEvents="visiblepainted"),null!=t.options.cursor&&t._imageNode.setAttributeNS(null,"cursor",style.cursor)},_updateArc:function(t){if(this._drawing&&!t._empty()){var e=t._point,i=t._radius,o="a"+i+","+(t._radiusY||i)+" 0 1,0 ";sRadian=(360-t.options.endAngle)*(Math.PI/180),eRadian=(360-t.options.startAngle)*(Math.PI/180);var n=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+o+2*i+",0 "+o+2*-i+",0 ";this._setPath(t,n)}}}),L.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},L.SVG.LABEL_VSHIFT={t:"-83%",b:"0"},L.SVG.LABEL_VFACTOR={t:0,b:-1},L.SVG.LABEL_IE_VOFFSET={t:.86,b:0},L.SVG.preventDefault=function(t){t.preventDefault&&t.preventDefault()}},618:function(){L.supermap.TiledMapLayer.include({setBaseLayer:function(){this.isBaseLayer=!0},setVisibility:function(t){return t?this.setOpacity(100):this.setOpacity(0),0},getVisibility:function(){return 0!=this.options.opacity}})}},e={};function i(o){var n=e[o];if(void 0!==n)return n.exports;var l=e[o]={exports:{}};return t[o](l,l.exports,i),l.exports}i.d=function(t,e){for(var o in e)i.o(e,o)&&!i.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return function(){"use strict";i.r(o),i.d(o,{AddPoint_WayType:function(){return to},AirDeployment:function(){return zy},AirRoute:function(){return Gy},AlgoSurroundLineType:function(){return s},AlgoSymbol:function(){return Eh},AlgoSymbolFactory:function(){return gh},AlignType:function(){return g},AnalysisSymbol:function(){return Ji},AnnoPosition:function(){return p},ArcRegion:function(){return ky},ArrowLineType:function(){return h},AvoidRegion:function(){return Sy},AvoidRegionControl:function(){return Cy},BasicAlgoSymbolFactory:function(){return yh},CalculateCanvasGradient:function(){return ki},CalculateSVGGradient:function(){return zi},CreateSignImage:function(){return Tg},DefaultStyle:function(){return zt},DomToImage:function(){return cg},DotSymbol:function(){return Ry},DrawGraphicObject:function(){return sf},EditMode:function(){return f},EditSmlFileParameters:function(){return D},Event:function(){return m},ExtendProperty:function(){return Xt},FlagGroup:function(){return Oy},FreeCurve:function(){return qy},GOAnimation:function(){return zh},GOAnimationAttribute:function(){return Yh},GOAnimationBlink:function(){return Gh},GOAnimationGrow:function(){return Wh},GOAnimationManager:function(){return gc},GOAnimationRotate:function(){return Xh},GOAnimationScale:function(){return Hh},GOAnimationShow:function(){return Zh},GOAnimationType:function(){return S},GOAnimationWay:function(){return Jh},GeoSymbolText:function(){return ng},GeoSymbolText1:function(){return sg},GetLibInfoParameter:function(){return tt},GetSMLInfosParameters:function(){return ct},GetSymbolInfoParameters:function(){return _t},GraphicObject:function(){return xh},GroupObject:function(){return vh},InterferenceBeam:function(){return Qy},LayerDataStruct:function(){return qt},LineRelation:function(){return Dh},LineRelationType:function(){return l},MapInfoStruct:function(){return te},MissileRoute:function(){return Xy},NavyDeployment:function(){return jy},NavyRoute:function(){return Zy},OrbitPoint:function(){return ne},PathText:function(){return vy},Plot:function(){return e},PlotControl:function(){return tf},PlotDrawControl:function(){return af},PlotEditControl:function(){return uf},Plotting:function(){return ty},PlottingGraphicLayer:function(){return dy},PlottingLayer:function(){return Iy},PlottingObject:function(){return bh},PlottingUtil:function(){return Ki},PositionOffsetType:function(){return y},Primitives:function(){return Qi},Property:function(){return re},Query:function(){return ey},RadiusLineType:function(){return u},RelLineText:function(){return r},RouteNode:function(){return ce},RouteNodePrimitives:function(){return $i},RouteNodeType:function(){return a},SMLFileService:function(){return hf},SMLInfoStruct:function(){return be},Satellite:function(){return tg},SatelliteTimeWindows:function(){return ig},SignObjects:function(){return Yg},SignSymbol:function(){return Ch},SignSymbolLayer:function(){return Ty},SitDataManager:function(){return dc},SitDataStruct:function(){return de},SpecialEffectManager:function(){return Qc},SubSymbol:function(){return _e},SymbolInfoService:function(){return yf},SymbolLib:function(){return Sc},SymbolLibManager:function(){return bc},SymbolText:function(){return Oe},SymbolType:function(){return n},TextBoxType:function(){return c},TimeWindowParameter:function(){return Ze},TowardNode:function(){return Qe},WayAnimationControl:function(){return ef},airDeployment:function(){return Yy},airRoute:function(){return Wy},algoSymbol:function(){return Ih},arcRegion:function(){return Fy},avoidRegion:function(){return Py},cloneLatLngs:function(){return Zg},createSymbol:function(){return rg},dotSymbol:function(){return Ny},drawControl:function(){return rf},editControl:function(){return pf},flagGroup:function(){return wy},freeCurve:function(){return Ky},geoSymbolText:function(){return lg},geoSymbolText1:function(){return ag},getControl:function(){return ny},goAnimationManager:function(){return fc},groupObject:function(){return Lh},interferenceBeam:function(){return $y},latLngsToSuperMapPoints:function(){return Xg},lineRelation:function(){return Uh},md5:function(){return fh},missileRoute:function(){return Hy},moveLatLngs:function(){return Jg},navyDeployment:function(){return Vy},navyRoute:function(){return Jy},pathText:function(){return Ly},plottingGraphicLayer:function(){return my},plottingLayer:function(){return Dy},query:function(){return iy},resizeLatLngs:function(){return Kg},rotateLatLngs:function(){return qg},satellite:function(){return eg},satelliteTimeWindows:function(){return og},signSymbolLayer:function(){return xy},sitDataManager:function(){return mc},smlFileService:function(){return cf},specialEffectManager:function(){return $c},superMapPointsToLatLngs:function(){return Hg},symbolInfoService:function(){return gf},symbolLib:function(){return Pc},symbolLibManager:function(){return vc}});var t=window.SuperMap=window.SuperMap||{},e=t.Plot=t.Plot||{},n=(window.SuperMapAlgoPlot=t.Plot||{},SuperMap.Plot.ArrowTailType={ARROWTAIL_NONE:0,ARROWTAIL_LINE:1,ARROWTAIL_CURVE:2,ARROWTAIL_COATTAIL:3,ARROWTAIL_COATTAIL_POLYBODY:4},SuperMap.Plot.ArrowHeadType={ARROWHEAD_POLYLINE:0,ARROWHEAD_TRIANGLE:1,ARROWHEAD_COATTAIL:2,ARROWHEAD_TRIANGLE_SOLID:3,ARROWHEAD_WITH_EAR:4,ARROWHEAD_WITHOUT_EAR:5,ARROWHEAD_COATTAIL_HOLLOW:6},SuperMap.Plot.ArrowBodyType={ARROWBODY_POLYLINE:0,ARROWBODY_POLYBEZIER:1,ARROWBODY_PARALLEL:2,ARROWBODY_TRAPEZOID:3,ARROWBODY_MULTIPOLYBEZIER:4,ARROWBODY_COATTAIL:5},SuperMap.Plot.SymbolType={DOTSYMBOL:1,ALGOSYMBOL:2,TEXTSYMBOL:34,ELLIPSESYMBOL:31,CIRCLESYMBOL:29,RECTANGLESYMBOL:26,ARBITRARYPOLYGONSYMBOL:32,POLYLINESYMBOL:24,PARALLELOGRAM:28,ARCSYMBOL:44,NEWARCSYMBOL:4401,REGULARPOLYGON:410,CHORDSYMBOL:370,NEWCHORDSYMBOL:3701,PIESYMBOL:380,NEWPIESYMBOL:3801,KIDNEY:390,POLYBEZIERSYMBOL:590,PARALLELLINE:48,BRACESYMBOL:400,ANNOFRAMESYMBOL:320,ANNOFRAMESYMBOLM:321,TRAPEZOIDSYMBOL:350,POLYBEZIERCLOSESYMBOL:360,GROUPOBJECT:1e3,CLUSTEROBJECT:999,LINERELATION:1001,INTERFERENCEBEAM:1002,POLYGONREGION:1003,ARCREGION:1004,AIRROUTE:1005,NAVYROUTE:1006,MISSILEROUTE:1007,NAVYDEPLOYMENT:1008,AIRDEPLOYMENT:1009,SATELLITE:1010,SATELLITETIMEWINDOWS:1011,SYMBOLTEXT:1012,RUNWAY:1013,CURVEEIGHT:1014,ROUTENODE:1015,ARROWLINE:1016,PATHTEXT:1017,LITERATESIGN:1018,CONCENTRICCIRCLE:1019,FLAGGROUP:1020,SYMBOLTEXT1:1021,COMBINATIONALCIRCLE:1022,FREECURVE:1023,SYMBOLTEXTBOX:1024,NODECHAIN:1025,LINEMARKING:1026,AVOIDREGION:1027,WIRE:1028,LINEARARROW:1029,PICTURE:20,MODELPLOT:21,SIGN:22}),l=SuperMap.Plot.LineRelationType={SOLID:0,DASH:1,ARROW:2},s=SuperMap.Plot.AlgoSurroundLineType={NONE:0,INNER:1,OUT:2,ALL:3},a=SuperMap.Plot.RouteNodeType={RENDEZVOUS:"RENDEZVOUS",EXPANDING:"EXPANDING",VOLLEY:"VOLLEY",STANDBY:"STANDBY",SUPPLY:"SUPPLY",TAKEOFF:"TAKEOFF",INITIAL:"INITIAL",VISUALINITAL:"VISUALINITAL",LANCH:"LANCH",TURNING:"TURNING",AIMING:"AIMING",COMMONROUTE:"COMMONROUTE",WEAPONLAUNCH:"WEAPONLAUNCH",TARGET:"TARGET",ATTACK:"ATTACK",SUPPRESS:"SUPPRESS",EIGHTSPIRAL:"EIGHTSPIRAL",HAPPYVALLEY:"HAPPYVALLEY"},r=SuperMap.Plot.RelLineText={ONLINE:0,ONLEFTLINE:1,ONRIGHTLINE:2,ONBOTHLINE:3},u=SuperMap.Plot.RadiusLineType={NONE:0,SOLID:1,ARROW:2},p=(SuperMap.Plot.Position={TOP:4,BOTTOM:5,LEFT:6,RIGHT:7},SuperMap.Plot.AnnoPosition={LEFTTOP:0,LEFTBOTTOM:1,RIGHTTOP:2,RIGHTBOTTOM:3,TOP:4,BOTTOM:5,LEFT:6,RIGHT:7,MIDDLE:8,ANCHOR:9}),h=SuperMap.Plot.ArrowLineType={DOUBLELINE:0,TRIANGLESOLID:1,NONE:2},c=SuperMap.Plot.TextBoxType={WITHTIPBOX:0,RECTBOX:1,LINEBOX:2,NONEBOX:3},y=SuperMap.Plot.PositionOffsetType={LINE:0,GRADIENTLINE:1},g=SuperMap.Plot.AlignType={LEFT:0,RIGHT:1,UP:2,DOWN:3,VERTICALCENTER:4,HORIZONTALCENTER:5},f=SuperMap.Plot.EditMode={ADDCONTROLPOINT:0,EDITCONTROLPOINT:1,EDITCIRCUMRECTANGLE:2,REMOVECONTROLPOINT:3},d=(SuperMap.Plot.EqualLargeType={WIDTH:0,HEIGHT:1,SAME:2},SuperMap.Plot.UniformDistributionType={LEVEL:0,VERTICAL:1},SuperMap.Plot.TransactionType={CREATE:0,EDIT:1,REMOVE:2},SuperMap.Plot.SpecialEffectType={BOOM:0,COMMUNICATIONLINK:1,AIM:2,SECTORDETECTIONRANGE:3,DESTROY:4,SCANRADAR:5},SuperMap.Plot.AimType={AIM:0,VIEW:1},SuperMap.Plot.CommunicationLinkType={SENDER:0,RECEIVER:1},SuperMap.Plot.RadiusUnitType={PIXEL:0,METERS:1,DEGREE:2},SuperMap.Plot.SymbolTextPicturePosition={LEFT:0,RIGHT:1},SuperMap.Plot.SymbolRank={NULL:0,JQJ:1,FDJQJ:2,JTJJ:3,SJ:4,LJ:5,TJ:6,YJ:7,LIANJ:8,PJ:9},SuperMap.Plot.SignMode={Simple:0,Complex:1,Custom:2,Image:3},SuperMap.Plot.SignType={Sign1:0,Sign2:1,Sign3:2,Sign4:3,Sign5:4,Sign6:5,Sign7:6,Sign8:7,Sign9:8,Sign10:9,Sign11:10,Sign12:11,Sign13:12,Sign14:13,Sign15:14},SuperMap.Plot.SignRenderMode={Billboard:0,DOM:1},SuperMap.Plot.ColorGradientType={Horizontal:0,Vertical:1,Diagonal:2}),m={beforefeatureadded:"beforefeatureadded",featureadded:"featureadded",beforefeaturesselected:"beforefeaturesselected",featuresselected:"featuresselected",signsymbolselected:"signsymbolselected",updateFeature:"updateFeature",beforefeaturesunselected:"beforefeaturesunselected",featuresunselected:"featuresunselected",signsymbolunselected:"signsymbolunselected",beforefeaturesmodified:"beforefeaturesmodified",featuresmodified:"featuresmodified",featuresmodifing:"featuresmodifing",beforefeaturesremoved:"beforefeaturesremoved",featuresremoved:"featuresremoved",beforesignsymbolremoved:"beforesignsymbolremoved",signsymbolsremoved:"signsymbolsremoved",beforefeaturesadded:"beforefeaturesadded",featuresadded:"featuresadded",movingtargetsselected:"featuresselected",movingtargetsunselected:"featuresunselected",movingtargetcontextmenu:"featurecontextmenu",initializecompleted:"initializecompleted",cachecompleted:"cachecompleted",loadfinished:"loadfinished",plottinglayeradded:"plottinglayeradded",plottinglayerremoved:"plottinglayerremoved",signsymbollayeradded:"signsymbollayeradded",signsymbollayerremoved:"signsymbollayerremoved",plottinglayeractive:"plottinglayeractive",childplotlayeradded:"childplotlayeradded",childplotlayerremoved:"childplotlayerremoved",childplotlayeractive:"childplotlayeractive",specialeffectadded:"specialeffectadded",specialeffectremoved:"specialeffectremoved",specialeffectselected:"specialeffectselected",specialeffectunselected:"specialeffectunselected",reseteditmarkersvalues:"reseteditmarkersvalues",reseteditmarkers:"reseteditmarkers",animationcreated:"animationcreated",beforeanimationdeleted:"beforeanimationdeleted",animationdeleted:"animationdeleted",animationmodifybefore:"animationmodifybefore",animationmodify:"animationmodify",animationbegin:"animationbegin",animationreset:"animationreset",animationpause:"animationpause",animationplay:"animationplay",animationstop:"animationstop",animationfinished:"animationfinished",animatitonpropertyconfig:"animatitonpropertyconfig",animatitonjsonend:"animatitonjsonend",wayfeaturedrawfinished:"wayfeaturedrawfinished",wayfeaturemodifyfinished:"wayfeaturemodifyfinished",waymarkerdrag:"waymarkerdrag",beforewaymarkerdragstart:"beforewaymarkerdragstart",waymarkerdragstart:"waymarkerdragstart",signsymbolcreated:"signsymbolcreated",beforesignsymbolsadded:"beforesignsymbolsadded",signsymbolsadded:"signsymbolsadded",signsymboldrag:"signsymboldrag",latlngchanged:"latlngchanged",featureremoved:"featureremoved",featurevisiblechanged:"featurevisiblechanged",selectedspecialeffect:"selectedspecialeffect",unselectedspecialeffect:"unselectedspecialeffect",selectedmeasureobject:"selectedmeasureobject",unselectedmeasureobject:"unselectedmeasureobject",signcontextmenu:"signcontextmenu"};SuperMap.Plot.Event=m;var S=SuperMap.Plot.GOAnimationType={ANIMATION_UNKNOWN:-1,ANIMATION_WAY:0,ANIMATION_BLINK:1,ANIMATION_ATTRIBUTE:2,ANIMATION_SHOW:3,ANIMATION_ROTATE:4,ANIMATION_SCALE:5,ANIMATION_GROW:6,ANIMATION_HIDE_EXP:12,ANIMATION_REDUCE_EXP:13,ANIMATION_MOVEIN_EXP:14,ANIMATION_MOVEOUT_EXP:15,ANIMATION_ZOOMIN_EXP:16,ANIMATION_ZOOMOUT_EXP:17,ANIMATION_CURVE_EXP:18,ANIMATION_BROKENLINE_EXP:19,ANIMATION_GROW_EXP:20,ANIMATION_WAY_EXP:21,ANIMATION_BLINK_EXP:22,ANIMATION_SHOW_EXP:23,ANIMATION_MOVEVIEW_EXP:24},P=(SuperMap.Plot.BlinkAnimationBlinkStyle={Blink_Frequency:0,Blink_Number:1},SuperMap.Plot.BlinkAnimationReplaceStyle={Replace_NoColor:0,Replace_Color:1},SuperMap.Plot.RotateDirection={ClockWise:0,AntiClockWise:1},SuperMap.Plot.WayPathType={POLYLINE:0,CURVE:1},SuperMap.Plot.GOAnimationState={UNKNOWN:0,PLAYING:1,PAUSE:2,STOP:3,RESET:4}),b=SuperMap.Plot.AnimationPlayType={PLAYFROMNOW:0,PLAYSAMELASTONE:1,PLAYAFTERLASTONE:2,UNKNOWN:3};function v(t){"@babel/helpers - typeof";return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function M(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_(o.key),o)}}function _(t){var e=function(t,e){if("object"!=v(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=v(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==v(e)?e:e+""}function A(t,e,i){return e=x(e),function(t,e){if(e&&("object"===v(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],x(t).constructor):e.apply(t,i))}function T(){return(T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=x(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function x(t){return(x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function O(t,e){return(O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var w=function(t){function e(t,i){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=A(this,e,[t,i])).CLASS_NAME="SuperMap.PlotCommonServiceBase",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&O(t,e)}(e,SuperMap.CommonServiceBase),i=e,(o=[{key:"destroy",value:function(){T(x(e.prototype),"destroy",this).call(this)}},{key:"_commit",value:function(t){t.url&&(t.url=SuperMap.MGISCredential.addToken(t.url)),"POST"!==t.method&&"PUT"!==t.method||(t.params&&(t.url=SuperMap.Util.urlAppend(t.url,SuperMap.Util.getParameterString(t.params||{}))),t.params=t.data),SuperMap.FetchRequest.commit(t.method,t.url,t.params,{headers:t.headers,withCredentials:t.withCredentials,crossOrigin:t.crossOrigin,timeout:t.async?0:null,proxy:t.proxy}).then(function(t){return t.text()}).then(function(e){var i=(new SuperMap.Format.JSON).read(e);(i||(i={error:e}),i.error)?(t.scope?SuperMap.Function.bind(t.failure,t.scope):t.failure)(i.error):(i.succeed=void 0==i.succeed||i.succeed,(t.scope?SuperMap.Function.bind(t.success,t.scope):t.success)(i))})}}])&&M(i.prototype,o),n&&M(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function C(t){"@babel/helpers - typeof";return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function E(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,I(o.key),o)}}function I(t){var e=function(t,e){if("object"!=C(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=C(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==C(e)?e:e+""}SuperMap.PlotCommonServiceBase=w;var D=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.method=e.method?e.method:"POST",this.sitData=e.sitData?e.sitData:null,this.smlFileName=e.smlFileName?e.smlFileName:"",this.isCover=!!e.isCover&&e.isCover,this.CLASS_NAME="SuperMap.EditSmlFileParameters"},i=[{key:"toJsonParameters",value:function(t){if(t)return SuperMap.Plot.PlottingUtil.toJSON(t.sitData)}}],(e=[{key:"destroy",value:function(){this.method="POST",this.sitData=null,this.isCover=!1,this.smlFileName=""}}])&&E(t.prototype,e),i&&E(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function U(t){"@babel/helpers - typeof";return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function R(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,N(o.key),o)}}function N(t){var e=function(t,e){if("object"!=U(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=U(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==U(e)?e:e+""}function B(t,e,i){return e=F(e),function(t,e){if(e&&("object"===U(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],F(t).constructor):e.apply(t,i))}function k(){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=F(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function F(t){return(F=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function j(t,e){return(j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMap.EditSmlFileParameters=D;var V=function(t){function e(t,i){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o=B(this,e,[t,i]),(i=i||{})&&SuperMap.Util.extend(o,i);var n=o;return n.events=new SuperMap.Events(n,null,n.EVENT_TYPES,!0),n.eventListeners instanceof Object&&n.events.on(n.eventListeners),o.CLASS_NAME="SuperMap.EditSmlFileService",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&j(t,e)}(e,SuperMap.PlotCommonServiceBase),i=e,(o=[{key:"destroy",value:function(){k(F(e.prototype),"destroy",this).call(this)}},{key:"processAsync",value:function(t){if(t){var e=this,i=t.method,o=e.url.substr(e.url.length-1,1);e.url+="/"==o?"smlInfos/":"/smlInfos/",e.url+=t.smlFileName+".json",e.url+="?isCover="+t.isCover;var n=null;t.method&&"POST"===t.method&&(n=SuperMap.EditSmlFileParameters.toJsonParameters(t)),e.request({method:i,data:n,scope:e,success:e.serviceProcessCompleted,failure:e.serviceProcessFailed})}}}])&&R(i.prototype,o),n&&R(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function z(t){"@babel/helpers - typeof";return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Y(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,G(o.key),o)}}function G(t){var e=function(t,e){if("object"!=z(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=z(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==z(e)?e:e+""}function W(t,e,i){return e=H(e),function(t,e){if(e&&("object"===z(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],H(t).constructor):e.apply(t,i))}function X(){return(X="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=H(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function H(t){return(H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Z(t,e){return(Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMap.EditSmlFileService=V;var J=function(t){function e(t,i){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o=W(this,e,[t,i]),(i=i||{})&&SuperMap.Util.extend(o,i);var n,l=o;return n=l.url.substr(l.url.length-1,1),l.url+="/"==n?"symbolLibs.json":"/symbolLibs.json",o.CLASS_NAME="SuperMap.GetLibIDsService",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Z(t,e)}(e,SuperMap.PlotCommonServiceBase),i=e,(o=[{key:"destroy",value:function(){X(H(e.prototype),"destroy",this).call(this)}},{key:"processAsync",value:function(){this.request({method:"GET",data:null,scope:this,success:this.serviceProcessCompleted,failure:this.serviceProcessFailed})}}])&&Y(i.prototype,o),n&&Y(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function q(t){"@babel/helpers - typeof";return(q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function K(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Q(o.key),o)}}function Q(t){var e=function(t,e){if("object"!=q(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=q(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==q(e)?e:e+""}SuperMap.GetLibIDsService=J;var tt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.libID=e.libID,this.CLASS_NAME="SuperMap.GetLibInfoParameter"},(e=[{key:"destroy",value:function(){this.libID=null}}])&&K(t.prototype,e),i&&K(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function et(t){"@babel/helpers - typeof";return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function it(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ot(o.key),o)}}function ot(t){var e=function(t,e){if("object"!=et(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=et(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==et(e)?e:e+""}function nt(t,e,i){return e=st(e),function(t,e){if(e&&("object"===et(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],st(t).constructor):e.apply(t,i))}function lt(){return(lt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=st(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function st(t){return(st=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function at(t,e){return(at=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMap.GetLibInfoParameter=tt;var rt=function(t){function e(t,i){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o=nt(this,e,[t,i]),(i=i||{})&&SuperMap.Util.extend(o,i);var n,l=o;return n=l.url.substr(l.url.length-1,1),l.url+="/"==n?"symbolLibs/":"/symbolLibs/",o.CLASS_NAME="SuperMap.GetLibInfoService",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&at(t,e)}(e,SuperMap.PlotCommonServiceBase),i=e,(o=[{key:"destroy",value:function(){lt(st(e.prototype),"destroy",this).call(this)}},{key:"processAsync",value:function(t){var e=this;t&&null!==t.libID&&(e.libID=t.libID),e.url+=e.libID,e.url+=".json",e.request({method:"GET",data:null,scope:e,success:e.serviceProcessCompleted,failure:e.serviceProcessFailed})}}])&&it(i.prototype,o),n&&it(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function ut(t){"@babel/helpers - typeof";return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pt(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ht(o.key),o)}}function ht(t){var e=function(t,e){if("object"!=ut(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=ut(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ut(e)?e:e+""}SuperMap.GetLibInfoService=rt;var ct=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.start=e.start,this.count=e.count?e.count:null,this.CLASS_NAME="SuperMap.GetSMLInfosParameters"},i=[{key:"toUrlParameters",value:function(t){if(t){var e="";return null!==t.start&&(e="?start="+encodeURIComponent(t.start)),!t.count||null===t.count&&0===t.count||(e+="&count="+encodeURIComponent(t.count)),e}}}],(e=[{key:"destroy",value:function(){this.start=null,this.count=null}}])&&pt(t.prototype,e),i&&pt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function yt(t){"@babel/helpers - typeof";return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gt(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ft(o.key),o)}}function ft(t){var e=function(t,e){if("object"!=yt(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=yt(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==yt(e)?e:e+""}function dt(t,e,i){return e=St(e),function(t,e){if(e&&("object"===yt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],St(t).constructor):e.apply(t,i))}function mt(){return(mt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=St(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function St(t){return(St=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Pt(t,e){return(Pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMap.GetSMLInfosParameters=ct;var bt=function(t){function e(t,i){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o=dt(this,e,[t,i]),(i=i||{})&&SuperMap.Util.extend(o,i);var n,l=o;return l.events=new SuperMap.Events(l,null,l.EVENT_TYPES,!0),l.eventListeners instanceof Object&&l.events.on(l.eventListeners),n=l.url.substr(l.url.length-1,1),l.url+="/"==n?"smlInfos":"/smlInfos",l.url+=".json",o.CLASS_NAME="SuperMap.GetSMLInfosService",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pt(t,e)}(e,SuperMap.PlotCommonServiceBase),i=e,(o=[{key:"destroy",value:function(){mt(St(e.prototype),"destroy",this).call(this)}},{key:"processAsync",value:function(t){if(t){var e=this;e.url+=SuperMap.GetSMLInfosParameters.toUrlParameters(t),e.request({method:"GET",data:null,scope:e,success:e.serviceProcessCompleted,failure:e.serviceProcessFailed})}}}])&&gt(i.prototype,o),n&&gt(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function vt(t){"@babel/helpers - typeof";return(vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Lt(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Mt(o.key),o)}}function Mt(t){var e=function(t,e){if("object"!=vt(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=vt(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==vt(e)?e:e+""}SuperMap.GetSMLInfosService=bt;var _t=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.libID=e.libID,this.code=e.code,this.inputPoints=e.inputPoints?e.inputPoints:null,this.symbolRank=e.symbolRank?e.symbolRank:0,this.negativeImage=!!e.negativeImage&&e.negativeImage,this.surroundLineType=e.surroundLineType?e.surroundLineType:0,this.subSymbols=e.subSymbols?e.subSymbols:null,this.scaleValues=e.scaleValues?e.scaleValues:null,this.scalePoints=e.scalePoints?e.scalePoints:null,this.newScalePoint=e.newScalePoint?e.newScalePoint:null,this.newScalePointIndex=e.newScalePointIndex?e.newScalePointIndex:0,this.CLASS_NAME="SuperMap.GetSymbolInfoParameters"},i=[{key:"toUrlParameters",value:function(t){if(t&&null!==t.libID&&null!==t.code){var e="libID="+encodeURIComponent(t.libID)+"&code="+encodeURIComponent(t.code);if(t.inputPoints&&null!==t.inputPoints&&0!==t.inputPoints.length){for(var i="[",o=0;o<t.inputPoints.length;o++)o===t.inputPoints.length-1?i+='{"x":'+t.inputPoints[o].x+', "y":'+t.inputPoints[o].y+"}]":i+='{"x":'+t.inputPoints[o].x+', "y":'+t.inputPoints[o].y+"},";e+="&inputPoints="+encodeURIComponent(i)}if(t.scalePoints&&null!==t.scalePoints&&0!==t.scalePoints.length){for(var n="[",l=0;l<t.scalePoints.length;l++)l===t.scalePoints.length-1?n+='{"x":'+t.scalePoints[l].x+', "y":'+t.scalePoints[l].y+"}]":n+='{"x":'+t.scalePoints[l].x+', "y":'+t.scalePoints[l].y+"},";e+="&scalePoints="+encodeURIComponent(n)}if(t.scaleValues&&null!==t.scaleValues&&0!==t.scaleValues.length){for(var s="[",a=0;a<t.scaleValues.length;a++)a===t.scaleValues.length-1?s+=t.scaleValues[a]+"]":s+=t.scaleValues[a]+",";e+="&scaleValues="+encodeURIComponent(s)}if(t.subSymbols&&null!==t.subSymbols&&0!==t.subSymbols.length){for(var r="[",u=0;u<t.subSymbols.length;u++)u===t.subSymbols.length-1?r+=t.subSymbols[u].code+"]":r+=t.subSymbols[u].code+",";e+="&subSymbols="+encodeURIComponent(r)}return t.newScalePoint&&null!==t.newScalePoint&&(e+="&newScalePoint="+encodeURIComponent('{"x":'+t.newScalePoint.x+', "y":'+t.newScalePoint.y+"}")),t.newScalePointIndex&&null!==t.newScalePointIndex&&(e+="&newScalePointIndex="+encodeURIComponent(t.newScalePointIndex)),t.symbolRank&&null!==t.symbolRank&&(e+="&symbolRank="+encodeURIComponent(t.symbolRank)),t.negativeImage&&null!==t.negativeImage&&(e+="&negativeImage="+encodeURIComponent(t.negativeImage)),t.surroundLineType&&null!==t.surroundLineType&&(e+="&surroundLineType="+encodeURIComponent(t.surroundLineType)),e}}}],(e=[{key:"destroy",value:function(){var t=this;t.libID=null,t.code=null,t.inputPoints=null,t.symbolRank=null,t.negativeImage=null,t.surroundLineType=null,t.subSymbols=null,t.scaleValues=null,t.scalePoints=null,t.newScalePoint=null,t.newScalePointIndex=null}}])&&Lt(t.prototype,e),i&&Lt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function At(t){"@babel/helpers - typeof";return(At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tt(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,xt(o.key),o)}}function xt(t){var e=function(t,e){if("object"!=At(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=At(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==At(e)?e:e+""}function Ot(t,e,i){return e=Ct(e),function(t,e){if(e&&("object"===At(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Ct(t).constructor):e.apply(t,i))}function wt(){return(wt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ct(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function Ct(t){return(Ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Et(t,e){return(Et=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMap.GetSymbolInfoParameters=_t;var It=function(t){function e(t,i){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n,l=o=Ot(this,e,[t,i=i||{}]);return n=l.url.substr(l.url.length-1,1),l.url+="/"==n?"graphicObject.json?":"/graphicObject.json?",o.CLASS_NAME="SuperMap.GetSymbolInfoService",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Et(t,e)}(e,SuperMap.PlotCommonServiceBase),i=e,(o=[{key:"destroy",value:function(){wt(Ct(e.prototype),"destroy",this).call(this)}},{key:"processAsync",value:function(t){if(t){var e,i=this;e=SuperMap.GetSymbolInfoParameters.toUrlParameters(t),i.url+=e,t.dynamicToken&&(i.url+="&dynamicToken="+t.dynamicToken),"MSIE"===SuperMap.Browser.name.toUpperCase()&&(i.url=encodeURI(i.url)),i.request({method:"GET",params:null,scope:i,success:i.myServiceProcessCompleted,failure:i.serviceProcessFailed})}}},{key:"myServiceProcessCompleted",value:function(t){null!=(t=SuperMap.Util.transformResult(t))&&null!=t.textStyle2D&&null!=t.textStyle2D.fontHeight&&(t.textStyle2D.fontHeight=3),this.events.triggerEvent("processCompleted",{result:t})}}])&&Tt(i.prototype,o),n&&Tt(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Dt(t){"@babel/helpers - typeof";return(Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ut(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return Rt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Rt(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var o=0,n=function(){};return{s:n,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,l=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw l}}}}function Rt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=new Array(e);i<e;i++)o[i]=t[i];return o}function Nt(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Bt(o.key),o)}}function Bt(t){var e=function(t,e){if("object"!=Dt(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Dt(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Dt(e)?e:e+""}SuperMap.GetSymbolInfoService=It;var kt=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._keyMap={}},i=[{key:"addCredential",value:function(t){void 0==this._keyMap&&(this._keyMap=new Map),this._keyMap.set(t.url,{value:t.value,type:t.type||"token"})}},{key:"addToken",value:function(t){if(void 0==this._keyMap)return t;var e,i=void 0,o=Ut(this._keyMap.keys());try{for(o.s();!(e=o.n()).done;){var n=e.value;if(t.includes(n)){i=n;break}}}catch(t){o.e(t)}finally{o.f()}var l=t;if(void 0!==i){var s=this._keyMap.get(i),a=s.type+"="+s.value,r="?";t.includes("?")&&(r="&"),l=t+r+a}return l}},{key:"normalizedUrl",value:function(t){var e=t;if(t.includes("?")){var i=t.split("?").filter(function(t){return""!==t});if(i.length>1){var o=(e=i[0]).lastIndexOf(".");o>-1&&(e=e.substring(0,o));var n=i[1];if((o=n.indexOf("token="))>-1){var l=n;if(n.includes("&")){var s=n.split("&").filter(function(t){return t.startsWith("token=")});s.length>0&&(l=s[0])}this.addCredential({url:e,type:"token",value:l.substring(6)})}}}return e.endsWith("/")&&(e=e.substring(0,e.length-1)),e}}],(e=null)&&Nt(t.prototype,e),i&&Nt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Ft(t){"@babel/helpers - typeof";return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jt(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Vt(o.key),o)}}function Vt(t){var e=function(t,e){if("object"!=Ft(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ft(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ft(e)?e:e+""}SuperMap.MGISCredential=kt;var zt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.lineColor=e.lineColor?e.lineColor:"#ff0000",this.lineWidth=e.lineWidth?e.lineWidth:2,this.lineType=e.lineType?e.lineType:0,this.lineOpacity=e.lineOpacity?e.lineOpacity:1,this.lineCap=e.lineCap?e.lineCap:"round",this.flagTextSize=e.flagTextSize?e.flagTextSize:60,this.maxScale=e.maxScale?e.maxScale:5,this.minScale=e.minScale?e.minScale:1,this.dotSymbolSize=e.dotSymbolSize?e.dotSymbolSize:40,this.dotTextSpace=e.dotTextSpace?e.dotTextSpace:7,this.scaleByMap=!!e.scaleByMap&&e.scaleByMap,this.fillColor=e.fillColor?e.fillColor:"#ff0000",this.fillOpacity=e.fillOpacity?e.fillOpacity:.31,this.fontColor=e.fontColor?e.fontColor:"#000000",this.fontOpacity=e.fontOpacity?e.fontOpacity:1,this.fontStroke=!!e.fontStroke&&e.fontStroke,this.fontStrokeColor=e.fontStrokeColor?e.fontStrokeColor:"#ff0000",this.fontStrokeWidth=e.fontStrokeWidth?e.fontStrokeWidth:"2px",this.fontBackground=!!e.fontBackground&&e.fontBackground,this.fontBackgroundColor=e.fontBackgroundColor?e.fontBackgroundColor:"#ff0000",this.fontShadow=!!e.fontShadow&&e.fontShadow,this.fontShadowColor=e.fontShadowColor?e.fontShadowColor:"#ff0000",this.fontShadowOffsetX=e.fontShadowOffsetX?e.fontShadowOffsetX:0,this.fontShadowOffsetY=e.fontShadowOffsetY?e.fontShadowOffsetY:0,this.fontSize=e.fontSize?e.fontSize:14,this.fontSpace=e.fontSpace?e.fontSpace:0,this.fontPercent=e.fontPercent?e.fontPercent:100,this.fontFamily=e.fontFamily?e.fontFamily:"微软雅黑",this.fontWeight=e.fontWeight?e.fontWeight:"bold",this.fontStyle=e.fontStyle?e.fontStyle:"",this.surroundLineType=e.surroundLineType?e.surroundLineType:0,this.surroundLineColor=e.surroundLineColor?e.surroundLineColor:"#ffff00",this.surroundLineWidth=e.surroundLineWidth?e.surroundLineWidth:4,this.surroundLineColorOpacity=e.surroundLineColorOpacity?e.surroundLineColorOpacity:1,this.fontStyle=e.fontStyle?e.fontStyle:"",this.fillBackColor=e.fillBackColor?e.fillBackColor:"#ff0000",this.fillBackOpacity=e.fillBackOpacity?e.fillBackOpacity:1,this.fillGradientMode=e.fillGradientMode?e.fillGradientMode:"NONE",this.fillCenterOffsetX=e.fillCenterOffsetX?e.fillCenterOffsetX:0,this.fillCenterOffsetY=e.fillCenterOffsetY?e.fillCenterOffsetY:0,this.fillAngle=e.fillAngle?e.fillAngle:0,this.fillSymbolID=e.fillSymbolID?e.fillSymbolID:1,this.defaultFlag=!!e.defaultFlag&&e.defaultFlag,this.CLASS_NAME="SuperMap.Plot.DefaultStyle",this.parserConfiguration()},(e=[{key:"parserConfiguration",value:function(){"undefined"!=typeof DefaultStyleConfiguration&&("undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.flagTextSize&&(this.flagTextSize=parseFloat(DefaultStyleConfiguration.flagTextSize)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.maxScale&&(this.maxScale=parseFloat(DefaultStyleConfiguration.maxScale)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.minScale&&(this.minScale=parseFloat(DefaultStyleConfiguration.minScale)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.dotSymbolSize&&(this.dotSymbolSize=parseFloat(DefaultStyleConfiguration.dotSymbolSize)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.dotTextSpace&&(this.dotTextSpace=parseFloat(DefaultStyleConfiguration.dotTextSpace)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.scaleByMap&&(this.scaleByMap=DefaultStyleConfiguration.scaleByMap),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.strokeWidth&&(this.lineWidth=parseFloat(DefaultStyleConfiguration.strokeWidth)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.strokeColor&&(this.lineColor=DefaultStyleConfiguration.strokeColor),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.strokeOpacity&&(this.lineOpacity=parseFloat(DefaultStyleConfiguration.strokeOpacity)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.strokeDashstyle&&(this.lineType=DefaultStyleConfiguration.strokeDashstyle),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.strokeLinecap&&(this.lineCap=DefaultStyleConfiguration.strokeLinecap),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fillColor&&(this.fillColor=DefaultStyleConfiguration.fillColor),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fillOpacity&&(this.fillOpacity=parseFloat(DefaultStyleConfiguration.fillOpacity)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontColor&&(this.fontColor=DefaultStyleConfiguration.fontColor),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontOpacity&&(this.fontOpacity=parseFloat(DefaultStyleConfiguration.fontOpacity)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontStroke&&(this.fontStroke=DefaultStyleConfiguration.fontStroke),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontStrokeColor&&(this.fontStrokeColor=DefaultStyleConfiguration.fontStrokeColor),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontStrokeWidth&&(this.fontStrokeWidth=parseFloat(DefaultStyleConfiguration.fontStrokeWidth)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontBackground&&(this.fontBackground=DefaultStyleConfiguration.fontBackground),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontBackgroundColor&&(this.fontBackgroundColor=DefaultStyleConfiguration.fontBackgroundColor),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontShadow&&(this.fontShadow=DefaultStyleConfiguration.fontShadow),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontShadowColor&&(this.fontShadowColor=DefaultStyleConfiguration.fontShadowColor),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontShadowOffsetX&&(this.fontShadowOffsetX=DefaultStyleConfiguration.fontShadowOffsetX),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontShadowOffsetY&&(this.fontShadowOffsetY=DefaultStyleConfiguration.fontShadowOffsetY),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontSpace&&(this.fontSpace=parseInt(DefaultStyleConfiguration.fontSpace)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontPercent&&(this.fontPercent=parseFloat(DefaultStyleConfiguration.fontPercent)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontSize&&(this.fontSize=parseFloat(DefaultStyleConfiguration.fontSize)),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontFamily&&(this.fontFamily=DefaultStyleConfiguration.fontFamily),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontWeight&&(this.fontWeight=DefaultStyleConfiguration.fontWeight),"undefined"==typeof DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fontStyle&&(this.fontStyle=DefaultStyleConfiguration.fontStyle),DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.surroundLineType&&(this.surroundLineType=parseFloat(DefaultStyleConfiguration.surroundLineType)),DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.surroundLineColor&&(this.surroundLineColor=DefaultStyleConfiguration.surroundLineColor),DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.surroundLineWidth&&(this.surroundLineWidth=parseFloat(DefaultStyleConfiguration.surroundLineWidth)),DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.surroundLineColorOpacity&&(this.surroundLineColorOpacity=parseFloat(DefaultStyleConfiguration.surroundLineColorOpacity)),DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fillBackColor&&(this.fillBackColor=DefaultStyleConfiguration.fillBackColor),DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fillBackOpacity&&(this.fillBackOpacity=parseFloat(DefaultStyleConfiguration.fillBackOpacity)),DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fillGradientMode&&(this.fillGradientMode=DefaultStyleConfiguration.fillGradientMode),DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fillAngle&&(this.fillAngle=parseFloat(DefaultStyleConfiguration.fillAngle)),DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fillCenterOffsetX&&(this.fillCenterOffsetX=parseFloat(DefaultStyleConfiguration.fillCenterOffsetX)),DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fillCenterOffsetY&&(this.fillCenterOffsetY=parseFloat(DefaultStyleConfiguration.fillCenterOffsetY)),DefaultStyleConfiguration&&void 0!==DefaultStyleConfiguration.fillSymbolID&&(this.fillSymbolID=parseFloat(DefaultStyleConfiguration.fillSymbolID)))}},{key:"destroy",value:function(){this.lineColor=null,this.lineWidth=null,this.dotSymbolSize=null,this.lineType=null,this.defaultFlag=null,this.flagTextSize=null,this.maxScale=null,this.minScale=null,this.dotTextSpace=null,this.scaleByMap=null,this.lineOpacity=null,this.lineCap=null,this.fillColor=null,this.fillOpacity=null,this.fontColor=null,this.fontOpacity=null,this.fontSize=null,this.fontFamily=null,this.fontWeight=null,this.fontStyle=null,this.fontPercent=null,this.fontSpace=null,this.surroundLineType=null,this.surroundLineColor=null,this.surroundLineWidth=null,this.surroundLineColorOpacity=null,this.fillBackColor=null,this.fillBackOpacity=null,this.fillGradientMode=null,this.fillAngle=null,this.fillCenterOffsetX=null,this.fillCenterOffsetY=null,this.fillSymbolID=null}}])&&jt(t.prototype,e),i&&jt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Yt(t){"@babel/helpers - typeof";return(Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gt(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Wt(o.key),o)}}function Wt(t){var e=function(t,e){if("object"!=Yt(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Yt(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Yt(e)?e:e+""}SuperMap.Plot.DefaultStyle=zt;var Xt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.properties=e.properties?e.properties:[],this.CLASS_NAME="SuperMap.Plot.ExtendProperty"},(e=[{key:"addProperty",value:function(t,e){var i=this.findProperty(t);return null==i?this.properties.push(new SuperMap.Plot.Property(t,e)):i.setValue(e),!0}},{key:"deleteProperty",value:function(t){for(var e=0;e<this.properties.length;e++)if(this.properties[e].key===t)return this.properties.slice(e,1),!0;return!1}},{key:"findProperty",value:function(t){for(var e=0;e<this.properties.length;e++)if(this.properties[e].key===t)return this.properties[e];return null}},{key:"getPropertyValue",value:function(t){for(var e=0;e<this.properties.length;e++)if(this.properties[e].key===t)return this.properties[e].value;return null}},{key:"getPropertyByIndex",value:function(t){return t<this.properties.length?this.properties[t]:null}},{key:"getPropertyCount",value:function(){return this.properties.length}},{key:"destroy",value:function(){this.properties=null}}])&&Gt(t.prototype,e),i&&Gt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Ht(t){"@babel/helpers - typeof";return(Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zt(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Jt(o.key),o)}}function Jt(t){var e=function(t,e){if("object"!=Ht(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ht(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ht(e)?e:e+""}SuperMap.Plot.ExtendProperty=Xt;var qt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.layerName=e.layerName?e.layerName:null,this.spatialAnalystUrl=e.spatialAnalystUrl?e.spatialAnalystUrl:null,this.useCanvas2=!!e.useCanvas2&&e.useCanvas2,this.useCanvas=!!e.useCanvas&&e.useCanvas,this.features=e.features?e.features:null,this.CLASS_NAME="SuperMap.Plot.LayerDataStruct"},(e=[{key:"destroy",value:function(){this.layerName=null,this.spatialAnalystUrl=null,this.useCanvas2=null,this.useCanvas=null,this.features=null}},{key:"toJSON",value:function(){for(var t=[],e=0;e<this.features.length;e++)t.push(this.features[e].getSymbolData());return'{"layerName":'+SuperMap.Plot.PlottingUtil.toJSON(this.layerName)+', "spatialAnalystUrl":'+SuperMap.Plot.PlottingUtil.toJSON(this.spatialAnalystUrl)+', "useCanvas2":'+SuperMap.Plot.PlottingUtil.toJSON(this.useCanvas2)+', "useCanvas":'+SuperMap.Plot.PlottingUtil.toJSON(this.useCanvas)+', "isEditable":'+SuperMap.Plot.PlottingUtil.toJSON(this.isEditable)+', "isLocked":'+SuperMap.Plot.PlottingUtil.toJSON(this.isLocked)+', "visibility":'+SuperMap.Plot.PlottingUtil.toJSON(this.visibility)+',"features":'+SuperMap.Plot.PlottingUtil.toJSON(t)+"}"}}])&&Zt(t.prototype,e),i&&Zt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Kt(t){"@babel/helpers - typeof";return(Kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qt(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,$t(o.key),o)}}function $t(t){var e=function(t,e){if("object"!=Kt(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Kt(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Kt(e)?e:e+""}SuperMap.Plot.LayerDataStruct=qt;var te=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.zoom=e.zoom?e.zoom:null,this.centerX=e.centerX?e.centerX:null,this.centerY=e.centerY?e.centerY:null,this.CLASS_NAME="SuperMap.Plot.MapInfoStruct"},(e=[{key:"destroy",value:function(){this.zoom=null,this.centerX=null,this.centerY=null}},{key:"fromJSON",value:function(t){void 0!==t.zoom&&(this.zoom=t.zoom),void 0!==t.centerX&&(this.centerX=t.centerX),void 0!==t.centerY&&(this.centerY=t.centerY)}},{key:"toJSON",value:function(){return'{"zoom":'+SuperMap.Plot.PlottingUtil.toJSON(this.zoom)+',"centerX":'+SuperMap.Plot.PlottingUtil.toJSON(this.centerX)+',"centerY":'+SuperMap.Plot.PlottingUtil.toJSON(this.centerY)+"}"}}])&&Qt(t.prototype,e),i&&Qt(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function ee(t){"@babel/helpers - typeof";return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ie(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,oe(o.key),o)}}function oe(t){var e=function(t,e){if("object"!=ee(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=ee(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ee(e)?e:e+""}SuperMap.Plot.MapInfoStruct=te;var ne=function(){return t=function t(e,i,o,n,l){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=parseFloat(e),this.y=parseFloat(i),(o||0==o)&&(this.z=parseFloat(o)),n&&(this.number=n),l&&(this.time=l),this.CLASS_NAME="SuperMap.Plot.OrbitPoint"},(e=[{key:"destroy",value:function(){this.x=null,this.y=null,this.z=null,this.index=null,this.time=null}},{key:"clone",value:function(t){return null==t&&(t=new SuperMap.Plot.OrbitPoint(this.x,this.y,this.z)),SuperMap.Util.applyDefaults(t,this),t}}])&&ie(t.prototype,e),i&&ie(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function le(t){"@babel/helpers - typeof";return(le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function se(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ae(o.key),o)}}function ae(t){var e=function(t,e){if("object"!=le(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=le(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==le(e)?e:e+""}SuperMap.Plot.OrbitPoint=ne;var re=function(){return t=function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e&&(this.key=e),i&&(this.value=i),this.CLASS_NAME="SuperMap.Plot.Property"},(e=[{key:"setKey",value:function(t){this.key=t}},{key:"getKey",value:function(){return this.key}},{key:"setValue",value:function(t){this.value=t}},{key:"getValue",value:function(){return this.value}},{key:"destroy",value:function(){this.key=null,this.value=null}},{key:"clone",value:function(){return new SuperMap.Plot.Property(this.key,this.value)}}])&&se(t.prototype,e),i&&se(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function ue(t){"@babel/helpers - typeof";return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pe(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,he(o.key),o)}}function he(t){var e=function(t,e){if("object"!=ue(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=ue(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ue(e)?e:e+""}SuperMap.Plot.Property=re;var ce=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.id=e.id?e.id:SuperMap.Plot.PlottingUtil.generateUuid(),this.x=e.x?e.x:null,this.y=e.y?e.y:null,this.z=e.z?e.z:null,this.type=e.type?e.type:null,this.name=e.name?e.name:null,this.rotate=e.rotate?e.rotate:0,this.towardNodes=e.towardNodes?e.towardNodes:[],this.style=e.style?e.style:{},0===Object.keys(this.style).length&&(this.style=SuperMap.Util.cloneObject(L.supermap.plotting.PlottingObject.prototype._defaultStyle)),this.CLASS_NAME="SuperMap.Plot.RouteNode"}return e=t,(i=[{key:"destroy",value:function(){this.type=null,this.position=null,this.name=null,this.id=null,this.rotate=null,this.towardNodes&&null!==this.towardNodes||(this.towardNodes=null);for(var t=0;t<this.towardNodes.length;t++)this.towardNodes[t].destroy();this.towardNodes=null}},{key:"clone",value:function(){var e=new t({id:this.id,type:this.type,name:this.name,rotate:this.rotate,towardNodes:this.towardNodes});return e.positionPoint=this.positionPoint.clone(),e.style={},e.style=SuperMap.Util.copyAttributes(e.style,this.style),e}},{key:"parseSymbolData",value:function(t){for(var e in this.id=t.id,this.type=t.type,this.name=t.name,this.rotate=t.rotate,t.positionPoint?(this.x=t.positionPoint.x,this.y=t.positionPoint.y,this.z=t.positionPoint.z):(this.x=t.x,this.y=t.y,this.z=t.z),this.style=SuperMap.Plot.AnalysisSymbol.getStyle(t,!0),t.towardNodes){var i=new SuperMap.Plot.TowardNode;this.towardNodes.push(i.parseSymbolData(t.towardNodes[e]))}return this}},{key:"setSymbolData",value:function(){var t={};t.id=this.id,t.type=this.type,t.name=this.name,t.rotate=this.rotate,t.x=this.x,t.y=this.y,t.z=this.z,SuperMap.Plot.AnalysisSymbol.setStyle(this.style,t,!0),t.towardNodes=[];for(var e=0;e<this.towardNodes.length;e++)t.towardNodes.push(this.towardNodes[e].setSymbolData());return t}}])&&pe(e.prototype,i),o&&pe(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,i,o}();function ye(t){"@babel/helpers - typeof";return(ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ge(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,fe(o.key),o)}}function fe(t){var e=function(t,e){if("object"!=ye(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=ye(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ye(e)?e:e+""}SuperMap.Plot.RouteNode=ce;var de=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.smlInfo=e.smlInfo?e.smlInfo:null,this.mapInfo=e.mapInfo?e.mapInfo:null,this.layerDatas=e.layerDatas?e.layerDatas:null,this.CLASS_NAME="SuperMap.Plot.SitDataStruct"},(e=[{key:"destroy",value:function(){this.smlInfo=null,this.mapInfo=null,this.layerDatas=null}}])&&ge(t.prototype,e),i&&ge(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function me(t){"@babel/helpers - typeof";return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Se(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Pe(o.key),o)}}function Pe(t){var e=function(t,e){if("object"!=me(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=me(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==me(e)?e:e+""}SuperMap.Plot.SitDataStruct=de;var be=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e&&(this.SMLName=e.SMLName,this.SMLDesc=e.SMLDesc,this.SMLSeclevel=e.SMLSeclevel,this.SMLDepat=e.SMLDepat,this.SMLAuthor=e.SMLAuthor,this.SMLTime=e.SMLTime),this.CLASS_NAME="SuperMap.Plot.SMLInfoStruct"},(e=[{key:"destroy",value:function(){this.SMLName="",this.SMLDesc="",this.SMLAuthor="",this.SMLSeclevel="",this.SMLDepat="",this.SMLTime=""}},{key:"fromJSON",value:function(t){this.SMLName=t.SMLName,this.SMLDesc=t.SMLDesc,this.SMLSeclevel=t.SMLSeclevel,this.SMLDepat=t.SMLDepat,this.SMLAuthor=t.SMLAuthor,this.SMLTime=t.SMLTime}},{key:"toJSON",value:function(){return'{"SMLName":'+SuperMap.Plot.PlottingUtil.toJSON(this.SMLName)+',"SMLDesc":'+SuperMap.Plot.PlottingUtil.toJSON(this.SMLDesc)+',"SMLSeclevel":'+SuperMap.Plot.PlottingUtil.toJSON(this.SMLSeclevel)+',"SMLDepat":'+SuperMap.Plot.PlottingUtil.toJSON(this.SMLDepat)+',"SMLAuthor":'+SuperMap.Plot.PlottingUtil.toJSON(this.SMLAuthor)+',"SMLTime":'+SuperMap.Plot.PlottingUtil.toJSON(this.SMLTime)+"}"}}])&&Se(t.prototype,e),i&&Se(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function ve(t){"@babel/helpers - typeof";return(ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Le(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Me(o.key),o)}}function Me(t){var e=function(t,e){if("object"!=ve(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=ve(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ve(e)?e:e+""}SuperMap.Plot.SMLInfoStruct=be;var _e=function(){return t=function t(e,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o=o||{},this.libID=e,this.code=i,this.symbolData=o.symbolData?o.symbolData:null,this.textContent=o.textContent?o.textContent:null,this.totalNum=o.totalNum?o.totalNum:null,this.lineColor=o.lineColor?o.lineColor:null,this.width2D=o.width2D?o.width2D:null,this.width3D=o.width3D?o.width3D:-1,this.CLASS_NAME="SuperMap.Plot.SubSymbol"},(e=[{key:"destroy",value:function(){this.libID=null,this.code=null,this.symbolData=null,this.totalNum=null,this.lineColor=null,this.width2D=null,this.width3D=null}},{key:"clone",value:function(){var t=new SuperMap.Plot.SubSymbol(this.libID,this.code);return t.symbolData={},t.symbolData=SuperMap.Util.copyAttributes(t.symbolData,this.symbolData),t.textContent=this.textContent,t.totalNum=this.totalNum,t.lineColor=this.lineColor,t.width2D=this.width2D,t.width3D=this.width3D,t}}])&&Le(t.prototype,e),i&&Le(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Ae(t){"@babel/helpers - typeof";return(Ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Te(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,xe(o.key),o)}}function xe(t){var e=function(t,e){if("object"!=Ae(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ae(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ae(e)?e:e+""}SuperMap.Plot.SubSymbol=_e;var Oe=function(){return t=function t(e,i,o,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n=n||{},this.title=n.title?n.title instanceof Array?n.title:[n.title]:[],this.textContent=e?e instanceof Array?e:[e]:[],this.textPosition=i,void 0!==this.textPosition&&null!==this.textPosition||(this.textPosition=0),this.offsetX=n.offsetX?n.offsetX:0,this.offsetY=null==n.offsetY||void 0==n.offsetY?-30:0==n.offsetY?0:n.offsetY,this.border=null!=n.border&&n.border,this.showRelationLine=null==n.showRelationLine||n.showRelationLine,this.paddingX=n.paddingX?n.paddingX:0,this.paddingY=n.paddingY?n.paddingY:0,this.signMode=n.signMode>=0?n.signMode:1,this.signRenderMode=n.signRenderMode>=0?n.signRenderMode:SuperMap.Plot.SignRenderMode.Billboard,this.signType=n.signType>=0?n.signType:null,this.templateUrl=n.templateUrl?n.templateUrl:"",this.signImage=n.signImage?n.signImage:"",this.domStr=n.domStr?n.domStr:"",this.visible=!n.visible||n.visible,this.scale=n.scale?n.scale:1,this.minVisibleLevel=n.minVisibleLevel?n.minVisibleLevel:0,this.maxVisibleLevel=n.maxVisibleLevel?n.maxVisibleLevel:18,this.style={display:"display",color:"#ff0000",lineSymbolID:0,opacity:"1.00",weight:2,lineCap:"square",lineJoin:"square",surroundLineColor:"#ffff00",surroundLineColorOpacity:"1.00",surroundLineWidth:4,fillSymbolID:1,fillColor:"#ff0000",fillOpacity:"0.31",fillBackColor:"#ff0000",fillBackOpacity:"1.00",fillGradientMode:"NONE",fontColor:"#000000",fontFamily:"Microsoft YaHei",fontSize:"12",fontStroke:!1,fontStrokeColor:"#ff0000",fontStrokeWidth:"2px",fontBackground:!1,fontBackgroundColor:"#ff0000",fontShadow:!1,fontShadowColor:"#ff0000",fontShadowOffsetX:0,fontShadowOffsetY:0,fontSpace:0,fontPercent:100,sizeFixed:!0,labelAlign:"lt",labelRotation:-0,labelXOffset:0,labelYOffset:0,fillAngle:0,fillCenterOffsetX:0,fillCenterOffsetY:0,titleColor:"#ff0000",titleFontFamily:"Microsoft YaHei",titleFontSize:"16",titleLabelAlign:"cm",contentLabelAlign:"cm"},null!=o&&(this.style=SuperMap.Util.copyAttributes(this.style,o)),this.lineStyle={color:"#ff0000",lineSymbolID:0,opacity:1,weight:2},null!=n.lineStyle&&(this.lineStyle=SuperMap.Util.copyAttributes(this.lineStyle,n.lineStyle)),void 0!=n.imgPath&&(this.image={path:n.imgPath?n.imgPath:"../img/marker.png",width:n.imgWidth?n.imgWidth:16,height:n.imgHeight?n.imgHeight:16,position:n.symbolTextPicturePosition?n.symbolTextPicturePosition:SuperMap.Plot.SymbolTextPicturePosition.LEFT})},(e=[{key:"destroy",value:function(){this.textContent=null,this.textPosition=null,this.offsetX=null,this.offsetY=null,this.border=null,this.paddingX=null,this.paddingY=null,this.showRelationLine=null,this.minVisibleLevel=null,this.maxVisibleLevel=null,this.style=null,this.lineStyle=null,this.template=null,this.title=null,this.image=null,this.signMode=null,this.signRenderMode=null,this.signType=null,this.templateUrl=null,this.signImage=null,this.domStr=null,this.visible=null,this.scale=null}},{key:"clone",value:function(){var t={offsetX:this.offsetX,offsetY:this.offsetY,border:this.border,paddingX:this.paddingX,paddingY:this.paddingY,showRelationLine:this.showRelationLine,template:this.template,title:this.title,image:this.image,signMode:this.signMode,signRenderMode:this.signRenderMode,signType:this.signType,templateUrl:this.templateUrl,signImage:this.signImage,domStr:this.domStr,visible:this.visible,scale:this.scale,minVisibleLevel:this.minVisibleLevel,maxVisibleLevel:this.maxVisibleLevel},e={};e=SuperMap.Util.copyAttributes(e,this.style);var i=new SuperMap.Plot.SymbolText(this.textContent,this.textPosition,e,t),o={};return o=SuperMap.Util.copyAttributes(o,this.lineStyle),i.lineStyle=o,i}},{key:"setSymbolData",value:function(){var t={};return t.textContent=this.textContent,t.textPosition=this.textPosition,t.offsetX=this.offsetX,t.offsetY=this.offsetY,t.border=this.border,t.paddingX=this.paddingX,t.paddingY=this.paddingY,t.showRelationLine=this.showRelationLine,t.template=this.template,t.title=this.title,t.signType=this.signType,t.signMode=this.signMode,t.signRenderMode=this.signRenderMode,t.signImage=this.signImage,t.domStr=this.domStr,t.scale=this.scale,t.visible=this.visible,t.minVisibleLevel=this.minVisibleLevel,t.maxVisibleLevel=this.maxVisibleLevel,null!=this.lineStyle&&(t.lineStyle={},null!=this.lineStyle.color&&(t.lineStyle.color=this.lineStyle.color),null!=this.lineStyle.lineSymbolID&&(t.lineStyle.lineSymbolID=this.lineStyle.lineSymbolID),null!=this.lineStyle.dashArray&&(t.lineStyle.dashArray=this.lineStyle.dashArray),null!=this.lineStyle.opacity&&(t.lineStyle.opacity=this.lineStyle.opacity),null!=this.lineStyle.weight&&(t.lineStyle.weight=this.lineStyle.weight)),this.image&&(t.image={},this.image.path&&(t.image.path=this.image.path),this.image.width&&(t.image.width=this.image.width),this.image.height&&(t.image.height=this.image.height),this.image.position&&(t.image.position=this.image.position)),SuperMap.Plot.AnalysisSymbol.setStyle(this.style,t,!0),t}},{key:"parseSymbolData",value:function(t){return this.textContent=t.textContent,this.textPosition=t.textPosition,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.title=t.title,this.template=t.template,this.signMode=t.signMode,this.signRenderMode=t.signRenderMode,this.signType=t.signType,this.templateUrl=t.templateUrl,this.signImage=t.signImage,this.domStr=t.domStr,this.visible=t.visible,this.scale=t.scale,this.minVisibleLevel=t.minVisibleLevel,this.maxVisibleLevel=t.maxVisibleLevel,null!=t.border&&(this.border=t.border),null!=t.paddingX&&(this.paddingX=t.paddingX),null!=t.paddingY&&(this.paddingY=t.paddingY),null!=t.showRelationLine&&(this.showRelationLine=t.showRelationLine),null!=t.lineStyle&&(null==this.lineStyle&&(this.lineStyle={}),null!=t.lineStyle.color&&(this.lineStyle.color=t.lineStyle.color),null!=t.lineStyle.lineSymbolID&&(this.lineStyle.lineSymbolID=t.lineStyle.lineSymbolID),null!=t.lineStyle.dashArray&&(this.lineStyle.dashArray=t.lineStyle.dashArray),null!=t.lineStyle.opacity&&(this.lineStyle.opacity=t.lineStyle.opacity),null!=t.lineStyle.weight&&(this.lineStyle.weight=t.lineStyle.weight)),t.image&&(null==this.image&&(this.image={}),null!=t.image.path&&(this.image.path=t.image.path),null!=t.image.width&&(this.image.width=t.image.width),null!=t.image.height&&(this.image.height=t.image.height),null!=t.image.position&&(this.image.position=t.image.position)),this.style=SuperMap.Plot.AnalysisSymbol.getStyle(t,!0),this}}])&&Te(t.prototype,e),i&&Te(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function we(t){"@babel/helpers - typeof";return(we="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ce(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Ee(o.key),o)}}function Ee(t){var e=function(t,e){if("object"!=we(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=we(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==we(e)?e:e+""}SuperMap.Plot.SymbolText=Oe;var Ie=function(){return t=function t(e,i,o,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n=n||{},this.volume=e,this.position=i,void 0!==this.position&&null!==this.position||(this.position=SuperMap.Plot.Position.TOP),this.offsetX=n.offsetX?n.offsetX:0,this.offsetY=n.offsetY?n.offsetY:0,this.width=n.width?n.width:null,this.height=n.height?n.height:null,this.style={display:"display",color:"#808080",opacity:1,weight:4,remainingVolumeColor:"#00ff00",remainingVolumeOpacity:.8,consumeVolumeColor:"#000000",consumeVolumeOpacity:.8},null!=o&&(this.style=SuperMap.Util.copyAttributes(this.style,o)),this.CLASS_NAME="SuperMap.Plot.BloodVolume"},(e=[{key:"destroy",value:function(){this.volume=null,this.position=null,this.offsetX=null,this.offsetY=null,this.width=null,this.height=null,this.style=null}},{key:"clone",value:function(){var t={offsetX:this.offsetX,offsetY:this.offsetY,width:this.width,height:this.height},e={};return e=SuperMap.Util.copyAttributes(e,this.style),new SuperMap.Plot.BloodVolume(this.volume,this.position,e,t)}},{key:"setSymbolData",value:function(){var t={};t.volume=this.volume,t.position=this.position,t.offsetX=25.4*this.offsetX/SuperMap.Plot.PlottingUtil.DPI,t.offsetY=25.4*this.offsetY/SuperMap.Plot.PlottingUtil.DPI*-1,t.width=25.4*this.width/SuperMap.Plot.PlottingUtil.DPI,t.height=25.4*this.height/SuperMap.Plot.PlottingUtil.DPI,t.visible=null!=this.style.display&&"none"!=this.style.display,t.lineWidth=25.4*this.style.weight/SuperMap.Plot.PlottingUtil.DPI;var e=SuperMap.Plot.PlottingUtil.colorStringToRGB(this.style.color);t.lineColor={alpha:255*this.style.opacity,red:e.red,green:e.green,blue:e.blue};var i=SuperMap.Plot.PlottingUtil.colorStringToRGB(this.style.remainingVolumeColor);t.remainingColor={alpha:255*this.style.remainingVolumeOpacity,red:i.red,green:i.green,blue:i.blue};var o=SuperMap.Plot.PlottingUtil.colorStringToRGB(this.style.consumeVolumeColor);return t.consumeColor={alpha:255*this.style.consumeVolumeOpacity,red:o.red,green:o.green,blue:o.blue},t}},{key:"parseSymbolData",value:function(t){return this.volume=t.volume,this.position=t.position,this.offsetX=Math.ceil(t.offsetX*SuperMap.Plot.PlottingUtil.DPI/25.4),this.offsetY=-1*Math.ceil(t.offsetY*SuperMap.Plot.PlottingUtil.DPI/25.4),null!=t.width&&(this.width=Math.ceil(t.width*SuperMap.Plot.PlottingUtil.DPI/25.4)),null!=t.height&&(this.height=Math.ceil(t.height*SuperMap.Plot.PlottingUtil.DPI/25.4)),null==this.style&&(this.style={}),null!=t.style?(null!=t.style.display&&(this.style.display=t.style.display),null!=t.style.color&&(this.style.color=t.style.color),null!=t.style.opacity&&(this.style.opacity=t.style.opacity),null!=t.style.weight&&(this.style.weight=t.style.weight),null!=t.style.remainingVolumeColor&&(this.style.remainingVolumeColor=t.style.remainingVolumeColor),null!=t.style.remainingVolumeOpacity&&(this.style.remainingVolumeOpacity=t.style.remainingVolumeOpacity),null!=t.style.consumeVolumeColor&&(this.style.consumeVolumeColor=t.style.consumeVolumeColor),t.style.consumeVolumeOpacity&&(this.style.consumeVolumeOpacity=t.style.consumeVolumeOpacity)):(null!=t.visible&&!1===t.visible&&(this.style.display="none"),null!=t.lineColor&&(this.style.color=SuperMap.Plot.PlottingUtil.colorRGBToString(t.lineColor),this.style.opacity=(t.lineColor.alpha/255).toFixed(2)),null!=t.lineWidth&&(this.style.weight=Math.ceil(t.lineWidth*SuperMap.Plot.PlottingUtil.DPI/25.4)),null!=t.remainingColor&&(this.style.remainingVolumeColor=SuperMap.Plot.PlottingUtil.colorRGBToString(t.remainingColor),this.style.remainingVolumeOpacity=(t.remainingColor.alpha/255).toFixed(2)),null!=t.consumeColor&&(this.style.consumeVolumeColor=SuperMap.Plot.PlottingUtil.colorRGBToString(t.consumeColor),this.style.consumeVolumeOpacity=(t.consumeColor.alpha/255).toFixed(2))),this}}])&&Ce(t.prototype,e),i&&Ce(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function De(t){"@babel/helpers - typeof";return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ue(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Re(o.key),o)}}function Re(t){var e=function(t,e){if("object"!=De(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=De(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==De(e)?e:e+""}SuperMap.Plot.BloodVolume=Ie;var Ne=function(){return t=function t(e,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o=o||{},this.path=e,this.position=i,void 0!==this.position&&null!==this.position||(this.position=SuperMap.Plot.Position.TOP),this.offsetX=o.offsetX?o.offsetX:0,this.offsetY=o.offsetY?o.offsetY:0,this.width=o.width?o.width:32,this.height=o.height?o.height:32,this.CLASS_NAME="SuperMap.Plot.PictureFrame"},(e=[{key:"destroy",value:function(){this.path=null,this.position=null,this.offsetX=null,this.offsetY=null,this.width=null,this.height=null}},{key:"clone",value:function(){var t={offsetX:this.offsetX,offsetY:this.offsetY,width:this.width,height:this.height};return new SuperMap.Plot.PictureFrame(this.path,this.position,t)}},{key:"setSymbolData",value:function(){var t={};return t.path=this.path,t.position=this.position,t.offsetX=this.offsetX,t.offsetY=this.offsetY,t.width=this.width,t.height=this.height,t}},{key:"parseSymbolData",value:function(t){return this.path=t.path,this.position=t.position,null!=t.offsetX&&(this.offsetX=t.offsetX),null!=t.offsetY&&(this.offsetY=t.offsetY),null!=t.width&&(this.width=t.width),null!=t.height&&(this.height=t.height),this}}])&&Ue(t.prototype,e),i&&Ue(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Be(t){"@babel/helpers - typeof";return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ke(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Fe(o.key),o)}}function Fe(t){var e=function(t,e){if("object"!=Be(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Be(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Be(e)?e:e+""}SuperMap.Plot.PictureFrame=Ne;var je=function(){return t=function t(e,i,o,n,l){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),l=l||{},this.latlngs=[],this.trajectoryLength=e,null==this.trajectoryLength&&(this.trajectoryLength=15),this.showTrackingLine=i,null==this.showTrackingLine&&(this.showTrackingLine=!0),this.showTrackingPoint=o,null==this.showTrackingPoint&&(this.showTrackingPoint=!1),this.saveTrackingPoint=null!=l.saveTrackingPoint&&l.saveTrackingPoint,this.trackingPointStyle=null!=l.trackingPointStyle?l.trackingPointStyle:0,this.trackingPointRadius=null!=l.trackingPointRadius?l.trackingPointRadius:2,this.style={color:"#ff0000",opacity:1,weight:1},null!=n&&(this.style=SuperMap.Util.copyAttributes(this.style,n)),this.CLASS_NAME="SuperMap.Plot.Trajectory"},(e=[{key:"addLatLng",value:function(t){this.latlngs.length>0&&SuperMap.Plot.PlottingUtil.equalFuzzy(t.lat,this.latlngs[this.latlngs.length-1].lat)&&SuperMap.Plot.PlottingUtil.equalFuzzy(t.lng,this.latlngs[this.latlngs.length-1].lng)||(!1===this.saveTrackingPoint&&-1!==this.trajectoryLength&&this.trajectoryLength>0?this.latlngs.length<this.trajectoryLength?this.latlngs.push(L.latLng(t.lat,t.lng)):(this.latlngs.splice(0,this.latlngs.length-this.trajectoryLength+1),this.latlngs.push(L.latLng(t.lat,t.lng))):-1!==this.trajectoryLength&&!0!==this.saveTrackingPoint||this.latlngs.push(L.latLng(t.lat,t.lng)))}},{key:"getDisplayLatLngs",value:function(t){var e=[];if("none"===this.style.display)return e;var i=[],o=0;this.trajectoryLength>0&&this.latlngs.length>this.trajectoryLength&&(o+=this.latlngs.length-this.trajectoryLength);for(var n=o;n<this.latlngs.length&&!t.contains(this.latlngs[n]);n++)if(!0===this.showTrackingLine&&n!==this.latlngs.length-1){0===i.length&&(i.push(t.getNorthWest()),i.push(t.getNorthEast()),i.push(t.getSouthEast()),i.push(t.getSouthWest()),i.push(t.getNorthWest()));for(var l=!1,s=0;s<i.length-1;s++)if(SuperMap.Plot.PlottingUtil.isCross(this.latlngs[n],this.latlngs[n+1],i[s],i[s+1])){l=!0;break}if(l)break}var a=o;for(n>o&&(a=n),n=a;n<this.latlngs.length;n++)e.push(this.latlngs[n]);return o>0&&this.latlngs.splice(0,o),e}},{key:"generateUuidKey",value:function(){return this.trackingPointStyle.toString()+"_"+this.trackingPointRadius.toString()+"_"+this.style.color+"_"+this.style.weight.toString()}},{key:"destroy",value:function(){this.latlngs.length=0,this.trajectoryLength=null,this.showTrackingLine=null,this.showTrackingPoint=null,this.saveTrackingPoint=null,this.style=null}},{key:"clone",value:function(){var t={saveTrackingPoint:this.saveTrackingPoint},e={};return e=SuperMap.Util.copyAttributes(e,this.style),new SuperMap.Plot.Trajectory(this.trajectoryLength,this.showTrackingLine,this.showTrackingPoint,e,t)}},{key:"setSymbolData",value:function(){var t={};return t.trajectoryLength=this.trajectoryLength,t.showTrackingLine=this.showTrackingLine,t.showTrackingPoint=this.showTrackingPoint,t.saveTrackingPoint=this.saveTrackingPoint,SuperMap.Plot.AnalysisSymbol.setStyle(this.style,t,!0),t}},{key:"parseSymbolData",value:function(t){return this.trajectoryLength=t.trajectoryLength,this.showTrackingLine=t.showTrackingLine,this.showTrackingPoint=t.showTrackingPoint,this.saveTrackingPoint=t.saveTrackingPoint,SuperMap.Plot.AnalysisSymbol.getStyle(t,!0),this}}])&&ke(t.prototype,e),i&&ke(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Ve(t){"@babel/helpers - typeof";return(Ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ze(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Ye(o.key),o)}}function Ye(t){var e=function(t,e){if("object"!=Ve(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ve(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ve(e)?e:e+""}SuperMap.Plot.Trajectory=je;var Ge=function(){return t=function t(e,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o=o||{},this.radius=e,this.detectionType=o.detectionType?o.detectionType:0,this.pixelRadius=o.pixelRadius?o.pixelRadius:0,this.points=o.points?o.points:0,this.style={display:"display",color:"#ff0000",opacity:1,weight:1,fill:!0,fillColor:"#ff0000",fillOpacity:.5},null!=i&&(this.style=PlottingUtil.copyAttributes(this.style,i)),this.CLASS_NAME="SuperMap.Plot.DetectionRange"},(e=[{key:"destroy",value:function(){this.pixelRadius=null,this.radius=null,this.points=null,this.style=null}},{key:"clone",value:function(){var t={points:this.points,pixelRadius:this.pixelRadius},e={};return e=SuperMap.Util.copyAttributes(e,this.style),new SuperMap.Plot.DetectionRange(this.radius,e,t)}},{key:"setSymbolData",value:function(){var t={};return t.radius=this.radius,t.pixelRadius=this.pixelRadius,t.points=this.points,null!=this.style&&(t.style={},null!=this.style.display&&(t.style.display=this.style.display),null!=this.style.color&&(t.style.color=this.style.color),null!=this.style.opacity&&(t.style.opacity=this.style.opacity),null!=this.style.weight&&(t.style.weight=this.style.weight),null!=this.style.fill&&(t.style.fill=this.style.fill),null!=this.style.fillColor&&(t.style.fillColor=this.style.fillColor),null!=this.style.fillOpacity&&(t.style.fillOpacity=this.style.fillOpacity)),t}},{key:"parseSymbolData",value:function(t){if(this.radius=t.radius,this.pixelRadius=t.pixelRadius,t.points){this.points=[];for(var e=0;e<t.points.length;e++)this.points.push(new SuperMap.Geometry.Point(t.points[e].x,t.points[e].y))}return null!=t.style&&(null==this.style&&(this.style={}),null!=t.style.display&&(this.style.display=t.style.display),null!=t.style.color&&(this.style.color=t.style.color),null!=t.style.opacity&&(this.style.opacity=t.style.opacity),null!=t.style.weight&&(this.style.weight=t.style.weight),null!=t.style.fill&&(this.style.remainingVolumeColor=t.style.fill),null!=t.style.fillColor&&(this.style.remainingVolumeOpacity=t.style.fillColor),null!=t.style.fillOpacity&&(this.style.consumeVolumeColor=t.style.fillOpacity)),this}}])&&ze(t.prototype,e),i&&ze(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function We(t){"@babel/helpers - typeof";return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Xe(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,He(o.key),o)}}function He(t){var e=function(t,e){if("object"!=We(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=We(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==We(e)?e:e+""}SuperMap.Plot.DetectionRange=Ge;var Ze=function(){return t=function t(e,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.startOrbitPoint=e,this.endOrbitPoint=i,this.type=o,this.CLASS_NAME="SuperMap.Plot.TimeWindowParameter"},(e=[{key:"destroy",value:function(){this.startOrbitPoint=null,this.endOrbitPoint=null,this.type=null}}])&&Xe(t.prototype,e),i&&Xe(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Je(t){"@babel/helpers - typeof";return(Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function qe(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Ke(o.key),o)}}function Ke(t){var e=function(t,e){if("object"!=Je(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Je(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Je(e)?e:e+""}SuperMap.Plot.TimeWindowParameter=Ze;var Qe=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.routeNodeId=e.routeNodeId?e.routeNodeId:null,this.relLineText=e.relLineText?e.relLineText:SuperMap.Plot.RelLineText.ONLEFTLINE,this.index=e.index?e.index:0,this.textContent=e.textContent?e.textContent:null,this.offsetX=e.offsetX?e.offsetX:null,this.offsetY=e.offsetY?e.offsetY:null,this.style=e.style?e.style:{fontSize:12,fontFamily:"Microsoft YaHei"},this.CLASS_NAME="SuperMap.Plot.TowardNode"}return e=t,(i=[{key:"destroy",value:function(){this.routeNodeId=null,this.relLineText=null,this.textContent=null,this.style=null}},{key:"clone",value:function(){return new t({routeNodeId:this.routeNodeId,relLineText:this.relLineText,textContent:this.textContent,style:SuperMap.Util.cloneObject(this.style)})}},{key:"parseSymbolData",value:function(t){return this.routeNodeId=t.routeNodeId,this.relLineText=t.relLineText,this.index=t.index,this.textContent=t.textContent,this.offsetX=t.offsetX,this.offsetY=t.offsetY,this.style=SuperMap.Plot.AnalysisSymbol.getStyle(t,!0),this}},{key:"setSymbolData",value:function(){var t={};return t.routeNodeId=this.routeNodeId,t.relLineText=this.relLineText,t.index=this.index,t.textContent=this.textContent,t.offsetX=this.offsetX,t.offsetY=this.offsetY,SuperMap.Util.applyDefaults(this.style,L.supermap.plotting.PlottingObject.prototype._defaultStyle),SuperMap.Plot.AnalysisSymbol.setStyle(this.style,t,!0),t}}])&&qe(e.prototype,i),o&&qe(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,i,o}();function $e(t){"@babel/helpers - typeof";return($e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ti(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ei(o.key),o)}}function ei(t){var e=function(t,e){if("object"!=$e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=$e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==$e(e)?e:e+""}SuperMap.Plot.TowardNode=Qe;var ii=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.transType=e.transType?e.transType:SuperMap.Plot.TransactionType.EDIT,this.transInfos=[],this.CLASS_NAME="SuperMap.Plot.Transaction"},(e=[{key:"destroy",value:function(){this.transInfos=null,this.transType=null}}])&&ti(t.prototype,e),i&&ti(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function oi(t){"@babel/helpers - typeof";return(oi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ni(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,li(o.key),o)}}function li(t){var e=function(t,e){if("object"!=oi(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=oi(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==oi(e)?e:e+""}SuperMap.Plot.Transaction=ii;var si=function(t,e,i){return e&&ni(t.prototype,e),i&&ni(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.layer=e.layer?e.layer:null,this.feature=e.feature?e.feature:null,this.uuid=e.uuid?e.uuid:null,this.functionName=e.functionName?e.functionName:null,this.undoParams=e.undoParams?e.undoParams:null,this.redoParams=e.redoParams?e.redoParams:null,this.propertyName=e.propertyName?e.propertyName:null,this.undoValue=e.undoValue?e.undoValue:null,this.redoValue=e.redoValue?e.redoValue:null,this.CLASS_NAME="SuperMap.Plot.TransactionInfo"});function ai(t){"@babel/helpers - typeof";return(ai="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ri(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ui(o.key),o)}}function ui(t){var e=function(t,e){if("object"!=ai(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=ai(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ai(e)?e:e+""}SuperMap.Plot.TransactionInfo=si;var pi=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.aimUuid=e.aimUuid?e.aimUuid:"",this.loop=!e.loop||e.loop,this.barkTimes=e.barkTimes?e.barkTimes:5,this.barkInterval=e.barkInterval?e.barkInterval:800,this.radius=e.radius?e.radius:30,this.radiusUnit=e.radiusUnit?e.radiusUnit:SuperMap.Plot.RadiusUnitType.PIXEL,this.style={aimTargetColor:"#0dff00",aimLineColor:"#0dff00",aimLineWeight:2,aimLineOpacity:1,aimLineDashArray:"15,15"},null!=e.style&&(this.style=SuperMap.Util.copyAttributes(this.style,e.style)),this.CLASS_NAME="SuperMap.Plot.Aim",this.effectType=SuperMap.Plot.SpecialEffectType.AIM},(e=[{key:"destroy",value:function(){this.aimUuid=null,this.loop=null,this.radius=null,this.barkTimes=null,this.barkInterval=null,this.radiusUnit=null,this.style=null,this.effectType=null}},{key:"clone",value:function(){var t=this.options;return new SuperMap.Plot.Aim(t)}}])&&ri(t.prototype,e),i&&ri(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function hi(t){"@babel/helpers - typeof";return(hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ci(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,yi(o.key),o)}}function yi(t){var e=function(t,e){if("object"!=hi(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=hi(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==hi(e)?e:e+""}SuperMap.Plot.Aim=pi;var gi=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.receiverUuid=e.receiverUuid?e.receiverUuid:"",this.dashSpeed=e.dashSpeed?e.dashSpeed:30,this.style={weight:4,movePathColor:"red",movePathOpacity:1,staticPathColor:"red",staticPathOpacity:.3,dashArray:"15,15"},null!=e.style&&(this.style=SuperMap.Util.copyAttributes(this.style,e.style)),this.CLASS_NAME="SuperMap.Plot.CommunicationLink",this.effectType=SuperMap.Plot.SpecialEffectType.COMMUNICATIONLINK},(e=[{key:"destroy",value:function(){this.receiverUuid=null,this.dashSpeed=null,this.style=null,this.effectType=null}},{key:"clone",value:function(){var t={receiverUuid:this.receiverUuid,dashSpeed:this.dashSpeed,style:this.style};return new SuperMap.Plot.CommunicationLink(t)}}])&&ci(t.prototype,e),i&&ci(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function fi(t){"@babel/helpers - typeof";return(fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function di(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,mi(o.key),o)}}function mi(t){var e=function(t,e){if("object"!=fi(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=fi(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==fi(e)?e:e+""}SuperMap.Plot.CommunicationLink=gi;var Si=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.loop=!!e.loop&&e.loop,this.boomTimes=e.boomTimes?e.boomTimes:2,this.CLASS_NAME="SuperMap.Plot.Boom",this.effectType=SuperMap.Plot.SpecialEffectType.BOOM},(e=[{key:"destroy",value:function(){this.loop=null,this.boomTimes=null,this.effectType=null}},{key:"clone",value:function(){var t={loop:this.loop,boomTimes:this.boomTimes};return new SuperMap.Plot.Boom(t)}}])&&di(t.prototype,e),i&&di(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Pi(t){"@babel/helpers - typeof";return(Pi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bi(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,vi(o.key),o)}}function vi(t){var e=function(t,e){if("object"!=Pi(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Pi(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Pi(e)?e:e+""}SuperMap.Plot.Boom=Si;var Li=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.durationTime=e.durationTime?e.durationTime:1e3,this.CLASS_NAME="SuperMap.Plot.Destroy",this.effectType=SuperMap.Plot.SpecialEffectType.DESTROY},(e=[{key:"destroy",value:function(){this.durationTime=null,this.effectType=null}},{key:"clone",value:function(){var t={durationTime:this.durationTime,effectType:this.effectType};return new SuperMap.Plot.Destroy(t)}}])&&bi(t.prototype,e),i&&bi(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Mi(t){"@babel/helpers - typeof";return(Mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _i(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Ai(o.key),o)}}function Ai(t){var e=function(t,e){if("object"!=Mi(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Mi(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Mi(e)?e:e+""}SuperMap.Plot.Destroy=Li;var Ti=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.startAngle=e.startAngle?e.startAngle:0,this.scanAngle=e.scanAngle?e.scanAngle:1.0471975511965976,this.loop=!e.loop||e.loop,this.period=e.period?e.period:5,this.radius=e.radius?e.radius:60,this.radiusUnit=e.radiusUnit?e.radiusUnit:SuperMap.Plot.RadiusUnitType.PIXEL,this.style={centerStyle:{fillColor:"#008B00",fillOpacity:.8,color:"#008B00",opacity:0,weight:2},circleStyle:{fillColor:"#76EE00",fillOpacity:.1,color:"#008B00",opacity:1,weight:1},scanStyle:{fillColor:"#7FFF00",fillOpacity:.5,opacity:0}},null!=e.style&&(this.style=SuperMap.Util.copyAttributes(this.style,e.style)),this.CLASS_NAME="SuperMap.Plot.ScanRadar",this.effectType=SuperMap.Plot.SpecialEffectType.SCANRADAR},(e=[{key:"destroy",value:function(){this.startAngle=null,this.scanAngle=null,this.period=null,this.loop=null,this.radius=null,this.radiusUnit=null,this.style=null,this.effectType=null}},{key:"clone",value:function(){var t={loop:this.loop,period:this.period,startAngle:this.startAngle,scanAngle:this.scanAngle,radius:this.radius,radiusUnit:this.radiusUnit,style:this.style};return new SuperMap.Plot.ScanRadar(t)}}])&&_i(t.prototype,e),i&&_i(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function xi(t){"@babel/helpers - typeof";return(xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Oi(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,wi(o.key),o)}}function wi(t){var e=function(t,e){if("object"!=xi(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=xi(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==xi(e)?e:e+""}SuperMap.Plot.ScanRadar=Ti;var Ci=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.radius=e.radius?e.radius:60,this.radiusUnit=e.radiusUnit?e.radiusUnit:SuperMap.Plot.RadiusUnitType.PIXEL,this.angle=e.angle?e.angle:40,this.scanAngle=e.scanAngle?e.scanAngle:8,this.towardsAngle=e.towardsAngle?e.towardsAngle:0,this.style={fillColor:"#87CEEB",fillOpacity:.4,color:"#4169e1",opacity:1,weight:1},null!=e.style&&(this.style=SuperMap.Util.copyAttributes(this.style,e.style)),this.scanStyle={fillColor:"#00bfff",fillOpacity:.7,color:"#00bfff",opacity:.1},null!=e.scanStyle&&(this.scanStyle=SuperMap.Util.copyAttributes(this.scanStyle,e.scanStyle)),this.CLASS_NAME="SuperMap.Plot.SectorDetectionRange",this.effectType=SuperMap.Plot.SpecialEffectType.SECTORDETECTIONRANGE},(e=[{key:"destroy",value:function(){this.radius=null,this.radiusUnit=null,this.angle=null,this.scanAngle=null,this.towardsAngle=null,this.style=null,this.scanStyle=null,this.effectType=null}},{key:"clone",value:function(){var t={radius:this.radius,radiusUnit:this.radiusUnit,angle:this.angle,scanAngle:this.scanAngle,towardsAngle:this.towardsAngle,style:this.style,scanStyle:this.scanStyle};return new SuperMap.Plot.SectorDetectionRange(t)}}])&&Oi(t.prototype,e),i&&Oi(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Ei(t){"@babel/helpers - typeof";return(Ei="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ii(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Di(o.key),o)}}function Di(t){var e=function(t,e){if("object"!=Ei(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ei(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ei(e)?e:e+""}SuperMap.Plot.SectorDetectionRange=Ci;var Ui=function(){return t=function t(e,i,o,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n=n||{},this.textContent=e,this.textPosition=void 0!=i?i:SuperMap.Plot.AnnoPosition.MIDDLE,this.style={fontColor:"#000000",fontFamily:"Microsoft YaHei",fontSize:"12",fontStroke:!1,fontStrokeColor:"#ff0000",fontStrokeWidth:"2px",fontBackground:!1,fontBackgroundColor:"#ff0000",fontShadow:!1,fontShadowColor:"#ff0000",fontShadowOffsetX:0,fontShadowOffsetY:0},null!=o&&(this.style=SuperMap.Util.copyAttributes(this.style,o)),this.offsetX=n.offsetX?n.offsetX:0,this.offsetY=n.offsetY?n.offsetY:0,this._oldOffsetX=void 0,this._oldoffsetY=void 0,this.uuid=SuperMap.Plot.PlottingUtil.generateUuid(),this._parentUuid="",this._positionPoint=void 0,this._offsetPositionPoint=void 0},(e=[{key:"destroy",value:function(){this.textContent=null,this.textPosition=null,this.style=null}},{key:"clone",value:function(){var t={offsetX:this.offsetX,offsetY:this.offsetY},e={};return e=SuperMap.Util.copyAttributes(e,this.style),new SuperMap.Plot.SymbolAnnotation(this.textContent,this.textPosition,e,t)}},{key:"getSymbolData",value:function(){var t={};return t.textContent=this.textContent,t.textPosition=this.textPosition,t.offsetX=this.offsetX,t.offsetY=this.offsetY,SuperMap.Plot.AnalysisSymbol.setStyle(this.style,t,!0),t}},{key:"parseSymbolData",value:function(t){return this.textContent=t.textContent,this.textPosition=t.textPosition,this.style=SuperMap.Plot.AnalysisSymbol.getStyle(t,!0),this.offsetX=t.offsetX,this.offsetY=t.offsetY,this}},{key:"setStyle",value:function(t){SuperMap.Util.extend(this.style,t)}},{key:"getStyle",value:function(){return this.style}}])&&Ii(t.prototype,e),i&&Ii(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Ri(t){"@babel/helpers - typeof";return(Ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ni(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Bi(o.key),o)}}function Bi(t){var e=function(t,e){if("object"!=Ri(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ri(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ri(e)?e:e+""}SuperMap.Plot.SymbolAnnotation=Ui;var ki=function(){return t=function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.feature=e,this._bounds=i},(e=[{key:"destroy",value:function(){this.feature=null}},{key:"getContext",value:function(){return this.feature._map.getRenderer(this.feature.layer)._ctx}},{key:"calculateObjectByBounds",value:function(){var t=this.feature._map.latLngToLayerPoint(L.latLng(this._bounds.getNorth(),this._bounds.getWest())),e=this.feature._map.latLngToLayerPoint(L.latLng(this._bounds.getSouth(),this._bounds.getEast())),i=this.feature._map.latLngToLayerPoint(L.latLng(this._bounds.getCenter()));if(t.x!==e.x||t.y!==e.y){var o=Math.max(t.x,e.x),n=Math.max(t.y,e.y),l=Math.min(t.x,e.x),s=Math.min(t.y,e.y);return{ptMinX:l,ptMinY:s,width:Math.abs(o-l),height:Math.abs(n-s),center:i,r:Math.abs(t.x-e.x)>Math.abs(e.y-e.y)?Math.abs(t.x-e.x):Math.abs(t.y-e.y)}}}},{key:"createGradient",value:function(){var t=null;if(this.getContext()instanceof CanvasRenderingContext2D){var e=this.calculateObjectByBounds();if("LINEAR"===this.feature.style.fillGradientMode){var i=this.getGradientDirection(this.feature.style.fillAngle);if(t=this.getContext().createLinearGradient(e.ptMinX+e.width*i.x1,e.ptMinY+e.height*i.y1,e.ptMinX+e.width*i.x2,e.ptMinY+e.height*i.y2),0===this.feature.style.fillCenterOffsetX&&0===this.feature.style.fillCenterOffsetY)t.addColorStop(0,SuperMap.Plot.PlottingUtil.colorRGBA(this.feature.style.fillColor,this.feature.style.fillOpacity)),t.addColorStop(1,SuperMap.Plot.PlottingUtil.colorRGBA(this.feature.style.fillBackColor,this.feature.style.fillOpacity));else{var o=this.feature.style.fillAngle;0===o||180===o||90===o||270===o?(t.addColorStop(0,SuperMap.Plot.PlottingUtil.colorRGBA(this.feature.style.fillBackColor,this.feature.style.fillOpacity)),0!==o&&180!==o||t.addColorStop(this.feature.style.fillCenterOffsetX,SuperMap.Plot.PlottingUtil.colorRGBA(this.feature.style.fillColor,this.feature.style.fillOpacity)),90!==o&&270!==o||t.addColorStop(this.feature.style.fillCenterOffsetY,SuperMap.Plot.PlottingUtil.colorRGBA(this.feature.style.fillColor,this.feature.style.fillOpacity)),t.addColorStop(1,SuperMap.Plot.PlottingUtil.colorRGBA(this.feature.style.fillBackColor,this.feature.style.fillOpacity))):(t.addColorStop(0,SuperMap.Plot.PlottingUtil.colorRGBA(this.feature.style.fillBackColor,this.feature.style.fillOpacity)),t.addColorStop(this.feature.style.fillCenterOffsetX>=this.feature.style.fillCenterOffsetY?this.feature.style.fillCenterOffsetX:this.feature.style.fillCenterOffsetY*Math.cos(this.feature.style.fillAngle*Math.PI/180),SuperMap.Plot.PlottingUtil.colorRGBA(this.feature.style.fillColor,this.feature.style.fillOpacity)),t.addColorStop(1,SuperMap.Plot.PlottingUtil.colorRGBA(this.feature.style.fillBackColor,this.feature.style.fillOpacity)))}}if("RADIAL"===this.feature.style.fillGradientMode){var n=this.feature.style.fillCenterOffsetX*e.r,l=this.feature.style.fillCenterOffsetY*e.r,s=e.r/Math.sqrt(2)+Math.abs(n)>e.r/Math.sqrt(2)+Math.abs(l)?e.r/Math.sqrt(2)+Math.abs(n):e.r/Math.sqrt(2)+Math.abs(l);(t=this.getContext().createRadialGradient(e.center.x+n,e.center.y-l,0,e.center.x+n,e.center.y-l,s)).addColorStop(0,SuperMap.Plot.PlottingUtil.colorRGBA(this.feature.style.fillColor,this.feature.style.fillOpacity)),this.feature.style.fillColor,this.feature.style.fillBackColor,t.addColorStop(1,SuperMap.Plot.PlottingUtil.colorRGBA(this.feature.style.fillBackColor,this.feature.style.fillOpacity))}return t}}},{key:"createTextureFill",value:function(t){if(0!==t.length){var e=document.createElement("canvas");document.body.appendChild(e);var i=e.getContext("2d");e.width=8,e.height=8;var o=e.width,n=e.height,l=SuperMap.Plot.PlottingUtil.colorStringToRGB(t[0].color);i.strokeStyle="rgba(".concat(l.red,",").concat(l.green,",").concat(l.blue,",").concat(t[0].opacity,")"),i.lineWidth=1;var s=SuperMap.Plot.PlottingUtil.colorStringToRGB(t[1].color);switch(i.fillStyle="rgba(".concat(s.red,",").concat(s.green,",").concat(s.blue,",").concat(t[1].opacity,")"),i.fillRect(0,0,e.width,e.height),i.beginPath(),t[0].fillID){case 0:case 1:break;case 2:i.moveTo(0,n),i.lineTo(o,0);break;case 3:i.moveTo(0,0),i.lineTo(o,0),i.moveTo(0,0),i.lineTo(0,n);break;case 4:i.moveTo(0,n),i.lineTo(o,0),i.moveTo(0,0),i.lineTo(o,n);break;case 5:i.moveTo(0,0),i.lineTo(o,n);break;case 6:i.moveTo(0,0),i.lineTo(o,0);break;case 7:i.moveTo(0,0),i.lineTo(0,n)}i.closePath(),i.stroke(),i.fill();var a=i.createPattern(e,"repeat");return document.body.removeChild(e),a}}},{key:"createFillMode",value:function(t){if(void 0!==this.feature.style.fillSymbolID)if(t.fill=this.feature.style.fill,t.fillSymbolID=this.feature.style.fillSymbolID,0===this.feature.style.fillSymbolID||1===this.feature.style.fillSymbolID||!0===this.feature.style.fill||!1===this.feature.style.fill)0===this.feature.style.fillSymbolID?t.fill=!0:1===this.feature.style.fillSymbolID&&(t.fill=!1),t.fillColor=this.feature.style.fillColor,t.fillOpacity=this.feature.style.fillOpacity;else if(this.feature.style.fillColor!==this.feature.style.fillBackColor||this.feature.style.fillBackOpacity>0&&this.feature.style.fillBackOpacity<1){var e=[];e.push({fillID:this.feature.style.fillSymbolID,color:this.feature.style.fillColor,opacity:this.feature.style.fillOpacity},{fillID:this.feature.style.fillSymbolID,color:this.feature.style.fillBackColor,opacity:this.feature.style.fillBackOpacity}),t.fill=!0,t.fillColor=this.createTextureFill(e),t.fillOpacity=this.feature.style.fillColor}else t.fill=!0,t.fillColor=this.feature.style.fillColor,t.fillOpacity=this.feature.style.fillOpacity;else t.fill=this.feature.style.fill,t.fillColor=this.feature.style.fillColor,t.fillOpacity=this.feature.style.fillOpacity}},{key:"getGradientDirection",value:function(t){var e=function(t){return{x:Math.cos(t),y:Math.sin(t)}},i=function(t){return t*Math.PI/180},o=e(i(180-t%360)),n=e(i(360-t%360)),l=Math.pow(2,-52);return(o.x<=0||Math.abs(o.x)<=l)&&(o.x=0),(o.y<=0||Math.abs(o.y)<=l)&&(o.y=0),(n.x<=0||Math.abs(n.x)<=l)&&(n.x=0),(n.y<=0||Math.abs(n.y)<=l)&&(n.y=0),{x1:o.x,y1:o.y,x2:n.x,y2:n.y}}}])&&Ni(t.prototype,e),i&&Ni(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Fi(t){"@babel/helpers - typeof";return(Fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ji(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Vi(o.key),o)}}function Vi(t){var e=function(t,e){if("object"!=Fi(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Fi(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Fi(e)?e:e+""}SuperMap.Plot.CalculateCanvasGradient=ki;var zi=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.feature=e},(e=[{key:"destroy",value:function(){this.feature=null}},{key:"createGradient",value:function(){var t=!1;this.feature.layer._renderer._container.defs||(this.feature.layer._renderer._container.defs=L.SVG.create("defs"),t=!0);var e=null;"LINEAR"===this.feature.style.fillGradientMode&&(e=document.getElementById("linearGradient_"+this.feature.uuid)),"RADIAL"===this.feature.style.fillGradientMode&&(e=document.getElementById("radialGradient_"+this.feature.uuid));var i=this.createGradientDirection();for("LINEAR"===this.feature.style.fillGradientMode?((e=null===e?L.SVG.create("linearGradient"):e).setAttributeNS(null,"x1",i.x1),e.setAttributeNS(null,"y1",i.y1),e.setAttributeNS(null,"x2",i.x2),e.setAttributeNS(null,"y2",i.y2)):"RADIAL"===this.feature.style.fillGradientMode&&((e=null===e?L.SVG.create("radialGradient"):e).setAttributeNS(null,"cx",i.cx),e.setAttributeNS(null,"cy",i.cy),e.setAttributeNS(null,"fx",i.fx),e.setAttributeNS(null,"fy",i.fy),e.setAttributeNS(null,"r",i.r));e.hasChildNodes();)e.removeChild(e.firstChild);for(var o=0,n=i.colors.length;o<n;o++){var l=L.SVG.create("stop");l.setAttributeNS(null,"offset",i.colors[o].offset),l.setAttributeNS(null,"style","stop-color:"+SuperMap.Plot.PlottingUtil.colorRGBA(i.colors[o].color,i.colors[o].opacity)),e.appendChild(l)}return 0===e.id.length&&e.setAttributeNS(null,"id",e.tagName+"_"+this.feature.uuid),this.feature.layer._renderer._container.defs.appendChild(e),t&&this.feature.layer._renderer._container.appendChild(this.feature.layer._renderer._container.defs),e.id}},{key:"createTextureFill",value:function(t){var e=!1;this.feature.layer._renderer._container.defs||(this.feature.layer._renderer._container.defs=L.SVG.create("defs"),e=!0);var i=document.getElementById("patternFill_"+this.feature.uuid);function o(t){var e="";return 2===t.fillID?e="rotate(-45)":3===t.fillID||6===t.fillID?e="rotate(0)":4===t.fillID||5===t.fillID?e="rotate(45)":7===t.fillID&&(e="rotate(90)"),e}function n(t,e,i){var o=L.SVG.create("path");o.setAttributeNS(null,"d",t),o.setAttributeNS(null,"stroke",i.color),o.setAttributeNS(null,"stroke-width","2"),o.setAttributeNS(null,"stroke-linecap","square"),o.setAttributeNS(null,"stroke-opacity",i.opacity),e.appendChild(o)}function l(t,e,i){var o=L.SVG.create("polygon");o.setAttributeNS(null,"points",t),o.setAttributeNS(null,"fill",i.color),o.setAttributeNS(null,"fill-opacity",i.opacity),e.appendChild(o)}return i?(i.setAttributeNS(null,"patternTransform",o(t[0]).toString()),3===t[0].fillID||6===t[0].fillID||7===t[0].fillID?(i.setAttributeNS(null,"width",7.3),i.setAttributeNS(null,"height",7.3),i.childNodes[0].setAttributeNS(null,"points","0 0 0 7.3 7.3 7.3 7.3 0"),i.childNodes[1].setAttributeNS(null,"d","M 7.3 0 L 0 0")):(i.setAttributeNS(null,"width",5.4),i.setAttributeNS(null,"height",5.4),i.childNodes[0].setAttributeNS(null,"points","0 0 0 5.4 5.4 5.4 5.4 0"),i.childNodes[1].setAttributeNS(null,"d","M 5.4 0 L 0 0")),i.childNodes[0].setAttributeNS(null,"fill",t[1].color),i.childNodes[0].setAttributeNS(null,"fill-opacity",t[1].opacity),i.childNodes[1].setAttributeNS(null,"stroke",t[0].color),i.childNodes[1].setAttributeNS(null,"stroke-opacity",t[0].opacity),3===t[0].fillID||4===t[0].fillID?(i.childNodes[2]&&(i.childNodes[2].setAttributeNS(null,"stroke",t[0].color),i.childNodes[2].setAttributeNS(null,"stroke-opacity",t[0].opacity)),3===t[0].fillID?null===i&&n("M 0 7.3 L 0 0",i,t[0]):4===t[0].fillID&&null===i&&n("M 0 5.4 L 0 0",i,t[0])):i.childNodes[2]&&i.removeChild(i.childNodes[2]),0===i.id.length&&i.setAttributeNS(null,"id","patternFill_"+this.feature.uuid),i.id):((i=null===i?L.SVG.create("pattern"):i).setAttributeNS(null,"x",0),i.setAttributeNS(null,"y",0),3===t[0].fillID||6===t[0].fillID||7===t[0].fillID?(i.setAttributeNS(null,"width",7.3),i.setAttributeNS(null,"height",7.3)):(i.setAttributeNS(null,"width",5.4),i.setAttributeNS(null,"height",5.4)),i.setAttributeNS(null,"patternUnits","userSpaceOnUse"),i.setAttributeNS(null,"patternTransform",o(t[0]).toString()),3===t[0].fillID||6===t[0].fillID||7===t[0].fillID?(l("0 0 0 7.3 7.3 7.3 7.3 0",i,t[1]),n("M 7.3 0 L 0 0",i,t[0])):(l("0 0 0 5.4 5.4 5.4 5.4 0",i,t[1]),n("M 5.4 0 L 0 0",i,t[0])),4===t[0].fillID?n("M 0 5.4 L 0 0",i,t[0]):3===t[0].fillID&&n("M 0 7.3 L 0 0",i,t[0]),this.feature.layer._renderer._container.defs.appendChild(i),e&&this.feature.layer._renderer._container.appendChild(this.feature.layer._renderer._container.defs),0===i.id.length&&i.setAttributeNS(null,"id","patternFill_"+this.feature.uuid),i.id)}},{key:"createFillMode",value:function(t){if(void 0!==this.feature.style.fillSymbolID)if(t.fill=this.feature.style.fill,t.fillSymbolID=this.feature.style.fillSymbolID,0===this.feature.style.fillSymbolID||1===this.feature.style.fillSymbolID||!0===this.feature.style.fill||!1===this.feature.style.fill)0===this.feature.style.fillSymbolID?t.fill=!0:1===this.feature.style.fillSymbolID&&(t.fill=!1),t.fillColor=this.feature.style.fillColor,t.fillOpacity=this.feature.style.fillOpacity;else if(this.feature.style.fillColor!==this.feature.style.fillBackColor||this.feature.style.fillBackOpacity>0&&this.feature.style.fillBackOpacity<1){var e=[];e.push({fillID:this.feature.style.fillSymbolID,color:this.feature.style.fillColor,opacity:this.feature.style.fillOpacity},{fillID:this.feature.style.fillSymbolID,color:this.feature.style.fillBackColor,opacity:this.feature.style.fillBackOpacity}),this.feature._map.getRenderer(this.feature.layer)instanceof L.SVG?(t.fillOpacity=1,t.fillColor="url(#"+this.createTextureFill(e)+")",t.fill=t.fillColor):new SuperMap.Plot.CalculateCanvasGradient(this.feature,this.feature.getBounds()).createTextureFill(e)}else t.fill=!0,t.fillColor=this.feature.style.fillColor,t.fillOpacity=this.feature.style.fillOpacity;else t.fill=this.feature.style.fill,t.fillColor=this.feature.style.fillColor,t.fillOpacity=this.feature.style.fillOpacity}},{key:"createGradientDirection",value:function(){var t=[];if("LINEAR"===this.feature.style.fillGradientMode){if(null!==this.feature.style.fillCenterOffsetX&&void 0!==this.feature.style.fillCenterOffsetX&&(0===this.feature.style.fillAngle||180===this.feature.style.fillAngle?(t.push({offset:0,color:this.feature.style.fillBackColor,opacity:this.feature.style.fillOpacity}),t.push({offset:this.feature.style.fillCenterOffsetX,color:this.feature.style.fillColor,opacity:this.feature.style.fillOpacity}),t.push({offset:1,color:this.feature.style.fillBackColor,opacity:this.feature.style.fillOpacity})):90===this.feature.style.fillAngle||270===this.feature.style.fillAngle?(t.push({offset:0,color:this.feature.style.fillBackColor,opacity:this.feature.style.fillOpacity}),t.push({offset:this.feature.style.fillCenterOffsetY,color:this.feature.style.fillColor,opacity:this.feature.style.fillOpacity}),t.push({offset:1,color:this.feature.style.fillBackColor,opacity:this.feature.style.fillOpacity})):(t.push({offset:0,color:this.feature.style.fillBackColor,opacity:this.feature.style.fillOpacity}),t.push({offset:this.feature.style.fillCenterOffsetX/2*(Math.sqrt(2)/2)*Math.abs(Math.sin(this.feature.style.fillAngle*Math.PI/180)),color:this.feature.style.fillColor,opacity:this.feature.style.fillOpacity}),t.push({offset:1,color:this.feature.style.fillBackColor,opacity:this.feature.style.fillOpacity}))),this.feature.style.fillAngle>=360&&(this.feature.style.fillAngle=0),0===this.feature.style.fillAngle)return{x1:0,y1:0,x2:1,y2:0,colors:t};if(90===this.feature.style.fillAngle)return{x1:0,y1:1,x2:0,y2:0,colors:t};if(180===this.feature.style.fillAngle)return{x1:1,y1:0,x2:0,y2:0,colors:t};if(270===this.feature.style.fillAngle)return{x1:0,y1:0,x2:0,y2:1,colors:t};if(0<this.feature.style.fillAngle&&this.feature.style.fillAngle<=45)return{x1:0,y1:1,x2:1,y2:(1-Math.tan(this.feature.style.fillAngle*Math.PI/180))/2,colors:t};if(45<this.feature.style.fillAngle&&this.feature.style.fillAngle<90)return{x1:0,y1:1,x2:(1-Math.tan((this.feature.style.fillAngle-45)*Math.PI/180))/2,y2:0,colors:t};if(90<this.feature.style.fillAngle&&this.feature.style.fillAngle<=135)return{x1:1,y1:1,x2:Math.tan((this.feature.style.fillAngle-90)*Math.PI/180)/2,y2:0,colors:t};if(135<this.feature.style.fillAngle&&this.feature.style.fillAngle<180)return{x1:1,y1:1,x2:0,y2:Math.tan((this.feature.style.fillAngle-135)*Math.PI/180)/2,colors:t};if(180<this.feature.style.fillAngle&&this.feature.style.fillAngle<=225)return{x1:1,y1:0,x2:0,y2:Math.tan((this.feature.style.fillAngle-180)*Math.PI/180)/2,colors:t};if(225<this.feature.style.fillAngle&&this.feature.style.fillAngle<270)return{x1:1,y1:0,x2:Math.tan((this.feature.style.fillAngle-225)*Math.PI/180)/2,y2:0,colors:t};if(270<this.feature.style.fillAngle&&this.feature.style.fillAngle<=315)return{x1:0,y1:0,x2:1-Math.tan((this.feature.style.fillAngle-270)*Math.PI/180)/2,y2:1,colors:t};if(315<this.feature.style.fillAngle&&this.feature.style.fillAngle<360)return{x1:0,y1:0,x2:1,y2:Math.tan((this.feature.style.fillAngle-315)*Math.PI/180)/2,colors:t}}else if("RADIAL"===this.feature.style.fillGradientMode)if(null!==this.feature.style.fillCenterOffsetX&&void 0!==this.feature.style.fillCenterOffsetX&&null!==this.feature.style.fillCenterOffsetY&&void 0!==this.feature.style.fillCenterOffsetY&&(t.push({offset:0,color:this.feature.style.fillColor,opacity:this.feature.style.fillOpacity}),this.feature.style.fillColor,this.feature.style.fillBackColor,t.push({offset:1,color:this.feature.style.fillBackColor,opacity:this.feature.style.fillOpacity})),this.feature.style.fillCenterOffsetX<=.5&&this.feature.style.fillCenterOffsetX>=0||this.feature.style.fillCenterOffsetX<=0&&this.feature.style.fillCenterOffsetX>=-1){if(this.feature.style.fillCenterOffsetY>=0&&this.feature.style.fillCenterOffsetY<=.5||this.feature.style.fillCenterOffsetY>=-.5&&this.feature.style.fillCenterOffsetY<=0)return{cx:.5,cy:.5,fx:.5+this.feature.style.fillCenterOffsetX,fy:.5-this.feature.style.fillCenterOffsetY,r:.5*Math.sqrt(2),colors:t};if(this.feature.style.fillCenterOffsetY>=.5&&this.feature.style.fillCenterOffsetY<=.8||this.feature.style.fillCenterOffsetY>=-.8&&this.feature.style.fillCenterOffsetY<=-.5)return{cx:.5,cy:.5,fx:.5+this.feature.style.fillCenterOffsetX,fy:.5-this.feature.style.fillCenterOffsetY,r:.8*Math.sqrt(2),colors:t};if(this.feature.style.fillCenterOffsetY>=.8&&this.feature.style.fillCenterOffsetY<=1||this.feature.style.fillCenterOffsetY>=-1&&this.feature.style.fillCenterOffsetY<=-.8)return{cx:.5,cy:.5,fx:.5+this.feature.style.fillCenterOffsetX,fy:.5-this.feature.style.fillCenterOffsetY,r:Math.sqrt(2),colors:t}}else if(this.feature.style.fillCenterOffsetX<=.8&&this.feature.style.fillCenterOffsetX>.5||this.feature.style.fillCenterOffsetX<=-.5&&this.feature.style.fillCenterOffsetX>=-.8){if(this.feature.style.fillCenterOffsetY>=0&&this.feature.style.fillCenterOffsetY<=.5||this.feature.style.fillCenterOffsetY>=-.5&&this.feature.style.fillCenterOffsetY<=0)return{cx:.5,cy:.5,fx:.5+this.feature.style.fillCenterOffsetX,fy:.5-this.feature.style.fillCenterOffsetY,r:.8*Math.sqrt(2),colors:t};if(this.feature.style.fillCenterOffsetY>=.5&&this.feature.style.fillCenterOffsetY<=.8||this.feature.style.fillCenterOffsetY>=-.8&&this.feature.style.fillCenterOffsetY<=-.5)return{cx:.5,cy:.5,fx:.5+this.feature.style.fillCenterOffsetX,fy:.5-this.feature.style.fillCenterOffsetY,r:.8*Math.sqrt(2),colors:t};if(this.feature.style.fillCenterOffsetY>=.8&&this.feature.style.fillCenterOffsetY<=1||this.feature.style.fillCenterOffsetY>=-1&&this.feature.style.fillCenterOffsetY<=-.8)return{cx:.5,cy:.5,fx:.5+this.feature.style.fillCenterOffsetX,fy:.5-this.feature.style.fillCenterOffsetY,r:Math.sqrt(2),colors:t}}else if(this.feature.style.fillCenterOffsetX<=1&&this.feature.style.fillCenterOffsetX>.8||this.feature.style.fillCenterOffsetX<=-.8&&this.feature.style.fillCenterOffsetX>=-1){if(this.feature.style.fillCenterOffsetY>=0&&this.feature.style.fillCenterOffsetY<=.5||this.feature.style.fillCenterOffsetY>=-.5&&this.feature.style.fillCenterOffsetY<=0)return{cx:.5,cy:.5,fx:.5+this.feature.style.fillCenterOffsetX,fy:.5-this.feature.style.fillCenterOffsetY,r:Math.sqrt(2),colors:t};if(this.feature.style.fillCenterOffsetY>=.5&&this.feature.style.fillCenterOffsetY<=.8||this.feature.style.fillCenterOffsetY>=-.8&&this.feature.style.fillCenterOffsetY<=-.5)return{cx:.5,cy:.5,fx:.5+this.feature.style.fillCenterOffsetX,fy:.5-this.feature.style.fillCenterOffsetY,r:Math.sqrt(2),colors:t};if(this.feature.style.fillCenterOffsetY>=.8&&this.feature.style.fillCenterOffsetY<=1||this.feature.style.fillCenterOffsetY>=-1&&this.feature.style.fillCenterOffsetY<=-.8)return{cx:.5,cy:.5,fx:.5+this.feature.style.fillCenterOffsetX,fy:.5-this.feature.style.fillCenterOffsetY,r:Math.sqrt(2),colors:t}}}}])&&ji(t.prototype,e),i&&ji(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function Yi(t){"@babel/helpers - typeof";return(Yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gi(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Wi(o.key),o)}}function Wi(t){var e=function(t,e){if("object"!=Yi(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Yi(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Yi(e)?e:e+""}function Xi(){return(Xi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Hi(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function Hi(t){return(Hi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}
/* Copyright© 2000 - 2018 SuperMap Software Co.Ltd. All rights reserved.
 * This program are made available under the terms of the Apache License, Version 2.0
 */SuperMap.Plot.CalculateSVGGradient=zi;var Zi=function(){function t(e,i,o,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=parseFloat(e),this.y=parseFloat(i),this.tag=n||0==n?parseFloat(n):null,this.type=o||"Point",this.CLASS_NAME="SuperMapAlgoPlot"}return e=t,(i=[{key:"clone",value:function(e){return null==e&&(e=new t(this.x,this.y)),SuperMap.Util.applyDefaults(e,this),e}},{key:"calculateBounds",value:function(){this.bounds=new Bounds(this.x,this.y,this.x,this.y)}},{key:"equals",value:function(t){var e=!1;return null!=t&&(e=this.x===t.x&&this.y===t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),e}},{key:"move",value:function(t,e){this.x=this.x+t,this.y=this.y+e,this.clearBounds()}},{key:"toShortString",value:function(){return this.x+", "+this.y}},{key:"destroy",value:function(){this.x=null,this.y=null,this.tag=null,Xi(Hi(t.prototype),"destroy",this).call(this)}},{key:"getVertices",value:function(t){return[this]}}])&&Gi(e.prototype,i),o&&Gi(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,i,o}();SuperMapAlgoPlot.Point=Zi;var Ji=SuperMapAlgoPlot.AnalysisSymbol=SuperMapAlgoPlot.AnalysisSymbol||{};function qi(t){"@babel/helpers - typeof";return(qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}SuperMapAlgoPlot.AnalysisSymbol.analysisBasicInfo=function(t){var e=new Object;return e.libID=t.libID,e.code=t.code,e.symbolType=t.symbolType,e.symbolName=t.symbolName,e.textContent=t.textContent,e.minEditPts=t.algoMinEditPts,e.maxEditPts=t.algoMaxEditPts,e.surroundLineType=t.surroundLineType,e},SuperMapAlgoPlot.AnalysisSymbol.analysisDotBasicInfo=function(t){var e=SuperMapAlgoPlot.PlottingUtil.DPI,i=new Object;i.anchorPoint=new SuperMapAlgoPlot.Point(t.anchorPoint.x,t.anchorPoint.y);var o=0,n=0;return void 0!==t.symbolSizeInLib?(o=Math.round(t.symbolSizeInLib.x*e/25.4/10),n=Math.round(t.symbolSizeInLib.y*e/25.4/10)):(o=Math.round(t.symbolSize.x/1.5*e/25.4/10),n=Math.round(t.symbolSize.y/1.5*e/25.4/10)),i.symbolSizeInLib=new SuperMap.Size(o,n),i.symbolSizeInLib.w=o,i.symbolSizeInLib.h=n,t.middleMarkBounds&&(i.middleMarkBounds=new SuperMap.Bounds(t.middleMarkBounds.leftBottom.x,t.middleMarkBounds.leftBottom.y,t.middleMarkBounds.rightTop.x,t.middleMarkBounds.rightTop.y)),i},SuperMapAlgoPlot.AnalysisSymbol.analysisAlgoBasicInfo=function(t,e){var i=new Object;if(i.subSymbols=[],i.scalePoints=[],i.scaleValues=[],e&&t.subSymbols)for(var o=0;o<t.subSymbols.length;o++)i.subSymbols.push(new SuperMapAlgoPlot.SubSymbol(t.libID,t.subSymbols[o]));if(t.scalePoints){i.scalePoints=[];for(var n=0;n<t.scalePoints.length;n++){var l=new SuperMapAlgoPlot.Point(t.scalePoints[n].x,t.scalePoints[n].y);l.tag=n,l.isScalePoint=!0,i.scalePoints.push(l)}}if(t.scaleValues)for(var s=0;s<t.scaleValues.length;s++)i.scaleValues.push(t.scaleValues[s]);return i},SuperMapAlgoPlot.AnalysisSymbol.analysisSymbolCells=function(t,e){var i=[];if(t&&(function(t,i){if(t.innerCells&&t.innerCells.length)for(var o=0;o<t.innerCells.length;o++){var n=t.innerCells[o];if(t.symbolIsCanFill&&n.type!==SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL){var l=new Object,s=SuperMapAlgoPlot.AnalysisSymbol.getStyle(t,e);l.type=32,l.style={fillSymbolID:s.fillSymbolID,fillColor:s.fillColor,fillOpacity:s.fillOpacity,strokeOpacity:0,strokeWidth:0,fillLimit:!1,lineColorLimit:!0,lineWidthLimit:!0},l.positionPoints=[];for(var a=0;a<n.positionPoints.length;a++){var r=new SuperMapAlgoPlot.Point(n.positionPoints[a].x,n.positionPoints[a].y);l.positionPoints.push(r)}i.push(l)}}}(t,i),t.innerCells)){var o=t.innerCells;if(0!==o.length)for(var n=0;n<o.length;n++)i.push(SuperMapAlgoPlot.AnalysisSymbol.analysisInnerCell(o[n],e))}return i},SuperMapAlgoPlot.AnalysisSymbol.analysisInnerCell=function(t,e){var i=new Object;if(i.positionPoints=[],t){if(void 0!==t.polybezierClose&&(i.polybezierClose=t.polybezierClose),i.type=t.type,i.surroundLineFlag=t.surroundLineFlag,i.textContent=t.textContent,i.style=SuperMapAlgoPlot.AnalysisSymbol.getStyle(t,e),null!=t.positionPoints)for(var o=t.positionPoints,n=0;n<o.length;n++){var l=new SuperMapAlgoPlot.Point(o[n].x,o[n].y);i.positionPoints.push(l)}if(i.style.lineColorLimit=t.lineColorLimit,i.style.lineTypeLimit=t.lineTypeLimit,i.style.lineWidthLimit=t.lineWidthLimit,i.style.fillLimit=t.fillLimit,i.style.fillColorLimit=t.fillColorLimit,i.style.fontColorLimit=t.fontColorLimit,i.style.surroundLineLimit=t.surroundLineLimit,i.style.surroundLineFlag=t.surroundLineFlag,i.style.surroundLineType=t.surroundLineType,34==t.type?i.style.fontColorLimit=!0:i.style.fontColorLimit=t.fontColorLimit,i.type===SuperMapAlgoPlot.SymbolType.RECTANGLESYMBOL){var s=i.positionPoints[0],a=i.positionPoints[1],r=s.clone(),u=new SuperMapAlgoPlot.Point(a.x,s.y),p=a.clone(),h=new SuperMapAlgoPlot.Point(s.x,a.y);i.positionPoints=[],i.positionPoints.push(r),i.positionPoints.push(u),i.positionPoints.push(p),i.positionPoints.push(h),i.type=SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL}i.type===SuperMapAlgoPlot.SymbolType.TEXTSYMBOL&&(i.style.fontSizeLimit=!0)}return i},SuperMapAlgoPlot.AnalysisSymbol.getStyle=function(t,e){function i(t){null==t.red&&(t.red=0),null==t.green&&(t.green=0),null==t.blue&&(t.blue=0);var e=t.red.toString(16);e.length<2&&(e="0"+e);var i=t.green.toString(16);i.length<2&&(i="0"+i);var o=t.blue.toString(16);return o.length<2&&(o="0"+o),"#"+e+i+o}function o(t){return"TOPLEFT"===t?"lt":"TOPCENTER"===t?"ct":"TOPRIGHT"===t?"rt":"BOTTOMLEFT"===t?"lb":"BOTTOMCENTER"===t?"cb":"BOTTOMRIGHT"===t?"rb":"MIDDLELEFT"===t?"lm":"MIDDLECENTER"===t?"cm":"MIDDLERIGHT"===t?"rm":0===t?"lt":1===t?"ct":2===t?"rt":6===t?"lb":7===t?"cb":8===t?"rb":9===t?"lm":10===t?"cm":11===t?"rm":"lt"}var n=SuperMapAlgoPlot.PlottingUtil.DPI,l={};return t.style?(e?(l.fillSymbolID=t.style.fillSymbolID,l.fillSymbolID||(l.fill=t.style.fill)):(!1===t.style.fill?t.style.fillSymbolID=1:!0===t.style.fill&&(t.style.fillSymbolID=0),l.fillSymbolID=t.style.fillSymbolID),void 0!==t.style.strokeGradientMode&&null!=t.style.strokeGradientMode?1===t.style.strokeGradientMode?l.strokeGradientMode="LINEAR":2===t.style.strokeGradientMode?l.strokeGradientMode="RADIAL":"LINEAR"!==t.style.strokeGradientMode&&"RADIAL"!==t.style.strokeGradientMode&&(l.strokeGradientMode="NONE"):l.strokeGradientMode="NONE",t.style.strokeBackColor?void 0!==t.style.strokeBackColor.red?(l.strokeBackColor=i(t.style.strokeBackColor),l.strokeBackOpacity=(t.style.strokeBackColor.alpha/255).toFixed(2)):(l.strokeBackColor=t.style.strokeBackColor,l.strokeBackOpacity=t.style.strokeBackOpacity):t.style.fillBackColor&&(void 0!==t.style.fillBackColor.red?(l.strokeBackColor=i(t.style.fillBackColor),l.strokeBackOpacity=(t.style.fillBackColor.alpha/255).toFixed(2)):(l.strokeBackColor=t.style.strokeBackColor,l.strokeBackOpacity=t.style.strokeBackOpacity)),void 0!==t.style.fillGradientMode&&null!=t.style.fillGradientMode&&(1===t.style.fillGradientMode?l.fillGradientMode="LINEAR":2===t.style.fillGradientMode?l.fillGradientMode="RADIAL":"LINEAR"!==t.style.fillGradientMode&&"RADIAL"!==t.style.fillGradientMode&&(l.fillGradientMode="NONE")),null!=t.style.fillGradientAngle&&void 0!==t.style.fillGradientAngle?l.fillAngle=t.style.fillGradientAngle:void 0!==t.style.fillAngle&&null!=t.style.fillAngle&&(l.fillAngle=t.style.fillAngle),void 0!==t.style.fillGradientOffsetRatioX&&null!=t.style.fillGradientOffsetRatioX?l.fillCenterOffsetX=t.style.fillGradientOffsetRatioX/100:void 0!==t.style.fillCenterOffsetX&&null!=t.style.fillCenterOffsetX&&(l.fillCenterOffsetX=t.style.fillCenterOffsetX/100),void 0!==t.style.fillGradientOffsetRatioY&&null!=t.style.fillGradientOffsetRatioY?l.fillCenterOffsetY=t.style.fillGradientOffsetRatioY/100:void 0!==t.style.fillCenterOffsetY&&null!=t.style.fillCenterOffsetY&&(l.fillCenterOffsetY=t.style.fillCenterOffsetY/100),void 0!==t.style.fillForeColor&&(l.fillColor=i(t.style.fillForeColor)),void 0!==t.style.fillOpaqueRate&&(l.fillOpacity=(t.style.fillOpaqueRate/100).toFixed(2),100!==t.style.fillOpaqueRate||1===t.style.fillGradientMode&&2===t.style.fillGradientMode||(l.fillOpacity=(t.style.fillForeColor.alpha/255).toFixed(2))),void 0!==t.style.fillBackColor&&(void 0!==t.style.fillBackColor.red?l.fillBackColor=i(t.style.fillBackColor):l.fillBackColor=t.style.fillBackColor),0===t.style.fillBackOpaque?l.fillBackOpacity=0:t.style.fillBackColor&&t.style.fillBackColor.alpha?l.fillBackOpacity=(t.style.fillBackColor.alpha/255).toFixed(2):l.fillBackOpacity=t.style.fillBackOpacity,void 0!==t.style.lineColor&&(!0===e?(l.color=i(t.style.lineColor),l.opacity=(t.style.lineColor.alpha/255).toFixed(2)):(l.strokeColor=i(t.style.lineColor),l.strokeOpacity=(t.style.lineColor.alpha/255).toFixed(2))),!0===e?null!=t.style.lineWidth?l.weight=Math.ceil(t.style.lineWidth*n/25.4):null!=t.style.weight&&(l.weight=t.style.weight):null!=t.style.lineWidth?l.strokeWidth=Math.ceil(t.style.lineWidth*n/25.4):null!=t.style.strokeWidth&&(l.strokeWidth=t.style.strokeWidth),e?(l.lineSymbolID=t.style.lineSymbolID,l.lineSymbolID||(l.dashArray=t.style.dashArray),!l.dashArray&&t.style.strokeDashstyle&&("dash"===t.style.strokeDashstyle?l.lineSymbolID=1:"dot"===t.style.strokeDashstyle?l.lineSymbolID=2:"dashdot"===t.style.strokeDashstyle?l.lineSymbolID=3:l.lineSymbolID=0)):1===t.style.lineSymbolID?l.strokeDashstyle="dash":2===t.style.lineSymbolID?l.strokeDashstyle="dot":3===t.style.lineSymbolID?l.strokeDashstyle="dashdot":t.style.strokeDashstyle?l.strokeDashstyle=t.style.strokeDashstyle:l.strokeDashstyle="solid",t.textStyle2D&&null!=t.textStyle2D?(void 0!==t.textStyle2D.sizeFixed&&(l.sizeFixed=t.textStyle2D.sizeFixed),void 0!==t.textStyle2D.fontName&&(l.fontFamily=t.textStyle2D.fontName),void 0!==t.textStyle2D.fontHeight&&(l.fontSize=Math.ceil(t.textStyle2D.fontHeight*n/25.4)),void 0!==t.textStyle2D.foreColor&&(l.fontColor=i(t.textStyle2D.foreColor),t.textStyle2D.foreColor.alpha?l.fontOpacity=(t.textStyle2D.foreColor.alpha/255).toFixed(2):l.fontOpacity="1"),void 0!==t.textStyle2D.align&&(l.labelAlign=o(t.textStyle2D.align)),void 0!==t.textStyle2D.rotation&&(l.labelRotation=-t.textStyle2D.rotation),null!=t.textStyle2D.bold&&(t.textStyle2D.bold?l.fontWeight="bold":l.fontWeight="normal"),l.labelXOffset=0,l.labelYOffset=0):t.textStyle&&null!=t.textStyle&&(void 0!==t.textStyle.sizeFixed&&(l.sizeFixed=t.textStyle.sizeFixed),void 0!==t.textStyle.fontName&&(l.fontFamily=t.textStyle.fontName),void 0!==t.textStyle.fontHeight&&(l.sizeFixed?l.fontSize=Math.ceil(t.textStyle.fontHeight*n/25.4):l.fontSize=t.textStyle.fontHeight),void 0!==t.textStyle.foreColor&&(l.fontColor=i(t.textStyle.foreColor),l.fontOpacity=(t.textStyle.foreColor.alpha/255).toFixed(2)),void 0!==t.textStyle.align&&(l.labelAlign=o(t.textStyle.align)),void 0!==t.textStyle.rotation&&(l.labelRotation=-t.textStyle.rotation),null!=t.textStyle.bold&&(t.textStyle.bold?l.fontWeight="bold":l.fontWeight="normal"),l.labelXOffset=0,l.labelYOffset=0),void 0!=t.style.fontStroke?l.fontStroke=t.style.fontStroke:t.textStyle2D&&null!=t.textStyle2D.outline&&(l.fontStroke=t.textStyle2D.outline),null!=t.style.fontStrokeColor?l.fontStrokeColor=t.style.fontStrokeColor:t.textStyle2D&&null!=t.textStyle2D.fontStrokeColor?l.fontStrokeColor=i(t.textStyle2D.fontStrokeColor):t.textStyle2D&&null!=t.textStyle2D.backColor&&(l.fontStrokeColor=i(t.textStyle2D.backColor)),t.textStyle2D&&null!=t.textStyle2D.outlineWidth?l.fontStrokeWidth=t.textStyle2D.outlineWidth*n/25.4:null!=l.fontStrokeWidth&&(l.fontStroke=t.style.fontStrokeWidth),void 0!==t.style.fontBackground?l.fontBackground=t.style.fontBackground:t.textStyle2D&&null!=t.textStyle2D.backOpaque&&(l.fontBackground=t.textStyle2D.backOpaque),null!=t.style.fontBackgroundColor?l.fontBackgroundColor=t.style.fontBackgroundColor:t.textStyle2D&&null!=t.textStyle2D.fontBackgroundColor?l.fontBackgroundColor=i(t.textStyle2D.fontBackgroundColor):t.textStyle2D&&null!=t.textStyle2D.backColor&&(l.fontBackgroundColor=i(t.textStyle2D.backColor)),null!=t.style.fontShadow?l.fontShadow=t.style.fontShadow:t.textStyle2D&&null!=t.textStyle2D.shadow&&(l.fontShadow=t.textStyle2D.shadow),void 0!==t.style.fontShadowColor?l.fontShadowColor=t.style.fontShadowColor:t.textStyle2D&&null!=t.textStyle2D.shadowColor&&(l.fontShadowColor=i(t.textStyle2D.shadowColor)),void 0!==t.style.fontShadowOffsetX?l.fontShadowOffsetX=t.style.fontShadowOffsetX*n/25.4:t.textStyle2D&&null!=t.textStyle2D.shadowOffsetX&&(l.fontShadowOffsetX=t.textStyle2D.shadowOffsetX*n/25.4),void 0!==t.style.fontShadowOffsetY?l.fontShadowOffsetY=t.style.fontShadowOffsetY*n/25.4:t.textStyle2D&&null!=t.textStyle2D.shadowOffsetY&&(l.fontShadowOffsetY=t.textStyle2D.shadowOffsetY*n/25.4),void 0!==t.style.fontSpace&&(l.fontSpace=t.style.fontSpace),void 0!==t.style.fontPercent&&(l.fontPercent=t.style.fontPercent),null!=t.style.fontWeight&&(l.fontWeight=t.style.fontWeight),void 0!==t.style.fontStyle&&(l.fontStyle=t.style.fontStyle),void 0!==t.surroundLineColor&&null!=t.surroundLineColor&&(l.surroundLineColor=i(t.surroundLineColor),l.surroundLineColorOpacity=(t.surroundLineColor.alpha/255).toFixed(2)),void 0!==t.surroundLineWidth2D&&null!=t.surroundLineWidth2D?l.surroundLineWidth=Math.round(t.surroundLineWidth2D*n/25.4):void 0!==t.surroundLineWidth&&null!=t.surroundLineWidth&&(l.surroundLineWidth=Math.round(t.surroundLineWidth*n/25.4)),null!=t.style.graphicWidth&&(l.graphicWidth=t.style.graphicWidth),null!=t.style.graphicHeight&&(l.graphicHeight=t.style.graphicHeight),null!=t.style.graphicOpacity&&(l.graphicOpacity=t.style.graphicOpacity),null!=t.style.graphicXOffset&&(l.graphicXOffset=t.style.graphicXOffset),null!=t.style.graphicYOffset&&(l.graphicYOffset=t.style.graphicYOffset),"none"==t.style.display?l.display="none":l.display="display",null!=t.style.contentLabelAlign&&(l.contentLabelAlign=t.style.contentLabelAlign),null!=t.style.titleFontFamily&&(l.titleFontFamily=t.style.titleFontFamily),null!=t.style.titleFontSize&&(l.titleFontSize=t.style.titleFontSize),null!=t.style.titleLabelAlign&&(l.titleLabelAlign=t.style.titleLabelAlign),null!=t.style.titleColor&&(l.titleColor=i(t.style.titleColor)),void 0!==t.style.extendHeight&&(l.extendHeight=t.style.extendHeight),l):l},SuperMapAlgoPlot.AnalysisSymbol.setStyle=function(t,e,i){var o=SuperMapAlgoPlot.PlottingUtil.DPI;if(null!=e)return e.style||(e.style={}),e.textStyle2D||(e.textStyle2D={}),i?(e.style.fillSymbolID=t.fillSymbolID,e.style.fillSymbolID||(e.style.fill=t.fill)):(!1===t.fill?t.fillSymbolID=1:!0===t.fill&&(t.fillSymbolID=0),e.style.fillSymbolID=t.fillSymbolID),null!=t.fillGradientMode&&(e.style.fillGradientMode=t.fillGradientMode),null!=t.fillGradientMode&&("LINEAR"===t.fillGradientMode?e.style.fillGradientMode=1:"RADIAL"===t.fillGradientMode?e.style.fillGradientMode=2:e.style.fillGradientMode=0),null!=t.strokeGradientMode&&("LINEAR"===t.strokeGradientMode?e.style.strokeGradientMode=1:"RADIAL"===t.strokeGradientMode?e.style.strokeGradientMode=2:e.style.strokeGradientMode=0),null!=t.strokeBackColor&&(e.style.strokeBackColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.strokeBackColor)),null!=t.strokeBackOpacity&&null!=t.strokeBackColor&&(e.style.strokeBackColor.alpha=255*t.strokeBackOpacity),null!=t.fillAngle&&void 0!==t.fillAngle&&(e.style.fillAngle=t.fillAngle,e.style.fillGradientAngle=t.fillAngle),null!=t.fillCenterOffsetX&&void 0!==t.fillCenterOffsetX&&(e.style.fillCenterOffsetX=100*t.fillCenterOffsetX,e.style.fillGradientOffsetRatioX=100*t.fillCenterOffsetX),null!=t.fillCenterOffsetY&&void 0!==t.fillCenterOffsetY&&(e.style.fillCenterOffsetY=100*t.fillCenterOffsetY,e.style.fillGradientOffsetRatioY=100*t.fillCenterOffsetY),null!=t.fillColor&&(e.style.fillForeColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.fillColor)),void 0!==t.fillOpacity&&null!=t.fillOpacity&&(e.style.fillOpaqueRate=100*t.fillOpacity,e.style.fillForeColor.alpha=255),null!=t.fillBackColor&&(e.style.fillBackColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.fillBackColor)),null!=t.fillBackOpacity&&(0===t.fillBackOpacity?(e.style.fillBackOpaque=0,e.style.fillBackColor.alpha=255):e.style.fillBackColor&&(e.style.fillBackOpaque=1,e.style.fillBackColor.alpha=255*t.fillBackOpacity)),!0===i&&t.color?e.style.lineColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.color):t.strokeColor&&(e.style.lineColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.strokeColor)),!0===i&&null!=t.opacity&&void 0!==t.opacity?(e.style.lineColor.alpha=255*t.opacity,e.style.lineColor.alpha<1&&(e.style.lineColor.alpha=1)):null!=t.strokeOpacity&&void 0!==t.strokeOpacity&&(e.style.lineColor.alpha=255*t.strokeOpacity,e.style.lineColor.alpha<1&&(e.style.lineColor.alpha=1)),!0===i&&t.weight?e.style.lineWidth=25.4*t.weight/o:t.strokeWidth&&(e.style.lineWidth=25.4*t.strokeWidth/o),i?(e.style.lineSymbolID=t.lineSymbolID,e.style.lineSymbolID||(e.style.dashArray=t.dashArray)):"dot"===t.strokeDashstyle?e.style.lineSymbolID=2:"dash"===t.strokeDashstyle||"longdash"===t.strokeDashstyle?e.style.lineSymbolID=1:"dashdot"===t.strokeDashstyle||"longdashdot"===t.strokeDashstyle?e.style.lineSymbolID=3:e.style.lineSymbolID=0,null!=t.fontFamily&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.fontName=t.fontFamily:e.textStyle&&null!=e.textStyle&&(e.textStyle.fontName=t.fontFamily)),null!=t.sizeFixed&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.sizeFixed=t.sizeFixed:e.textStyle&&null!=e.textStyle&&(e.textStyle.sizeFixed=t.sizeFixed)),null!=t.fontSize&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.fontHeight=25.4*t.fontSize/o:e.textStyle&&null!=e.textStyle&&(e.textStyle.fontHeight=25.4*t.fontSize/o)),null!=t.fontWeight&&(e.textStyle2D&&null!=e.textStyle2D?"bold"===t.fontWeight?e.textStyle2D.bold=!0:e.textStyle2D.bold=!1:e.textStyle&&null!=e.textStyle&&("bold"===t.fontWeight?e.textStyle.bold=!0:e.textStyle.bold=!1)),null!=t.fontColor&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.foreColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.fontColor):e.textStyle&&null!=e.textStyle&&(e.textStyle.foreColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.fontColor))),null!=t.fontOpacity&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.foreColor.alpha=255*t.fontOpacity:e.textStyle&&null!=e.textStyle&&(e.textStyle.foreColor.alpha=255*t.fontOpacity)),null!=t.labelRotation&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.rotation=-t.labelRotation:e.textStyle&&null!=e.textStyle&&(e.textStyle.rotation=-t.labelRotation)),void 0!==t.fontStroke&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.outline=t.fontStroke:e.textStyle&&null!=e.textStyle&&(e.textStyle.outline=t.fontStroke)),null!=t.fontStrokeColor&&(e.textStyle2D.fontStrokeColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.fontStrokeColor)),void 0!==t.fontStrokeWidth&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.outlineWidth=25.4*t.fontStrokeWidth/o:e.textStyle&&null!=e.textStyle&&(e.textStyle.outlineWidth=25.4*t.fontStrokeWidth/o)),void 0!==t.fontBackground&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.backOpaque=t.fontBackground:e.textStyle&&null!=e.textStyle&&(e.textStyle.backOpaque=t.fontBackground)),void 0!==t.fontBackgroundColor&&(e.textStyle2D.fontBackgroundColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.fontBackgroundColor)),null!=t.fontStroke&&!0===t.fontStroke?e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.backColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.fontStrokeColor):e.textStyle&&null!=e.textStyle&&(e.textStyle.backColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.fontStrokeColor)):null!=t.fontBackground&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.backColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.fontBackgroundColor):e.textStyle&&null!=e.textStyle&&(e.textStyle.backColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.fontBackgroundColor))),void 0!==t.fontShadow&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.shadow=t.fontShadow:e.textStyle&&null!=e.textStyle&&(e.textStyle.shadow=t.fontShadow)),void 0!==t.fontShadowColor&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.shadowColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.fontShadowColor):e.textStyle&&null!=e.textStyle&&(e.textStyle.shadowColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.fontShadowColor))),void 0!==t.fontShadowOffsetX&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.shadowOffsetX=25.4*t.fontShadowOffsetX/o:e.textStyle&&null!=e.textStyle&&(e.textStyle.shadowOffsetX=25.4*t.fontShadowOffsetX/o)),void 0!==t.fontShadowOffsetY&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.shadowOffsetY=25.4*t.fontShadowOffsetY/o:e.textStyle&&null!=e.textStyle&&(e.textStyle.shadowOffsetY=25.4*t.fontShadowOffsetY/o)),void 0!==t.fontSpace&&(e.style.fontSpace=t.fontSpace),void 0!==t.fontPercent&&(e.style.fontPercent=t.fontPercent),void 0!==t.fontWeight&&(e.style.fontWeight=t.fontWeight),void 0!==t.fontStyle&&(e.style.fontStyle=t.fontStyle),t.surroundLineColor&&(e.surroundLineColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.surroundLineColor)),null!=t.surroundLineColorOpacity&&void 0!==t.surroundLineColorOpacity&&(e.surroundLineColor.alpha=255*t.surroundLineColorOpacity),null!=t.surroundLineWidth&&(e.surroundLineWidth2D=25.4*t.surroundLineWidth/o),void 0!==t.labelAlign&&("lt"===t.labelAlign?e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.align=0:e.textStyle&&null!=e.textStyle&&(e.textStyle.align=0):"ct"===t.labelAlign?e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.align=1:e.textStyle&&null!=e.textStyle&&(e.textStyle.align=1):"rt"===t.labelAlign?e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.align=2:e.textStyle&&null!=e.textStyle&&(e.textStyle.align=2):"lb"===t.labelAlign?e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.align=6:e.textStyle&&null!=e.textStyle&&(e.textStyle.align=6):"cb"===t.labelAlign?e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.align=7:e.textStyle&&null!=e.textStyle&&(e.textStyle.align=7):"rb"===t.labelAlign?e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.align=8:e.textStyle&&null!=e.textStyle&&(e.textStyle.align=8):"lm"===t.labelAlign?e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.align=9:e.textStyle&&null!=e.textStyle&&(e.textStyle.align=9):"cm"===t.labelAlign?e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.align=10:e.textStyle&&null!=e.textStyle&&(e.textStyle.align=10):"rm"===t.labelAlign&&(e.textStyle2D&&null!=e.textStyle2D?e.textStyle2D.align=11:e.textStyle&&null!=e.textStyle&&(e.textStyle.align=11))),null!=t.graphicWidth&&(e.style.graphicWidth=t.graphicWidth),null!=t.graphicHeight&&(e.style.graphicHeight=t.graphicHeight),null!=t.graphicOpacity&&(e.style.graphicOpacity=t.graphicOpacity),null!=t.graphicXOffset&&(e.style.graphicXOffset=t.graphicXOffset),null!=t.graphicYOffset&&(e.style.graphicYOffset=t.graphicYOffset),t.display&&"none"===t.display?e.visible=!1:e.visible=!0,null!=t.contentLabelAlign&&(e.style.contentLabelAlign=t.contentLabelAlign),null!=t.titleFontFamily&&(e.style.titleFontFamily=t.titleFontFamily),null!=t.titleFontSize&&(e.style.titleFontSize=t.titleFontSize),null!=t.titleLabelAlign&&(e.style.titleLabelAlign=t.titleLabelAlign),null!=t.titleColor&&(e.style.titleColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(t.titleColor)),void 0!==t.extendHeight&&(e.style.extendHeight=t.extendHeight),t},SuperMapAlgoPlot.AnalysisSymbol.mergeDefaultStyleToFeature=function(t,e,i){var o,n;o=t.style,n=!0!==i?t.geometry:t,e&&!0===e.defaultFlag&&!1===n.isEdit&&(n.surroundLineType=e.surroundLineType,o.surroundLineColor=e.surroundLineColor,o.surroundLineWidth=e.surroundLineWidth,o.surroundLineColorOpacity=e.surroundLineColorOpacity,o.fillBackColor=e.fillBackColor,o.fillBackOpacity=e.fillBackOpacity,o.fillGradientMode=e.fillGradientMode,o.fillCenterOffsetX=e.fillCenterOffsetX,o.fillCenterOffsetY=e.fillCenterOffsetY,o.fillAngle=e.fillAngle,!0===i?(o.color=e.lineColor,o.weight=e.lineWidth,o.opacity=e.lineOpacity,o.lineSymbolID=e.lineType,o.lineCap=e.lineCap,o.lineJoin=e.lineJoin):(o.strokeColor=e.lineColor,o.strokeWidth=e.lineWidth,o.strokeOpacity=e.lineOpacity,o.strokeDashstyle=e.lineType,o.strokeLinecap=e.lineCap,o.strokeLinejoin=e.lineJoin),o.fillSymbolID=e.fillSymbolID,o.fillColor=e.fillColor,o.fillOpacity=e.fillOpacity,o.fontColor=e.fontColor,o.fontOpacity=e.fontOpacity,o.fontSize=e.fontSize,o.fontFamily=e.fontFamily,o.fontWeight=e.fontWeight,o.fontStyle=e.fontStyle,o.fontStroke=e.fontStroke,o.fontStrokeColor=e.fontStrokeColor,o.fontStrokeWidth=e.fontStrokeWidth,o.fontBackground=e.fontBackground,o.fontBackgroundColor=e.fontBackgroundColor,o.fontShadow=e.fontShadow,o.fontShadowColor=e.fontShadowColor,o.fontShadowOffsetX=e.fontShadowOffsetX,o.fontShadowOffsetY=e.fontShadowOffsetY,o.fontSpace=e.fontSpace,o.fontPercent=e.fontPercent,o.strokeGradientMode=e.strokeGradientMode,o.strokeBackColor=e.strokeBackColor,o.strokeBackOpacity=e.strokeBackOpacity);for(var l=0;l<t.subSymbols.length;l++)null===t.subSymbols[l].lineColor&&(t.subSymbols[l].lineColor=o.color),null===t.subSymbols[l].width2D&&(t.subSymbols[l].width2D=o.weight)},SuperMapAlgoPlot.AnalysisSymbol.mergeSymbolDataAndServerData=function(t,e){Object.prototype.hasOwnProperty.call(t,"algoMinEditPts")||(t.algoMinEditPts=e.algoMinEditPts),Object.prototype.hasOwnProperty.call(t,"algoMaxEditPts")||(t.algoMaxEditPts=e.algoMaxEditPts),Object.prototype.hasOwnProperty.call(t,"innerCells")||(t.innerCells=SuperMap.Util.cloneObject(e.innerCells)),Object.prototype.hasOwnProperty.call(t,"symbolRanks")||(t.symbolRanks=SuperMap.Util.cloneObject(e.symbolRanks)),Object.prototype.hasOwnProperty.call(t,"symbolSizeInLib")||(t.symbolSizeInLib=SuperMap.Util.cloneObject(e.symbolSize)),Object.prototype.hasOwnProperty.call(t,"middleMarkExist")||(t.middleMarkExist=SuperMap.Util.cloneObject(e.middleMarkExist)),Object.prototype.hasOwnProperty.call(t,"middleMarkBounds")||(t.middleMarkBounds=SuperMap.Util.cloneObject(e.middleMarkBounds)),Object.prototype.hasOwnProperty.call(t,"anchorPoint")||(t.anchorPoint=SuperMap.Util.cloneObject(e.anchorPoint))},SuperMapAlgoPlot.AnalysisSymbol.setSymbolData=function(t,e,i){null==e&&(e={}),Object.prototype.hasOwnProperty.call(e,"type")||(0!=t.libID||t.code!=SuperMap.Plot.SymbolType.GROUPOBJECT&&t.code!=SuperMap.Plot.SymbolType.FLAGGROUP&&t.code!=SuperMap.Plot.SymbolType.CLUSTEROBJECT?e.type="GRAPHICOBJECT":e.type="GraphicCollection"),Object.prototype.hasOwnProperty.call(e,"version")||(e.version=2),e.isEdit=!0,e.uuid=t.uuid,e.associatedUuid=t.associatedUuid,t.isCurve&&(e.isCurve=t.isCurve),Object.prototype.hasOwnProperty.call(e,"rotate2D")?e.rotate2D.x=t.dRotate:e.rotate2D={x:t.dRotate,y:0,z:0},Object.prototype.hasOwnProperty.call(e,"scale2D")?t.code!=SuperMap.Plot.SymbolType.PICTURE||void 0===t.initialScale||1===t.initialScale.x&&t.initialScale.x===t.dScale?e.scale2D.x=t.dScale:e.scale2D.x=t.initialScale.x:t.code!=SuperMap.Plot.SymbolType.PICTURE||void 0===t.initialScale||1===t.initialScale.x&&t.initialScale.x===t.dScale?e.scale2D={x:t.dScale,y:0,z:0}:e.scale2D={x:t.initialScale.x,y:0,z:0},Object.prototype.hasOwnProperty.call(e,"dashLines"),e.dashLines=t.dashLines,Object.prototype.hasOwnProperty.call(t,"arrowHeadType")&&(e.arrowHeadType=t.arrowHeadType),Object.prototype.hasOwnProperty.call(t,"arrowBodyType")&&(e.arrowBodyType=t.arrowBodyType),Object.prototype.hasOwnProperty.call(t,"arrowTailType")&&(e.arrowTailType=t.arrowTailType),Object.prototype.hasOwnProperty.call(t,"modelScale")&&(e.modelScale=t.modelScale),e.libID=t.libID,e.code=t.code,e.algoMaxEditPts=t.maxEditPts,e.algoMinEditPts=t.minEditPts,e.symbolType=t.symbolType,e.symbolName=t.symbolName,e.annotationPosition=null!=t.annotationPosition?t.annotationPosition:t.textPosition,e.textContent=t.textContent,e.textDisplay=t.textDisplay,e.scaleByMap=t.scaleByMap,e.resolution=t.resolution,e.isLocked=t.isLocked,e.note=t.note,e.custom=t.custom,e.subSymbols=[];for(var o,n=function(){var i,n,s=t.subSymbols[l];if("string"==typeof s.lineColor){n=s.lineColor,(i={}).red=parseInt("0x"+n.slice(1,3)),i.green=parseInt("0x"+n.slice(3,5)),i.blue=parseInt("0x"+n.slice(5,7)),i.alpha=parseInt(n.slice(6),16)/255,i=i}o=25.4*s.width2D/SuperMapAlgoPlot.PlottingUtil.DPI,e.subSymbols.push({libID:s.libID,code:s.code,symbolData:s.symbolData,textContent:s.textContent,totalNum:s.totalNum,lineColor:i,width2D:o,width3D:s.width3D})},l=0;l<t.subSymbols.length;l++)n();e.extendProperty=[];for(var s=t.getExtendProperty().getPropertyCount(),a=0;a<s;a++){var r=t.getExtendProperty().getPropertyByIndex(a);e.extendProperty.push({key:r.key,value:r.value})}e.avoidRegions=[];for(var u=0;u<t.avoidRegions.length;u++){for(var p=[],h=0;h<t.avoidRegions[0].latLngs.length;h++)p.push({x:t.avoidRegions[0].getLatLngs()[h].lng,y:t.avoidRegions[0].getLatLngs()[h].lat,z:0});e.avoidRegions.push(p)}if(!0===i?SuperMapAlgoPlot.AnalysisSymbol.setStyle(t.style,e,i):null!=t.feature&&SuperMapAlgoPlot.AnalysisSymbol.setStyle(t.feature.style,e),t.symbolType===SuperMapAlgoPlot.SymbolType.AIRROUTE||t.symbolType===SuperMapAlgoPlot.SymbolType.NAVYROUTE||t.symbolType===SuperMapAlgoPlot.SymbolType.MISSILEROUTE){for(var c in e.routeNodes=[],t.routeNodes)e.routeNodes.push(t.routeNodes[c].setSymbolData());e.arrRoutePts=t.arrRoutePts,i||SuperMapAlgoPlot.AnalysisSymbol.setStyle(t.lineStyle,e)}else if(t.symbolType===SuperMapAlgoPlot.SymbolType.GROUPOBJECT||t.symbolType===SuperMapAlgoPlot.SymbolType.CLUSTEROBJECT||t.symbolType===SuperMapAlgoPlot.SymbolType.FLAGGROUP||t.symbolType===SuperMapAlgoPlot.SymbolType.NAVYDEPLOYMENT||t.symbolType===SuperMapAlgoPlot.SymbolType.AIRDEPLOYMENT){if(e.subAssociatedUuids=t.subAssociatedUuids,e.geometries=[],i)for(h=0;h<t.subObjects.length;h++)e.geometries.push(t.subObjects[h].getSymbolData());else for(var y=0;y<t.components.length;y++)e.geometries.push(t.components[y].geometry.getSymbolData());0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.FLAGGROUP?e.ratios=t.ratio:0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.AIRDEPLOYMENT?(e.colNum=t.colNum,e.speceDis=t.speceDis,e.isShowTooltip=t.isShowTooltip):0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.NAVYDEPLOYMENT?(e.colNum=t.colNum,e.speceDis=t.speceDis):0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.CLUSTEROBJECT&&(e.clusterStyle=t.style)}else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.SYMBOLTEXT){var g=[];for(var f in t.symbolTexts)g.push(t.symbolTexts[f].setSymbolData());e.symbolTexts=g,e.addFrame=t.addFrame}else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.SYMBOLTEXT1)e.space=t.space,e.offsetX=t.offsetX,e.offsetY=t.offsetY;else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.TRAJECTORY)e.trajectoryType=t.trajectoryType,e.trajectoryLength=t.trajectoryLength,e.showTrackingLine=t.showTrackingLine,e.showTrackingPoint=t.showTrackingPoint,e.trackingPointRadius=t.trackingPointRadius,e.saveTrackingPoint=t.saveTrackingPoint;else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.SATELLITE){if(Object.prototype.hasOwnProperty.call(e,"scaleValues"))for(var d=0;d<t.scaleValues.length;d++)e.scaleValues.length>d?e.scaleValues[d]=t.scaleValues[d]:e.scaleValues.push(t.scaleValues[d]);else e.scaleValues=[],e.scaleValues=t.scaleValues;e.visible=t.visible,e.orbitPoints=t.orbitPoints}else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.SATELLITETIMEWINDOWS)e.timeWindows=t.timeWindows;else{var m;m=!0===i?L.Util.latLngsToSuperMapPoints(t.getLatLngs()):t.controlPoints,t.symbolData&&"number"==typeof e.dotShowMode&&(e.dotShowMode=t.dotShowMode),t.picturePath&&(e.picturePath=t.picturePath),t.modelPath&&(e.modelPath=t.modelPath),t.symbolRank&&(e.symbolRank=t.symbolRank),e.localePoints=[];var S=m.length;t.symbolType===SuperMapAlgoPlot.SymbolType.ELLIPSESYMBOL&&(S=3);for(var P=0;P<S;P++){if(t.symbolType===SuperMapAlgoPlot.SymbolType.ELLIPSESYMBOL&&2==P&&3!=m.length){var b=new SuperMapAlgoPlot.Point((m[0].x+m[1].x)/2,(m[0].y+m[1].y)/2),v=SuperMapAlgoPlot.PlottingUtil.distance(m[0],m[1])/2,M=SuperMapAlgoPlot.PlottingUtil.circlePoint(b,v,v,90);e.localePoints.push({x:M.x,y:M.y,z:0});break}null!=t.arrZ&&t.arrZ.length>P?e.localePoints.push({x:m[P].x,y:m[P].y,z:t.arrZ[P]}):e.localePoints.push({x:m[P].x,y:m[P].y,z:0})}if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.LINERELATION)e.endAssociation=t.endAssociatedUuid,e.lineRelationType=t.lineRelationType,e.startAssociation=t.startAssociatedUuid,e.subSectionCount=t.subSectionCount;else if(0!==t.libID||t.symbolType!==SuperMapAlgoPlot.SymbolType.PICTURE&&t.symbolType!==SuperMapAlgoPlot.SymbolType.MODELPLOT&&3e3!==t.symbolType)if(t.symbolType===SuperMapAlgoPlot.SymbolType.DOTSYMBOL){e.surroundLineType=t.surroundLineType,e.symbolRank=t.symbolRank,e.negativeImage=t.negativeImage,e.horizontalMirror=t.horizontalMirror,e.verticalMirror=t.verticalMirror,e.space=25.4*t.space/SuperMapAlgoPlot.PlottingUtil.DPI,e.flagTextSize=t.flagTextSize,e.maxScale=t.maxScale,e.minScale=t.minScale,e.actualScale=t.actualScale,void 0!==t.fontSize&&(e.fontSize=t.fontSize),void 0!==t.strokeWidth&&(e.strokeWidth=t.strokeWidth);var _=25.4*t.symbolSize.w*10/SuperMapAlgoPlot.PlottingUtil.DPI,A=25.4*t.symbolSize.h*10/SuperMapAlgoPlot.PlottingUtil.DPI;e.symbolSize={x:_,y:A};var T=25.4*t.symbolSizeInLib.w*10/SuperMapAlgoPlot.PlottingUtil.DPI,x=25.4*t.symbolSizeInLib.h*10/SuperMapAlgoPlot.PlottingUtil.DPI;if(e.symbolSizeInLib={x:T,y:x},e.positionOffset=t.positionOffset,e.positionOffsetType=t.positionOffsetType,e.positionOffsetX=25.4*t.positionOffsetX*10/SuperMapAlgoPlot.PlottingUtil.DPI,e.positionOffsetY=25.4*t.positionOffsetY*10/SuperMapAlgoPlot.PlottingUtil.DPI*-1,!1===t.widthHeightLimit||!0===t.widthHeightLimit?e.limitWidthHeight=t.widthHeightLimit:e.limitWidthHeight=t.limitWidthHeight,e.symbolTexts=[],null!=t.symbolTexts&&0!=t.symbolTexts.length)for(var O=0;O<t.symbolTexts.length;O++)e.symbolTexts.push(t.symbolTexts[O].setSymbolData());if(e.bloodVolumes=[],null!=t.bloodVolumes&&0!=t.bloodVolumes.length)for(var w=0;w<t.bloodVolumes.length;w++)e.bloodVolumes.push(t.bloodVolumes[w].setSymbolData());if(e.pictureFrames=[],null!=t.pictureFrames&&0!=t.pictureFrames.length)for(var C=0;C<t.pictureFrames.length;C++)e.pictureFrames.push(t.pictureFrames[C].setSymbolData());null!=t.trajectory&&(e.trajectory=t.trajectory.setSymbolData()),null!=e.antoRotation&&(t.antoRotation=e.antoRotation)}else{if(e.surroundLineType=t.surroundLineType,Object.prototype.hasOwnProperty.call(e,"scaleValues"))for(var E=0;E<t.scaleValues.length;E++)e.scaleValues.length>E?e.scaleValues[E]=t.scaleValues[E]:e.scaleValues.push(t.scaleValues[E]);else e.scaleValues=[],e.scaleValues=t.scaleValues;e.subSymbolScaleValue=t.subSymbolScaleValue,e.baseScale=t.baseScale,e.strokeWidth=t.strokeWidth,e.polylineConnectLocationPoint=t.polylineConnectLocationPoint,void 0!==t.isClampToGround&&(e.isClampToGround=t.isClampToGround),22===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.ALGOSYMBOL?(e.arrowHeadType=t.arrowHeadType,e.arrowBodyType=t.arrowBodyType,e.arrowTailType=t.arrowTailType):0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.ARROWLINE?e.arrowAngle=t.arrowAngle:0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.COMBINATIONALCIRCLE?e.defaultRadius=t.defaultRadius:0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.CONCENTRICCIRCLE||(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.LINEMARKING?(e.islocationCircle=t.islocationCircle,e.textBoxType=t.textBoxType):0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.SYMBOLTEXTBOX?(e.roundBox=t.roundBox,e.textBoxType=t.textBoxType):0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.PATHTEXT?(e.isAvoid=t.isAvoid,e.isCurve=t.isCurve,e.relLineText=t.relLineText,e.showPathLine=t.showPathLine,e.textToLineDistance=t.textToLineDistance,e.showPathLineArrow=t.showPathLineArrow):0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.ARCREGION&&(i?(e.centerPoint={x:t.centerPoint.lng,y:t.centerPoint.lat},e.circlePts=t.circlePts,e.spatialAnalystUrl=t.spatialAnalystUrl):e.centerPoint=t.centerPoint,e.endAngle=t.endAngle,e.radius=t.radius,e.radiusPosAngle=t.radiusPosAngle,e.startAngle=t.startAngle,e.textPosition=t.textPosition,e.radiusLineType=t.radiusLineType,e.radiusText=t.radiusText))}else{if(e.path=t.path,t.symbolType===SuperMapAlgoPlot.SymbolType.PICTURE?e.picturePath=t.picturePath:t.symbolType===SuperMapAlgoPlot.SymbolType.MODELPLOT&&(e.modelPath=t.modelPath),e.symbolTexts=[],null!=t.symbolTexts&&0!=t.symbolTexts.length)for(var I=0;I<t.symbolTexts.length;I++)e.symbolTexts.push(t.symbolTexts[I].setSymbolData());if(e.bloodVolumes=[],null!=t.bloodVolumes&&0!=t.bloodVolumes.length)for(var D=0;D<t.bloodVolumes.length;D++)e.bloodVolumes.push(t.bloodVolumes[D].setSymbolData());null!=t.trajectory&&(e.trajectory=t.trajectory.setSymbolData()),null!=e.antoRotation&&(t.antoRotation=e.antoRotation)}}t.symbolData=e},SuperMapAlgoPlot.AnalysisSymbol.parseSymbolData=function(t,e,i){if(null!=e){if(null!=e.isEdit&&(t.isEdit=e.isEdit),Object.prototype.hasOwnProperty.call(e,"version")&&(t.version=e.version),Object.prototype.hasOwnProperty.call(e,"libID")&&(t.libID=parseInt(e.libID)),Object.prototype.hasOwnProperty.call(e,"code")&&(t.code=parseInt(e.code)),Object.prototype.hasOwnProperty.call(e,"algoMaxEditPts")&&(t.maxEditPts=parseInt(e.algoMaxEditPts)),Object.prototype.hasOwnProperty.call(e,"algoMinEditPts")&&(t.minEditPts=parseInt(e.algoMinEditPts)),Object.prototype.hasOwnProperty.call(e,"symbolType")&&(t.symbolType=parseInt(e.symbolType)),Object.prototype.hasOwnProperty.call(e,"symbolName")&&(t.symbolName=e.symbolName),Object.prototype.hasOwnProperty.call(e,"isCurve")&&(t.isCurve=e.isCurve),Object.prototype.hasOwnProperty.call(e,"textContent")&&(t.textContent=e.textContent),Object.prototype.hasOwnProperty.call(e,"bubbleHeight")&&(t.bubbleHeight=e.bubbleHeight),Object.prototype.hasOwnProperty.call(e,"bubbleWidth")&&(t.bubbleWidth=e.bubbleWidth),Object.prototype.hasOwnProperty.call(e,"description")&&(t.description=e.description),Object.prototype.hasOwnProperty.call(e,"mediaList")&&(t.mediaList=e.mediaList),null!=e.dScale?t.dScale=e.dScale:void 0!==e.scale2D&&(t.dScale=e.scale2D.x),null!=e.dRotate?t.dRotate=e.dRotate:e.rotate2D&&(t.dRotate=e.rotate2D.x),null!=e.resolution&&(t.resolution=e.resolution),null!=e.uuid&&(t.uuid=e.uuid),null!=e.associatedUuid&&(t.associatedUuid=e.associatedUuid),null!=e.textDisplay&&(t.textDisplay=e.textDisplay),null!=e.annotationPosition&&(i?t.annotationPosition=e.annotationPosition:t.textPosition=e.annotationPosition),null!=e.scaleByMap&&(t.scaleByMap=e.scaleByMap),void 0!==e.isLocked&&(t.isLocked=e.isLocked),void 0!==e.note&&(t.note=e.note),void 0!==e.custom&&(t.custom=e.custom),e.extendProperty)for(var o=0;o<e.extendProperty.length;o++){var n=e.extendProperty[o];t.extendProperty.addProperty(n.key,n.value)}if(Object.prototype.hasOwnProperty.call(e,"subSymbols")&&null!=e.subSymbols){t.subSymbols=[];for(var l=0;l<e.subSymbols.length;l++){var s=e.subSymbols[l].libID;void 0===s&&(s=t.libID);var a=e.subSymbols[l].code;if(void 0!==a){var r={};void 0!==e.subSymbols[l].textContent&&(r.textContent=e.subSymbols[l].textContent),void 0!==e.subSymbols[l].totalNum&&(r.totalNum=e.subSymbols[l].totalNum),void 0!==e.subSymbols[l].symbolData&&(r.symbolData=e.subSymbols[l].symbolData),void 0!==e.subSymbols[l].lineColor&&null!==e.subSymbols[l].lineColor&&("string"!=typeof e.subSymbols[l].lineColor?r.lineColor=SuperMapAlgoPlot.PlottingUtil.colorRGBToString(e.subSymbols[l].lineColor):r.lineColor=e.subSymbols[l].lineColor),void 0!==e.subSymbols[l].width2D&&(r.width2D=Math.ceil(e.subSymbols[l].width2D*SuperMapAlgoPlot.PlottingUtil.DPI/25.4)),void 0!==e.subSymbols[l].width3D&&(r.width3D=e.subSymbols[l].width3D),t.subSymbols.push(new SuperMapAlgoPlot.SubSymbol(s,a,r))}}}if(e.avoidRegions&&0!==e.avoidRegions.length)for(var u=0;u<e.avoidRegions.length;u++){var p=null;if(Object.prototype.hasOwnProperty.call(e.avoidRegions[u][0],"controlPoints")){var h={libID:0,code:SuperMapAlgoPlot.SymbolType.AVOIDREGION,map:t.map,symbolData:e.avoidRegions[u][0]};if(i)(p=L.supermap.plotting.avoidRegion(0,SuperMapAlgoPlot.SymbolType.AVOIDREGION,[],h)).style=SuperMapAlgoPlot.AnalysisSymbol.getStyle(t.symbolData.avoidRegions[u][1],!0);else{p=new SuperMap.Geometry.AvoidRegion(h);var c=new SuperMap.Feature.Vector(p);c.style=SuperMapAlgoPlot.AnalysisSymbol.getStyle(e.avoidRegions[u][1],i),p.feature=c,p.calculateParts()}}else{for(var y=[],g=0;g<e.avoidRegions[u].length;g++)y.push(new SuperMapAlgoPlot.Point(e.avoidRegions[u][g].x,e.avoidRegions[u][g].y));if(i){var f={libID:0,code:SuperMapAlgoPlot.SymbolType.AVOIDREGION,map:t.map,latLngs:L.Util.superMapPointsToLatLngs(y)};p=L.supermap.plotting.avoidRegion(0,SuperMapAlgoPlot.SymbolType.AVOIDREGION,[],f)}else{var d={libID:0,code:SuperMapAlgoPlot.SymbolType.AVOIDREGION,map:t.map,controlPoints:y};p=new SuperMap.Geometry.AvoidRegion(d);var m=new SuperMap.Feature.Vector(p);p.feature=m,p.calculateParts()}}t.avoidRegions.push(p)}if(!0===i){var S=SuperMapAlgoPlot.AnalysisSymbol.getStyle(e,!0);SuperMap.Util.applyDefaults(S,t.style),t.style=S}if(t.symbolType===SuperMapAlgoPlot.SymbolType.AIRROUTE||t.symbolType===SuperMapAlgoPlot.SymbolType.NAVYROUTE||t.symbolType===SuperMapAlgoPlot.SymbolType.MISSILEROUTE){for(var P in t.routeNodes=[],e.routeNodes){var b=new SuperMapAlgoPlot.RouteNode;t.routeNodes.push(b.parseSymbolData(e.routeNodes[P]))}t.arrRoutePts=[];for(var v=0;v<e.arrRoutePts.length;v++){for(var M=[],_=0;_<e.arrRoutePts[v].length;_++)Object.prototype.hasOwnProperty.call(e.arrRoutePts[v][_],"lat")&&Object.prototype.hasOwnProperty.call(e.arrRoutePts[v][_],"lng")?M.push(new SuperMapAlgoPlot.Point(e.arrRoutePts[v][_].lng,e.arrRoutePts[v][_].lat)):void 0===e.arrRoutePts[v][_].x&&void 0===e.arrRoutePts[v][_].y||M.push(new SuperMapAlgoPlot.Point(e.arrRoutePts[v][_].x,e.arrRoutePts[v][_].y));i&&(M=L.Util.superMapPointsToLatLngs(M)),t.arrRoutePts.push(M)}i||(t.lineStyle=SuperMapAlgoPlot.AnalysisSymbol.getStyle(e,!1))}else if(t.symbolType===SuperMapAlgoPlot.SymbolType.GROUPOBJECT||t.symbolType===SuperMapAlgoPlot.SymbolType.CLUSTEROBJECT||t.symbolType===SuperMapAlgoPlot.SymbolType.FLAGGROUP||t.symbolType===SuperMapAlgoPlot.SymbolType.NAVYDEPLOYMENT||t.symbolType===SuperMapAlgoPlot.SymbolType.AIRDEPLOYMENT){if(null!=e.subAssociatedUuids&&(t.subAssociatedUuids=e.subAssociatedUuids),null!=e.geometries)if(i){for(var A=[],T=0;T<e.geometries.length;T++){var x=e.geometries[T];x.uuid=SuperMapAlgoPlot.PlottingUtil.generateUuid();var O=L.supermap.plotting.PlottingObject.createSymbol(x.libID,x.code,null,{symbolData:x});A.push(O)}t.subObjects=A}else for(var w=0;w<e.geometries.length;w++){var C=e.geometries[w],E=SuperMap.Geometry.PlottingGeometry.createFeature(C.libID,C.code,null,{symbolData:C,map:t.map});E.geometry.ownGroupObj=t,t.components.push(E)}else if(i){A=[];for(var I=0;I<e.subFeatures.length;I++){var D=e.subFeatures[I];D.uuid=SuperMapAlgoPlot.PlottingUtil.generateUuid();var U=L.supermap.plotting.PlottingObject.createSymbol(D.libID,D.code,null,{symbolData:D});A.push(U)}t.subObjects=A}else for(var R=0;R<e.subFeatures.length;R++){var N=e.subFeatures[R],B=SuperMap.Geometry.PlottingGeometry.createFeature(N.libID,N.code,null,{symbolData:N,map:t.map});B.geometry.ownGroupObj=t,t.components.push(B)}0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.FLAGGROUP&&(null!=e.ratios?t.ratios=e.ratios:null!=e.ratio&&(t.ratios=e.ratio)),0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.AIRDEPLOYMENT&&(t.colNum=e.colNum,t.speceDis=e.speceDis,t.isShowTooltip=e.isShowTooltip),0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.NAVYDEPLOYMENT&&(t.colNum=e.colNum,t.speceDis=e.speceDis),0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.CLUSTEROBJECT&&(t.clusterStyle=e.clusterStyle)}else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.SYMBOLTEXT){t.addFrame=e.addFrame,t.symbolTexts=[];for(var k=0,F=e.symbolTexts.length;k<F;k++){var j=new SuperMapAlgoPlot.SymbolText;j.parseSymbolData(e.symbolTexts[k]),t.symbolTexts.push(j)}}else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.SYMBOLTEXT1)void 0!==e.space&&(t.space=e.space),void 0!==e.offsetX&&(t.offsetX=e.offsetX),void 0!==e.offsetY&&(t.offsetY=e.offsetY);else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.TRAJECTORY)void 0!==e.trajectoryType&&(t.trajectoryType=e.trajectoryType),void 0!==e.trajectoryLength&&(t.trajectoryLength=e.trajectoryLength),void 0!==e.showTrackingLine&&(t.showTrackingLine=e.showTrackingLine),void 0!==e.showTrackingPoint&&(t.showTrackingPoint=e.showTrackingPoint),void 0!==e.trackingPointRadius&&(t.trackingPointRadius=e.trackingPointRadius),void 0!==e.saveTrackingPoint&&(t.saveTrackingPoint=e.saveTrackingPoint);else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.SATELLITE){if(e.scaleValues&&0!==e.scaleValues.length){t.scaleValues=[];for(var V=0;V<e.scaleValues.length;V++)t.scaleValues.push(e.scaleValues[V])}if(e.subSymbol&&(t.subSymbols=[e.subSymbol]),t.visible=e.visible,e.orbitPoints){t.orbitPoints=[];for(var z=0;z<e.orbitPoints.length;z++)t.orbitPoints.push(new SuperMapAlgoPlot.OrbitPoint(e.orbitPoints[z].x,e.orbitPoints[z].y,e.orbitPoints[z].z,e.orbitPoints[z].number,e.orbitPoints[z].time))}}else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.SATELLITETIMEWINDOWS){t.timeWindows=e.timeWindows;for(var Y=0;Y<t.timeWindows.length;Y++)"Time"!==e.type&&"number"!==e.type||(t.timeWindows[Y].type=e.type)}else{if(e.localePoints){t.controlPoints=[],t.arrZ=[];for(var G=0;G<e.localePoints.length;G++)t.controlPoints.push(new SuperMapAlgoPlot.Point(e.localePoints[G].x,e.localePoints[G].y)),null!=e.localePoints[G].z?t.arrZ.push(e.localePoints[G].z):t.arrZ.push(0);!0===i&&(t.latLngs=L.Util.superMapPointsToLatLngs(t.controlPoints),delete t.controlPoints)}if(e.modelPath&&(t.modelPath=e.modelPath),e.picturePath&&(t.picturePath=e.picturePath),e.symbolType==SuperMapAlgoPlot.SymbolType.PICTURE||e.symbolType==SuperMapAlgoPlot.SymbolType.MODELPLOT)if(e.symbolType==SuperMapAlgoPlot.SymbolType.PICTURE){if(e.pictureSymbolSize){var W=e.pictureSymbolSize.x;e.pictureSymbolSize.x!==e.pictureSymbolSize.y&&(W=Math.max(e.pictureSymbolSize.x,e.pictureSymbolSize.y)),t.style.graphicHeight=W,t.style.graphicWidth=W}}else e.modelScale&&(t.modelScale=e.modelScale,t.initialScale.x=e.modelScale,t.dScale=e.modelScale),e.modelRotate&&t.setRotate(e.modelRotate.z);if("number"==typeof e.dotShowMode&&(t.dotShowMode=e.dotShowMode),e.symbolRank&&(t.symbolData.symbolRank=e.symbolRank),0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.LINERELATION)null!=e.startAssociation?t.startAssociatedUuid=e.startAssociation:null!=e.startAssociatedUuid&&(t.startAssociatedUuid=e.startAssociatedUuid),null!=e.endAssociation?t.endAssociatedUuid=e.endAssociation:null!=e.endAssociatedUuid&&(t.endAssociatedUuid=e.endAssociatedUuid),null!=e.lineRelationType&&(t.lineRelationType=e.lineRelationType),null!=e.subSectionCount&&(t.subSectionCount=e.subSectionCount);else if(0!==t.libID||t.symbolType!==SuperMapAlgoPlot.SymbolType.PICTURE&&t.symbolType!==SuperMapAlgoPlot.SymbolType.MODELPLOT&&3e3!==t.symbolType)if(t.symbolType===SuperMapAlgoPlot.SymbolType.DOTSYMBOL){t.surroundLineType=e.surroundLineType,t.symbolRank=e.symbolRank,t.negativeImage=e.negativeImage,t.horizontalMirror=e.horizontalMirror,t.verticalMirror=e.verticalMirror;var X=SuperMapAlgoPlot.AnalysisSymbol.analysisDotBasicInfo(e);if(t.anchorPoint=X.anchorPoint,t.symbolSizeInLib=X.symbolSizeInLib,t.middleMarkBounds=X.middleMarkBounds,void 0!==e.actualScale&&(t.actualScale=e.actualScale),void 0!==e.limitWidthHeight&&(t.limitWidthHeight=e.limitWidthHeight),void 0!==e.fontSize&&(t.fontSize=e.fontSize),void 0!==e.strokeWidth&&(t.strokeWidth=e.strokeWidth),void 0!==e.space&&(t.space=e.space*SuperMapAlgoPlot.PlottingUtil.DPI/25.4),void 0!==e.flagTextSize&&(t.flagTextSize=e.flagTextSize),void 0!==e.maxScale&&(t.maxScale=e.maxScale),void 0!==e.minScale&&(t.minScale=e.minScale),!1!==t.isEdit){var H={x:0,y:0};-1===e.symbolSize.x&&-1===e.symbolSize.x?(H.x=e.symbolSizeInLib.x*SuperMapAlgoPlot.PlottingUtil.DPI/25.4/10,H.y=e.symbolSizeInLib.y*SuperMapAlgoPlot.PlottingUtil.DPI/25.4/10):(H.x=e.symbolSize.x*SuperMapAlgoPlot.PlottingUtil.DPI/25.4/10,H.y=e.symbolSize.y*SuperMapAlgoPlot.PlottingUtil.DPI/25.4/10),void 0===e.isIntegrate&&(e.isIntegrate=!1),t.setSymbolSize(H.x,H.y,!1,e.isIntegrate)}if(void 0!==e.positionOffset&&null!==e.positionOffset&&(t.positionOffset=e.positionOffset),void 0!==e.positionOffsetType&&null!==e.positionOffsetType&&(t.positionOffsetType=e.positionOffsetType),void 0!==e.positionOffsetX&&null!==e.positionOffsetX&&(t.positionOffsetX=e.positionOffsetX*SuperMapAlgoPlot.PlottingUtil.DPI/25.4/10),void 0!==e.positionOffsetY&&null!==e.positionOffsetY&&(t.positionOffsetY=e.positionOffsetY*SuperMapAlgoPlot.PlottingUtil.DPI/25.4/10*-1),null!=e.symbolTexts&&0!==e.symbolTexts.length){t.symbolTexts=[];for(var Z=0;Z<e.symbolTexts.length;Z++){var J=new SuperMapAlgoPlot.SymbolText;J.parseSymbolData(e.symbolTexts[Z]),t.symbolTexts.push(J)}}if(null!=e.bloodVolumes&&0!==e.bloodVolumes.length){t.bloodVolumes=[];for(var q=0;q<e.bloodVolumes.length;q++){var K=new SuperMapAlgoPlot.BloodVolume;K.parseSymbolData(e.bloodVolumes[q]),t.bloodVolumes.push(K)}}if(null!=e.pictureFrames&&0!==e.pictureFrames.length){t.pictureFrames=[];for(var Q=0;Q<e.pictureFrames.length;Q++){var $=new SuperMapAlgoPlot.PictureFrame;$.parseSymbolData(e.pictureFrames[Q]),t.pictureFrames.push($)}}if(null!=e.trajectory){var tt=new SuperMapAlgoPlot.Trajectory;tt.parseSymbolData(e.trajectory),t.trajectory=tt}null!=e.antoRotation&&(t.antoRotation=e.antoRotation)}else{if(t.surroundLineType=e.surroundLineType,e.scaleValues&&0!==e.scaleValues.length){t.scaleValues=[];for(var et=0;et<e.scaleValues.length;et++)t.scaleValues.push(e.scaleValues[et])}if(void 0!==e.isClampToGround&&(t.isClampToGround=e.isClampToGround),void 0!==e.strokeWidth&&null!==e.strokeWidth&&(t.strokeWidth=e.strokeWidth),void 0!==e.baseScale&&null!==e.baseScale&&(t.baseScale=e.baseScale),void 0!==e.polylineConnectLocationPoint&&null!==e.polylineConnectLocationPoint&&(t.polylineConnectLocationPoint=e.polylineConnectLocationPoint),22===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.ALGOSYMBOL)void 0!==e.arrowHeadType&&null!==e.arrowHeadType&&(t.arrowHeadType=e.arrowHeadType),void 0!==e.arrowBodyType&&null!==e.arrowBodyType&&(t.arrowBodyType=e.arrowBodyType),void 0!==e.arrowTailType&&null!==e.arrowTailType&&(t.arrowTailType=e.arrowTailType);else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.ARROWLINE)t.arrowAngle=e.arrowAngle,void 0!==e.arrowTypeStart&&(t.scaleValues[1]=e.arrowTypeStart),void 0!==e.arrowTypeEnd&&(t.scaleValues[2]=e.arrowTypeEnd);else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.COMBINATIONALCIRCLE){if(e.radius&&0!==e.radius.length&&0===t.scaleValues.length)for(var it=0;it<e.radius.length;it++)t.scaleValues.push(e.radius[it])}else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.CONCENTRICCIRCLE)Object.prototype.hasOwnProperty.call(t.symbolData,"startAngle")&&(t.scaleValues[0]=t.symbolData.startAngle),Object.prototype.hasOwnProperty.call(t.symbolData,"endAngle")&&(t.scaleValues[1]=t.symbolData.endAngle);else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.LINEMARKING)void 0!==e.islocationCircle&&null!==e.islocationCircle&&(t.islocationCircle=e.islocationCircle),void 0!==e.textBoxType&&null!==e.textBoxType&&(t.textBoxType=e.textBoxType),e.tipPoint&&(this.scaleValues[1]=e.tipPoint.x,this.scaleValues[2]=e.tipPoint.y);else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.SYMBOLTEXTBOX)void 0!==e.roundBox&&null!==e.roundBox&&(t.roundBox=e.roundBox),void 0!==e.textBoxType&&null!==e.textBoxType&&(t.textBoxType=e.textBoxType),e.tipPoint&&(this.scaleValues[1]=e.tipPoint.x,this.scaleValues[2]=e.tipPoint.y);else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.ANNOFRAMESYMBOLM)e.tipPoint1&&(this.scaleValues[0]=e.tipPoint1.x,this.scaleValues[1]=e.tipPoint1.y),e.tipPoint2&&(this.scaleValues[2]=e.tipPoint2.x,this.scaleValues[3]=e.tipPoint2.y);else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.PATHTEXT)t.isAvoid=e.isAvoid,t.isCurve=e.isCurve,t.relLineText=e.relLineText,t.showPathLine=e.showPathLine,t.textToLineDistance=e.textToLineDistance,t.showPathLineArrow=e.showPathLineArrow;else if(0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.ARCREGION){if(i){if(t.centerPoint=L.latLng(e.centerPoint.y,e.centerPoint.x),t.symbolData.circlePts){for(var ot=[],nt=0;nt<e.circlePts.length;nt++)ot.push(new SuperMapAlgoPlot.Point(e.circlePts[nt].x,e.circlePts[nt].y));0!==ot.length&&(t.circlePts=ot)}t.spatialAnalystUrl=e.spatialAnalystUrl}else t.centerPoint=new SuperMapAlgoPlot.Point(e.centerPoint.x,e.centerPoint.y);t.endAngle=e.endAngle,t.radius=e.radius,t.radiusPosAngle=e.radiusPosAngle,t.startAngle=e.startAngle,t.textPosition=e.textPosition,t.radiusLineType=e.radiusLineType,t.radiusText=e.radiusText}else 0===t.libID&&t.symbolType===SuperMapAlgoPlot.SymbolType.POLYGONREGION&&(Object.prototype.hasOwnProperty.call(t.symbolData,"textPosition")?t.scaleValues[1]=t.symbolData.textPosition:void 0===t.scaleValues[1]&&(t.scaleValues[1]=t.symbolData.annotationPosition))}else{if(t.path=e.path,null!=e.symbolTexts&&0!==e.symbolTexts.length){t.symbolTexts=[];for(var lt=0;lt<e.symbolTexts.length;lt++){var st=new SuperMapAlgoPlot.SymbolText;st.parseSymbolData(e.symbolTexts[lt]),t.symbolTexts.push(st)}}if(null!=e.bloodVolumes&&0!==e.bloodVolumes.length){t.bloodVolumes=[];for(var at=0;at<e.bloodVolumes.length;at++){var rt=new SuperMapAlgoPlot.BloodVolume;rt.parseSymbolData(e.bloodVolumes[at]),t.bloodVolumes.push(rt)}}if(null!=e.trajectory){var ut=new SuperMapAlgoPlot.Trajectory;ut.parseSymbolData(e.trajectory),t.trajectory=ut}null!=e.antoRotation&&(t.antoRotation=e.antoRotation)}}}};var Ki=SuperMapAlgoPlot.PlottingUtil=SuperMapAlgoPlot.PlottingUtil||{};SuperMapAlgoPlot.PlottingUtil.DEFAULT_PRECISION=14,SuperMapAlgoPlot.PlottingUtil.DPI=96,SuperMapAlgoPlot.PlottingUtil.RTOD=57.29577951308232,SuperMapAlgoPlot.PlottingUtil.DTOR=.017453292519943295,SuperMapAlgoPlot.PlottingUtil.dirAngle=function(t,e){var i,o,n,l;i=e.x,o=e.y,n=i-t.x,l=o-t.y;var s=Math.atan2(l,n);return s<0&&(s+=2*Math.PI),s},SuperMapAlgoPlot.PlottingUtil.generateUuid=function(){for(var t=[],e=0;e<36;e++)t[e]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]="0123456789abcdef".substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")},SuperMapAlgoPlot.PlottingUtil.cloneObject=function(t){return JSON.parse(JSON.stringify(t))},SuperMapAlgoPlot.PlottingUtil.colorRGBA=function(t,e){var i=t.substring(1,3),o=parseInt(i,16),n=t.substring(3,5),l=parseInt(n,16),s=t.substring(5);return"rgba("+o+","+l+","+parseInt(s,16)+","+e+")"},SuperMapAlgoPlot.PlottingUtil.colorRGBToString=function(t){var e=t.red.toString(16);e.length<2&&(e="0"+e);var i=t.green.toString(16);i.length<2&&(i="0"+i);var o=t.blue.toString(16);return o.length<2&&(o="0"+o),"#"+e+i+o},SuperMapAlgoPlot.PlottingUtil.colorStringToRGB=function(t){var e={},i=t.substring(1,3);e.red=parseInt(i,16);var o=t.substring(3,5);e.green=parseInt(o,16);var n=t.substring(5);return e.blue=parseInt(n,16),e},SuperMapAlgoPlot.PlottingUtil.decimalToHex=function(t){for(var e=t.toString(16);e.length<8;)e="0"+e;var i=e.substring(0,2),o=e.substring(2,4),n=e.substring(4,6);return{color:"#"+e.substring(6)+n+o,alpha:parseInt(i,16)/255}},SuperMapAlgoPlot.PlottingUtil.hexToDecimal=function(t,e){var i=t.substring(1,3),o=t.substring(3,5),n=t.substring(5),l=parseInt(n+o+i,16),s=Math.round(255*e).toString(16);return parseInt(s+"000000",16)+l},SuperMapAlgoPlot.PlottingUtil.getAlign=function(t){return"TOPLEFT"===t?"lt":"TOPCENTER"===t?"ct":"TOPRIGHT"===t?"rt":"BOTTOMLEFT"===t?"lb":"BOTTOMCENTER"===t?"cb":"BOTTOMRIGHT"===t?"rb":"MIDDLELEFT"===t?"lm":"MIDDLECENTER"===t?"cm":"MIDDLERIGHT"===t?"rm":"lt"},SuperMapAlgoPlot.PlottingUtil.trim=function(t){return null==t?"":t.replace(/(^\s*)|(\s*$)/g,"")},SuperMapAlgoPlot.PlottingUtil.getTextWidth=function(t,e){e=e instanceof Array?e[0].replace(new RegExp(" ","g"),"_"):e.replace(new RegExp(" ","g"),"_");var i=1;t.fontSize<12&&(i=t.fontSize/12);var o=document.createElement("span");document.body.appendChild(o),o.style.width="auto",o.style.height="auto",t.fontStyle&&(o.style.fontStyle=t.fontStyle),t.fontSize&&(o.style.fontSize=new String(t.fontSize)+"px"),t.fontFamily&&(o.style.fontFamily=t.fontFamily),t.fontWeight&&(o.style.fontWeight=t.fontWeight),o.style.position="absolute",o.style.visibility="hidden",o.style.display="inline-block",o.innerHTML=e;var n=o.clientWidth,l=e.length;return null!=t.fontSpace&&null!=t.fontPercent?n=t.fontPercent/100*n+t.fontSpace*(t.fontPercent/100)*(l-1):null==t.fontSpace&&null!=t.fontPercent?n=t.fontPercent/100*n:null!=t.fontSpace&&null==t.fontPercent&&(n+=t.fontSpace*(l-1)),document.body.removeChild(o),n*i},SuperMapAlgoPlot.PlottingUtil.getTextCount=function(t){for(var e=0,i=0,o=0;o<t.length;o++)t.charCodeAt(o)>255?e++:i++;return e+i/2},SuperMapAlgoPlot.PlottingUtil.toJSON=function(t){var e=t;if(null==e)return null;switch(e.constructor){case String:return e=(e=(e=(e=(e=(e=(e='"'+e.replace(/(["\\])/g,"\\$1")+'"').replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace("<","&lt;")).replace(">","&gt;")).replace(/%/g,"%2525")).replace(/&/g,"%26");case Array:for(var i=[],o=0,n=e.length;o<n;o++)i.push(SuperMapAlgoPlot.PlottingUtil.toJSON(e[o]));return"["+i.join(",")+"]";case Number:return isFinite(e)?String(e):null;case Boolean:return String(e);case Date:return"{'__type':\"System.DateTime\",'Year':"+e.getFullYear()+",'Month':"+(e.getMonth()+1)+",'Day':"+e.getDate()+",'Hour':"+e.getHours()+",'Minute':"+e.getMinutes()+",'Second':"+e.getSeconds()+",'Millisecond':"+e.getMilliseconds()+",'TimezoneOffset':"+e.getTimezoneOffset()+"}";default:if(null!=e.toJSON&&"function"==typeof e.toJSON)return e.toJSON();if("object"===qi(e)){if(e.length){for(var l=[],s=0,a=e.length;s<a;s++)l.push(SuperMapAlgoPlot.PlottingUtil.toJSON(e[s]));return"["+l.join(",")+"]"}var r=[];for(var u in e)"function"!=typeof e[u]&&"CLASS_NAME"!==u&&"parent"!==u&&r.push('"'+u+'":'+SuperMapAlgoPlot.PlottingUtil.toJSON(e[u]));return r.length>0?"{"+r.join(",")+"}":"{}"}return e.toString()}},SuperMapAlgoPlot.PlottingUtil.copyFeature=function(t){var e=null;if(null!=t&&t.geometry){var i=t.geometry.clone();e=new SuperMap.Feature.Vector(i),t.style&&(e.style=SuperMapAlgoPlot.PlottingUtil.copyAttributes(e.style,t.style)),i.feature=e,i.calculateParts()}return e},SuperMapAlgoPlot.PlottingUtil.inverse=function(t){for(var e=[],i=t.length-1;i>=0;i--)e.push(t[i]);return e},SuperMapAlgoPlot.PlottingUtil.getSurroundLinePts=function(t,e){for(var i=[],o=[],n=0;n<t.length-1;n++){var l,s,a=[];if(!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[n].x,t[n+1].x)||!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[n].y,t[n+1].y)){a.push(t[n]),a.push(t[n+1]);var r=SuperMapAlgoPlot.PlottingUtil.parallel(a,e);if(l=r[0],s=r[1],0!=i.length){var u=SuperMapAlgoPlot.PlottingUtil.intersectLines(l,s,i[0],i[1]);if(u.isIntersectLines){var p=u.intersectPoint,h=SuperMapAlgoPlot.PlottingUtil.distance(l,s);SuperMapAlgoPlot.PlottingUtil.distance(p,s)>2*h?o.push(s):(o[o.length-1]=p,o.push(s))}else o.push(s)}else o.push(l),o.push(s);(i=[]).push(o[o.length-2]),i.push(o[o.length-1])}}if(t[0].x===t[t.length-1].x&&t[0].y===t[t.length-1].y&&1<o.length){var c=SuperMapAlgoPlot.PlottingUtil.intersectLines(o[0],o[1],o[o.length-2],o[o.length-1]);if(c.isIntersectLines){var y=c.intersectPoint;o[o.length-1]=y,o[0]=y}}return o},SuperMapAlgoPlot.PlottingUtil.copyFontStyle=function(t,e){void 0===t.labelAlign&&void 0!==e.labelAlign&&(t.labelAlign=e.labelAlign),!0!==t.fontSizeLimit&&(void 0!==e.fontSize&&(t.fontSize=e.fontSize),void 0!==e.fontWeight&&(t.fontWeight=e.fontWeight),void 0!==e.fontStyle&&(t.fontStyle=e.fontStyle),void 0!==e.fontSpace&&(t.fontSpace=e.fontSpace),void 0!==e.fontPercent&&(t.fontPercent=e.fontPercent)),t.strokeWidth=e.strokeWidth},SuperMapAlgoPlot.PlottingUtil.getDataFromServer=function(t,e,i,o,n,l,s,a){var r;if(void 0!==l&&(r=l),"undefined"!=typeof SuperMap&&void 0!==SuperMap.GetSymbolInfoService){var u=new SuperMap.GetSymbolInfoService(t);u.events.on({processCompleted:s,processFailed:a,scope:r});var p=new SuperMap.GetSymbolInfoParameters;p.libID=e,p.code=i,n&&SuperMapAlgoPlot.PlottingUtil.extend(p,n),o&&null!=o&&(SuperMapAlgoPlot.PlottingUtil.isArray(o)||(o=[o]),p.inputPoints=o),u.processAsync(p)}else if(void 0!==("undefined"==typeof SuperMap?"undefined":qi(SuperMap))&&void 0!==qi(SuperMap.REST)&&void 0!==qi(SuperMap.REST.GetSymbolInfoService)){var h=new SuperMap.REST.GetSymbolInfoService(t);h.events.on({processCompleted:s,processFailed:a,scope:r});var c=new SuperMap.REST.GetSymbolInfoParameters;if(c.libID=e,c.code=i,n&&SuperMapAlgoPlot.PlottingUtil.extend(c,n),o&&null!=o&&(SuperMapAlgoPlot.PlottingUtil.isArray(o)||(o=[o]),c.inputPoints=o),n&&n.credential){var y=n.credential;h.processAsync(c,y)}else h.processAsync(c)}},SuperMapAlgoPlot.PlottingUtil.innerOutlineDir=function(t){function e(t,e){function i(t){var e=Math.atan2(t.y,t.x);return e<0&&(e+=2*Math.PI),e}var o=i(e)-i(t);return o<-Math.PI&&(o+=2*Math.PI),o>Math.PI&&(o-=2*Math.PI),o}if(t.length<3)return 1;for(var i=0,o={x:0,y:0},n={x:0,y:0},l=2;l<t.length;l++)n.x=t[l].x-t[l-1].x,n.y=t[l].y-t[l-1].y,o.x=t[l-1].x-t[l-2].x,o.y=t[l-1].y-t[l-2].y,i+=e(o,n);return n.x=t[1].x-t[0].x,n.y=t[1].y-t[0].y,o.x=t[0].x-t[t.length-1].x,o.y=t[0].y-t[t.length-1].y,(i+=e(o,n))>=0?-1:1},SuperMapAlgoPlot.PlottingUtil.isNear=function(t,e){return e||(e=SuperMapAlgoPlot.PlottingUtil.TORLERANCE_STATIC),t<e&&t>-e},SuperMapAlgoPlot.PlottingUtil.equalFuzzy=function(t,e,i){return i||(i=1e-18),Math.abs(t-e)<=i},SuperMapAlgoPlot.PlottingUtil.intersectLines=function(t,e,i,o){var n={isIntersectLines:!1};if(t.x===e.x&&t.y===e.y||i.x===o.x&&i.y===o.y)return n;var l=e.x-t.x,s=e.y-t.y,a=o.x-i.x,r=o.y-i.y,u=l*r-a*s;if(SuperMapAlgoPlot.PlottingUtil.isNear(u))return n;var p=(l*(t.y-i.y)-s*(t.x-i.x))/u,h=new SuperMapAlgoPlot.Point(0,0);return h.x=p*a+i.x,h.y=p*r+i.y,n.isIntersectLines=!0,n.intersectPoint=h,n},SuperMap.Plot.PlottingUtil.limitSigDigs=function(t,e){var i=0;if(e>0){var o=new Number(t);i=parseFloat(o.toPrecision(e))}return i},SuperMap.Plot.PlottingUtil.containsPoint=function(t,e){for(var i=SuperMap.Plot.PlottingUtil.getPolygonCenterPt(t.components),o=SuperMap.Plot.PlottingUtil.distance(i,e),n=0,l=SuperMap.Plot.PlottingUtil.radian(e,t.components[0]),s=1;s<t.components.length;s++){var a=SuperMap.Plot.PlottingUtil.radian(e,t.components[s]);l>a&&(l=a,n=s)}return o<SuperMap.Plot.PlottingUtil.distance(i,t.components[n])},SuperMap.Plot.PlottingUtil.intersects=function(t,e){var i=!1;if("SuperMap.Geometry.Point"===e.CLASS_NAME)i=t.containsPoint(e);else if("SuperMap.Geometry.LineString"===e.CLASS_NAME)i=e.intersects(t);else if("SuperMap.Geometry.LinearRing"===e.CLASS_NAME)i=SuperMap.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var o=0,n=e.components.length;o<n&&!(i=e.components[o].intersects(this));++o);return i},SuperMapAlgoPlot.PlottingUtil.getEnvelopePoints=function(t){function e(t,e){if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(t[i].x!==e[i].x||t[i].y!==e[i].y)return!1;return!0}function i(t,e,i){for(var o=0;o<t.length;o++)if(SuperMap.Plot.PlottingUtil.containsPoint(t[o].components[0],e))return i.index=o,!0;return!1}function o(t,e,i){for(var o=t.components[0].components,n=new SuperMapAlgoPlot.Point(0,0),l=0;l<o.length-1;l++)if(SuperMapAlgoPlot.PlottingUtil.intersectLineSegs(e,i,o[l],o[l+1],n))return n;return null}function n(t,e){if(0===t.length||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(e[0].x,e[e.length-1].x,.5)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(e[0].y,e[e.length-1].y,.5))return e;for(var i=e[e.length-1],o=0;o<t.length;o++)if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[o][0].x,i.x,.5)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[o][0].y,i.y,.5)){e=e.concat(t[o]),t.splice(o,1);var l=n(t,e);if(void 0!==l&&0!==l.length)return l}else if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[o][t[o].length-1].x,i.x,.5)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[o][t[o].length-1].y,i.y,.5)){for(var s=t[o].length-1;s>=0;s--)e.push(t[o][s]);t.splice(o,1);var a=n(t,e);if(void 0!==a&&0!==a.length)return a}return e}if(SuperMapAlgoPlot.PlottingUtil.isArray(t)||(t=[t]),0===t.length)return[];if(1===t.length)return t[0];for(var l=0;l<t.length;l++)for(var s=l+1;s<t.length;)e(t[l],t[s])?t.splice(s,1):s++;for(var a=[],r=0;r<t.length;r++)a.push(new SuperMap.Geometry.Polygon([new SuperMap.Geometry.LinearRing(t[r])]));for(var u=[],p=0;p<t.length;p++){var h=[],c=[],y=-1,g=-1,f=a.slice();f.splice(p,1);for(var d={},m=0;m<t[p].length;m++)if(i(f,t[p][m],d)){if(0!==c.length){var S=o(a[d.index],t[p][m-1],t[p][m]);S&&S!==t[p][m-1]&&S!==t[p][m]&&c.push(S),h.push(c),c=[]}}else{if(0===m&&(y=h.length),m===t[p].length-1&&(g=h.length),0===c.length&&void 0!==d.index){var P=o(a[d.index],t[p][m-1],t[p][m]);P&&P!==t[p][m-1]&&P!==t[p][m]&&c.push(P)}c.push(t[p][m].clone())}if(0!==c.length&&h.push(c),y<h.length&&g<h.length&&y!==g){for(var b=0;b<h[y].length;b++)h[g].push(h[y][b]);h.splice(y,1)}u=u.concat(h)}for(var v=[];0!==u.length;){var L=u[0];u.splice(0,1);var M=n(u,L);void 0!==M&&(L=M),L.length>2&&v.push(L)}return v},SuperMapAlgoPlot.PlottingUtil.isRight=function(t,e,i){var o=e,n=i,l=e,s=t;return(n.x-o.x)*(s.y-l.y)-(s.x-l.x)*(n.y-o.y)<0},SuperMapAlgoPlot.PlottingUtil.radian=function(t,e){var i,o,n=0;return i=e.x-t.x,o=e.y-t.y,(n=Math.atan2(o,i))<0&&(n+=2*Math.PI),n},SuperMapAlgoPlot.PlottingUtil.findBisectorPoint=function(t,e,i,o){var n=SuperMapAlgoPlot.PlottingUtil.radian(e,t),l=(n+SuperMapAlgoPlot.PlottingUtil.radian(e,i))/2,s=Math.cos(l-n+Math.PI/2),a=o;SuperMapAlgoPlot.PlottingUtil.isNear(s,.15)||(a=o/s);var r=e.x+a*Math.cos(l),u=e.y+a*Math.sin(l);return new SuperMapAlgoPlot.Point(r,u)},SuperMapAlgoPlot.PlottingUtil.findPoint=function(t,e,i,o){if(t===e||Math.abs(i)<1e-18)return t;var n=SuperMapAlgoPlot.PlottingUtil.radian(t,e)+o*Math.PI/180,l=t.x+i*Math.cos(n),s=t.y+i*Math.sin(n);return new SuperMapAlgoPlot.Point(l,s)},SuperMapAlgoPlot.PlottingUtil.isSameQuadrant=function(t,e,i,o){var n=(e.x-t.x)*(o.x-i.x),l=(e.y-t.y)*(o.y-i.y);return!(Math.abs(n)<1e-18&&Math.abs(l)<1e-18)&&((n>0||Math.abs(n)<1e-18)&&(l>0||Math.abs(l)<1e-18))},SuperMapAlgoPlot.PlottingUtil.isCross=function(t,e,i,o){var n=new SuperMapAlgoPlot.Point(0,0);return!(!SuperMapAlgoPlot.PlottingUtil.intersectLineSegs(t,e,i,o,n)||n==t||n===e||n===i||n==o)},SuperMapAlgoPlot.PlottingUtil.intersectLineSegs=function(t,e,i,o,n){if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t.x,e.x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t.y,e.y))return n.x=t.x,n.y=t.y,!1;if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(i.x,o.x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(i.y,o.y))return n.x=i.x,n.y=i.y,!1;var l=0,s=0;if(l=t.x>e.x?t.x:e.x,s=t.x<e.x?t.x:e.x,i.x-l>1e-16&&o.x-l>1e-16||i.x-s<-1e-16&&o.x-s<-1e-16)return!1;if(l=t.y>e.y?t.y:e.y,s=t.y<e.y?t.y:e.y,i.y-l>1e-16&&o.y-l>1e-16||i.y-s<-1e-16&&o.y-s<-1e-16)return!1;var a=e.x-t.x,r=e.y-t.y,u=o.x-i.x,p=o.y-i.y,h=t.x-i.x,c=t.y-i.y,y=a*p-u*r,g=y;if(Math.abs(a)>1e-18&&Math.abs(u)>1e-18&&(g/=a*u),Math.abs(g)<1e-18)return t===i?(n.x=t.x,n.y=t.y,!SuperMapAlgoPlot.PlottingUtil.isSameQuadrant(t,e,i,o)):e===o?(n.x=e.x,n.y=e.y,!SuperMapAlgoPlot.PlottingUtil.isSameQuadrant(t,e,i,o)):t===o?(n.x=t.x,n.y=t.y,SuperMapAlgoPlot.PlottingUtil.isSameQuadrant(t,e,i,o)):e===i&&(n.x=e.x,n.y=e.y,SuperMapAlgoPlot.PlottingUtil.isSameQuadrant(t,e,i,o));var f=(a*c-r*h)/y,d=(u*c-p*h)/y;return!(f<0&&(Math.abs(f*u)>1e-16||Math.abs(f*p)>1e-16))&&(!(f>1&&(Math.abs((f-1)*u)>1e-16||Math.abs((f-1)*p)>1e-16))&&(!(d<0&&(Math.abs(d*a)>1e-16||Math.abs(d*r)>1e-16))&&(!(d>1&&(Math.abs((d-1)*a)>1e-16||Math.abs((d-1)*r)>1e-16))&&(Math.abs(f)<1e-18?(n.x=i.x,n.y=i.y,!0):Math.abs(f-1)<1e-18?(n.x=o.x,n.y=o.y,!0):Math.abs(d)<1e-18?(n.x=t.x,n.y=t.y,!0):Math.abs(d-1)<1e-18?(n.x=e.x,n.y=e.y,!0):!(f<0&&(Math.abs(f*u)>1e-16||Math.abs(f*p)>1e-16))&&(!(f>1&&(Math.abs((f-1)*u)>1e-16||Math.abs((f-1)*p)>1e-16))&&(!(d<0&&(Math.abs(d*a)>1e-16||Math.abs(d*r)>1e-16))&&(!(d>1&&(Math.abs((d-1)*a)>1e-16||Math.abs((d-1)*r)>1e-16))&&(n.x=f*u+i.x,n.y=f*p+i.y,!0))))))))},SuperMapAlgoPlot.PlottingUtil.parallel=function(t,e){var i=[],o=t.length;if(!t||null==t||t.length<2)return i;var n=!1;t.length>3&&t[0].x===t[t.length-1].x&&t[0].y===t[t.length-1].y&&(n=!0),n?(i[0]=SuperMapAlgoPlot.PlottingUtil.findBisectorPoint(t[t.length-2],t[0],t[1],e),i[t.length-1]=i[0]):(i[0]=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],e,90),i[t.length-1]=SuperMapAlgoPlot.PlottingUtil.findPoint(t[t.length-1],t[t.length-2],-e,90));for(var l=t[0],s=t[1],a=t[1],r=1;r<t.length-1;r++)if(s=t[r],t[r]!==t[r-1]&&(l=t[r-1]),t[r]!==t[r+1]){a=t[r+1];var u=SuperMapAlgoPlot.PlottingUtil.findBisectorPoint(l,s,a,e);SuperMapAlgoPlot.PlottingUtil.isCross(l,i[r-1],s,u)&&(u=i[r-1]),i[r]=u}else{for(var p=r;p<o-1;){if(t[p]!==t[p+1]){a=t[p+1];break}p++}if(p<o-1){var h=SuperMapAlgoPlot.PlottingUtil.FindBisectorPoint(l,s,a,e);for(SuperMapAlgoPlot.PlottingUtil.isCross(l,i[r-1],s,h)&&(h=i[r-1]);r<p;)i[r]=h,r++;r=p-1}}return i},SuperMapAlgoPlot.PlottingUtil.distance=function(t,e){var i=[];i.push(t),i.push(e);var o=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(i).pts;if(0===o.length){var n=i[0],l=i[1];return Math.sqrt((n.x-l.x)*(n.x-l.x)+(n.y-l.y)*(n.y-l.y))}var s=o[0],a=o[1];return Math.sqrt((s.x-a.x)*(s.x-a.x)+(s.y-a.y)*(s.y-a.y))},SuperMapAlgoPlot.PlottingUtil.projectPoint=function(t,e,i){if(e===i)return e;var o=new SuperMapAlgoPlot.Point(0,0),n=i.x-e.x,l=e.y-i.y,s=n*n,a=l*l,r=n*l,u=n*n+l*l;return o.x=(r*(e.y-t.y)+e.x*a+t.x*s)/u,o.y=(r*(e.x-t.x)+e.y*s+t.y*a)/u,o},SuperMapAlgoPlot.PlottingUtil.pointToLineDis=function(t,e,i){var o=SuperMapAlgoPlot.PlottingUtil.projectPoint(t,e,i);return SuperMapAlgoPlot.PlottingUtil.distance(t,o)},SuperMapAlgoPlot.PlottingUtil.pointToPloyLineDis=function(t,e,i){if(e===i)return SuperMapAlgoPlot.PlottingUtil.distance(t,e);var o=(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y),n=(i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y),l=(e.x-i.x)*(e.x-i.x)+(e.y-i.y)*(e.y-i.y),s=(o+l-n)/(2*l);s<0?s=0:s>1&&(s=1);var a=(i.x-e.x)*s+e.x,r=(i.y-e.y)*s+e.y,u=(a-t.x)*(a-t.x)+(r-t.y)*(r-t.y);return Math.sqrt(u)},SuperMapAlgoPlot.PlottingUtil.isCounterClockwise=function(t,e,i){return(i.x-e.x)*(t.y-e.y)-(t.x-e.x)*(i.y-e.y)>0},SuperMapAlgoPlot.PlottingUtil.clearSamePts=function(t){for(var e=t.length,i=0;i<e-1;)SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[i].x,t[i+1].x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[i].y,t[i+1].y)?(t.splice(i,1),e--):i++;return t},SuperMapAlgoPlot.PlottingUtil.getBeizerCtrlPt=function(t){var e=[],i=t.length;if(i<3)for(var o=0;o<i;++o)e[o]=t[o].clone();else{for(var n=0,l=0;l<3*i-2;l+=3)e[l]=t[n].clone(),e[l+1]=new SuperMapAlgoPlot.Point(0,0),e[l+2]=new SuperMapAlgoPlot.Point(0,0),n++;for(var s=1;s<i-1;s++)SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(8,3,t[s-1],t[s],t[s+1],e[3*s+1],e[3*s+2]);SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.6,e[0],e[3],e[4],e[2]),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.6,e[3*i-3],e[3*i-6],e[3*i-4],e[3*i-2]),e[1]=t[0].clone(),e[3*i-1]=t[i-1].clone()}return e},SuperMapAlgoPlot.PlottingUtil.isOnLine=function(t,e,i){if(e.x===i.x&&e.y===i.y)return!1;if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(i.x,e.x))return SuperMapAlgoPlot.PlottingUtil.equalFuzzy(i.x,t.x);if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(i.y,e.y))return SuperMapAlgoPlot.PlottingUtil.equalFuzzy(i.y,t.y);if(e.x===t.x&&e.y===t.y||t.x===i.x&&t.y===i.y)return!0;var o=(t.y-i.y)*(i.x-e.x)-(i.y-e.y)*(t.x-i.x);return(o/=(i.x-e.x)*(t.x-i.x))<1e-10&&o>1e-10},SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt=function(t,e){var i=t.slice();!0===e&&i.push(i[0]);for(var o=[],n=[],l=0;l<i.length-1;l++)i[l+1].x-i[0].x>-360&&i[l+1].x-i[0].x<-180&&o.push(l+1),i[l+1].x-i[0].x<360&&i[l+1].x-i[0].x>180&&n.push(l+1);if(n.length>o.length)for(var s=0;s<n.length;s++)i[n[s]].x=i[n[s]].x-360;else for(var a=0;a<o.length;a++)i[o[a]].x=i[o[a]].x+360;var r=SuperMapAlgoPlot.PlottingUtil.getBeizerCtrlPt(i);return SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsWithCtrlPt(r)},SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsWithCtrlPt=function(t){var e=t.length,i=[];if(t.length<3)for(var o=0;o<e;o++)i[o]=t[o].clone();else for(var n=0;n<e;n+=3)if(!(n+4>=e)){var l=t[n].x,s=t[n].y,a=t[n+2].x,r=t[n+2].y,u=t[n+4].x,p=t[n+4].y,h=t[n+3].x,c=t[n+3].y;if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(l,a,1e-10)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(s,r,1e-10)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(u,h,1e-10)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(p,c,1e-10))i.push(new SuperMapAlgoPlot.Point(l,s)),i.push(new SuperMapAlgoPlot.Point(u,p));else for(var y=0;y<=1;y+=.03125){var g,f,d,m,S=y*y,P=S*y;g=1-3*y+3*S-P,f=3*(y-2*S+P),d=3*(S-P),m=P;var b=new SuperMapAlgoPlot.Point(g*l+f*a+d*u+m*h,g*s+f*r+d*p+m*c);i.push(b)}}return i},SuperMapAlgoPlot.PlottingUtil.computeBeizerPoints0=function(t,e,i){var o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(e),n=[],l=[],s=[];if(t){l.push(e[0]);var a=i[0],r=i[1],u=e[0].x+o*a,p=e[0].y+o*r;l.push(new SuperMapAlgoPlot.Point(u,p)),n.push(new SuperMapAlgoPlot.Point(u,p));for(var h=1;h<e.length-1;h++){var c=i[4*h-2],y=i[4*h-1],g=e[h].x+o*c,f=e[h].y+o*y;l.push(new SuperMapAlgoPlot.Point(g,f)),n.push(new SuperMapAlgoPlot.Point(g,f)),l.push(new SuperMapAlgoPlot.Point(e[h].x,e[h].y)),c=i[4*h],y=i[4*h+1],g=e[h].x+o*c,f=e[h].y+o*y,l.push(new SuperMapAlgoPlot.Point(g,f)),n.push(new SuperMapAlgoPlot.Point(g,f))}var d=e.length-1;a=i[4*d-2],r=i[4*d-1],u=e[d].x+o*a,p=e[d].y+o*r,l.push(new SuperMapAlgoPlot.Point(u,p)),n.push(new SuperMapAlgoPlot.Point(u,p)),l.push(new SuperMapAlgoPlot.Point(e[d].x,e[d].y)),l.push(new SuperMapAlgoPlot.Point(e[d].x,e[d].y)),l.push(new SuperMapAlgoPlot.Point(e[d].x,e[d].y)),s=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsWithCtrlPt(l)}else{i=[];var m=(l=SuperMapAlgoPlot.PlottingUtil.getBeizerCtrlPt(e))[1].x-l[0].x,S=l[1].y-l[0].y,P=m/o,b=S/o;i.push(P),i.push(b),n.push(l[1]);for(var v=1;v<e.length-1;v++){var L=(l[3*v-1].x-l[3*v].x)/o,M=(l[3*v-1].y-l[3*v].y)/o;i.push(L),i.push(M),n.push(l[3*v-1]);var _=(l[3*v+1].x-l[3*v].x)/o,A=(l[3*v+1].y-l[3*v].y)/o;i.push(_),i.push(A),n.push(l[3*v+1])}P=(m=l[3*(e.length-1)-1].x-l[3*(e.length-1)].x)/o,b=(S=l[3*(e.length-1)-1].y-l[3*(e.length-1)].y)/o,i.push(P),i.push(b),n.push(l[3*(e.length-1)-1]),s=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsWithCtrlPt(l)}return{scalePoints:n,scaleValues:i,beizerPoints:s}},SuperMapAlgoPlot.PlottingUtil.computeBeizerPoints=function(t,e,i){var o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(e),n=[],l=[],s=[];if(t){l.push(new SuperMapAlgoPlot.Point(e[0].x,e[0].y)),l.push(new SuperMapAlgoPlot.Point(e[0].x,e[0].y));var a=i[0],r=i[1],u=e[0].x+o*a,p=e[0].y+o*r;l.push(new SuperMapAlgoPlot.Point(u,p)),n.push(new SuperMapAlgoPlot.Point(u,p));for(var h=1;h<e.length-1;h++){l.push(new SuperMapAlgoPlot.Point(e[h].x,e[h].y));var c=i[4*h-2],y=i[4*h-1],g=e[h].x+o*c,f=e[h].y+o*y;l.push(new SuperMapAlgoPlot.Point(g,f)),n.push(new SuperMapAlgoPlot.Point(g,f)),c=i[4*h],y=i[4*h+1],g=e[h].x+o*c,f=e[h].y+o*y,l.push(new SuperMapAlgoPlot.Point(g,f)),n.push(new SuperMapAlgoPlot.Point(g,f))}var d=e.length-1;l.push(new SuperMapAlgoPlot.Point(e[d].x,e[d].y)),a=i[4*d-2],r=i[4*d-1],u=e[d].x+o*a,p=e[d].y+o*r,l.push(new SuperMapAlgoPlot.Point(u,p)),n.push(new SuperMapAlgoPlot.Point(u,p)),l.push(new SuperMapAlgoPlot.Point(e[d].x,e[d].y)),s=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsWithCtrlPt(l)}else{i=[];var m=(l=SuperMapAlgoPlot.PlottingUtil.getBeizerCtrlPt(e))[2].x-l[0].x,S=l[2].y-l[0].y,P=m/o,b=S/o;i.push(P),i.push(b),n.push(l[2]);for(var v=1;v<e.length-1;v++){var L=(l[3*v+1].x-l[3*v].x)/o,M=(l[3*v+1].y-l[3*v].y)/o;i.push(L),i.push(M),n.push(l[3*v+1]);var _=(l[3*v+2].x-l[3*v].x)/o,A=(l[3*v+2].y-l[3*v].y)/o;i.push(_),i.push(A),n.push(l[3*v+2])}P=(m=l[3*(e.length-1)+1].x-l[3*(e.length-1)].x)/o,b=(S=l[3*(e.length-1)+1].y-l[3*(e.length-1)].y)/o,i.push(P),i.push(b),n.push(l[3*(e.length-1)+1]),s=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsWithCtrlPt(l)}return{scalePoints:n,scaleValues:i,beizerPoints:s}},SuperMapAlgoPlot.PlottingUtil.getBeizerInputPoints=function(t){var e=[],i=t.length;if(i<3)e.push(t);else for(var o=0;o<i;o+=3)e.push(t[o]);return e},SuperMapAlgoPlot.PlottingUtil.getTrianglePoints=function(t,e,i,o,n,l,s){var a=i.x,r=i.y,u=o.x,p=o.y,h=n.x,c=n.y;SuperMapAlgoPlot.PlottingUtil.getPointsByTriangle(t,e,a,r,u,p,h,c,l,s)},SuperMapAlgoPlot.PlottingUtil.getPointsByTriangle=function(t,e,i,o,n,l,s,a,r,u){var p=n+(s-i),h=l+(a-o),c=0,y=0;if(i==s)c=i,y=h;else if(o==a)c=p,y=o;else{var g=1*(a-o)/(s-i),f=o-i*g;y=g*(c=(h+p/g-f)/(g+1/g))+f}var d=Math.sqrt(1*(n-p)*(n-p)+1*(l-h)*(l-h)),m=Math.sqrt(1*(i-n)*(i-n)+1*(o-l)*(o-l)),S=Math.sqrt(1*(n-s)*(n-s)+1*(l-a)*(l-a)),P=0;p=c+(p-c)*(P=m+S?1+(S-m)*t/(S+m):1),h=y+(h-y)*P,0==d&&(d=1),r.x=n+(n-p)*m/(e*d),r.y=l+(l-h)*m/(e*d),u.x=n+(p-n)*S/(e*d),u.y=l+(h-l)*S/(e*d)},SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints=function(t,e,i,o,n){var l=e.x,s=e.y,a=i.x,r=i.y,u=o.x,p=o.y;return SuperMapAlgoPlot.PlottingUtil.getPointsByTrapezoid(t,l,s,a,r,u,p,n)},SuperMapAlgoPlot.PlottingUtil.getPointsByTrapezoid=function(t,e,i,o,n,l,s,a){var r=0,u=0,p=0,h=0;if(0==Math.abs(i-n))r=e+o-l,u=s;else if(0==Math.abs(e-o))r=l,u=i+n-s;else{var c=1*(i-n)/(e-o),y=s-c*l;u=c*(r=((n+i)/2+(e+o)/(2*c)-y)/(c+1/c))+y,r=2*r-l,u=2*u-s}var g=Math.sqrt(1*(e-o)*(e-o)+1*(i-n)*(i-n)),f=Math.sqrt(1*(e-r)*(e-r)+1*(i-u)*(i-u));return g>0?(p=e+(o-e)*f/g,h=i+(n-i)*f/g):(p=e,h=i),a.x=p+(r-p)*t,a.y=h+(u-h)*t,a},SuperMapAlgoPlot.PlottingUtil.pointIsOnPolyLine=function(t,e,i){if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t.x,e.x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t.y,e.y)||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t.x,i.x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t.y,i.y))return!0;var o=t.x-e.x,n=t.y-e.y,l=t.x-i.x,s=t.y-i.y,a=(o*l+n*s)/(Math.sqrt(o*o+n*n)*Math.sqrt(l*l+s*s));return!!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(a,-1,.1)},SuperMapAlgoPlot.PlottingUtil.pointIsOnPolyLines=function(t,e){if(!e||0===e.length)return{isOnPolyLine:!1,index:-1};for(var i=!1,o=-1,n=0;n<e.length-1;n++)if(i=SuperMapAlgoPlot.PlottingUtil.pointIsOnPolyLine(t,e[n],e[n+1])){o=n;break}return{isOnPolyLine:i,index:o}},SuperMapAlgoPlot.PlottingUtil.computePointToLineMinDis=function(t,e){for(var i=-1,o=-1,n=0;n<e.length-1;n++){var l=e[n],s=e[n+1],a=SuperMapAlgoPlot.PlottingUtil.projectPoint(t,l,s);if(SuperMapAlgoPlot.PlottingUtil.pointIsOnPolyLine(a,l,s)){var r=SuperMapAlgoPlot.PlottingUtil.distance(t,a);i<0?(i=r,o&&(o=n)):i>r&&(i=r,o=n)}}return o&&i<0&&(o=-1),{minDis:i,index:o}},SuperMapAlgoPlot.PlottingUtil.findPointInLine=function(t,e,i){if(t===e||Math.abs(i)<1e-18)return t;var o=e.x-t.x,n=e.y-t.y,l=i/Math.sqrt(o*o+n*n),s=t.x+o*l,a=t.y+n*l;return new SuperMapAlgoPlot.Point(s,a)},SuperMapAlgoPlot.PlottingUtil.operateControlPoints=function(t){var e=t,i=e.length;if(3==i){var o=new SuperMapAlgoPlot.Point(0,0);SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(1,t[0],t[1],t[2],o),e.push(o)}if(i>4&&(e.splice(4,i-4),i=e.length),SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(t[0],t[1],e[2])){var n=e[0];e[0]=e[1],e[1]=n}if(!SuperMapAlgoPlot.PlottingUtil.pointIsRightToVerticle(e[0],e[1],e[2])){var l=e[2];e[2]=e[3],e[3]=l}return e},SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine=function(t,e,i){return(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)<0},SuperMapAlgoPlot.PlottingUtil.pointIsRightToVerticle=function(t,e,i){var o=new SuperMapAlgoPlot.Point(.5*(e.x+t.x),.5*(e.y+t.y)),n=new SuperMapAlgoPlot.Point(e.x-t.x,e.y-t.y),l=new SuperMapAlgoPlot.Point(i.x-o.x,i.y-o.y);return n.x*l.x+n.y*l.y>0},SuperMapAlgoPlot.PlottingUtil.linePnt=function(t,e,i){var o=SuperMapAlgoPlot.PlottingUtil.distance(t,e);if(0==o)return t;var n=i/o;return SuperMapAlgoPlot.PlottingUtil.findPointOnLineByRatio(n,t,e)},SuperMapAlgoPlot.PlottingUtil.findPointOnLineByRatio=function(t,e,i){var o=new SuperMapAlgoPlot.Point(0,0);return o.x=e.x+(i.x-e.x)*t,o.y=e.y+(i.y-e.y)*t,o},SuperMapAlgoPlot.PlottingUtil.rotateAngle=function(t,e,i){var o=e,n=Math.cos(o),l=Math.sin(o),s=i.x-t.x,a=i.y-t.y;return i.x=s*n-a*l+t.x,i.y=s*l+a*n+t.y,i},SuperMapAlgoPlot.PlottingUtil.resize=function(t,e,i){return i.x=t.x+e*(i.x-t.x),i.y=t.y+e*(i.y-t.y),i},SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine=function(t,e){if(e<0||t.length<2)return{index:-1,pt:null};if(Math.abs(e)<1e-18)return{index:0,pt:t[0]};for(var i=0,o=0;o<t.length-1;o++)if((i+=SuperMapAlgoPlot.PlottingUtil.distance(t[o],t[o+1]))>e||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(i,e)){var n=i-e,l=t[o+1],s=t[o],a=n/SuperMapAlgoPlot.PlottingUtil.distance(l,s),r=new SuperMapAlgoPlot.Point(0,0);return r.x=l.x+(s.x-l.x)*a,r.y=l.y+(s.y-l.y)*a,void 0!==s.z&&(r.z=s.z),{index:o,pt:r}}return{index:-1,pt:null}},SuperMapAlgoPlot.PlottingUtil.polylineDistance=function(t){if(0===t.length)return 0;for(var e=0,i=0;i<t.length-1;i++)e+=SuperMapAlgoPlot.PlottingUtil.distance(t[i],t[i+1]);return e},SuperMapAlgoPlot.PlottingUtil.rotate=function(t,e,i,o){var n=o.x-t.x,l=o.y-t.y,s=n*e-l*i+t.x,a=n*i+l*e+t.y;return new SuperMapAlgoPlot.Point(s,a)},SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale=function(t,e,i){var o=e.x,n=e.y,l=i.x,s=i.y,a=Math.sqrt(1*(o-l)*(o-l)+1*(n-s)*(n-s)),r=0,u=0;return 0==a?(r=o,u=n):(r=o+(l-o)*t/a,u=n+(s-n)*t/a),new SuperMapAlgoPlot.Point(r,u)},SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale=function(t,e,i){var o=e.x,n=e.y,l=i.x,s=i.y,a=0,r=0,u=Math.sqrt(1*(o-l)*(o-l)+1*(n-s)*(n-s));return 0===u?(a=o,r=n):(a=o+(o-l)*t/u,r=n+(n-s)*t/u),new SuperMapAlgoPlot.Point(a,r)},SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine=function(t,e,i){var o=e.x,n=e.y,l=i.x,s=i.y,a=Math.sqrt(1*(o-l)*(o-l)+1*(n-s)*(n-s)),r=0,u=0;0==a?(u=0,r=t):(r=t*(o-l)/a,u=t*(n-s)/a);var p=-u+l,h=+r+s,c=+u+l,y=-r+s;return{pntLeft:new SuperMapAlgoPlot.Point(c,y),pntRight:new SuperMapAlgoPlot.Point(p,h)}},SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLineWithPoints=function(t,e,i,o,n){var l=Math.sqrt(1*(e.x-i.x)*(e.x-i.x)+1*(e.y-i.y)*(e.y-i.y)),s=0,a=0;0==l?(a=0,s=t):(s=t*(e.x-i.x)/l,a=t*(e.y-i.y)/l),o.x=-a+i.x,o.y=+s+i.y,n.x=+a+i.x,n.y=-s+i.y},SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment=function(t,e,i){var o,n,l=0,s=0,a=0,r=1;if(s=e.x!==t.x?(e.y-t.y)/(e.x-t.x):1.7976931348623157e308,a=i.x!==t.x?(i.y-t.y)/(i.x-t.x):1.7976931348623157e308,l=i.y!==e.y?(i.x-e.x)/(e.y-i.y):1.7976931348623157e308,(o=e.x>=t.x&&e.y>=t.y?1:e.x<t.x&&e.y>t.y?2:e.x<=t.x&&e.y<=t.y?3:4)==(n=i.x>t.x&&i.y>t.y?1:i.x<t.x&&i.y>t.y?2:i.x<t.x&&i.y<t.y?3:4))(s<l&&a<l||s>l&&a>l)&&(r=0);else switch(o){case 1:(4==n&&s<l||2==n&&s>l)&&(r=0);break;case 2:(1==n&&s<l||3==n&&s>l)&&(r=0);break;case 3:(2==n&&s<l||4==n&&s>l)&&(r=0);break;case 4:(3==n&&s<l||1==n&&s>l)&&(r=0)}var u=new SuperMapAlgoPlot.Point(0,0);return SuperMapAlgoPlot.PlottingUtil.equalFuzzy(l-1.7976931348623157e308,0)?(u.x=t.x,u.y=e.y):SuperMapAlgoPlot.PlottingUtil.equalFuzzy(l,0)?(u.x=e.x,u.y=t.y):(u.x=(l*(e.y-t.y)+l*l*t.x+e.x)/(l*l+1),u.y=t.y+l*(u.x-t.x)),{isOnline:1===r,projectPoint:u}},SuperMapAlgoPlot.PlottingUtil.coordinateTrans=function(t,e,i){var o=SuperMapAlgoPlot.PlottingUtil.distance(new SuperMapAlgoPlot.Point(0,0),e),n=SuperMapAlgoPlot.PlottingUtil.radian(new SuperMapAlgoPlot.Point(0,0),e)+i*Math.PI/180,l=o*Math.cos(n)+t.x,s=o*Math.sin(n)+t.y;return new SuperMapAlgoPlot.Point(l,s)},SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen=function(t,e,i){var o,n,l=(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y),s=Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)),a=Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y));if(0==a||0==s)o=0,n=0;else if(0==l)o=s,n=0;else{var r=(s*s+a*a-l)/2/s/a,u=0;r>=1?(r=1,u=0):u=Math.sqrt(1-r*r),o=a*r,n=a*u}return{dLen1:o,dLen2:n}},SuperMapAlgoPlot.PlottingUtil.paraLine=function(t,e,i){var o=[];if(2>t.length)return o;if(i){var n=t[1].clone();n=SuperMapAlgoPlot.PlottingUtil.rotateAngle(t[0],Math.PI/2,n),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(t[0],n,e));for(var l=1;l<t.length-1;l++)if(!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[l].x,t[l+1].x)||!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[l].y,t[l+1].y)){for(var s=SuperMapAlgoPlot.PlottingUtil.radian(t[l],t[l+1]),a=SuperMapAlgoPlot.PlottingUtil.radian(t[l],t[l-1])-s;a<0;)a+=2*Math.PI;var r=a/2,u=void 0;u=r>Math.PI/2?r-Math.PI/2:Math.PI/2-r;var p=e/Math.cos(u);n=t[l+1].clone(),n=SuperMapAlgoPlot.PlottingUtil.rotateAngle(t[l],r,n),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(t[l],n,p))}n=t[t.length-2].clone(),n=SuperMapAlgoPlot.PlottingUtil.rotateAngle(t[t.length-1],-1*Math.PI/2,n),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(t[t.length-1],n,e))}else{var h=t[1].clone();h=SuperMapAlgoPlot.PlottingUtil.rotateAngle(t[0],-Math.PI/2,h),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(t[0],h,e));for(var c=1;c<t.length-1;c++)if(!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[c].x,t[c+1].x)||!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[c].y,t[c+1].y)){for(var y=SuperMapAlgoPlot.PlottingUtil.radian(t[c],t[c+1]),g=SuperMapAlgoPlot.PlottingUtil.radian(t[c],t[c-1])-y;g<0;)g+=2*Math.PI;var f=Math.PI-g/2,d=void 0;d=f>Math.PI/2?f-Math.PI/2:Math.PI/2-f;var m=e/Math.cos(d);h=t[c-1].clone(),h=SuperMapAlgoPlot.PlottingUtil.rotateAngle(t[c],f,h),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(t[c],h,m))}h=t[t.length-2].clone(),h=SuperMapAlgoPlot.PlottingUtil.rotateAngle(t[t.length-1],Math.PI/2,h),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(t[t.length-1],h,e))}return o},SuperMapAlgoPlot.PlottingUtil.circlePoint=function(t,e,i,o){o*=Math.PI/180;var n=t.x+e*Math.cos(o),l=t.y+i*Math.sin(o);return new SuperMapAlgoPlot.Point(n,l)},SuperMapAlgoPlot.PlottingUtil.getPolygonCenterPt=function(t){if(!t||0===t.length)return null;for(var e=0,i=0,o=0;o<t.length;o++)e+=t[o].x,i+=t[o].y;return new SuperMapAlgoPlot.Point(e/t.length,i/t.length)},SuperMapAlgoPlot.PlottingUtil.ptIsInPolygon=function(t,e){if(!t||0===t.length)return!1;for(var i=0,o=t.length,n=0;n<o;n++){var l=t[n],s=t[(n+1)%o];if(l.y!==s.y){var a=l.y<s.y?l.y:s.y,r=l.y>s.y?l.y:s.y;if(!(e.y<a||e.y>r))(e.y-l.y)*(s.x-l.x)/(s.y-l.y)+l.x>e.x&&i++}}return i%2==1},SuperMapAlgoPlot.PlottingUtil.projectPtOnPolyLine=function(t,e){if(2>e.length)return{index:-1,pt:null};for(var i=0;i<e.length-1;i++){var o=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(t,e[i],e[i+1]);if(o.isOnline)return{index:i,pt:o.projectPoint}}return{index:-1,pt:null}},SuperMapAlgoPlot.PlottingUtil.ptOnPolyLine=function(t,e){if(2>e.length)return!1;for(var i=0;i<e.length-1;i++){var o=new SuperMapAlgoPlot.Point(t.x-e[i].x,t.y-e[i].y),n=new SuperMapAlgoPlot.Point(t.x-e[i+1].x,t.y-e[i+1].y);if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(o.x,0)||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(o.y,0)||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(n.x,0)||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(n.y,0))return index=i,!0;var l=(o.x*n.x+o.y*n.y)/(Math.sqrt(o.x*o.x+o.y*o.y)*(n.x*n.x+n.y*n.y));if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(l,-1))return!0}return!1},SuperMapAlgoPlot.PlottingUtil.isPloyClockwise=function(t){var e=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),i=e.length;if(!(i<3)){var o=e[0].y*(e[i-1].x-e[1].x);e.push(e[0].clone());for(var n=1;n<i;++n)o+=e[n].y*(e[n-1].x-e[n+1].x);return o>0?0:1}},SuperMapAlgoPlot.PlottingUtil.isSamePt=function(t,e){return!(!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t.x,e.x)||!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t.y,e.y))},SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance=function(t,e){var i=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(e,t);return{index:i.index,pts:i.pt,bfind:-1!==i.index}},SuperMapAlgoPlot.PlottingUtil.ptInBounds=function(t,e){return t.x>e.left&&t.x<e.right&&t.y<e.top&&t.y>e.bottom},SuperMapAlgoPlot.PlottingUtil.InnerAngle=function(t,e,i){if(t==e||t==i)return 0;var o=SuperMapAlgoPlot.PlottingUtil.distance(t,e),n=SuperMapAlgoPlot.PlottingUtil.distance(t,i),l=SuperMapAlgoPlot.PlottingUtil.distance(e,i),s=(o*o+n*n-l*l)/(2*o*n);return s>1&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(s,1)?s=1:s<1&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(s,-1)&&(s=-1),Math.acos(s)},SuperMapAlgoPlot.PlottingUtil.plumbLineLen=function(t,e,i){return SuperMapAlgoPlot.PlottingUtil.distance(t,e)*Math.sin(SuperMapAlgoPlot.PlottingUtil.InnerAngle(e,t,i))},SuperMapAlgoPlot.PlottingUtil.paraPolygon=function(t,e,i){var o=[],n=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),l=n.length;if(l<2)return o;var s=new SuperMapAlgoPlot.Point(0,0);if(i){if(l<3)s=n[1].clone(),SuperMapAlgoPlot.PlottingUtil.rotateAngle(n[0],Math.PI,s),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(n[0],s,e));else{for(var a=SuperMapAlgoPlot.PlottingUtil.radian(n[0],n[1]),r=SuperMapAlgoPlot.PlottingUtil.radian(n[0],n[n.length-1])-a;r<0;)r+=2*Math.PI;var u,p=r/2;u=p>Math.PI/2?p-Math.PI/2:Math.PI/2-p;var h=e/Math.cos(u);s=n[1].clone(),s=SuperMapAlgoPlot.PlottingUtil.rotateAngle(n[0],p,s),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(n[0],s,h))}for(var c=1;c<l-1;c++){for(var y=SuperMapAlgoPlot.PlottingUtil.radian(n[c],n[c+1]),g=SuperMapAlgoPlot.PlottingUtil.radian(n[c],n[c-1])-y;g<0;)g+=2*Math.PI;var f=g/2,d=void 0;d=f>Math.PI/2?f-Math.PI/2:Math.PI/2-f;var m=e/Math.cos(d);s=n[c+1].clone(),s=SuperMapAlgoPlot.PlottingUtil.rotateAngle(n[c],f,s),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(n[c],s,m))}if(l<3)s=n[l-2].clone(),SuperMapAlgoPlot.PlottingUtil.rotateAngle(n[l-1],0,s),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(n[l-1],s,e));else{for(var S=SuperMapAlgoPlot.PlottingUtil.radian(n[l-1],n[0]),P=SuperMapAlgoPlot.PlottingUtil.radian(n[l-1],n[l-2])-S;P<0;)P+=2*Math.PI;var b,v=P/2;b=v>Math.PI/2?v-Math.PI/2:Math.PI/2-v;var L=e/Math.cos(b);s=n[0].clone(),s=SuperMapAlgoPlot.PlottingUtil.rotateAngle(n[l-1],v,s),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(n[l-1],s,L))}}else{if(l<3){var M=n[1].clone();SuperMapAlgoPlot.PlottingUtil.rotateAngle(n[0],0,M),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(n[0],M,e))}else{for(var _=SuperMapAlgoPlot.PlottingUtil.radian(n[0],n[1]),A=SuperMapAlgoPlot.PlottingUtil.radian(n[0],n[l-1])-_;A<0;)A+=2*Math.PI;var T,x=Math.PI-A/2;T=x>Math.PI/2?x-Math.PI/2:Math.PI/2-x;var O=e/Math.cos(T);s=n[l-1].clone(),s=SuperMapAlgoPlot.PlottingUtil.rotateAngle(n[0],x,s),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(n[0],s,O))}for(var w=1;w<l-1;w++){for(var C=SuperMapAlgoPlot.PlottingUtil.radian(n[w],n[w+1]),E=SuperMapAlgoPlot.PlottingUtil.radian(n[w],n[w-1])-C;E<0;)E+=2*Math.PI;var I=Math.PI-E/2,D=void 0;D=I>Math.PI/2?I-Math.PI/2:Math.PI/2-I;var U=e/Math.cos(D);s=n[w-1].clone(),s=SuperMapAlgoPlot.PlottingUtil.rotateAngle(n[w],I,s),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(n[w],s,U))}if(l<3)s=n[l-2].clone(),SuperMapAlgoPlot.PlottingUtil.rotateAngle(n[l-1],Math.PI,s),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(n[l-1],s,e));else{for(var R=SuperMapAlgoPlot.PlottingUtil.radian(n[l-1],n[0]),N=SuperMapAlgoPlot.PlottingUtil.radian(n[l-1],n[l-2])-R;N<0;)N+=2*Math.PI;var B,k=Math.PI-N/2;B=k>Math.PI/2?k-Math.PI/2:Math.PI/2-k;var F=e/Math.cos(B);s=n[l-2].clone(),s=SuperMapAlgoPlot.PlottingUtil.rotateAngle(n[l-1],k,s),o.push(SuperMapAlgoPlot.PlottingUtil.linePnt(n[l-1],s,F))}}return o},SuperMapAlgoPlot.PlottingUtil.getOutRectangleDis=function(t){if(2>t.length)return 0;for(var e=t[0].x,i=t[0].x,o=t[0].y,n=t[0].y,l=1;l<t.length;l++)e<t[l].x&&(e=t[l].x),i>t[l].x&&(i=t[l].x),o<t[l].y&&(o=t[l].y),n>t[l].y&&(n=t[l].y);return SuperMapAlgoPlot.PlottingUtil.distance(new SuperMapAlgoPlot.Point(e,o),new SuperMapAlgoPlot.Point(i,n))},SuperMapAlgoPlot.PlottingUtil.clonePoints=function(t){var e=[];if(void 0===t||null===t)return e;if(SuperMapAlgoPlot.PlottingUtil.isArray(t)||(t=[t]),t&&null!=t)for(var i=0;i<t.length;i++)void 0!==t[i]&&null!==t[i]&&t[i].clone&&e.push(t[i].clone());return e},SuperMapAlgoPlot.PlottingUtil.extend=function(t,e){if("function"==typeof SuperMap.Util.extend)return SuperMap.Util.extend(t,e);if(t=t||{},e){for(var i in e){var o=e[i];void 0!==o&&(t[i]=o)}!("function"==typeof window.Event&&e instanceof window.Event)&&e.hasOwnProperty&&e.hasOwnProperty.call("toString")&&(t.toString=e.toString)}return t},SuperMapAlgoPlot.PlottingUtil.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},SuperMapAlgoPlot.PlottingUtil.indexOf=function(t,e){if(null==t)return-1;if("function"==typeof t.indexOf)return t.indexOf(e);for(var i=0,o=t.length;i<o;i++)if(t[i]===e)return i;return-1},SuperMapAlgoPlot.PlottingUtil.copyAttributes=function(t,e){if(t=t||{},e)for(var i in e){var o=e[i];void 0!==o&&"CLASS_NAME"!==i&&"function"!=typeof o&&(t[i]=o)}return t},SuperMapAlgoPlot.PlottingUtil.cloneObject=function(t){if(null===t||"object"!==qi(t))return t;if(t instanceof Date){var e=new Date;return e.setTime(t.getTime()),e}if(t instanceof Array)return t.slice(0);if(t instanceof Object){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(i[o]=SuperMapAlgoPlot.PlottingUtil.cloneObject(t[o]));return i}throw new Error("Unable to copy obj! Its type isn't supported.")},SuperMapAlgoPlot.PlottingUtil.rad=function(t){return t*Math.PI/180},SuperMapAlgoPlot.PlottingUtil.deg=function(t){return 180*t/Math.PI},SuperMapAlgoPlot.PlottingUtil.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},SuperMapAlgoPlot.PlottingUtil.distVincenty=function(t,e){var i,o,n,l=SuperMapAlgoPlot.PlottingUtil.VincentyConstants,s=l.a,a=l.b,r=l.f;"undefined"!=typeof L&&void 0!==L.LatLng&&t instanceof L.LatLng&&e instanceof L.LatLng?(i=SuperMapAlgoPlot.PlottingUtil.rad(e.lng-t.lng),o=Math.atan((1-r)*Math.tan(SuperMapAlgoPlot.PlottingUtil.rad(t.lat))),n=Math.atan((1-r)*Math.tan(SuperMapAlgoPlot.PlottingUtil.rad(e.lat)))):(i=SuperMapAlgoPlot.PlottingUtil.rad(e.lon-t.lon),o=Math.atan((1-r)*Math.tan(SuperMapAlgoPlot.PlottingUtil.rad(t.lat))),n=Math.atan((1-r)*Math.tan(SuperMapAlgoPlot.PlottingUtil.rad(e.lat))));for(var u=Math.sin(o),p=Math.cos(o),h=Math.sin(n),c=Math.cos(n),y=i,g=2*Math.PI,f=20;Math.abs(y-g)>1e-12&&--f>0;){var d=Math.sin(y),m=Math.cos(y),S=Math.sqrt(c*d*(c*d)+(p*h-u*c*m)*(p*h-u*c*m));if(0==S)return 0;var P=u*h+p*c*m,b=Math.atan2(S,P),v=Math.asin(p*c*d/S),M=Math.cos(v)*Math.cos(v),_=P-2*u*h/M,A=r/16*M*(4+r*(4-3*M));g=y,y=i+(1-A)*r*Math.sin(v)*(b+A*S*(_+A*P*(2*_*_-1)))}if(0==f)return NaN;var T=M*(s*s-a*a)/(a*a),x=T/1024*(256+T*(T*(74-47*T)-128));return(a*(1+T/16384*(4096+T*(T*(320-175*T)-768)))*(b-x*S*(_+x/4*(P*(2*_*_-1)-x/6*_*(4*S*S-3)*(4*_*_-3))))).toFixed(3)/1e3},SuperMapAlgoPlot.PlottingUtil.destinationVincenty=function(t,e,i){var o,n,l=SuperMapAlgoPlot.PlottingUtil,s=l.VincentyConstants,a=s.a,r=s.b,u=s.f;"undefined"!=typeof L&&void 0!==L.LatLng&&t instanceof L.LatLng?(o=t.lng,n=t.lat):(o=t.lon,n=t.lat);for(var p=i,h=l.rad(e),c=Math.sin(h),y=Math.cos(h),g=(1-u)*Math.tan(l.rad(n)),f=1/Math.sqrt(1+g*g),d=g*f,m=Math.atan2(g,y),S=f*c,P=1-S*S,b=P*(a*a-r*r)/(r*r),v=1+b/16384*(4096+b*(b*(320-175*b)-768)),M=b/1024*(256+b*(b*(74-47*b)-128)),_=p/(r*v),A=2*Math.PI;Math.abs(_-A)>1e-12;){var T=Math.cos(2*m+_),x=Math.sin(_),O=Math.cos(_);A=_,_=p/(r*v)+M*x*(T+M/4*(O*(2*T*T-1)-M/6*T*(4*x*x-3)*(4*T*T-3)))}var w=d*x-f*O*y,C=Math.atan2(d*O+f*x*y,(1-u)*Math.sqrt(S*S+w*w)),E=u/16*P*(4+u*(4-3*P)),I=Math.atan2(x*c,f*O-d*x*y)-(1-E)*u*S*(_+E*x*(T+E*O*(2*T*T-1)));return"undefined"!=typeof L&&void 0!==L.LatLng&&t instanceof L.LatLng?L.latLng(l.deg(C),o+l.deg(I)):new SuperMap.LonLat(o+l.deg(I),l.deg(C))},SuperMapAlgoPlot.PlottingUtil.midPoint=function(t,e){var i=new SuperMapAlgoPlot.Point(0,0);return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i},SuperMapAlgoPlot.PlottingUtil.makeDottedLine=function(t,e){for(var i,o,n=[],l=e,s=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t),a=e,r=t[0].clone(),u=1,p=0,h=!0,c=!0;p<s;){var y;(o=[]).push(r),p+=l;var g=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(p,t);if(y=g.index,i=g.pts,!(h=g.bfind))break;if(u<y)for(var f=u;f<y;f++)o.push(t[f]);o.push(i),n.push(o),p+=a;var d=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(p,t);if(y=d.index,r=d.pts,u=y+1,!(c=d.bfind))break}if(!h){(o=[]).push(r);for(var m=u;m<t.length;m++)o.push(t[m]);2===o.length&&0===SuperMapAlgoPlot.PlottingUtil.distance(o[0],o[1])||n.push(o)}if(!c){var S=t[t.length-1],P=SuperMapAlgoPlot.PlottingUtil.distance(i,S);if(P*=.01,!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(P,0)){var b=SuperMapAlgoPlot.PlottingUtil.linePnt(S,i,P);(o=[]).push(b),o.push(S),n.push(o)}}return n},SuperMapAlgoPlot.PlottingUtil.getLineDistance=function(t,e){for(var i=0,o=0;o<t.length-1;o++){if(SuperMapAlgoPlot.PlottingUtil.pointIsOnPolyLine(e,t[o],t[o+1])){i+=SuperMapAlgoPlot.PlottingUtil.distance(t[o],e);break}i+=SuperMapAlgoPlot.PlottingUtil.distance(t[o],t[o+1])}return i};var Qi=SuperMapAlgoPlot.Primitives=SuperMapAlgoPlot.Primitives||{};SuperMapAlgoPlot.Primitives={nSegmentCount:72,initialize:function(t){t&&t.nSegmentCount&&(this.nSegmentCount=t.nSegmentCount)},polyline:function(t){return t},parallelline:function(t){if(t&&t.length>=3){var e=SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[1]);SuperMapAlgoPlot.PlottingUtil.isRight(t[0],t[1],t[2])&&(e=-e);for(var i=[],o=1;o<t.length;o++)i.push(t[o].clone());var n=SuperMapAlgoPlot.PlottingUtil.parallel(i,e);return t[0].x=n[0].x,t[0].y=n[0].y,[i,n]}return[]},kidney:function(t,e){if(t){var i=[];return i=e?this.getKendyShapePts(t):t,SuperMapAlgoPlot.PlottingUtil.clearSamePts(i),i}},bezier:function(t,e){if(t){var i=[];return i=e?SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t):t,SuperMapAlgoPlot.PlottingUtil.clearSamePts(i),i}},loopbezier:function(t,e){if(t){t[0].x===t[t.length-1].x&&t[0].y===t[t.length-1].y||t.push(t[0]);var i=[];return i=e?SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t):t,SuperMapAlgoPlot.PlottingUtil.clearSamePts(i),i}},parallelogram:function(t){if(t&&t.length>=3){var e=t[0].x+(t[2].x-t[1].x),i=t[0].y+(t[2].y-t[1].y),o=new SuperMapAlgoPlot.Point(e,i),n=[];return n.push.apply(n,t),n.push(o),n.push(n[0]),n}},polygon:function(t){if(t&&t.length>2)return t},circle:function(t){if(t&&2===t.length){for(var e=t[0],i=t[1],o=[],n=Math.sqrt((i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y)),l=360/this.nSegmentCount,s=0;s<this.nSegmentCount;s++){var a=(s*l+1)*Math.PI/180,r=new SuperMapAlgoPlot.Point(Math.cos(a)*n+e.x,Math.sin(a)*n+e.y);o[s]=r}return o}},rectangle:function(t){if(t&&2===t.length){var e=t[0],i=t[1],o=e.clone();return[o,new SuperMapAlgoPlot.Point(i.x,e.y),i.clone(),new SuperMapAlgoPlot.Point(e.x,i.y),o]}},sector:function(t){if(t&&t.length>=3){var e=this.getArcInfo(t[0],t[1],t[2]);e.dStartAngle*=Math.PI/180,e.dEndAngle*=Math.PI/180;var i=(e.dEndAngle-e.dStartAngle)/this.nSegmentCount,o=this.getArcSpatialData(e.pntCenter,e.dRadius,e.dRadius,0,e.dStartAngle,e.dEndAngle,i);if(o.push(e.pntCenter),0!==o.length)return o}},lune:function(t){if(t&&t.length>=3){var e=this.getArcInfo(t[0],t[1],t[2]);e.dStartAngle*=Math.PI/180,e.dEndAngle*=Math.PI/180;var i=(e.dEndAngle-e.dStartAngle)/this.nSegmentCount,o=this.getArcSpatialData(e.pntCenter,e.dRadius,e.dRadius,0,e.dStartAngle,e.dEndAngle,i);if(0!==o.length)return o}},arc:function(t){if(t&&t.length>=3){var e=this.getArcInfo(t[0],t[1],t[2]);e.dStartAngle*=Math.PI/180,e.dEndAngle*=Math.PI/180;var i=(e.dEndAngle-e.dStartAngle)/this.nSegmentCount,o=this.getArcSpatialData(e.pntCenter,e.dRadius,e.dRadius,0,e.dStartAngle,e.dEndAngle,i);if(0!==o.length)return o}},ellipse:function(t,e,i,o,n){if(!0===i){if((!o||null==o)&&t&&t.length>=3&&(o=SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[1])),(!n||null==n)&&t&&t.length>=3){var l=SuperMapAlgoPlot.PlottingUtil.projectPoint(t[2],t[0],t[1]);n=SuperMapAlgoPlot.PlottingUtil.distance(l,t[2])}}else n=SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[2]),o=SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[1]);if(e&&null!=e?e*=Math.PI/180:e=SuperMapAlgoPlot.PlottingUtil.radian(t[0],t[1]),t&&t.length>0){var s=2*Math.PI,a=s/this.nSegmentCount,r=this.getArcSpatialData(t[0],o,n,e,0,s,a);if(!0===i){var u=Math.sin(e),p=Math.cos(e);t[2].x>t[1].x?(t[2].x=t[0].x-n*u,t[2].y=t[0].y+n*p):(t[2].x=t[0].x+n*u,t[2].y=t[0].y-n*p)}return r}},getArcSpatialData:function(t,e,i,o,n,l,s){var a=[];if(Math.abs(s)<1e-9)return a;for(;l<n;)l+=2*Math.PI;for(;l>n+2*Math.PI;)n+=2*Math.PI;var r=Math.cos(o)*e,u=Math.sin(o)*e,p=Math.cos(o)*i,h=Math.sin(o)*i,c=this.calcEllipseRadian(n,e,i),y=this.calcEllipseRadian(l,e,i);y-c<1e-5&&(y+=2*Math.PI);var g=Math.round(Math.abs((y-c)/s)+1);if(g<2)return a;for(var f=0;f<g-1;c+=s,f++){f===g-2&&(c=l);var d=t.x+r*Math.cos(c)-h*Math.sin(c),m=t.y+u*Math.cos(c)+p*Math.sin(c);a.push(new SuperMapAlgoPlot.Point(d,m))}return 0>a.length&&(a[a.length-1].x=t.x+r*Math.cos(y)-h*Math.sin(y),a[a.length-1].y=t.y+u*Math.cos(y)+p*Math.sin(y)),a},getArcCircleSpatialData:function(t,e,i,o){for(var n=[];o<i;)o+=2*Math.PI;for(;o>i+2*Math.PI;)i+=2*Math.PI;o-i<1e-10&&(o+=2*Math.PI);for(var l=(o-i)/50,s=i;s<o;s+=l){var a=t.x+e*Math.cos(s),r=t.y+e*Math.sin(s);n.push(new SuperMapAlgoPlot.Point(a,r))}var u=t.x+e*Math.cos(o),p=t.y+e*Math.sin(o);return n.push(new SuperMapAlgoPlot.Point(u,p)),n},getArcInfo:function(t,e,i){var o={};o.pntCenter=new SuperMapAlgoPlot.Point(0,0),o.dRadius=0,o.dStartAngle=0,o.dEndAngle=0;var n=e.x-t.x,l=e.y-t.y;if(Math.abs(n)<1e-9){var s={},a={};s.x=(e.x+t.x)/2,s.y=(e.y+t.y)/2,a.x=(e.x+i.x)/2,a.y=(e.y+i.y)/2;var r=0;Math.abs(i.x-e.x)>=1e-9&&(r=(i.y-e.y)/(i.x-e.x)),o.pntCenter.y=s.y,Math.abs(r)<1e-9?o.pntCenter.x=a.x:o.pntCenter.x=a.x-r*(s.y-a.y)}else{var u={},p={};u.x=(e.x+t.x)/2,u.y=(e.y+t.y)/2,p.x=(e.x+i.x)/2,p.y=(e.y+i.y)/2;var h=l/n,c=1;Math.abs(h)<1e-9?(o.pntCenter.x=u.x,Math.abs(i.x-e.x<1e-9)?o.pntCenter.y=p.y:o.pntCenter.y=-(i.x-e.x)/(i.y-e.y)*(o.pntCenter.x-p.x)+p.y):Math.abs(i.x-e.x)<1e-9?(o.pntCenter.y=p.y,o.pntCenter.x=-h*(o.pntCenter.y-u.y)+u.x):(c=(i.y-e.y)/(i.x-e.x),o.pntCenter.x=(h*c*(u.y-p.y)+c*u.x-h*p.x)/(c-h),o.pntCenter.y=(p.x-u.x+c*p.y-h*u.y)/(c-h))}var y=Math.atan2(t.y-o.pntCenter.y,t.x-o.pntCenter.x),g=Math.atan2(i.y-o.pntCenter.y,i.x-o.pntCenter.x);if(SuperMapAlgoPlot.PlottingUtil.isCounterClockwise(t,e,i)){for(;y>=2*Math.PI;)y-=2*Math.PI;for(;y<0;)y+=2*Math.PI;for(;g>2*Math.PI;)g-=2*Math.PI;for(;g<y;)g+=2*Math.PI}else{for(;g>=2*Math.PI;)g-=2*Math.PI;for(;g<0;)g+=2*Math.PI;for(;y>2*Math.PI;)y-=2*Math.PI;for(;g>y;)y+=2*Math.PI;var f=y;y=g,g=f}return o.dRadius=Math.sqrt((o.pntCenter.x-t.x)*(o.pntCenter.x-t.x)+(o.pntCenter.y-t.y)*(o.pntCenter.y-t.y)),o.dEndAngle=180*g/Math.PI,o.dStartAngle=180*y/Math.PI,o},calcEllipseRadian:function(t,e,i){var o=t,n=e*Math.sin(t),l=i*Math.cos(t),s=Math.atan2(n,l);if(t>Math.PI)for(;o>Math.PI;)o-=2*Math.PI,s+=2*Math.PI;else if(t<-Math.PI)for(;o<-Math.PI;)o+=2*Math.PI,s-=2*Math.PI;return s},getKendyShapePts:function(t){var e=[];if(2>(t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length)return e;var i=this.calcShapePoints(t);if(12!=i.length)return e;i.push(i[0]),i.push(i[1]),i.splice(0,1);for(var o=0;o<i.length-3;o+=3){var n;n=this.getBezierPtsWithScalePts(i[o],i[o+1],i[o+2],i[o+3]),e=e.concat(n)}return e},calcShapePoints:function(t){var e=[],i=[],o=t.length;if(0!==o){if(1!==o){if(2==o){var n=this.calcProtudeC3(t[1],t[0]);i.push(t[0]),i.push(t[1]),i.push(n)}else if(i.push(t[0]),i.push(t[1]),i.push(t[2]),(SuperMapAlgoPlot.PlottingUtil.isSamePt(t[0],t[2])||SuperMapAlgoPlot.PlottingUtil.isSamePt(t[1],t[2]))&&(e.push(t[0]),e.push(t[1])),SuperMapAlgoPlot.PlottingUtil.isSamePt(t[0],t[1]))return e.push(t[0]),void e.push(t[2]);i=this.reNormalizeKidneyCtrlPoints(i);var l=new SuperMapAlgoPlot.Point(0,0),s=new SuperMapAlgoPlot.Point(0,0);l.x=.5*(i[0].x+i[1].x),l.y=.5*(i[0].y+i[1].y),s.x=l.x-.1*(i[2].x-l.x),s.y=l.y-.1*(i[2].y-l.y);var a=this.GetPtsByTriangle(3,0,i[1],i[0],s);e.push(a.pr),e.push(s),e.push(a.pl);var r=this.GetPtsByTriangle(4,2,i[2],i[0],i[1]);e.push(r.pr),e.push(i[1]),e.push(r.pl);var u=this.GetPtsByTriangle(2,0,i[0],i[1],i[2]);e.push(u.pr),e.push(i[2]),e.push(u.pl);var p=this.GetPtsByTriangle(4,1,i[1],i[2],i[0]);return e.push(p.pr),e.push(i[0]),e.push(p.pl),e}e.push(t[0])}},calcProtudeC3:function(t,e){var i,o=new SuperMapAlgoPlot.Point(0,0);return o.x=.5*(t.x+e.x),o.y=.5*(t.y+e.y),i=SuperMapAlgoPlot.PlottingUtil.distance(e,t)/2.7,this.GetPointsOfNormal(i,t,o).pt3},GetPointsOfNormal:function(t,e,i){var o,n=new SuperMapAlgoPlot.Point(0,0),l=new SuperMapAlgoPlot.Point(0,0),s=new SuperMapAlgoPlot.Point(0,0);return 0==(o=SuperMapAlgoPlot.PlottingUtil.distance(e,i))?(s.y=0,s.x=t):(s.x=t*(e.x-i.x)/o,s.y=t*(e.y-i.y)/o),n.x=-s.y+i.x,n.y=s.x+i.y,l.x=s.y+i.x,l.y=-s.x+i.y,{pt3:n,pt4:l}},reNormalizeKidneyCtrlPoints:function(t){var e=[];e.push(new SuperMapAlgoPlot.Point(0,0)),e.push(new SuperMapAlgoPlot.Point(0,0)),e.push(new SuperMapAlgoPlot.Point(0,0));var i=t.length;if(i<2)return e;if(2==i)e[0]=t[0],e[1]=t[1],e[2]=this.calcProtudeC3(t[0],t[1]);else{var o,n,l,s=t[0],a=t[1],r=t[2];if(o=SuperMapAlgoPlot.PlottingUtil.distance(a,s),n=SuperMapAlgoPlot.PlottingUtil.distance(r,a),l=SuperMapAlgoPlot.PlottingUtil.distance(s,r),n>=o&&n>=l){var u=s.clone();s=r.clone(),r=u.clone()}else if(l>=o&&l>=n){var p=r.clone();r=a.clone(),a=p.clone()}if(!SuperMapAlgoPlot.PlottingUtil.isRight(r,s,a)){var h=s.clone();s=a.clone(),a=h.clone()}e[0]=s,e[1]=a,e[2]=r}return e},GetPtsByTriangle:function(t,e,i,o,n){var l=new SuperMapAlgoPlot.Point(0,0),s=0,a=0;return s=SuperMapAlgoPlot.PlottingUtil.distance(n,i),a=SuperMapAlgoPlot.PlottingUtil.distance(o,n),1==e&&(s*=2),2==e&&(a*=2),l.x=(s*o.x+a*i.x)/(s+a),l.y=(s*o.y+a*i.y)/(s+a),{pl:this.GetWhichPtOfNormal(t,i,l,n),pr:this.GetWhichPtOfNormal(t,o,l,n)}},GetWhichPtOfNormal:function(t,e,i,o){var n=0;n=SuperMapAlgoPlot.PlottingUtil.distance(o,e)/t;var l=this.GetPointsOfNormal(n,i,o);return SuperMapAlgoPlot.PlottingUtil.distance(e,l.pt4)>=(n=SuperMapAlgoPlot.PlottingUtil.distance(e,l.pt3))?l.pt3:l.pt4},getBezierPtsWithScalePts:function(t,e,i,o){var n=[],l=t.x,s=t.y,a=e.x,r=e.y,u=i.x,p=i.y,h=o.x,c=o.y;if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(l,a,1e-10)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(s,r,1e-10)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(u,h,1e-10)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(p,c,1e-10))n.push(new SuperMapAlgoPlot.Point(l,s)),n.push(new SuperMapAlgoPlot.Point(u,p));else for(var y=0;y<=1;y+=.03125){var g,f,d,m,S=y*y,P=S*y;g=1-3*y+3*S-P,f=3*(y-2*S+P),d=3*(S-P),m=P;var b=new SuperMapAlgoPlot.Point(g*l+f*a+d*u+m*h,g*s+f*r+d*p+m*c);n.push(b)}return n},getSpatialData:function(t,e,i,o){switch(null==o&&(o=!0),t){case 24:return this.polyline(e);case 390:return this.kidney(e,o);case 590:return this.bezier(e,o);case 360:return this.loopbezier(e,o);case 28:return this.parallelogram(e);case 32:return this.polygon(e);case 29:return this.circle(e);case 26:return this.rectangle(e);case 380:return this.sector(e);case 370:return this.lune(e);case 44:return this.arc(e);case 31:return this.ellipse(e,i,o);case 48:return this.parallelline(e);default:return e}}};var $i=SuperMapAlgoPlot.RouteNodePrimitives=SuperMapAlgoPlot.RouteNodePrimitives||{};SuperMapAlgoPlot.RouteNodePrimitives={initialize:function(){},rendezvousPoint:function(){var t=[],e=new Object;e.type=SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),e.positionPoints.push(new SuperMapAlgoPlot.Point(0,30)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1};var i=new Object;return i.type=SuperMapAlgoPlot.SymbolType.TEXTSYMBOL,i.positionPoints=[],i.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),i.textContent="会",i.style={surroundLineFlag:!1,fontSize:14,fontSizeLimit:!0},i.style.labelAlign="cm",t.push(i),t.push(e),t},expandingPoint:function(){var t=[],e=new Object;e.type=SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),e.positionPoints.push(new SuperMapAlgoPlot.Point(0,30)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1};var i=new Object;return i.type=SuperMapAlgoPlot.SymbolType.TEXTSYMBOL,i.positionPoints=[],i.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),i.textContent="展",i.style={surroundLineFlag:!1,fontSize:14,fontSizeLimit:!0},i.style.labelAlign="cm",t.push(i),t.push(e),t},volleyPoint:function(){var t=[],e=new Object;e.type=SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),e.positionPoints.push(new SuperMapAlgoPlot.Point(0,30)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1};var i=new Object;return i.type=SuperMapAlgoPlot.SymbolType.TEXTSYMBOL,i.positionPoints=[],i.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),i.textContent="齐",i.style={surroundLineFlag:!1,fontSize:14,fontSizeLimit:!0},i.style.labelAlign="cm",t.push(i),t.push(e),t},standbyPoint_Outer:function(t,e){var i=[],o=new SuperMapAlgoPlot.Point(0,0),n=new SuperMapAlgoPlot.Point(0,30);t||(t=90);var l=new Object;l.type=SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,l.positionPoints=[];for(var s=t+10;s<170+t;s+=10){var a=SuperMapAlgoPlot.PlottingUtil.findPoint(o,n,30,s);l.positionPoints.push(a)}l.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},i.push(l);var r=l.positionPoints[l.positionPoints.length-1],u=l.positionPoints[l.positionPoints.length-2],p=SuperMapAlgoPlot.PlottingUtil.findPoint(r,u,9,22.5),h=SuperMapAlgoPlot.PlottingUtil.findPoint(r,u,9,-22.5),c=new Object;c.type=SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,c.positionPoints=[],c.positionPoints.push(p),c.positionPoints.push(r.clone()),c.positionPoints.push(h),c.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},i.push(c);var y=new Object;y.type=SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,y.positionPoints=[];for(var g=190+t;g<350+t;g+=10){var f=SuperMapAlgoPlot.PlottingUtil.findPoint(o,n,30,g);y.positionPoints.push(f)}y.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},i.push(y);var d=y.positionPoints[y.positionPoints.length-1],m=y.positionPoints[y.positionPoints.length-2],S=SuperMapAlgoPlot.PlottingUtil.findPoint(d,m,9,22.5),P=SuperMapAlgoPlot.PlottingUtil.findPoint(d,m,9,-22.5),b=new Object;b.type=SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,b.positionPoints=[],b.positionPoints.push(S),b.positionPoints.push(d.clone()),b.positionPoints.push(P),b.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},i.push(b);for(var v=0;v<i.length;v++)for(var L=0;L<i[v].positionPoints.length;L++){var M=e*(Math.PI/180);SuperMapAlgoPlot.PlottingUtil.rotateAngle(o,M,i[v].positionPoints[L])}return i},standbyPoint_Inner:function(){var t=[],e=new Object;e.type=SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(-20,0)),e.positionPoints.push(new SuperMapAlgoPlot.Point(20,10)),e.positionPoints.push(new SuperMapAlgoPlot.Point(20,-10)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(e);var i=new Object;i.type=SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,i.positionPoints=[],i.positionPoints.push(new SuperMapAlgoPlot.Point(-5,0)),i.positionPoints.push(new SuperMapAlgoPlot.Point(17,0)),i.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(i);var o=new Object;return o.type=SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,o.positionPoints=[],o.positionPoints.push(new SuperMapAlgoPlot.Point(-2,1.5)),o.positionPoints.push(new SuperMapAlgoPlot.Point(-5,0)),o.positionPoints.push(new SuperMapAlgoPlot.Point(-2,-1.5)),o.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(o),t},supplyPoint:function(){var t=[],e=new Object;e.type=SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),e.positionPoints.push(new SuperMapAlgoPlot.Point(0,30)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1};var i=new Object;return i.type=SuperMapAlgoPlot.SymbolType.TEXTSYMBOL,i.positionPoints=[],i.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),i.textContent="补",i.style={surroundLineFlag:!1,fontSize:14,fontSizeLimit:!0},i.style.labelAlign="cm",t.push(i),t.push(e),t},takeoffPoint:function(){var t=[],e=new Object;return e.type=SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(-15,25)),e.positionPoints.push(new SuperMapAlgoPlot.Point(15,25)),e.positionPoints.push(new SuperMapAlgoPlot.Point(15,-25)),e.positionPoints.push(new SuperMapAlgoPlot.Point(0,-35)),e.positionPoints.push(new SuperMapAlgoPlot.Point(-15,-25)),e.positionPoints.push(new SuperMapAlgoPlot.Point(-15,25)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(e),t},initialPoint:function(){var t=[],e=new Object;return e.type=SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(-30,30)),e.positionPoints.push(new SuperMapAlgoPlot.Point(30,30)),e.positionPoints.push(new SuperMapAlgoPlot.Point(30,-30)),e.positionPoints.push(new SuperMapAlgoPlot.Point(-30,-30)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(e),t},visualInitalPoint:function(){var t=[],e=new Object;return e.type=SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(0,30)),e.positionPoints.push(new SuperMapAlgoPlot.Point(30,0)),e.positionPoints.push(new SuperMapAlgoPlot.Point(0,-30)),e.positionPoints.push(new SuperMapAlgoPlot.Point(-30,0)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(e),t},lanchPoint:function(){var t=[],e=new Object;return e.type=SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(0,30)),e.positionPoints.push(new SuperMapAlgoPlot.Point(20,-30)),e.positionPoints.push(new SuperMapAlgoPlot.Point(-20,-30)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(e),t},turningPoint:function(){var t=[],e=new Object;return e.type=SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),e.positionPoints.push(new SuperMapAlgoPlot.Point(0,30)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(e),t},aimingPoint:function(){var t=[],e=new Object;return e.type=SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(0,-30)),e.positionPoints.push(new SuperMapAlgoPlot.Point(20,30)),e.positionPoints.push(new SuperMapAlgoPlot.Point(-20,30)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(e),t},targetPoint:function(){var t=[],e=new Object;return e.type=SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(0,30)),e.positionPoints.push(new SuperMapAlgoPlot.Point(30,-30)),e.positionPoints.push(new SuperMapAlgoPlot.Point(-30,-30)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(e),t},eightSpiralPoint:function(){var t=[],e=new Object;e.type=SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(30,0)),e.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1};var i=new Object;return i.type=SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,i.positionPoints=[],i.positionPoints.push(new SuperMapAlgoPlot.Point(-30,0)),i.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),i.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(e),t.push(i),t},happyValleyPoint:function(){var t=[],e=new Object;e.type=SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(-30,20)),e.positionPoints.push(new SuperMapAlgoPlot.Point(30,20)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1};var i=new Object;i.type=SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,i.positionPoints=[],i.positionPoints.push(new SuperMapAlgoPlot.Point(30,-20)),i.positionPoints.push(new SuperMapAlgoPlot.Point(-30,-20)),i.style={surroundLineFlag:!1,fillLimit:!0,fill:!1};var o=new Object;o.type=SuperMapAlgoPlot.SymbolType.ARCSYMBOL,o.positionPoints=[],o.positionPoints.push(new SuperMapAlgoPlot.Point(-30,20)),o.positionPoints.push(new SuperMapAlgoPlot.Point(-50,0)),o.positionPoints.push(new SuperMapAlgoPlot.Point(-30,-20)),o.style={surroundLineFlag:!1,fillLimit:!0,fill:!1};var n=new Object;return n.type=SuperMapAlgoPlot.SymbolType.ARCSYMBOL,n.positionPoints=[],n.positionPoints.push(new SuperMapAlgoPlot.Point(30,20)),n.positionPoints.push(new SuperMapAlgoPlot.Point(50,0)),n.positionPoints.push(new SuperMapAlgoPlot.Point(30,-20)),n.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(e),t.push(i),t.push(o),t.push(n),t},attackPoint:function(){var t=[],e=new Object;e.type=SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),e.positionPoints.push(new SuperMapAlgoPlot.Point(0,30)),e.style={surroundLineFlag:!1,fillLimit:!0,fill:!1};var i=new Object;return i.type=SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,i.positionPoints=[],i.positionPoints.push(new SuperMapAlgoPlot.Point(0,20)),i.positionPoints.push(new SuperMapAlgoPlot.Point(20,-20)),i.positionPoints.push(new SuperMapAlgoPlot.Point(-20,-20)),i.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(i),t.push(e),t},suppressPoint:function(){var t=[],e=new Object;e.type=SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,e.positionPoints=[],e.positionPoints.push(new SuperMapAlgoPlot.Point(0,0)),e.positionPoints.push(new SuperMapAlgoPlot.Point(0,30)),e.style={surroundLineFlag:!1,fontSize:14};var i=new Object;return i.type=SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,i.positionPoints=[],i.positionPoints.push(new SuperMapAlgoPlot.Point(-15,15)),i.positionPoints.push(new SuperMapAlgoPlot.Point(15,15)),i.positionPoints.push(new SuperMapAlgoPlot.Point(15,-15)),i.positionPoints.push(new SuperMapAlgoPlot.Point(-15,-15)),i.style={surroundLineFlag:!1,fillLimit:!0,fill:!1},t.push(i),t.push(e),t},getRouteNodeCells:function(t,e,i){switch(t){case SuperMapAlgoPlot.RouteNodeType.RENDEZVOUS:return this.rendezvousPoint();case SuperMapAlgoPlot.RouteNodeType.EXPANDING:return this.expandingPoint();case SuperMapAlgoPlot.RouteNodeType.VOLLEY:return this.volleyPoint();case SuperMapAlgoPlot.RouteNodeType.STANDBY:return e?this.standbyPoint_Inner():this.standbyPoint_Outer(null,i);case SuperMapAlgoPlot.RouteNodeType.SUPPLY:return this.supplyPoint();case SuperMapAlgoPlot.RouteNodeType.TAKEOFF:return this.takeoffPoint();case SuperMapAlgoPlot.RouteNodeType.INITIAL:return this.initialPoint();case SuperMapAlgoPlot.RouteNodeType.VISUALINITAL:return this.visualInitalPoint();case SuperMapAlgoPlot.RouteNodeType.LANCH:case SuperMapAlgoPlot.RouteNodeType.WEAPONLAUNCH:return this.lanchPoint();case SuperMapAlgoPlot.RouteNodeType.TURNING:case SuperMapAlgoPlot.RouteNodeType.COMMONROUTE:return this.turningPoint();case SuperMapAlgoPlot.RouteNodeType.AIMING:return this.aimingPoint();case SuperMapAlgoPlot.RouteNodeType.TARGET:return this.targetPoint();case SuperMapAlgoPlot.RouteNodeType.ATTACK:return this.attackPoint();case SuperMapAlgoPlot.RouteNodeType.SUPPRESS:return this.suppressPoint();case SuperMapAlgoPlot.RouteNodeType.EIGHTSPIRAL:return this.eightSpiralPoint();case SuperMapAlgoPlot.RouteNodeType.HAPPYVALLEY:return this.happyValleyPoint();default:return[]}},getRouteNodeNameByType:function(t){switch(t){case SuperMapAlgoPlot.RouteNodeType.RENDEZVOUS:return"会合点";case SuperMapAlgoPlot.RouteNodeType.EXPANDING:return"展开点";case SuperMapAlgoPlot.RouteNodeType.VOLLEY:return"齐射点";case SuperMapAlgoPlot.RouteNodeType.STANDBY:return"待机点";case SuperMapAlgoPlot.RouteNodeType.SUPPLY:return"补给点";case SuperMapAlgoPlot.RouteNodeType.TAKEOFF:return"起飞点";case SuperMapAlgoPlot.RouteNodeType.INITIAL:return"初始点";case SuperMapAlgoPlot.RouteNodeType.VISUALINITAL:return"可视化初始点";case SuperMapAlgoPlot.RouteNodeType.LANCH:return"发射点";case SuperMapAlgoPlot.RouteNodeType.WEAPONLAUNCH:return"武器发射点";case SuperMapAlgoPlot.RouteNodeType.TURNING:return"转弯点";case SuperMapAlgoPlot.RouteNodeType.COMMONROUTE:return"普通航路点";case SuperMapAlgoPlot.RouteNodeType.AIMING:return"目标瞄准点";case SuperMapAlgoPlot.RouteNodeType.TARGET:return"目标点";case SuperMapAlgoPlot.RouteNodeType.ATTACK:return"攻击点";case SuperMapAlgoPlot.RouteNodeType.SUPPRESS:return"压制点";case SuperMapAlgoPlot.RouteNodeType.EIGHTSPIRAL:return"八字盘旋点";case SuperMapAlgoPlot.RouteNodeType.HAPPYVALLEY:return"跑马圈点";default:return""}}};var to=SuperMapAlgoPlot.AddPoint_WayType={UNKNOWN:0,POLYLINE:1,CURVE:2,CURVE_WITHCONTROLPT:3,POLYLINE_CLOSE:4,CURVE_CLOSE:5};function eo(t){"@babel/helpers - typeof";return(eo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function io(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,oo(o.key),o)}}function oo(t){var e=function(t,e){if("object"!=eo(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=eo(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==eo(e)?e:e+""}var no=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.m_pData=null,this.CLASS_NAME="SuperMapAlgoPlot.Path2D"},i=[{key:"mtRef",value:function(t){return 0!=++t}},{key:"mtDeRef",value:function(t){return 0!=--t}}],(e=[{key:"MoveTo",value:function(t){this.ensureData(),this.detach();var e=this.getDataPtr();if(e.require_StartNewFigure=!1,0==e.elements[e.elements.length-1].GetType())e.elements[e.elements.length-1].SetPosition(t.x,t.y);else{var i=new SuperMapAlgoPlot.Element(t.x,t.y,0);e.elements.push(i)}e.cStart=e.elements.length-1}},{key:"LineTo",value:function(t){this.ensureData(),this.detach();var e=this.getDataPtr();if(e.MaybeStartNewFigure(),e.elements[e.elements.length-1].GetX()!=t.x||e.elements[e.elements.length-1].GetY()!=t.y){var i=new SuperMapAlgoPlot.Element(t.x,t.y,1);e.elements.push(i)}}},{key:"CurveTo",value:function(t,e,i){this.ensureData(),this.detach();var o=this.getDataPtr();if(o.elements[o.elements.length-1].GetX()!=t.x||o.elements[o.elements.length-1].GetY()!=t.y||t.x!=e.x||t.y!=e.y||e.x!=i.x||e.y!=i.y){o.MaybeStartNewFigure();var n=new SuperMapAlgoPlot.Element(t.x,t.y,2),l=new SuperMapAlgoPlot.Element(e.x,e.y,3),s=new SuperMapAlgoPlot.Element(i.x,i.y,3);o.elements.push(n),o.elements.push(l),o.elements.push(s)}}},{key:"CubicTo",value:function(t,e,i){this.ensureData(),this.detach();var o=this.getDataPtr();if(o.elements[o.elements.length-1].GetX()!=t.x||o.elements[o.elements.length-1].GetY()!=t.y||t.x!=e.x||t.y!=e.y||e.x!=i.x||e.y!=i.y){o.MaybeStartNewFigure();var n=new SuperMapAlgoPlot.Element(t.x,t.y,2),l=new SuperMapAlgoPlot.Element(e.x,e.y,3),s=new SuperMapAlgoPlot.Element(i.x,i.y,3);o.elements.push(n),o.elements.push(l),o.elements.push(s)}}},{key:"ToSubPathPolygons",value:function(t){var e,i,o=this.getDataPtr();if(this.IsEmpty())return!1;for(var n=[],l=this.GetElementCount(),s=0;s<l;s++){var a=o.elements[s];switch(a.GetType()){case 0:n.length>1&&t.push(n),n=[],e=a.GetX(),i=a.GetY(),n.push(new SuperMapAlgoPlot.Point(e,i));break;case 1:e=a.GetX(),i=a.GetY(),n.push(new SuperMapAlgoPlot.Point(e,i));break;case 2:if(3!=o.elements[s+1].GetType()||3!=o.elements[s+1].GetType())break;for(var r=o.elements[s-1].GetX(),u=o.elements[s-1].GetY(),p=a.GetX(),h=a.GetY(),c=o.elements[s+1].GetX(),y=o.elements[s+1].GetY(),g=o.elements[s+2].GetX(),f=o.elements[s+2].GetY(),d=0;d<=1;d+=.03125){var m=d*d,S=m*d,P=1-3*d+3*m-S,b=3*(d-2*m+S),v=3*(m-S),L=S;n.push(new SuperMapAlgoPlot.Point(P*r+b*p+v*c+L*g,P*u+b*h+v*y+L*f))}s+=2}}return n.length>1&&t.push(n),!0}},{key:"ensureData",value:function(){null==this.m_pData&&this.ensureData_helper()}},{key:"ensureData_helper",value:function(){var t=new SuperMapAlgoPlot.Path2DData,e=new SuperMapAlgoPlot.Element(0,0,0);t.elements.push(e),null==this.m_pData||this.mtDeRef(this.m_pData.ref)||(this.m_pData=null),this.m_pData=t}},{key:"detach",value:function(){1!=this.m_pData.ref&&this.detach_helper(),this.setBoundsDirty(!0)}},{key:"detach_helper",value:function(){var t=new SuperMapAlgoPlot.Path2DData;null==this.m_pData||this.mtDeRef(this.m_pData.ref)||(this.m_pData=null),this.m_pData=t}},{key:"setBoundsDirty",value:function(t){this.getDataPtr().isBoundsDirty=t}},{key:"getDataPtr",value:function(){return this.m_pData}},{key:"IsEmpty",value:function(){if(null==this.m_pData)return!0;var t=this.m_pData.elements.length;return 0==t||1==t&&0==this.m_pData.elements[0].GetType()}},{key:"GetElementCount",value:function(){return null!=this.m_pData?this.m_pData.elements.length:0}}])&&io(t.prototype,e),i&&io(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function lo(t){"@babel/helpers - typeof";return(lo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function so(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ao(o.key),o)}}function ao(t){var e=function(t,e){if("object"!=lo(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=lo(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==lo(e)?e:e+""}SuperMapAlgoPlot.Path2D=no;var ro=function(){return t=function t(e,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.m_x=e,this.m_y=i,this.m_type=o,this.CLASS_NAME="SuperMapAlgoPlot.Element"},(e=[{key:"GetX",value:function(){return this.m_x}},{key:"GetY",value:function(){return this.m_y}},{key:"GetType",value:function(){return this.m_type}},{key:"GetPosition",value:function(){return SuperMapAlgoPlot.Point(this.m_x,this.m_y)}},{key:"SetPosition",value:function(t,e){this.m_x=t,this.m_y=e}},{key:"SetType",value:function(t){this.m_type=t}},{key:"IsCurveTo",value:function(){return 2==this.m_type}},{key:"IsLineTo",value:function(){return 1==this.m_type}},{key:"IsMoveTo",value:function(){return 0==this.m_type}},{key:"Equal",value:function(t){return SuperMapAlgoPlot.PlottingUtil.equalFuzzy(this.m_x,t.m_x,1e-10)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(this.m_y,t.m_y,1e-10)&&this.m_type==t.m_type}},{key:"clone",value:function(){return new SuperMapAlgoPlot.Path2D.Element(this.m_x,this.m_y,this.m_type)}}])&&so(t.prototype,e),i&&so(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function uo(t){"@babel/helpers - typeof";return(uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function po(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ho(o.key),o)}}function ho(t){var e=function(t,e){if("object"!=uo(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=uo(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==uo(e)?e:e+""}SuperMapAlgoPlot.Element=ro;var co=function(){return t=function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e){this.cStart=e.cStart,this.fillRule=e.fillRule,this.require_StartNewFigure=e.require_StartNewFigure,this.isBoundsDirty=e.isBoundsDirty,this.bounds=new SuperMap.Bounds(e.bounds.left,e.bounds.bottom,e.bounds.right,e.bounds.top),this.ref=1,this.elements=[];for(var i=0;i<e.elements.length;i++)this.elements.push(e.elements[i].clone())}else this.ref=1,this.bounds=new SuperMap.Bounds(0,0,0,0),this.elements=[];this.CLASS_NAME="SuperMapAlgoPlot.Path2DData"},(e=[{key:"IsClosed",value:function(){var t=this.elements[this.cStart],e=this.elements[this.elements.length-1];return t.GetX()==e.GetX()&&t.GetY()==e.GetY()}},{key:"Close",value:function(){this.require_StartNewFigure=!0;var t=this.elements[this.cStart],e=this.elements[this.elements.length-1];t!=e&&(t.Equal(e)?e.SetPosition(t.GetX(),t.GetY()):this.elements.push(new SuperMapAlgoPlot.Element(t.GetX(),t.GetY(),SuperMapAlgoPlot.ElementType.LineToElement)))}},{key:"MaybeStartNewFigure",value:function(){if(this.require_StartNewFigure){var t=this.elements[this.elements.length-1].clone();t.SetType(0),this.elements.push(t),this.require_StartNewFigure=!1}}}])&&po(t.prototype,e),i&&po(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();SuperMapAlgoPlot.Path2DData=co;SuperMapAlgoPlot.ArrowToolkit=SuperMapAlgoPlot.ArrowToolkit||{};function yo(t){"@babel/helpers - typeof";return(yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function go(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,fo(o.key),o)}}function fo(t){var e=function(t,e){if("object"!=yo(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=yo(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==yo(e)?e:e+""}SuperMapAlgoPlot.ArrowToolkit.ConstValue={MAX_ARRAY_SIZE:128,sv_AtScaleParameter:1.5,sv_AtLenDivAtWidth:1.35,sv_AtWidthDivAwWidth:.5,DUOJIANTOU_TAIL_RATE_1:8,DUOJIANTOU_TAIL_RATE_2:3,DUOJIANTOU_TAIL_RATE_3:.6},SuperMapAlgoPlot.ArrowToolkit.ArrowTailType={ARROWTAIL_NONE:0,ARROWTAIL_LINE:1,ARROWTAIL_CURVE:2,ARROWTAIL_COATTAIL:3,ARROWTAIL_COATTAIL_POLYBODY:4},SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType={ARROWHEAD_POLYLINE:0,ARROWHEAD_TRIANGLE:1,ARROWHEAD_COATTAIL:2,ARROWHEAD_TRIANGLE_SOLID:3,ARROWHEAD_COATTAIL_HOLLOW:6,ARROWHEAD_WITH_EAR:4,ARROWHEAD_WITHOUT_EAR:5},SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType={ARROWBODY_POLYLINE:0,ARROWBODY_POLYBEZIER:1,ARROWBODY_COATTAIL:5,ARROWBODY_PARALLEL:2,ARROWBODY_TRAPEZOID:3,ARROWBODY_MULTIPOLYBEZIER:4},SuperMapAlgoPlot.ArrowToolkit.parallel=function(t,e){var i={leftParallelPts:[],rightParallelPts:[]};return 1===t.length||2===t.length&&t[0].x===t[1].x&&t[0].y===t[1].y?i:(i.leftParallelPts=SuperMapAlgoPlot.PlottingUtil.parallel(t,e),i.rightParallelPts=SuperMapAlgoPlot.PlottingUtil.parallel(t,-e),i)},SuperMapAlgoPlot.ArrowToolkit.trapezoid=function(t,e,i){var o={leftParallelPts:[],rightParallelPts:[]};if(1===t.length||2===t.length&&t[0].x===t[1].x&&t[0].y===t[1].y)return o;for(var n=0;n<t.length-1;n++){t[n].x===t[n+1].x&&t[n].y===t[n+1].y&&(o.leftParallelPts.push(o.leftParallelPts[o.leftParallelPts.length-1]),o.rightParallelPts.push(o.rightParallelPts[o.rightParallelPts.length-1]));var l=t[n+1];l=SuperMapAlgoPlot.PlottingUtil.rotate(t[n],0,1,l),o.leftParallelPts.push(SuperMapAlgoPlot.PlottingUtil.findPointInLine(t[n],l,e)),l=t[n],l=SuperMapAlgoPlot.PlottingUtil.rotate(t[n+1],0,-1,l),o.leftParallelPts.push(SuperMapAlgoPlot.PlottingUtil.findPointInLine(t[n+1],l,i)),l=t[n+1],l=SuperMapAlgoPlot.PlottingUtil.rotate(t[n],0,-1,l),o.rightParallelPts.push(SuperMapAlgoPlot.PlottingUtil.findPointInLine(t[n],l,e)),l=t[n],l=SuperMapAlgoPlot.PlottingUtil.rotate(t[n+1],0,1,l),o.rightParallelPts.push(SuperMapAlgoPlot.PlottingUtil.findPointInLine(t[n+1],l,i))}return o},SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePts=function(t,e,i){var o={};switch(t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts,i){case SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_PARALLEL:case SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_TRAPEZOID:var n=e[0],l=e[1],s=e[2],a=SuperMapAlgoPlot.PlottingUtil.equalFuzzy(s,0);if(!a&&t.length>2){var r=t.length;t.splice(2,r-2)}var u=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t);o.arrowTouLen=u*n;for(var p=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(t,u-o.arrowTouLen).pt,h=[],c=o.arrowTouLen*s,y=o.arrowTouLen*l,g=t.length-1,f=0;f<g;f++)h.push(t[f]);h.push(p);var d={leftParallelPts:[],rightParallelPts:[]};d=!0===a?SuperMapAlgoPlot.ArrowToolkit.parallel(h,y):SuperMapAlgoPlot.ArrowToolkit.trapezoid(h,c,y);var m=t[t.length-1];t[t.length-1]=p,t.push(m);o.leftBodyPts=d.leftParallelPts,o.rightBodyPts=d.rightParallelPts,o.OpectrlPoints=null;break;case SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_MULTIPOLYBEZIER:var S=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t);if(0==S)return;var P=SuperMapAlgoPlot.ArrowToolkit.OperateCtrlPts(t),b=P.length;b--;var v=SuperMapAlgoPlot.ArrowToolkit.generateMultiBezier(P,b,e,S);t=[];for(var L=0;L<P.length;L++)t.push(P[L]);o.arrowTouLen=v.arrowTouLen,o.leftBodyPts=v.leftBodyPts,o.rightBodyPts=v.rightBodyPts,o.OpectrlPoints=P}return t=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(t),o.leftBodyPts=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(o.leftBodyPts),o.rightBodyPts=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(o.rightBodyPts),o.OpectrlPoints=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(o.OpectrlPoints),o},SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone=function(t){var e=!0,i=[];if(t.length<=1)return{pts:t,isEast:e};var o=!1;if(void 0!==t[t.length-1].z&&(o=!0),!o)return{pts:t,isEast:e};for(var n=0;n<t.length;n++){var l=new SuperMapAlgoPlot.Point(t[n].x,t[n].y);l.z=t[n].z,i.push(l)}for(var s=SuperMapAlgoPlot.PlottingUtil.clonePoints(i),a=[],r=[],u=0;u<s.length-1;u++)s[u+1].x-s[0].x>-360&&s[u+1].x-s[0].x<-180&&a.push(u+1),s[u+1].x-s[0].x<360&&s[u+1].x-s[0].x>180&&r.push(u+1);if(r.length>a.length){for(var p=0;p<r.length;p++)s[r[p]].x=s[r[p]].x-360;e=!1}else{for(var h=0;h<a.length;h++)s[a[h]].x=s[a[h]].x+360;e=!0}return{pts:s,isEast:e}},SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone=function(t){if(null===t||t.length<=1)return t;var e=!1;if(void 0!==t[0].z&&(e=!0),!e)return t;for(var i=[],o=0;o<t.length;o++){var n=new SuperMapAlgoPlot.Point(t[o].x,t[o].y);n.z=t[o].z,i.push(n)}for(var l=SuperMapAlgoPlot.PlottingUtil.clonePoints(i),s=0;s<l.length;s++)l[s].x>180?l[s].x=l[s].x-360:l[s].x<-180&&(l[s].x=l[s].x+360);return l},SuperMapAlgoPlot.ArrowToolkit.eastCrossZone=function(t){var e=!1;if(void 0!==t[0].z&&(e=!0),!e)return t;for(var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),o=0;o<i.length;o++)i[o].x<0&&i[o].x>-180&&(i[o].x=i[o].x+360);return i},SuperMapAlgoPlot.ArrowToolkit.westCrossZone=function(t){var e=!1;if(void 0!==t[0].z&&(e=!0),!e)return t;for(var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),o=0;o<i.length;o++)i[o].x>0&&i[o].x<180&&(i[o].x=i[o].x-360);return i},SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePts=function(t,e,i,o,n){var l=[];switch(t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts,e=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(e).pts,n){case SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_WITH_EAR:case SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_WITHOUT_EAR:var s=i[0],a=i[1],r=0,u=0;3==i.length&&(r=i[2]),4==i.length&&(r=i[2],u=i[3]);var p=0;if(!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(r,0)&&!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(u,0)){var h=SuperMapAlgoPlot.PlottingUtil.clonePoints(t);h.splice(h.length-1,1),p=SuperMapAlgoPlot.PlottingUtil.polylineDistance(h)*r*u}var c=new SuperMapAlgoPlot.Point((e[0].x+e[1].x)/2,(e[0].y+e[1].y)/2);if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(a,0)){var y=o*s,g=t[t.length-1];return g=SuperMapAlgoPlot.PlottingUtil.rotate(c,0,1,g),l.push(SuperMapAlgoPlot.PlottingUtil.findPointInLine(c,g,y)),l.push(t[t.length-1]),g=t[t.length-1],g=SuperMapAlgoPlot.PlottingUtil.rotate(c,0,-1,g),l.push(SuperMapAlgoPlot.PlottingUtil.findPointInLine(c,g,y)),t=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(t),l=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(l)}var f=o*a,d=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(f,c,t[t.length-1]);f=o*s,f+=p;var m=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(f,t[t.length-1],d),S=m.pntLeft,P=m.pntRight,b=t[t.length-1];return l.push(P),l.push(b),l.push(S),t=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(t),l=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(l)}},SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePtsBySingleLine=function(t,e,i,o){var n=[];if(2>t.length)return n;t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts;var l,s=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t),a=SuperMapAlgoPlot.PlottingUtil.equalFuzzy(e,0);switch(i){case SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_POLYLINE:n=n.concat(t),o&&!a&&SuperMapAlgoPlot.PlottingUtil.distance(t[t.length-1],t[t.length-2])>e&&(l=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(t,s-e),n.splice(n.length-1,1),n.push(l.pt));break;case SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_POLYBEZIER:if(2==t.length)n=n.concat(t),o&&!a&&SuperMapAlgoPlot.PlottingUtil.distance(t[t.length-1],t[t.length-2])>e&&(l=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(t,s-e),n.splice(n.length-1,1),n.push(l.pt));else{var r=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t),u=SuperMapAlgoPlot.PlottingUtil.polylineDistance(r);if(a)n=n.concat(r);else{var p=r[r.length-1];if(!a&&(e<u||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(u,e,1e-7))){for(var h=r.length-1;h>1;h--){if(!(e>SuperMapAlgoPlot.PlottingUtil.distance(p,r[h]))){var c=SuperMapAlgoPlot.PlottingUtil.findPoint(p,r[h],e,0);r.push(c),n=r;break}r.splice(h,1)}o||n.push(p)}else n=n.concat(r)}}break;case SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_COATTAIL:var y=e;if(y>s)return n;for(var g,f,d=Math.ceil(s/(1.4*y)),m=0,S=[],P=0;P<d;P++)g=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(y*m,t),f=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(y*(m+1),t),g.bfind&&f.bfind&&(S.push(g.pts),S.push(f.pts)),m=1.4*(P+1);n=S}return n=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(n)},SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePtsBySingleLine=function(t,e,i){var o=[];if(2>t.length)return o;switch(t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts,i){case SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_POLYLINE:var n=t[0],l=t[1],s=SuperMapAlgoPlot.PlottingUtil.distance(n,l);if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(s,e,1e-7)||s>e){var a=SuperMapAlgoPlot.PlottingUtil.findPoint(n,l,e,0),r=e*Math.tan(.125*Math.PI),u=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(r,t[0],a);o.push(u.pntLeft),o.push(t[0]),o.push(u.pntRight)}break;case SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_TRIANGLE:break;case SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_TRIANGLE_SOLID:var p=t[0],h=t[1],c=SuperMapAlgoPlot.PlottingUtil.distance(p,h);if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(c,e,1e-7)||c>e){var y=e*Math.tan(.125*Math.PI),g=SuperMapAlgoPlot.PlottingUtil.findPoint(p,h,e,0),f=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(y,t[0],g);o.push(f.pntLeft),o.push(p),o.push(f.pntRight),o.push(f.pntLeft)}else{h=t[2];var d=e*Math.tan(.125*Math.PI),m=SuperMapAlgoPlot.PlottingUtil.findPoint(p,h,e,0),S=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(d,t[0],m);o.push(S.pntLeft),o.push(p),o.push(S.pntRight),o.push(S.pntLeft)}break;case SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_COATTAIL:var P=t[0],b=2*Math.sqrt(e*e/3),v=SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[1]);if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(b/2,v,1e-7)||v>b/2){var L=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],b,-20),M=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],b,20),_=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],b/2,0);o.push(P),o.push(M),o.push(_),o.push(L),o.push(P)}else{P=t[2];var A=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],b,20),T=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],b,-20),x=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],b/2,0);o.push(P),o.push(A),o.push(x),o.push(T),o.push(P)}break;case SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_COATTAIL_HOLLOW:var O=[],w=t[0],C=2*Math.sqrt(e*e/3),E=SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[1]);if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(C/1.4,E,1e-7)||E>C/1.4){var I=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],C,20),D=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],C,-20),U=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],C/1.4,0);O.push(w),O.push(I),O.push(U),O.push(D),O.push(w);var R=new SuperMapAlgoPlot.Point((O[0].x+O[1].x)/2,(O[0].y+O[1].y)/2),N=new SuperMapAlgoPlot.Point((O[3].x+O[4].x)/2,(O[3].y+O[4].y)/2),B=new SuperMapAlgoPlot.Point((R.x+N.x)/2,(R.y+N.y)/2),k=.75*SuperMapAlgoPlot.PlottingUtil.distance(R,N)/2,F=SuperMapAlgoPlot.PlottingUtil.findPointInLine(B,R,k),j=SuperMapAlgoPlot.PlottingUtil.findPointInLine(B,N,k);o.push(O[0]),o.push(F),o.push(O[1]),o.push(O[2]),o.push(O[3]),o.push(j),o.push(O[4])}else{w=t[0];var V=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],C,20),z=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],C,-20),Y=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],C/1.4,0);O.push(w),O.push(V),O.push(Y),O.push(z),O.push(w);R=new SuperMapAlgoPlot.Point((O[0].x+O[1].x)/2,(O[0].y+O[1].y)/2),N=new SuperMapAlgoPlot.Point((O[3].x+O[4].x)/2,(O[3].y+O[4].y)/2),B=new SuperMapAlgoPlot.Point((R.x+N.x)/2,(R.y+N.y)/2),k=.75*SuperMapAlgoPlot.PlottingUtil.distance(R,N)/2,F=SuperMapAlgoPlot.PlottingUtil.findPointInLine(B,R,k),j=SuperMapAlgoPlot.PlottingUtil.findPointInLine(B,N,k);o.push(O[0]),o.push(F),o.push(O[1]),o.push(O[2]),o.push(O[3]),o.push(j),o.push(O[4])}}return o=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(o)},SuperMapAlgoPlot.ArrowToolkit.generateArrowTailShapePts=function(t,e,i,o){var n=e.length,l=[],s=0;t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts;for(var a=0;a<t.length-1;a++)s+=SuperMapAlgoPlot.PlottingUtil.distance(t[a],t[a+1]);var r=s*i;switch(o){case SuperMapAlgoPlot.ArrowToolkit.ArrowTailType.ARROWTAIL_NONE:break;case SuperMapAlgoPlot.ArrowToolkit.ArrowTailType.ARROWTAIL_LINE:var u=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],r,90),p=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],r,-90);l.push(u),l.push(p);break;case SuperMapAlgoPlot.ArrowToolkit.ArrowTailType.ARROWTAIL_CURVE:var h=new SuperMapAlgoPlot.Point(.5*(e[0].x+e[n-1].x),.5*(e[0].y+e[n-1].y)),c=SuperMapAlgoPlot.PlottingUtil.distance(e[0],e[n-1]),y=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(c*i,h,t[t.length-1]),g=new SuperMapAlgoPlot.Point(0,0),f=new SuperMapAlgoPlot.Point(0,0);SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(SuperMapAlgoPlot.ArrowToolkit.ConstValue.DUOJIANTOU_TAIL_RATE_1,SuperMapAlgoPlot.ArrowToolkit.ConstValue.DUOJIANTOU_TAIL_RATE_2,e[0],y,e[n-1],g,f);var d=new SuperMapAlgoPlot.Point(0,0);SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(SuperMapAlgoPlot.ArrowToolkit.ConstValue.DUOJIANTOU_TAIL_RATE_3,e[0],y,g,d);var m=new SuperMapAlgoPlot.Point(0,0);SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(SuperMapAlgoPlot.ArrowToolkit.ConstValue.DUOJIANTOU_TAIL_RATE_3,e[n-1],y,f,m);break;case SuperMapAlgoPlot.ArrowToolkit.ArrowTailType.ARROWTAIL_COATTAIL:var S=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],r,157.5),P=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],r,-157.5);l.push(S),l.push(t[0]),l.push(P);break;case SuperMapAlgoPlot.ArrowToolkit.ArrowTailType.ARROWTAIL_COATTAIL_POLYBODY:var b=new SuperMapAlgoPlot.Point(.5*(e[0].x+e[n-1].x),.5*(e[0].y+e[n-1].y)),v=SuperMapAlgoPlot.PlottingUtil.distance(e[0],e[n-1]),L=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(v*i,e[0],b);l.push(e[n-1]),l.push(L.pntLeft),l.push(e[0])}return t=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(t),l=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(l)},SuperMapAlgoPlot.ArrowToolkit.generateArrowTailShapePtsBySingleLine=function(t,e,i){var o=[];switch(t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts,i){case SuperMapAlgoPlot.ArrowToolkit.ArrowTailType.ARROWTAIL_NONE:break;case SuperMapAlgoPlot.ArrowToolkit.ArrowTailType.ARROWTAIL_LINE:var n=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],e,90),l=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],e,-90);o.push(n),o.push(l);break;case SuperMapAlgoPlot.ArrowToolkit.ArrowTailType.ARROWTAIL_COATTAIL:var s=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],e,157.5),a=SuperMapAlgoPlot.PlottingUtil.findPoint(t[0],t[1],e,-157.5);o.push(s),o.push(t[0]),o.push(a)}return o=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(o)},SuperMapAlgoPlot.ArrowToolkit.OperateCtrlPts=function(t){var e=SuperMapAlgoPlot.PlottingUtil.clonePoints(t);if(3==e.length){var i=((e[0].x+e[1].x)/2+e[2].x)/2,o=((e[0].y+e[1].y)/2+e[2].y)/2,n=new SuperMapAlgoPlot.Point(i,o),l=e[2].clone();e[2]=n,e.push(l)}return e},SuperMapAlgoPlot.ArrowToolkit.generateMultiBezier=function(t,e,i,o){var n=0,l=[],s=[],a=[],r=[],u=[],p=[],h=i[0],c=i[1],y=(t[0].x+t[1].x)/2,g=(t[0].y+t[1].y)/2,f=Math.abs(y-t[2].x),d=Math.abs(g-t[2].y),m=0;if(f>0&&d>0){var S=1/(y-t[2].x),P=-1/(g-t[2].y),b=1*t[2].y/(g-t[2].y)-1*t[2].x/(y-t[2].x);m=Math.abs(S*t[0].x+P*t[0].y+b)/Math.sqrt(S*S+P*P)}else d<=1e-4?m=Math.abs(g-t[1].y):f<=1e-4&&(m=Math.abs(y-t[1].x));var v=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(m,t[2],new SuperMapAlgoPlot.Point(y,g)),L=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(t[1],t[2],t[0]);L?(l[1]=t[1],s[1]=t[0]):(l[1]=t[0],s[1]=t[1]),t[1]=new SuperMapAlgoPlot.Point((t[0].x+t[1].x)/2,(t[0].y+t[1].y)/2);var M=Math.sqrt((v.pntLeft.x-v.pntRight.x)*(v.pntLeft.x-v.pntRight.x)+(v.pntLeft.y-v.pntRight.y)*(v.pntLeft.y-v.pntRight.y))*SuperMapAlgoPlot.ArrowToolkit.ConstValue.sv_AtWidthDivAwWidth,_=(n=M*SuperMapAlgoPlot.ArrowToolkit.ConstValue.sv_AtLenDivAtWidth)*c;SuperMapAlgoPlot.PlottingUtil.equalFuzzy(h,0)||(_=(n=o*h)*c);var A,T,x=SuperMapAlgoPlot.PlottingUtil.distance(t[e],t[e-1]),O=2*n;x<O&&(_=(n=x/2)*c),t.push(t[e]),A=0,T=0;var w=0,C=[];for(w=2;w<=e;w++)A+=SuperMapAlgoPlot.PlottingUtil.distance(t[w],t[w-1]);for(A-=n,w=2;w<=e-1;w++)T+=SuperMapAlgoPlot.PlottingUtil.distance(t[w],t[w-1]),C[w]=_+(M-_)*Math.pow((A-T)/A,SuperMapAlgoPlot.ArrowToolkit.ConstValue.sv_AtScaleParameter);C[e]=_;var E,I,D=new SuperMapAlgoPlot.Point(0,0),U=new SuperMapAlgoPlot.Point(0,0),R=new SuperMapAlgoPlot.Point(0,0);for(w=2;w<=e-1;w++)SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(0,3,t[w-1],t[w],t[w+1],U,R),w==e-1&&SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,t[e],t[e-1],R,D),E=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(C[w],U,t[w]),(L=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(R,U,E.pntRight))?(l[w]=new SuperMapAlgoPlot.Point(E.pntRight.x,E.pntRight.y),s[w]=new SuperMapAlgoPlot.Point(E.pntLeft.x,E.pntLeft.y)):(l[w]=new SuperMapAlgoPlot.Point(E.pntLeft.x,E.pntLeft.y),s[w]=new SuperMapAlgoPlot.Point(E.pntRight.x,E.pntRight.y));for(Math.sqrt(1*(t[e].x-D.x)*(t[e].x-D.x)+1*(t[e].y-D.y)*(t[e].y-D.y))>0&&(t[e]=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(n,t[e],D)),E=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(_,t[e+1],t[e]),(L=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(t[e],t[e+1],E.pntLeft))?(s[e]=new SuperMapAlgoPlot.Point(E.pntLeft.x,E.pntLeft.y),l[e]=new SuperMapAlgoPlot.Point(E.pntRight.x,E.pntRight.y)):(s[e]=new SuperMapAlgoPlot.Point(E.pntRight.x,E.pntRight.y),l[e]=new SuperMapAlgoPlot.Point(E.pntLeft.x,E.pntLeft.y)),w=2;w<e;w++)SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(3,3,l[w-1],l[w],l[w+1],U,R),a[w]=new SuperMapAlgoPlot.Point(U.x,U.y),r[w]=new SuperMapAlgoPlot.Point(R.x,R.y),SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(3,3,s[w-1],s[w],s[w+1],U,R),u[w]=new SuperMapAlgoPlot.Point(U.x,U.y),p[w]=new SuperMapAlgoPlot.Point(R.x,R.y),2==w&&(SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,l[1],l[2],a[2],D),r[1]=new SuperMapAlgoPlot.Point(D.x,D.y),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,s[1],s[2],u[2],D),p[1]=new SuperMapAlgoPlot.Point(D.x,D.y)),w==e-1&&(O=(x=SuperMapAlgoPlot.PlottingUtil.distance(l[e],l[e-1]))/3,(I=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(O,t[e],t[e+1])).x+=l[e].x-t[e].x,I.y+=l[e].y-t[e].y,O=(x=M-_)*Math.pow(O/A,SuperMapAlgoPlot.ArrowToolkit.ConstValue.sv_AtScaleParameter),E=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(O,l[e],I),a[e]=new SuperMapAlgoPlot.Point(E.pntLeft.x,E.pntLeft.y),O=(x=SuperMapAlgoPlot.PlottingUtil.distance(s[e],s[e-1]))/3,(I=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(O,t[e],t[e+1])).x+=s[e].x-t[e].x,I.y+=s[e].y-t[e].y,O=(x=M-_)*Math.pow(O/A,SuperMapAlgoPlot.ArrowToolkit.ConstValue.sv_AtScaleParameter),E=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(O,s[e],I),u[e]=new SuperMapAlgoPlot.Point(E.pntRight.x,E.pntRight.y));return{arrowTouLen:n,leftBodyPts:SuperMapAlgoPlot.ArrowToolkit.genArrowBody(e,l,a,r),rightBodyPts:SuperMapAlgoPlot.ArrowToolkit.genArrowBody(e,s,u,p)}},SuperMapAlgoPlot.ArrowToolkit.genArrowBody=function(t,e,i,o){var n=new SuperMapAlgoPlot.Path2D;if(!(t<2)){n.MoveTo(e[1]);for(var l=1;l<=t-1;l++)n.CubicTo(o[l],i[l+1],e[l+1]);var s=[];return n.ToSubPathPolygons(s),s[0]}};var mo=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e=e||{},this.style=null,this.libID=e.libID?e.libID:0,this.code=e.code?e.code:0,this.maxEditPts=e.maxEditPts?e.maxEditPts:SuperMapAlgoPlot.AlgoSymbolFactory.getMaxEditPts(e.libID,e.code),this.minEditPts=e.minEditPts?e.minEditPts:SuperMapAlgoPlot.AlgoSymbolFactory.getMinEditPts(e.libID,e.code),this.isEdit=!!e.isEdit&&e.isEdit,this.controlPoints=e.controlPoints?e.controlPoints:[],this.scalePoints=e.scalePoints?e.scalePoints:[],this.scaleValues=e.scaleValues?e.scaleValues:[],this.subSymbols=e.subSymbols?e.subSymbols:SuperMapAlgoPlot.AlgoSymbolFactory.getDefaultSubSymbols(e.libID,e.code),this.polylineConnectLocationPoint=!!e.polylineConnectLocationPoint&&e.polylineConnectLocationPoint,this.style=e.style?e.style:SuperMapAlgoPlot.PlottingUtil.copyAttributes(this.style,SuperMapAlgoPlot.AlgoSymbolFactory.getDefaultStyle(e.libID,e.code)),this.textContent=e.textContent?e.textContent:"",this.map=e.map?e.map:null,this.scene=e.scene?e.scene:null,this.subSymbolDefaultPixelSize=e.subSymbolDefaultPixelSize?e.subSymbolDefaultPixelSize:30,this.symScaleDefinition=e.symScaleDefinition?e.symScaleDefinition:1,this.components=[],this.dashLines=e.dashLines?e.dashLines:[],this.symbolType=0===this.libID?this.code:2},(e=[{key:"addScalePoint",value:function(t,e){if(null!=t){void 0!==e&&null!==e||(e=this.scalePoints.length);var i=new SuperMapAlgoPlot.Point(t.x,t.y);i.isScalePoint=!0,i.tag=e,this.scalePoints.push(i)}}},{key:"setOptions",value:function(t){if(t)for(var e in this)t[e]&&(this[e]=t[e])}},{key:"getAlgorithmResult",value:function(t){t.components=this.components,t.scalePoints=this.scalePoints,t.scaleValues=this.scaleValues}},{key:"destroy",value:function(){this.minEditPts=null,this.maxEditPts=null,this.controlPoints.length=0,this.controlPoints=null,this.scalePoints.length=0,this.scalePoints=null,this.scaleValues.length=0,this.scaleValues=null,this.subSymbols.length=0,this.subSymbols=null,this.subSymbolSize=0,this.dashLines=[],this.components=null,this.style=null}},{key:"init",value:function(){if(this.components.length=0,this.scalePoints.length=0,this.controlPoints.length>=2&&this.controlPoints.length<this.minEditPts&&this.calAssistantLine(),this.maxEditPts<this.controlPoints.length&&this.symbolType!==SuperMapAlgoPlot.SymbolType.ELLIPSESYMBOL){var t=this.controlPoints.shift(),e=this.controlPoints.pop();this.controlPoints=[],this.controlPoints.push(t,e)}}},{key:"finish",value:function(){}},{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(this.controlPoints);if(t=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),this.controlPoints.length>=this.minEditPts){var e={textContent:this.textContent,type:this.symbolType,surroundLineFlag:!1,positionPoints:t,style:{}};if(e.type===SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL&&e.positionPoints.push(e.positionPoints[0]),this.symbolType===SuperMapAlgoPlot.SymbolType.PARALLELLINE){if(this.controlPoints&&this.controlPoints.length>=3){var i=!1;void 0!==this.controlPoints[0].z&&(i=!0);var o=SuperMapAlgoPlot.PlottingUtil.distance(this.controlPoints[0],this.controlPoints[1]);SuperMapAlgoPlot.PlottingUtil.isRight(this.controlPoints[0],this.controlPoints[1],this.controlPoints[2])&&(o=-o);for(var n=[],l=1;l<this.controlPoints.length;l++)n.push(this.controlPoints[l].clone());var s=SuperMapAlgoPlot.PlottingUtil.parallel(n,o);if(this.controlPoints[0].x=s[0].x,this.controlPoints[0].y=s[0].y,i)for(var a=0;a<n.length;a++)s[a].z=n[a].z;this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,n),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,s)}}else this.components.push(e)}}},{key:"modifyPoint",value:function(t,e){this.computeScaleValues(t,e),this.calculateParts()}},{key:"computeScaleValues",value:function(){}},{key:"getLonLatDistanceFromPixel",value:function(t){if(null===this.map)return 0;var e,i;if(this.map&&"undefined"!=typeof L&&void 0!==L.Map&&this.map instanceof L.Map){var o=this.map.layerPointToLatLng(L.point(0,0)),n=this.map.layerPointToLatLng(L.point(t*this.symScaleDefinition,0));e=new SuperMapAlgoPlot.Point(o.lng,o.lat),i=new SuperMapAlgoPlot.Point(n.lng,n.lat)}else if(this.map&&"undefined"!=typeof SuperMap&&void 0!==SuperMap.Map&&this.map instanceof SuperMap.Map){o=this.map.getLonLatFromPixel(new SuperMap.Pixel(0,0)),n=this.map.getLonLatFromPixel(new SuperMap.Pixel(t*this.symScaleDefinition,0));e=new SuperMapAlgoPlot.Point(o.lon,o.lat),i=new SuperMapAlgoPlot.Point(n.lon,n.lat)}return SuperMapAlgoPlot.PlottingUtil.distance(e,i)}},{key:"getPixelDistanceFromLonLat",value:function(t){if(null===this.map)return 0;var e,i;if(this.map&&"undefined"!=typeof L&&void 0!==L.Map&&this.map instanceof L.Map){var o=this.map.latLngToLayerPoint(L.latLng(0,0)),n=this.map.latLngToLayerPoint(L.latLng(t,0));e=new SuperMapAlgoPlot.Point(o.x,o.y),i=new SuperMapAlgoPlot.Point(n.x,n.y)}else if(this.map&&"undefined"!=typeof SuperMap&&void 0!==SuperMap.Map&&this.map instanceof SuperMap.Map){o=this.map.getPixelFromLonLat(new SuperMap.LonLat(0,0)),n=this.map.getPixelFromLonLat(new SuperMap.LonLat(t,0));e=new SuperMapAlgoPlot.Point(o.x,o.y),i=new SuperMapAlgoPlot.Point(n.x,n.y)}return SuperMapAlgoPlot.PlottingUtil.distance(e,i)}},{key:"getPixelFromLonLat",value:function(t,e){if(this.map&&"undefined"!=typeof L&&void 0!==L.Map&&this.map instanceof L.Map){var i=this.map.latLngToLayerPoint(L.latLng(e,t));return{x:i.x,y:i.y}}if(this.map&&"undefined"!=typeof SuperMap&&void 0!==SuperMap.Map&&this.map instanceof SuperMap.Map){var o=this.map.getPixelFromLonLat(new SuperMap.LonLat(t,e));return{x:o.x,y:o.y}}}},{key:"getLonLatFromPixel",value:function(t,e){if(this.map&&"undefined"!=typeof L&&void 0!==L.Map&&this.map instanceof L.Map){var i=this.map.layerPointToLatLng(L.point(t,e));return{lon:i.lng,lat:i.lat}}if(this.map&&"undefined"!=typeof SuperMap&&void 0!==SuperMap.Map&&this.map instanceof SuperMap.Map){var o=this.map.getLonLatFromPixel(new SuperMap.Pixel(t,e));return{lon:o.lon,lat:o.lat}}}},{key:"pixelBoundsToLonLat",value:function(t){var e=this.getLonLatFromPixel(t.left,t.top),i=this.getLonLatFromPixel(t.right,t.bottom);return new SuperMap.Bounds(e.lon,i.lat,i.lon,e.lat)}},{key:"annotationContent",value:function(t,e,i,o){var n=this.textContent;if(0!==n.length){var l=n.split("\n");n="";var s=0,a={};SuperMap.Util.copyAttributes(a,this.style),a.fontSize*=this.symScaleDefinition;for(var r=0;r<l.length;r++){s++;var u=l[r],p=SuperMapAlgoPlot.PlottingUtil.getTextWidth(a,u),h=this.getPixelFromLonLat(t,e),c=this.getPixelFromLonLat(i,o),y=parseFloat(Math.abs(c.x-h.x)),g=parseFloat(Math.abs(h.y-c.y)),f=0;if(a.weight?f=parseFloat(a.fontSize)+2*a.weight+.2*parseFloat(a.fontSize)+s:this.style.strokeWidth&&(f=parseFloat(a.fontSize)+2*a.strokeWidth+.2*parseFloat(a.fontSize)+s),f>g)break;if(p>=y){var d=u.split("");u="";for(var m="",S=d.length,P=0;P<S;P++){if(m+=d[P],SuperMapAlgoPlot.PlottingUtil.getTextWidth(a,m)>=y){var b=d[P];if(d[P]="\n",s++,a.weight?f=parseFloat(a.fontSize)*s+s+2*a.weight+.2*parseFloat(a.fontSize):this.style.strokeWidth&&(f=parseFloat(a.fontSize)*s+s+2*a.strokeWidth+.2*parseFloat(a.fontSize)),!(f<g)){0===n.length?n=u:(n+="\n",n+=u);break}d[P]+=b,m=b}u+=d[P],P===S-1&&(0===n.length?n=u:(n+="\n",n+=u))}}else 0===n.length?n=u:(n+="\n",n+=u)}if(0!==n.length){var v=a.labelAlign,L=0,M=0;"l"===v[0]?L=t:"r"===v[0]?L=i:"c"===v[0]&&(L=(t+i)/2),"t"===v[1]?M=e:"b"===v[1]?M=o:"m"===v[1]&&(M=(e+o)/2);var _=new SuperMapAlgoPlot.Point(L,M),A={};A.positionPoints=[_],A.type=SuperMapAlgoPlot.SymbolType.TEXTSYMBOL,A.textContent=n,A.style={surroundLineFlag:!1,labelAlign:v},this.components.push(A)}}}},{key:"addCell",value:function(t,e,i,o){if(t&&e){var n={};n.type=t,n.textContent=o,n.positionPoints=e,null==i?n.style={surroundLineFlag:!1}:(n.style=i,null==i.surroundLineFlag&&(n.style.surroundLineFlag=!1)),this.components.push(n)}}},{key:"addText",value:function(t,e,i,o,n){if(t&&e){var l={};l.type=SuperMapAlgoPlot.SymbolType.TEXTSYMBOL,l.textContent=t,l.positionPoints=[e];var s=i/t.length/2;l.style={},l.style.surroundLineFlag=!1,l.style.labelRotation=-o,l.style.fontSize=s,void 0===n?l.style.fontColor="#000000":(l.style.fontColor=n,l.style.fontColorLimit=!0),l.style.fontSizeLimit=!0,l.style.sizeFixed=!1,l.style.labelAlign="cm",l.style.label=t,this.components.push(l)}}},{key:"getLinePts",value:function(t,e,i){var o=new Object;null==i&&(i=.5);var n=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t);if(i-e<0){o.startIndex=0,o.startPt=t[0];var l=i+e;i+e>1&&(l=1);var s=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(n*l,t);o.endIndex=s.index,o.endPt=s.pts}else if(i+e>1){l=i-e;i-e<0&&(l=0);s=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(n*l,t);o.startIndex=s.index,o.startPt=s.pts,o.endIndex=t.length-1,o.endPt=t[t.length-1]}else{s=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(n*(i-e),t);var a=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(n*(i+e),t);o.startIndex=s.index,o.startPt=s.pts,o.endIndex=a.index,o.endPt=a.pts}return o}},{key:"addArrow",value:function(t,e,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t.length<2)return t;null==i&&(i=!0);var n=SuperMapAlgoPlot.PlottingUtil.polylineDistance(this.controlPoints)*e;Math.cos(9.59/180*Math.PI);if(i){var l=t[t.length-1];if(t.length>2){for(var s=-1,a=t.length-2;a>=0;a--)if(n<SuperMapAlgoPlot.PlottingUtil.distance(l,t[a])){s=a;break}t.splice(s+1,t.length-s-1),t.push(l)}if(t.length>1){var r=SuperMapAlgoPlot.PlottingUtil.findPointInLine(l,t[t.length-2],n);t.splice(t.length-1,1),t.push(r),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,t,o);var u=t[t.length-1],p=l,h=1.2*n,c=SuperMapAlgoPlot.PlottingUtil.radian(u,p)*SuperMapAlgoPlot.PlottingUtil.RTOD,y=SuperMapAlgoPlot.PlottingUtil.circlePoint(p,h,h,c+180-9.59),g=SuperMapAlgoPlot.PlottingUtil.circlePoint(p,h,h,c+180+9.59),f={surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0,lineTypeLimit:!0,surroundLineLimit:!0,surroundLineType:SuperMapAlgoPlot.AlgoSurroundLineType.NONE};this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,[y,l,g,r],f)}}else{l=t[0];if(t.length>2){s=-1;for(var d=1;d<t.length;d++)if(n<SuperMapAlgoPlot.PlottingUtil.distance(l,t[d])){s=d;break}t.splice(1,s-1)}if(t.length>1){r=SuperMapAlgoPlot.PlottingUtil.findPointInLine(l,t[1],n);t.splice(0,1),t.splice(0,0,r),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,t);u=t[0],p=l,h=1.2*n,c=SuperMapAlgoPlot.PlottingUtil.radian(u,p)*SuperMapAlgoPlot.PlottingUtil.RTOD,y=SuperMapAlgoPlot.PlottingUtil.circlePoint(p,h,h,c+180-9.59),g=SuperMapAlgoPlot.PlottingUtil.circlePoint(p,h,h,c+180+9.59),f={surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0,lineTypeLimit:!0,surroundLineLimit:!0,surroundLineType:SuperMapAlgoPlot.AlgoSurroundLineType.NONE};this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,[y,l,g,r],f)}}t.length<=1&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,t)}},{key:"addArrowOnly",value:function(t,e,i){if(t.length<2)return t;null==i&&(i=!0);var o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(this.controlPoints)*e;Math.cos(9.59/180*Math.PI);if(i){var n=t[t.length-1];if(t.length>2){for(var l=-1,s=t.length-2;s>=0;s--)if(o<SuperMapAlgoPlot.PlottingUtil.distance(n,t[s])){l=s;break}t.splice(l+1,t.length-l-1),t.push(n)}if(t.length>1){var a=SuperMapAlgoPlot.PlottingUtil.findPointInLine(n,t[t.length-2],o);t.splice(t.length-1,1),t.push(a);var r=t[t.length-1],u=n,p=1.2*o,h=SuperMapAlgoPlot.PlottingUtil.radian(r,u)*SuperMapAlgoPlot.PlottingUtil.RTOD,c=SuperMapAlgoPlot.PlottingUtil.circlePoint(u,p,p,h+180-9.59),y=SuperMapAlgoPlot.PlottingUtil.circlePoint(u,p,p,h+180+9.59),g={surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0,lineTypeLimit:!0,surroundLineLimit:!0,surroundLineType:SuperMapAlgoPlot.AlgoSurroundLineType.NONE};this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,[c,n,y,a],g)}}else{n=t[0];if(t.length>2){l=-1;for(var f=1;f<t.length;f++)if(o<SuperMapAlgoPlot.PlottingUtil.distance(n,t[f])){l=f;break}t.splice(1,l-1)}if(t.length>1){a=SuperMapAlgoPlot.PlottingUtil.findPointInLine(n,t[1],o);t.splice(0,1),t.splice(0,0,a);r=t[0],u=n,p=1.2*o,h=SuperMapAlgoPlot.PlottingUtil.radian(r,u)*SuperMapAlgoPlot.PlottingUtil.RTOD,c=SuperMapAlgoPlot.PlottingUtil.circlePoint(u,p,p,h+180-9.59),y=SuperMapAlgoPlot.PlottingUtil.circlePoint(u,p,p,h+180+9.59),g={surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0,lineTypeLimit:!0,surroundLineLimit:!0,surroundLineType:SuperMapAlgoPlot.AlgoSurroundLineType.NONE};this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,[c,n,y,a],g)}}}},{key:"addDashLineAndArrow",value:function(t,e,i,o){if(t.length<2)return t;null==o&&(o=!0);var n=SuperMapAlgoPlot.PlottingUtil.polylineDistance(this.controlPoints)*e,l=n*Math.cos(9.59*SuperMapAlgoPlot.PlottingUtil.DTOR);if(o){var s=t[t.length-1];if(t.length>2){for(var a=-1,r=t.length-2;r>=0;r--)if(n<SuperMapAlgoPlot.PlottingUtil.distance(s,t[r])){a=r;break}t.splice(a+1,t.length-a-1),t.push(s)}if(t.length>1){var u=SuperMapAlgoPlot.PlottingUtil.findPointInLine(s,t[t.length-2],n);t.splice(t.length-1,1),t.push(u);for(var p=i*(l=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t)),h=.03*l,c=0;c<=l;){var y,g,f=-1,d=-1;if(y=(T=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(t,c)).pt,-1!=(f=T.index)){d=(x=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(t,c+p)).index,g=x.pt,-1==d&&(g=t[t.length-1],d=t.length-1),(O=[]).push(y);for(var m=f+1;m<=d;m++)O.push(t[m]);O.push(g),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,O),c+=p+h}else c+=p+h}var S=t[t.length-1],P=s,b=1.2*n,v=SuperMapAlgoPlot.PlottingUtil.dirAngle(S,P)*SuperMapAlgoPlot.PlottingUtil.RTOD,L=SuperMapAlgoPlot.PlottingUtil.circlePoint(P,b,b,v+180-9.59),M=SuperMapAlgoPlot.PlottingUtil.circlePoint(P,b,b,v+180+9.59),_={surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0,lineTypeLimit:!0,surroundLineLimit:!0,surroundLineType:SuperMapAlgoPlot.AlgoSurroundLineType.NONE};this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,[L,s,M,u],_)}}else{s=t[0];if(t.length>2){a=-1;for(var A=1;A<t.length;A++)if(n<SuperMapAlgoPlot.PlottingUtil.distance(s,t[A])){a=A;break}t.splice(1,a-1)}if(t.length>1){u=SuperMapAlgoPlot.PlottingUtil.findPointInLine(s,t[1],n);t.splice(0,1),t.splice(0,0,u);for(p=i*(l=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t)),h=.03*l,c=0;c<=l;){var T,x;f=-1,d=-1;if((T=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(c,t)).bfind)if((x=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(c+p,t)).bfind){var O;f=T.index,d=x.index,(O=[]).push(T.pts);for(m=f+1;m<=d;m++)O.push(t[m]);O.push(x.pts),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,O),c+=p+h}}S=t[0],P=s,b=1.2*n,v=SuperMapAlgoPlot.PlottingUtil.radian(S,P)*SuperMapAlgoPlot.PlottingUtil.RTOD,L=SuperMapAlgoPlot.PlottingUtil.circlePoint(P,b,b,v+180-9.59),M=SuperMapAlgoPlot.PlottingUtil.circlePoint(P,b,b,v+180+9.59),_={surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0,lineTypeLimit:!0,surroundLineLimit:!0,surroundLineType:SuperMapAlgoPlot.AlgoSurroundLineType.NONE};this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,[L,s,M,u],_)}}t.length<=1&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,O)}},{key:"addArrowWithOutLine",value:function(t,e){if(t.length<2)return t;var i,o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(this.controlPoints);void 0===e&&(e=(this.isEdit,.5*this.getSubSymbolScaleValue()));var n=t.slice();i=o*e;var l,s=t[t.length-1],a=i*Math.cos(.125*Math.PI);if(t.length>2){for(var r=-1,u=t.length-2;u>=0;u--)if(i<SuperMapAlgoPlot.PlottingUtil.distance(s,t[u])){r=u;break}t.splice(r+1,t.length-r),t.push(s)}if(t.length>1){SuperMapAlgoPlot.PlottingUtil.distance(t[t.length-1],t[t.length-2])>a&&(l=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(a,[t[t.length-1],t[t.length-2]])).bfind&&(t.splice(t.length-1,1),t.push(l.pts));var p=t[t.length-1],h=s,c=i;if(void 0===p)return t;var y=SuperMapAlgoPlot.PlottingUtil.radian(p,h)*SuperMapAlgoPlot.PlottingUtil.RTOD,g=SuperMapAlgoPlot.PlottingUtil.circlePoint(h,c,c,y+157.5),f=SuperMapAlgoPlot.PlottingUtil.circlePoint(h,c,c,y+202.5),d={surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0,lineTypeLimit:!0,surroundLineLimit:!0,surroundLineType:SuperMapAlgoPlot.AlgoSurroundLineType.NONE};this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,[g,s,f],d)}else this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,n)}},{key:"addDovetailArrow",value:function(t,e){if(t.length<2)return t;var i,o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(this.controlPoints);void 0===e&&(e=(this.isEdit,.5*this.getSubSymbolScaleValue())),i=o*e;var n=t[t.length-1];if(t.length>2){for(var l=-1,s=t.length-2;s>=0;s--)if(i<SuperMapAlgoPlot.PlottingUtil.distance(n,t[s])){l=s;break}t.splice(l+1,t.length-l),t.push(n)}this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,t);var a=t[t.length-2],r=t[t.length-1],u=i;if(void 0===a)return t;if(!(SuperMapAlgoPlot.PlottingUtil.distance(a,r)<i)){var p=SuperMapAlgoPlot.PlottingUtil.radian(a,r)*SuperMapAlgoPlot.PlottingUtil.RTOD,h=SuperMapAlgoPlot.PlottingUtil.circlePoint(r,u,u,p+157.5),c=SuperMapAlgoPlot.PlottingUtil.circlePoint(r,u,u,p+202.5),y=SuperMapAlgoPlot.PlottingUtil.circlePoint(r,.5*u,.5*u,p+180),g=[];g.push(h),g.push(t[t.length-1]),g.push(c),g.push(y);var f={surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0,lineTypeLimit:!0,surroundLineLimit:!0,surroundLineType:SuperMapAlgoPlot.AlgoSurroundLineType.NONE};this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,g,f)}}},{key:"getDefaultSubSymbolSize",value:function(){var t=0;if(this.map){var e=this.getLonLatFromPixel(0,0),i=this.getLonLatFromPixel(this.subSymbolDefaultPixelSize,0),o=new SuperMapAlgoPlot.Point(e.lon,e.lat),n=new SuperMapAlgoPlot.Point(i.lon,i.lat);t=SuperMapAlgoPlot.PlottingUtil.distance(o,n)}if(0===t){if(0!==this.subSymbolSize)return this.subSymbolSize;for(var l=0,s=0;s<this.controlPoints.length-1;s++)l+=SuperMapAlgoPlot.PlottingUtil.distance(this.controlPoints[s],this.controlPoints[s+1]);t=.3*l}return t}},{key:"getTextBounds",value:function(t,e){" "===e&&(e="_");var i=document.createElement("span");document.body.appendChild(i),i.style.width="auto",i.style.height="auto",t.fontSize&&(i.style.fontSize=new String(t.fontSize)+"px"),t.fontFamily&&(i.style.fontFamily=t.fontFamily),t.fontWeight&&(i.style.fontWeight=t.fontWeight),i.style.position="absolute",i.style.visibility="hidden",i.innerHTML=e;var o=new SuperMap.Bounds(i.clientLeft,i.clientTop+i.clientHeight-6,i.clientLeft+i.clientWidth,i.clientTop+4),n=this.pixelBoundsToLonLat(o);return document.body.removeChild(i),n}},{key:"calAssistantLine",value:function(){var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);this.symbolType===SuperMapAlgoPlot.SymbolType.ANNOFRAMESYMBOL&&(t.splice(1,0,new SuperMapAlgoPlot.Point(this.controlPoints[1].x,this.controlPoints[0].y)),t.push(new SuperMapAlgoPlot.Point(this.controlPoints[0].x,this.controlPoints[1].y)),t.push(new SuperMapAlgoPlot.Point(this.controlPoints[0].x,this.controlPoints[0].y)));var e={type:24,surroundLineFlag:!1,positionPoints:t,style:{color:"#0000ff",opacity:1,weight:1,dashArray:"5, 5",strokeColor:"#0000ff",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"dash",lineColorLimit:!0,lineTypeLimit:!0,lineWidthLimit:!0,surroundLineFlag:!1}};this.components.push(e)}},{key:"getSubSymbolScaleValue",value:function(t,e){var i=0;i=t&&!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t,0)?t:SuperMapAlgoPlot.PlottingUtil.polylineDistance(this.controlPoints);var o=this.getDefaultSubSymbolSize()/i;return void 0===e&&(e=.3),(o>e||o<=0)&&(o=e),o}},{key:"computeSubSymbol",value:function(t,e,i,o,n,l,s){if(null==t.symbolData||null==t.symbolData.innerCells)return null;void 0===n&&(n=0),void 0===l&&(l=0),void 0===s&&(s=!1);for(var a=SuperMapAlgoPlot.AnalysisSymbol.analysisSymbolCells(t.symbolData,!0),r=-1e10,u=-1e10,p=1e10,h=1e10,c=0;c<a.length;c++){null!=a[c].polybezierClose&&(a[c].type===SuperMapAlgoPlot.SymbolType.POLYBEZIERSYMBOL||a[c].type===SuperMapAlgoPlot.SymbolType.POLYBEZIERCLOSESYMBOL?(a[c].type,SuperMapAlgoPlot.SymbolType.POLYBEZIERSYMBOL,a[c].positionPoints=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsWithCtrlPt(a[c].positionPoints),a[c].isClosed&&a[c].positionPoints[0]!==a[c].positionPoints[symbolCell.positionPoints.length-1]&&a[c].positionPoints.push(a[c].positionPoints[0])):a[c].type===SuperMapAlgoPlot.SymbolType.KIDNEY&&(a[c].positionPoints=SuperMapAlgoPlot.Primitives.getSpatialData(a[c].type,a[c].positionPoints)));for(var y=SuperMapAlgoPlot.Primitives.getSpatialData(a[c].type,a[c].positionPoints,a[c].textContent,0,a[c].isCalculate),g=0,f=y.length;g<f;g++)r<y[g].x&&(r=y[g].x),u<y[g].y&&(u=y[g].y),p>y[g].x&&(p=y[g].x),h>y[g].y&&(h=y[g].y)}var d=new SuperMapAlgoPlot.Point(r,u),m=new SuperMapAlgoPlot.Point(p,h),S=(d.y-m.y)/i,P=(d.x-m.x)/i,b=P>S?P:S,v=new SuperMapAlgoPlot.Point(.5*(d.x+m.x),.5*(d.y+m.y));v.x+=n*(d.x-m.x),v.y+=l*(d.y-m.y);for(var L=0,M=a.length;L<M;L++){for(var _=0,A=a[L].positionPoints.length;_<A;_++)a[L].positionPoints[_].x-=v.x,a[L].positionPoints[_].y-=v.y,s&&(a[L].positionPoints[_].x*=-1,a[L].positionPoints[_].y*=1),a[L].positionPoints[_].x/=b,a[L].positionPoints[_].y/=b,SuperMapAlgoPlot.PlottingUtil.rotateAngle(new SuperMapAlgoPlot.Point(0,0),o*Math.PI/180,a[L].positionPoints[_]),a[L].positionPoints[_].x+=e.x,a[L].positionPoints[_].y+=e.y;a[L].type===SuperMapAlgoPlot.SymbolType.TEXTSYMBOL&&(a[L].style.fontSize/=4*b,a[L].style.labelRotation=-o,a[L].style.sizeFixed=!1),a[L].isCalculate=!1,a[L].style.surroundLineType=0,a[L].style.surroundLineLimit=!0,a[L].style.lineTypeLimit=!0,a[L].style.lineColorLimit||(a[L].style.lineColorLimit=!0,a[L].style.color=t.lineColor,t.opacity&&(a[L].style.opacity=t.opacity)),a[L].style.lineWidthLimit||(a[L].style.lineWidthLimit=!0,a[L].style.weight=t.width2D),this.components.push(a[L])}return a}},{key:"ComputeZValue",value:function(t,e,i){var o=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(t,e,i),n=new SuperMapAlgoPlot.Point(o.projectPoint.x,o.projectPoint.y),l=SuperMapAlgoPlot.PlottingUtil.distance(e,i),s=SuperMapAlgoPlot.PlottingUtil.distance(e,t),a=SuperMapAlgoPlot.PlottingUtil.distance(i,t);if(!o.isOnline){if(s>=l)return i.z;if(a>=l)return e.z}return n.x!=e.x&&e.x!=i.x?e.z+(n.x-e.x)/(e.x-i.x)*(e.z-i.z):n.y!=e.y&&e.y!=i.y?e.z+(n.y-e.y)/(e.y-i.y)*(e.z-i.z):0==(s=SuperMapAlgoPlot.PlottingUtil.distance(e,n))?e.z:e.z-(e.z-i.z)*(s/l)}},{key:"ComputeBeizerZValueByDis",value:function(t,e,i){if(t.length<2)return!1;for(var o=[],n=0;n<t.length;n++)o.push({x:t[n].x,y:t[n].y});var l=SuperMapAlgoPlot.PlottingUtil.polylineDistance(o);if(0==l)return!1;var s=SuperMapAlgoPlot.PlottingUtil.polylineDistance(e),a=[];a.push(o[0]);for(var r=-1,u=0,p=e[0],h=1;h<o.length;h++){a.push(o[h]);var c=SuperMapAlgoPlot.PlottingUtil.polylineDistance(a)/l,y=s*c,g=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(y,e),f=g.index,d=g.pts;if(g.bfind){for(var m=t[h-1].z,S=t[h].z,P=s*(c-u),b=0,v=++r;v<=f;v++){var L=m+(S-m)*((b+=v==r?SuperMapAlgoPlot.PlottingUtil.distance(p,e[v]):SuperMapAlgoPlot.PlottingUtil.distance(e[v-1],e[v]))/P);i.push({x:e[v].x,y:e[v].y,z:L})}r=f}u=c,p=d}for(var M=r+1;M<e.length;M++)i.push({x:e[M].x,y:e[M].y,z:t[t.length-1].z});return!0}},{key:"ComputeHeight",value:function(t,e,i,o){if(i!=o){if(0!=t.length)if(1==t.length)e.push({x:t[0].x,y:t[0].y,z:i});else if(2==t.length)e.push({x:t[0].x,y:t[0].y,z:i}),e.push({x:t[1].x,y:t[1].y,z:o});else{var n=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t);if(0!=n){var l=[];l.push(t[0]),e.push({x:t[0].x,y:t[0].y,z:i});for(var s=1;s<t.length-1;s++){l.push(t[s]);var a=i+(o-i)*SuperMapAlgoPlot.PlottingUtil.polylineDistance(l)/n;e.push({x:t[s].x,y:t[s].y,z:a})}e.push({x:t[t.length-1].x,y:t[t.length-1].y,z:o})}else for(var r=0;r<t.length;r++)e.push({x:t[r].x,y:t[r].y,z:i})}}else for(var u=0;u<t.length;u++)e.push({x:t[u].x,y:t[u].y,z:i})}},{key:"computeDashLine",value:function(t,e){var i=[];if(0==t.length)i.push(e);else{var o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(e);if(o<=0)return i;for(var n=0;n<t.length-1;n+=2){var l=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(o*t[n],e),s=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(o*t[n+1],e),a=l.pts,r=l.index,u=s.pts,p=s.index,h=[];h.push(a);for(var c=r+1;c<=p;c++)h.push(e[c]);h.push(u),i.push(h)}}return i}},{key:"mergeDashLine",value:function(t,e){if(1==t.length&&0==t[0])return[0];for(var i=[],o=0;o<t.length;)SuperMapAlgoPlot.PlottingUtil.equalFuzzy(0,t[o])?t.splice(o,1):o++;if(t.length>0){var n=0,l=0;i.push(0);for(;;){if(n>=t.length&&(n=0),(l+=t[n])>1||1===l){i.length,i.push(1);break}i.push(l),n++}}if(i.length>0){for(var s=1;s<e.length;s+=2)if(e.length>s+2){var a=0;for(a=0;a<i.length-1&&!(e[s]>i[a]&&e[s]<i[a+1]);a++);var r=a;for(r=a;r<i.length-1&&!(e[s+1]>i[r]&&e[s+1]<i[r+1]);r++);a==r&&a%2==0?(i.splice(a+1,0,e[s+1]),i.splice(a+1,0,e[s])):a!=r&&a%2==0&&r%2==0?(i.splice(a+1,r-a),i.splice(a+1,0,e[s+1]),i.splice(a+1,0,e[s])):a!=r&&a%2==0&&r%2!=0?(i.splice(a+1,r-a),i.splice(a+1,0,e[s])):a!=r&&a%2!=0&&r%2==0?(i.splice(a+1,r-a),i.splice(a+1,0,e[s+1])):a!=r&&a%2!=0&&r%2!=0&&i.splice(a+1,r-a)}}else i=i.concat(e);return i}}])&&go(t.prototype,e),i&&go(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function So(t){"@babel/helpers - typeof";return(So="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Po(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,bo(o.key),o)}}function bo(t){var e=function(t,e){if("object"!=So(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=So(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==So(e)?e:e+""}function vo(t,e,i){return e=Lo(e),function(t,e){if(e&&("object"===So(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Lo(t).constructor):e.apply(t,i))}function Lo(t){return(Lo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Mo(t,e){return(Mo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol=mo;var _o=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=vo(this,e,[t])).arrowAngle=t.arrowAngle?t.arrowAngle:45,0===i.scaleValues.length&&(i.scaleValues.push(.3),i.scaleValues.push(0),i.scaleValues.push(0)),i.CLASS_NAME="SuperMapAlgoPlot.ArrowLine",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Mo(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){if(this.init(),!(null==this.controlPoints||this.controlPoints.length<this.minEditPts)){var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t);var e=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t);e=SuperMapAlgoPlot.PlottingUtil.clearSamePts(e);var i=SuperMapAlgoPlot.PlottingUtil.polylineDistance(e);this.isEdit||(this.scaleValues[0]=.5*this.getSubSymbolScaleValue(i));var o,n=this.scaleValues[0]*i,l=this.arrowAngle*Math.PI/180/2,s=(o=e.length>2?SuperMapAlgoPlot.PlottingUtil.radian(e[e.length-1],e[e.length-2]):SuperMapAlgoPlot.PlottingUtil.radian(e[1],e[0]))-l,a=e[e.length-1].x+n*Math.cos(s),r=e[e.length-1].y+n*Math.sin(s),u=new SuperMapAlgoPlot.Point(a,r),p=o+l,h=e[e.length-1].x+n*Math.cos(p),c=e[e.length-1].y+n*Math.sin(p),y=new SuperMapAlgoPlot.Point(h,c),g=[];g.push(u),g.push(e[e.length-1].clone()),g.push(y);var f={surroundLineFlag:!1,fillLimit:!0,lineTypeLimit:!0},d=SuperMapAlgoPlot.PlottingUtil.radian(e[0],e[1]);s=d-l,a=e[0].x+n*Math.cos(s),r=e[0].y+n*Math.sin(s),u=new SuperMapAlgoPlot.Point(a,r),p=d+l,h=e[0].x+n*Math.cos(p),c=e[0].y+n*Math.sin(p),y=new SuperMapAlgoPlot.Point(h,c);var m=[];m.push(u),m.push(e[0].clone()),m.push(y);var S=this.scaleValues[1]===SuperMapAlgoPlot.ArrowLineType.DOUBLELINE?SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL:SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,P=this.scaleValues[2]===SuperMapAlgoPlot.ArrowLineType.DOUBLELINE?SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL:SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL;this.scaleValues[1]===SuperMapAlgoPlot.ArrowLineType.DOUBLELINE?this.addCell(S,m,f):this.scaleValues[1]===SuperMapAlgoPlot.ArrowLineType.TRIANGLESOLID&&this.addCell(S,m,f),this.scaleValues[2]===SuperMapAlgoPlot.ArrowLineType.DOUBLELINE?this.addCell(P,g,f):this.scaleValues[2]===SuperMapAlgoPlot.ArrowLineType.TRIANGLESOLID&&this.addCell(P,g,f),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,e),this.finish()}}}])&&Po(i.prototype,o),n&&Po(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Ao(t){"@babel/helpers - typeof";return(Ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function To(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,xo(o.key),o)}}function xo(t){var e=function(t,e){if("object"!=Ao(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ao(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ao(e)?e:e+""}function Oo(t,e,i){return e=wo(e),function(t,e){if(e&&("object"===Ao(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],wo(t).constructor):e.apply(t,i))}function wo(t){return(wo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Co(t,e){return(Co=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.ArrowLine=_o;var Eo=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Oo(this,e,[t])).scaleValues.length&&i.scaleValues.push(1),i.CLASS_NAME="SuperMapAlgoPlot.RegularPolygon",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Co(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){if(this.init(),!(this.controlPoints.length<this.minEditPts)){var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints),e=this.controlPoints.length+1,i=2*Math.PI/e;if(!this.isEdit){var o=this.controlPoints[this.controlPoints.length-1],n=new SuperMapAlgoPlot.Point(this.controlPoints[this.controlPoints.length-1].x,this.controlPoints[this.controlPoints.length-1].y);SuperMapAlgoPlot.PlottingUtil.rotateAngle(this.controlPoints[0],i,n),this.scaleValues[0]=SuperMapAlgoPlot.PlottingUtil.distance(t[0],this.calculateMidPt(o,n))/SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[t.length-1])}var l=[],s=this.controlPoints[this.controlPoints.length-1].clone();l.push(s.clone()),s=SuperMapAlgoPlot.PlottingUtil.rotateAngle(this.controlPoints[0],i/2,s);var a=SuperMapAlgoPlot.PlottingUtil.findPointOnLineByRatio(this.scaleValues[0],this.controlPoints[0],s);l.push(a);for(var r=1;r<e;r++)s=SuperMapAlgoPlot.PlottingUtil.rotateAngle(this.controlPoints[0],i/2,s),l.push(s.clone()),s=SuperMapAlgoPlot.PlottingUtil.rotateAngle(this.controlPoints[0],i/2,s),a=SuperMapAlgoPlot.PlottingUtil.findPointOnLineByRatio(this.scaleValues[0],this.controlPoints[0],s),l.push(a);var u=l[1];this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,l,{surroundLineFlag:!1,fill:!1}),this.addScalePoint(u),this.finish()}}},{key:"calculateMidPt",value:function(t,e){return new SuperMapAlgoPlot.Point((t.x+e.x)/2,(t.y+e.y)/2)}},{key:"modifyPoint",value:function(t,e){if(0===t&&!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.distance(this.controlPoints[0],this.controlPoints[this.controlPoints.length-1]),o=this.scalePoints[0],n=SuperMapAlgoPlot.PlottingUtil.projectPoint(e,this.controlPoints[0],o),l=SuperMapAlgoPlot.PlottingUtil.distance(this.controlPoints[0],n);this.scaleValues[0]=l/i}this.calculateParts()}}])&&To(i.prototype,o),n&&To(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Io(t){"@babel/helpers - typeof";return(Io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Do(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Uo(o.key),o)}}function Uo(t){var e=function(t,e){if("object"!=Io(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Io(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Io(e)?e:e+""}function Ro(t,e,i){return e=No(e),function(t,e){if(e&&("object"===Io(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],No(t).constructor):e.apply(t,i))}function No(t){return(No=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bo(t,e){return(Bo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.RegularPolygon=Eo;var ko=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Ro(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.1),i.scaleValues.push(.1)),i.CLASS_NAME="SuperMapAlgoPlot.Brace",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Bo(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){var e=t[0],i=t[1],o=SuperMapAlgoPlot.PlottingUtil.distance(e,i);this.scaleValues.length<2&&(this.scaleValues=[],this.scaleValues.push(.1),this.scaleValues.push(.1));for(var n=this.scaleValues[0],l=this.scaleValues[1],s=new SuperMapAlgoPlot.Point(o*n,o*n),a=new SuperMapAlgoPlot.Point(o*(.5-l/2),0),r=new SuperMapAlgoPlot.Point(.5*o,-o*l),u=new SuperMapAlgoPlot.Point(o*(.5+l/2),0),p=new SuperMapAlgoPlot.Point(o*(1-n),o*n),h=[],c=180*Math.PI/180,y=270*Math.PI/180,g=3*Math.PI/180,f=c;f<=y;f+=g){var d=new SuperMapAlgoPlot.Point(s.x+o*n,s.y);d=SuperMapAlgoPlot.PlottingUtil.rotateAngle(s,f,d),h.push(d)}h.push(a),h.push(r),h.push(u),c=270*Math.PI/180,y=360*Math.PI/180;for(var m=c;m<=y;m+=g){var S=new SuperMapAlgoPlot.Point(p.x+o*n,p.y);S=SuperMapAlgoPlot.PlottingUtil.rotateAngle(p,m,S),h.push(S)}for(var P=SuperMapAlgoPlot.PlottingUtil.radian(e,i),b=[],v=0;v<h.length;v++){var L=new SuperMapAlgoPlot.Point(h[v].x+e.x,h[v].y+e.y);L=SuperMapAlgoPlot.PlottingUtil.rotateAngle(e,P,L),b.push(L)}this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,b),this.scalePoints=[];var M=new SuperMapAlgoPlot.Point(o*n,0),_=new SuperMapAlgoPlot.Point(M.x+e.x,M.y+e.y);(_=SuperMapAlgoPlot.PlottingUtil.rotateAngle(e,P,_)).isScalePoint=!0,_.tag=0,this.addScalePoint(_);var A=new SuperMapAlgoPlot.Point(r.x+e.x,r.y+e.y);SuperMapAlgoPlot.PlottingUtil.rotateAngle(e,P,A),A.isScalePoint=!0,A.tag=1,this.addScalePoint(A)}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints),o=SuperMapAlgoPlot.PlottingUtil.distance(i[0],i[1]);if(0==t){var n=SuperMapAlgoPlot.PlottingUtil.distance(i[0],e)/o;n>0&&n<.4&&(this.scaleValues[0]=n)}else if(1==t){var l=new SuperMapAlgoPlot.Point((i[0].x+i[1].x)/2,(i[0].y+i[1].y)/2),s=SuperMapAlgoPlot.PlottingUtil.distance(e,l)/o;0<s&&.2>s&&(this.scaleValues[1]=s)}}this.calculateParts()}}])&&Do(i.prototype,o),n&&Do(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Fo(t){"@babel/helpers - typeof";return(Fo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jo(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Vo(o.key),o)}}function Vo(t){var e=function(t,e){if("object"!=Fo(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Fo(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Fo(e)?e:e+""}function zo(t,e,i){return e=Yo(e),function(t,e){if(e&&("object"===Fo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Yo(t).constructor):e.apply(t,i))}function Yo(t){return(Yo=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Go(t,e){return(Go=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.Brace=ko;var Wo=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=zo(this,e,[t])).CLASS_NAME="SuperMapAlgoPlot.Trapezoid",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Go(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length>=2&&t.length<this.minEditPts&&this.calAssistantLine(),!(t.length<this.minEditPts)){var e=[],i=t[0],o=t[1],n=t[2],l=new SuperMapAlgoPlot.Point(0,0);this.GetPointsByTrapezoid(1,n,o,i,l),e.push(i),e.push(o),e.push(n),e.push(l);var s=SuperMapAlgoPlot.PlottingUtil.intersectLines(i,o,n,l),a=s.intersectPoint;s.isIntersectLines&&(a.x>i.x&&a.x<o.x||a.y>i.y&&a.y<o.y||a.x<i.x&&a.x>o.x||a.y<i.y&&a.y>o.y)&&(e[0]=l,e[3]=i),4==e.length&&this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,e)}}},{key:"GetPointsByTrapezoid",value:function(t,e,i,o,n){var l=e.x,s=e.y,a=i.x,r=i.y,u=o.x,p=o.y,h=0,c=0,y=0,g=0;if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(Math.abs(s-r),0))h=l+a-u,c=p;else if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(Math.abs(l-a),0))h=u,c=s+r-p;else{var f=1*(s-r)/(l-a),d=p-f*u;c=f*(h=((r+s)/2+(l+a)/(2*f)-d)/(f+1/f))+d,h=2*h-u,c=2*c-p}var m=Math.sqrt(1*(l-a)*(l-a)+1*(s-r)*(s-r)),S=Math.sqrt(1*(l-h)*(l-h)+1*(s-c)*(s-c));m>0?(y=l+(a-l)*S/m,g=s+(r-s)*S/m):(y=l,g=s);var P=y+(h-y)*t,b=g+(c-g)*t;n.x=P,n.y=b}}])&&jo(i.prototype,o),n&&jo(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Xo(t){"@babel/helpers - typeof";return(Xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ho(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Zo(o.key),o)}}function Zo(t){var e=function(t,e){if("object"!=Xo(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Xo(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Xo(e)?e:e+""}function Jo(t,e,i){return e=Ko(e),function(t,e){if(e&&("object"===Xo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Ko(t).constructor):e.apply(t,i))}function qo(){return(qo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ko(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function Ko(t){return(Ko=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Qo(t,e){return(Qo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.Trapezoid=Wo;var $o=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Jo(this,e,[t])).scaleValues.length&&i.scaleValues.push(.126),i.CLASS_NAME="SuperMapAlgoPlot.GeoTooltipBox",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qo(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"destroy",value:function(){qo(Ko(e.prototype),"destroy",this).call(this)}},{key:"calculateParts",value:function(){this.init();var t=this.scaleValues[0];if(!(t<0||t>1)){if(t=(1-t)/2,this.controlPoints.length>=this.minEditPts){var e,i,o,n,l,s;this.controlPoints[2]&&(this.controlPoints[2].isFixedPos=!0),this.controlPoints[0].x<this.controlPoints[1].x?(e=this.controlPoints[0].x,o=this.controlPoints[1].x):(e=this.controlPoints[1].x,o=this.controlPoints[0].x),this.controlPoints[0].y<this.controlPoints[1].y?(n=this.controlPoints[0].y,i=this.controlPoints[1].y):(n=this.controlPoints[1].y,i=this.controlPoints[0].y),l=this.controlPoints[2].x,s=this.controlPoints[2].y;var a=0,r=(i-n)/(o-e);a=l<e?s>i?Math.abs((s-i)/(l-e))>r?2:1:s<n&&Math.abs((s-n)/(l-e))>r?4:1:l>o?s>i?Math.abs((s-i)/(l-o))>r?2:3:s<n&&Math.abs((s-n)/(l-o))>r?4:3:s>i?2:s<n?4:0,this.scalePoints=[];var u=[];switch(u.push(new SuperMapAlgoPlot.Point(e,n)),u.push(new SuperMapAlgoPlot.Point(e,i)),u.push(new SuperMapAlgoPlot.Point(o,i)),u.push(new SuperMapAlgoPlot.Point(o,n)),a){case 0:break;case 1:this.addScalePoint(new SuperMapAlgoPlot.Point(e,i-(i-n)*t)),u.splice(a,0,new SuperMapAlgoPlot.Point(e,i-(i-n)*t)),u.splice(a,0,this.controlPoints[2].clone()),u.splice(a,0,new SuperMapAlgoPlot.Point(e,n+(i-n)*t));break;case 2:this.addScalePoint(new SuperMapAlgoPlot.Point(o-(o-e)*t,i)),u.splice(a,0,new SuperMapAlgoPlot.Point(o-(o-e)*t,i)),u.splice(a,0,this.controlPoints[2].clone()),u.splice(a,0,new SuperMapAlgoPlot.Point(e+(o-e)*t,i));break;case 3:this.addScalePoint(new SuperMapAlgoPlot.Point(o,i-(i-n)*t)),u.splice(a,0,new SuperMapAlgoPlot.Point(o,n+(i-n)*t)),u.splice(a,0,this.controlPoints[2].clone()),u.splice(a,0,new SuperMapAlgoPlot.Point(o,i-(i-n)*t));break;case 4:this.addScalePoint(new SuperMapAlgoPlot.Point(o-(o-e)*t,n)),u.splice(a,0,new SuperMapAlgoPlot.Point(e+(o-e)*t,n)),u.splice(a,0,this.controlPoints[2].clone()),u.splice(a,0,new SuperMapAlgoPlot.Point(o-(o-e)*t,n))}var p=[];(p=p.concat(u)).push(p[0]);for(var h=this.mergeDashLine(this.dashLines,[]),c=this.computeDashLine(h,p),y=0;y<c.length;y++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,c[y]);this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,u,{surroundLineFlag:!1,lineWidthLimit:!0,strokeWidth:0,weight:0}),this.annotationContent(e,i,o,n)}this.finish()}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint&&0==t){var i,o,n,l,s,a,r=this.scalePoints[0];this.controlPoints[0].x<this.controlPoints[1].x?(i=this.controlPoints[0].x,n=this.controlPoints[1].x):(i=this.controlPoints[1].x,n=this.controlPoints[0].x),this.controlPoints[0].y<this.controlPoints[1].y?(l=this.controlPoints[0].y,o=this.controlPoints[1].y):(l=this.controlPoints[1].y,o=this.controlPoints[0].y),s=this.controlPoints[2].x,a=this.controlPoints[2].y;var u=(o-l)/(n-i),p=.25;switch(s<i?a>o?Math.abs((a-o)/(s-i))>u?2:1:a<l&&Math.abs((a-l)/(s-i))>u?4:1:s>n?a>o?Math.abs((a-o)/(s-n))>u?2:3:a<l&&Math.abs((a-l)/(s-n))>u?4:3:a>o?2:a<l?4:0){case 1:case 3:var h=r.y+(e.y-r.y);h>o&&(h=o),h<(o+l)/2&&(h=(o+l)/2),p=1-2*(o-h)/(o-l);break;case 2:case 4:var c=r.x+(e.x-r.x);c>n&&(c=n),c<(i+n)/2&&(c=(i+n)/2),p=1-2*(n-c)/(n-i)}p<0&&(p=0),p>1&&(p=1),this.scaleValues[0]=p}this.calculateParts()}}])&&Ho(i.prototype,o),n&&Ho(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function tn(t){"@babel/helpers - typeof";return(tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function en(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,on(o.key),o)}}function on(t){var e=function(t,e){if("object"!=tn(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=tn(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==tn(e)?e:e+""}function nn(t,e,i){return e=sn(e),function(t,e){if(e&&("object"===tn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],sn(t).constructor):e.apply(t,i))}function ln(){return(ln="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=sn(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function sn(t){return(sn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function an(t,e){return(an=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.GeoTooltipBox=$o;var rn=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=nn(this,e,[t])).scaleValues.length&&(i.scaleValues.push(0),i.scaleValues.push(0),i.scaleValues.push(0),i.scaleValues.push(0)),i.CLASS_NAME="SuperMapAlgoPlot.GeoTooltipBoxM",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&an(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"destroy",value:function(){ln(sn(e.prototype),"destory",this).call(this)}},{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length>=this.minEditPts){var e,i,o,n;t[0].x<t[1].x?(e=t[0].x,o=t[1].x):(e=t[1].x,o=t[0].x),t[0].y<t[1].y?(n=t[0].y,i=t[1].y):(n=t[1].y,i=t[0].y),this.scalePoints=[];var l=[];l.push(new SuperMapAlgoPlot.Point(e,n)),l.push(new SuperMapAlgoPlot.Point(e,i)),l.push(new SuperMapAlgoPlot.Point(o,i)),l.push(new SuperMapAlgoPlot.Point(o,n)),this.isEdit||(this.scaleValues[0]=e,this.scaleValues[1]=n-.3*(i-n),this.scaleValues[2]=e+.5*(o-e),this.scaleValues[3]=n-.3*(i-n));for(var s=[],a=[],r=0;r<this.scaleValues.length/2;r++)s.push(this.getAction(this.scaleValues[2*r],this.scaleValues[2*r+1],e,i,o,n)),a.push(new SuperMapAlgoPlot.Point(this.scaleValues[2*r],this.scaleValues[2*r+1]));for(var u,p,h,c,y=a.length,g=[],f=[],d=[],m=[],S=[],P=0;P<s.length;P++)0===s[P]&&g.push(a[P]),1===s[P]&&f.push(a[P]),2===s[P]&&d.push(a[P]),3===s[P]&&m.push(a[P]),4===s[P]&&S.push(a[P]);var b=s.slice();b.sort();var v=new SuperMapAlgoPlot.Point(0,0);if(b[0]===b[b.length-1]&&0!==b[0]){var L=[];switch(b[0]){case 0:break;case 1:u=1/(2*f.length+1);for(var M=new SuperMapAlgoPlot.Point,_=0;_<2*f.length;_++)M=new SuperMapAlgoPlot.Point(e,n+(i-n)*u*(_+1)),L.unshift(M);break;case 2:p=1/(2*d.length+1);for(var A=new SuperMapAlgoPlot.Point,T=0;T<2*d.length;T++)A=new SuperMapAlgoPlot.Point(e+(o-e)*p*(T+1),i),L.unshift(A);break;case 3:h=1/(2*m.length+1);for(var x=new SuperMapAlgoPlot.Point,O=0;O<2*m.length;O++)x=new SuperMapAlgoPlot.Point(o,n+(i-n)*h*(O+1)),L.push(x);break;case 4:c=1/(2*S.length+1);for(var w=new SuperMapAlgoPlot.Point,C=0;C<2*S.length;C++)w=new SuperMapAlgoPlot.Point(e+(o-e)*c*(C+1),n),L.push(w)}for(var E=0;E<y;E++)for(var I=0;I<y;I++){var D=SuperMapAlgoPlot.PlottingUtil.intersectLineSegs(L[2*E+1],a[E],L[2*I],a[I],v);if(D&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(v.x,L[2*E+1].x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(v.y,L[2*E+1].y)&&(D=!1),D){var U=a[I].clone();a[I]=a[E],a[E]=U}}for(var R=0;R<y;R++)l.splice(b[0],0,L[2*R]),l.splice(b[0],0,a[R]),l.splice(b[0],0,L[2*R+1])}else{for(var N,B,k=[],F=[],j=[],V=[],z=0;z<s.length;z++)switch(s[z]){case 0:break;case 1:u=1/(2*f.length+1);for(var Y=0;Y<2*f.length;Y++){var G=new SuperMapAlgoPlot.Point(e,n+(i-n)*u*(Y+1));k.unshift(G)}for(var W=0;W<f.length;W++)for(var X=1;X<f.length;X++)(N=SuperMapAlgoPlot.PlottingUtil.intersectLineSegs(k[2*W+1],f[W],k[2*X],f[X],v))&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(v.x,k[2*W+1].x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(v.y,k[2*W+1].y)&&(N=!1),N&&(B=f[X].clone(),f[X]=f[W],f[W]=B);break;case 2:p=1/(2*d.length+1);for(var H=0;H<2*d.length;H++){var Z=new SuperMapAlgoPlot.Point(e+(o-e)*p*(H+1),i);F.unshift(Z)}for(var J=0;J<d.length;J++)for(var q=1;q<d.length;q++)(N=SuperMapAlgoPlot.PlottingUtil.intersectLineSegs(F[2*J+1],d[J],F[2*q],d[q],v))&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(v.x,F[2*J+1].x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(v.y,F[2*J+1].y)&&(N=!1),N&&(B=d[q].clone(),d[q]=d[J],d[J]=B);break;case 3:h=1/(2*m.length+1);for(var K=0;K<2*m.length;K++){var Q=new SuperMapAlgoPlot.Point(o,n+(i-n)*h*(K+1));j.push(Q)}for(var $=0;$<m.length;$++)for(var tt=1;tt<m.length;tt++)(N=SuperMapAlgoPlot.PlottingUtil.intersectLineSegs(j[2*$+1],m[$],j[2*tt],m[tt],v))&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(v.x,j[2*$+1].x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(v.y,j[2*$+1].y)&&(N=!1),N&&(B=m[tt].clone(),m[tt]=m[$],m[$]=B);break;case 4:c=1/(2*S.length+1);for(var et=0;et<2*S.length;et++){var it=new SuperMapAlgoPlot.Point(e+(o-e)*c*(et+1),n);V.push(it)}for(var ot=0;ot<S.length;ot++)for(var nt=1;nt<S.length;nt++)(N=SuperMapAlgoPlot.PlottingUtil.intersectLineSegs(V[2*ot+1],S[ot],V[2*nt],S[nt],v))&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(v.x,V[2*ot+1].x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(v.y,V[2*ot+1].y)&&(N=!1),N&&(B=S[nt].clone(),S[nt]=S[ot],S[ot]=B)}for(var lt=0;lt<S.length;lt++)l.splice(4,0,V[2*lt]),l.splice(4,0,S[lt]),l.splice(4,0,V[2*lt+1]);for(var st=0;st<m.length;st++)l.splice(3,0,j[2*st]),l.splice(3,0,m[st]),l.splice(3,0,j[2*st+1]);for(var at=0;at<d.length;at++)l.splice(2,0,F[2*at]),l.splice(2,0,d[at]),l.splice(2,0,F[2*at+1]);for(var rt=0;rt<f.length;rt++)l.splice(1,0,k[2*rt]),l.splice(1,0,f[rt]),l.splice(1,0,k[2*rt+1])}for(var ut=0;ut<a.length;ut++)this.addScalePoint(a[ut],ut)}this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,l),this.annotationContent(e,i,o,n),this.finish()}},{key:"modifyPoint",value:function(t,e){!0===e.isScalePoint&&(null==t&&void 0===t||(this.scaleValues[2*t]=e.x,this.scaleValues[2*t+1]=e.y)),this.calculateParts()}},{key:"getAction",value:function(t,e,i,o,n,l){var s=(o-l)/(n-i);return t<i?e>o?Math.abs((e-o)/(t-i))>s?2:1:e<l&&Math.abs((e-l)/(t-i))>s?4:1:t>n?e>o?Math.abs((e-o)/(t-n))>s?2:3:e<l&&Math.abs((e-l)/(t-n))>s?4:3:e>o?2:e<l?4:0}}])&&en(i.prototype,o),n&&en(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function un(t){"@babel/helpers - typeof";return(un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pn(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,hn(o.key),o)}}function hn(t){var e=function(t,e){if("object"!=un(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=un(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==un(e)?e:e+""}function cn(t,e,i){return e=gn(e),function(t,e){if(e&&("object"===un(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],gn(t).constructor):e.apply(t,i))}function yn(){return(yn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=gn(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function gn(t){return(gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function fn(t,e){return(fn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.GeoTooltipBoxM=rn;var dn=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=cn(this,e,[t])).roundBox=!!t.roundBox&&t.roundBox,i.textBoxType=t.textBoxType?t.textBoxType:SuperMapAlgoPlot.TextBoxType.WITHTIPBOX,0===i.scaleValues.length&&(i.scaleValues.push(.126),i.scaleValues.push(0),i.scaleValues.push(0)),i.CLASS_NAME="SuperMapAlgoPlot.SymbolTextBox",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fn(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"destroy",value:function(){this.roundBox=null,this.textBoxType=null,yn(gn(e.prototype),"destroy",this).call(this)}},{key:"calculateParts",value:function(){this.init();var t=this.scaleValues[0];if(!(t<0||t>1)){if(t=(1-t)/2,this.controlPoints.length>=this.minEditPts){var e,i,o,n;this.scalePoints=[];var l=[];this.controlPoints[0].x<this.controlPoints[1].x?(e=this.controlPoints[0].x,o=this.controlPoints[1].x):(e=this.controlPoints[1].x,o=this.controlPoints[0].x),this.controlPoints[0].y<this.controlPoints[1].y?(n=this.controlPoints[0].y,i=this.controlPoints[1].y):(n=this.controlPoints[1].y,i=this.controlPoints[0].y);var s=1,a=2,r=3,u=4;if(this.roundBox){var p=Math.max(e,o),h=Math.min(e,o),c=Math.max(i,n),y=Math.min(i,n),g=.1*Math.min(Math.abs(e-o),Math.abs(i-n)),f=new SuperMapAlgoPlot.Point(h+g,y+g),d=new SuperMapAlgoPlot.Point(h+g,c-g),m=new SuperMapAlgoPlot.Point(p-g,c-g),S=new SuperMapAlgoPlot.Point(p-g,y+g),P=this.calculateArc(f,g,3*Math.PI/2,Math.PI,-1,180),b=this.calculateArc(d,g,Math.PI,Math.PI/2,-1,180),v=this.calculateArc(m,g,Math.PI/2,0,-1,180),L=this.calculateArc(S,g,2*Math.PI,3*Math.PI/2,-1,180);s=P.length,a=P.length+b.length,r=P.length+b.length+v.length,u=P.length+b.length+v.length+L.length,l=P.concat(b,v,L)}else l.push(new SuperMapAlgoPlot.Point(e,n)),l.push(new SuperMapAlgoPlot.Point(e,i)),l.push(new SuperMapAlgoPlot.Point(o,i)),l.push(new SuperMapAlgoPlot.Point(o,n));this.isEdit||(this.scaleValues[1]=e+.1*(o-e),this.scaleValues[2]=n+-.3*(i-n));var M=new SuperMapAlgoPlot.Point(this.scaleValues[1],this.scaleValues[2]),_=this.getAction(this.scaleValues[1],this.scaleValues[2],e,i,o,n);if(this.textBoxType===SuperMapAlgoPlot.TextBoxType.WITHTIPBOX)switch(this.addScalePoint(M,0),_){case 0:break;case 1:this.addScalePoint(new SuperMapAlgoPlot.Point(e,i-(i-n)*t)),l.splice(s,0,new SuperMapAlgoPlot.Point(e,i-(i-n)*t)),l.splice(s,0,M),l.splice(s,0,new SuperMapAlgoPlot.Point(e,n+(i-n)*t));break;case 2:this.addScalePoint(new SuperMapAlgoPlot.Point(o-(o-e)*t,i)),l.splice(a,0,new SuperMapAlgoPlot.Point(o-(o-e)*t,i)),l.splice(a,0,M),l.splice(a,0,new SuperMapAlgoPlot.Point(e+(o-e)*t,i));break;case 3:this.addScalePoint(new SuperMapAlgoPlot.Point(o,i-(i-n)*t)),l.splice(r,0,new SuperMapAlgoPlot.Point(o,n+(i-n)*t)),l.splice(r,0,M),l.splice(r,0,new SuperMapAlgoPlot.Point(o,i-(i-n)*t));break;case 4:this.addScalePoint(new SuperMapAlgoPlot.Point(o-(o-e)*t,n)),l.splice(u,0,new SuperMapAlgoPlot.Point(e+(o-e)*t,n)),l.splice(u,0,M),l.splice(u,0,new SuperMapAlgoPlot.Point(o-(o-e)*t,n))}if(0!==l.length)if(this.textBoxType===SuperMapAlgoPlot.TextBoxType.NONEBOX){this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,l,{surroundLineFlag:!1,weight:0,lineWidthLimit:!0})}else this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,l)}else this.controlPoints.length>=2&&this.controlPoints.length<this.minEditPts&&this.addCell(SuperMapAlgoPlot.SymbolType.RECTANGLESYMBOL,this.controlPoints);this.annotationContent(e,i,o,n),this.finish()}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint)if(0===t)this.scaleValues[1]=e.x,this.scaleValues[2]=e.y;else if(1===t){var i,o,n,l,s,a,r=this.scalePoints[0];this.controlPoints[0].x<this.controlPoints[1].x?(i=this.controlPoints[0].x,n=this.controlPoints[1].x):(i=this.controlPoints[1].x,n=this.controlPoints[0].x),this.controlPoints[0].y<this.controlPoints[1].y?(l=this.controlPoints[0].y,o=this.controlPoints[1].y):(l=this.controlPoints[1].y,o=this.controlPoints[0].y),s=this.scaleValues[1],a=this.scaleValues[2];var u=(o-l)/(n-i),p=.25;switch(s<i?a>o?Math.abs((a-o)/(s-i))>u?2:1:a<l&&Math.abs((a-l)/(s-i))>u?4:1:s>n?a>o?Math.abs((a-o)/(s-n))>u?2:3:a<l&&Math.abs((a-l)/(s-n))>u?4:3:a>o?2:a<l?4:0){case 1:case 3:var h=r.y+(e.y-r.y);h>o&&(h=o),h<(o+l)/2&&(h=(o+l)/2),p=1-2*(o-h)/(o-l);break;case 2:case 4:var c=r.x+(e.x-r.x);c>n&&(c=n),c<(i+n)/2&&(c=(i+n)/2),p=1-2*(n-c)/(n-i)}p<0&&(p=0),p>1&&(p=1),this.scaleValues[0]=p}this.calculateParts()}},{key:"calculateArc",value:function(t,e,i,o,n,l){(!n||1!=n&&-1!=n)&&(n=-1),l||(l=360);for(var s=Math.PI/l/2,a=s*n,r=Math.abs(o-i),u=[],p=i,h=0;h<r;h+=s){var c=new SuperMapAlgoPlot.Point(Math.cos(p)*e+t.x,Math.sin(p)*e+t.y);u.push(c),p=(p=(p+=a)<0?p+2*Math.PI:p)>2*Math.PI?p-2*Math.PI:p}return u}},{key:"getAction",value:function(t,e,i,o,n,l){var s=(o-l)/(n-i);return t<i?e>o?Math.abs((e-o)/(t-i))>s?2:1:e<l&&Math.abs((e-l)/(t-i))>s?4:1:t>n?e>o?Math.abs((e-o)/(t-n))>s?2:3:e<l&&Math.abs((e-l)/(t-n))>s?4:3:e>o?2:e<l?4:0}}])&&pn(i.prototype,o),n&&pn(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function mn(t){"@babel/helpers - typeof";return(mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Sn(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Pn(o.key),o)}}function Pn(t){var e=function(t,e){if("object"!=mn(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=mn(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==mn(e)?e:e+""}function bn(t,e,i){return e=vn(e),function(t,e){if(e&&("object"===mn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],vn(t).constructor):e.apply(t,i))}function vn(t){return(vn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ln(t,e){return(Ln=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.SymbolTextBox=dn;var Mn=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===(i=bn(this,e,[t])).scaleValues[0]&&(i.scaleValues[0]=0),void 0===i.scaleValues[1]&&(i.scaleValues[1]=360),i.CLASS_NAME="SuperMapAlgoPlot.ConcentricCircle",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ln(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!(null==(t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t))||t.length<2)){for(var e=this.scaleValues[0],i=this.scaleValues[1];e>360;)e-=360;for(;e<0;)e+=360;for(;i>360;)i-=360;for(;i<0;)i+=360;for(;i<=e;)i+=360;SuperMapAlgoPlot.PlottingUtil.equalFuzzy(i,e)&&(i+=360);for(var o=[],n=0;n<t.length-1;n++){var l=SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[n+1]),s=0;s=t.length>2?SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[2]):SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[n+1]);for(var a=[],r=SuperMapAlgoPlot.PlottingUtil.DTOR,u=(i-e)/72,p=e;p<i+u/2;p+=u){var h=t[0].x+l*Math.cos(p*r),c=t[0].y+l*Math.sin(p*r);a.push(new SuperMapAlgoPlot.Point(h,c))}if(n>0){for(var y=[],g=0;g<o.length;g++)y.push(o[g]);for(var f=a.length-1;f>=0;f--)y.push(a[f]);this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,y,{surroundLineFlag:!1,lineWidthLimit:!0,weight:0,strokeWidth:0})}o.length=0;for(var d=0;d<a.length;d++)o.push(a[d]);if(this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,a,{surroundLineFlag:!1,fillLimit:!0,fill:!1}),0==n){var m=t[0].x+1.2*l*Math.cos(e*SuperMapAlgoPlot.PlottingUtil.DTOR),S=t[0].y+1.2*l*Math.sin(e*SuperMapAlgoPlot.PlottingUtil.DTOR),P=t[0].x+1.2*s*Math.cos(i*SuperMapAlgoPlot.PlottingUtil.DTOR),b=t[0].y+1.2*s*Math.sin(i*SuperMapAlgoPlot.PlottingUtil.DTOR),v=new SuperMapAlgoPlot.Point(m,S),L=new SuperMapAlgoPlot.Point(P,b);this.addScalePoint(v),this.addScalePoint(L)}}}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(i.length<2)return;for(var o=180*SuperMapAlgoPlot.PlottingUtil.radian(i[0],e)/Math.PI;o>360;)o-=360;for(;o<0;)o+=360;0==t?this.scaleValues[0]=o:1==t&&(this.scaleValues[1]=o)}this.calculateParts()}}])&&Sn(i.prototype,o),n&&Sn(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function _n(t){"@babel/helpers - typeof";return(_n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function An(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Tn(o.key),o)}}function Tn(t){var e=function(t,e){if("object"!=_n(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=_n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==_n(e)?e:e+""}function xn(t,e,i){return e=On(e),function(t,e){if(e&&("object"===_n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],On(t).constructor):e.apply(t,i))}function On(t){return(On=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function wn(t,e){return(wn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.ConcentricCircle=Mn;var Cn=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=xn(this,e,[t])).angleRange=[],i.defaultRadius=t.defaultRadius?t.defaultRadius:60,i.CLASS_NAME="SuperMapAlgoPlot.CombinationalCircle",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wn(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){if(this.init(),this.controlPoints=SuperMapAlgoPlot.PlottingUtil.clearSamePts(this.controlPoints),!(null==this.controlPoints||this.controlPoints.length<1)){var t=this.getCircleLonLat(this.controlPoints[0],this.defaultRadius);this.angleRange=[];for(var e=0;e<this.controlPoints.length;e++)null==this.scaleValues[e]&&(this.scaleValues[e]=t),this.angleRange.push([{Start:0,End:360}]);for(var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints),o=0;o<i.length;o++)if(0!==this.angleRange[o].length&&(0!==this.angleRange[o][0].Start||0!==this.angleRange[o][0].End))for(var n=o+1;n<i.length;n++)if(0!==this.angleRange[n].length&&(0!==this.angleRange[n][0].Start||0!==this.angleRange[n][0].End)){var l=SuperMapAlgoPlot.PlottingUtil.distance(i[o],i[n]);if(l<this.scaleValues[o]+this.scaleValues[n])if(l>Math.abs(this.scaleValues[o]-this.scaleValues[n]))for(var s=0;s<2;s++){var a,r,u;0==s?(u=o,a=SuperMapAlgoPlot.PlottingUtil.radian(i[o],i[n])*SuperMapAlgoPlot.PlottingUtil.RTOD,r=Math.acos((l*l+this.scaleValues[o]*this.scaleValues[o]-this.scaleValues[n]*this.scaleValues[n])/(2*l*this.scaleValues[o]))*SuperMapAlgoPlot.PlottingUtil.RTOD):(u=n,a=SuperMapAlgoPlot.PlottingUtil.radian(i[n],i[o])*SuperMapAlgoPlot.PlottingUtil.RTOD,r=Math.acos((l*l+this.scaleValues[n]*this.scaleValues[n]-this.scaleValues[o]*this.scaleValues[o])/(2*l*this.scaleValues[n]))*SuperMapAlgoPlot.PlottingUtil.RTOD);var p=a-r,h=a+r,c=p<0&&h>0||p>360||h>360;p=this.adjustAngle(p),h=this.adjustAngle(h);for(var y=this.angleRange[u].length-1;y>=0;y--)if(c){if(h>this.angleRange[u][y].End||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(h,this.angleRange[u][y].End)){this.angleRange[u].splice(y,1);continue}if(h>this.angleRange[u][y].Start&&(this.angleRange[u][y].Start=h),p<this.angleRange[u][y].Start||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(p,this.angleRange[u][y].Start)){this.angleRange[u].splice(y,1);continue}p<this.angleRange[u][y].End&&(this.angleRange[u][y].End=p)}else if(p<this.angleRange[u][y].Start&&h>this.angleRange[u][y].End)this.angleRange[u].splice(y,1);else if(p>this.angleRange[u][y].Start&&h<this.angleRange[u][y].End)this.angleRange[u].push({Start:this.angleRange[u][y].Start,End:p}),this.angleRange[u].push({Start:h,End:this.angleRange[u][y].End}),this.angleRange[u].splice(y,1);else{if(p>this.angleRange[u][y].End)continue;if(p>this.angleRange[u][y].Start&&(this.angleRange[u][y].End=p),h<this.angleRange[u][y].Start)continue;h<this.angleRange[u][y].End&&(this.angleRange[u][y].Start=h)}}else{if(this.scaleValues[o]<this.scaleValues[n]){this.angleRange[o][0].Start=0,this.angleRange[o][0].End=0;break}this.angleRange[n][0].Start=0,this.angleRange[n][0].End=0}}for(var g=[],f=0;f<i.length;f++)if(0!==this.angleRange[f].length&&(0!==this.angleRange[f][0].Start||0!==this.angleRange[f][0].End))for(var d=this.angleRange[f].length-1;d>=0;d--){for(var m=this.adjustAngle(this.angleRange[f][d].Start),S=this.adjustAngle(this.angleRange[f][d].End);S<m;)S+=360;if(S-m==360)this.addCell(SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,[i[f],new SuperMapAlgoPlot.Point(i[f].x,i[f].y+this.scaleValues[f])]);else{for(var P=[],b=(S-m)/72,v=m;v<S+b/2;v+=b){var L=i[f].x+this.scaleValues[f]*Math.cos(v*SuperMapAlgoPlot.PlottingUtil.DTOR),M=i[f].y+this.scaleValues[f]*Math.sin(v*SuperMapAlgoPlot.PlottingUtil.DTOR);P.push(new SuperMapAlgoPlot.Point(L,M))}g.push(P)}}for(var _=[],A=[];0!==g.length;){var T=g[0];g.splice(0,1),void 0!==(T=this.generatePolygon(g,T))&&(_.push(T),A.push(T))}for(var x=_.length,O=x-1;O>=0;O--)for(var w=0;w<_[O].length;w++){for(var C=-1,E=-1,I=0;I<x;I++)if(parseInt(I)!==O){var D=_[I];if(SuperMapAlgoPlot.PlottingUtil.ptIsInPolygon(D,_[O][w])){C=O;_[E=parseInt(I)].push(_[E][0]),_[C].push(_[C][0]),_[E]=_[E].concat(_[C]),_.splice(C,1),x=_.length;break}}if(-1!==C&&-1!==E)break}for(var U={surroundLineFlag:!1,lineWidthLimit:!0,weight:0,strokeWidth:0,surroundLineType:0},R=0;R<_.length;R++)_[R][0]!=_[R][_[R].length-1]&&_[R].push(_[R][0]),this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,_[R],U);for(var N=0;N<A.length;N++)A[N][0]!=A[N][A[N].length-1]&&A[N].push(A[N][0]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,A[N]);for(var B=0;B<i.length;B++){var k=new SuperMapAlgoPlot.Point(i[B].x+this.scaleValues[B],i[B].y);k.isScalePoint=!0,k.tag=B,this.addScalePoint(k)}}}},{key:"generatePolygon",value:function(t,e){if(0===t.length||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(e[0].x,e[e.length-1].x,1e-10)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(e[0].y,e[e.length-1].y,1e-10))return e;for(var i,o=e[e.length-1],n=0;n<t.length;n++)if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[n][0].x,o.x,1e-10)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[n][0].y,o.y,1e-10)){if(e=e.concat(t[n]),t.splice(n,1),void 0!==(i=this.generatePolygon(t,e))&&0!==i.length)return i}else if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[n][t[n].length-1].x,o.x,1e-10)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[n][t[n].length-1].y,o.y,1e-10)){for(var l=t[n].length-1;l>=0;l--)e.push(t[n][l]);if(t.splice(n,1),void 0!==(i=this.generatePolygon(t,e))&&0!==i.length)return i}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){if(t<0||t>=this.controlPoints.length)return;var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints),o=SuperMapAlgoPlot.PlottingUtil.distance(i[t],e);this.scaleValues[t]=o}this.calculateParts()}},{key:"adjustAngle",value:function(t){for(;t>360;)t-=360;for(;t<0;)t+=360;return t}},{key:"getCircleLonLat",value:function(t,e){return null===this.map?2*this.getDefaultSubSymbolSize():this.map&&"undefined"!=typeof L&&void 0!==L.Map&&this.map instanceof L.Map?((i=this.map.latLngToLayerPoint(L.latLng(t.y,t.x))).x+=e,this.map.layerPointToLatLng(L.point(i.x,i.y)).lng-t.x):this.map&&"undefined"!=typeof SuperMap&&void 0!==SuperMap.Map&&this.map instanceof SuperMap.Map?((i=this.map.getPixelFromLonLat(new SuperMap.LonLat(t.x,t.y))).x+=e,this.map.getLonLatFromPixel(new SuperMap.Pixel(i.x,i.y)).lon-t.x):void 0;var i}}])&&An(i.prototype,o),n&&An(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function En(t){"@babel/helpers - typeof";return(En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function In(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Dn(o.key),o)}}function Dn(t){var e=function(t,e){if("object"!=En(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=En(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==En(e)?e:e+""}function Un(t,e,i){return e=Rn(e),function(t,e){if(e&&("object"===En(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Rn(t).constructor):e.apply(t,i))}function Rn(t){return(Rn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Nn(t,e){return(Nn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.CombinationalCircle=Cn;var Bn=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=Un(this,e,[t])).CLASS_NAME="SuperMapAlgoPlot.FreeCurve",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nn(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){if(this.init(),!(null==this.controlPoints||this.controlPoints.length<this.minEditPts)){this.scalePoints=[];var t=[];if(this.controlPoints.length<3)t.push(this.controlPoints[0]),t.push(this.controlPoints[1]);else{if(!this.isEdit){var e=this.getLonLatFromPixel(0,0),i=this.getLonLatFromPixel(100,100),o=Math.abs(e.lon-i.lon),n=this.reSample(this.controlPoints,o/50);n.length<3&&(n=this.controlPoints),this.controlPoints=[],this.controlPoints=this.controlPoints.concat(n)}var l=SuperMapAlgoPlot.PlottingUtil.computeBeizerPoints(this.isEdit,this.controlPoints,this.scaleValues);l.scalePoints=SuperMapAlgoPlot.PlottingUtil.clearSamePts(l.scalePoints),l.scaleValues=SuperMapAlgoPlot.PlottingUtil.clearSamePts(l.scaleValues),this.scaleValues=l.scaleValues;for(var s=0,a=l.scalePoints.length;s<a;s++){var r=l.scalePoints[s];r.isScalePoint=!0,r.tag=s,this.addScalePoint(r)}t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints)}this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,t)}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){if(t<0||t>2*this.controlPoints.length-1)return;var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(2>i.length)return;var o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i),n=-1;n=t%2==0?Math.floor(t/2):Math.floor((t+1)/2);var l=(e.x-i[n].x)/o,s=(e.y-i[n].y)/o;this.scaleValues[2*t]=l,this.scaleValues[2*t+1]=s}this.calculateParts()}},{key:"reSample",value:function(t,e){var i=[];if(null==t||e<0)return i;var o=t.length;if(o>2){var n=new SuperMapAlgoPlot.Point(0,0),l=0,s=0,a=0,r=2*Math.PI;n=t[0],i.push(n);for(var u=!1,p=!1,h=!1,c=1;c<o;c++)if(s=Math.sqrt((t[c].y-n.y)*(t[c].y-n.y)+(t[c].x-n.x)*(t[c].x-n.x)),SuperMapAlgoPlot.PlottingUtil.equalFuzzy(0,s))u&&(n=t[c-1],c--,i.push(n),a=0,r=2*Math.PI,u=!1,p=!1,h=!1);else{var y=(t[c].x-n.x)/s,g=(t[c].y-n.y)/s;if(l=g>0||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(0,g)?Math.acos(y):2*Math.PI-Math.acos(y),r>2*Math.PI&&l+2*Math.PI<r?(l+=2*Math.PI,a<0&&(a+=2*Math.PI)):a<0&&l-2*Math.PI>a&&(l-=2*Math.PI,r>2*Math.PI&&(r-=2*Math.PI)),l>a&&l<r||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(0,l-a)||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(0,l-r)){var f=Math.atan(e/s);p?a<l-f&&(a=l-f):(p=!0,a=l-f),h?r>l+f&&(r=l+f):(h=!0,r=l+f),u=!0}else n=t[c-1],c--,i.push(n),a=0,r=2*Math.PI,u=!1,p=!1,h=!1}return i.push(t[o-1]),i}return i}},{key:"reSampleByAngle",value:function(t,e){var i=[],o=t.length;if(null==t||o<=0||e<=0)return i;for(var n=t,l=o,s=!1;SuperMapAlgoPlot.PlottingUtil.equalFuzzy(n[0].x,n[l-1].x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(n[0].y,n[l-1].y);){if((l-=1)<=0)return i;s=!0}var a,r,u=[];for(a=0;a<l;a++)u.push(0);for(u[0]=1,u[l-1]=1,r=0,a=1;a<l-1;a++)if(SuperMapAlgoPlot.PlottingUtil.distance(n[r],n[a])>1e-10&&SuperMapAlgoPlot.PlottingUtil.distance(n[r],n[a+1])>1e-10){var p=180*SuperMapAlgoPlot.PlottingUtil.InnerAngle(n[a],n[r],n[a+1])/Math.PI;p>e&&p<180-e&&(u[a]=1,r++)}var h=0;for(a=0;a<l;a++)1==u[a]&&h++;if(h>0){for(s&&h++,i=[],r=0,a=0;a<l;a++)1==u[a]&&(i[r++]=n[a]);return s&&(i[r]=i[0]),i}return i}}])&&In(i.prototype,o),n&&In(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function kn(t){"@babel/helpers - typeof";return(kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fn(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,jn(o.key),o)}}function jn(t){var e=function(t,e){if("object"!=kn(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=kn(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==kn(e)?e:e+""}function Vn(t,e,i){return e=Yn(e),function(t,e){if(e&&("object"===kn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Yn(t).constructor):e.apply(t,i))}function zn(){return(zn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Yn(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function Yn(t){return(Yn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Gn(t,e){return(Gn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.FreeCurve=Bn;var Wn=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Vn(this,e,[t])).scaleValues.length&&(i.scaleValues.push(0),i.scaleValues[1]=.1),i.CLASS_NAME="SuperMapAlgoPlot.NodeChain",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gn(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"destroy",value:function(){zn(Yn(e.prototype),"destroy",this).call(this)}},{key:"calculateParts",value:function(){if(this.init(),this.controlPoints&&null!==this.controlPoints){var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,t),this.isEdit||(this.scaleValues[1]=.5*this.getSubSymbolScaleValue());var e=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t),i=e*this.scaleValues[0],o=e*this.scaleValues[1];if(0<this.subSymbols.length&&null!==this.subSymbols[0]&&void 0!==this.subSymbols[0])if(this.subSymbols[0].code>0)for(var n=0;n<t.length;n++){var l=new SuperMapAlgoPlot.Point(t[n].x,t[n].y+i);this.computeSubSymbol(this.subSymbols[0],l,o,0)}else this.addCircles(t,i,o);else this.addCircles(t,i,o);var s=new SuperMapAlgoPlot.Point(t[0].x,t[0].y+i);this.addScalePoint(s);var a=SuperMapAlgoPlot.PlottingUtil.circlePoint(s,o,o,90);this.addScalePoint(a)}}}},{key:"addCircles",value:function(t,e,i){for(var o={surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0},n=0;n<t.length;n++){var l=new SuperMapAlgoPlot.Point(t[n].x,t[n].y+e),s=this.getCirclePts(l,i);this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,s,o)}}},{key:"getCirclePts",value:function(t,e){for(var i=[],o=0;o<=360;o+=12){var n=SuperMapAlgoPlot.PlottingUtil.circlePoint(t,e,e,o);i.push(n)}return i}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i)).length<this.minEditPts)return;var o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i);if(0===t)this.scaleValues[0]=(e.y-i[0].y)/o;else if(1===t){var n=o*this.scaleValues[0],l=new SuperMapAlgoPlot.Point(i[0].x,i[0].y+n),s=SuperMapAlgoPlot.PlottingUtil.distance(e,l);this.scaleValues[1]=s/o}}this.calculateParts()}}])&&Fn(i.prototype,o),n&&Fn(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Xn(t){"@babel/helpers - typeof";return(Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hn(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Zn(o.key),o)}}function Zn(t){var e=function(t,e){if("object"!=Xn(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Xn(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Xn(e)?e:e+""}function Jn(t,e,i){return e=Kn(e),function(t,e){if(e&&("object"===Xn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Kn(t).constructor):e.apply(t,i))}function qn(){return(qn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Kn(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function Kn(t){return(Kn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Qn(t,e){return(Qn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.NodeChain=Wn;var $n=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Jn(this,e,[t])).scaleValues.length&&i.scaleValues.push(.2),i.CLASS_NAME="SuperMapAlgoPlot.Runway",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qn(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"destroy",value:function(){qn(Kn(e.prototype),"destroy",this).call(this)}},{key:"calculateParts",value:function(){if(this.init(),this.controlPoints.length>=this.minEditPts){for(var t=this.controlPoints[0],e=this.controlPoints[1],i=SuperMapAlgoPlot.PlottingUtil.distance(t,e),o=this.scaleValues[0]*i,n=(SuperMapAlgoPlot.PlottingUtil.parallel(this.controlPoints,o/2),SuperMapAlgoPlot.PlottingUtil.parallel(this.controlPoints,-o/2),180*SuperMapAlgoPlot.PlottingUtil.radian(t,e)/Math.PI),l=[],s=n+90;s<=n+270;s+=10){var a=SuperMapAlgoPlot.PlottingUtil.circlePoint(t,o/2,o/2,s);l.push(a)}for(var r=[],u=n-90;u<=n+90;u+=10){var p=SuperMapAlgoPlot.PlottingUtil.circlePoint(e,o/2,o/2,u);r.push(p)}var h=[];h=(h=h.concat(l)).concat(r),this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,h);var c=new SuperMapAlgoPlot.Point(l[0].x,l[0].y);this.addScalePoint(c)}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint&&0==t){var i=SuperMapAlgoPlot.PlottingUtil.distance(e,this.controlPoints[0]),o=SuperMapAlgoPlot.PlottingUtil.distance(this.controlPoints[0],this.controlPoints[1]);this.scaleValues[0]=2*i/o}this.calculateParts()}}])&&Hn(i.prototype,o),n&&Hn(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function tl(t){"@babel/helpers - typeof";return(tl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function el(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,il(o.key),o)}}function il(t){var e=function(t,e){if("object"!=tl(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=tl(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==tl(e)?e:e+""}function ol(t,e,i){return e=ll(e),function(t,e){if(e&&("object"===tl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],ll(t).constructor):e.apply(t,i))}function nl(){return(nl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ll(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function ll(t){return(ll=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function sl(t,e){return(sl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.Runway=$n;var al=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=ol(this,e,[t])).CLASS_NAME="SuperMapAlgoPlot.CurveEight",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&sl(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"destroy",value:function(){nl(ll(e.prototype),"destroy",this).call(this)}},{key:"calculateParts",value:function(){if(this.init(),this.controlPoints&&null!==this.controlPoints&&!(this.minEditPts>this.controlPoints.length))if(2===this.controlPoints.length){var t=this.controlPoints[0].clone(),e=this.controlPoints[1].clone(),i=SuperMapAlgoPlot.PlottingUtil.distance(t,e)/2,o=180*SuperMapAlgoPlot.PlottingUtil.radian(t,e)/Math.PI,n=new SuperMapAlgoPlot.Point((t.x+e.x)/2,(t.y+e.y)/2),l=SuperMapAlgoPlot.PlottingUtil.circlePoint(n,i,i,o+90),s=SuperMapAlgoPlot.PlottingUtil.circlePoint(n,3*i,3*i,o+90);this.addCell(SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,[l,new SuperMapAlgoPlot.Point(l.x+i,l.y)]),this.addCell(SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,[s,new SuperMapAlgoPlot.Point(s.x+i,s.y)])}else{var a=this.controlPoints[0].clone(),r=this.controlPoints[1].clone(),u=this.controlPoints[2].clone(),p=0;p=SuperMapAlgoPlot.PlottingUtil.isRight(u,a,r)?180*SuperMapAlgoPlot.PlottingUtil.radian(r,a)/Math.PI+90:180*SuperMapAlgoPlot.PlottingUtil.radian(a,r)/Math.PI+90;var h=SuperMapAlgoPlot.PlottingUtil.distance(a,r)/2,c=new SuperMapAlgoPlot.Point((a.x+r.x)/2,(a.y+r.y)/2),y=SuperMapAlgoPlot.PlottingUtil.circlePoint(c,h,h,p),g=SuperMapAlgoPlot.PlottingUtil.plumbLineLen(u,a,r);if(g<=4*h){var f=SuperMapAlgoPlot.PlottingUtil.circlePoint(c,3*h,3*h,p);this.addCell(SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,[y,new SuperMapAlgoPlot.Point(y.x+h,y.y)]),this.addCell(SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,[f,new SuperMapAlgoPlot.Point(f.x+h,f.y)])}else{for(var d=SuperMapAlgoPlot.PlottingUtil.circlePoint(c,g-h,g-h,p),m=180*Math.acos(h/(g-2*h))/Math.PI,S=p-m,P=p-180+m,b=p-180-m+360,v=[],L=p+m-360;L<=S;L+=4){var M=SuperMapAlgoPlot.PlottingUtil.circlePoint(y,h,h,L);v.push(M)}var _=SuperMapAlgoPlot.PlottingUtil.circlePoint(y,h,h,S);v.push(_);for(var A=[],T=P;T<b;T+=4){var x=SuperMapAlgoPlot.PlottingUtil.circlePoint(d,h,h,T);A.push(x)}var O=SuperMapAlgoPlot.PlottingUtil.circlePoint(d,h,h,b);A.push(O);var w=[];w=w.concat(v);for(var C=A.length-1;C>=0;C--)w.push(A[C]);this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,w)}}}}])&&el(i.prototype,o),n&&el(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function rl(t){"@babel/helpers - typeof";return(rl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ul(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,pl(o.key),o)}}function pl(t){var e=function(t,e){if("object"!=rl(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=rl(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==rl(e)?e:e+""}function hl(t,e,i){return e=cl(e),function(t,e){if(e&&("object"===rl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],cl(t).constructor):e.apply(t,i))}function cl(t){return(cl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function yl(t,e){return(yl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.CurveEight=al;var gl=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=hl(this,e,[t])).relLineText=t.relLineText?t.relLineText:0,i.showPathLine=!t.showPathLine||t.showPathLine,i.showPathLineArrow=!!t.showPathLineArrow&&t.showPathLineArrow,i.isCurve=!!t.isCurve&&t.isCurve,i.startPolyLineLength=2,i.isAvoid=!!t.isAvoid&&t.isAvoid,i.textToLineDistance=t.textToLineDistance?t.textToLineDistance:0,i.fontSpace=t.fontSpace?t.fontSpace:0,i.dNowPassedDistance=t.dNowPassedDistance?t.dNowPassedDistance:2,i.isScalePoint=!1,i.oldPathTextStart=void 0,i.oldDNowPassedDistance=2,i.CLASS_NAME="SuperMapAlgoPlot.PathText",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yl(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){if(this.init(),null!==this.controlPoints&&0!==this.controlPoints.length&&!(this.controlPoints.length<this.minEditPts)){SuperMap.Util.isArray(this.textContent)||(this.textContent=[this.textContent]);var t=[];if(t=this.isCurve?SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(this.controlPoints):SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints),this.relLineText===SuperMapAlgoPlot.RelLineText.ONBOTHLINE){this.relLineText=SuperMapAlgoPlot.RelLineText.ONRIGHTLINE,this.textPathPts=this.getTextPathPts(t,!1),this.computeText(this.textPathPts,this.textContent[0],t),this.relLineText=SuperMapAlgoPlot.RelLineText.ONLEFTLINE;var e=this.showPathLine;this.showPathLine=!1,this.textPathPts=this.getTextPathPts(t,!0),this.textContent.length>1?this.computeText(this.textPathPts,this.textContent[1],t):this.computeText(this.textPathPts,this.textContent[0],t),this.relLineText=SuperMapAlgoPlot.RelLineText.ONBOTHLINE,this.showPathLine=e}else this.relLineText===SuperMapAlgoPlot.RelLineText.ONRIGHTLINE?this.textPathPts=this.getTextPathPts(t,!1):this.relLineText===SuperMapAlgoPlot.RelLineText.ONLEFTLINE?this.textPathPts=this.getTextPathPts(t,!0):this.textPathPts=t,this.computeText(this.textPathPts,this.textContent[0],t);this.finish()}}},{key:"getTextPathPts",value:function(t,e){t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t);var i=this.getLonLatDistanceFromPixel(this.textToLineDistance);if(0>=i)return SuperMapAlgoPlot.PlottingUtil.clonePoints(t);var o=SuperMapAlgoPlot.PlottingUtil.paraLine(t,i,e);return SuperMapAlgoPlot.PlottingUtil.clearSamePts(o)}},{key:"computeText",value:function(t,e,i){if(!(t.length<2)){for(var o=e.length,n=t,l=n.length,s=0,a=0;a<n.length-1;a++)s+=SuperMapAlgoPlot.PlottingUtil.distance(n[a],n[a+1]);var r={index:-1,pt:n[0]},u=0,p=0,h=180/Math.PI,c=this.getTextBounds(this.style,e),y="lm";y=this.relLineText===SuperMapAlgoPlot.RelLineText.ONLINE?"lm":this.relLineText===SuperMapAlgoPlot.RelLineText.ONLEFTLINE?"lb":"lt",this.isScalePoint||(this.dNowPassedDistance=this.oldDNowPassedDistance),this.dNowPassedDistance<=0&&(this.dNowPassedDistance=0);for(var g=[],f=0;f<o;f++){var d=this.getTextBounds(this.style,e.charAt(f));g.push(new SuperMap.Bounds(0,-c.getHeight(),d.getWidth(),0))}var m,S=!0,P=0,b=0,v=[];for(this.fontSpace=S?(s-2*this.dNowPassedDistance-c.getWidth())/(o-1):(s-2*this.dNowPassedDistance-c.getHeight())/(o-1),this.fontSpace<0&&(this.fontSpace=0);u<=this.dNowPassedDistance&&p<l-1;)p++,u+=SuperMapAlgoPlot.PlottingUtil.distance(n[p-1],n[p]);var L=this.oldPathTextStart;this.isScalePoint||!this.oldPathTextStart?(L=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(n,this.dNowPassedDistance),this.startPolyLineLength=this.dNowPassedDistance):(this.oldPathTextStart=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(n,this.dNowPassedDistance),L=this.oldPathTextStart);var M=SuperMapAlgoPlot.PlottingUtil.radian(n[p-1],n[p])*h;M>180&&(M-=360),M<-180&&(M+=360),M>90&&M<=180?P=-180:M>-180&&M<-90&&(P=180),S=!0,0!=P?this.relLineText===SuperMapAlgoPlot.RelLineText.ONLINE||(y=this.relLineText===SuperMapAlgoPlot.RelLineText.ONLEFTLINE?"lt":"lb"):this.relLineText===SuperMapAlgoPlot.RelLineText.ONLINE||(y=this.relLineText===SuperMapAlgoPlot.RelLineText.ONLEFTLINE?"lb":"lt");for(var _=[],A=[],T=[],x=0;x<o&&!(this.dNowPassedDistance>s);x++){0===x&&(this.oldDNowPassedDistance=this.dNowPassedDistance);var O=x;for(0,m=g[O],b=S?m.getWidth():m.getHeight();u<=this.dNowPassedDistance&&p<l-1;)p++,u+=SuperMapAlgoPlot.PlottingUtil.distance(n[p-1],n[p]);M=SuperMapAlgoPlot.PlottingUtil.radian(n[p-1],n[p])*h,this.dNowPassedDistance=0===x?this.dNowPassedDistance+0:this.dNowPassedDistance+this.fontSpace,r=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(n,this.dNowPassedDistance);var w=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(n,this.dNowPassedDistance+b),C=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(n,this.dNowPassedDistance+b+this.fontSpace);T.push({stratLength:this.dNowPassedDistance+b,endLength:this.dNowPassedDistance+b+this.fontSpace}),_.push(w),A.push(C);for(var E=0;E<n.length-1;E++){var I=[];if(I.push(n[E]),I.push(n[E+1]),!r.pt)break;SuperMapAlgoPlot.PlottingUtil.pointIsOnPolyLines(r.pt,I).isOnPolyLine&&(M=SuperMapAlgoPlot.PlottingUtil.radian(n[E],n[E+1])*h)}var D=M+P;if(r.index<0)break;m.add(r.pt.x,r.pt.y);var U=e.charAt(O),R={};R.type=SuperMapAlgoPlot.SymbolType.TEXTSYMBOL,R.textContent=U,R.positionPoints=[r.pt],R.style={surroundLineFlag:!1,labelAlign:y,labelRotation:-D},v.push(R),this.dNowPassedDistance+=b}var N=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(n,this.dNowPassedDistance);if(this.showPathLine){if(this.relLineText===SuperMapAlgoPlot.RelLineText.ONLINE&&this.isAvoid){if(this.isCurve){var B=[];B.push(i[0]),B.push(i[1]);for(var k=2;k<i.length;k++){if(!(SuperMapAlgoPlot.PlottingUtil.polylineDistance(B)<this.startPolyLineLength)){this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,B);break}B.push(i[k])}}else if(L.index>=0){for(var F=[],j=0;j<=L.index;j++)F.push(i[j]);F.push(L.pt),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,F)}for(var V=0;V<_.length-1;V++){for(var z=!1,Y=[],G=1;G<i.length-1;G++)if(i[G].x>_[V].pt.x&&i[G].x<A[V].pt.x||i[G].y>_[V].pt.y&&i[G].y<A[V].pt.y){for(var W=[],X=0;X<=G;X++)W.push(i[X]);var H=SuperMapAlgoPlot.PlottingUtil.polylineDistance(W);H>T[V].stratLength&&H<T[V].endLength&&Y.push(G)}if(1===Y.length){var Z=[];Z.push(_[V].pt),Z.push(i[Y[0]]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,Z),(Z=[]).push(i[Y[0]]),Z.push(A[V].pt),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,Z),z=!0}else if(0!=Y.length){var J=[];J.push(_[V].pt),J.push(i[Y[0]]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,J);for(var q=0;q<Y.length-1;q++)(J=[]).push(i[Y[q]]),J.push(i[Y[q+1]]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,J);(J=[]).push(i[Y[Y.length-1]]),J.push(A[V].pt),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,J),z=!0}if(!z){var K=[];K.push(_[V].pt),K.push(A[V].pt),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,K)}}if(N.index>=0){var Q=[];Q.push(N.pt);for(var $=N.index+1;$<i.length;$++)Q.push(i[$]);this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,Q)}}else this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,i);if(this.showPathLineArrow&&this.addArrow(i),L.pt){var tt=SuperMapAlgoPlot.PlottingUtil.distance(n[0],L.pt),et=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(n,tt);this.addScalePoint(et.pt)}}for(var it=0;it<v.length;it++)this.components.push(v[it]);this.isScalePoint=!1,this.oldPathTextStart=L}}},{key:"addArrow",value:function(t){if(t.length<2)return t;var e=SuperMapAlgoPlot.PlottingUtil.polylineDistance(this.controlPoints)*(this.isEdit,null==this.getSubSymbolScaleValue()?.05:.5*this.getSubSymbolScaleValue()),i=t[t.length-1];if(t.length>2){for(var o=-1,n=t.length-2;n>=0;n--)if(e<SuperMapAlgoPlot.PlottingUtil.distance(i,t[n])){o=n;break}t.splice(o+1,t.length-o),t.push(i)}var l=t[t.length-2],s=t[t.length-1],a=e;if(void 0===l)return t;if(!(SuperMapAlgoPlot.PlottingUtil.distance(l,s)<e)){var r=SuperMapAlgoPlot.PlottingUtil.radian(l,s)*SuperMapAlgoPlot.PlottingUtil.RTOD,u=SuperMapAlgoPlot.PlottingUtil.circlePoint(s,a,a,r+157.5),p=SuperMapAlgoPlot.PlottingUtil.circlePoint(s,a,a,r+202.5);this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,[u,t[t.length-1],p],{surroundLineFlag:!1,fillLimit:!0,lineTypeLimit:!0,fill:!0})}}},{key:"modifyPoint",value:function(t,e){if(e.isScalePoint){for(var i=0,o=0;o<this.controlPoints.length-1;o++){var n=[];n.push(this.controlPoints[o]),n.push(this.controlPoints[o+1]),SuperMapAlgoPlot.PlottingUtil.pointIsOnPolyLines(e,n).isOnPolyLine||i++}if(i===this.controlPoints.length-1)return;this.isScalePoint=!0;var l=SuperMapAlgoPlot.PlottingUtil.distance(this.textPathPts[0],e);this.dNowPassedDistance=l}this.calculateParts()}}])&&ul(i.prototype,o),n&&ul(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function fl(t){"@babel/helpers - typeof";return(fl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function dl(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ml(o.key),o)}}function ml(t){var e=function(t,e){if("object"!=fl(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=fl(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==fl(e)?e:e+""}function Sl(t,e,i){return e=bl(e),function(t,e){if(e&&("object"===fl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],bl(t).constructor):e.apply(t,i))}function Pl(){return(Pl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=bl(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function bl(t){return(bl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function vl(t,e){return(vl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.PathText=gl;var Ll=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=Sl(this,e,[t])).islocationCircle=!!t.islocationCircle&&t.islocationCircle,i.textBoxType=t.textBoxType?t.textBoxType:SuperMapAlgoPlot.TextBoxType.RECTBOX,0===i.scaleValues.length&&(i.scaleValues.push(.126),i.scaleValues.push(0),i.scaleValues.push(0),i.scaleValues.push(4)),i.CLASS_NAME="SuperMapAlgoPlot.LineMarking",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&vl(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"destroy",value:function(){this.islocationCircle=null,this.textBoxType=null,Pl(bl(e.prototype),"destroy",this).call(this)}},{key:"calculateParts",value:function(){this.init(),this.controlPoints=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints),this.controlPoints=SuperMapAlgoPlot.PlottingUtil.clearSamePts(this.controlPoints);var t=this.scaleValues[0];if(!(t<0||t>1)){if(t=(1-t)/2,this.controlPoints.length>=this.minEditPts){var e,i,o,n;this.scalePoints=[];var l=[];this.controlPoints[0].x<this.controlPoints[1].x?(e=this.controlPoints[0].x,o=this.controlPoints[1].x):(e=this.controlPoints[1].x,o=this.controlPoints[0].x),this.controlPoints[0].y<this.controlPoints[1].y?(n=this.controlPoints[0].y,i=this.controlPoints[1].y):(n=this.controlPoints[1].y,i=this.controlPoints[0].y),l.push(new SuperMapAlgoPlot.Point(e,n)),l.push(new SuperMapAlgoPlot.Point(e,i)),l.push(new SuperMapAlgoPlot.Point(o,i)),l.push(new SuperMapAlgoPlot.Point(o,n)),!1===this.isEdit&&(this.scaleValues[1]=e+.1*(o-e),this.scaleValues[2]=n+-.3*(i-n));var s=this.getAction(this.scaleValues[1],this.scaleValues[2],e,i,o,n),a=new SuperMapAlgoPlot.Point(this.scaleValues[1],this.scaleValues[2]);if(this.textBoxType===SuperMapAlgoPlot.TextBoxType.RECTBOX||this.textBoxType===SuperMapAlgoPlot.TextBoxType.LINEBOX){var r=[];switch(s){case 0:this.addScalePoint(a);break;case 1:this.addScalePoint(a),r.push(new SuperMapAlgoPlot.Point(e,i-(i-n)*t)),r.push(a);break;case 2:this.addScalePoint(a),r.push(new SuperMapAlgoPlot.Point(o-(o-e)*t,i)),r.push(a);break;case 3:this.addScalePoint(a),r.push(new SuperMapAlgoPlot.Point(o,i-(i-n)*t)),r.push(a);break;case 4:this.addScalePoint(a),r.push(new SuperMapAlgoPlot.Point(o-(o-e)*t,n)),r.push(a)}this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,r)}if(0!==l.length&&this.textBoxType===SuperMapAlgoPlot.TextBoxType.RECTBOX)this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,l);else if(0!==l.length&&this.textBoxType===SuperMapAlgoPlot.TextBoxType.LINEBOX){var u=[];switch(s){case 0:break;case 1:u=(u=u.concat(l[0])).concat(l[1]);break;case 2:u=(u=u.concat(l[1])).concat(l[2]);break;case 3:u=(u=u.concat(l[2])).concat(l[3]);break;case 4:u=(u=u.concat(l[3])).concat(l[0])}0!==u.length?this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,u):this.addCell(SuperMapAlgoPlot.SymbolType.RECTANGLESYMBOL,this.controlPoints)}this.islocationCircle&&this.addCell(SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,[a,new SuperMapAlgoPlot.Point(a.x-.05,a.y-.05)]),this.annotationContent(e,i,o,n)}else this.controlPoints.length>=2&&this.controlPoints.length<this.minEditPts&&this.addCell(SuperMapAlgoPlot.SymbolType.RECTANGLESYMBOL,this.controlPoints);this.finish()}}},{key:"modifyPoint",value:function(t,e){!0===e.isScalePoint&&(this.scaleValues[1]=e.x,this.scaleValues[2]=e.y),this.calculateParts()}},{key:"getAction",value:function(t,e,i,o,n,l){var s=(o-l)/(n-i);return t<i?e>o?Math.abs((e-o)/(t-i))>s?2:1:e<l&&Math.abs((e-l)/(t-i))>s?4:1:t>n?e>o?Math.abs((e-o)/(t-n))>s?2:3:e<l&&Math.abs((e-l)/(t-n))>s?4:3:e>o?2:e<l?4:0}}])&&dl(i.prototype,o),n&&dl(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Ml(t){"@babel/helpers - typeof";return(Ml="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _l(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Al(o.key),o)}}function Al(t){var e=function(t,e){if("object"!=Ml(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ml(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ml(e)?e:e+""}function Tl(t,e,i){return e=Ol(e),function(t,e){if(e&&("object"===Ml(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Ol(t).constructor):e.apply(t,i))}function xl(){return(xl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ol(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function Ol(t){return(Ol=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function wl(t,e){return(wl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.LineMarking=Ll;var Cl=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=Tl(this,e,[t])).subSectionCount=t.subSectionCount?t.subSectionCount:10,i.CLASS_NAME="SuperMapAlgoPlot.LineRelation",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wl(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"destroy",value:function(){this.subSectionCount=null,xl(Ol(e.prototype),"destroy",this).call(this)}},{key:"calculateParts",value:function(){this.init();for(var t=0;t<this.controlPoints.length;t++)this.controlPoints[t].tag=t;var e=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);null!==e&&e.length>=this.minEditPts&&this.computeLine(e)}},{key:"computeLine",value:function(t){this.components.length=0;var e=t[0],i=t[t.length-1];this.subSectionCount<=1&&(this.subSectionCount=10);var o=SuperMapAlgoPlot.PlottingUtil.distance(e,i)/(2*this.subSectionCount-1);if(this.lineRelationType===SuperMapAlgoPlot.LineRelationType.SOLID)this.addCell(24,t,{surroundLineFlag:!1});else if(this.lineRelationType===SuperMapAlgoPlot.LineRelationType.DASH)for(var n=0;n<this.subSectionCount;n++){var l=SuperMapAlgoPlot.PlottingUtil.findPoint(e,i,2*n*o,0),s=SuperMapAlgoPlot.PlottingUtil.findPoint(e,i,(2*n+1)*o,0);this.addCell(24,[l,s],{surroundLineFlag:!1})}else if(this.lineRelationType===SuperMapAlgoPlot.LineRelationType.ARROW)for(var a=0;a<this.subSectionCount;a++){var r=SuperMapAlgoPlot.PlottingUtil.findPoint(e,i,2*a*o,0),u=SuperMapAlgoPlot.PlottingUtil.findPoint(e,i,(2*a+1)*o,0),p=SuperMapAlgoPlot.PlottingUtil.findPoint(u,r,o,60),h=SuperMapAlgoPlot.PlottingUtil.findPoint(u,r,o,-60);this.addCell(24,[p,u,h],{surroundLineFlag:!1})}}}])&&_l(i.prototype,o),n&&_l(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function El(t){"@babel/helpers - typeof";return(El="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Il(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Dl(o.key),o)}}function Dl(t){var e=function(t,e){if("object"!=El(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=El(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==El(e)?e:e+""}function Ul(t,e,i){return e=Nl(e),function(t,e){if(e&&("object"===El(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Nl(t).constructor):e.apply(t,i))}function Rl(){return(Rl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Nl(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function Nl(t){return(Nl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bl(t,e){return(Bl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.LineRelation=Cl;var kl=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),void 0===(i=Ul(this,e,[t])).scaleValues[0]&&(i.scaleValues[0]=0),void 0===i.scaleValues[1]&&(i.scaleValues[1]=0),i.CLASS_NAME="SuperMapAlgoPlot.PolygonRegion",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Bl(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"destroy",value:function(){Rl(Nl(e.prototype),"destroy",this).call(this)}},{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(null!=(t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t))&&t.length>=this.minEditPts){if(this.addCell(32,t,{surroundLineFlag:!1}),this.textContent&&null!=this.textContent&&this.textContent.length>0){var e=[];this.scaleValues[1]>t.length&&(this.scaleValues[1]=0);var i={labelRotation:0,surroundLineFlag:!1,labelAlign:"lt"};if(0===this.scaleValues[1])e=[SuperMapAlgoPlot.PlottingUtil.getPolygonCenterPt(t)];else{var o=null,n=null;this.scaleValues[1]===t.length?(o=t[t.length-1],n=t[0]):(o=t[this.scaleValues[1]-1],n=t[this.scaleValues[1]]),i.labelRotation=-SuperMapAlgoPlot.PlottingUtil.radian(o,n)/Math.PI*180;var l=this.scaleValues[0]*SuperMapAlgoPlot.PlottingUtil.distance(o,n);e=[SuperMapAlgoPlot.PlottingUtil.findPoint(o,n,l,0)]}this.addCell(34,e,i,this.textContent);var s=new SuperMapAlgoPlot.Point(e[0].x,e[0].y);s.isScalePoint=!0,s.tag=0,this.scalePoints=[],this.addScalePoint(s)}}else this.controlPoints.length>=2&&this.controlPoints.length<this.minEditPts&&this.calAssistantLine()}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){for(var i=0,o=SuperMapAlgoPlot.PlottingUtil.distance(e,this.controlPoints[0]),n=1;n<this.controlPoints.length;n++){var l=SuperMapAlgoPlot.PlottingUtil.distance(e,this.controlPoints[n]);l<o&&(o=l,i=n)}var s=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);(s=SuperMapAlgoPlot.PlottingUtil.clearSamePts(s)).push(s[0].clone());var a=SuperMapAlgoPlot.PlottingUtil.computePointToLineMinDis(e,s);if(-1===a.minDis)this.scaleValues[1]=i+1,this.offsetX=0,this.offsetY=0;else{var r=SuperMapAlgoPlot.PlottingUtil.projectPoint(e,s[a.index],s[a.index+1]),u=SuperMapAlgoPlot.PlottingUtil.distance(e,r),p=SuperMapAlgoPlot.PlottingUtil.getPolygonCenterPt(this.controlPoints),h=SuperMapAlgoPlot.PlottingUtil.distance(e,p);if(h<u&&h<o)this.scaleValues[1]=0,this.scaleValues[0]=0;else if(o<u&&o<h)this.scaleValues[1]=i+1,this.scaleValues[0]=0;else if(u<o&&u<h){this.scaleValues[1]=a.index+1;var c=null,y=null;this.scaleValues[1]===this.controlPoints.length?(c=this.controlPoints[this.controlPoints.length-1],y=this.controlPoints[0]):(c=this.controlPoints[this.scaleValues[1]-1],y=this.controlPoints[this.scaleValues[1]]);var g=SuperMapAlgoPlot.PlottingUtil.distance(r,c),f=SuperMapAlgoPlot.PlottingUtil.distance(c,y);this.scaleValues[0]=g/f}}}this.calculateParts()}},{key:"parseSymbolData",value:function(){Rl(Nl(e.prototype),"parseSymbolData",this).call(this),this.symbolData&&(this.scaleValues[1]=this.symbolData.annotationPosition)}},{key:"setSymbolData",value:function(){Rl(Nl(e.prototype),"setSymbolData",this).call(this),this.symbolData&&(this.symbolData.annotationPosition=this.scaleValues[1])}}])&&Il(i.prototype,o),n&&Il(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Fl(t){"@babel/helpers - typeof";return(Fl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jl(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Vl(o.key),o)}}function Vl(t){var e=function(t,e){if("object"!=Fl(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Fl(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Fl(e)?e:e+""}function zl(t,e,i){return e=Yl(e),function(t,e){if(e&&("object"===Fl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Yl(t).constructor):e.apply(t,i))}function Yl(t){return(Yl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Gl(t,e){return(Gl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.PolygonRegion=kl;var Wl=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=zl(this,e,[t])).scaleValues.length&&i.scaleValues.push(.05),i.CLASS_NAME="SuperMapAlgoPlot.Wire",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gl(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){this.isEdit||(this.scaleValues[0]=2*this.getSubSymbolScaleValue());var e=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t);e=SuperMapAlgoPlot.PlottingUtil.clearSamePts(e);var i=SuperMapAlgoPlot.PlottingUtil.polylineDistance(e);this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,e);for(var o=i*this.scaleValues[0],n=i*this.scaleValues[0]/2,l=SuperMapAlgoPlot.PlottingUtil.clonePoints(e),s=parseInt((i-n)/o),a=0;a<=s&&!(n+o*a>i);a++){var r=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(l,n+o*a);if(-1!==r.index){var u=new SuperMapAlgoPlot.Point(r.pt.x,r.pt.y),p=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(o/2,e[r.index],u);this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,[p.pntLeft,p.pntRight])}}this.finish()}}}])&&jl(i.prototype,o),n&&jl(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Xl(t){"@babel/helpers - typeof";return(Xl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hl(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Zl(o.key),o)}}function Zl(t){var e=function(t,e){if("object"!=Xl(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Xl(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Xl(e)?e:e+""}function Jl(t,e,i){return e=ql(e),function(t,e){if(e&&("object"===Xl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],ql(t).constructor):e.apply(t,i))}function ql(t){return(ql=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Kl(t,e){return(Kl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.Wire=Wl;var Ql=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Jl(this,e,[t])).scaleValues.length&&(i.scaleValues.push(15),i.scaleValues.push(7.5),i.scaleValues.push(0),i.scaleValues.push(15),i.scaleValues.push(7.5),i.scaleValues.push(0)),i.CLASS_NAME="SuperMapAlgoPlot.LinearArrow",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Kl(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){if(this.init(),!(null==this.controlPoints||this.controlPoints.length<this.minEditPts)){var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){if(this.scalePoints=[],this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,t),!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(this.scaleValues[0],0)&&!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(this.scaleValues[1],0)){var e=this.scaleValues[0]*(this.style.weight||this.style.strokeWidth),i=this.scaleValues[1]*(this.style.weight||this.style.strokeWidth),o=this.getLonLatDistanceFromPixel(e),n=this.getLonLatDistanceFromPixel(i),l=SuperMapAlgoPlot.PlottingUtil.findPointInLine(t[0],t[1],o),s=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(n,t[1],l),a=[];if(a.push(s.pntLeft),a.push(t[0]),a.push(s.pntRight),this.addScalePoint(s.pntLeft,0),SuperMapAlgoPlot.PlottingUtil.equalFuzzy(this.scaleValues[2],0))this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,a,{fillLimit:!0,fill:!0}),this.addScalePoint(l,1);else if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(this.scaleValues[2],1))this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,a),this.addScalePoint(t[0],1);else{var r=o*this.scaleValues[2],u=SuperMapAlgoPlot.PlottingUtil.findPointInLine(l,t[0],r);a.push(u),this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,a,{fillLimit:!0,fill:!0}),this.addScalePoint(u,1)}}if(!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(this.scaleValues[3],0)&&!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(this.scaleValues[4],0)){var p=this.scaleValues[3]*(this.style.weight||this.style.strokeWidth),h=this.scaleValues[4]*(this.style.weight||this.style.strokeWidth),c=this.getLonLatDistanceFromPixel(p),y=this.getLonLatDistanceFromPixel(h),g=SuperMapAlgoPlot.PlottingUtil.findPointInLine(t[1],t[0],c),f=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(y,t[0],g),d=[];if(d.push(f.pntLeft),d.push(t[1]),d.push(f.pntRight),this.addScalePoint(f.pntLeft,2),SuperMapAlgoPlot.PlottingUtil.equalFuzzy(this.scaleValues[5],0))this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,d,{fillLimit:!0,fill:!0}),this.addScalePoint(g,3);else if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(this.scaleValues[5],1))this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,d),this.addScalePoint(t[1],3);else{var m=c*this.scaleValues[5],S=SuperMapAlgoPlot.PlottingUtil.findPointInLine(g,t[1],m);d.push(S),this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,d,{fillLimit:!0,fill:!0}),this.addScalePoint(S,3)}}this.finish()}}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i),0===t){var o=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,i[0],i[1]);if(o.isOnline){var n=this.scaleValues[0]*(this.style.weight||this.style.strokeWidth),l=this.getLonLatDistanceFromPixel(n),s=l*this.scaleValues[2],a=SuperMapAlgoPlot.PlottingUtil.findPointInLine(i[0],i[1],l),r=SuperMapAlgoPlot.PlottingUtil.findPointInLine(a,i[0],s);l=SuperMapAlgoPlot.PlottingUtil.distance(i[0],o.projectPoint),n=this.getPixelDistanceFromLonLat(l),this.scaleValues[0]=n/(this.style.weight||this.style.strokeWidth);var u=SuperMapAlgoPlot.PlottingUtil.distance(e,o.projectPoint),p=this.getPixelDistanceFromLonLat(u);this.scaleValues[1]=p/(this.style.weight||this.style.strokeWidth),s=SuperMapAlgoPlot.PlottingUtil.distance(r,o.projectPoint),this.scaleValues[2]=s/l}}else if(1===t){var h=this.scaleValues[0]*(this.style.weight||this.style.strokeWidth),c=this.getLonLatDistanceFromPixel(h),y=SuperMapAlgoPlot.PlottingUtil.findPointInLine(i[0],i[1],c),g=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,y,i[0]);if(g.isOnline){var f=SuperMapAlgoPlot.PlottingUtil.distance(y,g.projectPoint);this.scaleValues[2]=f/c,this.scaleValues[2]<0?this.scaleValues[2]=0:this.scaleValues[2]>1&&(this.scaleValues[2]=1)}}else if(2===t){var d=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,i[0],i[1]);if(d.isOnline){var m=this.scaleValues[3]*(this.style.weight||this.style.strokeWidth),S=this.getLonLatDistanceFromPixel(m),P=S*this.scaleValues[5],b=SuperMapAlgoPlot.PlottingUtil.findPointInLine(i[1],i[0],S),v=SuperMapAlgoPlot.PlottingUtil.findPointInLine(b,i[1],P);S=SuperMapAlgoPlot.PlottingUtil.distance(i[1],d.projectPoint),m=this.getPixelDistanceFromLonLat(S),this.scaleValues[3]=m/(this.style.weight||this.style.strokeWidth);var L=SuperMapAlgoPlot.PlottingUtil.distance(e,d.projectPoint),M=this.getPixelDistanceFromLonLat(L);this.scaleValues[4]=M/(this.style.weight||this.style.strokeWidth),P=SuperMapAlgoPlot.PlottingUtil.distance(v,d.projectPoint),this.scaleValues[5]=P/S}}else if(3===t){var _=this.scaleValues[3]*(this.style.weight||this.style.strokeWidth),A=this.getLonLatDistanceFromPixel(_),T=SuperMapAlgoPlot.PlottingUtil.findPointInLine(i[1],i[0],A),x=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,T,i[1]);if(x.isOnline){var O=SuperMapAlgoPlot.PlottingUtil.distance(T,x.projectPoint);this.scaleValues[5]=O/A,this.scaleValues[5]<0?this.scaleValues[5]=0:this.scaleValues[5]>1&&(this.scaleValues[5]=1)}}}this.calculateParts()}}])&&Hl(i.prototype,o),n&&Hl(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function $l(t){"@babel/helpers - typeof";return($l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ts(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,es(o.key),o)}}function es(t){var e=function(t,e){if("object"!=$l(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=$l(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==$l(e)?e:e+""}function is(t,e,i){return e=os(e),function(t,e){if(e&&("object"===$l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],os(t).constructor):e.apply(t,i))}function os(t){return(os=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ns(t,e){return(ns=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.LinearArrow=Ql;var ls=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),is(this,e,[t])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ns(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){var e=[];if(this.m_bIsAnimation)t.length<3?(e.push(t[0]),e.push(t[1])):e=e.concat(t);else if(this.isEdit||(this.scaleValues=[]),this.scalePoints=[],t.length<3)e.push(t[0]),e.push(t[1]);else{var i=SuperMapAlgoPlot.PlottingUtil.computeBeizerPoints(this.isEdit,t,this.scaleValues);this.scaleValues=i.scaleValues;for(var o=0;o<i.scalePoints.length;o++)this.addScalePoint(i.scalePoints[o]);e=i.beizerPoints}SuperMapAlgoPlot.PlottingUtil.clearSamePts(e),e.length<=0||(this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,e),this.finish())}}},{key:"computeScaleValues",value:function(t,e){if(!0===e.isScalePoint){if(t<0||t>2*this.controlPoints.length-1)return;var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i),this.minEditPts>i.length)return;var o=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(i);o=SuperMapAlgoPlot.PlottingUtil.clearSamePts(o);var n=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i),l=SuperMapAlgoPlot.PlottingUtil.polylineDistance(o);if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(n,0)||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(l,0))return;var s=-1;s=t%2==0?Math.floor(t/2):Math.floor((t+1)/2);var a=(e.x-i[s].x)/n,r=(e.y-i[s].y)/n;this.scaleValues[2*t]=a,this.scaleValues[2*t+1]=r}}}])&&ts(i.prototype,o),n&&ts(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function ss(t){"@babel/helpers - typeof";return(ss="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function as(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,rs(o.key),o)}}function rs(t){var e=function(t,e){if("object"!=ss(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=ss(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ss(e)?e:e+""}function us(t,e,i){return e=hs(e),function(t,e){if(e&&("object"===ss(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],hs(t).constructor):e.apply(t,i))}function ps(){return(ps="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=hs(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function hs(t){return(hs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function cs(t,e){return(cs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.Polybezier=ls;var ys=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=us(this,e,[t])).CLASS_NAME="SuperMapAlgoPlot.NewPie",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cs(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"destroy",value:function(){ps(hs(e.prototype),"destroy",this).call(this)}},{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length>=this.minEditPts){var e=SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[1]),i=SuperMapAlgoPlot.PlottingUtil.radian(t[0],t[2]),o=SuperMapAlgoPlot.PlottingUtil.radian(t[0],t[1]),n=[];n.push(t[0]),(n=n.concat(SuperMapAlgoPlot.Primitives.getArcCircleSpatialData(t[0],e,i,o))).push(t[0]),0!==n.length&&this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,n)}}}])&&as(i.prototype,o),n&&as(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function gs(t){"@babel/helpers - typeof";return(gs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fs(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ds(o.key),o)}}function ds(t){var e=function(t,e){if("object"!=gs(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=gs(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==gs(e)?e:e+""}function ms(t,e,i){return e=Ps(e),function(t,e){if(e&&("object"===gs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Ps(t).constructor):e.apply(t,i))}function Ss(){return(Ss="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ps(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function Ps(t){return(Ps=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function bs(t,e){return(bs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.NewPie=ys;var vs=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=ms(this,e,[t])).CLASS_NAME="SuperMapAlgoPlot.NewArc",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bs(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"destroy",value:function(){Ss(Ps(e.prototype),"destroy",this).call(this)}},{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length>=this.minEditPts){var e=SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[1]),i=SuperMapAlgoPlot.PlottingUtil.radian(t[0],t[2]),o=SuperMapAlgoPlot.PlottingUtil.radian(t[0],t[1]),n=SuperMapAlgoPlot.Primitives.getArcCircleSpatialData(t[0],e,i,o);0!==n.length&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,n)}}}])&&fs(i.prototype,o),n&&fs(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Ls(t){"@babel/helpers - typeof";return(Ls="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ms(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_s(o.key),o)}}function _s(t){var e=function(t,e){if("object"!=Ls(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ls(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ls(e)?e:e+""}function As(t,e,i){return e=xs(e),function(t,e){if(e&&("object"===Ls(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],xs(t).constructor):e.apply(t,i))}function Ts(){return(Ts="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=xs(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function xs(t){return(xs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Os(t,e){return(Os=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.NewArc=vs;var ws=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=As(this,e,[t])).CLASS_NAME="SuperMapAlgoPlot.NewChord",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Os(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"destroy",value:function(){Ts(xs(e.prototype),"destroy",this).call(this)}},{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length>=this.minEditPts){var e=SuperMapAlgoPlot.PlottingUtil.distance(t[0],t[1]),i=SuperMapAlgoPlot.PlottingUtil.radian(t[0],t[2]),o=SuperMapAlgoPlot.PlottingUtil.radian(t[0],t[1]),n=[];n.push(t[1]),(n=n.concat(SuperMapAlgoPlot.Primitives.getArcCircleSpatialData(t[0],e,i,o))).push(t[1]),0!==n.length&&this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,n)}}}])&&Ms(i.prototype,o),n&&Ms(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Cs(t){"@babel/helpers - typeof";return(Cs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Es(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Is(o.key),o)}}function Is(t){var e=function(t,e){if("object"!=Cs(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Cs(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Cs(e)?e:e+""}function Ds(t,e,i){return e=Us(e),function(t,e){if(e&&("object"===Cs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Us(t).constructor):e.apply(t,i))}function Us(t){return(Us=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Rs(t,e){return(Rs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.NewChord=ws;var Ns=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Ds(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.1),i.scaleValues.push(.2),i.scaleValues.push(0),i.scaleValues.push(.3),i.scaleValues.push(.08)),i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1001",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Rs(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints),e=(t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length;if(e>=this.minEditPts){this.scalePoints=[];var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),o=!1;void 0!==i[0].z&&(o=!0);var n=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePts(t,this.scaleValues,SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_PARALLEL),l=n.arrowTouLen,s=n.leftBodyPts,a=n.rightBodyPts,r=[];r.push(s[s.length-1]),r.push(a[a.length-1]);var u=[];u.push(this.scaleValues[3]),u.push(this.scaleValues[4]),u.push(this.scaleValues[0]),u.push(this.scaleValues[1]);var p=SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePts(t,r,u,l,SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_WITHOUT_EAR),h=[];if(o){for(var c=[],y=[],g=[],f=0;f<e-1;f++)y.push({x:s[f].x,y:s[f].y,z:i[f].z}),g.push({x:a[f].x,y:a[f].y,z:i[f].z});var d={x:i[e-2].x,y:i[e-2].y,z:i[e-2].z},m={x:i[e-1].x,y:i[e-1].y,z:i[e-1].z},S=this.ComputeZValue(s[e-1],m,d);y.push({x:s[e-1].x,y:s[e-1].y,z:S});var P=this.ComputeZValue(a[e-1],m,d);g.push({x:a[e-1].x,y:a[e-1].y,z:P});for(var b=0;b<p.length;b++){var v=this.ComputeZValue(p[b],m,d);c.push({x:p[b].x,y:p[b].y,z:v})}h=(h=h.concat(y)).concat(c);for(var L=g.length-1;L>=0;L--)h.push(g[L]);var M=new SuperMapAlgoPlot.Point((r[0].x+r[1].x)/2,(r[0].y+r[1].y)/2),_=new SuperMapAlgoPlot.Point(M.x,M.y);_.isScalePoint=!0,_.tag=0,this.addScalePoint(_);var A=new SuperMapAlgoPlot.Point(s[s.length-1].x,s[s.length-1].y);A.isScalePoint=!0,A.tag=1,this.addScalePoint(A);var T=new SuperMapAlgoPlot.Point(p[0].x,p[0].y);T.isScalePoint=!0,T.tag=2,this.addScalePoint(T);for(var x=0;x<this.scalePoints.length;x++){var O=new SuperMapAlgoPlot.Point(this.scalePoints[x].x,this.scalePoints[x].y);this.scalePoints[x].z=this.ComputeZValue(O,m,d)}this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,h,{surroundLineFlag:!1,lineWidthLimit:!0,strokeWidth:0,weight:0}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,h)}else{h=(h=h.concat(s)).concat(p);for(var w=a.length-1;w>=0;w--)h.push(a[w]);var C=new SuperMapAlgoPlot.Point((r[0].x+r[1].x)/2,(r[0].y+r[1].y)/2),E=new SuperMapAlgoPlot.Point(C.x,C.y);E.isScalePoint=!0,E.tag=0,this.addScalePoint(E);var I=new SuperMapAlgoPlot.Point(s[s.length-1].x,s[s.length-1].y);I.isScalePoint=!0,I.tag=1,this.addScalePoint(I);var D=new SuperMapAlgoPlot.Point(p[0].x,p[0].y);D.isScalePoint=!0,D.tag=2,this.addScalePoint(D);for(var U=this.mergeDashLine(this.dashLines,[]),R=this.computeDashLine(U,s),N=0;N<R.length-1;N++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,R[N]);for(var B=this.mergeDashLine(this.dashLines,[]),k=this.computeDashLine(B,a),F=0;F<k.length-1;F++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,k[F].reverse());var j=[];j=(j=(j=j.concat(R[R.length-1])).concat(p)).concat(k[k.length-1].reverse()),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,j)}}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=new SuperMapAlgoPlot.Point(this.scalePoints[0].x,this.scalePoints[0].y),o=new SuperMapAlgoPlot.Point(this.scalePoints[1].x,this.scalePoints[1].y),n=new SuperMapAlgoPlot.Point(this.scalePoints[2].x,this.scalePoints[2].y),l=this.scaleValues[0],s=SuperMapAlgoPlot.PlottingUtil.polylineDistance(this.controlPoints),a=s*l;if(0==t){var r=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,this.controlPoints[this.controlPoints.length-2],this.controlPoints[this.controlPoints.length-1]),u=r.projectPoint;if(r.isOnline){var p=SuperMapAlgoPlot.PlottingUtil.distance(u,this.controlPoints[this.controlPoints.length-1]);this.scaleValues[0]=p/s}}else if(1==t){var h=SuperMapAlgoPlot.PlottingUtil.intersectLines(i,o,n,this.controlPoints[1]);if(null!=h.intersectPoint){var c=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,o,h.intersectPoint).projectPoint,y=SuperMapAlgoPlot.PlottingUtil.distance(c,i);this.scaleValues[1]=y/a}}else if(2==t){var g=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,this.controlPoints[1],n).projectPoint,f=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(g,i,this.controlPoints[1]),d=f.projectPoint,m=SuperMapAlgoPlot.PlottingUtil.distance(d,i);!0===f.inOnline?this.scaleValues[4]=-m/a:this.scaleValues[4]=m/a}}this.calculateParts()}}])&&Es(i.prototype,o),n&&Es(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Bs(t){"@babel/helpers - typeof";return(Bs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ks(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Fs(o.key),o)}}function Fs(t){var e=function(t,e){if("object"!=Bs(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Bs(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Bs(e)?e:e+""}function js(t,e,i){return e=Vs(e),function(t,e){if(e&&("object"===Bs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Vs(t).constructor):e.apply(t,i))}function Vs(t){return(Vs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function zs(t,e){return(zs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1001=Ns;var Ys=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=js(this,e,[t])).MIN_GEOPT_COUNT=2,i.MAX_GEOPT_COUNT=1024,i.SV1_defaultATLenDivABLen=0,i.SV2_defaultAYPosScale=.65,i.SV_AJCtrl=.6,i.SV_ArrowWoCtrl=.6,i.SV2_DefaultAJWidDiviedByATLen=.148,i.SV3_DefaultAEWidDividedByATLen=.4,i.SV4_DefaultAELenDividedByATLen=.3,i.SV_ATScaleParameter=1.25,i.SV_ATLenDividedByATWid=1.35,i.SV_ATWidDividedByArrowWeiWid=.5,i.AB_VERTEX_COUNT=4,i.MIN_PTCOUNT_PERARROW=3,i.ATL_DIV_AWW=.7,i.ATL_DIV_ABL=.12,i.ATL_DIV_ABL_1=.18,i.DEFAULT_ARROW_TAIL_POS=.12,i.DUOJIANTOU_TAIL_RATE_1=8,i.DUOJIANTOU_TAIL_RATE_2=3,i.DUOJIANTOU_TAIL_RATE_3=.6,i.AB_CTRLPT_RATE1=0,i.AB_CTRLPT_RATE2=3,i.AB_CTRLPT_RATE3=.5,i.MIN_SCALEVALUE=.1,i.MAX_SCALEVALUE=1,i.m_scalePoints=null,i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1002",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zs(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init(),this.applyUse()}},{key:"applyUse",value:function(){this.m_scalePoints=[];var t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(this.controlPoints);if((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length>=2&&t.length<this.minEditPts&&this.calAssistantLine(),!(t.length<this.minEditPts)){var e=this.operateCtrlPts(t),i=e.length,o=Math.floor(i/this.MIN_PTCOUNT_PERARROW),n=this.scaleValues.length;if(n<2*o-1){0==n&&(this.scaleValues.push(this.SV1_defaultATLenDivABLen),n++);for(var l=2*o-1-n,s=0;s<l;s+=2)this.scaleValues.splice(n/2+1,0,this.SV1_defaultATLenDivABLen),this.scaleValues.splice(this.scaleValues.length,0,this.SV2_defaultAYPosScale)}else if(n>2*o-1){for(var a=0;a<o;a++)this.scaleValues.push(this.SV1_defaultATLenDivABLen);for(var r=0;r<o-1;r++)this.scaleValues.push(this.SV2_defaultAYPosScale)}var u=this.arrowMeshs(e);SuperMapAlgoPlot.PlottingUtil.clearSamePts(u.shapePts);var p=!1;if(void 0!==t[0].z&&(p=!0),p){var h=this.operateCtrlPts3D(t),c=u.arrLeftPts2D,y=u.arrRightPts2D,g=u.arrHeadPts2D;if(o!=c.length&&o!=y.length&&o!=g.length)return!1;for(var f=[],d=0;d<o;d++){for(var m=[],S=3*d;S<3*(d+1)&&S<h.length;S++)m.push(h[S]);f.push(m)}for(var P=[],b=[],v=[],L=0;L<o;L++)if(!(2>f[L].length)){for(var M=c[L][c[L].length-1],_=y[L][0],A=new SuperMapAlgoPlot.Point(.5*(M.x+_.x),.5*(M.y+_.y)),T=f[L][f[L].length-1],x=f[L][f[L].length-2],O=this.ComputeZValue(A,T,x),w={x:A.x,y:A.y,z:O},C=[],E=[],I=0;I<f[L].length-1;I++)if(0==L)E.push(f[L][I]);else{var D={x:f[L][I].x,y:f[L][I].y,z:.5*(f[L][I].z+f[L-1][I].z)};E.push(D)}E.push(w),this.ComputeBeizerZValueByDis(E,c[L],C),P.push(C),C=[];var U=[];U.push(w);for(var R=f[L].length-2;R>=0;R--)if(L==o-1)U.push(f[L][R]);else{var N={x:f[L][R].x,y:f[L][R].y,z:.5*(f[L][R].z+f[L+1][R].z)};U.push(N)}this.ComputeBeizerZValueByDis(U,y[L],C),b.push(C),C=[];for(var B=g[L],k=0;k<B.length;k++){var F=this.ComputeZValue(B[k],T,x);C.push({x:B[k].x,y:B[k].y,z:F})}v.push(C)}for(var j=[],V=0;V<o;V++)j=(j=(j=j.concat(P[V])).concat(v[V])).concat(b[V]);return SuperMapAlgoPlot.PlottingUtil.clearSamePts(j),u.shapePts.length>0&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,j,{surroundLineFlag:!1}),this.scalePoints=this.scalePoints.concat(this.m_scalePoints),!0}if(u.shapePts.length>0){c=u.arrLeftPts2D,y=u.arrRightPts2D,g=u.arrHeadPts2D;for(var z=[],Y=[],G=0;G<c.length;G++){for(var W=this.mergeDashLine(this.dashLines,[]),X=this.computeDashLine(W,c[G]),H=0;H<X.length-1;H++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,X[H]);z.push(X[X.length-1])}for(var Z=0;Z<y.length;Z++){for(var J=this.mergeDashLine(this.dashLines,[]),q=this.computeDashLine(J,y[Z].reverse()),K=0;K<q.length-1;K++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,q[K].reverse());Y.push(q[q.length-1].reverse())}for(var Q=0;Q<g.length;Q++){var $=[];$=($=($=$.concat(z[Q])).concat(g[Q])).concat(Y[Q]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,$)}}this.scalePoints=[];for(var tt=0;tt<this.m_scalePoints.length;tt++)this.m_scalePoints[tt].isScalePoint=!0,this.m_scalePoints[tt].tag=tt,this.addScalePoint(this.m_scalePoints[tt])}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=this.operateCtrlPts(this.controlPoints),o=i.length,n=Math.floor(o/this.MIN_PTCOUNT_PERARROW),l=0;if(t<n){var s=[],a=t*this.MIN_PTCOUNT_PERARROW;s[0]=i[a],s[1]=i[a+1],s[2]=i[a+2];var r=SuperMapAlgoPlot.PlottingUtil.polylineDistance(s),u=new SuperMapAlgoPlot.Point(0,0),p=new SuperMapAlgoPlot.Point(0,0),h=new SuperMapAlgoPlot.Point(0,0);SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(this.AB_CTRLPT_RATE1,this.AB_CTRLPT_RATE2,s[0],s[1],s[2],u,p),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(this.AB_CTRLPT_RATE3,s[2],s[1],p,h),l=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(s[2],h,e).dLen1/(this.SV4_DefaultAELenDividedByATLen+1)/r}else{var c=[],y=[],g=(t-n)*this.MIN_PTCOUNT_PERARROW;c[0]=i[g],c[1]=i[g+1],c[2]=i[g+2];var f=(t-n+1)*this.MIN_PTCOUNT_PERARROW;y[0]=i[f],y[1]=i[f+1],y[2]=i[f+2];var d=new SuperMapAlgoPlot.Point(0,0),m=new SuperMapAlgoPlot.Point(0,0),S=new SuperMapAlgoPlot.Point(0,0);d.x=.5*(c[2].x+y[2].x),m.x=.5*(c[1].x+y[1].x),S.x=.5*(c[0].x+y[0].x),d.y=.5*(c[2].y+y[2].y),m.y=.5*(c[1].y+y[1].y),S.y=.5*(c[0].y+y[0].y);var P=SuperMapAlgoPlot.PlottingUtil.distance(d,m),b=SuperMapAlgoPlot.PlottingUtil.distance(S,m),v=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(d,m,e),L=v.dLen1;l=L<P?L/(P+b):((L=(v=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(m,S,e)).dLen1)+P)/(P+b)}l>this.MAX_SCALEVALUE?l=this.MAX_SCALEVALUE:l<this.MIN_SCALEVALUE&&(l=this.MIN_SCALEVALUE),this.scaleValues[t]=l}this.calculateParts()}},{key:"arrowMeshs",value:function(t){var e=[],i=[],o=[];t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts;var n=new SuperMapAlgoPlot.Path2D,l=t.length,s=Math.floor(l/this.MIN_PTCOUNT_PERARROW),a=this.generateAWWidth(s,t),r=[],u=[],p=0,h=0,c=0,y=[];for(h=0,c=0;h<s;h++,c+=this.MIN_PTCOUNT_PERARROW){y[0]=t[c],y[1]=t[c+1],y[2]=t[c+2],p=this.scaleValues[h];var g=this.generateArrowBodyPts(y,a[h],p);p=g.dATLenDivABLen,r[h]=g.arrowBodyPts,u.push(p)}var f=[],d=0,m=0,S=0,P=[],b=[];for(h=0;h<s-1;h++,m+=this.MIN_PTCOUNT_PERARROW){S=m+this.MIN_PTCOUNT_PERARROW,P[0]=t[m],P[1]=t[m+1],P[2]=t[m+2],b[0]=t[S],b[1]=t[S+1],b[2]=t[S+2],d=this.scaleValues[s+h];var v=this.generateAYPts(P,r[h],b,r[h+1],d);f.push(v.arrowLeftYaoPts),f.push(v.arrowRightYaoPts)}var L=[],M=r[0],_=[],A=0,T=[];n.MoveTo(M[0]),n.CurveTo(M[1],M[2],M[3]),n.CurveTo(M[4],M[5],M[6]),n.ToSubPathPolygons(_),e.push(_[0]),A=_[0].length;for(var x=7;x<10;x++)n.LineTo(M[x]);for(_=[],n.ToSubPathPolygons(_);A<_[0].length;A++)T.push(_[0][A]);for(o.push(T),L.push(M[0]),L.push(t[0]),h=1,c=this.MIN_PTCOUNT_PERARROW;h<s;h++,c+=this.MIN_PTCOUNT_PERARROW){var O=r[h],w=h+h-2,C=f[w];for(n.LineTo(C[0]),n.CurveTo(C[1],C[2],C[3]),_=[],T=[],n.ToSubPathPolygons(_);A<_[0].length;A++)T.push(_[0][A]);i.push(T);var E=f[w+1];for(n.CurveTo(E[1],E[2],E[3]),_=[],T=[],n.ToSubPathPolygons(_);A<_[0].length;A++)T.push(_[0][A]);e.push(T);for(var I=7;I<10;I++)n.LineTo(O[I]);for(_=[],T=[],n.ToSubPathPolygons(_);A<_[0].length;A++)T.push(_[0][A]);o.push(T),L.push(t[c].clone())}var D=r[s-1];for(n.LineTo(D[10]),n.CurveTo(D[11],D[12],D[13]),n.CurveTo(D[14],D[15],D[16]),_=[],T=[],n.ToSubPathPolygons(_);A<_[0].length;A++)T.push(_[0][A]);i.push(T),L.push(D[16]);var U=[];return n.ToSubPathPolygons(U),{shapePts:U[0],arrLeftPts2D:e,arrRightPts2D:i,arrHeadPts2D:o}}},{key:"operateCtrlPts",value:function(t){t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts;var e=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),i=e.length,o=Math.floor(i/this.MIN_PTCOUNT_PERARROW),n=i%this.MIN_PTCOUNT_PERARROW,l=new SuperMapAlgoPlot.Point;if(2==n&&(l.x=.5*(e[i-2].x+e[i-1].x),l.y=.5*(e[i-2].y+e[i-1].y),l.x==e[i-1].x&&l.y==e[i-1].y||(e.push(e[i-1].clone()),e[i-1]=l,i++,o++)),i>3)for(var s=o-1,a=0,r=s;a<s;r--,a++)for(var u=r*this.MIN_PTCOUNT_PERARROW,p=0;p<u;p+=this.MIN_PTCOUNT_PERARROW){if(!SuperMapAlgoPlot.PlottingUtil.isRight(e[p+3],e[p+1],e[p+2])){var h=e[p];e[p]=e[p+3],e[p+3]=h,h=e[p+1],e[p+1]=e[p+4],e[p+4]=h,h=e[p+2],e[p+2]=e[p+5],e[p+5]=h}}return e=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(t,e)}},{key:"operateCtrlPts3D",value:function(t){var e=t,i=e.length,o=Math.floor(i/this.MIN_PTCOUNT_PERARROW),n={x:0,y:0,z:0};if(2==i%3&&(n.x=.5*(e[i-2].x+e[i-1].x),n.y=.5*(e[i-2].y+e[i-1].y),n.z=.5*(e[i-2].z+e[i-1].z),n.x==e[i-1].x&&n.y==e[i-1].y&&n.z==e[i-1].z||(e.push(e[i-1]),e[i-1]=n,i++,o++)),i>3)for(var l=o-1,s=0,a=l;s<l;a--,s++)for(var r=3*a,u=0;u<r;u+=3){if(!SuperMapAlgoPlot.PlottingUtil.isRight(e[u+3],e[u+1],e[u+2])){var p=e[u];e[u]=e[u+3],e[u+3]=p,p=e[u+1],e[u+1]=e[u+4],e[u+4]=p,p=e[u+2],e[u+2]=e[u+5],e[u+5]=p}}return e}},{key:"generateAWWidth",value:function(t,e){var i=[];if(t>0)if(1==t)i.push(0);else{var o=SuperMapAlgoPlot.PlottingUtil.distance(e[0],e[this.MIN_PTCOUNT_PERARROW]);i.push(o);for(var n=1,l=this.MIN_PTCOUNT_PERARROW;n<t-1;n++,l+=this.MIN_PTCOUNT_PERARROW){o=.5*(SuperMapAlgoPlot.PlottingUtil.distance(e[l-this.MIN_PTCOUNT_PERARROW],e[l])+SuperMapAlgoPlot.PlottingUtil.distance(e[l],e[l+this.MIN_PTCOUNT_PERARROW])),i.push(o)}o=SuperMapAlgoPlot.PlottingUtil.distance(e[l-this.MIN_PTCOUNT_PERARROW],e[l]),i.push(o)}return i}},{key:"generateArrowBodyPts",value:function(t,e,i){var o=[],n=[],l=[],s=[],a=[],r=[],u=[],p=t.length-1;if(p<2)return{dATLenDivABLen:i=0,arrowBodyPts:o};var h=i,c=this.SV2_DefaultAJWidDiviedByATLen,y=this.SV3_DefaultAEWidDividedByATLen,g=this.SV4_DefaultAELenDividedByATLen,f=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),d=SuperMapAlgoPlot.PlottingUtil.polylineDistance(f),m=0==e?d*this.ATL_DIV_ABL_1:(d+e)*this.ATL_DIV_ABL,S=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(m,f[1],f[0]);n[1]=S.pntLeft.clone(),l[1]=S.pntRight.clone();var P=0;P=SuperMapAlgoPlot.PlottingUtil.equalFuzzy(h,0,1e-14)?m*this.ATL_DIV_AWW:d*h;var b=SuperMapAlgoPlot.PlottingUtil.distance(f[1],f[2]);P+P>b&&(P=.5*b);var v=P*c;f.push(f[p].clone());var L,M=0;L=d-P;var _=[],A=0;for(A=2;A<=p;A++)M+=SuperMapAlgoPlot.PlottingUtil.distance(f[A-1],f[A-2]),SuperMapAlgoPlot.PlottingUtil.equalFuzzy(L,0,1e-14)?_[A]=0:SuperMapAlgoPlot.PlottingUtil.equalFuzzy(L-M,0,1e-14)?_[A]=v:_[A]=v+(m-v)*Math.pow((L-M)/L,this.SV_ATScaleParameter);_[p+1]=v;var T=new SuperMapAlgoPlot.Point(0,0),x=new SuperMapAlgoPlot.Point(0,0),O=new SuperMapAlgoPlot.Point(0,0);for(A=2;A<=p;A++){SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(this.AB_CTRLPT_RATE1,this.AB_CTRLPT_RATE2,f[A-2],f[A-1],f[A],x,O),p==A&&SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(this.AB_CTRLPT_RATE3,f[p],f[p-1],O,T);var w=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(_[A],x,f[A-1]);l[A]=w.pntLeft,n[A]=w.pntRight}var C,E,I=T.clone();if(SuperMapAlgoPlot.PlottingUtil.distance(f[p],I)>0){var D=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(P,f[p],T);f[p]=D.clone()}for(S=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(v,f[p+1],f[p]),n[p+1]=S.pntLeft,l[p+1]=S.pntRight,A=2;A<=p;A++)SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(this.AB_CTRLPT_RATE2,this.AB_CTRLPT_RATE2,n[A-1],n[A],n[A+1],x,O),s[A]=x.clone(),a[A]=O.clone(),SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(this.AB_CTRLPT_RATE2,this.AB_CTRLPT_RATE2,l[A-1],l[A],l[A+1],x,O),r[A]=x.clone(),u[A]=O.clone();SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(this.AB_CTRLPT_RATE3,n[1],n[2],s[2],T),a[1]=T.clone(),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(this.AB_CTRLPT_RATE3,l[1],l[2],r[2],T),u[1]=T.clone();E=SuperMapAlgoPlot.PlottingUtil.distance(n[p+1],n[p])*(1/3),(C=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(E,f[p],f[p+1])).x+=n[p+1].x-f[p].x,C.y+=n[p+1].y-f[p].y,E=(m-v)*Math.pow(E/L,this.SV_ATScaleParameter+.3),S=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(E,n[p+1],C),s[p+1]=S.pntLeft.clone(),E=SuperMapAlgoPlot.PlottingUtil.distance(l[p+1],l[p])*(1/3),(C=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(E,f[p],f[p+1])).x+=l[p+1].x-f[p].x,C.y+=l[p+1].y-f[p].y,E=(m-v)*Math.pow(E/L,this.SV_ATScaleParameter+.3),S=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(E,l[p+1],C),r[p+1]=S.pntRight.clone();var U=[],R=P*g,N=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(R,f[p],f[p+1]);this.m_scalePoints.push(N.clone()),R=P*y,S=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(R,f[p+1],N),U.push(S.pntRight),U.push(f[p+1]),U.push(S.pntLeft);var B=[];for(B.push(n[p+1]),A=p;A>=1;A--)B.push(s[A+1]),B.push(a[A]),B.push(n[A]);var k=[];for(A=1;A<=p;A++)k.push(l[A]),k.push(u[A]),k.push(r[A+1]);k.push(l[p+1]),o.push.apply(o,k),o.push.apply(o,U),o.push.apply(o,B),i=P/d;var F=[];for(A=B.length-1;A>=0;A--)F.push(B[A]);return{dATLenDivABLen:i,arrowBodyPts:o}}},{key:"generateAYPts",value:function(t,e,i,o,n){var l=new SuperMapAlgoPlot.Point(.5*(t[2].x+i[2].x),.5*(t[2].y+i[2].y)),s=new SuperMapAlgoPlot.Point(.5*(t[1].x+i[1].x),.5*(t[1].y+i[1].y)),a=new SuperMapAlgoPlot.Point(.5*(t[0].x+i[0].x),.5*(t[0].y+i[0].y)),r=SuperMapAlgoPlot.PlottingUtil.distance(l,s),u=SuperMapAlgoPlot.PlottingUtil.distance(a,s),p=n*(r+u),h=new SuperMapAlgoPlot.Point(0,0),c=new SuperMapAlgoPlot.Point(0,0),y=new SuperMapAlgoPlot.Point(0,0);if(p>r){p=r+u-p,h=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(p,a,s);var g=SuperMapAlgoPlot.PlottingUtil.distance(t[1],t[0]),f=SuperMapAlgoPlot.PlottingUtil.distance(i[1],i[0]);g=g*p/u,c=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(g,t[0],t[1]),f=f*p/u,y=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(f,i[0],i[1])}else{h=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(p,l,s);var d=SuperMapAlgoPlot.PlottingUtil.distance(t[1],t[2]),m=SuperMapAlgoPlot.PlottingUtil.distance(i[1],i[2]);d=d*p/r,c=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(d,t[2],t[1]),m=m*p/r,y=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(m,i[2],i[1])}this.m_scalePoints.push(h.clone());var S=this.SV_ArrowWoCtrl*SuperMapAlgoPlot.PlottingUtil.distance(h,c),P=this.SV_ArrowWoCtrl*SuperMapAlgoPlot.PlottingUtil.distance(h,y),b=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(S,h,c),v=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(P,h,y),L=e[11].clone(),M=e[10].clone(),_=o[5].clone(),A=o[6].clone(),T=SuperMapAlgoPlot.PlottingUtil.intersectLines(M,L,h,c),x=SuperMapAlgoPlot.PlottingUtil.distance(T.intersectPoint,M),O=SuperMapAlgoPlot.PlottingUtil.distance(M,h);x=x>O?this.SV_AJCtrl*O:this.SV_AJCtrl*x;var w=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(x,M,L);L=w.clone(),e[11]=w.clone(),T=SuperMapAlgoPlot.PlottingUtil.intersectLines(A,_,h,y),x=(x=SuperMapAlgoPlot.PlottingUtil.distance(T.intersectPoint,A))>(O=SuperMapAlgoPlot.PlottingUtil.distance(A,h))?this.SV_AJCtrl*O:this.SV_AJCtrl*x,_=(w=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(x,A,_)).clone(),o[5]=w.clone();var C=[];C.push(M),C.push(L),C.push(b),C.push(h);var E=[];return E.push(h),E.push(v),E.push(_),E.push(A),{arrowLeftYaoPts:C,arrowRightYaoPts:E}}}])&&ks(i.prototype,o),n&&ks(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Gs(t){"@babel/helpers - typeof";return(Gs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ws(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Xs(o.key),o)}}function Xs(t){var e=function(t,e){if("object"!=Gs(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Gs(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Gs(e)?e:e+""}function Hs(t,e,i){return e=Zs(e),function(t,e){if(e&&("object"===Gs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Zs(t).constructor):e.apply(t,i))}function Zs(t){return(Zs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Js(t,e){return(Js=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1002=Ys;var qs=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Hs(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.3),i.scaleValues.push(.28),i.scaleValues.push(.433333),i.scaleValues.push(.53),i.scaleValues.push(0)),i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1003",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Js(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints),e=(t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length;if(e>=this.minEditPts){if(SuperMapAlgoPlot.PlottingUtil.equalFuzzy(this.controlPoints[0].x,this.controlPoints[1].x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(this.controlPoints[0].y,this.controlPoints[1].y))return;var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),o=!1;void 0!==i[0].z&&(o=!0);var n=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePts(t,this.scaleValues,SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_TRAPEZOID),l=n.arrowTouLen,s=n.leftBodyPts,a=n.rightBodyPts,r=[];r.push(s[s.length-1]),r.push(a[a.length-1]);var u=[];u.push(this.scaleValues[3]),u.push(this.scaleValues[4]),u.push(0),u.push(0);var p=SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePts(t,r,u,l,SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_WITHOUT_EAR),h=[];h=(h=h.concat(s)).concat(p);for(var c=a.length-1;c>=0;c--)h.push(a[c]);if(h.push(s[0]),o){for(var y=[],g={x:i[1].x,y:i[1].y,z:i[1].z},f={x:i[0].x,y:i[0].y,z:i[0].z},d=0;d<h.length;d++){var m=this.ComputeZValue(h[d],g,f);y.push({x:h[d].x,y:h[d].y,z:m})}var S=new SuperMapAlgoPlot.Point((r[0].x+r[1].x)/2,(r[0].y+r[1].y)/2),P=new SuperMapAlgoPlot.Point(S.x,S.y);P.isScalePoint=!0,P.tag=0,this.addScalePoint(P);var b=new SuperMapAlgoPlot.Point(s[s.length-1].x,s[s.length-1].y);b.isScalePoint=!0,b.tag=1,this.addScalePoint(b);var v=new SuperMapAlgoPlot.Point(p[0].x,p[0].y);v.isScalePoint=!0,v.tag=2,this.addScalePoint(v);for(var L={x:i[e-1].x,y:i[e-1].y,z:i[e-1].z},M={x:i[e-2].x,y:i[e-2].y,z:i[e-2].z},_=[],A=0;A<this.scalePoints.length;A++){var T={x:this.scalePoints[A].x,y:this.scalePoints[A].y},x=this.ComputeZValue(T,L,M);_.push({x:T.x,y:T.y,z:x})}this.scalePoints=_,this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,y)}else{var O=new SuperMapAlgoPlot.Point((r[0].x+r[1].x)/2,(r[0].y+r[1].y)/2),w=new SuperMapAlgoPlot.Point(O.x,O.y);w.isScalePoint=!0,w.tag=0,this.addScalePoint(w);var C=new SuperMapAlgoPlot.Point(s[s.length-1].x,s[s.length-1].y);C.isScalePoint=!0,C.tag=1,this.addScalePoint(C);var E=new SuperMapAlgoPlot.Point(p[0].x,p[0].y);if(E.isScalePoint=!0,E.tag=2,this.addScalePoint(E),0==this.dashLines.length)this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,h);else{for(var I=this.mergeDashLine(this.dashLines,[]),D=this.computeDashLine(I,s),U=1;U<D.length-1;U++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,D[U]);for(var R=this.mergeDashLine(this.dashLines,[]),N=this.computeDashLine(R,a),B=1;B<N.length-1;B++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,N[B].reverse());var k=[];k=(k=(k=k.concat(D[D.length-1])).concat(p)).concat(N[N.length-1].reverse()),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,k);var F=[];F=(F=F.concat(N[0].reverse())).concat(D[0]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,F)}}}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=new SuperMapAlgoPlot.Point(this.scalePoints[0].x,this.scalePoints[0].y),o=new SuperMapAlgoPlot.Point(this.scalePoints[1].x,this.scalePoints[1].y),n=new SuperMapAlgoPlot.Point(this.scalePoints[2].x,this.scalePoints[2].y),l=this.scaleValues[0];this.controlPoints=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(this.controlPoints).pts;var s=SuperMapAlgoPlot.PlottingUtil.polylineDistance(this.controlPoints),a=s*l;if(0==t){var r=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,this.controlPoints[0],this.controlPoints[1]),u=r.projectPoint;if(r.isOnline){var p=SuperMapAlgoPlot.PlottingUtil.distance(u,this.controlPoints[1]);this.scaleValues[0]=p/s}}else if(1==t){var h=SuperMapAlgoPlot.PlottingUtil.intersectLines(i,o,n,this.controlPoints[1]);if(null!=h.intersectPoint){var c=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,o,h.intersectPoint).projectPoint,y=SuperMapAlgoPlot.PlottingUtil.distance(c,i),g=a*this.scaleValues[1];this.scaleValues[1]=y/a,this.scaleValues[2]=(a*this.scaleValues[2]+y-g)/a}}else if(2==t){var f=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,this.controlPoints[1],n).projectPoint,d=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(f,i,this.controlPoints[1]),m=d.projectPoint,S=SuperMapAlgoPlot.PlottingUtil.distance(m,i);!0===d.inOnline?this.scaleValues[4]=-S/a:this.scaleValues[4]=S/a}}this.calculateParts()}}])&&Ws(i.prototype,o),n&&Ws(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Ks(t){"@babel/helpers - typeof";return(Ks="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qs(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,$s(o.key),o)}}function $s(t){var e=function(t,e){if("object"!=Ks(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ks(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ks(e)?e:e+""}function ta(t,e,i){return e=ea(e),function(t,e){if(e&&("object"===Ks(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],ea(t).constructor):e.apply(t,i))}function ea(t){return(ea=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ia(t,e){return(ia=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1003=qs;var oa=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=ta(this,e,[t])).MAX_ARRAY_SIZE=128,i.sv1_DefaultAtLenDivAbLen=.2,i.sv2_DefaultAjWidthDivAtLen=.148,i.sv3_DefaultAeWidthDivAtLen=.4,i.sv4_DefaultAeLenDivAtLen=.312,i.sv_AtScaleParameter=1.5,i.sv_AtLenDivAtWidth=1.35,i.sv_AtWidthDivAwWidth=.5,i.sv_defaultAwLenDivAbLen=.15,0===i.scaleValues.length&&(i.scaleValues.push(i.sv1_DefaultAtLenDivAbLen),i.scaleValues.push(i.sv2_DefaultAjWidthDivAtLen),i.scaleValues.push(i.sv3_DefaultAeWidthDivAtLen),i.scaleValues.push(i.sv4_DefaultAeLenDivAtLen)),i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1004",i._isUseDashLine=!0,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ia(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init(),this.applyUse()}},{key:"applyUse",value:function(){var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length>=2&&t.length<this.minEditPts&&this.calAssistantLine(),!(t.length<this.minEditPts)){var e=this.arrowMeshs(t);SuperMapAlgoPlot.PlottingUtil.clearSamePts(e.shapePts);var i=e.shapePts,o=e.leftBodyPts,n=e.rightBodyPts,l=e.arrowHeadPts,s=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),a=s.length,r=!1;if(void 0!==s[0].z&&(r=!0),r){o=e.leftBodyPts,n=e.rightBodyPts,l=e.arrowHeadPts,i=e.shapePts;for(var u=[],p=0;p<i.length;p++)u.push({x:i[p].x,y:i[p].y,z:0});if(0==i.length)return!1;var h=this.updateScalePoints(t),c=[],y={x:(s[0].x+s[1].x)/2,y:(s[0].y+s[1].y)/2},g={x:(o[o.length-1].x+n[0].x)/2,y:(o[o.length-1].y+n[0].y)/2},f=this.ComputeZValue(g,s[a-1],s[a-2]),d=0,m=0;o[0].x==s[0].x&&o[0].y==s[0].y?(d=s[0].z,m=s[1].z):(d=s[1].z,m=s[0].z),c.push({x:y.x,y:y.y,z:d});for(var S=2;S<a-1;S++)c.push(s[S]);c.push({x:g.x,y:g.y,z:f});var P=[];this.ComputeBeizerZValueByDis(c,o,P),(c=[]).push({x:g.x,y:g.y,z:f});for(var b=a-2;b>=2;b--)c.push(s[b]);c.push({x:y.x,y:y.y,z:m});var v=[];this.ComputeBeizerZValueByDis(c,n,v);for(var L=[],M=0;M<l.length;M++){var _=this.ComputeZValue(l[M],s[a-1],s[a-2]);L.push({x:l[M].x,y:l[M].y,z:_})}if(P.length>0&&v.length>0&&L.length>0){u=(u=(u=(u=[]).concat(P)).concat(L)).concat(v),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,u,{surroundLineFlag:!1});for(var A=[],T=0;T<h.length;T++){var x=this.ComputeZValue(h[T],s[a-1],s[a-2]),O=new SuperMapAlgoPlot.Point(h[T].x,h[T].y);O.z=x,A.push(O)}3!=h.length?this.scalePoints=[]:this.scalePoints=this.scalePoints.concat(A)}}else{if(0==e.shapePts.length)return;if(this._isUseDashLine){for(var w=this.mergeDashLine(this.dashLines,[]),C=this.computeDashLine(w,o),E=0;E<C.length-1;E++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,C[E]);for(var I=this.mergeDashLine(this.dashLines,[]),D=this.computeDashLine(I,n.reverse()),U=0;U<D.length-1;U++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,D[U].reverse());if(D.length>0){var R=[];R=(R=(R=R.concat(C[C.length-1])).concat(l)).concat(D[D.length-1].reverse()),R=SuperMapAlgoPlot.PlottingUtil.clearSamePts(R),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,R)}this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,e.shapePts,{surroundLineFlag:!1,lineWidthLimit:!0,strokeWidth:0,weight:0})}else this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,e.shapePts);if(h=this.updateScalePoints(t),this.scalePoints=[],3!=h.length)h=[];else for(var N=0;N<h.length;N++)h[N].isScalePoint=!0,h[N].tag=N,this.addScalePoint(h[N])}}}},{key:"computeScaleValues",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i),this.scaleValues.length<4&&(this.scaleValues.push(this.sv1_DefaultAtLenDivAbLen),this.scaleValues.push(this.sv2_DefaultAjWidthDivAtLen),this.scaleValues.push(this.sv3_DefaultAeWidthDivAtLen),this.scaleValues.push(this.sv4_DefaultAeLenDivAtLen));var o=i.length;if(o<=2)return;var n,l,s,a,r=this.operateCtrlPts(i);o=r.length,o--;var u=this.calcScaleValueCount(i.length);if(this.scaleValues.length<u){var p=this.calcDefaultScaleValues(o);n=p[0],l=p[1],s=p[2],a=p[3]}else n=this.scaleValues[0],l=this.scaleValues[1],s=this.scaleValues[2],a=this.scaleValues[3];for(var h=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i),c=[],y=0;y<this.scalePoints.length;y++)c.push(this.scalePoints[y].clone());if(0==c.length)return;c[t]=e.clone();var g,f,d=o-1;g=o<=3?new SuperMapAlgoPlot.Point((r[0].x+r[1].x)/2,(r[0].y+r[1].y)/2):r[d-1].clone();var m,S,P,b,v,L,M=new SuperMapAlgoPlot.Point(0,0),_=new SuperMapAlgoPlot.Point(0,0),A=new SuperMapAlgoPlot.Point(0,0);SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(0,3,g,r[d],r[d+1],_,A),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,r[o],r[o-1],A,M),f=M.clone();var T=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(r[o],f,c[2]);m=T.dLen1,T.dLen2,0==m&&(m=.1),S=m,n=(m/=a+1)/h,1==t?(b=(T=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(r[o],f,c[1])).dLen1,s=(v=T.dLen2)/m,a=(b-m)/m):0==t?(m=(T=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(r[o],f,c[0])).dLen1,l=(P=T.dLen2)/m,(L=SuperMapAlgoPlot.PlottingUtil.distance(r[o],r[o-1]))<2*m&&(m=.5*L),b=(T=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(r[o],f,c[1])).dLen1,s=(v=T.dLen2)/m,(a=(S-m)/m)<.1&&(s=v/(m=S/(1+(a=.1))),l=P/m),n=m/h):2==t&&(n=m/h),P=m*l,(L=SuperMapAlgoPlot.PlottingUtil.distance(r[o],r[o-1]))<2*m&&(P=(m=.5*L)*l,n=m/h),this.scaleValues[0]=n,this.scaleValues[1]=l,this.scaleValues[2]=s,this.scaleValues[3]=a}}},{key:"arrowMeshs",value:function(t){var e=[],i=[],o=[],n=[],l=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),s=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePts(l,this.scaleValues,SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_MULTIPOLYBEZIER),a=s.arrowTouLen,r=s.leftBodyPts,u=s.rightBodyPts;if(!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(a,0)){var p=[];p.push(r[r.length-1]),p.push(u[u.length-1]);var h=[];h.push(this.scaleValues[2]),h.push(this.scaleValues[3]),h.push(0),h.push(0);for(var c=SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePts(l,p,h,a,SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_WITH_EAR),y=0;y<r.length;y++)e.push(r[y]),i.push(r[y]);for(var g=0;g<c.length;g++)e.push(c[g]),n.push(c[g]);for(var f=u.length-1;f>=0;f--)e.push(u[f]),o.push(u[f])}return{shapePts:e,leftBodyPts:i,rightBodyPts:o,arrowHeadPts:n}}},{key:"updateScalePoints",value:function(t){var e=t.length,i=[];if(!(e<3)){var o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t);if(!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(o,0)){var n=this.operateCtrlPts(t);e=n.length,e--;for(var l=[],s=0;s<this.scaleValues.length;s++)l.push(this.scaleValues[s]);var a=this.genArrowBodyPts(o,n,l),r=a.ArrowBodyCenterPts,u=this.genAtPts(e,r,l,a.ArrowTouLen),p=this.calc3rdScalePt(e,r,l,a.ArrowTouLen);return i.push(new SuperMapAlgoPlot.Point(a.LeftBodyPtsTemp[e].x,a.LeftBodyPtsTemp[e].y)),i.push(new SuperMapAlgoPlot.Point(u[2].x,u[2].y)),i.push(new SuperMapAlgoPlot.Point(p.x,p.y)),i}}}},{key:"operateCtrlPts",value:function(t){var e=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts,i=SuperMapAlgoPlot.PlottingUtil.clonePoints(e);if(3===i.length){var o=((i[0].x+i[1].x)/2+i[2].x)/2,n=((i[0].y+i[1].y)/2+i[2].y)/2,l=new SuperMapAlgoPlot.Point(o,n),s=i[2];i[2]=l,i.push(s)}return i}},{key:"genArrowBodyPts",value:function(t,e,i){var o,n,l,s=[],a=[],r=[],u=[],p=[],h=[],c=e.length;if(c--,i.length<this.calcScaleValueCount(c)){var y=this.calcDefaultScaleValues(c);n=y[0],l=y[1]}else n=i[0],l=i[1];var g=SuperMapAlgoPlot.PlottingUtil.clonePoints(e),f=(g[0].x+g[1].x)/2,d=(g[0].y+g[1].y)/2,m=Math.abs(f-g[2].x),S=Math.abs(d-g[2].y),P=0;if(m>0&&S>0){var b=1/(f-g[2].x),v=-1/(d-g[2].y),L=1*g[2].y/(d-g[2].y)-1*g[2].x/(f-g[2].x);P=Math.abs(b*g[0].x+v*g[0].y+L)/Math.sqrt(b*b+v*v)}else S<=1e-4?P=Math.abs(d-g[1].y):m<=1e-4&&(P=Math.abs(f-g[1].x));var M=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(P,g[2],new SuperMapAlgoPlot.Point(f,d)),_=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(g[1],g[2],g[0]);_?(s[1]=g[1],a[1]=g[0]):(s[1]=g[0],a[1]=g[1]),g[1]=new SuperMapAlgoPlot.Point((g[0].x+g[1].x)/2,(g[0].y+g[1].y)/2);var A=Math.sqrt((M.pntLeft.x-M.pntRight.x)*(M.pntLeft.x-M.pntRight.x)+(M.pntLeft.y-M.pntRight.y)*(M.pntLeft.y-M.pntRight.y))*this.sv_AtWidthDivAwWidth,T=(o=A*this.sv_AtLenDivAtWidth)*l;SuperMapAlgoPlot.PlottingUtil.equalFuzzy(n,0)||(T=(o=t*n)*l);var x,O,w=SuperMapAlgoPlot.PlottingUtil.distance(g[c],g[c-1]),C=2*o;w<C&&(T=(o=w/2)*l),g.push(g[c].clone()),x=0,O=0;var E=0,I=[];for(E=2;E<=c;E++)x+=SuperMapAlgoPlot.PlottingUtil.distance(g[E],g[E-1]);for(x-=o,E=2;E<=c-1;E++)O+=SuperMapAlgoPlot.PlottingUtil.distance(g[E],g[E-1]),I[E]=T+(A-T)*Math.pow((x-O)/x,this.sv_AtScaleParameter);I[c]=T;var D,U,R=new SuperMapAlgoPlot.Point(0,0),N=new SuperMapAlgoPlot.Point(0,0),B=new SuperMapAlgoPlot.Point(0,0);for(E=2;E<=c-1;E++)SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(0,3,g[E-1],g[E],g[E+1],N,B),E==c-1&&SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,g[c],g[c-1],B,R),D=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(I[E],N,g[E]),(_=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(B,N,D.pntRight))?(s[E]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y),a[E]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y)):(s[E]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y),a[E]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y));for(Math.sqrt(1*(g[c].x-R.x)*(g[c].x-R.x)+1*(g[c].y-R.y)*(g[c].y-R.y))>0&&(g[c]=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(o,g[c],R)),D=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(T,g[c+1],g[c]),(_=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(g[c],g[c+1],D.pntLeft))?(a[c]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y),s[c]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y)):(a[c]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y),s[c]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y)),E=2;E<c;E++)SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(3,3,s[E-1],s[E],s[E+1],N,B),r[E]=new SuperMapAlgoPlot.Point(N.x,N.y),u[E]=new SuperMapAlgoPlot.Point(B.x,B.y),SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(3,3,a[E-1],a[E],a[E+1],N,B),p[E]=new SuperMapAlgoPlot.Point(N.x,N.y),h[E]=new SuperMapAlgoPlot.Point(B.x,B.y),2==E&&(SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,s[1],s[2],r[2],R),u[E]=new SuperMapAlgoPlot.Point(R.x,R.y),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,a[1],a[2],p[2],R),h[E]=new SuperMapAlgoPlot.Point(R.x,R.y)),E==c-1&&(C=(w=SuperMapAlgoPlot.PlottingUtil.distance(s[c],s[c-1]))/3,(U=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(C,g[c],g[c+1])).x+=s[c].x-g[c].x,U.y+=s[c].y-g[c].y,C=(w=A-T)*Math.pow(C/x,this.sv_AtScaleParameter),D=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(C,s[c],U),r[c]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y),C=(w=SuperMapAlgoPlot.PlottingUtil.distance(a[c],a[c-1]))/3,(U=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(C,g[c],g[c+1])).x+=a[c].x-g[c].x,U.y+=a[c].y-g[c].y,C=(w=A-T)*Math.pow(C/x,this.sv_AtScaleParameter),D=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(C,a[c],U),p[c]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y));return{ArrowBodyCenterPts:SuperMapAlgoPlot.PlottingUtil.clonePoints(g),LeftBodyPtsTemp:s,RightBodyPtsTemp:a,LeftBodyPtsLeftCtrlPts:r,LeftBodyPtsRightCtrlPts:u,RightBodyPtsLeftCtrlPts:p,RightBodyPtsRightCtrlPts:h,ArrowTouLen:o}}},{key:"calcScaleValueCount",value:function(){return 4}},{key:"calcDefaultScaleValues",value:function(){var t=[];return t.push(this.sv1_DefaultAtLenDivAbLen),t.push(this.sv2_DefaultAjWidthDivAtLen),t.push(this.sv3_DefaultAeWidthDivAtLen),t.push(this.sv4_DefaultAeLenDivAtLen),t}},{key:"genAtPts",value:function(t,e,i,o){var n=i[2],l=[],s=o*i[3],a=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(s,e[t],e[t+1]);s=o*n;var r=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(s,e[t+1],a);return l.push(new SuperMapAlgoPlot.Point(r.pntLeft.x,r.pntLeft.y)),l.push(e[t+1]),l.push(new SuperMapAlgoPlot.Point(r.pntRight.x,r.pntRight.y)),l}},{key:"calc3rdScalePt",value:function(t,e,i,o){var n=o*i[3];return SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(n,e[t],e[t+1])}}])&&Qs(i.prototype,o),n&&Qs(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function na(t){"@babel/helpers - typeof";return(na="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function la(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,sa(o.key),o)}}function sa(t){var e=function(t,e){if("object"!=na(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=na(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==na(e)?e:e+""}function aa(t,e,i){return e=ra(e),function(t,e){if(e&&("object"===na(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],ra(t).constructor):e.apply(t,i))}function ra(t){return(ra=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ua(t,e){return(ua=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1004=oa;var pa=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=aa(this,e,[t])).scaleValues.length&&i.scaleValues.push(.1),i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1005",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ua(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){this.scaleValues[0]=this.getSubSymbolScaleValue();var e=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t)*this.scaleValues[0],i=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePtsBySingleLine(t,e,SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_POLYBEZIER,!1),o=[];if(t.length>2)for(var n=0;n<i.length;n++){if(i[n].x===t[t.length-2].x||i[n].y===t[t.length-2].y){o.push(i[n]),o.push(i[i.length-1]);break}o.push(i[n])}var l=i[i.length-1],s=i[i.length-2],a=(SuperMapAlgoPlot.PlottingUtil.distance(l,s),[]);a.push(i[i.length-1]),a.push(i[i.length-2]),a.push(t[t.length-2]);for(var r=this.mergeDashLine(this.dashLines,[]),u=this.computeDashLine(r,i),p=0;p<u.length;p++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,u[p]);var h=SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePtsBySingleLine(a,e,SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_POLYLINE);h.length>0&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,h,{surroundLineLimit:!0,lineTypeLimit:!0})}}}])&&la(i.prototype,o),n&&la(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function ha(t){"@babel/helpers - typeof";return(ha="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ca(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ya(o.key),o)}}function ya(t){var e=function(t,e){if("object"!=ha(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=ha(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ha(e)?e:e+""}function ga(t,e,i){return e=fa(e),function(t,e){if(e&&("object"===ha(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],fa(t).constructor):e.apply(t,i))}function fa(t){return(fa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function da(t,e){return(da=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1005=pa;var ma=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=ga(this,e,[t])).QIANJI_RATE1=9,i.QIANJI_RATE2=20,i.QIANJI_RATE4=5,i.QIANJI_RATE3=1/3,i.QIANJI_TAIL_RATE1=8,i.QIANJI_TAIL_RATE2=3,i.QIANJI_TAIL_RATE3=.6,i.SV1_Default=.25,i.SV1_MinValue=0,i.SV1_MaxValue=.5,i.DEFAULT_ARROW_TAIL_POS=.4,i.SCALE_VALUE_COUNT=1,i.MIN_LEN_LeftToRightCenter=1e-7,i.SCALE_AT=1/3,i.SCALE_ATAJ=1/8,i.SCALE_ATAE=1/3,i.SCALE_AW=2/3,i.SCALE_ATAJctrlDefSide=.8,i.SCALE_ATAJctrlSameSide=2/3,i.SCALE_MM_LEFT=.25,i.SCALE_MM_RIGHT=.75,i.BEZIER_K1=1/3,i.QIANJI_OPERATE_RATE1=1,i.SV2_Default=1,0===i.scaleValues.length&&(i.scaleValues=[],i.scaleValues.push(i.SV1_Default),i.scaleValues.push(i.SV2_Default),i.scaleValues.push(i.SV2_Default),i.scaleValues.push(i.SV2_Default),i.scaleValues.push(i.SV2_Default)),i.m_dMaxDis=0,i.m_bIsAnimation=!1,i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1006",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&da(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init(),this.m_scalePoints=[];var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length>=2&&t.length<this.minEditPts&&this.calAssistantLine(),!(t.length<this.minEditPts)){var e=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),i=e.length,o=!1;void 0!==e[0].z&&(o=!0);var n=this.arrowMeshs(t);if(o){for(var l=[],s=0;s<i;s++)l.push(e[s]);var a=n.LeftArowLeftBody,r=n.LeftArowHead,u=n.LeftArowRightBody,p=n.RightArowLeftBody,h=n.RightArowHead,c=n.RightArowRightBody;if(0==a.length)return!1;var y=[],g=[],f=[];if(3==l.length)a[0].x==l[0].x&&a[0].y==l[0].y?(g.push(l[0]),g.push(l[2]),f.push(l[1]),f.push(l[2])):(g.push(l[1]),g.push(l[2]),f.push(l[0]),f.push(l[2]));else{if(4!=l.length)return!1;a[0].x==l[0].x&&a[0].y==l[0].y?(g.push(l[0]),f.push(l[1])):(g.push(l[1]),f.push(l[0])),r[1].x==l[2].x&&r[1].y==l[2].y?(g.push(l[2]),f.push(l[3])):(g.push(l[3]),f.push(l[2]))}var d=new SuperMapAlgoPlot.Point;d=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(a[a.length-1],{x:g[0].x,y:g[0].y},{x:g[1].x,y:g[1].y}).projectPoint;var m=this.ComputeZValue(d,g[1],g[0]),S=[];this.ComputeHeight(a,S,g[0].z,m),y=y.concat(S);for(var P=0;P<r.length;P++){d=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(r[P],{x:g[0].x,y:g[0].y},{x:g[1].x,y:g[1].y}).projectPoint;var b=this.ComputeZValue(d,g[1],g[0]);y.push({x:r[P].x,y:r[P].y,z:b})}d=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(u[0],{x:g[0].x,y:g[0].y},{x:g[1].x,y:g[1].y}).projectPoint,this.ComputeZValue(d,g[1],g[0]),d=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(u[u.length-1],{x:g[0].x,y:g[0].y},{x:g[1].x,y:g[1].y}).projectPoint;var v=this.ComputeZValue(d,g[1],g[0]);d=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(p[0],{x:f[0].x,y:f[0].y},{x:f[1].x,y:f[1].y}).projectPoint;var L=(this.ComputeZValue(d,f[1],f[0])+v)/2,M=[];this.ComputeHeight(u,M,m,L),y=y.concat(M),d=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(p[p.length-1],{x:f[0].x,y:f[0].y},{x:f[1].x,y:f[1].y}).projectPoint;var _=this.ComputeZValue(d,f[1],f[0]),A=[];this.ComputeHeight(p,A,L,_),y=y.concat(A);for(var T=0;T<h.length;T++){d=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(h[T],{x:f[0].x,y:f[0].y},{x:f[1].x,y:f[1].y}).projectPoint;var x=this.ComputeZValue(d,f[1],f[0]);y.push({x:h[T].x,y:h[T].y,z:x})}d=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(c[0],{x:f[0].x,y:f[0].y},{x:f[1].x,y:f[1].y}).projectPoint;var O=this.ComputeZValue(d,f[1],f[0]),w=[];this.ComputeHeight(c,w,O,f[0].z),(y=y.concat(w)).length>0&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,y,{surroundLineFlag:!1}),this.m_scalePoints.length>0&&(this.m_scalePoints[0]={x:this.m_scalePoints[0].x,y:this.m_scalePoints[0].y,z:L});for(var C=0;C<this.m_scalePoints.length;C++)this.m_scalePoints[C].isScalePoint=!0,this.m_scalePoints[C].tag=C,this.addScalePoint(this.m_scalePoints[C]);return!0}var E=n.shapePts,I=n.LeftArowLeftBody,D=n.LeftArowHead,U=n.LeftArowRightBody,R=n.RightArowLeftBody,N=n.RightArowHead,B=n.RightArowRightBody;if(E.length>0){for(var k=this.mergeDashLine(this.dashLines,[]),F=this.computeDashLine(k,I),j=0;j<F.length-1;j++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,F[j]);for(var V=this.mergeDashLine(this.dashLines,[]),z=this.computeDashLine(V,U.reverse()),Y=0;Y<z.length-1;Y++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,z[Y].reverse());var G=[];G=(G=(G=G.concat(F[F.length-1])).concat(D)).concat(z[z.length-1].reverse()),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,G);for(var W=this.mergeDashLine(this.dashLines,[]),X=this.computeDashLine(W,R),H=0;H<X.length-1;H++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,X[H]);for(var Z=this.mergeDashLine(this.dashLines,[]),J=this.computeDashLine(Z,B.reverse()),q=0;q<J.length-1;q++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,J[q].reverse());var K=[];K=(K=(K=K.concat(X[X.length-1])).concat(N)).concat(J[J.length-1].reverse()),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,K)}this.scalePoints=[];for(var Q=0;Q<this.m_scalePoints.length;Q++)this.m_scalePoints[Q].isScalePoint=!0,this.m_scalePoints[Q].tag=Q,this.addScalePoint(this.m_scalePoints[Q])}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(this.controlPoints).pts,o=SuperMapAlgoPlot.PlottingUtil.operateControlPoints(i),n=new SuperMapAlgoPlot.Point((o[0].x+o[1].x)/2,(o[0].y+o[1].y)/2),l=new SuperMapAlgoPlot.Point((o[2].x+o[3].x)/2,(o[2].y+o[3].y)/2),s=SuperMapAlgoPlot.PlottingUtil.distance(o[0],o[3]),a=SuperMapAlgoPlot.PlottingUtil.distance(o[1],o[2]),r=(o[0],o[1],.5*(o[0].x+o[3].x)),u=.5*(o[0].y+o[3].y),p=new SuperMapAlgoPlot.Point(r,u),h=.5*(o[1].x+o[2].x),c=.5*(o[1].y+o[2].y),y=new SuperMapAlgoPlot.Point(h,c),g=SuperMapAlgoPlot.PlottingUtil.distance(p,y);if(g<this.MIN_LEN_LeftToRightCenter&&(g=this.MIN_LEN_LeftToRightCenter),0==t){var f=s*(r-h)/(e.x-r)/(g*this.QIANJI_RATE1),d=s*(u-c)/(e.y-u)/(g*this.QIANJI_RATE1);this.scaleValues[1]=f,this.scaleValues[2]=d}else if(1==t){f=a*(h-r)/(e.x-h)/(g*this.QIANJI_RATE1),d=a*(c-u)/(e.y-c)/(g*this.QIANJI_RATE1);this.scaleValues[3]=f,this.scaleValues[4]=d}else{var m,S=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,n,l);if(S.isOnline){var P=SuperMapAlgoPlot.PlottingUtil.distance(S.projectPoint,n),b=SuperMapAlgoPlot.PlottingUtil.distance(n,l);(m=SuperMapAlgoPlot.PlottingUtil.equalFuzzy(P,0)?this.SV1_MinValue:P/b)>this.SV1_MaxValue&&(m=this.SV1_MaxValue)}else m=SuperMapAlgoPlot.PlottingUtil.distance(S.projectPoint,n)<SuperMapAlgoPlot.PlottingUtil.distance(S.projectPoint,l)?this.SV1_MinValue:this.SV1_MaxValue;this.scaleValues[0]=m}}this.calculateParts()}},{key:"arrowMeshs",value:function(t){var e=new SuperMapAlgoPlot.Path2D;t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts;var i=[];this.m_bIsAnimation&&4==t.length?i=SuperMapAlgoPlot.PlottingUtil.clonePoints(t):(i=SuperMapAlgoPlot.PlottingUtil.operateControlPoints(t),void 0!==t[0].z&&(i[i.length-1].z=i[i.length-2].z));var o=this.scaleValues[0],n=this.scaleValues[1],l=this.scaleValues[2],s=this.scaleValues[3],a=this.scaleValues[4],r=SuperMapAlgoPlot.PlottingUtil.distance(i[0],i[3]),u=SuperMapAlgoPlot.PlottingUtil.distance(i[1],i[2]),p=(i[0].clone(),i[1].clone()),h=.5*(i[0].x+i[3].x),c=.5*(i[0].y+i[3].y),y=new SuperMapAlgoPlot.Point(h,c),g=.5*(i[1].x+i[2].x),f=.5*(i[1].y+i[2].y),d=new SuperMapAlgoPlot.Point(g,f),m=SuperMapAlgoPlot.PlottingUtil.distance(y,d);m<this.MIN_LEN_LeftToRightCenter&&(m=this.MIN_LEN_LeftToRightCenter),y.x=h+r*(h-g)/(m*this.QIANJI_RATE1*n),y.y=c+r*(c-f)/(m*this.QIANJI_RATE1*l),d.x=g+u*(g-h)/(m*this.QIANJI_RATE1*s),d.y=f+u*(f-c)/(m*this.QIANJI_RATE1*a),this.m_scalePoints.push(new SuperMapAlgoPlot.Point(y.x,y.y)),this.m_scalePoints.push(new SuperMapAlgoPlot.Point(d.x,d.y));var S=new SuperMapAlgoPlot.Point(0,0),P=new SuperMapAlgoPlot.Point(0,0);S.x=h+r*(h-g)/(m*this.QIANJI_RATE2*n),S.y=c+r*(c-f)/(m*this.QIANJI_RATE2*l),P.x=g+u*(g-h)/(m*this.QIANJI_RATE2*s),P.y=f+u*(f-c)/(m*this.QIANJI_RATE2*a);var b=new SuperMapAlgoPlot.Point((i[0].x+i[1].x)/2,(i[0].y+i[1].y)/2),v=new SuperMapAlgoPlot.Point((i[2].x+i[3].x)/2,(i[2].y+i[3].y)/2),L=i[3].x-(i[3].x-y.x)*this.SCALE_AT,M=i[3].y-(i[3].y-y.y)*this.SCALE_AT,_=i[2].x-(i[2].x-d.x)*this.SCALE_AT,A=i[2].y-(i[2].y-d.y)*this.SCALE_AT,T=new SuperMapAlgoPlot.Point(0,0),x=new SuperMapAlgoPlot.Point(0,0),O=new SuperMapAlgoPlot.Point(0,0),w=new SuperMapAlgoPlot.Point(0,0);x.x=L-(M-i[3].y)*this.SCALE_ATAJ,x.y=M+(L-i[3].x)*this.SCALE_ATAJ,T.x=L+(M-i[3].y)*this.SCALE_ATAJ,T.y=M-(L-i[3].x)*this.SCALE_ATAJ,w.x=_-(A-i[2].y)*this.SCALE_ATAJ,w.y=A+(_-i[2].x)*this.SCALE_ATAJ,O.x=_+(A-i[2].y)*this.SCALE_ATAJ,O.y=A-(_-i[2].x)*this.SCALE_ATAJ;var C=new SuperMapAlgoPlot.Point(0,0),E=new SuperMapAlgoPlot.Point(0,0),I=new SuperMapAlgoPlot.Point(0,0),D=new SuperMapAlgoPlot.Point(0,0);C.x=3*T.x-2*L-(i[3].x-L)*this.SCALE_ATAE,C.y=3*T.y-2*M-(i[3].y-M)*this.SCALE_ATAE,E.x=3*x.x-2*L-(i[3].x-L)*this.SCALE_ATAE,E.y=3*x.y-2*M-(i[3].y-M)*this.SCALE_ATAE,I.x=3*O.x-2*_-(i[2].x-_)*this.SCALE_ATAE,I.y=3*O.y-2*A-(i[2].y-A)*this.SCALE_ATAE,D.x=3*w.x-2*_-(i[2].x-_)*this.SCALE_ATAE,D.y=3*w.y-2*A-(i[2].y-A)*this.SCALE_ATAE,y.x=h+r*(h-g)/(m*this.QIANJI_RATE4*n),y.y=c+r*(c-f)/(m*this.QIANJI_RATE4*l),d.x=g+u*(g-h)/(m*this.QIANJI_RATE4*s),d.y=f+u*(f-c)/(m*this.QIANJI_RATE4*a);var U=new SuperMapAlgoPlot.Point(0,0);U.x=i[0].x+(y.x-i[0].x)*this.SCALE_AW,U.y=i[0].y+(y.y-i[0].y)*this.SCALE_AW;var R=new SuperMapAlgoPlot.Point(0,0);R.x=i[1].x+(d.x-i[1].x)*this.SCALE_AW,R.y=i[1].y+(d.y-i[1].y)*this.SCALE_AW;var N=new SuperMapAlgoPlot.Point(0,0);N.x=T.x+(y.x-T.x)*this.SCALE_ATAJctrlSameSide,N.y=T.y+(y.y-T.y)*this.SCALE_ATAJctrlSameSide;var B=new SuperMapAlgoPlot.Point(0,0);B.x=w.x+(d.x-w.x)*this.SCALE_ATAJctrlSameSide,B.y=w.y+(d.y-w.y)*this.SCALE_ATAJctrlSameSide;var k=new SuperMapAlgoPlot.Point(0,0);k.x=x.x+(S.x-x.x)*this.SCALE_ATAJctrlDefSide,k.y=x.y+(S.y-x.y)*this.SCALE_ATAJctrlDefSide;var F=new SuperMapAlgoPlot.Point(0,0);F.x=O.x+(P.x-O.x)*this.SCALE_ATAJctrlDefSide,F.y=O.y+(P.y-O.y)*this.SCALE_ATAJctrlDefSide;var j=new SuperMapAlgoPlot.Point(0,0);j.x=b.x+(v.x-b.x)*o,j.y=b.y+(v.y-b.y)*o,this.m_scalePoints.push(new SuperMapAlgoPlot.Point(j.x,j.y));var V=new SuperMapAlgoPlot.Point(0,0),z=new SuperMapAlgoPlot.Point(0,0);V.x=i[0].x+(i[3].x-i[0].x)*o,V.y=i[0].y+(i[3].y-i[0].y)*o,z.x=i[1].x+(i[2].x-i[1].x)*o,z.y=i[1].y+(i[2].y-i[1].y)*o,V.x=V.x+(j.x-V.x)*this.QIANJI_RATE3,V.y=V.y+(j.y-V.y)*this.QIANJI_RATE3,z.x=z.x+(j.x-z.x)*this.QIANJI_RATE3,z.y=z.y+(j.y-z.y)*this.QIANJI_RATE3;var Y=[];Y.push(i[0].clone()),Y.push(U.clone()),Y.push(N.clone()),Y.push(T.clone()),e.MoveTo(Y[0]),e.CurveTo(Y[1],Y[2],Y[3]);var G,W=[],X=[],H=[],Z=[],J=[],q=[],K=[];for(e.ToSubPathPolygons(K),K.length>0&&(W=W.concat(K[0]),G=K[0].length),e.LineTo(C),e.LineTo(i[3]),e.LineTo(E),(Y=[]).push(x),Y.push(k),Y.push(V),Y.push(j),e.LineTo(Y[0]),K=[],e.ToSubPathPolygons(K);G<K[0].length;G++)X.push(K[0][G]);for(G=K[0].length,e.CurveTo(Y[1],Y[2],Y[3]),K=[],e.ToSubPathPolygons(K);G<K[0].length;G++)H.push(K[0][G]);for(G=K[0].length,(Y=[]).push(z),Y.push(F),Y.push(O),e.CurveTo(Y[0],Y[1],Y[2]),K=[],e.ToSubPathPolygons(K);G<K[0].length;G++)Z.push(K[0][G]);for(G=K[0].length,e.LineTo(I),e.LineTo(i[2]),e.LineTo(D),(Y=[]).push(w),Y.push(B),Y.push(R),Y.push(p),e.LineTo(Y[0]),K=[],e.ToSubPathPolygons(K);G<K[0].length;G++)J.push(K[0][G]);for(G=K[0].length,e.CurveTo(Y[1],Y[2],Y[3]),K=[],e.ToSubPathPolygons(K);G<K[0].length;G++)q.push(K[0][G]);return K=[],e.ToSubPathPolygons(K),{shapePts:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(K[0]),LeftArowLeftBody:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(W),LeftArowHead:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(X),LeftArowRightBody:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(H),RightArowLeftBody:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(Z),RightArowHead:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(J),RightArowRightBody:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(q)}}}])&&ca(i.prototype,o),n&&ca(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Sa(t){"@babel/helpers - typeof";return(Sa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pa(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ba(o.key),o)}}function ba(t){var e=function(t,e){if("object"!=Sa(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Sa(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Sa(e)?e:e+""}function va(t,e,i){return e=La(e),function(t,e){if(e&&("object"===Sa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],La(t).constructor):e.apply(t,i))}function La(t){return(La=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ma(t,e){return(Ma=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1006=ma;var _a=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=va(this,e,[t])).scaleValues.length&&i.scaleValues.push(.1),i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1007",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ma(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){var e=!1;void 0!==t[0].z&&(e=!0),this.scaleValues[0]=this.getSubSymbolScaleValue();var i=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t)*this.scaleValues[0],o=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePtsBySingleLine(t,i,SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_POLYLINE,!0),n=[];n.push(t[t.length-1]),n.push(o[o.length-1]),n.push(t[t.length-2]);var l=SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePtsBySingleLine(n,i,SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_TRIANGLE_SOLID);if(e){for(var s=t.length,a=[],r=[],u=0;u<s;++u)a.push({x:o[u].x,y:o[u].y,z:t[u].z});var p={x:t[s-1].x,y:t[s-1].y,z:t[s-1].z},h={x:t[s-2].x,y:t[s-2].y,z:t[s-2].z},c=this.ComputeZValue(o[s-1],p,h);a[s-1].z=c;for(var y=0;y<l.length;++y){var g=this.ComputeZValue(l[y],p,h);r.push({x:l[y].x,y:l[y].y,z:g})}this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,a);r.length>0&&this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,r,{surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0,surroundLineLimit:!0,lineTypeLimit:!0})}else{for(var f=this.mergeDashLine(this.dashLines,[]),d=this.computeDashLine(f,o),m=0;m<d.length;m++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,d[m]);l.length>0&&this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,l,{surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0,lineTypeLimit:!0,surroundLineLimit:!0})}}}}])&&Pa(i.prototype,o),n&&Pa(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Aa(t){"@babel/helpers - typeof";return(Aa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ta(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,xa(o.key),o)}}function xa(t){var e=function(t,e){if("object"!=Aa(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Aa(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Aa(e)?e:e+""}function Oa(t,e,i){return e=wa(e),function(t,e){if(e&&("object"===Aa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],wa(t).constructor):e.apply(t,i))}function wa(t){return(wa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ca(t,e){return(Ca=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1007=_a;var Ea=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Oa(this,e,[t])).scaleValues.length&&i.scaleValues.push(.1),i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1008",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ca(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){this.scaleValues[0]=this.getSubSymbolScaleValue();var e=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t)*this.scaleValues[0],i=Math.sqrt(e*e/3),o=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePtsBySingleLine(t,i,SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_POLYBEZIER,!0),n=[];n.push(t[t.length-1]),n.push(o[o.length-1]),n.push(t[t.length-2]);for(var l=SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePtsBySingleLine(n,e,SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_COATTAIL),s=this.mergeDashLine(this.dashLines,[]),a=this.computeDashLine(s,o),r=0;r<a.length;r++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,a[r]);l.length>0&&this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,l,{surroundLineFlag:!1,fillLimit:!0,fill:!0,lineTypeLimit:!0,surroundLineLimit:!0})}}}])&&Ta(i.prototype,o),n&&Ta(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Ia(t){"@babel/helpers - typeof";return(Ia="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Da(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Ua(o.key),o)}}function Ua(t){var e=function(t,e){if("object"!=Ia(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ia(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ia(e)?e:e+""}function Ra(t,e,i){return e=Na(e),function(t,e){if(e&&("object"===Ia(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Na(t).constructor):e.apply(t,i))}function Na(t){return(Na=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ba(t,e){return(Ba=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1008=Ea;var ka=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Ra(this,e,[t])).scaleValues.length&&i.scaleValues.push(.1),i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1009",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ba(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){var e=!1;void 0!==t[0].z&&(e=!0),this.scaleValues[0]=this.getSubSymbolScaleValue();var i=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t)*this.scaleValues[0],o=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePtsBySingleLine(t,0,SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_POLYLINE,!1),n=[];n.push(o[o.length-1]),n.push(o[o.length-2]),n.push(t[t.length-2]);var l=SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePtsBySingleLine(n,i,SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_POLYLINE),s=[];s.push(o[0]),s.push(o[1]);var a=SuperMapAlgoPlot.ArrowToolkit.generateArrowTailShapePtsBySingleLine(s,i,SuperMapAlgoPlot.ArrowToolkit.ArrowTailType.ARROWTAIL_COATTAIL);if(e){for(var r=t.length,u=[],p=[],h=[],c=0;c<r;++c)u.push({x:t[c].x,y:t[c].y,z:t[c].z});var y,g={x:t[r-1].x,y:t[r-1].y,z:t[r-1].z},f={x:t[r-2].x,y:t[r-2].y,z:t[r-2].z};y=this.ComputeZValue(o[r-1],g,f),u.push({x:o[r-1].x,y:o[r-1].y,z:y});for(var d=0;d<l.length;++d)y=this.ComputeZValue(l[d],g,f),p.push({x:l[d].x,y:l[d].y,z:y});for(var m={x:t[1].x,y:t[1].y,z:t[1].z},S={x:t[0].x,y:t[0].y,z:t[0].z},P=0;P<a.length;++P)y=this.ComputeZValue(a[P],m,S),h.push({x:a[P].x,y:a[P].y,z:y});this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,u,{surroundLineFlag:!1}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,p,{surroundLineLimit:!0,lineTypeLimit:!0}),0!==h.length&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,h)}else{for(var b={surroundLineFlag:!1},v=this.mergeDashLine(this.dashLines,[]),L=this.computeDashLine(v,o),M=0;M<L.length;M++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,L[M],b);this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,l,{surroundLineLimit:!0,lineTypeLimit:!0}),0!==a.length&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,a)}}}}])&&Da(i.prototype,o),n&&Da(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Fa(t){"@babel/helpers - typeof";return(Fa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ja(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Va(o.key),o)}}function Va(t){var e=function(t,e){if("object"!=Fa(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Fa(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Fa(e)?e:e+""}function za(t,e,i){return e=Ya(e),function(t,e){if(e&&("object"===Fa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Ya(t).constructor):e.apply(t,i))}function Ya(t){return(Ya=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ga(t,e){return(Ga=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1009=ka;var Wa=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=za(this,e,[t])).scaleValues.length&&(i.scaleValues.push(0),i.scaleValues.push(.148),i.scaleValues.push(.4),i.scaleValues.push(.312),i.scaleValues.push(.2)),i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1010",i._isUseDashLine=!0,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ga(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length>=2&&t.length<this.minEditPts&&this.calAssistantLine(),!(t.length<this.minEditPts)){var e=this.arrowMeshs(t),i=e.shapePts,o=e.leftBodyPts,n=e.rightBodyPts,l=e.arrowHeadPts,s=e.arrowTailPts;if(SuperMapAlgoPlot.PlottingUtil.clearSamePts(i),0!==e.shapePts.length){if(0!=this.dashLines.length&&this._isUseDashLine){for(var a=this.mergeDashLine(this.dashLines,[]),r=this.computeDashLine(a,o),u=1;u<r.length-1;u++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,r[u],{surroundLineFlag:!1});for(var p=this.mergeDashLine(this.dashLines,[]),h=this.computeDashLine(p,n.reverse()),c=1;c<h.length-1;c++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,h[c].reverse(),{surroundLineFlag:!1});var y=[];y=(y=(y=y.concat(r[r.length-1])).concat(l)).concat(h[h.length-1].reverse()),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,y,{surroundLineFlag:!1});var g=[];g=(g=(g=g.concat(h[0].reverse())).concat(s)).concat(r[0]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,g,{surroundLineFlag:!1})}else this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,e.shapePts,{surroundLineFlag:!1});this.scalePoints=[];for(var f=0;f<e.m_scalePoints.length;f++)this.addScalePoint(e.m_scalePoints[f])}}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);this.scaleValues.length<4&&(this.scaleValues.push(0),this.scaleValues.push(.148),this.scaleValues.push(.4),this.scaleValues.push(.312),this.scaleValues.push(.2));var o,n,l,s,a=i.length;if(a<=2)return;this.scaleValues.length<4?(o=0,n=.148,l=.4,s=.312):(o=this.scaleValues[0],n=this.scaleValues[1],l=this.scaleValues[2],s=this.scaleValues[3]);var r=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i),u=this.operateCtrlPts(i);a=u.length,a--;for(var p=[],h=0;h<this.scalePoints.length;h++)p.push(this.scalePoints[h].clone());if(0===(p=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(p).pts).length)return;if(p[t]=e.clone(),3===t){var c=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePts(i,this.scaleValues,SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_MULTIPOLYBEZIER),y=new SuperMapAlgoPlot.Point(.5*(c.leftBodyPts[0].x+c.rightBodyPts[0].x),.5*(c.leftBodyPts[0].y+c.rightBodyPts[0].y)),g=SuperMapAlgoPlot.PlottingUtil.distance(c.leftBodyPts[0],c.rightBodyPts[0]);this.scaleValues[4]=SuperMapAlgoPlot.PlottingUtil.distance(y,e)/g}else{var f,d,m=a-1;f=a<=3?new SuperMapAlgoPlot.Point((u[0].x+u[1].x)/2,(u[0].y+u[1].y)/2):u[m-1].clone();var S,P,b,v,L,M,_=new SuperMapAlgoPlot.Point(0,0),A=new SuperMapAlgoPlot.Point(0,0),T=new SuperMapAlgoPlot.Point(0,0);SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(0,3,f,u[m],u[m+1],A,T),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,u[a],u[a-1],T,_),d=_.clone();var x=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(u[a],d,p[2]);S=x.dLen1,x.dLen2,0===S&&(S=.1),P=S,o=(S/=s+1)/r,1===t?(v=(x=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(u[a],d,p[1])).dLen1,l=(L=x.dLen2)/S,s=(v-S)/S):0===t?(S=(x=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(u[a],d,p[0])).dLen1,n=(b=x.dLen2)/S,(M=SuperMapAlgoPlot.PlottingUtil.distance(u[a],u[a-1]))<2*S&&(S=.5*M),v=(x=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(u[a],d,p[1])).dLen1,l=(L=x.dLen2)/S,(s=(P-S)/S)<.1&&(l=L/(S=P/(1+(s=.1))),n=b/S),o=S/r):2===t&&(o=S/r),b=S*n,(M=SuperMapAlgoPlot.PlottingUtil.distance(u[a],u[a-1]))<2*S&&(b=(S=.5*M)*n,o=S/r),this.scaleValues[0]=o,this.scaleValues[1]=n,this.scaleValues[2]=l,this.scaleValues[3]=s}}this.calculateParts()}},{key:"arrowMeshs",value:function(t){var e=[],i=[],o=[],n=[],l=[],s=[],a=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),r=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePts(a,this.scaleValues,SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_MULTIPOLYBEZIER),u=r.arrowTouLen,p=r.leftBodyPts,h=r.rightBodyPts;if(a=r.OpectrlPoints,!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(u,0)){var c=[];c.push(p[p.length-1]),c.push(h[h.length-1]);var y=[];y.push(this.scaleValues[2]),y.push(this.scaleValues[3]),y.push(0),y.push(0);var g=SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePts(a,c,y,u,SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_WITH_EAR),f=[];f.push(p[0]),f.push(h[0]);for(var d,m=SuperMapAlgoPlot.ArrowToolkit.generateArrowTailShapePts(t,f,this.scaleValues[4],SuperMapAlgoPlot.ArrowToolkit.ArrowTailType.ARROWTAIL_COATTAIL_POLYBODY),S=0;S<p.length;S++)e.push(p[S]),i.push(p[S]);for(var P=0;P<g.length;P++)e.push(g[P]),n.push(g[P]);for(var b=h.length-1;b>=0;b--)e.push(h[b]),o.push(h[b]);for(var v=1;v<m.length;v++)e.push(m[v]),l.push(m[v]);var L=a.length;L-=2;var M=u*this.scaleValues[3];d=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(M,a[L],a[L+1]);var _=new SuperMapAlgoPlot.Point(i[i.length-1].x,i[i.length-1].y);_.isScalePoint=!0,_.tag=0,s.push(_),(_=new SuperMapAlgoPlot.Point(n[0].x,n[0].y)).isScalePoint=!0,_.tag=1,s.push(_),(_=new SuperMapAlgoPlot.Point(d.x,d.y)).isScalePoint=!0,_.tag=2,s.push(_),(_=new SuperMapAlgoPlot.Point(m[1].x,m[1].y)).isScalePoint=!0,_.tag=3,s.push(_)}return{shapePts:e,leftBodyPts:i,rightBodyPts:o,arrowHeadPts:n,arrowTailPts:l,m_scalePoints:s}}},{key:"operateCtrlPts",value:function(t){var e=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts,i=SuperMapAlgoPlot.PlottingUtil.clonePoints(e);if(3===i.length){var o=((i[0].x+i[1].x)/2+i[2].x)/2,n=((i[0].y+i[1].y)/2+i[2].y)/2,l=new SuperMapAlgoPlot.Point(o,n),s=i[2];i[2]=l,i.push(s)}return i}}])&&ja(i.prototype,o),n&&ja(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Xa(t){"@babel/helpers - typeof";return(Xa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ha(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Za(o.key),o)}}function Za(t){var e=function(t,e){if("object"!=Xa(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Xa(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Xa(e)?e:e+""}function Ja(t,e,i){return e=qa(e),function(t,e){if(e&&("object"===Xa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],qa(t).constructor):e.apply(t,i))}function qa(t){return(qa=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ka(t,e){return(Ka=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1010=Wa;var Qa=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=Ja(this,e,[t])).sv1_DefaultAtLenDivAbLen=0,i.sv2_DefaultAjWidthDivAtLen=.148,i.sv3_DefaultAeWidthDivAtLen=.4,i.sv4_DefaultAeLenDivAtLen=.312,i.sv_arrowTailWidth=.05,5!==i.scaleValues.length&&(i.scaleValues=[],i.scaleValues.push(i.sv1_DefaultAtLenDivAbLen),i.scaleValues.push(i.sv2_DefaultAjWidthDivAtLen),i.scaleValues.push(i.sv3_DefaultAeWidthDivAtLen),i.scaleValues.push(i.sv4_DefaultAeLenDivAtLen),i.scaleValues.push(i.sv_arrowTailWidth)),i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1011",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ka(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol1004),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<2)){var e=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t);if(0!==e){var i=e*this.scaleValues[4],o=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(i,t[1],t[0]);void 0!==t[0].z&&(o.pntLeft.z=t[0].z,o.pntRight.z=t[0].z),this.controlPoints=[],this.controlPoints.push(o.pntLeft),this.controlPoints.push(o.pntRight);for(var n=1;n<t.length;n++)this.controlPoints.push(t[n].clone());for(var l=[],s=0;s<this.scaleValues.length;s++)l.push(this.scaleValues[s]);this.scaleValues=[];for(var a=0;a<l.length-1;a++)this.scaleValues.push(l[a]);SuperMapAlgoPlot.AlgoSymbol1004.prototype.calculateParts.apply(this,arguments);var r=o.pntRight.clone();r.isScalePoint=!0,r.tag=3,this.addScalePoint(r),this.controlPoints=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),this.scaleValues=[];for(var u=0;u<l.length;u++)this.scaleValues.push(l[u])}}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(i.length<2)return;this.scaleValues.length<5&&(this.scaleValues=[],this.scaleValues.push(this.sv1_DefaultAtLenDivAbLen),this.scaleValues.push(this.sv2_DefaultAjWidthDivAtLen),this.scaleValues.push(this.sv3_DefaultAeWidthDivAtLen),this.scaleValues.push(this.sv4_DefaultAeLenDivAtLen),this.scaleValues.push(this.sv_arrowTailWidth));var o,n=i[0].clone(),l=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i),s=l*this.scaleValues[4],a=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(s,i[1],i[0]);(i=[]).push(a.pntLeft),i.push(a.pntRight);for(var r=1;r<this.controlPoints.length;r++)i.push(this.controlPoints[r].clone());var u,p,h,c,y,g=i.length,f=this.operateCtrlPts(i);g=f.length,g--;var d=this.calcScaleValueCount(i.length);if(d++,this.scaleValues.length<d){var m=this.calcDefaultScaleValues(g);u=m[0],p=m[1],h=m[2],c=m[3],y=this.sv_arrowTailWidth}else u=this.scaleValues[0],p=this.scaleValues[1],h=this.scaleValues[2],c=this.scaleValues[3],y=this.scaleValues[4];o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i);for(var S=[],P=0;P<this.scalePoints.length;P++)S.push(this.scalePoints[P].clone());if(0===S.length)return;S[t]=e.clone();var b,v,L=g-1;b=g<=3?new SuperMapAlgoPlot.Point((f[0].x+f[1].x)/2,(f[0].y+f[1].y)/2):f[L-1].clone();var M,_,A,T,x,O,w=new SuperMapAlgoPlot.Point(0,0),C=new SuperMapAlgoPlot.Point(0,0),E=new SuperMapAlgoPlot.Point(0,0);SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(0,3,b,f[L],f[L+1],C,E),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,f[g],f[g-1],E,w),v=w.clone();var I=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(f[g],v,S[2]);if(M=I.dLen1,I.dLen2,0===M&&(M=.1),_=M,u=(M/=c+1)/o,1===t)T=(I=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(f[g],v,S[1])).dLen1,h=(x=I.dLen2)/M,c=(T-M)/M;else if(0===t)M=(I=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(f[g],v,S[0])).dLen1,p=(A=I.dLen2)/M,(O=SuperMapAlgoPlot.PlottingUtil.distance(f[g],f[g-1]))<2*M&&(M=.5*O),T=(I=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(f[g],v,S[1])).dLen1,h=(x=I.dLen2)/M,(c=(_-M)/M)<.1&&(h=x/(M=_/(1+(c=.1))),p=A/M),u=M/o;else if(2===t)u=M/o;else{y=SuperMapAlgoPlot.PlottingUtil.distance(e,n)/l}A=M*p,(O=SuperMapAlgoPlot.PlottingUtil.distance(f[g],f[g-1]))<2*M&&(A=(M=.5*O)*p,u=M/o),this.scaleValues[0]=u,this.scaleValues[1]=p,this.scaleValues[2]=h,this.scaleValues[3]=c,this.scaleValues[4]=y}this.calculateParts()}},{key:"arrowMeshs",value:function(t){var e=[],i=[],o=[],n=[],l=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),s=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePts(l,this.scaleValues,SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_MULTIPOLYBEZIER),a=s.arrowTouLen,r=s.leftBodyPts,u=s.rightBodyPts;if(!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(a,0)){var p=[];p.push(r[r.length-1]),p.push(u[u.length-1]);var h=[];h.push(this.scaleValues[2]),h.push(this.scaleValues[3]),h.push(0),h.push(0);for(var c=SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePts(l,p,h,a,SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_WITH_EAR),y=0;y<r.length;y++)e.push(r[y]),i.push(r[y]);for(var g=0;g<c.length;g++)e.push(c[g]),n.push(c[g]);for(var f=u.length-1;f>=0;f--)e.push(u[f]),o.push(u[f])}return{shapePts:e,leftBodyPts:i,rightBodyPts:o,arrowHeadPts:n}}},{key:"updateScalePoints",value:function(t){var e=t.length,i=[];if(!(e<3)){var o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t);if(!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(o,0)){var n=this.operateCtrlPts(t);e=n.length,e--;for(var l=[],s=0;s<this.scaleValues.length;s++)l.push(this.scaleValues[s]);var a=this.genArrowBodyPts(o,n,l),r=a.ArrowBodyCenterPts,u=this.genAtPts(e,r,l,a.ArrowTouLen),p=this.calc3rdScalePt(e,r,l,a.ArrowTouLen);return i.push(new SuperMapAlgoPlot.Point(a.LeftBodyPtsTemp[e].x,a.LeftBodyPtsTemp[e].y)),i.push(new SuperMapAlgoPlot.Point(u[2].x,u[2].y)),i.push(new SuperMapAlgoPlot.Point(p.x,p.y)),i}}}},{key:"operateCtrlPts",value:function(t){var e=SuperMapAlgoPlot.PlottingUtil.clonePoints(t);if(3===e.length){var i=((e[0].x+e[1].x)/2+e[2].x)/2,o=((e[0].y+e[1].y)/2+e[2].y)/2,n=new SuperMapAlgoPlot.Point(i,o),l=e[2];e[2]=n,e.push(l)}return e}},{key:"genArrowBodyPts",value:function(t,e,i){var o,n,l,s=[],a=[],r=[],u=[],p=[],h=[],c=e.length;if(c--,i.length<this.calcScaleValueCount(c)){var y=this.calcDefaultScaleValues(c);n=y[0],l=y[1]}else n=i[0],l=i[1];var g=SuperMapAlgoPlot.PlottingUtil.clonePoints(e),f=(g[0].x+g[1].x)/2,d=(g[0].y+g[1].y)/2,m=Math.abs(f-g[2].x),S=Math.abs(d-g[2].y),P=0;if(m>0&&S>0){var b=1/(f-g[2].x),v=-1/(d-g[2].y),L=1*g[2].y/(d-g[2].y)-1*g[2].x/(f-g[2].x);P=Math.abs(b*g[0].x+v*g[0].y+L)/Math.sqrt(b*b+v*v)}else S<=1e-4?P=Math.abs(d-g[1].y):m<=1e-4&&(P=Math.abs(f-g[1].x));var M=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(P,g[2],new SuperMapAlgoPlot.Point(f,d)),_=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(g[1],g[2],g[0]);_?(s[1]=g[1],a[1]=g[0]):(s[1]=g[0],a[1]=g[1]),g[1]=new SuperMapAlgoPlot.Point((g[0].x+g[1].x)/2,(g[0].y+g[1].y)/2);var A=Math.sqrt((M.pntLeft.x-M.pntRight.x)*(M.pntLeft.x-M.pntRight.x)+(M.pntLeft.y-M.pntRight.y)*(M.pntLeft.y-M.pntRight.y))*this.sv_AtWidthDivAwWidth,T=(o=A*this.sv_AtLenDivAtWidth)*l;SuperMapAlgoPlot.PlottingUtil.equalFuzzy(n,0)||(T=(o=t*n)*l);var x,O,w=SuperMapAlgoPlot.PlottingUtil.distance(g[c],g[c-1]),C=2*o;w<C&&(T=(o=w/2)*l),g.push(g[c].clone()),x=0,O=0;var E=0,I=[];for(E=2;E<=c;E++)x+=SuperMapAlgoPlot.PlottingUtil.distance(g[E],g[E-1]);for(x-=o,E=2;E<=c-1;E++)O+=SuperMapAlgoPlot.PlottingUtil.distance(g[E],g[E-1]),I[E]=T+(A-T)*Math.pow((x-O)/x,this.sv_AtScaleParameter);I[c]=T;var D,U,R=new SuperMapAlgoPlot.Point(0,0),N=new SuperMapAlgoPlot.Point(0,0),B=new SuperMapAlgoPlot.Point(0,0);for(E=2;E<=c-1;E++)SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(0,3,g[E-1],g[E],g[E+1],N,B),E===c-1&&SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,g[c],g[c-1],B,R),D=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(I[E],N,g[E]),(_=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(B,N,D.pntRight))?(s[E]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y),a[E]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y)):(s[E]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y),a[E]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y));for(Math.sqrt(1*(g[c].x-R.x)*(g[c].x-R.x)+1*(g[c].y-R.y)*(g[c].y-R.y))>0&&(g[c]=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(o,g[c],R)),D=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(T,g[c+1],g[c]),(_=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(g[c],g[c+1],D.pntLeft))?(a[c]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y),s[c]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y)):(a[c]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y),s[c]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y)),E=2;E<c;E++)SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(3,3,s[E-1],s[E],s[E+1],N,B),r[E]=new SuperMapAlgoPlot.Point(N.x,N.y),u[E]=new SuperMapAlgoPlot.Point(B.x,B.y),SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(3,3,a[E-1],a[E],a[E+1],N,B),p[E]=new SuperMapAlgoPlot.Point(N.x,N.y),h[E]=new SuperMapAlgoPlot.Point(B.x,B.y),2===E&&(SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,s[1],s[2],r[2],R),u[E]=new SuperMapAlgoPlot.Point(R.x,R.y),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,a[1],a[2],p[2],R),h[E]=new SuperMapAlgoPlot.Point(R.x,R.y)),E===c-1&&(C=(w=SuperMapAlgoPlot.PlottingUtil.distance(s[c],s[c-1]))/3,(U=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(C,g[c],g[c+1])).x+=s[c].x-g[c].x,U.y+=s[c].y-g[c].y,C=(w=A-T)*Math.pow(C/x,this.sv_AtScaleParameter),D=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(C,s[c],U),r[c]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y),C=(w=SuperMapAlgoPlot.PlottingUtil.distance(a[c],a[c-1]))/3,(U=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(C,g[c],g[c+1])).x+=a[c].x-g[c].x,U.y+=a[c].y-g[c].y,C=(w=A-T)*Math.pow(C/x,this.sv_AtScaleParameter),D=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(C,a[c],U),p[c]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y));return{ArrowBodyCenterPts:SuperMapAlgoPlot.PlottingUtil.clonePoints(g),LeftBodyPtsTemp:s,RightBodyPtsTemp:a,LeftBodyPtsLeftCtrlPts:r,LeftBodyPtsRightCtrlPts:u,RightBodyPtsLeftCtrlPts:p,RightBodyPtsRightCtrlPts:h,ArrowTouLen:o}}},{key:"calcScaleValueCount",value:function(){return 4}},{key:"calcDefaultScaleValues",value:function(){var t=[];return t.push(this.sv1_DefaultAtLenDivAbLen),t.push(this.sv2_DefaultAjWidthDivAtLen),t.push(this.sv3_DefaultAeWidthDivAtLen),t.push(this.sv4_DefaultAeLenDivAtLen),t}},{key:"genAtPts",value:function(t,e,i,o){var n=i[2],l=[],s=o*i[3],a=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(s,e[t],e[t+1]);s=o*n;var r=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(s,e[t+1],a);return l.push(new SuperMapAlgoPlot.Point(r.pntLeft.x,r.pntLeft.y)),l.push(e[t+1]),l.push(new SuperMapAlgoPlot.Point(r.pntRight.x,r.pntRight.y)),l}},{key:"calc3rdScalePt",value:function(t,e,i,o){var n=o*i[3];return SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(n,e[t],e[t+1])}}])&&Ha(i.prototype,o),n&&Ha(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function $a(t){"@babel/helpers - typeof";return($a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tr(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,er(o.key),o)}}function er(t){var e=function(t,e){if("object"!=$a(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=$a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==$a(e)?e:e+""}function ir(t,e,i){return e=or(e),function(t,e){if(e&&("object"===$a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],or(t).constructor):e.apply(t,i))}function or(t){return(or=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function nr(t,e){return(nr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1011=Qa;var lr=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=ir(this,e,[t])).subSymbolDefaultPixelSize=15,i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1012",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&nr(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol1005),i=e,o&&tr(i.prototype,o),n&&tr(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function sr(t){"@babel/helpers - typeof";return(sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ar(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,rr(o.key),o)}}function rr(t){var e=function(t,e){if("object"!=sr(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=sr(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==sr(e)?e:e+""}function ur(t,e,i){return e=pr(e),function(t,e){if(e&&("object"===sr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],pr(t).constructor):e.apply(t,i))}function pr(t){return(pr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function hr(t,e){return(hr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1012=lr;var cr=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=ur(this,e,[t])).subSymbolDefaultPixelSize=15,i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1013",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hr(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol1007),i=e,o&&ar(i.prototype,o),n&&ar(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function yr(t){"@babel/helpers - typeof";return(yr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gr(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,fr(o.key),o)}}function fr(t){var e=function(t,e){if("object"!=yr(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=yr(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==yr(e)?e:e+""}function dr(t,e,i){return e=mr(e),function(t,e){if(e&&("object"===yr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],mr(t).constructor):e.apply(t,i))}function mr(t){return(mr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Sr(t,e){return(Sr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1013=cr;var Pr=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=dr(this,e,[t])).subSymbolDefaultPixelSize=15,i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1014",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Sr(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol1008),i=e,o&&gr(i.prototype,o),n&&gr(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function br(t){"@babel/helpers - typeof";return(br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vr(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Lr(o.key),o)}}function Lr(t){var e=function(t,e){if("object"!=br(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=br(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==br(e)?e:e+""}function Mr(t,e,i){return e=_r(e),function(t,e){if(e&&("object"===br(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],_r(t).constructor):e.apply(t,i))}function _r(t){return(_r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ar(t,e){return(Ar=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1014=Pr;var Tr=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=Mr(this,e,[t])).subSymbolDefaultPixelSize=15,i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1015",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ar(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol1009),i=e,o&&vr(i.prototype,o),n&&vr(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function xr(t){"@babel/helpers - typeof";return(xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Or(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,wr(o.key),o)}}function wr(t){var e=function(t,e){if("object"!=xr(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=xr(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==xr(e)?e:e+""}function Cr(t,e,i){return e=Er(e),function(t,e){if(e&&("object"===xr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Er(t).constructor):e.apply(t,i))}function Er(t){return(Er=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ir(t,e){return(Ir=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1015=Tr;var Dr=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Cr(this,e,[t])).scaleValues.length&&i.scaleValues.push(.1),i.arrowHeadType=t.arrowHeadType?t.arrowHeadType:0,i.arrowBodyType=t.arrowBodyType?t.arrowBodyType:0,0==t.arrowTailType||null==t.arrowTailType?i.arrowTailType=3:i.arrowTailType=t.arrowTailType,i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol1016",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ir(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){var e={surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fillStyle:0,lineTypeLimit:!0,surroundLineLimit:!0};if(!this.isEdit){var i=this.getSubSymbolScaleValue();(i>.3||i<=0)&&(i=.3),this.scaleValues[0]=i}var o,n=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t)*this.scaleValues[0],l=2*Math.sqrt(n*n/3)/1.4,s=Math.sqrt(n*n/3),a=!1;this.arrowBodyType===SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_COATTAIL?o=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePtsBySingleLine(t,n,this.arrowBodyType,a):this.arrowHeadType===SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_TRIANGLE||this.arrowHeadType===SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_TRIANGLE_SOLID?(a=!0,o=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePtsBySingleLine(t,n,this.arrowBodyType,a)):this.arrowHeadType===SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_POLYLINE?o=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePtsBySingleLine(t,n,this.arrowBodyType,a):this.arrowHeadType===SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_COATTAIL_HOLLOW?(a=!0,o=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePtsBySingleLine(t,l,this.arrowBodyType,a)):this.arrowHeadType===SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_COATTAIL?(a=!0,o=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePtsBySingleLine(t,s,this.arrowBodyType,a)):o=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePtsBySingleLine(t,0,this.arrowBodyType,a);var r=[];this.arrowBodyType===SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_COATTAIL?(r.push(t[t.length-1]),r.push(t[t.length-2])):a?(r.push(t[t.length-1]),r.push(o[o.length-1])):(r.push(o[o.length-1]),r.push(o[o.length-2]));var u,p=SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePtsBySingleLine(r,n,this.arrowHeadType);if(o.length>1)if(this.arrowBodyType!==SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_COATTAIL)for(var h=this.mergeDashLine(this.dashLines,[]),c=this.computeDashLine(h,o),y=0;y<c.length;y++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,c[y]);else for(var g=0,f=o.length-1;g<f;g+=2){var d=SuperMapAlgoPlot.PlottingUtil.distance(o[g+1],o[g]),m=SuperMapAlgoPlot.PlottingUtil.radian(o[g+1],o[g])*SuperMapAlgoPlot.PlottingUtil.RTOD,S=SuperMapAlgoPlot.PlottingUtil.circlePoint(o[g+1],.3*d,.3*d,m+30),P=SuperMapAlgoPlot.PlottingUtil.circlePoint(o[g+1],.3*d,.3*d,m+330),b=SuperMapAlgoPlot.PlottingUtil.circlePoint(o[g],.3*d,.3*d,m+30),v=SuperMapAlgoPlot.PlottingUtil.circlePoint(o[g],.3*d,.3*d,m+330),L=[];L.push(S,o[g+1],P,v,o[g],b),this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,L,e)}u=this.arrowBodyType===SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_POLYBEZIER?SuperMapAlgoPlot.ArrowToolkit.generateArrowTailShapePtsBySingleLine([o[0],o[1]],n,this.arrowTailType):SuperMapAlgoPlot.ArrowToolkit.generateArrowTailShapePtsBySingleLine([t[0],t[1]],n,this.arrowTailType);var M=SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL;this.arrowHeadType!==SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_COATTAIL&&this.arrowHeadType!==SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_TRIANGLE_SOLID&&this.arrowHeadType!==SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_TRIANGLE&&this.arrowHeadType!==SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_COATTAIL_HOLLOW||(M=SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL),p.length>0&&this.addCell(M,p,e),u.length>0&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,u)}}}])&&Or(i.prototype,o),n&&Or(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Ur(t){"@babel/helpers - typeof";return(Ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rr(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Nr(o.key),o)}}function Nr(t){var e=function(t,e){if("object"!=Ur(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ur(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ur(e)?e:e+""}function Br(t,e,i){return e=kr(e),function(t,e){if(e&&("object"===Ur(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],kr(t).constructor):e.apply(t,i))}function kr(t){return(kr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Fr(t,e){return(Fr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1016=Dr;var jr=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Br(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.1),i.scaleValues.push(.2),i.scaleValues.push(0),i.scaleValues.push(.3),i.scaleValues.push(.3)),i.CLASS_NAME="SuperMap.Geometry.AlgoSymbol1017",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Fr(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){this.scalePoints=[];var e=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),i=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePts(e,this.scaleValues,SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_PARALLEL),o=i.arrowTouLen,n=i.leftBodyPts,l=i.rightBodyPts,s=[];s.push(n[n.length-1]),s.push(l[l.length-1]);var a=[];a.push(this.scaleValues[3]),a.push(this.scaleValues[4]),a.push(this.scaleValues[0]),a.push(this.scaleValues[1]);var r=SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePts(e,s,a,o,SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_WITHOUT_EAR),u=[];if((u=(u=(u=u.concat(n)).concat(r)).concat(l.reverse())).push(u[0]),0==this.dashLines.length)this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,u);else{for(var p=this.mergeDashLine(this.dashLines,[]),h=this.computeDashLine(p,n),c=1;c<h.length-1;c++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,h[c]);for(var y=this.mergeDashLine(this.dashLines,[]),g=this.computeDashLine(y,l),f=1;f<g.length-1;f++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,g[f].reverse());var d=[];d=(d=d.concat(g[0].reverse())).concat(h[0]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,d);var m=[];m=(m=(m=m.concat(h[h.length-1])).concat(r)).concat(g[g.length-1].reverse()),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,m)}var S=new SuperMapAlgoPlot.Point((s[0].x+s[1].x)/2,(s[0].y+s[1].y)/2),P=new SuperMapAlgoPlot.Point(S.x,S.y);P.isScalePoint=!0,P.tag=0,this.scalePoints.push(P);var b=new SuperMapAlgoPlot.Point(n[n.length-1].x,n[n.length-1].y);b.isScalePoint=!0,b.tag=1,this.scalePoints.push(b);var v=new SuperMapAlgoPlot.Point(r[0].x,r[0].y);v.isScalePoint=!0,v.tag=2,this.scalePoints.push(v),this.finish()}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints),o=new SuperMapAlgoPlot.Point(this.scalePoints[0].x,this.scalePoints[0].y),n=new SuperMapAlgoPlot.Point(this.scalePoints[1].x,this.scalePoints[1].y),l=new SuperMapAlgoPlot.Point(this.scalePoints[2].x,this.scalePoints[2].y);i=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(i).pts;var s=this.scaleValues[0],a=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i),r=a*s;if(0==t){var u=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,i[i.length-2],i[i.length-1]),p=u.projectPoint;if(u.isOnline){var h=SuperMapAlgoPlot.PlottingUtil.distance(p,i[i.length-1]);this.scaleValues[0]=h/a}}else if(1==t){var c=SuperMapAlgoPlot.PlottingUtil.intersectLines(o,n,l,i[i.length-1]);if(null!=c.intersectPoint){var y=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,n,c.intersectPoint).projectPoint,g=SuperMapAlgoPlot.PlottingUtil.distance(y,o);this.scaleValues[1]=g/r}var f=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,n,l).projectPoint,d=SuperMapAlgoPlot.PlottingUtil.distance(f,o);this.scaleValues[1]=d/r}else if(2==t){var m=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,i[1],l).projectPoint,S=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(m,o,i[1]),P=S.projectPoint,b=SuperMapAlgoPlot.PlottingUtil.distance(P,o);S.inOnline?this.scaleValues[4]=-b/r:this.scaleValues[4]=b/r}}this.calculateParts()}}])&&Rr(i.prototype,o),n&&Rr(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Vr(t){"@babel/helpers - typeof";return(Vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zr(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Yr(o.key),o)}}function Yr(t){var e=function(t,e){if("object"!=Vr(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Vr(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Vr(e)?e:e+""}function Gr(t,e,i){return e=Wr(e),function(t,e){if(e&&("object"===Vr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Wr(t).constructor):e.apply(t,i))}function Wr(t){return(Wr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Xr(t,e){return(Xr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1017=jr;var Hr=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=Gr(this,e,[t])).MAX_ARRAY_SIZE=128,i.sv1_DefaultAtLenDivAbLen=0,i.sv2_DefaultAjWidthDivAtLen=.148,i.sv3_DefaultAeWidthDivAtLen=.4,i.sv4_DefaultAeLenDivAtLen=.312,i.sv_AtScaleParameter=1.5,i.sv_AtLenDivAtWidth=1.35,i.sv_AtWidthDivAwWidth=.5,i.sv_defaultAwLenDivAbLen=.15,0===i.scaleValues.length&&(i.scaleValues.push(i.sv1_DefaultAtLenDivAbLen),i.scaleValues.push(i.sv2_DefaultAjWidthDivAtLen),i.scaleValues.push(i.sv3_DefaultAeWidthDivAtLen),i.scaleValues.push(i.sv4_DefaultAeLenDivAtLen)),i.CLASS_NAME="SuperMap.Geometry.AlgoSymbol1018",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xr(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init(),this.applyUse()}},{key:"applyUse",value:function(){var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length>=2&&t.length<this.minEditPts&&this.calAssistantLine(),!(t.length<3)){var e=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),i=this.arrowMeshs(e),o=SuperMapAlgoPlot.PlottingUtil.clonePoints(i.shapePts);(o=SuperMapAlgoPlot.PlottingUtil.clearSamePts(o)).push(o[0]);var n=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i.leftBodyPts),l=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i.rightBodyPts),s=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i.arrowHeadPts);if(0!=i.shapePts.length){var a=SuperMapAlgoPlot.PlottingUtil.polylineDistance(n),r=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.4*a,n),u=[],p=[],h=[];if(r.bfind)for(var c=0;c<=r.index;c++)u.push(n[c]);var y=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.45*a,n),g=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.8*a,n);if(y.bfind&&g.bfind)for(var f=y.index;f<=g.index;f++)p.push(n[f]);var d=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.85*a,n);if(d.bfind)for(var m=d.index;m<n.length;m++)h.push(n[m]);var S=SuperMapAlgoPlot.PlottingUtil.polylineDistance(l),P=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.15*S,l),b=[],v=[],L=[];if(P.bfind)for(var M=0;M<=P.index;M++)b.push(l[M]);var _=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.2*S,l),A=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.55*S,l);if(_.bfind&&A.bfind)for(var T=_.index;T<=A.index;T++)v.push(l[T]);var x=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.6*S,l);if(x.bfind)for(var O=x.index;O<l.length;O++)L.push(l[O]);var w=SuperMapAlgoPlot.PlottingUtil.clonePoints(s);w.splice(0,0,n[n.length-1]),w.push(l[0]),this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,o,{lineWidthLimit:!0,strokeWidth:0,weight:0,surroundLineFlag:!1}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,u,{surroundLineFlag:!1}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,p,{surroundLineFlag:!1}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,h,{surroundLineFlag:!1}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,b,{surroundLineFlag:!1}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,v,{surroundLineFlag:!1}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,L,{surroundLineFlag:!1}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,w,{surroundLineFlag:!1,lineTypeLimit:!0});var C=this.updateScalePoints(e);if(this.scalePoints=[],3!=C.length)C=[];else for(var E=0;E<C.length;E++)C[E].isScalePoint=!0,C[E].tag=E,this.scalePoints.push(C[E]);this.finish()}else this.finish()}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i),this.scaleValues.length<4&&(this.scaleValues.push(this.sv1_DefaultAtLenDivAbLen),this.scaleValues.push(this.sv2_DefaultAjWidthDivAtLen),this.scaleValues.push(this.sv3_DefaultAeWidthDivAtLen),this.scaleValues.push(this.sv4_DefaultAeLenDivAtLen));var o=i.length;if(o<=2)return;var n,l,s,a,r=this.operateCtrlPts(i);o=r.length,o--;var u=this.calcScaleValueCount(i.length);if(this.scaleValues.length<u){var p=this.calcDefaultScaleValues(o);n=p[0],l=p[1],s=p[2],a=p[3]}else n=this.scaleValues[0],l=this.scaleValues[1],s=this.scaleValues[2],a=this.scaleValues[3];for(var h=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i),c=[],y=0;y<this.scalePoints.length;y++)c.push(this.scalePoints[y].clone());if(0==c.length)return;c[t]=e.clone();var g,f,d=o-1;g=o<=3?new SuperMapAlgoPlot.Point((r[0].x+r[1].x)/2,(r[0].y+r[1].y)/2):r[d-1].clone();var m,S,P,b,v,L,M=new SuperMapAlgoPlot.Point(0,0),_=new SuperMapAlgoPlot.Point(0,0),A=new SuperMapAlgoPlot.Point(0,0);SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(0,3,g,r[d],r[d+1],_,A),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,r[o],r[o-1],A,M),f=M.clone();var T=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(r[o],f,c[2]);m=T.dLen1,T.dLen2,0==m&&(m=.1),S=m,n=(m/=a+1)/h,1==t?(b=(T=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(r[o],f,c[1])).dLen1,s=(v=T.dLen2)/m,a=(b-m)/m):0==t?(m=(T=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(r[o],f,c[0])).dLen1,l=(P=T.dLen2)/m,(L=SuperMapAlgoPlot.PlottingUtil.distance(r[o],r[o-1]))<2*m&&(m=.5*L),b=(T=SuperMapAlgoPlot.PlottingUtil.triangleHeightAndPartBottomLen(r[o],f,c[1])).dLen1,s=(v=T.dLen2)/m,(a=(S-m)/m)<.1&&(s=v/(m=S/(1+(a=.1))),l=P/m),n=m/h):2==t&&(n=m/h),P=m*l,(L=SuperMapAlgoPlot.PlottingUtil.distance(r[o],r[o-1]))<2*m&&(P=(m=.5*L)*l,n=m/h),this.scaleValues[0]=n,this.scaleValues[1]=l,this.scaleValues[2]=s,this.scaleValues[3]=a}this.calculateParts()}},{key:"arrowMeshs",value:function(t){var e=[],i=[],o=[],n=[],l=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),s=SuperMapAlgoPlot.ArrowToolkit.generateArrowBodyShapePts(l,this.scaleValues,SuperMapAlgoPlot.ArrowToolkit.ArrowBodyType.ARROWBODY_MULTIPOLYBEZIER),a=s.arrowTouLen,r=s.leftBodyPts,u=s.rightBodyPts;if(!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(a,0)){var p=[];p.push(r[r.length-1]),p.push(u[u.length-1]);var h=[];h.push(this.scaleValues[2]),h.push(this.scaleValues[3]),h.push(0),h.push(0);for(var c=SuperMapAlgoPlot.ArrowToolkit.generateArrowHeadShapePts(l,p,h,a,SuperMapAlgoPlot.ArrowToolkit.ArrowHeadType.ARROWHEAD_WITH_EAR),y=0;y<r.length;y++)e.push(r[y]),i.push(r[y]);for(var g=0;g<c.length;g++)e.push(c[g]),n.push(c[g]);for(var f=u.length-1;f>=0;f--)e.push(u[f]),o.push(u[f])}return{shapePts:e,leftBodyPts:i,rightBodyPts:o,arrowHeadPts:n}}},{key:"updateScalePoints",value:function(t){var e=t.length,i=[];if(!(e<3)){var o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t);if(!SuperMapAlgoPlot.PlottingUtil.equalFuzzy(o,0)){var n=this.operateCtrlPts(t);e=n.length,e--;for(var l=[],s=0;s<this.scaleValues.length;s++)l.push(this.scaleValues[s]);var a=this.genArrowBodyPts(o,n,l),r=a.ArrowBodyCenterPts,u=this.genAtPts(e,r,l,a.ArrowTouLen),p=this.calc3rdScalePt(e,r,l,a.ArrowTouLen);return i.push(new SuperMapAlgoPlot.Point(a.LeftBodyPtsTemp[e].x,a.LeftBodyPtsTemp[e].y)),i.push(new SuperMapAlgoPlot.Point(u[2].x,u[2].y)),i.push(new SuperMapAlgoPlot.Point(p.x,p.y)),i}}}},{key:"operateCtrlPts",value:function(t){var e=SuperMapAlgoPlot.PlottingUtil.clonePoints(t);if(3===e.length){var i=((e[0].x+e[1].x)/2+e[2].x)/2,o=((e[0].y+e[1].y)/2+e[2].y)/2,n=new SuperMapAlgoPlot.Point(i,o),l=e[2];e[2]=n,e.push(l)}return e}},{key:"genArrowBodyPts",value:function(t,e,i){var o,n,l,s=[],a=[],r=[],u=[],p=[],h=[],c=e.length;if(c--,i.length<this.calcScaleValueCount(c)){var y=this.calcDefaultScaleValues(c);n=y[0],l=y[1]}else n=i[0],l=i[1];var g=SuperMapAlgoPlot.PlottingUtil.clonePoints(e),f=(g[0].x+g[1].x)/2,d=(g[0].y+g[1].y)/2,m=Math.abs(f-g[2].x),S=Math.abs(d-g[2].y),P=0;if(m>0&&S>0){var b=1/(f-g[2].x),v=-1/(d-g[2].y),L=1*g[2].y/(d-g[2].y)-1*g[2].x/(f-g[2].x);P=Math.abs(b*g[0].x+v*g[0].y+L)/Math.sqrt(b*b+v*v)}else S<=1e-4?P=Math.abs(d-g[1].y):m<=1e-4&&(P=Math.abs(f-g[1].x));var M=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(P,g[2],new SuperMapAlgoPlot.Point(f,d)),_=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(g[1],g[2],g[0]);_?(s[1]=g[1],a[1]=g[0]):(s[1]=g[0],a[1]=g[1]),g[1]=new SuperMapAlgoPlot.Point((g[0].x+g[1].x)/2,(g[0].y+g[1].y)/2);var A=Math.sqrt((M.pntLeft.x-M.pntRight.x)*(M.pntLeft.x-M.pntRight.x)+(M.pntLeft.y-M.pntRight.y)*(M.pntLeft.y-M.pntRight.y))*this.sv_AtWidthDivAwWidth,T=(o=A*this.sv_AtLenDivAtWidth)*l;SuperMapAlgoPlot.PlottingUtil.equalFuzzy(n,0)||(T=(o=t*n)*l);var x,O,w=SuperMapAlgoPlot.PlottingUtil.distance(g[c],g[c-1]),C=2*o;w<C&&(T=(o=w/2)*l),g.push(g[c].clone()),x=0,O=0;var E=0,I=[];for(E=2;E<=c;E++)x+=SuperMapAlgoPlot.PlottingUtil.distance(g[E],g[E-1]);for(x-=o,E=2;E<=c-1;E++)O+=SuperMapAlgoPlot.PlottingUtil.distance(g[E],g[E-1]),I[E]=T+(A-T)*Math.pow((x-O)/x,this.sv_AtScaleParameter);I[c]=T;var D,U,R=new SuperMapAlgoPlot.Point(0,0),N=new SuperMapAlgoPlot.Point(0,0),B=new SuperMapAlgoPlot.Point(0,0);for(E=2;E<=c-1;E++)SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(0,3,g[E-1],g[E],g[E+1],N,B),E==c-1&&SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,g[c],g[c-1],B,R),D=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(I[E],N,g[E]),(_=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(B,N,D.pntRight))?(s[E]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y),a[E]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y)):(s[E]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y),a[E]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y));for(Math.sqrt(1*(g[c].x-R.x)*(g[c].x-R.x)+1*(g[c].y-R.y)*(g[c].y-R.y))>0&&(g[c]=SuperMapAlgoPlot.PlottingUtil.getIncentrePointOnSegmentByScale(o,g[c],R)),D=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(T,g[c+1],g[c]),(_=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(g[c],g[c+1],D.pntLeft))?(a[c]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y),s[c]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y)):(a[c]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y),s[c]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y)),E=2;E<c;E++)SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(3,3,s[E-1],s[E],s[E+1],N,B),r[E]=new SuperMapAlgoPlot.Point(N.x,N.y),u[E]=new SuperMapAlgoPlot.Point(B.x,B.y),SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(3,3,a[E-1],a[E],a[E+1],N,B),p[E]=new SuperMapAlgoPlot.Point(N.x,N.y),h[E]=new SuperMapAlgoPlot.Point(B.x,B.y),2==E&&(SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,s[1],s[2],r[2],R),u[E]=new SuperMapAlgoPlot.Point(R.x,R.y),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.5,a[1],a[2],p[2],R),h[E]=new SuperMapAlgoPlot.Point(R.x,R.y)),E==c-1&&(C=(w=SuperMapAlgoPlot.PlottingUtil.distance(s[c],s[c-1]))/3,(U=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(C,g[c],g[c+1])).x+=s[c].x-g[c].x,U.y+=s[c].y-g[c].y,C=(w=A-T)*Math.pow(C/x,this.sv_AtScaleParameter),D=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(C,s[c],U),r[c]=new SuperMapAlgoPlot.Point(D.pntLeft.x,D.pntLeft.y),C=(w=SuperMapAlgoPlot.PlottingUtil.distance(a[c],a[c-1]))/3,(U=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(C,g[c],g[c+1])).x+=a[c].x-g[c].x,U.y+=a[c].y-g[c].y,C=(w=A-T)*Math.pow(C/x,this.sv_AtScaleParameter),D=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(C,a[c],U),p[c]=new SuperMapAlgoPlot.Point(D.pntRight.x,D.pntRight.y));return{ArrowBodyCenterPts:SuperMapAlgoPlot.PlottingUtil.clonePoints(g),LeftBodyPtsTemp:s,RightBodyPtsTemp:a,LeftBodyPtsLeftCtrlPts:r,LeftBodyPtsRightCtrlPts:u,RightBodyPtsLeftCtrlPts:p,RightBodyPtsRightCtrlPts:h,ArrowTouLen:o}}},{key:"calcScaleValueCount",value:function(){return 4}},{key:"calcDefaultScaleValues",value:function(){var t=[];return t.push(this.sv1_DefaultAtLenDivAbLen),t.push(this.sv2_DefaultAjWidthDivAtLen),t.push(this.sv3_DefaultAeWidthDivAtLen),t.push(this.sv4_DefaultAeLenDivAtLen),t}},{key:"genAtPts",value:function(t,e,i,o){var n=i[2],l=[],s=o*i[3],a=SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(s,e[t],e[t+1]);s=o*n;var r=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(s,e[t+1],a);return l.push(new SuperMapAlgoPlot.Point(r.pntLeft.x,r.pntLeft.y)),l.push(e[t+1]),l.push(new SuperMapAlgoPlot.Point(r.pntRight.x,r.pntRight.y)),l}},{key:"calc3rdScalePt",value:function(t,e,i,o){var n=o*i[3];return SuperMapAlgoPlot.PlottingUtil.getExcentrePointOnSegmentByScale(n,e[t],e[t+1])}}])&&zr(i.prototype,o),n&&zr(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Zr(t){"@babel/helpers - typeof";return(Zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Jr(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,qr(o.key),o)}}function qr(t){var e=function(t,e){if("object"!=Zr(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Zr(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Zr(e)?e:e+""}function Kr(t,e,i){return e=Qr(e),function(t,e){if(e&&("object"===Zr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Qr(t).constructor):e.apply(t,i))}function Qr(t){return(Qr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $r(t,e){return($r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1018=Hr;var tu=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Kr(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.5),i.scaleValues.push(.222222),i.scaleValues.push(.5),i.scaleValues.push(.5),i.scaleValues.push(.5)),i.CLASS_NAME="SuperMap.Geometry.AlgoSymbol1019",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$r(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts,0==this.scaleValues.length&&(this.scaleValues=[],this.scaleValues.push(.5),this.scaleValues.push(.222222),this.scaleValues.push(.5),this.scaleValues.push(.5),this.scaleValues.push(.5));var e=t[0].clone(),i=t[1].clone(),o=SuperMapAlgoPlot.PlottingUtil.distance(e,i),n=this.scaleValues[0],l=new SuperMapAlgoPlot.Point(0,-o*n),s=new SuperMapAlgoPlot.Point(0,o*n),a=this.scaleValues[1],r=this.scaleValues[3],u=new SuperMapAlgoPlot.Point(o*(1-r),-o*a),p=new SuperMapAlgoPlot.Point(o*(1-r),o*a),h=this.scaleValues[2],c=this.scaleValues[4],y=new SuperMapAlgoPlot.Point(o*(1-c),-o*h),g=new SuperMapAlgoPlot.Point(o*(1-c),o*h),f=new SuperMapAlgoPlot.Point(o,0),d=SuperMapAlgoPlot.PlottingUtil.radian(e,i),m=[];m.push(l),m.push(u),m.push(y),m.push(f),m.push(g),m.push(p),m.push(s),m.push(l);for(var S=[],P=0;P<m.length;P++){var b=SuperMapAlgoPlot.PlottingUtil.coordinateTrans(e,m[P],d*SuperMapAlgoPlot.PlottingUtil.RTOD);S.push(b)}for(var v=[],L=S.length-1;L>=0;--L)v.push(S[L]);if(0==this.dashLines.length)this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,v,{lineWidthLimit:!0,strokeWidth:0,weight:0,surroundLineFlag:!1}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,[v[2],v[1],v[7],v[6]],{surroundLineFlag:!1}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,[v[6],v[5],v[4],v[3],v[2]],{lineTypeLimit:!0,surroundLineFlag:!1});else{var M=[];M.push(v[0]),M.push(v[1]);for(var _=this.mergeDashLine(this.dashLines,[]),A=this.computeDashLine(_,M),T=0;T<A.length-1;T++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,A[T]);M.push(v[v.length-1]),M.push(v[v.length-2]);for(var x=this.mergeDashLine(this.dashLines,[]),O=this.computeDashLine(x,[]),w=0;w<O.length-1;w++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,O[w].reverse());var C=[];C=(C=C.concat(O[0].reverse())).concat(A[0]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,C);var E=[];E=E.concat(A[A.length-1]);for(var I=1;I<v.length-1;I++)E.push(v[I]);E=E.concat(O[O.length-1].reverse()),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,E)}this.scalePoints=[];var D=S[0].clone();D.isScalePoint=!0,D.tag=0,this.scalePoints.push(D);var U=S[1].clone();U.isScalePoint=!0,U.tag=1,this.scalePoints.push(U);var R=S[2].clone();R.isScalePoint=!0,R.tag=2,this.scalePoints.push(R),this.scalePoints=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(this.scalePoints),this.finish()}}},{key:"modifyPoint",value:function(t,e){if(e.isScalePoint&&(t>=0||t<3)){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i),i=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(i).pts;var o=SuperMapAlgoPlot.PlottingUtil.distance(i[0],i[1]),n=i[0].clone(),l=i[1].clone(),s=e.clone();if(0==t){var a=SuperMapAlgoPlot.PlottingUtil.distance(s,n)/o;this.scaleValues[0]=a}else if(1==t){var r=SuperMapAlgoPlot.PlottingUtil.projectPoint(s,n,l),u=SuperMapAlgoPlot.PlottingUtil.distance(r,s)/o;this.scaleValues[1]=u;var p=SuperMapAlgoPlot.PlottingUtil.distance(r,l)/o;this.scaleValues[3]=p}else if(2==t){var h=SuperMapAlgoPlot.PlottingUtil.projectPoint(s,n,l),c=SuperMapAlgoPlot.PlottingUtil.distance(h,s)/o;this.scaleValues[2]=c;var y=SuperMapAlgoPlot.PlottingUtil.distance(h,l)/o;this.scaleValues[4]=y}}this.calculateParts()}}])&&Jr(i.prototype,o),n&&Jr(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function eu(t){"@babel/helpers - typeof";return(eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function iu(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,ou(o.key),o)}}function ou(t){var e=function(t,e){if("object"!=eu(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=eu(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==eu(e)?e:e+""}function nu(t,e,i){return e=lu(e),function(t,e){if(e&&("object"===eu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],lu(t).constructor):e.apply(t,i))}function lu(t){return(lu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function su(t,e){return(su=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1019=tu;var au=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=nu(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.5),i.scaleValues.push(.222222),i.scaleValues.push(.5),i.scaleValues.push(.5),i.scaleValues.push(.5)),i.CLASS_NAME="SuperMap.Geometry.AlgoSymbol1020",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&su(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts,0==this.scaleValues.length&&(this.scaleValues=[],this.scaleValues.push(.5),this.scaleValues.push(.222222),this.scaleValues.push(.5),this.scaleValues.push(.5),this.scaleValues.push(.5));var e=t[0].clone(),i=t[1].clone(),o=SuperMapAlgoPlot.PlottingUtil.distance(e,i),n=this.scaleValues[0],l=new SuperMapAlgoPlot.Point(0,-o*n),s=new SuperMapAlgoPlot.Point(0,o*n),a=this.scaleValues[1],r=this.scaleValues[3],u=new SuperMapAlgoPlot.Point(o*(1-r),-o*a),p=new SuperMapAlgoPlot.Point(o*(1-r),o*a),h=this.scaleValues[2],c=this.scaleValues[4],y=new SuperMapAlgoPlot.Point(o*(1-c),-o*h),g=new SuperMapAlgoPlot.Point(o*(1-c),o*h),f=new SuperMapAlgoPlot.Point(o,0),d=SuperMapAlgoPlot.PlottingUtil.radian(e,i),m=SuperMapAlgoPlot.PlottingUtil.distance(l,u),S=SuperMapAlgoPlot.PlottingUtil.findPointInLine(l,u,.3*m),P=SuperMapAlgoPlot.PlottingUtil.findPointInLine(l,u,.4*m),b=SuperMapAlgoPlot.PlottingUtil.distance(p,s),v=SuperMapAlgoPlot.PlottingUtil.findPointInLine(p,s,.6*b),L=SuperMapAlgoPlot.PlottingUtil.findPointInLine(p,s,.7*b),M=[];M.push(l),M.push(S),M.push(P),M.push(u),M.push(y),M.push(f),M.push(g),M.push(p),M.push(v),M.push(L),M.push(s);for(var _=[],A=0;A<M.length;A++){var T=SuperMapAlgoPlot.PlottingUtil.coordinateTrans(e,M[A],d*SuperMapAlgoPlot.PlottingUtil.RTOD);_.push(T)}for(var x=[],O=_.length-1;O>=0;--O)x.push(_[O]);var w=SuperMapAlgoPlot.PlottingUtil.clonePoints(x);w.push(w[0]),this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,w,{lineWidthLimit:!0,strokeWidth:0,weight:0,surroundLineFlag:!1}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,[x[0],x[1]]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,[x[2],x[3]]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,[x[3],x[4],x[5],x[6],x[7]],{lineTypeLimit:!0}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,[x[7],x[8]]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,[x[9],x[10]]),this.scalePoints=[];var C=_[0].clone();C.isScalePoint=!0,C.tag=0,this.scalePoints.push(C);var E=_[3].clone();E.isScalePoint=!0,E.tag=1,this.scalePoints.push(E);var I=_[4].clone();I.isScalePoint=!0,I.tag=2,this.scalePoints.push(I),this.scalePoints=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(this.scalePoints),this.finish()}}},{key:"modifyPoint",value:function(t,e){if(e.isScalePoint&&(t>=0||t<3)){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i),i=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(i).pts;var o=SuperMapAlgoPlot.PlottingUtil.distance(i[0],i[1]),n=i[0].clone(),l=i[1].clone(),s=e.clone();if(0==t){var a=SuperMapAlgoPlot.PlottingUtil.distance(s,n)/o;this.scaleValues[0]=a}else if(1==t){var r=SuperMapAlgoPlot.PlottingUtil.projectPoint(s,n,l),u=SuperMapAlgoPlot.PlottingUtil.distance(r,s)/o;this.scaleValues[1]=u;var p=SuperMapAlgoPlot.PlottingUtil.distance(r,l)/o;this.scaleValues[3]=p}else if(2==t){var h=SuperMapAlgoPlot.PlottingUtil.projectPoint(s,n,l),c=SuperMapAlgoPlot.PlottingUtil.distance(h,s)/o;this.scaleValues[2]=c;var y=SuperMapAlgoPlot.PlottingUtil.distance(h,l)/o;this.scaleValues[4]=y}}this.calculateParts()}}])&&iu(i.prototype,o),n&&iu(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function ru(t){"@babel/helpers - typeof";return(ru="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function uu(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,pu(o.key),o)}}function pu(t){var e=function(t,e){if("object"!=ru(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=ru(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ru(e)?e:e+""}function hu(t,e,i){return e=cu(e),function(t,e){if(e&&("object"===ru(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],cu(t).constructor):e.apply(t,i))}function cu(t){return(cu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function yu(t,e){return(yu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1020=au;var gu=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=hu(this,e,[t])).CLASS_NAME="SuperMap.Geometry.AlgoSymbol1021",i.QIANJI_RATE1=9,i.QIANJI_RATE2=20,i.QIANJI_RATE4=5,i.QIANJI_RATE3=1/3,i.QIANJI_TAIL_RATE1=8,i.QIANJI_TAIL_RATE2=3,i.QIANJI_TAIL_RATE3=.6,i.SV1_Default=.25,i.SV1_MinValue=0,i.SV1_MaxValue=.5,i.DEFAULT_ARROW_TAIL_POS=.4,i.SCALE_VALUE_COUNT=1,i.MIN_LEN_LeftToRightCenter=1e-7,i.SCALE_AT=1/3,i.SCALE_ATAJ=1/7,i.SCALE_ATAE=1/3,i.SCALE_AW=2/3,i.SCALE_ATAJctrlDefSide=.8,i.SCALE_ATAJctrlSameSide=2/3,i.SCALE_MM_LEFT=.25,i.SCALE_MM_RIGHT=.75,i.BEZIER_K1=1/3,i.QIANJI_OPERATE_RATE1=1,i.SV2_Default=1,0===i.scaleValues.length&&(i.scaleValues=[],i.scaleValues.push(i.SV1_Default),i.scaleValues.push(i.SV2_Default),i.scaleValues.push(i.SV2_Default),i.scaleValues.push(i.SV2_Default),i.scaleValues.push(i.SV2_Default)),i.m_dMaxDis=0,i.m_bIsAnimation=!1,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yu(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol1006),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t),this.components.length=0,this.m_scalePoints=[],(t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts).length>=2&&t.length<this.minEditPts&&this.calAssistantLine(),!(t.length<3)){0==this.scaleValues?(this.scaleValues=[],this.scaleValues.push(this.SV1_Default),this.scaleValues.push(this.SV2_Default),this.scaleValues.push(this.SV2_Default),this.scaleValues.push(this.SV2_Default),this.scaleValues.push(this.SV2_Default)):1==this.scaleValues.length&&(this.scaleValues.push(this.SV2_Default),this.scaleValues.push(this.SV2_Default),this.scaleValues.push(this.SV2_Default),this.scaleValues.push(this.SV2_Default));var e=SuperMapAlgoPlot.PlottingUtil.clonePoints(t),i=this.arrowMeshs(e),o=i.shapePts,n=i.LeftArowLeftBody,l=i.LeftArowHead,s=i.LeftArowRightBody,a=i.RightArowLeftBody,r=i.RightArowHead,u=i.RightArowRightBody;if(!(o.length<=0)){var p=SuperMapAlgoPlot.PlottingUtil.polylineDistance(n),h=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.4*p,n),c=[],y=[];if(h.bfind)for(var g=0;g<=h.index;g++)c.push(n[g]);"888"!=this.style.lineSymbolID&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,c);var f=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.5*p,n);if(f.bfind)for(var d=f.index;d<n.length;d++)y.push(n[d]);A=(A=(A=(A=[]).concat(y)).concat(l)).concat(s),"888"!=this.style.lineSymbolID&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,A);var m=SuperMapAlgoPlot.PlottingUtil.polylineDistance(a),S=SuperMapAlgoPlot.PlottingUtil.polylineDistance(u),P=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.4*m,a),b=[],v=[];if(P.bfind)for(var L=0;L<=P.index;L++)b.push(a[L]);"888"!=this.style.lineSymbolID&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,b);var M=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.5*m,a);if(M.bfind)for(var _=M.index;_<a.length-1;_++)v.push(a[_]);var A,T=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.4*S,u),x=[],O=[];if(T.bfind)for(var w=0;w<=T.index;w++)x.push(u[w]);A=(A=(A=(A=[]).concat(v)).concat(r)).concat(x),"888"!=this.style.lineSymbolID&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,A);var C=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(.5*S,u);if(C.bfind)for(var E=C.index;E<u.length-1;E++)O.push(u[E]);"888"!=this.style.lineSymbolID&&this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,O),this.scalePoints=[];for(var I=0;I<this.m_scalePoints.length;I++)this.m_scalePoints[I].isScalePoint=!0,this.m_scalePoints[I].tag=I,this.addScalePoint(this.m_scalePoints[I]);this.finish()}}}},{key:"arrowMeshs",value:function(t){var e=new SuperMapAlgoPlot.Path2D;t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts;var i=[];this.m_bIsAnimation&&4==t.length?i=SuperMapAlgoPlot.PlottingUtil.clonePoints(t):(i=SuperMapAlgoPlot.PlottingUtil.operateControlPoints(t),void 0!==t[0].z&&(i[i.length-1].z=i[i.length-2].z));var o=this.scaleValues[0],n=this.scaleValues[1],l=this.scaleValues[2],s=this.scaleValues[3],a=this.scaleValues[4],r=SuperMapAlgoPlot.PlottingUtil.distance(i[0],i[3]),u=SuperMapAlgoPlot.PlottingUtil.distance(i[1],i[2]),p=(i[0].clone(),i[1].clone()),h=.5*(i[0].x+i[3].x),c=.5*(i[0].y+i[3].y),y=new SuperMapAlgoPlot.Point(h,c),g=.5*(i[1].x+i[2].x),f=.5*(i[1].y+i[2].y),d=new SuperMapAlgoPlot.Point(g,f),m=SuperMapAlgoPlot.PlottingUtil.distance(y,d);m<this.MIN_LEN_LeftToRightCenter&&(m=this.MIN_LEN_LeftToRightCenter),y.x=h+r*(h-g)/(m*this.QIANJI_RATE1*n),y.y=c+r*(c-f)/(m*this.QIANJI_RATE1*l),d.x=g+u*(g-h)/(m*this.QIANJI_RATE1*s),d.y=f+u*(f-c)/(m*this.QIANJI_RATE1*a),this.m_scalePoints.push(new SuperMapAlgoPlot.Point(y.x,y.y)),this.m_scalePoints.push(new SuperMapAlgoPlot.Point(d.x,d.y));var S=new SuperMapAlgoPlot.Point(0,0),P=new SuperMapAlgoPlot.Point(0,0);S.x=h+r*(h-g)/(m*this.QIANJI_RATE2*n),S.y=c+r*(c-f)/(m*this.QIANJI_RATE2*l),P.x=g+u*(g-h)/(m*this.QIANJI_RATE2*s),P.y=f+u*(f-c)/(m*this.QIANJI_RATE2*a);var b=new SuperMapAlgoPlot.Point((i[0].x+i[1].x)/2,(i[0].y+i[1].y)/2),v=new SuperMapAlgoPlot.Point((i[2].x+i[3].x)/2,(i[2].y+i[3].y)/2),L=i[3].x-(i[3].x-y.x)*this.SCALE_AT,M=i[3].y-(i[3].y-y.y)*this.SCALE_AT,_=i[2].x-(i[2].x-d.x)*this.SCALE_AT,A=i[2].y-(i[2].y-d.y)*this.SCALE_AT,T=new SuperMapAlgoPlot.Point(0,0),x=new SuperMapAlgoPlot.Point(0,0),O=new SuperMapAlgoPlot.Point(0,0),w=new SuperMapAlgoPlot.Point(0,0);x.x=L-(M-i[3].y)*this.SCALE_ATAJ,x.y=M+(L-i[3].x)*this.SCALE_ATAJ,T.x=L+(M-i[3].y)*this.SCALE_ATAJ,T.y=M-(L-i[3].x)*this.SCALE_ATAJ,w.x=_-(A-i[2].y)*this.SCALE_ATAJ,w.y=A+(_-i[2].x)*this.SCALE_ATAJ,O.x=_+(A-i[2].y)*this.SCALE_ATAJ,O.y=A-(_-i[2].x)*this.SCALE_ATAJ;var C=new SuperMapAlgoPlot.Point(0,0),E=new SuperMapAlgoPlot.Point(0,0),I=new SuperMapAlgoPlot.Point(0,0),D=new SuperMapAlgoPlot.Point(0,0);C.x=3*T.x-2*L-(i[3].x-L)*this.SCALE_ATAE,C.y=3*T.y-2*M-(i[3].y-M)*this.SCALE_ATAE,E.x=3*x.x-2*L-(i[3].x-L)*this.SCALE_ATAE,E.y=3*x.y-2*M-(i[3].y-M)*this.SCALE_ATAE,I.x=3*O.x-2*_-(i[2].x-_)*this.SCALE_ATAE,I.y=3*O.y-2*A-(i[2].y-A)*this.SCALE_ATAE,D.x=3*w.x-2*_-(i[2].x-_)*this.SCALE_ATAE,D.y=3*w.y-2*A-(i[2].y-A)*this.SCALE_ATAE,y.x=h+r*(h-g)/(m*this.QIANJI_RATE4*n),y.y=c+r*(c-f)/(m*this.QIANJI_RATE4*l),d.x=g+u*(g-h)/(m*this.QIANJI_RATE4*s),d.y=f+u*(f-c)/(m*this.QIANJI_RATE4*a);var U=new SuperMapAlgoPlot.Point(0,0);U.x=i[0].x+(y.x-i[0].x)*this.SCALE_AW,U.y=i[0].y+(y.y-i[0].y)*this.SCALE_AW;var R=new SuperMapAlgoPlot.Point(0,0);R.x=i[1].x+(d.x-i[1].x)*this.SCALE_AW,R.y=i[1].y+(d.y-i[1].y)*this.SCALE_AW;var N=new SuperMapAlgoPlot.Point(0,0);N.x=T.x+(y.x-T.x)*this.SCALE_ATAJctrlSameSide,N.y=T.y+(y.y-T.y)*this.SCALE_ATAJctrlSameSide;var B=new SuperMapAlgoPlot.Point(0,0);B.x=w.x+(d.x-w.x)*this.SCALE_ATAJctrlSameSide,B.y=w.y+(d.y-w.y)*this.SCALE_ATAJctrlSameSide;var k=new SuperMapAlgoPlot.Point(0,0);k.x=x.x+(S.x-x.x)*this.SCALE_ATAJctrlDefSide,k.y=x.y+(S.y-x.y)*this.SCALE_ATAJctrlDefSide;var F=new SuperMapAlgoPlot.Point(0,0);F.x=O.x+(P.x-O.x)*this.SCALE_ATAJctrlDefSide,F.y=O.y+(P.y-O.y)*this.SCALE_ATAJctrlDefSide;var j=new SuperMapAlgoPlot.Point(0,0);j.x=b.x+(v.x-b.x)*o,j.y=b.y+(v.y-b.y)*o,this.m_scalePoints.push(new SuperMapAlgoPlot.Point(j.x,j.y));var V=new SuperMapAlgoPlot.Point(0,0),z=new SuperMapAlgoPlot.Point(0,0);V.x=i[0].x+(i[3].x-i[0].x)*o,V.y=i[0].y+(i[3].y-i[0].y)*o,z.x=i[1].x+(i[2].x-i[1].x)*o,z.y=i[1].y+(i[2].y-i[1].y)*o,V.x=V.x+(j.x-V.x)*this.QIANJI_RATE3,V.y=V.y+(j.y-V.y)*this.QIANJI_RATE3,z.x=z.x+(j.x-z.x)*this.QIANJI_RATE3,z.y=z.y+(j.y-z.y)*this.QIANJI_RATE3;var Y=[];Y.push(i[0].clone()),Y.push(U.clone()),Y.push(N.clone()),Y.push(T.clone()),e.MoveTo(Y[0]),e.CurveTo(Y[1],Y[2],Y[3]);var G,W=[],X=[],H=[],Z=[],J=[],q=[],K=[];for(e.ToSubPathPolygons(K),K.length>0&&(W=W.concat(K[0]),G=K[0].length),e.LineTo(C),e.LineTo(i[3]),e.LineTo(E),(Y=[]).push(x),Y.push(k),Y.push(V),Y.push(j),e.LineTo(Y[0]),K=[],e.ToSubPathPolygons(K);G<K[0].length;G++)X.push(K[0][G]);for(G=K[0].length,e.CurveTo(Y[1],Y[2],Y[3]),K=[],e.ToSubPathPolygons(K);G<K[0].length;G++)H.push(K[0][G]);for(G=K[0].length,(Y=[]).push(z),Y.push(F),Y.push(O),e.CurveTo(Y[0],Y[1],Y[2]),K=[],e.ToSubPathPolygons(K);G<K[0].length;G++)Z.push(K[0][G]);for(G=K[0].length,e.LineTo(I),e.LineTo(i[2]),e.LineTo(D),(Y=[]).push(w),Y.push(B),Y.push(R),Y.push(p),e.LineTo(Y[0]),K=[],e.ToSubPathPolygons(K);G<K[0].length;G++)J.push(K[0][G]);for(G=K[0].length,e.CurveTo(Y[1],Y[2],Y[3]),K=[],e.ToSubPathPolygons(K);G<K[0].length;G++)q.push(K[0][G]);return K=[],e.ToSubPathPolygons(K),{shapePts:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(K[0]),LeftArowLeftBody:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(W),LeftArowHead:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(X),LeftArowRightBody:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(H),RightArowLeftBody:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(Z),RightArowHead:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(J),RightArowRightBody:SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(q)}}}])&&uu(i.prototype,o),n&&uu(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function fu(t){"@babel/helpers - typeof";return(fu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function du(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,mu(o.key),o)}}function mu(t){var e=function(t,e){if("object"!=fu(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=fu(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==fu(e)?e:e+""}function Su(t,e,i){return e=Pu(e),function(t,e){if(e&&("object"===fu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Pu(t).constructor):e.apply(t,i))}function Pu(t){return(Pu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function bu(t,e){return(bu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1021=gu;var vu=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Su(this,e,[t])).scaleValues.length&&i.scaleValues.push(.05),i.CLASS_NAME="SuperMap.Geometry.AlgoSymbol1022",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bu(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){t=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(t).pts;var e=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t),i=e*this.scaleValues[0],o=SuperMapAlgoPlot.PlottingUtil.paraLine(t,i,!0),n=SuperMapAlgoPlot.PlottingUtil.paraLine(t,i,!1),l=SuperMapAlgoPlot.PlottingUtil.findPointInLine(o[0],o[1],.6*e),s=SuperMapAlgoPlot.PlottingUtil.findPointInLine(o[0],o[1],.5*e),a=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(.1*e,o[0],s).pntLeft;this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,[a,l,o[1]],{surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0,lineTypeLimit:!0,surroundLineLimit:!0});var r=SuperMapAlgoPlot.PlottingUtil.findPointInLine(n[0],n[1],.4*e),u=SuperMapAlgoPlot.PlottingUtil.findPointInLine(n[0],n[1],.5*e),p=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(.1*e,n[0],u).pntRight;this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,[p,r,n[0]],{surroundLineFlag:!1,fillLimit:!0,fillColorLimit:!1,fill:!0,lineTypeLimit:!0,surroundLineLimit:!0}),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,o),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,[n[1],n[0]]),this.leftPoint=SuperMapAlgoPlot.ArrowToolkit.afterPtsCrossZone(o),this.addScalePoint(o[0],0),this.finish()}}},{key:"modifyPoint",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i),i=SuperMapAlgoPlot.ArrowToolkit.beforePtsCrossZone(i).pts;var o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i);if(0===t){var n=SuperMapAlgoPlot.PlottingUtil.distance(i[0],e)/o;this.scaleValues[0]=n}}this.calculateParts()}}])&&du(i.prototype,o),n&&du(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Lu(t){"@babel/helpers - typeof";return(Lu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mu(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,_u(o.key),o)}}function _u(t){var e=function(t,e){if("object"!=Lu(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Lu(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Lu(e)?e:e+""}function Au(t,e,i){return e=xu(e),function(t,e){if(e&&("object"===Lu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],xu(t).constructor):e.apply(t,i))}function Tu(){return(Tu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=xu(t)););return t}(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(arguments.length<3?t:i):n.value}}).apply(this,arguments)}function xu(t){return(xu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ou(t,e){return(Ou=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol1022=vu;var wu=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0!==(i=Au(this,e,[t])).scaleValues.length&&(i.scaleValues=[],i.scaleValues.push(.2),i.scaleValues.push(.2),i.scaleValues.push(.4),i.scaleValues.push(.4),i.scaleValues.push(.1),i.scaleValues.push(.2),i.scaleValues.push(.1),i.scaleValues.push(.2),i.scaleValues.push(1),i.scaleValues.push(1)),i.CLASS_NAME="SuperMapAlgoPlot.AlgoSymbol315",i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ou(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol1004),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length>=2&&t.length<this.minEditPts&&this.calAssistantLine(),!(t.length<this.minEditPts)){for(var e=0,i=0;i<t.length-1;i++)e+=SuperMapAlgoPlot.PlottingUtil.distance(t[i],t[i+1]);SuperMapAlgoPlot.AlgoSymbol1004.prototype.applyUse.apply(this,arguments),this.scaleValues.length<9&&(this.scaleValues=[],this.scaleValues.push(.2),this.scaleValues.push(.2),this.scaleValues.push(.4),this.scaleValues.push(.4),this.scaleValues.push(.1),this.scaleValues.push(.2),this.scaleValues.push(.1),this.scaleValues.push(.2),this.scaleValues.push(1),this.scaleValues.push(1));var o,n=e*this.scaleValues[4],l=e*this.scaleValues[5],s=SuperMapAlgoPlot.PlottingUtil.distance(t[1],t[0]),a=SuperMapAlgoPlot.PlottingUtil.linePnt(t[1],t[0],s+l);o=(this.scaleValues[8],SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(n,t[1],a));var r,u=e*this.scaleValues[6],p=e*this.scaleValues[7],h=SuperMapAlgoPlot.PlottingUtil.linePnt(t[0],t[1],s+p);r=(this.scaleValues[9],SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(u,t[0],h));var c=[];c.push(new SuperMapAlgoPlot.Point(o.pntLeft.x,o.pntLeft.y)),c.push(new SuperMapAlgoPlot.Point(t[0].x,t[0].y)),c.push(new SuperMapAlgoPlot.Point(t[1].x,t[1].y)),c.push(new SuperMapAlgoPlot.Point(r.pntRight.x,r.pntRight.y));var y=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(c);y=SuperMapAlgoPlot.PlottingUtil.clearSamePts(y),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,y),this.addScalePoint(o.pntLeft,3),this.addScalePoint(r.pntRight,4)}}},{key:"modifyPoint",value:function(t,i){if(!0===i.isScalePoint){var o=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);o=SuperMapAlgoPlot.PlottingUtil.clearSamePts(o);var n=SuperMapAlgoPlot.PlottingUtil.polylineDistance(o),l=SuperMapAlgoPlot.PlottingUtil.projectPoint(i,o[0],o[1]);if(t<=2&&(SuperMapAlgoPlot.AlgoSymbol1004.prototype.modifyPoint.apply(this,arguments),Tu(xu(e.prototype),"modifyPoint",this).call(this,t,i)),3===t){var s=SuperMapAlgoPlot.PlottingUtil.distance(i,l)/n,a=SuperMapAlgoPlot.PlottingUtil.distance(l,o[0])/n;this.scaleValues[4]=s,this.scaleValues[5]=a,SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(o[0],o[1],i)?this.scaleValues[8]=1:this.scaleValues[8]=0}if(4===t){var r=SuperMapAlgoPlot.PlottingUtil.distance(i,l)/n,u=SuperMapAlgoPlot.PlottingUtil.distance(l,o[1])/n;this.scaleValues[6]=r,this.scaleValues[7]=u,SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(o[0],o[1],i)?this.scaleValues[9]=1:this.scaleValues[9]=0}}this.calculateParts()}}])&&Mu(i.prototype,o),n&&Mu(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Cu(t){"@babel/helpers - typeof";return(Cu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Eu(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Iu(o.key),o)}}function Iu(t){var e=function(t,e){if("object"!=Cu(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Cu(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Cu(e)?e:e+""}function Du(t,e,i){return e=Uu(e),function(t,e){if(e&&("object"===Cu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Uu(t).constructor):e.apply(t,i))}function Uu(t){return(Uu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ru(t,e){return(Ru=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol315=wu;var Nu=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Du(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.05),i.scaleValues.push(0),i.scaleValues.push(.185)),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ru(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){var e=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t);e=SuperMapAlgoPlot.PlottingUtil.clearSamePts(e);for(var i=this.mergeDashLine(this.dashLines,[]),o=this.computeDashLine(i,e),n=0;n<o.length;n++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,o[n]);var l=SuperMapAlgoPlot.PlottingUtil.polylineDistance(e),s=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t);if(!this.isEdit){var a=this.getSubSymbolScaleValue(s);(a>.3||a<=0)&&(a=.3),this.scaleValues[2]=a,this.scaleValues[0]=.5*this.scaleValues[2]}for(var r=this.scaleValues[0]*s,u=this.scaleValues[1],p=this.scaleValues[2]*s,h=.5*r,c=l-2*p-2*h,y=p,g=0;g<2;g++){var f=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(y,e);if(-1!==f.index){var d=y+h,m=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(d,e);if(-1!==m.index){var S=[],P=[];if(S.push(f.pts),SuperMapAlgoPlot.PlottingUtil.equalFuzzy(e[f.index].x,f.pts.x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(e[f.index].y,f.pts.y)&&f.index+1<e.length){var b=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(r,e[f.index+1],f.pts);0===u?S.push(new SuperMapAlgoPlot.Point(b.pntRight.x,b.pntRight.y)):S.push(new SuperMapAlgoPlot.Point(b.pntLeft.x,b.pntLeft.y))}else{b=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(r,e[f.index],f.pts);0===u?S.push(new SuperMapAlgoPlot.Point(b.pntLeft.x,b.pntLeft.y)):S.push(new SuperMapAlgoPlot.Point(b.pntRight.x,b.pntRight.y))}P.push(m.pts);var v=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(r,e[m.index],m.pts);if(0===u?P.push(new SuperMapAlgoPlot.Point(v.pntLeft.x,v.pntLeft.y)):P.push(new SuperMapAlgoPlot.Point(v.pntRight.x,v.pntRight.y)),0===g){this.scalePoints=[];var L=new SuperMapAlgoPlot.Point(S[1].x,S[1].y);L.isScalePoint=!0,L.tag=0,this.scalePoints.push(L),(L=new SuperMapAlgoPlot.Point(S[0].x,S[0].y)).isScalePoint=!0,L.tag=1,this.scalePoints.push(L)}this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,S),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,P),y+=c+h}}}this.finish()}}},{key:"computeScaleValues",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i)).length<this.minEditPts)return;var o=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(i),n=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i);new SuperMapAlgoPlot.Point(e.x,e.y);if(0===t){var l=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(n*this.scaleValues[2],o);if(!l.bfind)return;var s=SuperMapAlgoPlot.PlottingUtil.distance(l.pts,e)/n,a=SuperMapAlgoPlot.PlottingUtil.pointIsRightToLine(o[l.index],l.pts,e);this.scaleValues[1]=a?1:0,this.scaleValues[0]=s}else if(1===t){for(var r=0,u=-1,p=null,h=0;h<o.length-1;h++){var c=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,o[h],o[h+1]);if(c.isOnline){var y=SuperMapAlgoPlot.PlottingUtil.distance(c.projectPoint,e);0==r?(r=y,u=h,p=e):y<r&&(r=y,u=h,p=e)}}if((y=SuperMapAlgoPlot.PlottingUtil.distance(e,o[0]))<r&&(r=y,u=0,p=o[0]),(y=SuperMapAlgoPlot.PlottingUtil.distance(e,o[o.length-1]))<r&&(r=y,u=o.length-1,p=o[o.length-1]),-1==u)return void(this.scaleValues[2]=0);for(var g=0,f=0;f<u;f++)g+=SuperMapAlgoPlot.PlottingUtil.distance(o[f],o[f+1]);var d=(g+=SuperMapAlgoPlot.PlottingUtil.distance(p,o[u]))/n;d>.7&&(d=.7),this.scaleValues[2]=d}}}}])&&Eu(i.prototype,o),n&&Eu(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Bu(t){"@babel/helpers - typeof";return(Bu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ku(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Fu(o.key),o)}}function Fu(t){var e=function(t,e){if("object"!=Bu(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Bu(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Bu(e)?e:e+""}function ju(t,e,i){return e=Vu(e),function(t,e){if(e&&("object"===Bu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Vu(t).constructor):e.apply(t,i))}function Vu(t){return(Vu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function zu(t,e){return(zu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol15200=Nu;var Yu=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),ju(this,e,[t])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zu(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){if(2==t.length){var e=new SuperMapAlgoPlot.Point(t[1].x,t[1].y);SuperMapAlgoPlot.PlottingUtil.rotateAngle(t[0],Math.PI/3,e),t.push(e)}for(var i=t[0].x,o=t[0].x,n=0;n<t.length;n++)i>t[n].x&&(i=t[n].x),o<t[n].x&&(o=t[n].x);var l=(o-i)/50,s=[];(s=s.concat(t)).push(t[0]);var a=this.mergeDashLine(this.dashLines,[]),r=this.computeDashLine(a,s);if(r.length>1)for(var u=0;u<r.length;u++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,r[u]);else 1==r.length&&this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,t);var p=SuperMapAlgoPlot.PlottingUtil.getPolygonCenterPt(t),h={surroundLineFlag:!1,lineWidthLimit:!0,strokeWidth:1,weight:1,lineTypeLimit:!0,surroundLineLimit:!0},c=10*l;t.push(t[0]);for(var y=!0,g=p.x,f=p.x;y;){y=!1;for(var d,m,S,P,b,v=[],L=new SuperMapAlgoPlot.Point(g,p.y),M=SuperMapAlgoPlot.PlottingUtil.circlePoint(L,10,10,45),_=0;_<t.length-1;_++){var A=SuperMapAlgoPlot.PlottingUtil.intersectLines(L,M,t[_],t[_+1]);A.isIntersectLines&&(m=A.intersectPoint,(S=[]).push(t[_]),S.push(t[_+1]),(d=SuperMapAlgoPlot.PlottingUtil.pointIsOnPolyLines(m,S)).isOnPolyLine&&v.push(m))}if(1<v.length){this.sortPts2D(v);for(var T=0;T<v.length-1;T++)b=new SuperMapAlgoPlot.Point((v[T].x+v[T+1].x)/2,(v[T].y+v[T+1].y)/2),SuperMapAlgoPlot.PlottingUtil.ptIsInPolygon(t,b)&&((P=[]).push(v[T]),P.push(v[T+1]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,P,h,!0))}v.length>0&&(y=!0),v=[];for(var x=new SuperMapAlgoPlot.Point(f,p.y),O=SuperMapAlgoPlot.PlottingUtil.circlePoint(x,5,5,45),w=0;w<t.length-1;w++)(d=SuperMapAlgoPlot.PlottingUtil.intersectLines(x,O,t[w],t[w+1])).isIntersectLines&&(m=d.intersectPoint,(S=[]).push(t[w]),S.push(t[w+1]),(d=SuperMapAlgoPlot.PlottingUtil.pointIsOnPolyLines(m,S)).isOnPolyLine&&v.push(m));if(1<v.length){this.sortPts2D(v);for(var C=0;C<v.length-1;C++)b=new SuperMapAlgoPlot.Point((v[C].x+v[C+1].x)/2,(v[C].y+v[C+1].y)/2),SuperMapAlgoPlot.PlottingUtil.ptIsInPolygon(t,b)&&((P=[]).push(v[C]),P.push(v[C+1]),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,P,h,!0))}v.length>0&&(y=!0),g-=c,f+=c}this.finish()}}},{key:"sortPts2D",value:function(t){for(var e=new SuperMapAlgoPlot.Point(0,0),i=0;i<t.length;i++)for(var o=0;o<t.length-1-i;o++)SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[o].x,t[o+1].x)?t[o].y>t[o+1].y&&(e=t[o],t[o]=t[o+1],t[o+1]=e):t[o].x>t[o+1].x&&(e=t[o],t[o]=t[o+1],t[o+1]=e);return t}}])&&ku(i.prototype,o),n&&ku(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Gu(t){"@babel/helpers - typeof";return(Gu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Wu(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Xu(o.key),o)}}function Xu(t){var e=function(t,e){if("object"!=Gu(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Gu(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Gu(e)?e:e+""}function Hu(t,e,i){return e=Zu(e),function(t,e){if(e&&("object"===Gu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Zu(t).constructor):e.apply(t,i))}function Zu(t){return(Zu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ju(t,e){return(Ju=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol25701=Yu;var qu=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Hu(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.1),i.scaleValues.push(.1)),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ju(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){for(var e=0,i=0;i<t.length-1;i++)e+=SuperMapAlgoPlot.PlottingUtil.distance(t[i],t[i+1]);var o,n,l=this.scaleValues[0]*e,s=t[0],a=t[1],r=180*SuperMapAlgoPlot.PlottingUtil.radian(s,a)/Math.PI;o=SuperMapAlgoPlot.PlottingUtil.paraLine(t,l,!0),n=SuperMapAlgoPlot.PlottingUtil.paraLine(t,l,!1);var u=.15*e,p=SuperMapAlgoPlot.PlottingUtil.circlePoint(o[0],u,u,r+165),h=SuperMapAlgoPlot.PlottingUtil.circlePoint(n[0],u,u,r-165),c=SuperMapAlgoPlot.PlottingUtil.circlePoint(o[o.length-1],u,u,r+15),y=SuperMapAlgoPlot.PlottingUtil.circlePoint(n[n.length-1],u,u,r-15),g=[];g.push(p),g.push(o[0]),g.push(o[o.length-1]),g.push(c),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,g);var f=[];f.push(h),f.push(n[0]),f.push(n[n.length-1]),f.push(y),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,f);var d=new SuperMapAlgoPlot.Point(o[0].x,o[0].y);d.isScalePoint=!0,d.tag=0,this.scalePoints.push(d),this.finish()}}},{key:"computeScaleValues",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i);for(var o=0,n=0;n<i.length-1;n++)o+=SuperMapAlgoPlot.PlottingUtil.distance(i[n],i[n+1]);if(0==t){var l=i[0],s=i[1],a=SuperMapAlgoPlot.PlottingUtil.projectPoint(e,l,s),r=SuperMapAlgoPlot.PlottingUtil.distance(e,a);this.scaleValues[0]=r/o}}}}])&&Wu(i.prototype,o),n&&Wu(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Ku(t){"@babel/helpers - typeof";return(Ku="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qu(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,$u(o.key),o)}}function $u(t){var e=function(t,e){if("object"!=Ku(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ku(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ku(e)?e:e+""}function tp(t,e,i){return e=ep(e),function(t,e){if(e&&("object"===Ku(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],ep(t).constructor):e.apply(t,i))}function ep(t){return(ep=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ip(t,e){return(ip=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol320=qu;var op=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=tp(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.02),i.scaleValues.push(.1),i.scaleValues.push(0)),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ip(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){var e=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t),i=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t);i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i);var o=this.getSubSymbolScaleValue();this.isEdit||(this.scaleValues[0]=.5*o);var n=this.scaleValues[0]*e,l=SuperMapAlgoPlot.PlottingUtil.paraLine(i,.5*n,!0),s=SuperMapAlgoPlot.PlottingUtil.paraLine(i,.5*n,!1);l=SuperMapAlgoPlot.PlottingUtil.clearSamePts(l),s=SuperMapAlgoPlot.PlottingUtil.clearSamePts(s),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,l),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,s);for(var a=e*this.scaleValues[1],r=.5*n,u=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i),p=r,h=0;p<u;p+=a,h++){var c=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(l,p);if(-1!==c.index){var y=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(n,l[c.index+1],c.pt),g=[];g.push(y.pntRight),g.push(c.pt),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,g);var f=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(s,p);if(-1!==f.index){var d=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(n,s[f.index+1],f.pt);(g=[]).push(f.pt),g.push(d.pntLeft),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,g),0===h?this.addScalePoint(y.pntRight,0):1===h&&this.addScalePoint(c.pt,1)}}}this.finish()}}},{key:"computeScaleValues",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i);for(var o=0,n=0;n<i.length-1;n++)o+=SuperMapAlgoPlot.PlottingUtil.distance(i[n],i[n+1]);var l,s=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(i);if(s=SuperMapAlgoPlot.PlottingUtil.clearSamePts(s),0==t){l=.5*(o*this.scaleValues[0]);var a=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(s,l);if(-1===a.index)return;var r=SuperMapAlgoPlot.PlottingUtil.distance(e,a.pt);this.scaleValues[0]=r/o}else if(1===t){l=.5*(o*this.scaleValues[0]);var u=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(s,l);if(-1===u.index)return;var p=SuperMapAlgoPlot.PlottingUtil.projectPtOnPolyLine(e,s);if(-1==p.index)return;for(var h=SuperMapAlgoPlot.PlottingUtil.distance(u.pt,s[u.index+1]),c=u.index+1;c<p.index;c++)h+=SuperMapAlgoPlot.PlottingUtil.distance(s[c],s[c+1]);h+=SuperMapAlgoPlot.PlottingUtil.distance(s[p.index],p.pt),this.scaleValues[1]=h/o}}}}])&&Qu(i.prototype,o),n&&Qu(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function np(t){"@babel/helpers - typeof";return(np="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lp(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,sp(o.key),o)}}function sp(t){var e=function(t,e){if("object"!=np(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=np(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==np(e)?e:e+""}function ap(t,e,i){return e=rp(e),function(t,e){if(e&&("object"===np(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],rp(t).constructor):e.apply(t,i))}function rp(t){return(rp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function up(t,e){return(up=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol321=op;var pp=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=ap(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.025),i.scaleValues.push(.085)),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&up(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){this.isEdit||(this.scaleValues[0]=.5*this.getSubSymbolScaleValue()),this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,t),SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[0].x,t[t.length-1].x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(t[0].y,t[t.length-1].y)||t.push(t[0]);for(var e=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t),i=this.scaleValues[0]*e,o=-1*SuperMapAlgoPlot.PlottingUtil.innerOutlineDir(t),n=this.scaleValues[1]*e,l=.3*n,s=n;s<e;s+=n){var a=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(t,s);if(-1===a.index)return void this.finish();var r=s+l,u=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(t,r);if(-1===u.index)return void this.finish();var p=[],h=[];p.push(a.pt);var c=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(i,t[a.index],a.pt);1===o?p.push(new SuperMapAlgoPlot.Point(c.pntLeft.x,c.pntLeft.y)):p.push(new SuperMapAlgoPlot.Point(c.pntRight.x,c.pntRight.y)),h.push(u.pt);var y=SuperMapAlgoPlot.PlottingUtil.getSidePointsOfLine(i,t[u.index],u.pt);if(1===o?h.push(new SuperMapAlgoPlot.Point(y.pntLeft.x,y.pntLeft.y)):h.push(new SuperMapAlgoPlot.Point(y.pntRight.x,y.pntRight.y)),n===s){this.scalePoints=[];var g=new SuperMapAlgoPlot.Point(p[1].x,p[1].y);g.isScalePoint=!0,g.tag=0,this.scalePoints.push(g),(g=new SuperMapAlgoPlot.Point(p[0].x,p[0].y)).isScalePoint=!0,g.tag=1,this.scalePoints.push(g)}this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,p),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,h)}this.finish()}}},{key:"computeScaleValues",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i)).length<this.minEditPts)return;SuperMapAlgoPlot.PlottingUtil.equalFuzzy(i[0].x,i[i.length-1].x)&&SuperMapAlgoPlot.PlottingUtil.equalFuzzy(i[0].y,i[i.length-1].y)||i.push(i[0]);var o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i),n=new SuperMapAlgoPlot.Point(e.x,e.y);if(0===t){var l=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(i,o*this.scaleValues[1]);if(-1===l.index)return;var s=SuperMapAlgoPlot.PlottingUtil.distance(l.pt,n)/o;this.scaleValues[0]=s}else if(1===t){for(var a=0,r=-1,u=null,p=0,h=i.length-1;p<h;p++){var c=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,i[p],i[p+1]);if(c.isOnline)if(null==u)r=p,u=c.projectPoint,a=SuperMapAlgoPlot.PlottingUtil.distance(e,u);else{var y=SuperMapAlgoPlot.PlottingUtil.distance(e,u);y<a&&(r=p,u=c.projectPoint,a=y)}}if(-1==r)return;for(var g=0,f=0,d=r-1;f<d;f++)g+=SuperMapAlgoPlot.PlottingUtil.distance(i[f],i[f+1]);var m=(g+=SuperMapAlgoPlot.PlottingUtil.distance(i[r],u))/o;m>.3&&(m=.3),this.scaleValues[1]=m}}}}])&&lp(i.prototype,o),n&&lp(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function hp(t){"@babel/helpers - typeof";return(hp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function cp(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,yp(o.key),o)}}function yp(t){var e=function(t,e){if("object"!=hp(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=hp(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==hp(e)?e:e+""}function gp(t,e,i){return e=fp(e),function(t,e){if(e&&("object"===hp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],fp(t).constructor):e.apply(t,i))}function fp(t){return(fp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function dp(t,e){return(dp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol322=pp;var mp=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=gp(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.5),i.scaleValues.push(.222222),i.scaleValues.push(.25*Math.tan(60*Math.PI/180)),i.scaleValues.push(.25),i.scaleValues.push(.25)),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&dp(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){0==this.scaleValues.length&&(this.scaleValues=[],this.scaleValues.push(.5),this.scaleValues.push(.222222),this.scaleValues.push(.25*Math.tan(60*Math.PI/180)),this.scaleValues.push(.25),this.scaleValues.push(.25));var e=t[0].clone(),i=t[1].clone(),o=SuperMapAlgoPlot.PlottingUtil.distance(e,i),n=this.scaleValues[0],l=new SuperMapAlgoPlot.Point(0,-o*n),s=new SuperMapAlgoPlot.Point(0,o*n),a=this.scaleValues[1],r=this.scaleValues[3],u=new SuperMapAlgoPlot.Point(o*(1-r),-o*a),p=new SuperMapAlgoPlot.Point(o*(1-r),o*a),h=this.scaleValues[2],c=this.scaleValues[4],y=new SuperMapAlgoPlot.Point(o*(1-c),-o*h),g=new SuperMapAlgoPlot.Point(o*(1-c),o*h),f=new SuperMapAlgoPlot.Point(o,0),d=SuperMapAlgoPlot.PlottingUtil.dirAngle(e,i),m=[];m.push(l),m.push(u),m.push(y),m.push(f),m.push(g),m.push(p),m.push(s);for(var S=[],P=0;P<m.length;P++){var b=SuperMapAlgoPlot.PlottingUtil.coordinateTrans(e,m[P],d*SuperMapAlgoPlot.PlottingUtil.RTOD);S.push(b)}for(var v=[],L=S.length-1;L>=0;--L)v.push(S[L]);for(var M=this.mergeDashLine(this.dashLines,[]),_=this.computeDashLine(M,[v[0],v[1]]),A=0;A<_.length;A++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,_[A]);M=this.mergeDashLine(this.dashLines,[]),_=this.computeDashLine(M,[v[v.length-1],v[v.length-2]]);for(var T=0;T<_.length;T++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,_[T].reverse());for(var x=[],O=1;O<v.length-1;O++)x.push(v[O]);this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,x),this.scalePoints=[];var w=S[0].clone();w.isScalePoint=!0,w.tag=0,this.scalePoints.push(w);var C=S[1].clone();C.isScalePoint=!0,C.tag=1,this.scalePoints.push(C);var E=S[2].clone();E.isScalePoint=!0,E.tag=2,this.scalePoints.push(E),this.finish()}}},{key:"computeScaleValues",value:function(t,e){if(e.isScalePoint&&(t>=0||t<3)){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i);var o,n=SuperMapAlgoPlot.PlottingUtil.distance(i[0],i[1]),l=i[0].clone(),s=i[1].clone(),a=e.clone();if(0==t){var r=SuperMapAlgoPlot.PlottingUtil.distance(a,l)/n;this.scaleValues[0]=r}else if(1==t){o=SuperMapAlgoPlot.PlottingUtil.projectPoint(a,l,s);var u=SuperMapAlgoPlot.PlottingUtil.distance(o,a)/n;this.scaleValues[1]=u;var p=SuperMapAlgoPlot.PlottingUtil.distance(o,s)/n;this.scaleValues[3]=p}else if(2==t){o=SuperMapAlgoPlot.PlottingUtil.projectPoint(a,l,s);var h=SuperMapAlgoPlot.PlottingUtil.distance(o,a)/n;this.scaleValues[2]=h;var c=SuperMapAlgoPlot.PlottingUtil.distance(o,s)/n;this.scaleValues[4]=c}}}}])&&cp(i.prototype,o),n&&cp(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Sp(t){"@babel/helpers - typeof";return(Sp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pp(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,bp(o.key),o)}}function bp(t){var e=function(t,e){if("object"!=Sp(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Sp(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Sp(e)?e:e+""}function vp(t,e,i){return e=Lp(e),function(t,e){if(e&&("object"===Sp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Lp(t).constructor):e.apply(t,i))}function Lp(t){return(Lp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Mp(t,e){return(Mp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol25000=mp;var _p=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=vp(this,e,[t])).scaleValues.length&&i.scaleValues.push(.05),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Mp(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){var e=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t);e=SuperMapAlgoPlot.PlottingUtil.clearSamePts(e);SuperMapAlgoPlot.PlottingUtil.polylineDistance(e);0===this.scaleValues.length&&(this.scaleValues[0]=.05),this.isEdit||(this.scaleValues[0]=2*this.getSubSymbolScaleValue());var i=this.getLinePts(e,this.scaleValues[0]),o=new SuperMapAlgoPlot.Point((i.startPt.x+i.endPt.x)/2,(i.startPt.y+i.endPt.y)/2),n=SuperMapAlgoPlot.PlottingUtil.radian(i.startPt,i.endPt)*SuperMapAlgoPlot.PlottingUtil.RTOD,l=SuperMapAlgoPlot.PlottingUtil.distance(i.startPt,i.endPt);this.addSubSymbols(o,l,n);for(var s=[],a=0;a<=i.startIndex;a++)s.push(e[a]);s.push(i.startPt);for(var r=.1*l,u=SuperMapAlgoPlot.PlottingUtil.makeDottedLine(s,r),p=0;p<u.length;p++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,u[p]);if(i.endIndex<=e.length){var h=[];h.push(i.endPt);for(var c=i.endIndex+1;c<=e.length-1;c++)h.push(e[c]);var y=SuperMapAlgoPlot.PlottingUtil.makeDottedLine(h,r);for(p=0;p<y.length;p++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,y[p])}this.finish()}}},{key:"addSubSymbols",value:function(t,e,i){var o=.1*e,n=new SuperMapAlgoPlot.Point(-o,o),l=new SuperMapAlgoPlot.Point(o,-o),s=[];s.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,n,i)),s.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,l,i)),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,s);var a=new SuperMapAlgoPlot.Point(-o,-o),r=new SuperMapAlgoPlot.Point(o,o),u=[];u.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,a,i)),u.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,r,i)),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,u);var p=new SuperMapAlgoPlot.Point(-4*o,o),h=new SuperMapAlgoPlot.Point(-2*o,-o),c=[];c.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,p,i)),c.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,h,i)),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,c);var y=new SuperMapAlgoPlot.Point(-4*o,-o),g=new SuperMapAlgoPlot.Point(-2*o,o),f=[];f.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,y,i)),f.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,g,i)),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,f);var d=new SuperMapAlgoPlot.Point(2*o,o),m=new SuperMapAlgoPlot.Point(4*o,-o),S=[];S.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,d,i)),S.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,m,i)),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,S);var P=new SuperMapAlgoPlot.Point(2*o,-o),b=new SuperMapAlgoPlot.Point(4*o,o),v=[];v.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,P,i)),v.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,b,i)),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,v)}},{key:"computeScaleValues",value:function(t,e){}}])&&Pp(i.prototype,o),n&&Pp(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Ap(t){"@babel/helpers - typeof";return(Ap="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tp(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,xp(o.key),o)}}function xp(t){var e=function(t,e){if("object"!=Ap(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ap(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ap(e)?e:e+""}function Op(t,e,i){return e=wp(e),function(t,e){if(e&&("object"===Ap(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],wp(t).constructor):e.apply(t,i))}function wp(t){return(wp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Cp(t,e){return(Cp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol326=_p;var Ep=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Op(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.5),i.scaleValues.push(.05),i.scaleValues.push(.02),i.scaleValues.push(1)),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Cp(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){var e=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t);e=SuperMapAlgoPlot.PlottingUtil.clearSamePts(e);SuperMapAlgoPlot.PlottingUtil.polylineDistance(e);if(0===this.scaleValues.length&&(this.scaleValues.push(.5),this.scaleValues.push(.05),this.scaleValues.push(.02),this.scaleValues.push(1)),!this.isEdit){var i=this.getSubSymbolScaleValue();(i>.3||i<=0)&&(i=.3),this.scaleValues[1]=i,this.scaleValues[2]=.5*i}var o=t[0].x,n=t[t.length-1].x;this.scaleValues[3]=o<n?1:-1;var l=this.getLinePts(e,this.scaleValues[1],this.scaleValues[0]),s=new SuperMapAlgoPlot.Point((l.startPt.x+l.endPt.x)/2,(l.startPt.y+l.endPt.y)/2),a=SuperMapAlgoPlot.PlottingUtil.dirAngle(l.startPt,l.endPt)*SuperMapAlgoPlot.PlottingUtil.RTOD,r=.8*SuperMapAlgoPlot.PlottingUtil.distance(l.startPt,l.endPt);this.addSubSymbols(s,r,a),this.addSubText(s,r,a);for(var u=[],p=0;p<=l.startIndex;p++)u.push(e[p]);u.push(l.startPt);var h=SuperMapAlgoPlot.PlottingUtil.polylineDistance(e),c=[];c.push(0),c.push(SuperMapAlgoPlot.PlottingUtil.getLineDistance(e,l.startPt)/h),c.push(SuperMapAlgoPlot.PlottingUtil.getLineDistance(e,l.endPt)/h),c.push(1);for(var y=this.mergeDashLine(this.dashLines,c),g=this.computeDashLine(y,e),f=0;f<g.length;f++)this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,g[f]);if(0==g.length)this.addArrow(e[e.length-2],e[e.length-1],this.scaleValues[2]);else for(var d=0;d<g.length;d++)g.length-1==d&&this.addArrow(g[d],this.scaleValues[2]);this.addScalePoint(s,0);var m=SuperMapAlgoPlot.PlottingUtil.circlePoint(s,.5*r,.5*r,a+90);this.addScalePoint(m,1);var S=SuperMapAlgoPlot.PlottingUtil.polylineDistance(e)*(1-this.scaleValues[2]),P=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(e,S);this.addScalePoint(P.pt,2),this.finish()}}},{key:"addSubSymbols",value:function(t,e,i){this.subSymbols.length>0&&1===this.scaleValues[3]?this.computeSubSymbol(this.subSymbols[0],t,e,i,0,0,!0):this.subSymbols.length>0&&-1===this.scaleValues[3]&&this.computeSubSymbol(this.subSymbols[0],t,e,i-180)}},{key:"addSubText",value:function(t,e,i){}},{key:"computeScaleValues",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i)).length<this.minEditPts)return;var o=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(i);o=SuperMapAlgoPlot.PlottingUtil.clearSamePts(o);var n=SuperMapAlgoPlot.PlottingUtil.polylineDistance(o);if(0===t){for(var l=0,s=-1,a=null,r=0;r<o.length-1;r++){var u;(u=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,o[r],o[r+1])).isOnline&&(0===l||SuperMapAlgoPlot.PlottingUtil.distance(u.projectPoint,e)<l)&&(a=u,s=r,l=SuperMapAlgoPlot.PlottingUtil.distance(e,u.projectPoint))}if(-1==s)return;var p=[];for(r=0;r<s+1;r++)p.push(o[r]);p.push(new SuperMapAlgoPlot.Point(a.projectPoint.x,a.projectPoint.y));var h=SuperMapAlgoPlot.PlottingUtil.polylineDistance(p)/n,c=this.scaleValues[1];h<c&&(h=c),h>1-c-this.scaleValues[2]&&(h=1-c-this.scaleValues[2]),this.scaleValues[0]=h}else if(1===t){var y=this.getLinePts(o,this.scaleValues[1],this.scaleValues[0]),g=new SuperMapAlgoPlot.Point((y.startPt.x+y.endPt.x)/2,(y.startPt.y+y.endPt.y)/2),f=SuperMapAlgoPlot.PlottingUtil.dirAngle(y.startPt,y.endPt)*SuperMapAlgoPlot.PlottingUtil.RTOD,d=.8*SuperMapAlgoPlot.PlottingUtil.distance(y.startPt,y.endPt),m=SuperMapAlgoPlot.PlottingUtil.circlePoint(g,.5*d,.5*d,f+90),S=SuperMapAlgoPlot.PlottingUtil.projectPoint(e,m,g),P=this.scaleValues[1]*SuperMapAlgoPlot.PlottingUtil.distance(g,S)/SuperMapAlgoPlot.PlottingUtil.distance(g,m);P>=.3&&(P=.3),(this.scaleValues[0]<P||this.scaleValues[0]>1-P-this.scaleValues[2])&&(this.scaleValues[0]<P?this.scaleValues[0]=P:this.scaleValues[0]=1-P-this.scaleValues[2]),this.scaleValues[1]=P}else if(2===t){var b=SuperMapAlgoPlot.PlottingUtil.distance(new SuperMapAlgoPlot.Point(e.x,e.y),i[i.length-1])/SuperMapAlgoPlot.PlottingUtil.polylineDistance(o);if(.5<b||b>1-this.scaleValues[0]-this.scaleValues[1])return void(this.scaleValues[2]=1-this.scaleValues[0]-this.scaleValues[1]);this.scaleValues[2]=b}}}}])&&Tp(i.prototype,o),n&&Tp(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Ip(t){"@babel/helpers - typeof";return(Ip="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dp(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Up(o.key),o)}}function Up(t){var e=function(t,e){if("object"!=Ip(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ip(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ip(e)?e:e+""}function Rp(t,e,i){return e=Np(e),function(t,e){if(e&&("object"===Ip(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Np(t).constructor):e.apply(t,i))}function Np(t){return(Np=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bp(t,e){return(Bp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol21501=Ep;var kp=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Rp(this,e,[t])).scaleValues.length&&(i.scaleValues.push(.05),i.scaleValues.push(.02)),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Bp(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol21501),i=e,(o=[{key:"addSubSymbols",value:function(t,e,i){var o=new SuperMapAlgoPlot.Point(-.5*e,.25*e),n=new SuperMapAlgoPlot.Point(-.5*e,-.25*e),l=[];l.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,o,i)),l.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,n,i)),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,l);var s=new SuperMapAlgoPlot.Point(-.5*e,.125*e),a=new SuperMapAlgoPlot.Point(.25*e,.125*e),r=new SuperMapAlgoPlot.Point(.5*e,0),u=new SuperMapAlgoPlot.Point(.25*e,-.125*e),p=new SuperMapAlgoPlot.Point(-.5*e,-.125*e),h=[];h.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,s,i)),h.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,a,i)),h.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,r,i)),h.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,u,i)),h.push(SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,p,i)),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,h)}}])&&Dp(i.prototype,o),n&&Dp(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Fp(t){"@babel/helpers - typeof";return(Fp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jp(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Vp(o.key),o)}}function Vp(t){var e=function(t,e){if("object"!=Fp(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Fp(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Fp(e)?e:e+""}function zp(t,e,i){return e=Yp(e),function(t,e){if(e&&("object"===Fp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Yp(t).constructor):e.apply(t,i))}function Yp(t){return(Yp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Gp(t,e){return(Gp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol327=kp;var Wp=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=zp(this,e,[t])).scaleValues.length&&(i.scaleValues[0]=.05,i.scaleValues[1]=.35,i.scaleValues[2]=.65,i.scaleValues[3]=.02),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gp(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){if(0===this.scaleValues.length&&(this.scaleValues[0]=.05,this.scaleValues[1]=.35,this.scaleValues[2]=.65,this.scaleValues[3]=.02),!this.isEdit){var e=this.getSubSymbolScaleValue();(e>.3||e<=0)&&(e=.3),this.scaleValues[0]=e,this.scaleValues[3]=.5*e}SuperMapAlgoPlot.PlottingUtil.polylineDistance(t);var i=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t);i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i);var o=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i),n=o*this.scaleValues[0],l=(this.scaleValues[1],this.scaleValues[2],this.getLinePts(i,this.scaleValues[0]/2,this.scaleValues[1])),s=this.getLinePts(i,this.scaleValues[0]/2,this.scaleValues[2]),a=new SuperMapAlgoPlot.Point((l.startPt.x+l.endPt.x)/2,(l.startPt.y+l.endPt.y)/2),r=180*SuperMapAlgoPlot.PlottingUtil.radian(l.startPt,l.endPt)/Math.PI;this.createSubSymbol1(a,n,r);var u=new SuperMapAlgoPlot.Point((s.startPt.x+s.endPt.x)/2,(s.startPt.y+s.endPt.y)/2),p=180*SuperMapAlgoPlot.PlottingUtil.radian(s.startPt,s.endPt)/Math.PI;this.createSubSymbol2(u,n,p);var h=SuperMapAlgoPlot.PlottingUtil.circlePoint(a,.5*n,.5*n,r+90),c=SuperMapAlgoPlot.PlottingUtil.circlePoint(u,.5*n,.5*n,p+90);this.scalePoints=[],this.addScalePoint(a,0),this.addScalePoint(u,0),this.addScalePoint(h,0),this.addScalePoint(c,0);var y=SuperMapAlgoPlot.PlottingUtil.polylineDistance(i)*[1-this.scaleValues[3]],g=SuperMapAlgoPlot.PlottingUtil.findPointInPolyLine(i,y);this.addScalePoint(g.pt);var f=[];f.push(0),this.scaleValues[1]<this.scaleValues[2]?(f.push(this.scaleValues[1]-.5*this.scaleValues[0]),f.push(this.scaleValues[1]+.5*this.scaleValues[0]),f.push(this.scaleValues[2]-.5*this.scaleValues[0]),f.push(this.scaleValues[2]+.5*this.scaleValues[0])):(f.push(this.scaleValues[2]-.5*this.scaleValues[0]),f.push(this.scaleValues[2]+.5*this.scaleValues[0]),f.push(this.scaleValues[1]-.5*this.scaleValues[0]),f.push(this.scaleValues[1]+.5*this.scaleValues[0])),f.push(1);var d=this.mergeDashLine(this.dashLines,f),m=this.computeDashLine(d,i);if(0==m.length)this.addArrow([i[i.length-2],i[i.length-1]],this.scaleValues[3]);else for(var S=0;S<m.length;S++)m.length-1==S&&(m[m.length-1].length>=2?this.addArrow(m[S],this.scaleValues[3]):this.addArrow([i[i.length-2],i[i.length-1]],this.scaleValues[3])),this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,m[S]);this.finish()}}},{key:"createSubSymbol1",value:function(t,e,i){var o=this.getSubSymbolPts(e);this.createSubSymbol(t,e,i,o)}},{key:"createSubSymbol2",value:function(t,e,i){var o=this.getSubSymbolPts(e);this.createSubSymbol(t,e,i,o)}},{key:"createSubSymbol",value:function(t,e,i,o){for(var n=[],l=0;l<o.length;l++){var s=SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,o[l],i);n.push(s)}this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,n,{lineTypeLimit:!0,surroundLineLimit:!0})}},{key:"getSubSymbolPts",value:function(t){var e=t/4,i=[];return i.push(new SuperMapAlgoPlot.Point(-2*e,0)),i.push(new SuperMapAlgoPlot.Point(0,-e)),i.push(new SuperMapAlgoPlot.Point(2*e,0)),i.push(new SuperMapAlgoPlot.Point(0,e)),i}},{key:"computeScaleValues",value:function(t,e){if(!0===e.isScalePoint){var i=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if((i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i)).length<this.minEditPts)return;var o=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(i);o=SuperMapAlgoPlot.PlottingUtil.clearSamePts(o);var n=SuperMapAlgoPlot.PlottingUtil.polylineDistance(o);if(0==t){for(var l=0,s=-1,a=null,r=0;r<o.length-1;r++){var u=null;(u=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,o[r],o[r+1])).isOnline&&(0===l||SuperMapAlgoPlot.PlottingUtil.distance(u.projectPoint,e)<l)&&(a=u,s=r,l=SuperMapAlgoPlot.PlottingUtil.distance(e,u.projectPoint))}if(-1==s)return;var p=[];for(r=0;r<s+1;r++)p.push(o[r]);p.push(new SuperMapAlgoPlot.Point(a.projectPoint.x,a.projectPoint.y)),(h=SuperMapAlgoPlot.PlottingUtil.polylineDistance(p)/n)<(c=this.scaleValues[0])/2&&(h=c),h>1-c/2-this.scaleValues[3]&&(h=1-c/2-this.scaleValues[3]),this.scaleValues[1]=h}else if(1==t){var h,c;for(l=0,s=-1,a=null,r=0;r<o.length-1;r++){u=null;(u=SuperMapAlgoPlot.PlottingUtil.pointProjectToSegment(e,o[r],o[r+1])).isOnline&&(0===l||SuperMapAlgoPlot.PlottingUtil.distance(u.projectPoint,e)<l)&&(a=u,s=r,l=SuperMapAlgoPlot.PlottingUtil.distance(e,u.projectPoint))}if(-1==s)return;for(p=[],r=0;r<s+1;r++)p.push(o[r]);p.push(new SuperMapAlgoPlot.Point(a.projectPoint.x,a.projectPoint.y)),(h=SuperMapAlgoPlot.PlottingUtil.polylineDistance(p)/n)<(c=this.scaleValues[0])/2&&(h=c/2),h>1-c/2-this.scaleValues[3]&&(h=1-c/2-this.scaleValues[3]),this.scaleValues[2]=h}else if(2==t){var y=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(n*this.scaleValues[1],o),g=2*SuperMapAlgoPlot.PlottingUtil.distance(y.pts,e)/n;this.scaleValues[1]<g/2||this.scaleValues[1]>1-g/2-this.scaleValues[3]?(this.scaleValues[1]<g/2?this.scaleValues[1]=g/2:this.scaleValues[1]=1-g/2-this.scaleValues[3],this.scaleValues[0]=g):this.scaleValues[0]=g}else if(3==t){y=SuperMapAlgoPlot.PlottingUtil.getPtsIndexByDistance(n*this.scaleValues[2],o),g=2*SuperMapAlgoPlot.PlottingUtil.distance(y.pts,e)/n;this.scaleValues[2]<g/2||this.scaleValues[2]>1-g/2-this.scaleValues[3]?(this.scaleValues[2]<g/2?this.scaleValues[2]=g/2:this.scaleValues[2]=1-g/2-this.scaleValues[3],this.scaleValues[0]=g):this.scaleValues[0]=g}else if(4==t){var f=SuperMapAlgoPlot.PlottingUtil.distance(e,i[i.length-1])/SuperMapAlgoPlot.PlottingUtil.polylineDistance(o),d=0;if(d=this.scaleValues[1]>this.scaleValues[2]?this.scaleValues[1]:this.scaleValues[2],.5<f||f>1-d-this.scaleValues[0])return void(this.scaleValues[3]=f>.5?.5:1-d-this.scaleValues[0]);this.scaleValues[3]=f}}}}])&&jp(i.prototype,o),n&&jp(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function Xp(t){"@babel/helpers - typeof";return(Xp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Hp(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Zp(o.key),o)}}function Zp(t){var e=function(t,e){if("object"!=Xp(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Xp(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Xp(e)?e:e+""}function Jp(t,e,i){return e=qp(e),function(t,e){if(e&&("object"===Xp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],qp(t).constructor):e.apply(t,i))}function qp(t){return(qp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Kp(t,e){return(Kp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol3010102=Wp;var Qp=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=Jp(this,e,[t])).scaleValues.length&&(i.scaleValues[0]=.05,i.scaleValues[1]=.05),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Kp(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol3010102),i=e,(o=[{key:"createSubSymbol1",value:function(t,e,i){for(var o=this.getSubSymbolPts(e),n=0;n<o.length;n++)this.createSubSymbol(t,e,i,o[n])}},{key:"createSubSymbol2",value:function(t,e,i){for(var o=this.getSubSymbolPts(e),n=0;n<o.length;n++)this.createSubSymbol(t,e,i,o[n])}},{key:"createSubSymbol",value:function(t,e,i,o){for(var n=[],l=0;l<o.length;l++){var s=SuperMapAlgoPlot.PlottingUtil.coordinateTrans(t,o[l],i);n.push(s)}var a=SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL;2===o.length&&(a=SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL),this.addCell(a,n)}},{key:"getSubSymbolPts",value:function(t){var e=[],i=t/2,o=[];o.push(new SuperMapAlgoPlot.Point(-2*i,0)),o.push(new SuperMapAlgoPlot.Point(0,-i)),o.push(new SuperMapAlgoPlot.Point(2*i,0)),o.push(new SuperMapAlgoPlot.Point(0,i)),e.push(o);var n=[];return n.push(new SuperMapAlgoPlot.Point(-i,i)),n.push(new SuperMapAlgoPlot.Point(i,i)),e.push(n),e}}])&&Hp(i.prototype,o),n&&Hp(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function $p(t){"@babel/helpers - typeof";return($p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function th(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,eh(o.key),o)}}function eh(t){var e=function(t,e){if("object"!=$p(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=$p(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==$p(e)?e:e+""}function ih(t,e,i){return e=oh(e),function(t,e){if(e&&("object"===$p(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],oh(t).constructor):e.apply(t,i))}function oh(t){return(oh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function nh(t,e){return(nh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol328=Qp;var lh=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=ih(this,e,[t])).scaleValues.length&&i.scaleValues.push(.05),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&nh(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){var e=SuperMapAlgoPlot.PlottingUtil.polylineDistance(t);this.isEdit||(this.scaleValues[0]=.25*this.getSubSymbolScaleValue());var i=[];i=3>=t.length?SuperMapAlgoPlot.Primitives.getSpatialData(SuperMapAlgoPlot.SymbolType.KIDNEY,t):SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t,!0),i=SuperMapAlgoPlot.PlottingUtil.clearSamePts(i),this.addCell(SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL,i);for(var o=0;o<4;o++){var n=Math.floor(o*i.length/4),l=new SuperMapAlgoPlot.Point(i[n].x,i[n].y),s=new SuperMapAlgoPlot.Point(i[n+1].x,i[n+1].y),a=new SuperMapAlgoPlot.Point((l.x+s.x)/2,(l.y+s.y)/2),r=SuperMapAlgoPlot.PlottingUtil.radian(s,a)*SuperMapAlgoPlot.PlottingUtil.RTOD,u=this.scaleValues[0]*e/2,p=SuperMapAlgoPlot.PlottingUtil.circlePoint(a,u,u,r),h=SuperMapAlgoPlot.PlottingUtil.circlePoint(a,4*u,4*u,r+270),c=SuperMapAlgoPlot.PlottingUtil.circlePoint(a,u,u,r+180);this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,[p,h,c])}this.finish()}}}])&&th(i.prototype,o),n&&th(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();function sh(t){"@babel/helpers - typeof";return(sh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ah(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,rh(o.key),o)}}function rh(t){var e=function(t,e){if("object"!=sh(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=sh(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==sh(e)?e:e+""}function uh(t,e,i){return e=ph(e),function(t,e){if(e&&("object"===sh(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],ph(t).constructor):e.apply(t,i))}function ph(t){return(ph=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function hh(t,e){return(hh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}SuperMapAlgoPlot.AlgoSymbol330=lh;var ch=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),0===(i=uh(this,e,[t])).scaleValues.length&&i.scaleValues.push(.05),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hh(t,e)}(e,SuperMapAlgoPlot.AlgoSymbol),i=e,(o=[{key:"calculateParts",value:function(){this.init();var t=SuperMapAlgoPlot.PlottingUtil.clonePoints(this.controlPoints);if(!((t=SuperMapAlgoPlot.PlottingUtil.clearSamePts(t)).length<this.minEditPts)){SuperMapAlgoPlot.PlottingUtil.polylineDistance(t);this.isEdit||(this.scaleValues[0]=.25*this.getSubSymbolScaleValue());var e=[];e=3>=t.length?SuperMapAlgoPlot.Primitives.getSpatialData(SuperMapAlgoPlot.SymbolType.KIDNEY,t):SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t,!0),e=SuperMapAlgoPlot.PlottingUtil.clearSamePts(e);var i=20*this.getSubSymbolScaleValue(),o=.1*this.getSubSymbolScaleValue(),n=SuperMapAlgoPlot.PlottingUtil.polylineDistance(e);i>.05*n?o=.01*(i=.05*n):i<.005*n&&(i=.005*n);for(var l=SuperMapAlgoPlot.PlottingUtil.makeDottedLine(e,i),s=0;s<l.length;s++)if(this.addCell(SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL,l[s]),s>0){var a=l[s-1][l[s-1].length-1],r=l[s][0],u=SuperMapAlgoPlot.PlottingUtil.midPoint(a,r);this.addCell(SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL,[u,new SuperMapAlgoPlot.Point(u.x+o,u.y)],{lineTypeLimit:!0,surroundLineLimit:!0,fillLimit:!0,fillColorLimit:!1,fill:!0})}this.finish()}}}])&&ah(i.prototype,o),n&&ah(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}();SuperMapAlgoPlot.AlgoSymbol329=ch;var yh=SuperMapAlgoPlot.BasicAlgoSymbolFactory=SuperMapAlgoPlot.BasicAlgoSymbolFactory||{};SuperMapAlgoPlot.BasicAlgoSymbolFactory.getAlgoSymbol=function(t,e,i){if(0===t)switch(e){case SuperMapAlgoPlot.SymbolType.ANNOFRAMESYMBOL:return new SuperMapAlgoPlot.GeoTooltipBox(i);case SuperMapAlgoPlot.SymbolType.ANNOFRAMESYMBOLM:return new SuperMapAlgoPlot.GeoTooltipBoxM(i);case SuperMapAlgoPlot.SymbolType.PATHTEXT:return new SuperMapAlgoPlot.PathText(i);case SuperMapAlgoPlot.SymbolType.ARROWLINE:return new SuperMapAlgoPlot.ArrowLine(i);case SuperMapAlgoPlot.SymbolType.CURVEEIGHT:return new SuperMapAlgoPlot.CurveEight(i);case SuperMapAlgoPlot.SymbolType.RUNWAY:return new SuperMapAlgoPlot.Runway(i);case SuperMapAlgoPlot.SymbolType.CONCENTRICCIRCLE:return new SuperMapAlgoPlot.ConcentricCircle(i);case SuperMapAlgoPlot.SymbolType.COMBINATIONALCIRCLE:return new SuperMapAlgoPlot.CombinationalCircle(i);case SuperMapAlgoPlot.SymbolType.FREECURVE:return new SuperMapAlgoPlot.FreeCurve(i);case SuperMapAlgoPlot.SymbolType.REGULARPOLYGON:return new SuperMapAlgoPlot.RegularPolygon(i);case SuperMapAlgoPlot.SymbolType.BRACESYMBOL:return new SuperMapAlgoPlot.Brace(i);case SuperMapAlgoPlot.SymbolType.TRAPEZOIDSYMBOL:return new SuperMapAlgoPlot.Trapezoid(i);case SuperMapAlgoPlot.SymbolType.SYMBOLTEXTBOX:return new SuperMapAlgoPlot.SymbolTextBox(i);case SuperMapAlgoPlot.SymbolType.NODECHAIN:return new SuperMapAlgoPlot.NodeChain(i);case SuperMapAlgoPlot.SymbolType.LINERELATION:return new SuperMapAlgoPlot.LineRelation(i);case SuperMapAlgoPlot.SymbolType.LINEMARKING:return new SuperMapAlgoPlot.LineMarking(i);case SuperMapAlgoPlot.SymbolType.POLYGONREGION:return new SuperMapAlgoPlot.PolygonRegion(i);case SuperMapAlgoPlot.SymbolType.WIRE:return new SuperMapAlgoPlot.Wire(i);case SuperMapAlgoPlot.SymbolType.LINEARARROW:return new SuperMapAlgoPlot.LinearArrow(i);case SuperMapAlgoPlot.SymbolType.POLYBEZIERSYMBOL:return new SuperMapAlgoPlot.Polybezier(i);case SuperMapAlgoPlot.SymbolType.NEWPIESYMBOL:return new SuperMapAlgoPlot.NewPie(i);case SuperMapAlgoPlot.SymbolType.NEWARCSYMBOL:return new SuperMapAlgoPlot.NewArc(i);case SuperMapAlgoPlot.SymbolType.NEWCHORDSYMBOL:return new SuperMapAlgoPlot.NewChord(i);default:return new SuperMapAlgoPlot.AlgoSymbol(i)}else if(22===t)switch(e){case 1001:return new SuperMapAlgoPlot.AlgoSymbol1001(i);case 1002:return new SuperMapAlgoPlot.AlgoSymbol1002(i);case 1003:return new SuperMapAlgoPlot.AlgoSymbol1003(i);case 1004:return new SuperMapAlgoPlot.AlgoSymbol1004(i);case 1005:return new SuperMapAlgoPlot.AlgoSymbol1005(i);case 1006:return new SuperMapAlgoPlot.AlgoSymbol1006(i);case 1007:return new SuperMapAlgoPlot.AlgoSymbol1007(i);case 1008:return new SuperMapAlgoPlot.AlgoSymbol1008(i);case 1009:return new SuperMapAlgoPlot.AlgoSymbol1009(i);case 1010:return new SuperMapAlgoPlot.AlgoSymbol1010(i);case 1011:return new SuperMapAlgoPlot.AlgoSymbol1011(i);case 1012:return new SuperMapAlgoPlot.AlgoSymbol1012(i);case 1013:return new SuperMapAlgoPlot.AlgoSymbol1013(i);case 1014:return new SuperMapAlgoPlot.AlgoSymbol1014(i);case 1015:return new SuperMapAlgoPlot.AlgoSymbol1015(i);case 1016:return new SuperMapAlgoPlot.AlgoSymbol1016(i);case 1017:return new SuperMapAlgoPlot.AlgoSymbol1017(i);case 1018:return new SuperMapAlgoPlot.AlgoSymbol1018(i);case 1019:return new SuperMapAlgoPlot.AlgoSymbol1019(i);case 1020:return new SuperMapAlgoPlot.AlgoSymbol1020(i);case 1021:return new SuperMapAlgoPlot.AlgoSymbol1021(i);case 1022:return new SuperMapAlgoPlot.AlgoSymbol1022(i);default:return null}else if(421===t)switch(e){case 311:return new SuperMapAlgoPlot.AlgoSymbol1004(i);case 315:return new SuperMapAlgoPlot.AlgoSymbol315(i);case 317:return new SuperMapAlgoPlot.AlgoSymbol1006(i);case 318:return new SuperMapAlgoPlot.AlgoSymbol1002(i);case 319:return new SuperMapAlgoPlot.AlgoSymbol15200(i);case 320:return new SuperMapAlgoPlot.AlgoSymbol320(i);case 321:return new SuperMapAlgoPlot.AlgoSymbol321(i);case 322:return new SuperMapAlgoPlot.AlgoSymbol322(i);case 323:return new SuperMapAlgoPlot.AlgoSymbol25701(i);case 324:return new SuperMapAlgoPlot.AlgoSymbol3010106(i);case 325:return new SuperMapAlgoPlot.AlgoSymbol15200(i);case 326:return new SuperMapAlgoPlot.AlgoSymbol326(i);case 327:return new SuperMapAlgoPlot.AlgoSymbol327(i);case 328:return new SuperMapAlgoPlot.AlgoSymbol328(i);case 329:return new SuperMapAlgoPlot.AlgoSymbol329(i);case 330:return new SuperMapAlgoPlot.AlgoSymbol330(i);case 331:return new SuperMapAlgoPlot.AlgoSymbol29101(i);default:return null}else{if(80!==t)return null;switch(e){case 5001:return new SuperMapAlgoPlot.AlgoSymbol1005(i);case 5002:return new SuperMapAlgoPlot.AlgoSymbol25000(i);default:return null}}},SuperMapAlgoPlot.BasicAlgoSymbolFactory.getSymbolWayType=function(t,e){if(0===t)switch(e){case SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL:case SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL:return SuperMapAlgoPlot.AddPoint_WayType.POLYLINE;case SuperMapAlgoPlot.SymbolType.POLYBEZIERSYMBOL:case SuperMapAlgoPlot.SymbolType.POLYBEZIERCLOSESYMBOL:return SuperMapAlgoPlot.AddPoint_WayType.CURVE;default:return SuperMapAlgoPlot.AddPoint_WayType.UNKNOWN}else if(22===t)switch(e){case 1005:case 1008:case 1012:case 1014:return SuperMapAlgoPlot.AddPoint_WayType.CURVE;case 1007:case 1009:case 1013:case 1015:case 1017:return SuperMapAlgoPlot.AddPoint_WayType.POLYLINE;default:return SuperMapAlgoPlot.AddPoint_WayType.UNKNOWN}},SuperMapAlgoPlot.BasicAlgoSymbolFactory.isAccessServer=function(t,e){if(0===t||22===t||80===t)return!1;if(421!==t)return!0;switch(e){case 311:case 317:case 318:case 315:case 319:case 320:case 321:case 322:case 323:case 324:case 325:case 326:case 327:case 328:case 329:case 330:case 331:return!1;default:return!0}},SuperMapAlgoPlot.BasicAlgoSymbolFactory.getDefaultSubSymbols=function(){return[]},SuperMapAlgoPlot.BasicAlgoSymbolFactory.getMinEditPts=function(t,e){if(0===t)switch(e){case SuperMapAlgoPlot.SymbolType.TEXTSYMBOL:case SuperMapAlgoPlot.SymbolType.COMBINATIONALCIRCLE:return 1;case SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL:case SuperMapAlgoPlot.SymbolType.RECTANGLESYMBOL:case SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL:case SuperMapAlgoPlot.SymbolType.POLYBEZIERSYMBOL:case SuperMapAlgoPlot.SymbolType.KIDNEY:case SuperMapAlgoPlot.SymbolType.ARROWLINE:case SuperMapAlgoPlot.SymbolType.BRACESYMBOL:case SuperMapAlgoPlot.SymbolType.CURVEEIGHT:case SuperMapAlgoPlot.SymbolType.FREECURVE:case SuperMapAlgoPlot.SymbolType.LINEMARKING:case SuperMapAlgoPlot.SymbolType.LINERELATION:case SuperMapAlgoPlot.SymbolType.NODECHAIN:case SuperMapAlgoPlot.SymbolType.PATHTEXT:case SuperMapAlgoPlot.SymbolType.REGULARPOLYGON:case SuperMapAlgoPlot.SymbolType.RUNWAY:case SuperMapAlgoPlot.SymbolType.SYMBOLTEXTBOX:case SuperMapAlgoPlot.SymbolType.ANNOFRAMESYMBOLM:case SuperMapAlgoPlot.SymbolType.CONCENTRICCIRCLE:case SuperMapAlgoPlot.SymbolType.WIRE:case SuperMapAlgoPlot.SymbolType.LINEARARROW:return 2;case SuperMapAlgoPlot.SymbolType.ARCSYMBOL:case SuperMapAlgoPlot.SymbolType.CHORDSYMBOL:case SuperMapAlgoPlot.SymbolType.PIESYMBOL:case SuperMapAlgoPlot.SymbolType.ELLIPSESYMBOL:case SuperMapAlgoPlot.SymbolType.PARALLELOGRAM:case SuperMapAlgoPlot.SymbolType.PARALLELLINE:case SuperMapAlgoPlot.SymbolType.POLYBEZIERCLOSESYMBOL:case SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL:case SuperMapAlgoPlot.SymbolType.POLYGONREGION:case SuperMapAlgoPlot.SymbolType.TRAPEZOIDSYMBOL:case SuperMapAlgoPlot.SymbolType.ANNOFRAMESYMBOL:case SuperMapAlgoPlot.SymbolType.NEWARCSYMBOL:case SuperMapAlgoPlot.SymbolType.NEWPIESYMBOL:case SuperMapAlgoPlot.SymbolType.NEWCHORDSYMBOL:return 3}else if(22===t)switch(e){case 1001:case 1003:case 1005:case 1007:case 1008:case 1009:case 1011:case 1012:case 1013:case 1014:case 1015:case 1016:case 1017:case 1019:case 1020:case 1022:return 2;case 1002:case 1004:case 1006:case 1010:case 1018:case 1021:return 3}else if(421===t)switch(e){case 319:case 320:case 321:case 324:case 325:case 326:case 327:case 328:case 329:case 330:case 331:return 2;case 311:case 315:case 317:case 318:case 322:case 323:return 3}else if(80===t)switch(e){case 5001:case 5002:return 2}},SuperMapAlgoPlot.BasicAlgoSymbolFactory.getMaxEditPts=function(t,e){if(0===t)switch(e){case SuperMapAlgoPlot.SymbolType.TEXTSYMBOL:return 1;case SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL:case SuperMapAlgoPlot.SymbolType.RECTANGLESYMBOL:case SuperMapAlgoPlot.SymbolType.BRACESYMBOL:case SuperMapAlgoPlot.SymbolType.LINEMARKING:case SuperMapAlgoPlot.SymbolType.LINERELATION:case SuperMapAlgoPlot.SymbolType.RUNWAY:case SuperMapAlgoPlot.SymbolType.SYMBOLTEXTBOX:case SuperMapAlgoPlot.SymbolType.ANNOFRAMESYMBOLM:case SuperMapAlgoPlot.SymbolType.LINEARARROW:return 2;case SuperMapAlgoPlot.SymbolType.ARCSYMBOL:case SuperMapAlgoPlot.SymbolType.CHORDSYMBOL:case SuperMapAlgoPlot.SymbolType.PIESYMBOL:case SuperMapAlgoPlot.SymbolType.ELLIPSESYMBOL:case SuperMapAlgoPlot.SymbolType.PARALLELOGRAM:case SuperMapAlgoPlot.SymbolType.KIDNEY:case SuperMapAlgoPlot.SymbolType.CURVEEIGHT:case SuperMapAlgoPlot.SymbolType.ANNOFRAMESYMBOL:case SuperMapAlgoPlot.SymbolType.TRAPEZOIDSYMBOL:case SuperMapAlgoPlot.SymbolType.NEWARCSYMBOL:case SuperMapAlgoPlot.SymbolType.NEWPIESYMBOL:case SuperMapAlgoPlot.SymbolType.NEWCHORDSYMBOL:return 3;case SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL:case SuperMapAlgoPlot.SymbolType.POLYBEZIERSYMBOL:case SuperMapAlgoPlot.SymbolType.PARALLELLINE:case SuperMapAlgoPlot.SymbolType.POLYBEZIERCLOSESYMBOL:case SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL:case SuperMapAlgoPlot.SymbolType.ARROWLINE:case SuperMapAlgoPlot.SymbolType.COMBINATIONALCIRCLE:case SuperMapAlgoPlot.SymbolType.FREECURVE:case SuperMapAlgoPlot.SymbolType.NODECHAIN:case SuperMapAlgoPlot.SymbolType.PATHTEXT:case SuperMapAlgoPlot.SymbolType.POLYGONREGION:case SuperMapAlgoPlot.SymbolType.REGULARPOLYGON:case SuperMapAlgoPlot.SymbolType.WIRE:case SuperMapAlgoPlot.SymbolType.CONCENTRICCIRCLE:return 9999}else if(22===t)switch(e){case 1003:case 1019:case 1020:case 1022:return 2;case 1006:case 1021:return 4;case 1001:case 1002:case 1004:case 1005:case 1007:case 1008:case 1009:case 1010:case 1011:case 1012:case 1013:case 1014:case 1015:case 1016:case 1017:case 1018:return 99999}else if(421===t)switch(e){case 320:return 2;case 329:case 330:case 331:return 3;case 317:return 4;case 323:return 1e3;case 311:case 315:case 318:case 319:case 321:case 322:case 324:case 325:case 326:case 327:case 328:return 99999}else if(80===t)switch(e){case 5001:return 99999;case 5002:return 2}},SuperMapAlgoPlot.BasicAlgoSymbolFactory.getDefaultStyle=function(t,e){var i={};if(421===t)switch(e){case 320:case 321:i.color=i.strokeColor="#000000";break;case 322:i.color=i.strokeColor="#bc744d"}return i},SuperMapAlgoPlot.BasicAlgoSymbolFactory.zoomInCalSymbol=function(){if(22!==libID)return!1;switch(code){case 1012:case 1013:case 1014:case 1015:return!0;default:return!1}},SuperMapAlgoPlot.BasicAlgoSymbolFactory.zoomCalSymbol=function(){return!1},SuperMapAlgoPlot.BasicAlgoSymbolFactory.getSymbolName=function(t,e){var i="";if(0===t)switch(e){case SuperMapAlgoPlot.SymbolType.TEXTSYMBOL:i="文本";break;case SuperMapAlgoPlot.SymbolType.CIRCLESYMBOL:i="圆";break;case SuperMapAlgoPlot.SymbolType.RECTANGLESYMBOL:i="矩形";break;case SuperMapAlgoPlot.SymbolType.ARCSYMBOL:i="弧线";break;case SuperMapAlgoPlot.SymbolType.CHORDSYMBOL:i="弓形";break;case SuperMapAlgoPlot.SymbolType.PIESYMBOL:i="扇形";break;case SuperMapAlgoPlot.SymbolType.ELLIPSESYMBOL:i="椭圆";break;case SuperMapAlgoPlot.SymbolType.PARALLELOGRAM:i="平行四边形";break;case SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL:i="多边形";break;case SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL:i="折线";break;case SuperMapAlgoPlot.SymbolType.POLYBEZIERSYMBOL:i="贝赛尔曲线";break;case SuperMapAlgoPlot.SymbolType.POLYBEZIERCLOSESYMBOL:i="闭合贝塞尔曲线";break;case SuperMapAlgoPlot.SymbolType.PARALLELLINE:i="平行线";break;case SuperMapAlgoPlot.SymbolType.KIDNEY:i="集结地";break;case SuperMapAlgoPlot.SymbolType.ANNOFRAMESYMBOL:i="注记指示框";break;case SuperMapAlgoPlot.SymbolType.ARROWLINE:i="箭头线";break;case SuperMapAlgoPlot.SymbolType.COMBINATIONALCIRCLE:i="组合圆";break;case SuperMapAlgoPlot.SymbolType.CONCENTRICCIRCLE:i="同心圆";break;case SuperMapAlgoPlot.SymbolType.CURVEEIGHT:i="八字形";break;case SuperMapAlgoPlot.SymbolType.FREECURVE:i="自由线";break;case SuperMapAlgoPlot.SymbolType.ANNOFRAMESYMBOLM:i="多角标注框";break;case SuperMapAlgoPlot.SymbolType.LINEMARKING:i="线型标注";break;case SuperMapAlgoPlot.SymbolType.LINERELATION:i="对象间连线";break;case SuperMapAlgoPlot.SymbolType.NODECHAIN:i="节点链";break;case SuperMapAlgoPlot.SymbolType.PATHTEXT:i="沿线注记";break;case SuperMapAlgoPlot.SymbolType.POLYGONREGION:i="多边形区域管理";break;case SuperMapAlgoPlot.SymbolType.RUNWAY:i="跑道线";break;case SuperMapAlgoPlot.SymbolType.SYMBOLTEXTBOX:i="标注框";break;case SuperMapAlgoPlot.SymbolType.REGULARPOLYGON:i="正多边形";break;case SuperMapAlgoPlot.SymbolType.BRACESYMBOL:i="大括号";break;case SuperMapAlgoPlot.SymbolType.TRAPEZOIDSYMBOL:i="梯形";break;case SuperMapAlgoPlot.SymbolType.WIRE:i="铁丝网";break;case SuperMapAlgoPlot.SymbolType.LINEARARROW:i="直线箭头";break;case SuperMapAlgoPlot.SymbolType.NEWPIESYMBOL:i="扇形";break;case SuperMapAlgoPlot.SymbolType.NEWARCSYMBOL:i="弧线";break;case SuperMapAlgoPlot.SymbolType.NEWCHORDSYMBOL:i="弓形"}return i},SuperMapAlgoPlot.BasicAlgoSymbolFactory.getMaxSubSymbols=function(t,e){if(0!=t)return 0;switch(e){case SuperMapAlgoPlot.SymbolType.NODECHAIN:return 1}};var gh=SuperMapAlgoPlot.AlgoSymbolFactory=SuperMapAlgoPlot.AlgoSymbolFactory||{};SuperMapAlgoPlot.AlgoSymbolFactory.getAlgoSymbol=function(t){var e=t.libID,i=t.code;return 0!==e&&22!==e&&421!==e&&80!==e||void 0===SuperMapAlgoPlot.BasicAlgoSymbolFactory?100===e&&void 0!==SuperMapAlgoPlot.JBAlgoSymbolFactory?SuperMapAlgoPlot.JBAlgoSymbolFactory.getAlgoSymbol(e,i,t):123===e&&void 0!==SuperMapAlgoPlot.WJAlgoSymbolFactory?SuperMapAlgoPlot.WJAlgoSymbolFactory.getAlgoSymbol(e,i,t):999===e&&void 0!==SuperMapAlgoPlot.YJAlgoSymbolFactory?SuperMapAlgoPlot.YJAlgoSymbolFactory.getAlgoSymbol(e,i,t):null:SuperMapAlgoPlot.BasicAlgoSymbolFactory.getAlgoSymbol(e,i,t)},SuperMapAlgoPlot.AlgoSymbolFactory.getSymbolWayType=function(t,e){if(0===t)switch(e){case SuperMapAlgoPlot.SymbolType.POLYLINESYMBOL:case SuperMapAlgoPlot.SymbolType.ARBITRARYPOLYGONSYMBOL:return SuperMapAlgoPlot.AddPoint_WayType.POLYLINE;case SuperMapAlgoPlot.SymbolType.POLYBEZIERSYMBOL:case SuperMapAlgoPlot.SymbolType.POLYBEZIERCLOSESYMBOL:return SuperMapAlgoPlot.AddPoint_WayType.CURVE;default:return SuperMapAlgoPlot.AddPoint_WayType.UNKNOWN}if(22===t)switch(e){case 1005:case 1008:case 1012:case 1014:return SuperMapAlgoPlot.AddPoint_WayType.CURVE;case 1007:case 1009:case 1013:case 1015:return SuperMapAlgoPlot.AddPoint_WayType.POLYLINE;default:return SuperMapAlgoPlot.AddPoint_WayType.UNKNOWN}if(100===t)switch(e){case 24:case 40304:case 1e3:case 1007:case 1009:case 1016:case 12502:case 20300:case 26400:case 41100:case 50308:case 2092101:case 60301:case 6030101:case 6030102:case 6030103:case 6030104:case 6030105:case 6030106:case 6030107:case 1013:case 1015:case 520100:case 520200:case 21216:case 2121601:case 2121602:case 30020:case 3002001:case 3002002:case 3002005:case 30025:case 3002501:case 30026:case 3002601:case 30027:case 3002701:case 3002702:case 3002703:case 3002704:case 3002705:case 40104:case 36401:case 34700:case 32900:case 6020404:case 30013:case 3001302:case 30014:case 1001:case 1017:case 16e3:case 16001:case 25202:return SuperMapAlgoPlot.AddPoint_WayType.POLYLINE;case 32:case 3020901:case 25501:case 25502:case 25503:case 25601:case 25701:case 2570201:case 2570301:case 2570401:case 2570501:case 25801:case 25901:case 44400:case 41200:case 41201:case 41202:case 30010:case 30011:case 30012:case 3001101:case 3001102:case 3001103:case 3001104:case 3001105:case 5035205:case 16100:case 35304:case 35200:case 50225:case 5020801:case 42700:case 25500:case 25600:case 25700:case 25800:case 25900:return SuperMapAlgoPlot.AddPoint_WayType.POLYLINE_CLOSE;case 40301:case 4030301:case 4030302:case 4030303:case 5010301:case 5010303:case 5010304:case 1005:case 1008:case 15200:case 15201:case 21400:case 21401:case 21500:case 21501:case 21502:case 21503:case 21504:case 21900:case 21600:case 26500:case 26501:case 26502:case 26503:case 26600:case 3000801:case 3000802:case 3000803:case 3000804:case 3000805:case 3000806:case 3000807:case 3000808:case 3000809:case 5034203:case 50355:case 5035501:case 60205:case 1012:case 1014:case 3010102:case 3010103:case 3010104:case 3010105:case 3010106:case 3010107:case 3010108:case 3010301:case 3010302:case 3010303:case 3010304:case 50102:case 4021101:case 510100:case 520300:case 530100:case 530200:case 16203:case 22e3:case 22103:case 25201:case 24700:case 25400:case 44200:case 31803:case 30800:case 30201:case 30200:case 5022002:case 3002004:case 5030301:case 50328:case 5033001:case 5022001:case 4021102:case 29003:case 30009:case 5035201:case 520500:case 23800:case 36400:case 35e3:case 33400:case 30100:case 30102:case 30002:case 30001:case 3e4:case 29903:case 5021803:case 50321:case 5032003:case 4020303:case 4020400:case 4020401:case 4020402:case 34902:case 34901:case 34900:case 12501:case 15800:case 15801:case 15802:case 15803:case 15804:case 15805:case 15806:case 15900:case 2091503:case 28900:case 16201:case 39600:case 38600:case 36700:case 26601:case 16200:case 17700:case 90213:return SuperMapAlgoPlot.AddPoint_WayType.CURVE;case 50342:case 5034201:case 5034202:case 610100:case 29103:case 28300:case 28200:case 17400:case 17401:case 17402:case 17500:case 17501:case 22200:case 23400:case 23500:case 2350001:case 23600:case 23700:case 27300:case 2730101:case 27701:case 28400:case 44300:case 42400:case 42200:case 40100:case 40101:case 39101:case 39e3:case 37700:case 37601:case 37600:case 5020802:case 50223:case 5022301:case 50226:case 21221:case 2122101:case 50108:case 3032e3:case 4011100:case 4011101:case 4022101:case 4022102:case 4022100:case 16500:case 80203:case 8020301:return SuperMapAlgoPlot.AddPoint_WayType.CURVE_CLOSE;case 17703:case 17704:case 39801:case 39802:case 39800:case 40900:case 4e4:return SuperMapAlgoPlot.AddPoint_WayType.CURVE_WITHCONTROLPT;default:return SuperMapAlgoPlot.AddPoint_WayType.UNKNOWN}if(123===t)switch(e){case 21003:case 21207:case 2120701:case 2121503:case 21218:case 30008:case 3000801:case 3000802:case 3000803:case 3000804:case 3000805:case 3000806:case 3000807:case 3000808:case 3000809:case 30009:case 5021803:case 5022001:case 5022002:case 40301:case 4030101:case 4030102:case 4030103:case 4030104:case 40303:case 4030301:case 4030302:case 4030303:case 50101:case 5010101:case 50102:case 5010201:case 5010202:case 5010203:case 5010204:case 50103:case 5010301:case 5010302:case 5010303:case 5010304:case 50107:case 5010701:case 50210:case 50220:case 50221:case 50225:case 5030102:case 50303:case 5030301:case 50309:case 50320:case 5032001:case 5032002:case 5032003:case 50321:case 5032101:case 5032102:case 50322:case 5032201:case 50330:case 5033001:case 5034203:case 5035201:case 5035204:case 60205:case 90105:return SuperMapAlgoPlot.AddPoint_WayType.CURVE;case 20915:case 2091502:case 2092101:case 2120702:case 21216:case 2121601:case 2121602:case 21605:case 30010:case 30011:case 3001101:case 3001102:case 3001103:case 3001104:case 3001105:case 30012:case 30020:case 3002001:case 3002002:case 3002005:case 30025:case 3002501:case 30026:case 40104:case 40302:case 4030201:case 4030202:case 4030203:case 4030204:case 50227:case 5035205:case 60301:case 6030101:case 6030102:case 6030103:case 6030104:case 6030105:case 6030106:case 6030107:case 70202:case 7020201:case 7020202:case 90107:return SuperMapAlgoPlot.AddPoint_WayType.POLYLINE;default:return SuperMapAlgoPlot.AddPoint_WayType.UNKNOWN}},SuperMapAlgoPlot.AlgoSymbolFactory.isAccessServer=function(t,e){return 0!==t&&22!==t&&421!==t&&80!==t||void 0===SuperMapAlgoPlot.BasicAlgoSymbolFactory?100===t&&void 0!==SuperMapAlgoPlot.JBAlgoSymbolFactory?SuperMapAlgoPlot.JBAlgoSymbolFactory.isAccessServer(t,e):123===t&&void 0!==SuperMapAlgoPlot.WJAlgoSymbolFactory?SuperMapAlgoPlot.WJAlgoSymbolFactory.isAccessServer(t,e):999!==t||void 0===SuperMapAlgoPlot.YJAlgoSymbolFactory||SuperMapAlgoPlot.YJAlgoSymbolFactory.isAccessServer(t,e):SuperMapAlgoPlot.BasicAlgoSymbolFactory.isAccessServer(t,e)},SuperMapAlgoPlot.AlgoSymbolFactory.getDefaultSubSymbols=function(t,e){return 100===t&&void 0!==SuperMapAlgoPlot.JBAlgoSymbolFactory?SuperMapAlgoPlot.JBAlgoSymbolFactory.getDefaultSubSymbols(t,e):123===t&&void 0!==SuperMapAlgoPlot.WJAlgoSymbolFactory?SuperMapAlgoPlot.WJAlgoSymbolFactory.getDefaultSubSymbols(t,e):999===t&&void 0!==SuperMapAlgoPlot.YJAlgoSymbolFactory?SuperMapAlgoPlot.YJAlgoSymbolFactory.getDefaultSubSymbols(t,e):[]},SuperMapAlgoPlot.AlgoSymbolFactory.getMaxSubSymbols=function(t,e){return 0!==t&&22!==t&&421!==t&&80!==t||void 0===SuperMapAlgoPlot.BasicAlgoSymbolFactory?100===t&&void 0!==SuperMapAlgoPlot.JBAlgoSymbolFactory?SuperMapAlgoPlot.JBAlgoSymbolFactory.getMaxSubSymbols(t,e):123===t&&void 0!==SuperMapAlgoPlot.WJAlgoSymbolFactory?SuperMapAlgoPlot.WJAlgoSymbolFactory.getMaxSubSymbols(t,e):0:SuperMapAlgoPlot.BasicAlgoSymbolFactory.getMaxSubSymbols(t,e)},SuperMapAlgoPlot.AlgoSymbolFactory.getMinEditPts=function(t,e){return 0!==t&&22!==t&&421!==t&&80!==t||void 0===SuperMapAlgoPlot.BasicAlgoSymbolFactory?100===t&&void 0!==SuperMapAlgoPlot.JBAlgoSymbolFactory?SuperMapAlgoPlot.JBAlgoSymbolFactory.getMinEditPts(t,e):123===t&&void 0!==SuperMapAlgoPlot.WJAlgoSymbolFactory?SuperMapAlgoPlot.WJAlgoSymbolFactory.getMinEditPts(t,e):999===t&&void 0!==SuperMapAlgoPlot.YJAlgoSymbolFactory?SuperMapAlgoPlot.YJAlgoSymbolFactory.getMinEditPts(t,e):0:SuperMapAlgoPlot.BasicAlgoSymbolFactory.getMinEditPts(t,e)},SuperMapAlgoPlot.AlgoSymbolFactory.getMaxEditPts=function(t,e){return 0!==t&&22!==t&&421!==t&&80!==t||void 0===SuperMapAlgoPlot.BasicAlgoSymbolFactory?100===t&&void 0!==SuperMapAlgoPlot.JBAlgoSymbolFactory?SuperMapAlgoPlot.JBAlgoSymbolFactory.getMaxEditPts(t,e):123===t&&void 0!==SuperMapAlgoPlot.WJAlgoSymbolFactory?SuperMapAlgoPlot.WJAlgoSymbolFactory.getMaxEditPts(t,e):999===t&&void 0!==SuperMapAlgoPlot.YJAlgoSymbolFactory?SuperMapAlgoPlot.YJAlgoSymbolFactory.getMaxEditPts(t,e):0:SuperMapAlgoPlot.BasicAlgoSymbolFactory.getMaxEditPts(t,e)},SuperMapAlgoPlot.AlgoSymbolFactory.getDefaultStyle=function(t,e){return 0!==t&&22!==t&&421!==t&&80!==t||void 0===SuperMapAlgoPlot.BasicAlgoSymbolFactory?100===t&&void 0!==SuperMapAlgoPlot.JBAlgoSymbolFactory?SuperMapAlgoPlot.JBAlgoSymbolFactory.getDefaultStyle(t,e):123===t&&void 0!==SuperMapAlgoPlot.WJAlgoSymbolFactory?SuperMapAlgoPlot.WJAlgoSymbolFactory.getDefaultStyle(t,e):999===t&&void 0!==SuperMapAlgoPlot.YJAlgoSymbolFactory?SuperMapAlgoPlot.YJAlgoSymbolFactory.getDefaultStyle(t,e):{}:SuperMapAlgoPlot.BasicAlgoSymbolFactory.getDefaultStyle(t,e)},SuperMapAlgoPlot.AlgoSymbolFactory.getSymbolName=function(t,e){return 0!==t&&22!==t&&421!==t&&80!==t||void 0===SuperMapAlgoPlot.BasicAlgoSymbolFactory?"":SuperMapAlgoPlot.BasicAlgoSymbolFactory.getSymbolName(t,e)},SuperMapAlgoPlot.AlgoSymbolFactory.canPolylineConnect=function(t,e){if(100===t)switch(e){case 16500:case 17400:case 17401:case 17500:case 17501:case 23400:case 23500:case 23600:case 23700:case 27300:case 28200:case 28300:case 28400:case 37600:case 37601:case 37700:case 39e3:case 40100:case 40101:case 42200:case 42400:case 2350001:case 2730101:case 3032e3:case 4010800:case 4010801:case 4011100:case 4011101:case 4022100:case 4022101:case 4022102:return!0;default:return!1}else{if(123!==t)return!1;switch(e){case 21220:case 2122001:case 21221:case 2122101:case 50208:case 5020802:case 50209:case 50223:case 5022301:case 50226:case 50314:case 50342:case 5034201:case 5034202:case 80202:case 90305:case 90404:case 9040401:return!0;default:return!1}}},SuperMapAlgoPlot.AlgoSymbolFactory.zoomInCalSymbol=function(t,e){return 0!==t&&22!==t&&421!==t&&80!==t||void 0===SuperMapAlgoPlot.BasicAlgoSymbolFactory?100===t&&void 0!==SuperMapAlgoPlot.JBAlgoSymbolFactory?SuperMapAlgoPlot.JBAlgoSymbolFactory.zoomInCalSymbol(t,e):123===t&&void 0!==SuperMapAlgoPlot.WJAlgoSymbolFactory?SuperMapAlgoPlot.WJAlgoSymbolFactory.zoomInCalSymbol(t,e):999===t&&void 0!==SuperMapAlgoPlot.YJAlgoSymbolFactory?SuperMapAlgoPlot.YJAlgoSymbolFactory.zoomInCalSymbol(t,e):0:SuperMapAlgoPlot.BasicAlgoSymbolFactory.zoomInCalSymbol(t,e)},SuperMapAlgoPlot.AlgoSymbolFactory.zoomCalSymbol=function(t,e){if((0===t||22===t||421===t||80===t)&&void 0!==SuperMapAlgoPlot.BasicAlgoSymbolFactory)return SuperMapAlgoPlot.BasicAlgoSymbolFactory.zoomCalSymbol(t,e);if(100===t)switch(e){case 28e3:case 28100:case 28200:case 28201:case 32300:return!0;default:return!1}else{if(123!==t||void 0===SuperMapAlgoPlot.WJAlgoSymbolFactory)return!1;switch(e){case 50312:case 50313:case 50314:case 50348:return!0;default:return!1}}},SuperMapAlgoPlot.AlgoSymbolFactory.calSurroundLineDir=function(t,e){if(22===t)switch(e){case 1018:case 1020:case 1021:return!1}return SuperMapAlgoPlot.AlgoSymbolFactory.getAlgoWayType(t,e)===SuperMapAlgoPlot.AddPoint_WayType.POLYLINE_CLOSE||SuperMapAlgoPlot.AlgoSymbolFactory.getAlgoWayType(t,e)===SuperMapAlgoPlot.AddPoint_WayType.CURVE_CLOSE},SuperMapAlgoPlot.AlgoSymbolFactory.getAlgoWayType=function(t,e){if(100===t)switch(e){case 24:case 40304:case 1e3:case 1007:case 1009:case 1016:case 12502:case 20300:case 26400:case 41100:case 50308:case 2092101:case 60301:case 6030101:case 6030102:case 6030103:case 6030104:case 6030105:case 6030106:case 6030107:case 1013:case 1015:case 520100:case 520200:case 21216:case 2121601:case 2121602:case 30020:case 3002001:case 3002002:case 3002005:case 30025:case 3002501:case 30026:case 3002601:case 30027:case 3002701:case 3002702:case 3002703:case 3002704:case 3002705:case 40104:case 36401:case 34700:case 32900:case 6020404:case 30013:case 3001302:case 30014:case 1001:case 1017:case 16e3:case 16001:case 25202:return SuperMapAlgoPlot.AddPoint_WayType.POLYLINE;case 32:case 3020901:case 25501:case 25502:case 25503:case 25601:case 25701:case 2570201:case 2570301:case 2570401:case 2570501:case 25801:case 25901:case 44400:case 41200:case 41201:case 41202:case 30010:case 30011:case 30012:case 3001101:case 3001102:case 3001103:case 3001104:case 3001105:case 5035205:case 16100:case 35304:case 35200:case 50225:case 5020801:case 42700:case 25500:case 25600:case 25700:case 25800:case 25900:return SuperMapAlgoPlot.AddPoint_WayType.POLYLINE_CLOSE;case 40301:case 4030301:case 4030302:case 4030303:case 5010301:case 5010303:case 5010304:case 1005:case 1008:case 15200:case 15201:case 21400:case 21401:case 21500:case 21501:case 21502:case 21503:case 21504:case 21900:case 21600:case 26500:case 26501:case 26502:case 26503:case 26600:case 3000801:case 3000802:case 3000803:case 3000804:case 3000805:case 3000806:case 3000807:case 3000808:case 3000809:case 5034203:case 50355:case 5035501:case 60205:case 1012:case 1014:case 3010102:case 3010103:case 3010104:case 3010105:case 3010106:case 3010107:case 3010108:case 3010301:case 3010302:case 3010303:case 3010304:case 50102:case 4021101:case 510100:case 520300:case 530100:case 530200:case 16203:case 22e3:case 22103:case 25201:case 24700:case 25400:case 44200:case 31803:case 30800:case 30201:case 30200:case 5022002:case 3002004:case 5030301:case 50328:case 5033001:case 5022001:case 4021102:case 29003:case 30009:case 5035201:case 520500:case 23800:case 36400:case 35e3:case 33400:case 30100:case 30102:case 30002:case 30001:case 3e4:case 29903:case 5021803:case 50321:case 5032003:case 4020303:case 4020400:case 4020401:case 4020402:case 34902:case 34901:case 34900:case 12501:case 15800:case 15801:case 15802:case 15803:case 15804:case 15805:case 15806:case 15900:case 2091503:case 28900:case 16201:case 39600:case 38600:case 36700:case 26601:case 16200:case 17700:case 90213:return SuperMapAlgoPlot.AddPoint_WayType.CURVE;case 50342:case 5034201:case 5034202:case 610100:case 29103:case 28300:case 28200:case 17400:case 17401:case 17402:case 17500:case 17501:case 22200:case 23400:case 23500:case 2350001:case 23600:case 23700:case 27300:case 2730101:case 27701:case 28400:case 44300:case 42400:case 42200:case 40100:case 40101:case 39101:case 39e3:case 37700:case 37601:case 37600:case 5020802:case 50223:case 5022301:case 50226:case 21221:case 2122101:case 50108:case 3032e3:case 4011100:case 4011101:case 4022101:case 4022102:case 4022100:case 16500:case 80203:case 8020301:return SuperMapAlgoPlot.AddPoint_WayType.CURVE_CLOSE;case 17703:case 17704:case 39801:case 39802:case 39800:case 40900:case 4e4:return SuperMapAlgoPlot.AddPoint_WayType.CURVE_WITHCONTROLPT;default:return SuperMapAlgoPlot.AddPoint_WayType.UNKNOWN}else if(123===t)switch(e){case 50343:case 30010:case 30011:case 3001101:case 3001102:case 3001103:case 3001104:case 3001105:case 30012:case 30023:case 3002301:case 3002302:case 3002303:case 3002304:case 3002305:case 3002306:case 30024:case 3002401:case 3002402:case 3002403:case 40302:case 4030201:case 4030202:case 4030203:case 4030204:case 60201:case 6020101:case 6020102:case 6020103:case 6020104:case 6020105:case 6020106:case 6020107:case 70202:case 7020201:case 7020202:return SuperMapAlgoPlot.AddPoint_WayType.POLYLINE_CLOSE;case 50108:case 50314:case 50315:case 80202:case 80203:case 8020301:case 90305:case 90404:case 9040401:case 70110:return SuperMapAlgoPlot.AddPoint_WayType.CURVE_CLOSE;default:return SuperMapAlgoPlot.AddPoint_WayType.UNKNOWN}return SuperMapAlgoPlot.AddPoint_WayType.UNKNOWN};SuperMap.MD5=SuperMap.MD5||{};var fh=function(t){function e(t,e){return t<<e|t>>>32-e}function i(t,e){var i,o,n,l,s;return n=2147483648&t,l=2147483648&e,s=(1073741823&t)+(1073741823&e),(i=1073741824&t)&(o=1073741824&e)?2147483648^s^n^l:i|o?1073741824&s?3221225472^s^n^l:1073741824^s^n^l:s^n^l}function o(t,o,n,l,s,a,r){return i(e(t=i(t,i(i(function(t,e,i){return t&e|~t&i}(o,n,l),s),r)),a),o)}function n(t,o,n,l,s,a,r){return i(e(t=i(t,i(i(function(t,e,i){return t&i|e&~i}(o,n,l),s),r)),a),o)}function l(t,o,n,l,s,a,r){return i(e(t=i(t,i(i(function(t,e,i){return t^e^i}(o,n,l),s),r)),a),o)}function s(t,o,n,l,s,a,r){return i(e(t=i(t,i(i(function(t,e,i){return e^(t|~i)}(o,n,l),s),r)),a),o)}function a(t){var e,i="",o="";for(e=0;e<=3;e++)i+=(o="0"+(t>>>8*e&255).toString(16)).substr(o.length-2,2);return i}var r,u,p,h,c,y,g,f,d,m=Array();for(m=function(t){for(var e,i=t.length,o=i+8,n=16*((o-o%64)/64+1),l=Array(n-1),s=0,a=0;a<i;)s=a%4*8,l[e=(a-a%4)/4]=l[e]|t.charCodeAt(a)<<s,a++;return s=a%4*8,l[e=(a-a%4)/4]=l[e]|128<<s,l[n-2]=i<<3,l[n-1]=i>>>29,l}(t=function(t){t=t.replace("/\r\n/g","\n");for(var e="",i=0;i<t.length;i++){var o=t.charCodeAt(i);o<128?e+=String.fromCharCode(o):o>127&&o<2048?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e}(t)),y=1732584193,g=4023233417,f=2562383102,d=271733878,r=0;r<m.length;r+=16)u=y,p=g,h=f,c=d,g=s(g=s(g=s(g=s(g=l(g=l(g=l(g=l(g=n(g=n(g=n(g=n(g=o(g=o(g=o(g=o(g,f=o(f,d=o(d,y=o(y,g,f,d,m[r+0],7,3614090360),g,f,m[r+1],12,3905402710),y,g,m[r+2],17,606105819),d,y,m[r+3],22,3250441966),f=o(f,d=o(d,y=o(y,g,f,d,m[r+4],7,4118548399),g,f,m[r+5],12,1200080426),y,g,m[r+6],17,2821735955),d,y,m[r+7],22,4249261313),f=o(f,d=o(d,y=o(y,g,f,d,m[r+8],7,1770035416),g,f,m[r+9],12,2336552879),y,g,m[r+10],17,4294925233),d,y,m[r+11],22,2304563134),f=o(f,d=o(d,y=o(y,g,f,d,m[r+12],7,1804603682),g,f,m[r+13],12,4254626195),y,g,m[r+14],17,2792965006),d,y,m[r+15],22,1236535329),f=n(f,d=n(d,y=n(y,g,f,d,m[r+1],5,4129170786),g,f,m[r+6],9,3225465664),y,g,m[r+11],14,643717713),d,y,m[r+0],20,3921069994),f=n(f,d=n(d,y=n(y,g,f,d,m[r+5],5,3593408605),g,f,m[r+10],9,38016083),y,g,m[r+15],14,3634488961),d,y,m[r+4],20,3889429448),f=n(f,d=n(d,y=n(y,g,f,d,m[r+9],5,568446438),g,f,m[r+14],9,3275163606),y,g,m[r+3],14,4107603335),d,y,m[r+8],20,1163531501),f=n(f,d=n(d,y=n(y,g,f,d,m[r+13],5,2850285829),g,f,m[r+2],9,4243563512),y,g,m[r+7],14,1735328473),d,y,m[r+12],20,2368359562),f=l(f,d=l(d,y=l(y,g,f,d,m[r+5],4,4294588738),g,f,m[r+8],11,2272392833),y,g,m[r+11],16,1839030562),d,y,m[r+14],23,4259657740),f=l(f,d=l(d,y=l(y,g,f,d,m[r+1],4,2763975236),g,f,m[r+4],11,1272893353),y,g,m[r+7],16,4139469664),d,y,m[r+10],23,3200236656),f=l(f,d=l(d,y=l(y,g,f,d,m[r+13],4,681279174),g,f,m[r+0],11,3936430074),y,g,m[r+3],16,3572445317),d,y,m[r+6],23,76029189),f=l(f,d=l(d,y=l(y,g,f,d,m[r+9],4,3654602809),g,f,m[r+12],11,3873151461),y,g,m[r+15],16,530742520),d,y,m[r+2],23,3299628645),f=s(f,d=s(d,y=s(y,g,f,d,m[r+0],6,4096336452),g,f,m[r+7],10,1126891415),y,g,m[r+14],15,2878612391),d,y,m[r+5],21,4237533241),f=s(f,d=s(d,y=s(y,g,f,d,m[r+12],6,1700485571),g,f,m[r+3],10,2399980690),y,g,m[r+10],15,4293915773),d,y,m[r+1],21,2240044497),f=s(f,d=s(d,y=s(y,g,f,d,m[r+8],6,1873313359),g,f,m[r+15],10,4264355552),y,g,m[r+6],15,2734768916),d,y,m[r+13],21,1309151649),f=s(f,d=s(d,y=s(y,g,f,d,m[r+4],6,4149444226),g,f,m[r+11],10,3174756917),y,g,m[r+2],15,718787259),d,y,m[r+9],21,3951481745),y=i(y,u),g=i(g,p),f=i(f,h),d=i(d,c);return(a(y)+a(g)+a(f)+a(d)).toLowerCase()};SuperMap.MD5.md5=fh,L.supermap.plotting=L.supermap.plotting||{};var dh=L.Path.extend({options:{text:"",labelAlign:"cm",labelRotation:0,fontColor:"#000000",fontSize:14,fontOpacity:1,fontFamily:"微软雅黑",fontWeight:"normal",fontStyle:"",fontSpace:0,fontPercent:100,fontStroke:!1,fontStrokeColor:"#ff0000",fontStrokeWidth:2,fontBackground:!1,fontBackgroundColor:"#ff0000",fontShadow:!1,fontShadowColor:"#ff0000",fontShadowOffsetX:0,fontShadowOffsetY:0,interactive:!0},_textNode:null,_backgroundTextNode:null,_shadowTextNode:null,_tspanNodeObj:null,initialize:function(t,e){L.setOptions(this,e),this._latlng=L.latLng(t[0]),this._text=this.options.text,this._tspanNodeObj={}},onAdd:function(){L.Path.prototype.onAdd.call(this)},onRemove:function(){this._removeNode(),L.Path.prototype.onRemove.call(this)},_removeNode:function(){this._textNode&&this._textNode.parentNode&&(L.DomUtil.remove(this._textNode),this.removeInteractiveTarget(this._textNode),delete this._textNode,this._textNode=null),this._backgroundTextNode&&this._backgroundTextNode.parentNode&&(this._renderer._rootGroup.removeChild(this._backgroundTextNode),delete this._backgroundTextNode,this._backgroundTextNode=null),this._shadowTextNode&&this._shadowTextNode.parentNode&&(this._renderer._rootGroup.removeChild(this._shadowTextNode),delete this._shadowTextNode,this._shadowTextNode=null),this._tspanNodeObj={},this._textNode&&(L.DomUtil.remove(this._textNode),this.removeInteractiveTarget(this._textNode),delete this._textNode,this._textNode=null),this._backgroundTextNode&&(delete this._backgroundTextNode,this._backgroundTextNode=null),this._shadowTextNode&&(delete this._shadowTextNode,this._shadowTextNode=null)},setLatLngs:function(t){return this._latlng=L.latLng(t[0]),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLngs:function(){return[this._latlng]},setText:function(t){return this.options.text=this._text=t,this.redraw()},getText:function(){return this._text},setStyle:function(t){var e=t&&t.text||this._text;return L.Path.prototype.setStyle.call(this,t),this.setText(e),this},getBounds:function(){return this._updateBounds(),this._bounds},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},getPxBounds:function(t){this._point=this._map.latLngToLayerPoint(this._latlng);var e=1;this.options.fontPercent&&100!==this.options.fontPercent&&(e=this.options.fontPercent/100);var i,o=0,n=0,l=(i=this.options.text instanceof Array?this.options.text:this.options.text.indexOf(";")>-1?this.options.text.split(";"):this.options.text.indexOf("；")>-1?this.options.text.split("；"):this.options.text.split("\n")).length;if(this._renderer instanceof L.Canvas){var s=[this.options.fontStyle?this.options.fontStyle:"normal","normal",this.options.fontWeight?this.options.fontWeight:"normal",this.options.fontSize?this.options.fontSize+"px":"1em",this.options.fontFamily?this.options.fontFamily:"sans-serif"].join(" ");this._renderer._ctx.font=s,this._renderer._ctx.textAlign=L.Canvas.LABEL_ALIGN[this.options.labelAlign[0]]||"center","微软雅黑"==this.options.fontFamily||"Microsoft YaHei"==this.options.fontFamily?this._renderer._ctx.textBaseline=L.Canvas.LABEL_ALIGN_Microsoft[this.options.labelAlign[1]]||"middle":this._renderer._ctx.textBaseline=L.Canvas.LABEL_ALIGN[this.options.labelAlign[1]]||"middle",this.options.fontSize=parseFloat(this.options.fontSize);var a=0;null==a&&(a=-.5);var r=this._renderer._ctx.measureText("Mg").height||this._renderer._ctx.measureText("xx").width;n=r*a*(l-1)+r*l;for(var u=0;u<l;u++)if(this.options.fontSpace&&0!=this.options.fontSpace||this.options.fontPercent&&100!=this.options.fontPercent){var p=(this._renderer._ctx.measureText(i[u]).width+this.options.fontSpace*(i[u].length-1))*e;o<p&&(o=p)}else{var h=this._renderer._ctx.measureText(i[u]).width;o<h&&(o=h)}}else if(this._renderer instanceof L.SVG){var c=L.SVG.LABEL_VFACTOR[this.options.labelAlign[1]];null==c&&(c=-.5);var y=this.options.fontSize;n=y*c*(l-1)+y*l;for(var g=0;g<l;g++){var f=SuperMap.Plot.PlottingUtil.getTextWidth(this.options,i[g]);o<f&&(o=f)}}else{this.options.fontSize=parseFloat(this.options.fontSize);var d=this.options.fontSize;n=d*(l-1)+d*l;for(var m=0;m<l;m++){var S=SuperMap.Plot.PlottingUtil.getTextWidth(this.options,i[m]);o<S&&(o=S)}}this.options.fontSize<6&&(o=0);var P=0,b=0,v=0,M=0,_=this.options.labelAlign||"cm";for(var A in"lt"===_?(P=this._point.x,v=this._point.x+o,b=this._point.y,M=this._point.y+n):"ct"===_?(P=this._point.x-o/2,b=this._point.y,v=this._point.x+o/2,M=this._point.y+n):"rt"===_?(P=this._point.x-o,b=this._point.y,v=this._point.x,M=this._point.y+n):"lb"===_?(P=this._point.x,b=this._point.y-n,v=this._point.x+o,M=this._point.y):"cb"===_?(P=this._point.x-o/2,b=this._point.y-n,v=this._point.x+o/2,M=this._point.y):"rb"===_?(P=this._point.x-o,b=this._point.y-n,v=this._point.x,M=this._point.y):"lm"===_?(P=this._point.x,b=this._point.y-n/2,v=this._point.x+o,M=this._point.y+n/2):"cm"===_?(P=this._point.x-o/2,b=this._point.y-n/2,v=this._point.x+o/2,M=this._point.y+n/2):"rm"===_&&(P=this._point.x-o,b=this._point.y-n/2,v=this._point.x,M=this._point.y+n/2),t&&this.options.fontShadow&&(0!==this.options.fontShadowOffsetX||0!==this.options.fontShadowOffsetY)&&(this.options.fontShadowOffsetX>0?v+=this.options.fontShadowOffsetX:P+=this.options.fontShadowOffsetX,this.options.fontShadowOffsetY>0?M+=this.options.fontShadowOffsetY:b+=this.options.fontShadowOffsetY),this._eventParents)if(this._eventParents[A].symbolType===SuperMap.Plot.SymbolType.TEXTSYMBOL&&0===this.options.fontPercent&&0===this.options.fontPercent){var T=v-P,x=(T+this.options.fontSpace*(this.options.text.length-1))*this.options.fontPercent/100-T;switch(_){case"lt":case"lm":case"lb":v+=x;break;case"rt":case"rm":case"rb":P-=x;break;case"ct":case"cm":case"cb":P-=x/2,v+=x/2}}var O=new L.Bounds;if(this.options.labelRotation&&0!==this.options.labelRotation){var w=[];w.push(L.point(P,b)),w.push(L.point(P,M)),w.push(L.point(v,b)),w.push(L.point(v,M));for(var C=this.options.labelRotation*(Math.PI/180),E=0;E<w.length;E++)SuperMap.Plot.PlottingUtil.rotateAngle(this._point,C,w[E]),O.extend(w[E])}else O=L.bounds(L.point(P,b),L.point(v,M));return O},_updateBounds:function(){this._pxBounds=this.getPxBounds(!0);var t=this._map.layerPointToLatLng(this._pxBounds.min),e=this._map.layerPointToLatLng(this._pxBounds.max);this._bounds=L.latLngBounds(t,e)},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateText(this)},_empty:function(){return this._text&&!this._renderer._bounds.intersects(this._pxBounds)}});L.supermap.plotting.text=function(t,e){return new dh(t,e)},L.supermap.plotting.Text=dh;var mh=L.Path.extend({options:{externalGraphic:"",graphicWidth:0,graphicHeight:0,graphicOpacity:1,graphicXOffset:void 0,graphicYOffset:void 0,rotation:0,graphicTitle:"",interactive:!0,img:""},_imageNode:null,initialize:function(t,e){L.setOptions(this,e),this._latlng=L.latLng(t[0])},onRemove:function(){this._imageNode&&this._imageNode.parentNode&&(this._renderer._rootGroup.removeChild(this._imageNode),delete this._imageNode,this._imageNode=null),this._imageNode&&(delete this._imageNode,this._imageNode=null),L.Path.prototype.onRemove.call(this)},setLatLngs:function(t){return this._latlng=L.latLng(t[0]),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLngs:function(){return[this._latlng]},getBounds:function(){return this._updateBounds(),this._bounds},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},getPxBounds:function(){this._point=this._map.latLngToLayerPoint(this._latlng),null==this.options.graphicXOffset&&(this.options.graphicXOffset=0),null==this.options.graphicYOffset&&(this.options.graphicYOffset=0);var t=-.5*this.options.graphicWidth+this.options.graphicXOffset,e=-.5*this.options.graphicHeight+this.options.graphicYOffset,i=this._point.x+t,o=this._point.y+e,n=i+this.options.graphicWidth,l=o+this.options.graphicHeight,s=new L.Bounds;if(this.options.rotation&&0!==this.options.rotation){var a=[];a.push(L.point(i,o)),a.push(L.point(i,l)),a.push(L.point(n,o)),a.push(L.point(n,l));for(var r=this.options.rotation*(Math.PI/180),u=0;u<a.length;u++)SuperMap.Plot.PlottingUtil.rotateAngle(new SuperMap.Geometry.Point(this._point.x+this.options.graphicXOffset,this._point.y+this.options.graphicYOffset),r,a[u]),s.extend(a[u])}else s=L.bounds(L.point(i,o),L.point(n,l));return s},_updateBounds:function(){this._pxBounds=this.getPxBounds();var t=this._map.layerPointToLatLng(this._pxBounds.min),e=this._map.layerPointToLatLng(this._pxBounds.max);this._bounds=L.latLngBounds(t,e)},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateImage(this)},_empty:function(){return this.options.externalGraphic&&!this._renderer._bounds.intersects(this._pxBounds)}});L.supermap.plotting.pointImage=function(t,e){return new mh(t,e)},L.supermap.plotting.PointImage=mh;var Sh=L.Class.extend({feature:null,canvas:null,anchor:null,size:null,fromZoom:null,latLng:null,bounds:null,options:{extent:0},initialize:function(t,e){this.feature=t,e=e||{},L.Util.setOptions(this,e),this.canvasEle=document.createElement("canvas"),this.canvasEle.width=0,this.canvasEle.height=0,this._ctx=this.canvasEle.getContext("2d")},_latlngToLayerPoint:function(t,e){null==e&&(e=this.fromZoom);for(var i=this.feature._map.getZoomScale(e,this.feature._map.getZoom()),o=this.latLng,n=[],l=0;l<t.length;l++){var s=o.lat+i*(t[l].lat-o.lat),a=o.lng+i*(t[l].lng-o.lng),r=this.feature._map.latLngToLayerPoint(L.latLng(s,a));r.x=r.x-this.leftTopPixel.x+this.feature.style.weight,r.y=r.y-this.leftTopPixel.y+this.feature.style.weight,n.push(r)}return n},_scaleBounds:function(t){if(this.fromZoom!==this.feature._map.getZoom()){var e=this.feature._map.getZoomScale(this.fromZoom,this.feature._map.getZoom()),i=this.latLng,o=i.lat+e*(t.getNorth()-i.lat),n=i.lat+e*(t.getSouth()-i.lat),l=i.lng+e*(t.getWest()-i.lng),s=i.lng+e*(t.getEast()-i.lng);return L.latLngBounds(L.latLng(o,l),L.latLng(n,s))}return L.latLngBounds(L.latLng(t.getNorth(),t.getWest()),L.latLng(t.getSouth(),t.getEast()))},_drawPolyline:function(t,e){var i=this._latlngToLayerPoint(t.getLatLngs(),t.fromZoom),o=t.options;e.beginPath(),e.globalAlpha=o.opacity,this._addDashArray(t),e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.moveTo(i[0].x,i[0].y);for(var n=1,l=i.length;n<l;n++)e.lineTo(i[n].x,i[n].y);o.fill&&(e.globalCompositeOperation=!0===Boolean(this.feature.surroundLineType)?"destination-over":"source-over"),e.strokeStyle=SuperMap.Plot.PlottingUtil.colorRGBA(o.color,o.opacity),e.lineWidth=o.weight,e.stroke()},_drawRectangle:function(t,e){var i=this._latlngToLayerPoint(t.getLatLngs()[0],t.fromZoom),o=t.options;e.beginPath(),e.globalAlpha=!0===o.fill?o.fillOpacity:o.opacity,this._addDashArray(t),e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.moveTo(i[0].x,i[0].y);for(var n=1,l=i.length;n<l;n++){var s=i[n].x,a=i[n].y;e.lineTo(s,a)}e.closePath(),o.fill&&(e.globalCompositeOperation=!0===Boolean(this.feature.surroundLineType)?"destination-over":"source-over",!0===o.fillLimit&&!0!==o.fillColorLimit?e.fillStyle=SuperMap.Plot.PlottingUtil.colorRGBA(o.color,o.opacity):e.fillStyle=SuperMap.Plot.PlottingUtil.colorRGBA(o.fillColor,o.fillOpacity),e.fill()),e.strokeStyle=SuperMap.Plot.PlottingUtil.colorRGBA(o.color,o.opacity),e.lineWidth=o.weight,e.stroke()},_drawPolygon:function(t,e){var i=this._latlngToLayerPoint(t.getLatLngs()[0],t.fromZoom),o=t.options;e.beginPath(),e.globalAlpha=!0===o.fill?o.fillOpacity:o.opacity,this._addDashArray(t),e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.moveTo(i[0].x,i[0].y);for(var n=1,l=i.length;n<l;n++){var s=i[n].x,a=i[n].y;e.lineTo(s,a)}e.closePath(),o.fill&&(e.globalCompositeOperation=!0===Boolean(this.feature.surroundLineType)?"destination-over":"source-over",!0===o.fillLimit&&!0!==o.fillColorLimit?e.fillStyle=SuperMap.Plot.PlottingUtil.colorRGBA(o.color,o.opacity):e.fillStyle=SuperMap.Plot.PlottingUtil.colorRGBA(o.fillColor,o.fillOpacity),e.fill(o.fillRule||"evenodd")),e.strokeStyle=SuperMap.Plot.PlottingUtil.colorRGBA(o.color,o.opacity),e.lineWidth=o.weight,e.stroke()},_drawText:function(t,e){var i=this._latlngToLayerPoint(t.getLatLngs(),t.fromZoom)[0],o=this._latlngToLayerPoint([t._bounds._northEast],t.fromZoom)[0],n=this._latlngToLayerPoint([t._bounds._southWest],t.fromZoom)[0],l=t.options,s=(l=SuperMap.Util.extend({fontColor:"#000000",labelAlign:"cm"},l)).fontSize.toLocaleString()+"px",a=[l.fontStyle?l.fontStyle:"normal","normal",l.fontWeight?l.fontWeight:"normal",l.fontSize?s:"1em",l.fontFamily?l.fontFamily:"sans-serif"].join(" ");e.globalAlpha=l.fontOpacity,e.fillStyle=SuperMap.Plot.PlottingUtil.colorRGBA(l.fontColor,l.fontOpacity),e.font=a,e.fillText&&(e.textAlign=L.Canvas.LABEL_ALIGN[l.labelAlign[0]]||"center"),"微软雅黑"==l.fontFamily||"Microsoft YaHei"==l.fontFamily?e.textBaseline=L.Canvas.LABEL_ALIGN_Microsoft[l.labelAlign[1]]||"middle":e.textBaseline=L.Canvas.LABEL_ALIGN[l.labelAlign[1]]||"middle";var r=L.Canvas.LABEL_FACTOR[l.labelAlign[1]];null==r&&(r=-.5);var u,p,h=e.measureText("Mg").height||e.measureText("xx").width,c=(u=l.text instanceof Array?l.text:l.text.split("\n")).length;i.y+=h*r*(c-1);for(var y=0;y<c;y++)e.save(),e.translate(i.x,i.y),0!=l.labelRotation&&e.rotate(l.labelRotation*Math.PI/180),e.fillText(u[y],0,h*y),0==y&&(p=e.measureText(u[y]).width),e.restore();if(void 0!=t.image){var g,f,d=t.image.height,m=t.image.width;if(t.image.height>h&&(d=h),"center"==e.textAlign&&(0==t.image.position?2*m+p+6>Math.abs(n.x-o.x)?(m=(Math.abs(n.x-o.x)-p)/2,g=n.x):g=(Math.abs(n.x-o.x)-p)/2+n.x-m-3:1==t.image.position&&(g=g=o.x-(Math.abs(n.x-o.x)-p)/2+3)+m>=o.x&&(m=o.x-g)),f=o.y+h-2,void 0!=t.image.img&&1==t.image.img.complete){e.drawImage(t.image.img,g,f,m,d);var S=t.image.img;t.image.img=S}else if(t.image.img)e.drawImage(t.image.img,g,f,m,d);else if(t.image.path){var P=new Image;P.src=t.image.path,P.onload=function(){e.drawImage(P,g,f,m,d),void 0==t.image.img&&(t.image.img=P)}}}},_drawImage:function(t,e){var i=this._latlngToLayerPoint(t.getLatLngs(),t.fromZoom)[0],o=t.options,n=null;if(!Object.prototype.hasOwnProperty.call(L.supermap.plotting.getControl().imageManager,t.options.externalGraphic)){n=new Image,SuperMap.Browser.name;t.options.graphicTitle&&(n.title=t.options.graphicTitle),n.src=t.options.externalGraphic,L.supermap.plotting.getControl().imageManager[t.options.externalGraphic]=n}return{point:i,style:o,path:t.options.externalGraphic}},_drawImageInSymbolTextImage:function(t,e){var i=this,o=[],n=function(){var t=this.style,e=t.graphicWidth||t.graphicHeight,o=t.graphicHeight||t.graphicWidth,n=-.5*(e=e||2*t.pointRadius),l=-.5*(o=o||2*t.pointRadius),s=t.graphicOpacity||t.fillOpacity,a=this.point,r=a.x+t.graphicXOffset,u=a.y+t.graphicYOffset;if(!isNaN(r)&&!isNaN(u)){var p;i._ctx.save(),t.rotation&&(p=t.rotation/180*Math.PI),i._ctx.translate(r,u),p&&i._ctx.rotate(p),i._ctx.translate(n,l),i._ctx.globalAlpha=s;var h=L.Canvas.drawImageScaleFactor||(L.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);i._ctx.drawImage(this.img,0,0,e*h,o*h),i._ctx.restore()}},l=this._latlngToLayerPoint(t.getLatLngs(),t.fromZoom)[0],s=t.options;if(t.options.externalCanvas)n.call({point:l,style:s,img:t.options.externalCanvas});else{var a=null;a=new Image;"firefox"==SuperMap.Browser.name?(t.options.graphicTitle&&(a.title=t.options.graphicTitle),a.src=t.options.externalGraphic):(t.options.graphicTitle&&(a.title=t.options.graphicTitle),a.src=t.options.externalGraphic,a.onload=function(){a.src=t.options.externalGraphic,n.call({point:l,style:s,img:a}),a.onload=null}),window.ActiveXObject||"ActiveXObject"in window?a.onload():a.complete?a.onload():a.complete||o.push(a)}return o},_addDashArray:function(t){if(t.options.dashArray){var e,i=t.options.dashArray.split(","),o=[];for(e=0;e<i.length;e++)o.push(number(i[e]));t.options._dashArray=o}}});L.supermap.plotting.symbolStyle=function(t){return new Sh(t)};var Ph=L.Marker.extend({options:{nHandle:0,tag:0}});L.supermap.plotting.editMarker=function(t,e){return new Ph(t,e)};var bh=L.Evented.extend({dragging:null,uuid:null,libID:null,code:null,textDisplay:!0,minEditPts:1,maxEditPts:1,symbolType:null,symbolName:null,bubbleHeight:320,bubbleWidth:320,description:"",mediaList:null,isSelected:!1,enableEdit:!0,note:"",extendProperty:null,custom:null,symbolData:null,dRotate:null,dScale:null,textContent:null,annotationPosition:4,subSymbols:null,fromZoom:null,style:null,isLocked:!1,anchorPoint:null,avoidRegions:null,ownerGroup:null,geoSymbolTexts:null,isEdit:!1,components:null,maxScale:null,minScale:null,options:{},symbolAnnotations:[],_defaultStyle:{display:"display",color:"#ff0000",lineSymbolID:0,opacity:"1.00",weight:2,lineCap:"square",lineJoin:"square",surroundLineColor:"#ffff00",surroundLineColorOpacity:"1.00",surroundLineWidth:4,fillSymbolID:1,fillColor:"#ff0000",fillOpacity:"0.31",fillBackColor:"#ff0000",fillBackOpacity:"1.00",fillGradientMode:"NONE",fontColor:"#000000",fontOpacity:"1.00",fontFamily:"Microsoft YaHei",fontSize:"12",fontStroke:!1,fontStrokeColor:"#ff0000",fontStrokeWidth:"2px",fontBackground:!1,fontBackgroundColor:"#ff0000",fontShadow:!1,fontShadowColor:"#ff0000",fontShadowOffsetX:0,fontShadowOffsetY:0,fontSpace:0,fontPercent:100,sizeFixed:!0,labelAlign:"lt",labelRotation:-0,labelXOffset:0,labelYOffset:0,fillAngle:0,fillCenterOffsetX:0,fillCenterOffsetY:0},_clusterShowStatus:void 0,initialize:function(t,e,i,o){this.components=[],this.libID=t,this.code=e,this.extendProperty=new SuperMap.Plot.ExtendProperty,this.avoidRegions=[],this.subSymbols=[],this.geoSymbolTexts=[],this.dRotate=0,this.dScale=1,this.textContent="",this.associatedUuid="",this.bubbleHeight=320,this.bubbleWidth=320,this.description="",this.mediaList=[],this._clusterShowStatus=void 0,o&&o.symbolData&&(this._removeRedundancySymbolData(o.symbolData),this.symbolData=SuperMap.Plot.PlottingUtil.cloneObject(o.symbolData),SuperMap.Plot.AnalysisSymbol.parseSymbolData(this,this.symbolData,!0),SuperMap.Util.applyDefaults(this.style,this._defaultStyle),delete o.symbolData),this._mergeDefaultStyle(),SuperMap.Util.extend(this,o),null===this.uuid&&(this.uuid=SuperMap.Plot.PlottingUtil.generateUuid()),null===this.style&&(this.style=SuperMap.Plot.PlottingUtil.cloneObject(this._defaultStyle));for(var n=0;n<this.avoidRegions.length;n++)this.avoidRegions[n].associatedUuid=this.uuid;this.symbolAnnotations=[],o&&o.symbolAnnotations&&(this.symbolAnnotations=o.symbolAnnotations)},onAdd:function(t){this.layer=t,this._renderer=t instanceof gy?t.getRenderer(this.symbolType):t._renderer,this._map=t._map,this.redraw(),this.isEdit=!0,Th&&(this.dragging||(this.dragging=new Th(this))),null===this.fromZoom&&(this.fromZoom=this._map.getZoom()),this.layer instanceof Iy?null!==this.layer.firstZoom&&void 0!==this.layer.firstZoom||1!==this.layer.getFeatures().length||(this.layer.firstZoom=this._map.getZoom()):this.layer instanceof Ty&&(null!==this.layer.firstZoom&&void 0!==this.layer.firstZoom||(this.layer.firstZoom=this._map.getZoom()))},_clearComponents:function(){for(var t=0;t<this.components.length;t++)this.components[t].removeEventParent(this),this.components[t]instanceof bh?this.components[t]._clearComponents():(null!=this.components[t]._renderer&&this.components[t].onRemove(),delete this.components[t]);this.components.length=0,this._map&&this.layer&&this._map.getRenderer(this.layer)instanceof L.SVG&&this._removeGradientNodeInSVG()},_removeGradientNodeInSVG:function(){if(this.uuid&&this.layer._renderer._container.defs){var t=document.getElementById("linearGradient_"+this.uuid);null!==t&&this.layer._renderer._container.defs.removeChild(t),null!==(t=document.getElementById("radialGradient_"+this.uuid))&&this.layer._renderer._container.defs.removeChild(t),null!==(t=document.getElementById("patternFill_"+this.uuid))&&this.layer._renderer._container.defs.removeChild(t)}},_addComponents:function(t){if(!0===this.movingTarget)t._map=this._map,this.components.push(t);else{if(t._map=this._map,t._renderer=this._renderer,t.addEventParent(this),t instanceof bh)t.onAdd(this.layer);else{var e=SuperMap.Util.indexOf(this.layer.features,this);if(-1==e&&null!=this.route&&(e=SuperMap.Util.indexOf(this.layer.features,this.route)),-1==e&&null!=this.ownerGroup&&(e=SuperMap.Util.indexOf(this.layer.features,this.ownerGroup)),0===this.layer.features.length||e===this.layer.features.length-1)t.onAdd();else{for(var i=null,o=e+1;o<this.layer.features.length;o++)if(null!=(i=this.layer.features[o])&&i.components.length>0){if(i.components[0]instanceof bh&&i.components[0].components.length>0){i=i.components[0];break}if(!(i.components[0]instanceof bh))break;i=null}null!=i&&i.components.length>0?i.components[0]instanceof bh&&i.components[0].components.length>0?t.onBefore(i.components[0].components[0]):22==i.symbolType?t.onAdd():t.onBefore(i.components[0]):t.onAdd()}}this.components.push(t)}},_project:function(){var t=this;t._pxBounds=new L.Bounds,t.components.map(function(e){return e instanceof bh&&e._project(),e._pxBounds&&e._pxBounds.isValid()&&(t._pxBounds.extend(e._pxBounds.min),t._pxBounds.extend(e._pxBounds.max)),e})},getBounds:function(){var t=this;return t._bounds=new L.LatLngBounds,t.components.map(function(e){return e.isSymbolAnnotation||t._bounds.extend(e.getBounds()),e}),t._bounds},clone:function(){this.symbolData=this.getSymbolData();var t=SuperMap.Plot.PlottingUtil.toJSON(this.symbolData),e=JSON.parse(t);e.uuid=SuperMap.Plot.PlottingUtil.generateUuid(),0!=this.dRotate&&(e.dRotate=this.dRotate);var i=SuperMap.Plot.PlottingUtil.cloneObject(this.style);return L.supermap.plotting.PlottingObject.createSymbol(this.libID,this.code,null,{symbolData:e,serverUrl:this.serverUrl},i)},setStyle:function(t){if(SuperMap.Util.extend(this.style,t),this.fontSize&&this.style.fontSize&&this.fontSize!=this.style.fontSize&&(this.fontSize=this.style.fontSize,this.symbolData.fontSize=this.style.fontSize),this.redraw(),t.display&&this.fire("featurevisiblechanged",{feature:this}),this.symbolType===SuperMap.Plot.SymbolType.ANNOFRAMESYMBOL&&this.ownerGroup&&(this.ownerGroup.symbolType===SuperMap.Plot.SymbolType.NAVYDEPLOYMENT||this.ownerGroup.symbolType===SuperMap.Plot.SymbolType.AIRDEPLOYMENT))for(var e=0;e<this.ownerGroup.subObjects.length;e++)this.ownerGroup.subObjects[e].redraw();this.symbolType===SuperMap.Plot.SymbolType.TEXTSYMBOL&&this.isSelected&&"none"!==this.style.display&&"none"!==this._clusterShowStatus&&this.fire(SuperMap.Plot.Event.reseteditmarkersvalues),this.layer.fire("propertychanged",{feature:this,property:t})},setScale:function(){},setRotate:function(){},setTextPosition:function(){},convertGraphicObjects:function(){},setTextContent:function(t){this.textContent=t,this.redraw(),21==this.symbolType&&this._handleAnnotation(),this.symbolType!==SuperMap.Plot.SymbolType.TEXTSYMBOL&&21!==this.symbolType||!this.isSelected||(this.fire(SuperMap.Plot.Event.reseteditmarkersvalues),this.layer.fire("propertychanged",{feature:this,property:t}))},_handleAnnotation:function(t){if(!1!==this.textDisplay&&(this.textContent=SuperMap.Plot.PlottingUtil.trim(this.textContent),null==t&&(t=this.getBounds()),t.isValid()&&this.textContent&&null!==this.textContent&&0!==this.textContent.length&&null!==t&&t.isValid())){var e={};SuperMap.Plot.PlottingUtil.cloneObject(this.style);var i=1;this.scaleByMap&&"function"==typeof this.layer.getSymZoomScale&&(i=this.layer.getSymZoomScale(),null!=this.minScale&&i<this.minScale?i=this.minScale:null!=this.maxScale&&i>this.maxScale&&(i=this.maxScale)),this.space||(this.space=7);var o=this.space*i,n=null;if(0===this.annotationPosition){e.labelAlign="rb";var l=L.latLng(t.getNorth(),t.getWest()),s=this._map.latLngToLayerPoint(l);s.x-=o,n=this._map.layerPointToLatLng(s)}else if(1===this.annotationPosition){e.labelAlign="rt";var a=L.latLng(t.getSouth(),t.getWest()),r=this._map.latLngToLayerPoint(a);r.x-=o,n=this._map.layerPointToLatLng(r)}else if(2===this.annotationPosition){e.labelAlign="lb";var u=L.latLng(t.getNorth(),t.getEast()),p=this._map.latLngToLayerPoint(u);p.x+=o,n=this._map.layerPointToLatLng(p)}else if(3===this.annotationPosition){e.labelAlign="lt";var h=L.latLng(t.getSouth(),t.getEast()),c=this._map.latLngToLayerPoint(h);c.x+=o,n=this._map.layerPointToLatLng(c)}else if(4===this.annotationPosition){e.labelAlign="cb";var y=L.latLng(t.getNorth(),(t.getWest()+t.getEast())/2),g=this._map.latLngToLayerPoint(y);g.y-=o,n=this._map.layerPointToLatLng(g)}else if(5===this.annotationPosition){e.labelAlign="ct";var f=L.latLng(t.getSouth(),(t.getWest()+t.getEast())/2),d=this._map.latLngToLayerPoint(f);d.y+=o,n=this._map.layerPointToLatLng(d)}else if(6===this.annotationPosition){e.labelAlign="rm";var m=L.latLng((t.getSouth()+t.getNorth())/2,t.getWest()),S=this._map.latLngToLayerPoint(m);S.x-=o,n=this._map.layerPointToLatLng(S)}else if(7===this.annotationPosition){e.labelAlign="lm";var P=L.latLng((t.getSouth()+t.getNorth())/2,t.getEast()),b=this._map.latLngToLayerPoint(P);b.x+=o,n=this._map.layerPointToLatLng(b)}else if(8===this.annotationPosition&&this.symbolData.middleMarkExist){var v;v=!0===this.limitWidthHeight?this.middleMarkBounds.scale(this.initialScale.x*i,this.anchorPoint):this._widthHeightLimitScale();var M=new SuperMap.Geometry.Point((v.left+v.right)/2,(v.top+v.bottom)/2);if(this.negativeImage||this.horizontalMirror){var _=SuperMap.Plot.PlottingUtil.projectPoint(M,new SuperMap.Geometry.Point(this.anchorPoint.x,100),new SuperMap.Geometry.Point(this.anchorPoint.x,this.anchorPoint.y));SuperMap.Plot.PlottingUtil.rotateAngle(_,Math.PI,M)}if(this.verticalMirror){_=SuperMap.Plot.PlottingUtil.projectPoint(M,new SuperMap.Geometry.Point(this.anchorPoint.x,this.anchorPoint.y),new SuperMap.Geometry.Point(100,this.anchorPoint.y));SuperMap.Plot.PlottingUtil.rotateAngle(_,Math.PI,M)}M.x-=this.anchorPoint.x,M.y-=this.anchorPoint.y;var A=this.dRotate*(Math.PI/180);SuperMap.Plot.PlottingUtil.rotateAngle(new SuperMap.Geometry.Point(0,0),A,M);var T=this._map.latLngToLayerPoint(this.getLatLngs()[0]);!0===this.positionOffset&&(T.x+=this.positionOffsetX,T.y+=this.positionOffsetY);var x=96*v.getWidth()/25.4/10,O=96*v.getHeight()/25.4/10;e.graphicWidth=x,e.graphicHeight=O,n=this._transitionPoint(M,T)}if(8===this.annotationPosition&&this.symbolData.middleMarkExist){e.rotation=-this.dRotate,e.labelAlign="cm",e.fontOpacity=this.style.fontOpacity,e.fontColor=this.style.fontColor,e.fontFamily=this.style.fontFamily,e.fontWeight=this.style.fontWeight,e.fontStyle=this.style.fontStyle,e.fontStroke=this.style.fontStroke,e.fontStrokeColor=this.style.fontStrokeColor,e.fontStrokeWidth=this.style.fontStrokeWidth,e.externalGraphic=this._getTextGraphic(this.textContent,e);var w={externalGraphic:e.externalGraphic,graphicWidth:e.graphicWidth,graphicHeight:e.graphicHeight,rotation:-this.dRotate},C=L.supermap.plotting.pointImage([n],w);this._annotationId=this.components.length,C.fromZoom=this._map.getZoom(),this._addComponents(C)}else if(8!==this.annotationPosition){e.fontSize=this.style.fontSize*i,e.fontSizeLimit=!1,e.labelRotation=0,this._annotationId=this.components.length;var E=this._createAndDrawLayer(34,[n],e,this.textContent);E.isAnnotation=!0,E.fromZoom=this._map.getZoom()}}},getLocked:function(){return this.isLocked},setLocked:function(t){if(this.isLocked!==t){if(this.isLocked=t,this.symbolType===SuperMap.Plot.SymbolType.GROUPOBJECT)for(var e=0;e<this.components.length;e++)this.components[e].isLocked=t;this.fire(SuperMap.Plot.Event.reseteditmarkers),this.layer.fire("propertychanged",{feature:this,property:t})}},getScale:function(){return this.dScale},getScaleValues:function(){return this.scaleValues},setScaleValues:function(t){t&&null!==t&&(L.Util.isArray(t)||(t=[t]),this.scaleValues=t,this._calculateParts(),this.fire(SuperMap.Plot.Event.reseteditmarkers))},getRotate:function(){return this.dRotate},getMaxSubSymbols:function(){var t=SuperMapAlgoPlot.AlgoSymbolFactory.getMaxSubSymbols(this.libID,this.code);return 0===t&&(t=this.subSymbols.length),t},getSubSymbols:function(){return this.subSymbols},getTextPosition:function(){return this.annotationPosition},getTextContent:function(){return this.textContent},getBubbleHeight:function(){return this.bubbleHeight},setBubbleHeight:function(t){this.bubbleHeight=t},getBubbleWidth:function(){return this.bubbleWidth},setBubbleWidth:function(t){this.bubbleWidth=t},getDescription:function(){return this.description},setDescription:function(t){this.description=t},getMediaList:function(){return this.mediaList},setMediaList:function(t){this.mediaList=t},clearMediaList:function(){this.mediaList=[]},getExtendProperty:function(){return this.extendProperty},addAvoidRegion:function(t){t.symbolType===SuperMap.Plot.SymbolType.AVOIDREGION&&(this.avoidRegions.push(t),t.associatedUuid=this.uuid,this.redraw())},removeAvoidRegions:function(t){void 0===t&&(t=this.avoidRegions.slice()),SuperMap.Util.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var i=t[e];if(i.symbolType===SuperMap.Plot.SymbolType.AVOIDREGION)for(var o=0;o<this.avoidRegions.length;o++)if(this.avoidRegions[o]===i){this.avoidRegions.splice(o,1);break}}this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},getSymbolData:function(){SuperMap.Plot.AnalysisSymbol.setSymbolData(this,this.symbolData,!0),this.symbolData.symbolAnnotations=[];for(var t=0;t<this.symbolAnnotations.length;t++){var e=this.symbolAnnotations[t];this.symbolData.symbolAnnotations.push(e.getSymbolData())}return this.symbolData},redraw:function(){var t=L.supermap.plotting.getControl().getPlotMapManager().getLayerScale();null!=this.graphic&&null!=this.graphic.layer&&!0===this.graphic.layer.getVisibility()?this.graphic.redraw():null!=this.layer&&(this._clearComponents(),"function"!=typeof this.layer.getVisibility?(this._redrawComponents(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)):(0==t||this.layer.getVisibility()&&(null==this.childLayer||"function"!=typeof this.childLayer.getVisibility||this.childLayer.getVisibility())&&("function"!=typeof this.layer.getMinVisibleScale&&"function"!=typeof this.layer.getMaxVisibleScale||"function"==typeof this.layer.getMinVisibleScale&&"function"!=typeof this.layer.getMaxVisibleScale&&(t>=this.layer.getMinVisibleScale()||0===this.layer.getMinVisibleScale())||"function"!=typeof this.layer.getMinVisibleScale&&"function"==typeof this.layer.getMaxVisibleScale&&(0===this.layer.getMaxVisibleScale()||t<=this.layer.getMaxVisibleScale())||"function"==typeof this.layer.getMinVisibleScale&&"function"==typeof this.layer.getMaxVisibleScale&&0===this.layer.getMaxVisibleScale()&&t>=this.layer.getMinVisibleScale()||"function"==typeof this.layer.getMinVisibleScale&&"function"==typeof this.layer.getMaxVisibleScale&&0===this.layer.getMinVisibleScale()&&t<=this.layer.getMaxVisibleScale()||"function"==typeof this.layer.getMinVisibleScale&&"function"==typeof this.layer.getMaxVisibleScale&&(0===this.layer.getMinVisibleScale()&&0===this.layer.getMaxVisibleScale()||t>=this.layer.getMinVisibleScale()&&t<=this.layer.getMaxVisibleScale())))&&(this._redrawComponents(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues),this.fire("latlngchanged",{feature:this})))},_redrawComponents:function(){"none"===this.style.display||"none"==this._clusterShowStatus||null!=this.layer&&"function"==typeof this.layer.getVisibility&&!1===this.layer.getVisibility()?this.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL&&this.symbolType!==SuperMap.Plot.SymbolType.AlgoSymbol&&0!==this.libID||this._updateSymbolTexts():(this._calculateParts(),this._calculateAvoidRegions(),21===this.symbolType&&this._handleAnnotation(),this._calculateAnnotaitons())},_calculateAvoidRegions:function(){if(0!==this.avoidRegions.length){for(var t=this.components.slice(),e=0;e<this.components.length;e++)this.components[e].removeEventParent(this),this.components[e]instanceof bh||(this.components[e].onRemove(),delete this.components[e]);this.components.length=0;for(var i=0;i<this.avoidRegions.length;i++)if(0!==this.avoidRegions[i].getLatLngs().length){var o=this.avoidRegions[i];t=this._layersWithoutAvoidRegion(o,t)}for(var n=0;n<t.length;n++)this._addComponents(t[n])}},_calculateAnnotaitons:function(){for(var t=0;t<this.symbolAnnotations.length;t++){var e=this.symbolAnnotations[t];e._parentUuid=this.uuid;var i=SuperMap.Plot.PlottingUtil.cloneObject(e.style);if(e._positionPoint=this._calculateAnnotaitonPos(i,e,this.getBounds()),e.offsetX==e._oldOffsetX&&e.offsetY==e._oldOffsetY){var o=this._map.latLngToLayerPoint(e._positionPoint),n=this._map.latLngToLayerPoint(e._offsetPositionPoint);e.offsetX=e._oldOffsetX=n.x-o.x,e.offsetY=e._oldOffsetY=n.y-o.y}else if(e._oldOffsetX=e.offsetX,e._oldOffsetY=e.offsetY,0==e.offsetX&&0==e.offsetY)e._offsetPositionPoint=e._positionPoint.clone();else{var l=this._map.latLngToLayerPoint(e._positionPoint),s=this._map.getZoom();l.x+=e.offsetX*s,l.y+=e.offsetY*s,e._offsetPositionPoint=this._map.layerPointToLatLng(l)}var a=this._createAndDrawLayer(34,[e._offsetPositionPoint],i,e.textContent);SuperMap.Util.extend(a.options,i),a.isSymbolAnnotation=!0,a.symbolAnnotation=e,a.fromZoom=this._map.getZoom(),a.redraw()}},_calculateAnnotaitonPos:function(t,e,i){var o=1,n=e.textPosition;this.scaleByMap&&"function"==typeof this.layer.getSymZoomScale&&(o=this.layer.getSymZoomScale(),null!=this.minScale&&o<this.minScale?o=this.minScale:null!=this.maxScale&&o>this.maxScale&&(o=this.maxScale)),this.space||(this.space=7);var l=this.space*o,s=null;if(0===n){t.labelAlign="rb";var a=L.latLng(i.getNorth(),i.getWest()),r=this._map.latLngToLayerPoint(a);r.x-=l,s=this._map.layerPointToLatLng(r)}else if(1===n){t.labelAlign="rt";var u=L.latLng(i.getSouth(),i.getWest()),p=this._map.latLngToLayerPoint(u);p.x-=l,s=this._map.layerPointToLatLng(p)}else if(2===n){t.labelAlign="lb";var h=L.latLng(i.getNorth(),i.getEast()),c=this._map.latLngToLayerPoint(h);c.x+=l,s=this._map.layerPointToLatLng(c)}else if(3===n){t.labelAlign="lt";var y=L.latLng(i.getSouth(),i.getEast()),g=this._map.latLngToLayerPoint(y);g.x+=l,s=this._map.layerPointToLatLng(g)}else if(4===n){t.labelAlign="cb";var f=L.latLng(i.getNorth(),(i.getWest()+i.getEast())/2),d=this._map.latLngToLayerPoint(f);d.y-=l,s=this._map.layerPointToLatLng(d)}else if(5===n){t.labelAlign="ct";var m=L.latLng(i.getSouth(),(i.getWest()+i.getEast())/2),S=this._map.latLngToLayerPoint(m);S.y+=l,s=this._map.layerPointToLatLng(S)}else if(6===n){t.labelAlign="rm";var P=L.latLng((i.getSouth()+i.getNorth())/2,i.getWest()),b=this._map.latLngToLayerPoint(P);b.x-=l,s=this._map.layerPointToLatLng(b)}else if(7===n){t.labelAlign="lm";var v=L.latLng((i.getSouth()+i.getNorth())/2,i.getEast()),M=this._map.latLngToLayerPoint(v);M.x+=l,s=this._map.layerPointToLatLng(M)}else 8===n&&(t.labelAlign="cm",s=i.getCenter());return s},_layersWithoutAvoidRegion:function(t,e){for(var i=[],o=0;o<e.length;o++){var n=e[o];if(n instanceof bh)i=i.concat(this._layersWithoutAvoidRegion(t,n.components)),n._clearComponents();else{if(1===t._relationToLayer(n))continue;if(n instanceof dh||0!==t._relationToLayer(n))i.push(n);else if(n instanceof L.Polygon){var l={};l=SuperMap.Util.copyAttributes(l,n.options);var s=L.Util.latLngsToSuperMapPoints(n.getLatLngs()[0][0]),a=L.Util.latLngsToSuperMapPoints(n.getLatLngs()[0][n.getLatLngs()[0].length-1]);SuperMap.Plot.PlottingUtil.isSamePt(s[0],a[0])||n.getLatLngs()[0].push(n.getLatLngs()[0][0]),s=L.Util.latLngsToSuperMapPoints(n.getLatLngs()[0][0]),a=L.Util.latLngsToSuperMapPoints(n.getLatLngs()[0][n.getLatLngs()[0].length-1]),SuperMap.Plot.PlottingUtil.isSamePt(s[0],a[0])||n.getLatLngs()[0].push(n.getLatLngs()[0][0]);for(var r=0;r<n.getLatLngs().length;r++)for(var u=t._getWithoutPts(n.getLatLngs()[r],!0),p=0;p<u.length;p++){var h=L.polyline(L.Util.superMapPointsToLatLngs(u[p]),l);i.push(h)}}else if(n instanceof L.Polyline){var c={};c=SuperMap.Util.copyAttributes(c,n.options);for(var y=t._getWithoutPts(n.getLatLngs(),!1),g=0;g<y.length;g++){c.fill=!1;var f=L.polyline(L.Util.superMapPointsToLatLngs(y[g]),c);i.push(f)}}}}return i},_isDot:function(){return this.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL||this.symbolType===SuperMap.Plot.SymbolType.GROUPOBJECT||this.symbolType===SuperMap.Plot.SymbolType.CLUSTEROBJECT||this.symbolType===SuperMap.Plot.SymbolType.FLAGGROUP||this.symbolType===SuperMap.Plot.SymbolType.ROUTENODE||this.symbolType===SuperMap.Plot.SymbolType.AIRDEPLOYMENT||this.symbolType===SuperMap.Plot.SymbolType.NAVYDEPLOYMENT||this.symbolType===SuperMap.Plot.SymbolType.PICTURE||this.symbolType===SuperMap.Plot.SymbolType.MODELPLOT||3e3===this.symbolType},_resizeOffset:function(t,e,i){var o=L.latLng(0,0);switch(e){case 1:o.lng=t.lng-i.getWest(),o.lat=t.lat-i.getNorth();break;case 3:o.lng=t.lng-i.getEast(),o.lat=t.lat-i.getNorth();break;case 6:o.lng=t.lng-i.getWest(),o.lat=t.lat-i.getSouth();break;case 8:o.lng=t.lng-i.getEast(),o.lat=t.lat-i.getSouth();break;case 2:o.lng=0,o.lat=t.lat-i.getNorth();break;case 4:o.lng=t.lng-i.getWest(),o.lat=0;break;case 5:o.lng=t.lng-i.getEast(),o.lat=0;break;case 7:o.lng=0,o.lat=t.lat-i.getSouth()}return o},_resizeBounds:function(t,e,i){var o=i.getWest(),n=i.getEast(),l=i.getNorth(),s=i.getSouth();switch(e){case 1:l=t.lat,o=t.lng;break;case 3:l=t.lat,n=t.lng;break;case 6:o=t.lng,s=t.lat;break;case 8:n=t.lng,s=t.lat;break;case 2:l=t.lat;break;case 4:o=t.lng;break;case 5:n=t.lng;break;case 7:s=t.lat}var a=new L.LatLngBounds;return a._southWest=L.latLng(s,o),a._northEast=L.latLng(l,n),a},_getHandleCount:function(){switch(this.symbolType){case SuperMap.Plot.SymbolType.ELLIPSESYMBOL:case SuperMap.Plot.SymbolType.CIRCLESYMBOL:case SuperMap.Plot.SymbolType.NEWARCSYMBOL:case SuperMap.Plot.SymbolType.NEWCHORDSYMBOL:case SuperMap.Plot.SymbolType.NEWPIESYMBOL:case SuperMap.Plot.SymbolType.ARCSYMBOL:case SuperMap.Plot.SymbolType.CHORDSYMBOL:case SuperMap.Plot.SymbolType.PIESYMBOL:case SuperMap.Plot.SymbolType.AVOIDREGION:case SuperMap.Plot.SymbolType.LINERELATION:case SuperMap.Plot.SymbolType.SYMBOLTEXT:case SuperMap.Plot.SymbolType.SYMBOLTEXT1:return this.getLatLngs().length+9;default:return 9}},_getHandlePointsByBounds:function(t){if(void 0!==t&&null!==t||(t=this.getBounds()),null!==t){var e=this._map.latLngToLayerPoint(L.latLng(t.getNorth(),t.getEast()));e.x+=5,e.y-=5;var i=this._map.latLngToLayerPoint(L.latLng(t.getNorth(),t.getWest()));i.x-=5,i.y-=5;var o=this._map.latLngToLayerPoint(L.latLng(t.getSouth(),t.getEast()));o.x+=5,o.y+=5;var n=this._map.latLngToLayerPoint(L.latLng(t.getSouth(),t.getWest()));n.x-=5,n.y+=5;for(var l=L.point((e.x+i.x)/2,e.y),s=L.point(e.x,(e.y+o.y)/2),a=L.point((o.x+n.x)/2,o.y),r=L.point(i.x,(i.y+n.y)/2),u=this._map.layerPointToLatLng(e),p=this._map.layerPointToLatLng(i),h=this._map.layerPointToLatLng(o),c=this._map.layerPointToLatLng(n),y=this._map.layerPointToLatLng(s),g=this._map.layerPointToLatLng(a),f=this._map.layerPointToLatLng(r),d=this._map.layerPointToLatLng(l),m=[p.clone(),d.clone(),u.clone(),f.clone(),y.clone(),c.clone(),g.clone(),h.clone()],S=1,P=0;P<m.length;P++)m[P].nHandle=S++;return m}},_getHandleAndRotatePoints:function(){var t={handlePoints:[],rotatePoints:[]},e=this.getBounds();if(!e.isValid())return t;if(this._getHandleCount()>9){if(this.symbolType===SuperMap.Plot.SymbolType.REGULARPOLYGON)t.handlePoints.push(this.getLatLngs()[0].clone()),t.handlePoints.push(this.getLatLngs()[this.getLatLngs().length-1].clone());else if(t.handlePoints=L.Util.cloneLatLngs(this.getLatLngs()),3801===this.code||4401===this.code||3701===this.code){var i=this.components[0]._latlngs;i.length>1?t.handlePoints[2]=i[1]:t.handlePoints[2]=i[0][1]}}else t.handlePoints=this._getHandlePointsByBounds(e);for(var o=0;o<t.handlePoints.length;o++)t.handlePoints[o].tag=o;if(!0===this.getLocked())return t;var n=15;if(L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode()&&(n=20),this.symbolType!==SuperMap.Plot.SymbolType.ANNOFRAMESYMBOL&&this.symbolType!==SuperMap.Plot.SymbolType.LINERELATION&&this.symbolType!==SuperMap.Plot.SymbolType.SYMBOLTEXT&&this.symbolType!==SuperMap.Plot.SymbolType.SYMBOLTEXT1&&this.symbolType!==SuperMap.Plot.SymbolType.SYMBOLTEXTBOX&&this.symbolType!==SuperMap.Plot.SymbolType.LINEMARKING&&this.symbolType!==SuperMap.Plot.SymbolType.ANNOFRAMESYMBOLM&&this.symbolType!==SuperMap.Plot.SymbolType.ROUTENODE&&this.symbolType!==SuperMap.Plot.SymbolType.LITERATESIGN&&this.symbolType!==SuperMap.Plot.SymbolType.SATELLITE&&this.symbolType!==SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS&&this.symbolType!==SuperMap.Plot.SymbolType.AVOIDREGION&&this.symbolType!==SuperMap.Plot.SymbolType.NAVYDEPLOYMENT&&this.symbolType!==SuperMap.Plot.SymbolType.RECTANGLESYMBOL&&this.symbolType!==SuperMap.Plot.SymbolType.AIRDEPLOYMENT){var l=this._map.latLngToLayerPoint(L.latLng(e.getNorth(),e.getEast())),s=L.point(l.x+n,l.y-n),a=this._map.layerPointToLatLng(s);a.isRotatePoint=!0,t.rotatePoints=[a]}return t},_parseSymbolData:function(){if(null!==this.symbolData){if(this.libID=parseInt(this.symbolData.libID),this.code=parseInt(this.symbolData.code),this.symbolType=this.symbolData.symbolType,this.symbolName=this.symbolData.symbolName,this.textContent=this.symbolData.textContent,void 0!==this.symbolData.dScale?this.dScale=this.symbolData.dScale:this.dScale=this.symbolData.scale2D.x,void 0!==this.symbolData.dRotate?this.dRotate=this.symbolData.dRotate:this.dRotate=this.symbolData.rotate2D.x,void 0!==this.symbolData.uuid&&(this.uuid=this.symbolData.uuid),void 0!==this.symbolData.associatedUuid&&(this.associatedUuid=this.symbolData.associatedUuid),void 0!==this.symbolData.annotationPosition&&(this.annotationPosition=this.symbolData.annotationPosition),void 0!==this.symbolData.isLocked&&(this.isLocked=this.symbolData.isLocked),void 0!==this.symbolData.note&&(this.note=this.symbolData.note),void 0!==this.symbolData.custom&&(this.custom=this.symbolData.custom),this.symbolData.extendProperty)for(var t=0;t<this.symbolData.extendProperty.length;t++){var e=this.symbolData.extendProperty[t];this.extendProperty.addProperty(e.key,e.value)}if(Object.prototype.hasOwnProperty.call(this.symbolData,"subSymbols")&&this.symbolData.subSymbols&&0!==this.symbolData.subSymbols.length){this.subSymbols=[];for(var i=0;i<this.symbolData.subSymbols.length;i++){var o=this.symbolData.subSymbols[i].libID;void 0===o&&(o=this.libID);var n=this.symbolData.subSymbols[i].code;if(void 0!==n){var l={};void 0!==this.symbolData.subSymbols[i]&&(l.symbolData=this.symbolData.subSymbols[i].symbolData),void 0!==this.symbolData.subSymbols[i].textContent&&(l.textContent=this.symbolData.subSymbols[i].textContent),void 0!==this.symbolData.subSymbols[i].totalNum&&(l.totalNum=this.symbolData.subSymbols[i].totalNum),this.subSymbols.push(new SuperMap.Plot.SubSymbol(o,n,l))}}}if(this.symbolData.avoidRegions&&0!==this.symbolData.avoidRegions.length)for(var s=0;s<this.symbolData.avoidRegions.length;s++){var a={libID:0,code:SuperMap.Plot.SymbolType.AVOIDREGION,map:this._map,symbolData:this.symbolData.avoidRegions[s][0]},r=L.supermap.plotting.avoidRegion(0,SuperMap.Plot.SymbolType.AVOIDREGION,[],a);r.style=SuperMap.Plot.AnalysisSymbol.getStyle(this.symbolData.avoidRegions[s][1],!0),this.avoidRegions.push(r)}}},_setSymbolData:function(t){if(void 0===t&&(t=!0),null===this.symbolData&&(this.symbolData={}),Object.prototype.hasOwnProperty.call(this.symbolData,"type")||(this.symbolData.type="GRAPHICOBJECT"),Object.prototype.hasOwnProperty.call(this.symbolData,"rotate2D")?this.symbolData.rotate2D.x=this.dRotate:this.symbolData.rotate2D={x:this.dRotate,y:0,z:0},Object.prototype.hasOwnProperty.call(this.symbolData,"scale2D")?this.symbolData.scale2D.x=this.dScale:this.symbolData.scale2D={x:this.dScale,y:0,z:0},this.symbolData.libID=this.libID,this.symbolData.code=this.code,this.symbolData.isEdit=!0,this.symbolData.uuid=this.uuid,this.symbolData.symbolType=this.symbolType,this.symbolData.symbolName=this.symbolName,this.symbolData.associatedUuid=this.associatedUuid,this.symbolData.annotationPosition=this.annotationPosition,this.symbolData.textContent=this.textContent,this.symbolData.isLocked=this.isLocked,this.symbolData.note=this.note,this.symbolData.custom=this.custom,this.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL&&this.symbolType!==SuperMap.Plot.SymbolType.GROUPOBJECT){this.symbolData.subSymbols=[];for(var e=0;e<this.getSubSymbols().length;e++){var i=this.getSubSymbols()[e];t?this.symbolData.subSymbols.push({libID:i.libID,code:i.code,symbolData:i.symbolData,textContent:i.textContent,totalNum:i.totalNum}):this.symbolData.subSymbols.push({libID:i.libID,code:i.code,textContent:i.textContent,totalNum:i.totalNum})}}this.symbolData.extendProperty=[];for(var o=this.getExtendProperty().getPropertyCount(),n=0;n<o;n++){var l=this.getExtendProperty().getPropertyByIndex(n);this.symbolData.extendProperty.push({key:l.key,value:l.value})}this.symbolData.avoidRegions=[];for(var s=0;s<this.avoidRegions.length;s++){var a={};SuperMap.Plot.AnalysisSymbol.setStyle(this.avoidRegions[s].style,a,!0),this.symbolData.avoidRegions.push([this.avoidRegions[s].getSymbolData(),a])}},_getSymbolWayType:function(){return 22===this.libID&&1016===this.code?0===this.getArrowBodyType()?SuperMap.Plot.AddPoint_WayType.POLYLINE:SuperMap.Plot.AddPoint_WayType.CURVE:SuperMap.Plot.AlgoSymbolFactory.getSymbolWayType(this.libID,this.code)},_reView:function(){},_mergeDefaultStyle:function(){var t=L.supermap.plotting.getControl(this._map,this.serverUrl).getDefaultStyle();if(t&&!0===t.defaultFlag&&!1===this.isEdit){if(this.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL){if(-1!==t.dotSymbolSize){var e=this.symbolSizeInLib.w;if(this.symbolSizeInLib.h>this.symbolSizeInLib.w&&(e=this.symbolSizeInLib.h),0===e||0===t.dotSymbolSize)0!==this.symbolSize.w&&0!==this.symbolSize.h||(this.symbolSize.w=this.symbolSizeInLib.w,this.symbolSize.h=this.symbolSizeInLib.h);else{var i=t.dotSymbolSize/e;this.symbolSize.w=i*this.symbolSizeInLib.w,this.symbolSize.h=i*this.symbolSizeInLib.h}}-1!==t.dotTextSpace&&(this.space=t.dotTextSpace),-1!==t.flagTextSize&&(this.flagTextSize=t.flagTextSize)}this.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&(null!=t.maxScale&&(this.maxScale=t.maxScale),null!=t.minScale&&(this.minScale=t.minScale)),-1!==t.scaleByMap&&(this.scaleByMap=t.scaleByMap)}},_removeRedundancySymbolData:function(t){null!==t&&(Object.prototype.hasOwnProperty.call(t,"center")&&delete t.center,Object.prototype.hasOwnProperty.call(t,"id")&&delete t.id,Object.prototype.hasOwnProperty.call(t,"parts")&&delete t.parts,Object.prototype.hasOwnProperty.call(t,"points")&&delete t.points,Object.prototype.hasOwnProperty.call(t,"position")&&delete t.position,Object.prototype.hasOwnProperty.call(t,"prjCoordSys")&&delete t.prjCoordSys,Object.prototype.hasOwnProperty.call(t,"rotationX")&&delete t.rotationX,Object.prototype.hasOwnProperty.call(t,"rotationY")&&delete t.rotationY,Object.prototype.hasOwnProperty.call(t,"rotationZ")&&delete t.rotationZ,Object.prototype.hasOwnProperty.call(t,"scaleX")&&delete t.scaleX,Object.prototype.hasOwnProperty.call(t,"scaleY")&&delete t.scaleY,Object.prototype.hasOwnProperty.call(t,"scaleZ")&&delete t.scaleZ)},destroy:function(){this.layer.removeFeatures(this),this.fire("featureremoved",this)},updateByGeoJson:function(t){if(t.isEdit=!0,t.isIntegrate=!0,SuperMap.Plot.AnalysisSymbol.parseSymbolData(this,t,!0),null!=t.innerCells&&(delete this.symbolData.innerCells,this.symbolData.innerCells=t.innerCells),this.symbolAnnotations=[],t.symbolAnnotations)for(var e=0;e<t.symbolAnnotations.length;e++){var i=t.symbolAnnotations[e],o=new Ui;o.parseSymbolData(i),this.symbolAnnotations.push(o)}this.redraw(),this.isSelected&&"none"!==this.style.display&&"none"!==this._clusterShowStatus&&(this.fire(SuperMap.Plot.Event.reseteditmarkersvalues),this._map.getPlotEditControl().fire(SuperMap.Plot.Event.updateFeature,{feature:this}))},toGeoJsonStr:function(){return this.getSymbolData(),SuperMap.Plot.PlottingUtil.toJSON(this.symbolData)},getSymbolAnnotations:function(){return this.symbolAnnotations},getSymbolAnnotation:function(t){if(t<this.symbolAnnotations.length)return this.symbolAnnotations[t]},setSymbolAnnotations:function(t){if(t){for(var e=0;e<t.length;e++)if(!(t[e]instanceof SuperMap.Plot.SymbolAnnotation))return;this.symbolAnnotations=t,this.redraw()}},setSymbolAnnotation:function(t,e){e instanceof SuperMap.Plot.SymbolAnnotation&&t<this.symbolAnnotations.length&&(this.symbolAnnotations.splice(t,1,e),this.redraw())},addSymbolAnnotations:function(t){if(Array.isArray(t)){for(var e=0;e<t.length;e++){var i=t[e];i instanceof SuperMap.Plot.SymbolAnnotation&&this.symbolAnnotations.push(i)}this.redraw()}},removeSymbolAnnotation:function(t){t<this.symbolAnnotations.length&&(this._map.getPlotEditControl()._removeMarkers(this.symbolAnnotations[t]),this.symbolAnnotations.splice(t,1),this.redraw())},clearSymbolAnnotations:function(){for(var t=0;t<this.symbolAnnotations.length;t++){var e=this.symbolAnnotations[t];this._map.getPlotEditControl()._removeMarkers(e),e.destroy()}this.symbolAnnotations=[],this.redraw()}});L.supermap.plotting.PlottingObject=bh,bh.prototype._containsPoint=function(t){if(this.symbolType!==SuperMap.Plot.SymbolType.TEXTSYMBOL)return!1;for(var e=0;e<this.components.length;e++)if(this.components[id]._containsPoint(t))return!0;return!1};var vh=bh.extend({subObjects:[],initialize:function(t,e,i,o){this.subObjects=[],this.symbolName="组合对象",this.libID=0,this.code=SuperMap.Plot.SymbolType.GROUPOBJECT,this.symbolType=SuperMap.Plot.SymbolType.GROUPOBJECT,bh.prototype.initialize.call(this,t,e,i,o)},_addComponents:function(t){bh.prototype._addComponents.call(this,t),t.layer=this.layer,t.isEdit=!0,Th&&(t.dragging||(t.dragging=new Th(t))),null===t.fromZoom&&(t.fromZoom=this._map.getZoom()),this._map&&this._map.getPlotEditControl()&&t.enableEdit&&!t.layer.isMovingTargetLayer&&(t.symbolType==SuperMap.Plot.SymbolType.CLUSTEROBJECT||t.symbolType==SuperMap.Plot.SymbolType.GROUPOBJECT||t.ownerGroup&&(t.ownerGroup.symbolType==SuperMap.Plot.SymbolType.CLUSTEROBJECT||t.ownerGroup.symbolType==SuperMap.Plot.SymbolType.GROUPOBJECT))&&this._map.getPlotEditControl().enableEditFeatures(t)},_clearComponents:function(){this._map&&this._map.getPlotEditControl()&&this._map.getPlotEditControl().disableEditFeatures(this.components),bh.prototype._clearComponents.call(this)},_reView:function(){for(var t=0;t<this.components.length;t++)this.components[t]._reView();this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},move:function(t,e){for(var i=0;i<this.subObjects.length;i++)this.subObjects[i].move(t,e);this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},redraw:function(){if("none"===this.style.display||null!=this.layer&&"function"==typeof this.layer.getVisibility&&!1===this.layer.getVisibility())this._clearComponents();else if(0!==this.subObjects.length&&0===this.components.length)for(var t=0,e=this.subObjects.length;t<e;t++)this.subObjects[t].layer&&this.subObjects[t].layer.removeFeatures(this.subObjects[t]),this.subObjects[t].ownerGroup=this,this.subObjects[t].enableEdit=!0,this._addComponents(this.subObjects[t])},setRotate:function(t){null===this.anchorPoint&&(this.anchorPoint=this.getBounds().getCenter()),this._rotate(t,this.anchorPoint),this.dRotate=t,this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},setScale:function(t){null===this.anchorPoint&&(this.anchorPoint=this.getBounds().getCenter()),this._resize(t/this.dScale,this.anchorPoint),this.dScale=t,this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},_unGroupObject:function(){var t=null;if(0!==this.subObjects.length){t=this.subObjects.slice(),this._clearComponents();for(var e=0,i=t.length;e<i;e++)this.layer.addFeatures(t[e]),t[e].ownerGroup=null}return t},removeComponents:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=[],i=0;i<t.length;i++){this.subObjects.splice(SuperMap.Util.indexOf(this.subObjects,t[i]),1);var o=SuperMap.Util.indexOf(this.components,t[i]);-1!==o&&(this.components[o]._clearComponents(),this.components.splice(o,1)),e.push(t[i])}for(var n=0;n<e.length;n++)e[n].addTo(this._map),e[n].ownerGroup=null;return e},setStyle:function(t){SuperMap.Util.extend(this.style,t);for(var e=0;e<this.components.length;e++)this.components[e].symbolType===SuperMap.Plot.SymbolType.TEXTSYMBOL&&(t.labelAlign=this.components[e].style.labelAlign),this.components[e].setStyle(t)},_parseSymbolData:function(){if(null!==this.symbolData&&(bh.prototype._parseSymbolData.call(this),this.symbolData&&this.symbolData.subFeatures)){for(var t=[],e=0;e<this.symbolData.subFeatures.length;e++){var i=this.symbolData.subFeatures[e];i.uuid=SuperMap.Plot.PlottingUtil.generateUuid();var o=L.supermap.plotting.PlottingObject.createSymbol(i.libID,i.code,null,{symbolData:i});t.push(o)}this.subObjects=t}},_setSymbolData:function(){if(bh.prototype._setSymbolData.call(this),this.symbolData){this.symbolData.subFeatures=[];for(var t=0;t<this.subObjects.length;t++)this.symbolData.subFeatures.push(this.subObjects[t].getSymbolData())}},_rotate:function(t,e){for(var i=0;i<this.components.length;i++)this.components[i]._rotate(t,e)},_resize:function(t,e){for(var i=0;i<this.components.length;i++)this.components[i]instanceof vh?this.components[i]._resize(t,e):0!==this.components[i].avoidRegions.length?(this.components[i]._resize(t,this.anchorPoint),this.components[i].redraw()):this.components[i]._resize(t,this.anchorPoint)},destroy:function(){bh.prototype.destroy.call(this),this.subObjects=[]}}),Lh=function(t,e,i,o){return new vh(t,e,i,o)};L.supermap.plotting.groupObject=Lh,L.supermap.plotting.GroupObject=vh;var Mh={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},_h={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"};function Ah(t,e){var i=t.x-e.x,o=t.y-e.y;return Math.sqrt(i*i+o*o)}var Th=L.Handler.extend({statics:{DRAGGING_CLS:"leaflet-plottingObject-draggable"},initialize:function(t){this._plottingObject=t,this._startPoint=null,this._dragStartPoint=null,this._mapDraggingWasEnabled=!1,this.moveIcon=L.divIcon({className:"leaflet-supermap-plot-move-icon-path",iconSize:[30,30]}),this.moveMarker=null},addHooks:function(){if(L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode()){var t=this._plottingObject.getBounds();this.moveMarker=L.marker(t.getCenter(),{icon:this.moveIcon}),this._addToMapAndBindMarker(this.moveMarker),this._plottingObject.on("reseteditmarkersvalues",this._onResetEditMarkersValues,this)}else this._plottingObject.on("mousedown",this._onDragStart,this),this._plottingObject.options.className=this._plottingObject.options.className?this._plottingObject.options.className+" "+Th.DRAGGING_CLS:Th.DRAGGING_CLS,this._plottingObject._plottingObject&&L.DomUtil.addClass(this._plottingObject._plottingObject,Th.DRAGGING_CLS);this._mapDraggingWasEnabled=this._plottingObject._map.dragging.enabled(),this._plottingObject._map.dragging.disable()},removeHooks:function(){L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode()?(this._unbindMarkerEvents(this.moveMarker),this._plottingObject._map.removeLayer(this.moveMarker),this._plottingObject.off("reseteditmarkersvalues",this._onResetEditMarkersValues,this)):(this._plottingObject.off("mousedown",this._onDragStart,this),this._plottingObject.options.className=this._plottingObject.options.className.replace(new RegExp("\\s+"+Th.DRAGGING_CLS),""),this._plottingObject._plottingObject&&L.DomUtil.removeClass(this._plottingObject._plottingObject,Th.DRAGGING_CLS)),this._mapDraggingWasEnabled&&this._plottingObject._map.dragging.enable()},moved:function(){return this._plottingObject._dragMoved},_onDragStart:function(t){var e=t.originalEvent._simulated?"touchstart":t.originalEvent.type;this._startPoint=t.latlng.clone(),this._dragStartPoint=t.latlng.clone(),L.DomEvent.stop(t.originalEvent),L.DomEvent.on(document,_h[e],this._onDrag,this).on(document,Mh[e],this._onDragEnd,this),this._plottingObject._dragMoved=!1},_onDrag:function(t){var e=t.touches&&t.touches.length>=1?t.touches[0]:t,i=this._plottingObject._map.mouseEventToLatLng(e);if("touchmove"===t.type&&!this._plottingObject._dragMoved){var o=this._plottingObject._map.latLngToLayerPoint(this._dragStartPoint),n=this._plottingObject._map.mouseEventToContainerPoint(e);if(o.distanceTo(n)<=this._plottingObject._map.options.tapTolerance)return}var l=i.lat,s=i.lng,a=l-this._startPoint.lat,r=s-this._startPoint.lng;(a||r)&&(this._plottingObject._dragMoved||(this._plottingObject._dragMoved=!0,this._plottingObject.fire("dragstart",t)),this._startPoint.lat=l,this._startPoint.lng=s,this._plottingObject.fire("predrag",t),t.dLat=a,t.dLng=r,this._plottingObject.fire("drag",t))},_onDragEnd:function(t){var e=this._plottingObject._map.mouseEventToLatLng(t),i=this.moved();if(i&&L.DomEvent.stop(t),L.DomEvent.off(document,"mousemove touchmove",this._onDrag,this),L.DomEvent.off(document,"mouseup touchend",this._onDragEnd,this),i){this._plottingObject.fire("dragend",{distance:Ah(this._dragStartPoint,e)});var o=this._plottingObject._containsPoint;this._plottingObject._containsPoint=L.Util.falseFn,L.Util.requestAnimFrame(function(){this._plottingObject._containsPoint=o},this)}this._startPoint=null,this._dragStartPoint=null,this._plottingObject._dragMoved=!1,i&&(this._plottingObject.moveend=!0)},_dragStart:function(t){this._startPoint=t.target._latlng.clone(),this._dragStartPoint=t.target._latlng.clone(),this._plottingObject._dragMoved=!1},_drag:function(t){var e=t.target._latlng,i=e.lat,o=e.lng,n=i-this._startPoint.lat,l=o-this._startPoint.lng;(n||l)&&(this._plottingObject._dragMoved||(this._plottingObject._dragMoved=!0,this._plottingObject.fire("dragstart",t)),this._startPoint.lat=i,this._startPoint.lng=o,this._plottingObject.fire("predrag",t),t.dLat=n,t.dLng=l,this._plottingObject.fire("drag",t))},_dragEnd:function(t){var e=t.target._latlng,i=this.moved();if(i){this._plottingObject.fire("dragend",{distance:Ah(this._dragStartPoint,e)});var o=this._plottingObject._containsPoint;this._plottingObject._containsPoint=L.Util.falseFn,L.Util.requestAnimFrame(function(){this._plottingObject._containsPoint=o},this)}this._startPoint=null,this._dragStartPoint=null,this._plottingObject._dragMoved=!1,i&&(this._plottingObject.moveend=!0)},_addToMapAndBindMarker:function(t){t.addTo(this._plottingObject._map),t.on("dragstart",this._dragStart,this),t.on("drag",this._drag,this),t.on("dragend",this._dragEnd,this),t.dragging.enable()},_unbindMarkerEvents:function(t){null!=t&&(t.off("dragstart",this._dragStart,this),t.off("drag",this._drag,this),t.off("dragend",this._dragEnd,this),t.dragging.disable())},_onResetEditMarkersValues:function(){var t=this._plottingObject.getBounds();this.moveMarker._latlng=t.getCenter(),this.moveMarker.update()}}),xh=bh.extend({surroundLineType:null,scaleByMap:null,latLngs:[],dashLines:[],initialize:function(t,e,i,o){this.geoSymbolTexts=[],this.subAssociatedUuids=[],void 0!=o.symbolData&&void 0!=o.symbolData.dashLines&&(this.dashLines=o.symbolData.dashLines),this.latLngs=i||[],bh.prototype.initialize.call(this,t,e,i,o),null===this.surroundLineType&&(this.surroundLineType=SuperMap.Plot.AlgoSurroundLineType.NONE)},destroy:function(){bh.prototype.destroy.call(this),this.surroundLineType=null,this.scaleByMap=null,this.latLngs=[]},setLatLngs:function(t){return this.latLngs=t,this.layer&&this.layer.fire("propertychanged",{feature:this,property:t}),this.redraw()},getLatLngs:function(){return this.latLngs},addLatLng:function(t){if(this.latLngs[this.latLngs.length-1].lat!==t.lat||this.latLngs[this.latLngs.length-1].lng!==t.lng)return this.latLngs.push(t),this.redraw()},setScaleByMap:function(t){this.scaleByMap=t,this.redraw()},getScaleByMap:function(){return this.scaleByMap},getSurroundLineType:function(){return this.surroundLineType},setSurroundLineType:function(){},_resizeLatLngs:function(t,e,i,o){if(this.symbolType!==SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS){var n=this._resizeBounds(t,e,i);if(!(SuperMap.Plot.PlottingUtil.equalFuzzy(n.getWest(),n.getEast())&&SuperMap.Plot.PlottingUtil.equalFuzzy(n.getNorth(),n.getSouth())||SuperMap.Plot.PlottingUtil.equalFuzzy(i.getWest(),i.getEast())&&SuperMap.Plot.PlottingUtil.equalFuzzy(i.getNorth(),i.getSouth()))){var l=SuperMap.Plot.PlottingUtil.equalFuzzy(i.getWest(),i.getEast())?0:(n.getEast()-n.getWest())/(i.getEast()-i.getWest()),s=SuperMap.Plot.PlottingUtil.equalFuzzy(i.getNorth(),i.getSouth())?0:(n.getNorth()-n.getSouth())/(i.getNorth()-i.getSouth()),a=L.latLng((i.getNorth()+i.getSouth())/2,(i.getWest()+i.getEast())/2),r=L.latLng((n.getNorth()+n.getSouth())/2,(n.getWest()+n.getEast())/2);if(this.symbolType===SuperMap.Plot.SymbolType.ANNOFRAMESYMBOL||this.symbolType===SuperMap.Plot.SymbolType.ANNOFRAMESYMBOLM||this.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXTBOX||this.symbolType===SuperMap.Plot.SymbolType.LINEMARKING)this.latLngs[0].lng=r.lng+(o[0].lng-a.lng)*l,this.latLngs[0].lat=r.lat+(o[0].lat-a.lat)*s,this.latLngs[1].lng=r.lng+(o[1].lng-a.lng)*l,this.latLngs[1].lat=r.lat+(o[1].lat-a.lat)*s;else if(this.symbolType===SuperMap.Plot.SymbolType.CONCENTRICCIRCLE)if(2===e||4===e||5===e||7===e){1===l&&(l=0),1===s&&(s=0);for(var u=Math.sqrt(l*l+s*s),p=L.Util.latLngsToSuperMapPoints(o),h=1;h<p.length;h++)p[h]=SuperMap.Plot.PlottingUtil.findPointInLine(p[0],p[h],SuperMap.Plot.PlottingUtil.distance(p[0],p[h])*u);this.latLngs=L.Util.superMapPointsToLatLngs(p)}else{for(var c=Math.sqrt(l*l+s*s)/Math.sqrt(2),y=L.Util.latLngsToSuperMapPoints(o),g=1;g<y.length;g++)y[g]=SuperMap.Plot.PlottingUtil.findPointInLine(y[0],y[g],SuperMap.Plot.PlottingUtil.distance(y[0],y[g])*c);this.latLngs=L.Util.superMapPointsToLatLngs(y)}else for(var f=0;f<o.length;f++)this.latLngs[f].lng=r.lng+(o[f].lng-a.lng)*l,this.latLngs[f].lat=r.lat+(o[f].lat-a.lat)*s}}},_getLatLng:function(t,e,i){var o=0,n=0;switch(t){case 1:o=e.getWest()+i.lng,n=e.getNorth()+i.lat;break;case 3:o=e.getEast()+i.lng,n=e.getNorth()+i.lat;break;case 6:o=e.getWest()+i.lng,n=e.getSouth()+i.lat;break;case 8:o=e.getEast()+i.lng,n=e.getSouth()+i.lat;break;case 2:o=(e.getEast()+e.getWest())/2,n=e.getNorth()+i.lat;break;case 4:o=e.getWest()+i.lng,n=(e.getNorth()+e.getSouth())/2;break;case 5:o=e.getEast()+i.lng,n=(e.getNorth()+e.getSouth())/2;break;case 7:o=(e.getEast()+e.getWest())/2,n=e.getSouth()+i.lat}return L.latLng(n,o)},_setSymbolData:function(t){if(bh.prototype._setSymbolData.call(this,t),this.symbolData){SuperMap.Plot.AnalysisSymbol.setStyle(this.style,this.symbolData,!0),this.symbolData.scaleByMap=this.scaleByMap,this.symbolData.surroundLineType=this.surroundLineType,this.symbolData.algoMaxEditPts=this.maxEditPts,this.symbolData.algoMinEditPts=this.minEditPts,Object.prototype.hasOwnProperty.call(this.symbolData,"localePoints")||(this.symbolData.localePoints=[]);for(var e=this.getLatLngs().length,i=0;i<e;i++)this.symbolData.localePoints.length>i?(this.symbolData.localePoints[i].x=this.getLatLngs()[i].lng,this.symbolData.localePoints[i].y=this.getLatLngs()[i].lat):this.symbolData.localePoints.push({x:this.getLatLngs()[i].lng,y:this.getLatLngs()[i].lat,z:0})}},_parseSymbolData:function(){if(bh.prototype._parseSymbolData.call(this),null!==this.symbolData&&(this.style=SuperMap.Plot.AnalysisSymbol.getStyle(this.symbolData,!0),this.maxEditPts=this.symbolData.algoMaxEditPts,this.minEditPts=this.symbolData.algoMinEditPts,void 0!==this.symbolData.isEdit&&(this.isEdit=this.symbolData.isEdit),void 0!==this.symbolData.scaleByMap&&(this.scaleByMap=this.symbolData.scaleByMap),this.surroundLineType=this.symbolData.surroundLineType,this.symbolData.localePoints)){this.latLngs=[];for(var t=0;t<this.symbolData.localePoints.length;t++)this.latLngs.push(L.latLng(this.symbolData.localePoints[t].y,this.symbolData.localePoints[t].x))}},_modifyPoint:function(){},_transSymbolCellsToLayers:function(t){var e=[],i="";null!==this._map&&this._map instanceof L.Map&&(i=this._map.options.crs.code);for(var o=0;o<t.length;o++)if(0!==this.surroundLineType||!0!==t[o].surroundLineFlag){L.Util.isMercatorProjection(i)&&(t[o].positionPoints=L.Util.conventProjectPts(L.Util.superMapPointsToLatLngs(t[o].positionPoints)));var n={type:t[o].type,positionPoints:SuperMap.Plot.PlottingUtil.clonePoints(t[o].positionPoints),style:SuperMap.Util.cloneObject(t[o].style),angle:t[o].angle,isCalculate:t[o].isCalculate,textContent:t[o].textContent};1===this.symbolType?n.positionPoints=SuperMap.Plot.Primitives.getSpatialData(n.type,n.positionPoints,n.angle,!1):n.positionPoints=SuperMap.Plot.Primitives.getSpatialData(n.type,n.positionPoints,n.angle,n.isCalculate),e.push(n)}0!==e.length&&this._addSurroundLineCells(e);for(var l=0;l<e.length;l++)L.Util.isMercatorProjection(i)?e[l].positionPoints=L.Util.unConventProjectPts(e[l].positionPoints):e[l].positionPoints=L.Util.superMapPointsToLatLngs(e[l].positionPoints),this._createAndDrawLayer(e[l].type,e[l].positionPoints,e[l].style,e[l].textContent)},_isPolylineType:function(t){switch(t){case 24:case 44:case 48:case 290:case 400:case 590:return!0;default:return!1}},_createAndDrawSpecialEffect:function(t,e){var i=null;if(e.effectType==SuperMap.Plot.SpecialEffectType.AIM){if(e.viewUuid=this.uuid,!e.aimUuid)return alert("请传入目标点标号的唯一标识符！"),null}else if(e.effectType==SuperMap.Plot.SpecialEffectType.COMMUNICATIONLINK){if(e.senderUuid=this.uuid,!e.receiverUuid)return alert("请传入接收点标号的唯一标识符！"),null}else e.associatedUuid=this.uuid;switch(e.effectType){case SuperMap.Plot.SpecialEffectType.AIM:var o=setTimeout(function(){i=L.supermap.plotting.aim(e.viewUuid,e.aimUuid,null,null,e),clearTimeout(o)},500);break;case SuperMap.Plot.SpecialEffectType.BOOM:i=L.supermap.plotting.boom(e.associatedUuid,null,e);break;case SuperMap.Plot.SpecialEffectType.COMMUNICATIONLINK:var n=setTimeout(function(){i=L.supermap.plotting.communicationLink(e.senderUuid,e.receiverUuid,null,null,e),clearTimeout(n)},500);break;case SuperMap.Plot.SpecialEffectType.DESTROY:var l=setTimeout(function(){i=L.supermap.plotting.destroy(e.associatedUuid,e),clearTimeout(l)},500);break;case SuperMap.Plot.SpecialEffectType.SCANRADAR:i=L.supermap.plotting.scanRadar(e.associatedUuid,null,e);break;case SuperMap.Plot.SpecialEffectType.SECTORDETECTIONRANGE:i=L.supermap.plotting.sectorDetectionRange(e.associatedUuid,null,e)}return i},_createAndDrawLayer:function(t,e,i,o,n){var l=this._createLayer(t,e,o,n);2e3===t&&this._addComponents(l),null==i&&(i={}),this._isPolylineType(t)&&(i.fillLimit=!0,i.fill=!1);var s={};if(s=SuperMap.Util.copyAttributes(s,i),this._copyStyleForCell(s,this.style,l),34===t&&!1===i.sizeFixed){var a=this._map.latLngToLayerPoint(e[0]),r=this._map.latLngToLayerPoint(L.latLng(e[0].lat+s.fontSize,e[0].lng));0!==Math.abs(r.y-a.y)&&(s.fontSize=Math.abs(r.y-a.y))}else if(this.scaleByMap){var u=1;if("function"==typeof this.layer.getSymZoomScale&&(u=this.layer.getSymZoomScale()),null!=this.minScale&&u<this.minScale?u=this.minScale:null!=this.maxScale&&u>this.maxScale&&(u=this.maxScale),null!=s.fontSize&&(34===t&&!0===this.style.sizeFixed||(s.fontSize=s.fontSize*u)),null!=s.fontSpace&&(s.fontSpace=s.fontSpace*u),null!=s.weight&&(s.weight=s.weight*u),null!=s.dashArray){for(var p=s.dashArray.split(","),h=0;h<p.length;h++)p[h]=parseInt(p[h])*u;s.dashArray=p.join()}s.surroundLineWidth&&(s.surroundLineWidth=this.style.surroundLineWidth*u)}return L.setOptions(l,s),2e3===t?l.redraw():this._addComponents(l),l},_createLayer:function(t,e,i,o){var n=null;switch(t){case 24:case 44:case 48:case 290:case 400:case 590:n=L.polyline(e,{smoothFactor:0});break;case 29:case 31:case 32:case 28:case 410:case 370:case 380:case 390:case 320:case 321:case 350:case 360:n=L.polygon(e,{smoothFactor:0});break;case 26:n=L.rectangle(e);break;case 34:n=L.supermap.plotting.text(e,{text:i});break;case 2e3:n=L.circle(e[0],o);break;case 20:n=L.supermap.plotting.pointImage(e,o)}return n},_addSurroundLineCells:function(t){if(this.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL){if(this.symbolType===SuperMap.Plot.SymbolType.TEXTSYMBOL)return null;if(this._map){var e=[],i=[],o=1;this.scaleByMap&&("function"==typeof this.layer.getSymZoomScale&&(o=this.layer.getSymZoomScale()),null!=this.minScale&&o<this.minScale&&(o=this.minScale),null!=this.maxScale&&o>this.maxScale&&(o=this.maxScale));for(var n=null,l=0,s=t.length;l<s;l++)if(!t[l].style.lineWidthLimit||0!==t[l].style.weight){var a=SuperMap.Util.cloneObject(t[l].style);if(a.surroundLineFlag=!0,a.fill=!1,a.fillLimit=!0,a.fillColorLimit=!0,!0!==t[l].style.surroundLineLimit?t[l].style.surroundLineType=this.surroundLineType:void 0===t[l].style.surroundLineType&&(t[l].style.surroundLineType=SuperMap.Plot.AlgoSurroundLineType.NONE),t[l].style.surroundLineType!==SuperMap.Plot.AlgoSurroundLineType.NONE&&(a.surroundLineType=t[l].style.surroundLineType,t[l].type!==SuperMap.Plot.SymbolType.TEXTSYMBOL&&0!==t[l].positionPoints.length)){if(t[l].style.surroundLineType===SuperMap.Plot.AlgoSurroundLineType.INNER||t[l].style.surroundLineType===SuperMap.Plot.AlgoSurroundLineType.OUT){var r=this.style.surroundLineWidth/2+this.style.weight/2;!0===t[l].style.surroundLineLimit&&!0===t[l].style.lineWidthLimit?r=t[l].style.surroundLineWidth/2+t[l].style.weight/2:!0===t[l].style.surroundLineLimit&&!0!==t[l].style.lineWidthLimit?r=t[l].style.surroundLineWidth/2+this.style.weight/2:!0!==t[l].style.surroundLineLimit&&!0===t[l].style.lineWidthLimit&&(r=this.style.surroundLineWidth/2+t[l].style.weight/2);var u=this._map.layerPointToLatLng(L.point(0,0)),p=this._map.layerPointToLatLng(L.point(r*o,0)),h=new SuperMap.Geometry.Point(u.lng,u.lat),c=new SuperMap.Geometry.Point(p.lng,p.lat),y=SuperMap.Plot.PlottingUtil.distance(h,c),g=1,f=SuperMapAlgoPlot.AlgoSymbolFactory.calSurroundLineDir(this.libID,this.code);if(f||32===t[l].type||29===t[l].type||31===t[l].type||26===t[l].type||44===t[l].type)if(null==n&&f&&SuperMapAlgoPlot.AlgoSymbolFactory.getAlgoWayType(this.libID,this.code)===SuperMapAlgoPlot.AddPoint_WayType.POLYLINE_CLOSE)(d=L.Util.latLngsToSuperMapPoints(this.getLatLngs()))[0].x==d[d.length-1].x&&d[0].y==d[d.length-1].y||d.push(new SuperMap.Geometry.Point(d[0].x,d[0].y)),n=SuperMap.Plot.PlottingUtil.innerOutlineDir(d);else if(null==n&&f&&SuperMapAlgoPlot.AlgoSymbolFactory.getAlgoWayType(this.libID,this.code)===SuperMapAlgoPlot.AddPoint_WayType.CURVE_CLOSE){var d,m;m=3>=(d=L.Util.latLngsToSuperMapPoints(this.getLatLngs())).length?SuperMapAlgoPlot.Primitives.getSpatialData(SuperMapAlgoPlot.SymbolType.KIDNEY,d):SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(d,!0),n=SuperMap.Plot.PlottingUtil.innerOutlineDir(m)}else g=SuperMap.Plot.PlottingUtil.innerOutlineDir(t[l].positionPoints);var S=t[l].style.surroundLineType===SuperMap.Plot.AlgoSurroundLineType.OUT?1:-1,P=g*S*y;if(null!=n&&(P=n*S*y),this._isPolylineType(t[l].type)||t[l].positionPoints.push(t[l].positionPoints[0]),0===(e=SuperMap.Plot.PlottingUtil.getSurroundLinePts(t[l].positionPoints,P)).length)continue;var b={type:t[l].type,positionPoints:e,style:a};t.splice(++l,0,b),++s}if(t[l].style.surroundLineType===SuperMap.Plot.AlgoSurroundLineType.ALL){if(0===(e=SuperMap.Plot.PlottingUtil.clonePoints(t[l].positionPoints)).length)continue;var v={type:t[l].type,positionPoints:e,style:a};if(t.splice(++l,0,v),++s,0===(i=SuperMap.Plot.PlottingUtil.clonePoints(t[l].positionPoints)).length)continue;var M=SuperMap.Util.cloneObject(a);delete M.fillSymbolID,M.surroundLineFlag=!1,M.fill=!1,M.fillLimit=!0,M.fillColorLimit=!0;var _={type:t[l].type,positionPoints:i,style:M};t.splice(++l,0,_),++s}}}}}},_updateSymbolTexts:function(){for(var t=0;t<this.geoSymbolTexts.length;t++){var e=this.geoSymbolTexts[t];if(null===e||void 0===e)return;null==e.layer||null!=e.layer.getVisibility&&!0!==e.layer.getVisibility()||(e.fromZoom=this.fromZoom,e.redraw())}},_updateCanvasFills:function(){for(var t=0,e=this.components.length;t<e;t++)!1!==this.components[t].options.fillLimit&&!1!==Boolean(this.components[t].options.fillLimit)||(!0!==this.components[t].options.fill||"LINEAR"!==this.style.fillGradientMode&&"RADIAL"!==this.style.fillGradientMode?this.components[t].options.fillSymbolID>=2&&new SuperMap.Plot.CalculateCanvasGradient(this,this.components[t].getBounds()).createFillMode(this.components[t].options):this._computeGradientInCanvas(this.components[t],this.components[t].options,this.style))},_rotate:function(t,e){for(var i=0;i<this.components.length;i++)this.components[i]instanceof xh?this.components[i]._rotate(t,e):(this.components[i]instanceof mh&&(this.components[i].options.rotation+=-t),this.components[i]instanceof dh&&(this.components[i].options.labelRotation?(this.components[i].options.labelRotation+=-t,this.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&0===this.components[i].options.labelRotation&&(this.components[i].options.labelRotation=360)):this.components[i].options.labelRotation=-t),L.Util.rotateLatLngs(this.components[i].getLatLngs(),e,t),this.components[i].setLatLngs(this.components[i].getLatLngs()));L.Util.rotateLatLngs(this.getLatLngs(),e,t)},_move:function(t,e){if(null!=this.graphic&&null!=this.graphic.layer&&!0===this.graphic.layer.getVisibility())L.Util.moveLatLngs(this.getLatLngs(),t,e),this.graphic.update();else if(null!=this.layer&&(null==this.layer.getVisibility||!0===this.layer.getVisibility())){for(var i=0,o=this.components.length;i<o;i++)L.Util.moveLatLngs(this.components[i].getLatLngs(),t,e),this.components[i].setLatLngs(this.components[i].getLatLngs());this._renderer instanceof L.Canvas&&this._updateCanvasFills(),L.Util.moveLatLngs(this.getLatLngs(),t,e),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)}this.isAnimation?this._map.getFeatureByUuid(this.uuid).fire("latlngchanged",{feature:this,difference:{lat:t,lng:e}}):this.fire("latlngchanged",{feature:this,difference:{lat:t,lng:e}})},_resize:function(t,e){isNaN(t)&&(t=1),this.symbolType===SuperMap.Plot.SymbolType.TEXTSYMBOL&&(this.style.fontSize*=t);for(var i=0;i<this.components.length;i++)this.components[i]instanceof xh?this.components[i]._resize(t,e):(this.components[i]instanceof mh&&(this.components[i].options.graphicWidth*=t,this.components[i].options.graphicHeight*=t),this.components[i]instanceof dh&&(this.components[i].options.fontSize*=t),L.Util.resizeLatLngs(this.components[i].getLatLngs(),e,t),this.components[i].setLatLngs(this.components[i].getLatLngs()));L.Util.resizeLatLngs(this.getLatLngs(),e,t)},_computeGradientInCanvas:function(t,e){t.getBounds().isValid()&&(e.fillColor=new SuperMap.Plot.CalculateCanvasGradient(this,t.getBounds()).createGradient())},_computeGradientInSVG:function(t){t.fillColor="url(#"+new SuperMap.Plot.CalculateSVGGradient(this).createGradient()+")"},_dashArray:function(t,e){var i=null;return 1===t?i=[2*e,2*e].join():2===t?i=[0,2*e].join():3===t?i=[2*e,2*e,0,2*e].join():4===t?i=[2*e,2*e,0,2*e,0,2*e].join():5===t?i=[.3,.05].join():6===t?i=[.2,.05].join():7===t?i=[.16,.05].join():8===t?i=[.14,.032].join():0===t?i=null:888===t&&(i=[0].join()),i},_lineSymbolID:function(t,e){return t===[2*e,2*e].join()?1:t===[0,2*e].join()?2:t===[2*e,2*e,0,2*e].join()?3:t===[2*e,2*e,0,2*e,0,2*e].join()?4:t==[.3,.05].join()?5:t==[.2,.05].join()?6:t==[.16,.05].join()?7:t==[.14,.032].join()?8:t==[].join()?0:t==[0].join()?888:999},_copyStyleForFeature:function(t,e){if(!0===e.surroundLineLimit&&(t.surroundLineColor=e.surroundLineColor,t.surroundLineColorOpacity=e.surroundLineColorOpacity,t.surroundLineWidth=e.surroundLineWidth),e.lineWidthLimit&&(t.weight=e.weight),e.lineColorLimit&&(t.color=e.color,t.opacity=e.opacity),e.lineTypeLimit)if(null===e.dashArray||void 0===e.dashArray)t.lineSymbolID=0;else{var i=e.weight;t.lineSymbolID=this._lineSymbolID(e.dashArray,i)}e.fillLimit&&(void 0===e.fill||!1===e.fill?t.fillSymbolID=1:t.fillSymbolID=0,e.fillColorLimit?null===e.fillColor||void 0===e.fillColor?(t.fillColor=e.color,t.fillOpacity=e.opacity):(t.fillColor=e.fillColor,t.fillOpacity=e.opacity):(t.fillColor=e.color,t.fillOpacity=e.opacity),t.fillGradientMode=e.fillGradientMode),e.fontSizeLimit&&(t.fontSize=e.fontSize),e.fontColorLimit&&(t.fontColor=e.fontColor),void 0!==e.labelAlign&&(t.labelAlign=e.labelAlign),void 0!==e.labelRotation&&(t.labelRotation=e.labelRotation),(e.fontSizeLimit||e.fontColorLimit)&&(t.fontWeight=e.fontWeight,t.fontStyle=e.fontStyle,t.fontStroke=e.fontStroke,t.fontStrokeColor=e.fontStrokeColor,t.fontStrokeWidth=e.fontStrokeWidth,t.fontBackground=e.fontBackground,t.fontBackgroundColor=e.fontBackgroundColor,t.fontShadow=e.fontShadow,t.fontShadowColor=e.fontShadowColor,t.fontShadowOffsetX=e.fontShadowOffsetX,t.fontShadowOffsetY=e.fontShadowOffsetY,t.fontSpace=e.fontSpace,t.fontPercent=e.fontPercent,t.fontFamily=e.fontFamily,t.fontOpacity=e.fontOpacity),t.graphicWidth<0&&(t.graphicWidth=Math.abs(t.graphicWidth)),t.graphicHeight<0&&(t.graphicHeight=Math.abs(t.graphicHeight)),t.fontSize<0&&(t.fontSize=Math.abs(t.fontSize))},_copyStyleForCell:function(t,e,i){if(e.display&&"none"===e.display)t.display=e.display;else{if(!0===t.surroundLineFlag){var o=e.weight;!0===t.lineWidthLimit&&(o=t.weight),!0!==t.surroundLineLimit?(t.color=e.surroundLineColor,t.opacity=e.surroundLineColorOpacity,t.weight=e.surroundLineWidth):(t.color=t.surroundLineColor,t.opacity=t.surroundLineColorOpacity,t.weight=t.surroundLineWidth),t.surroundLineType===SuperMap.Plot.AlgoSurroundLineType.ALL&&(t.weight=2*t.weight+o),t.dashArray=null,t.lineCap||void 0===e.lineCap||(t.lineCap=e.lineCap),t.lineJoin||void 0===e.lineJoin||(t.lineJoin=e.lineJoin)}else{if(t.lineWidthLimit||(t.weight=e.weight),t.lineColorLimit||(t.color=e.color,t.opacity=e.opacity),!t.lineTypeLimit){if(void 0!==e.lineSymbolID){e.lineSymbolID=parseInt(e.lineSymbolID);var n=e.weight;e.dashArray=this._dashArray(e.lineSymbolID,n)}t.dashArray=e.dashArray}if(t.lineCap||void 0===e.lineCap||(t.lineCap=e.lineCap),t.lineJoin||void 0===e.lineJoin||(t.lineJoin=e.lineJoin),t.lineSymbolID){var l=t.weight;t.dashArray=this._dashArray(parseInt(t.lineSymbolID),l),delete t.lineSymbolID}}if(t.fillLimit||i instanceof dh)1===t.fillSymbolID?t.fill=!1:0===t.fillSymbolID&&(t.fill=!0),t.fillColorLimit||(t.fillColor=t.color,t.fillOpacity=t.opacity);else if("LINEAR"===e.fillGradientMode||"RADIAL"===e.fillGradientMode)t.fillOpacity=1,this._map.getRenderer(this.layer)instanceof L.Canvas?this._computeGradientInCanvas(i,t):this._map.getRenderer(this.layer)instanceof L.SVG&&(t.fillOpacity=1,this._computeGradientInSVG(t));else if(this._map.getRenderer(this.layer)instanceof L.SVG)new SuperMap.Plot.CalculateSVGGradient(this).createFillMode(t);else new SuperMap.Plot.CalculateCanvasGradient(this,i.getBounds()).createFillMode(t);t.fontSizeLimit&&!1!==t.fontSizeLimit||(t.fontSize=e.fontSize),t.fontColorLimit&&!1!==t.fontColorLimit||(t.fontColor=e.fontColor),void 0===t.labelAlign&&void 0!==e.labelAlign&&(t.labelAlign=e.labelAlign),void 0===t.labelRotation&&void 0!==e.labelRotation&&(t.labelRotation=e.labelRotation),!0!==t.fontSizeLimit&&!0!==t.fontColorLimit&&(void 0!==e.fontWeight&&(t.fontWeight=e.fontWeight),void 0!==e.fontStyle&&(t.fontStyle=e.fontStyle),void 0!==e.fontStroke&&(t.fontStroke=e.fontStroke),void 0!==!e.fontStrokeColor&&(t.fontStrokeColor=e.fontStrokeColor),void 0!==e.fontStrokeWidth&&(t.fontStrokeWidth=e.fontStrokeWidth),void 0!==e.fontBackground&&(t.fontBackground=e.fontBackground),void 0!==e.fontBackgroundColor&&(t.fontBackgroundColor=e.fontBackgroundColor),void 0!==e.fontShadow&&(t.fontShadow=e.fontShadow),void 0!==e.fontShadowColor&&(t.fontShadowColor=e.fontShadowColor),void 0!==e.fontShadowOffsetX&&(t.fontShadowOffsetX=e.fontShadowOffsetX),void 0!==e.fontShadowOffsetY&&(t.fontShadowOffsetY=e.fontShadowOffsetY),void 0!==e.fontSpace&&(t.fontSpace=e.fontSpace),void 0!==e.fontPercent&&(t.fontPercent=e.fontPercent),void 0!==e.fontFamily&&(t.fontFamily=e.fontFamily),void 0!==e.fontOpacity&&(t.fontOpacity=e.fontOpacity)),"none"===e.display?t.display=e.display:t.display="display",t.graphicWidth<0&&(t.graphicWidth=Math.abs(t.graphicWidth)),t.graphicHeight<0&&(t.graphicHeight=Math.abs(t.graphicHeight)),t.fontSize<0&&(t.fontSize=Math.abs(t.fontSize))}}});function Oh(t){return function(t){if(Array.isArray(t))return wh(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return wh(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return wh(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wh(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=new Array(e);i<e;i++)o[i]=t[i];return o}L.supermap.plotting.GraphicObject=xh;var Ch=xh.extend({symbolText:null,latLngs:null,uuid:null,isLocked:!1,enableEdit:!0,enableSelected:!0,initialize:function(t,e,i){if(this.libID=0,this.code=SuperMap.Plot.SymbolType.SIGN,this.symbolType=SuperMap.Plot.SymbolType.SIGN,xh.prototype.initialize.call(this,this.libID,this.code,[],i),this.symbolText=e,this.latLngs=t.clone(),null==this.latLngs)return null;this.uuid=null==i.uuid||void 0==i.uuid||/^\s*$/.test(i.uuid)?SuperMap.Plot.PlottingUtil.generateUuid():i.uuid,this.isLocked=null!=i.isLocked&&void 0!=i.isLocked&&i.isLocked,this.enableEdit=null==i.enableEdit||void 0==i.enableEdit||i.enableEdit,this.enableSelected=null==i.enableSelected||void 0==i.enableSelected||i.enableSelected,this._signMode=e.signMode,this._signType=e.signType,this._signRenderMode=e.signRenderMode,this._templateUrl=e.templateUrl,this._dom=e.domStr,this._signImage=e.signImage,this._texts=e.textContent,this._title=e.title,this._initialized=!1,this._canvas=null,this._polyline=null,this._signLayer=null,this._bAdd=!1,this._pixScale=2,this._scale=e.scale,this._init()},_init:function(){var t={signType:this._signType,signMode:this._signMode,signRenderMode:this._signRenderMode,texts:this._texts,title:this._title,templateUrl:this._templateUrl,dom:this._dom,signImage:this._signImage};this._signUtil=L.supermap.plotting.signUtil(t)},setUrl:function(t){if(this.symbolText.signMode==SuperMap.Plot.SignMode.Custom){if(this._templateUrl===t)return;this.symbolText.templateUrl=t,this._templateUrl=t,this._images="",this._signUtil._templateUrl=t,this.redraw()}},setDom:function(t){if(this.symbolText.signMode==SuperMap.Plot.SignMode.Custom){if(this._dom===t)return;this.symbolText.domStr=t,this._dom=t,this._images="",this._templateUrl="",this._signUtil._dom=t,this.redraw()}},setSignType:function(t){this._signType!==t&&(this.symbolText.signMode!=SuperMap.Plot.SignMode.Simple&&this.symbolText.signMode!=SuperMap.Plot.SignMode.Complex||(this.symbolText.signType=t,this._signType=this.symbolText.signType,this._signUtil._signType=t,this._images="",this._templateUrl="",this._signUtil._isExist=!1,this.redraw()))},setSignRenderMode:function(t){this._signRenderMode!==t&&this.redraw()},setSignMode:function(t){this._signMode!==t&&(this._signMode=t,this._images="",this._templateUrl="",this._signUtil._signMode=this._signMode,this.redraw())},setImages:function(t){this._signImage===t&&this._signMode==SuperMap.Plot.SignMode.Image||(this._images="",this._signImage=t,this._templateUrl="",this._signUtil._signImage=t,this.redraw())},setSignSymbolLatlngs:function(t){this.latLngs=t,this.redraw()},setTexts:function(t){t&&(this._texts=Oh(t),this._images=null,this._initialized&&(this._init(),this.redraw()))},getTexts:function(){return Oh(this._texts)},setTitle:function(t){t&&(this._title=[t],this._images=null,this._initialized&&(this._init(),this.redraw()))},getTitle:function(){return this._title},setTitleStyle:function(t){t&&this._signUtil&&(this._signUtil._titleStyle&&JSON.stringify(this._signUtil._titleStyle)==JSON.stringify(t)||0!==this._signMode&&1!==this._signMode||(this._signUtil._setTitleStyle(t),this._images=null,this._initialized&&this.redraw()))},getTitleStyle:function(){if(this._signUtil&&this._signUtil._titleStyle)return SuperMap.Util.cloneObject(this._signUtil._titleStyle)},setTitleFrameStyle:function(t){this._signUtil&&t&&(this._signUtil._titleFrameStyle&&JSON.stringify(this._signUtil._titleFrameStyle)==JSON.stringify(t)||0!==this._signMode&&1!==this._signMode||(this._signUtil._setTitleFrameStyle(t),this._images=null,this._initialized&&this.redraw()))},getTitleFrameStyle:function(){if(this._signUtil&&this._signUtil._titleFrameStyle)return SuperMap.Util.cloneObject(this._signUtil._titleFrameStyle)},_setTextStyle:function(t){this._signUtil&&t&&this._signUtil._textStyles&&(this._signUtil._setTextStyle_(t),this._images=null,this._initialized&&this.redraw())},setTextStyle:function(t,e){t&&(e?!this._signUtil._textStyles||e<0||(this._signUtil._setTextStyle(t,e),this._images=null,this._initialized&&this.redraw()):this._setTextStyle(t))},setTextStyles:function(t){t&&t instanceof Array&&(this._signUtil._setTextStyles(t),this._images=null,this._initialized&&this.redraw())},getTextStyles:function(){if(this._signUtil._textStyles){for(var t=[],e=0;e<this._signUtil._textStyles.length;e++){var i=SuperMap.Util.cloneObject(this._signUtil._textStyles[e]);t.push(i)}return t}},setContentFrameStyle:function(t){t&&this._signUtil&&(this._signUtil._contentFrameStyle&&JSON.stringify(this._signUtil._contentFrameStyle)==JSON.stringify(t)||0!==this._signMode&&1!==this._signMode||(this._signUtil._setContentFrameStyle(t),this._images=null,this._initialized&&this.redraw()))},getContentFrameStyle:function(){if(this._signUtil._contentFrameStyle)return SuperMap.Util.cloneObject(this._signUtil._contentFrameStyle)},setTrayStyle:function(t){t&&(this._signUtil._trayStyle&&JSON.stringify(this._signUtil._trayStyle)==JSON.stringify(t)||0!==this._signMode&&1!==this._signMode||(this._signUtil._setTrayStyle(t),this._images=null,this._initialized&&this.redraw()))},getTrayStyle:function(){if(this._signUtil&&this._signUtil._trayStyle)return SuperMap.Util.cloneObject(this._signUtil._trayStyle)},setIndecatorLineStyle:function(t){t&&JSON.stringify(this.symbolText.lineStyle)!=JSON.stringify(t)&&(t.lineWidth&&(this.symbolText.lineStyle.weight=t.lineWidth),t.lineColor&&(this.symbolText.lineStyle.color=t.lineColor),t.lineSymbolID&&(this.symbolText.lineStyle.lineSymbolID=t.lineSymbolID),t.opacity>=0&&(this.symbolText.lineStyle.opacity=t.opacity),this._images=null,this._initialized&&this.redraw())},getIndecatorLineStyle:function(){return SuperMap.Util.cloneObject(this.symbolText.lineStyle)},setScale:function(t){isNaN(t)||(0==t&&(t=1e-10),this._scale=t,this.symbolText.scale=t,this._images=null,this._initialized&&this.redraw())},getScale:function(){return this.symbolText.scale},setOffset:function(t,e){this.symbolText.offsetX=t,this.symbolText.offsetY=e,this._initialized&&this.redraw()},getOffset:function(){return{x:this.symbolText.offsetX,y:this.symbolText.offsetY}},getVisible:function(){return this.symbolText.visible},setVisible:function(t){this.symbolText.visible=t,this._initialized&&this.redraw()},getPolyLine:function(){return this._polyline},setSymbolText:function(t){this.symbolText=t,t.signMode>=0&&(this._signMode=t.signMode),t.signType>=0&&(this._signType=t.signType),t.signRenderMode>=0&&(this._signRenderMode=t.signRenderMode),t.templateUrl&&(this._templateUrl=t.templateUrl),t.domStr&&(this._dom=t.domStr),t.signImage&&(this._signImage=t.signImage),t.textContent&&(this._texts=t.textContent),t.title&&(this._title=t.title),t.scale&&(this._scale=t.scale),this._images=null,this._signUtil._isExist=!1,this._init(),this._initialized&&this.redraw()},getSign:function(){return this.symbolText},getSignSymbolLatLngs:function(){for(var t,e=0;e<this.components.length;e++)!0===this.components[e].options.isSignSymbol&&(t=this.components[e]);return t?t._latlng:null},getAnchorPoint:function(){return this.latLngs},getBounds:function(){for(var t,e=0;e<this.components.length;e++)!0===this.components[e].options.isSignSymbol&&(t=this.components[e]);return t?t._bounds:null},getLocked:function(){return this.isLocked},setLocked:function(t){t!=this.isLocked&&(this.isLocked=t,this._map&&this._map.getPlotEditControl()&&(this._map.getPlotEditControl().unselectSignSymbol(),this._map.getPlotEditControl().selectSignSymbol(this)))},getEnableSelected:function(){return this.enableSelected},setEnableSelected:function(t){t!=this.enableSelected&&(this.enableSelected=t,this._map&&this._map.getPlotEditControl()&&(this.layer.isSelected&&this.enableSelected?this._map.getPlotEditControl().enableSelectedSignSymbol(this):(this._map.getPlotEditControl().unselectSignSymbol(),this._map.getPlotEditControl().disableSelectedSignSymbol(this))))},getEdit:function(){return this.enableEdit},setEdit:function(t){t!=this.enableEdit&&(this.enableEdit=t,this._map&&this._map.getPlotEditControl()&&this._map.getPlotEditControl().unselectSignSymbol())},move:function(t,e){null!=this.latLngs&&null!=this.symbolText&&this._move(t,e,2),this._reView()},getLayer:function(){return this.layer},remove:function(){this.layer.removeFeatures(this)},destroy:function(){this.layer.removeFeatures(this),this._images=null,this._divContent=null,this._width=null,this._height=null,this.anchorPoint=null,this.associatedUuid=null,this.latLngs=null,this.scale=null,this.uuid=null,this._polyline&&this._polyline.remove(),this._initialized=!1,this.symbolText.destroy(),this.symbolText=null,this._clearComponents()},getJSONData:function(){var t={};return t.symbolText=this.symbolText.getJSONData(),t.associatedUuid=this.associatedUuid,t.latLngs=this.latLngs,t.scale=this.scale,t.uuid=this.uuid,t},_calculateParts:function(){null!=this.layer&&"function"==typeof this.layer.getVisibility&&!1===this.layer.getVisibility()||(this.symbolText.visible?null==this._images||""==this._images||this._images instanceof String?(this.on("signsymbolcompleted",this._createSignSymbol),this._initSignSymbol()):(this._initialized=!1,this._createSignSymbol()):this._removeSignSymbol())},_initSignSymbol:function(){var t=this;this._signUtil._generateImageData().then(function(e){switch(t._signLayer&&t._signLayer.remove(),t._polyline&&t._polyline.remove(),t._signRenderMode){case SuperMap.Plot.SignRenderMode.Billboard:e.toDataURL?(t._canvas=e,t._width=t._canvas.width,t._height=t._canvas.height,t._images=e.toDataURL("image/png"),t.fire("signsymbolcompleted")):(t._canvas=e.canvas,t._images=e.image,t._width=t._canvas.width,t._height=t._canvas.height,t.fire("signsymbolcompleted"));break;case SuperMap.Plot.SignRenderMode.DOM:}})},_createSignSymbol:function(){this.scale=this._signMode!=SuperMap.Plot.SignMode.Image?1/this._pixScale*this._scale:this._scale;var t=this._calculatePositionByPoint(this.latLngs);if(null==t)return null;var e={externalGraphic:this._images,graphicWidth:this._width*this.scale,graphicHeight:this._height*this.scale,rotation:0,graphicXOffset:0,graphicYOffset:0,graphicOpacity:1,fillOpacity:0,isSignSymbol:!0};this._removeSignSymbol(),this._signLayer=L.supermap.plotting.pointImage(L.Util.cloneLatLngs(t.signLatlng.clone()),e),this._polyline=L.polyline(t.lineLatlngs,this.symbolText.lineStyle),this._addComponents(this._polyline),this._addComponents(this._signLayer),this._initialized=!0,null==this._images&&this.off("signsymbolcompleted",this._createSignSymbol),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues),this.fire("signsymbolcreated",{signSymbol:this})},_removeSignSymbol:function(){this._signLayer&&this._signLayer.remove(),this._polyline&&this._polyline.remove(),this._clearComponents()},_calculatePositionByPoint:function(t){var e,i,o,n,l,s,a,r,u,p=t,h=this._width*this.scale,c=this._height*this.scale,y=this.getBounds();switch(this.symbolText.textPosition){case SuperMap.Plot.AnnoPosition.LEFTTOP:e=this._map.latLngToContainerPoint(p),i=L.point([e.x+this.symbolText.offsetX-h/2,e.y-c/2+this.symbolText.offsetY]);break;case SuperMap.Plot.AnnoPosition.LEFTBOTTOM:e=this._map.latLngToContainerPoint(p),i=L.point([e.x+this.symbolText.offsetX-h/2,e.y+c/2+this.symbolText.offsetY]);break;case SuperMap.Plot.AnnoPosition.RIGHTTOP:e=this._map.latLngToContainerPoint(p),i=L.point([e.x+this.symbolText.offsetX+h/2,e.y-c/2+this.symbolText.offsetY]);break;case SuperMap.Plot.AnnoPosition.RIGHTBOTTOM:e=this._map.latLngToContainerPoint(p),i=L.point([e.x+this.symbolText.offsetX+h/2,e.y+c/2+this.symbolText.offsetY]);break;case SuperMap.Plot.AnnoPosition.TOP:e=this._map.latLngToContainerPoint(p),i=L.point([e.x+this.symbolText.offsetX,e.y-c/2+this.symbolText.offsetY]);break;case SuperMap.Plot.AnnoPosition.BOTTOM:e=this._map.latLngToContainerPoint(p),i=L.point([e.x+this.symbolText.offsetX,e.y+c/2+this.symbolText.offsetY]);break;case SuperMap.Plot.AnnoPosition.LEFT:e=this._map.latLngToContainerPoint(p),i=L.point([e.x-h/2+this.symbolText.offsetX,e.y+this.symbolText.offsetY]);break;case SuperMap.Plot.AnnoPosition.RIGHT:e=this._map.latLngToContainerPoint(p),i=L.point([e.x+h/2+this.symbolText.offsetX,e.y+this.symbolText.offsetY])}return y&&(l=L.latLng(y.getNorth(),y.getWest()),s=this._map.latLngToContainerPoint(l),a=L.latLng(y.getSouth(),y.getEast()),r=s,u=this._map.latLngToContainerPoint(a)),n=L.point([e.x+this.symbolText.offsetX,e.y+this.symbolText.offsetY]),r=r||L.point([n.x-h/2,n.y-c]),u=u||L.point([n.x+h/2,n.y]),o=this._getMinDisPoint(r,u,e),{signLatlng:this._map.containerPointToLatLng(i),lineLatlngs:[this._map.containerPointToLatLng(e),this._map.containerPointToLatLng(o)]}},_getMinDisPoint:function(t,e,i){var o=t,n={x:t.x,y:(t.y+e.y)/2},l={x:t.x,y:e.y},s={x:(t.x+e.x)/2,y:e.y},a={x:e.x,y:e.y},r={x:e.x,y:(t.y+e.y)/2},u={x:e.x,y:t.y},p={x:(t.x+e.x)/2,y:t.y},h=(i.x-o.x)*(i.x-o.x)+(i.y-o.y)*(i.y-o.y),c=(i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y),y=(i.x-l.x)*(i.x-l.x)+(i.y-l.y)*(i.y-l.y),g=(i.x-s.x)*(i.x-s.x)+(i.y-s.y)*(i.y-s.y),f=(i.x-a.x)*(i.x-a.x)+(i.y-a.y)*(i.y-a.y),d=(i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y),m=(i.x-u.x)*(i.x-u.x)+(i.y-u.y)*(i.y-u.y),S=(i.x-p.x)*(i.x-p.x)+(i.y-p.y)*(i.y-p.y),P=[];P.push(h),P.push(c),P.push(y),P.push(g),P.push(f),P.push(d),P.push(m),P.push(S);for(var b=P[0],v=0,L=1;L<P.length;L++)P[L]<b&&(b=P[L],v=L);return 0==v?o:1==v?n:2==v?l:3==v?s:4==v?a:5==v?r:6==v?u:7==v?p:null},_move:function(t,e,i){for(var o,n,l=0;l<this.components.length;l++)!0===this.components[l].options.isSignSymbol&&(n=this.components[l]);if(n&&n._latlng){o=n._latlng.clone();var s=L.latLng(o.lat+t,o.lng+e);if(n.setLatLngs([s]),this._polyline&&0!=i){var a=this._polyline.getLatLngs();if(2==i)this.latLngs.lat+=t,this.latLngs.lng+=e,a=this._calculatePositionByPoint(this.latLngs).lineLatlngs;else if(1==i){var r=this._map.latLngToContainerPoint(s),u=this._map.latLngToContainerPoint(o),p=r.x-u.x,h=r.y-u.y;this.symbolText.offsetX+=p,this.symbolText.offsetY+=h;var c=this._calculatePositionByPoint(this.latLngs).lineLatlngs[1];a[1]=c}this._polyline.setLatLngs(a),this._polyline.redraw()}}},_reView:function(){if(null!=this.latLngs&&null!=this.symbolText){var t=this._calculatePositionByPoint(this.latLngs);this.getPolyLine().setLatLngs(t.lineLatlngs)}this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},_latlngchanged:function(t){var e=t.feature;if(void 0!==e.getBounds()._southWest){for(var i,o=this._calculatePositionByFeature(e),n=0;n<this.components.length;n++)!0===this.components[n].options.isSignSymbol&&(i=this.components[n]);void 0!=i&&(i.setLatLngs([o.signLatlng]),this._polyline.setLatLngs(o.lineLatlngs))}}});L.supermap.plotting.signSymbol=function(t,e,i,o){return new Ch(t,e,i,o)};var Eh=xh.extend({superMapAlgoSymbol:null,scalePoints:null,scaleValues:null,polylineConnectLocationPoint:!1,islocationCircle:!1,roundBox:!1,textBoxType:null,arrowHeadType:0,arrowBodyType:0,arrowTailType:0,dashLines:[],initialize:function(t,e,i,o){this.scaleByMap=!0,this.scalePoints=[],this.scaleValues=[],void 0!=o.symbolData?(this.arrowHeadType=0==o.symbolData.arrowHeadType?o.symbolData.arrowHeadType:0,this.arrowBodyType=0==o.symbolData.arrowBodyType?o.symbolData.arrowBodyType:0,this.arrowTailType=0==o.symbolData.arrowTailType?o.symbolData.arrowTailType:0):(this.arrowHeadType=0,this.arrowBodyType=0,this.arrowTailType=0),this.symbolType=0===t?e:SuperMap.Plot.SymbolType.ALGOSYMBOL,void 0!=o.symbolData&&void 0!=o.symbolData.dashLines&&(this.dashLines=o.symbolData.dashLines);var n=[];if(o.symbolData&&o.symbolData.symbolAnnotations&&o.symbolData.symbolAnnotations.length>0)for(var l=0;l<o.symbolData.symbolAnnotations.length;l++){var s=o.symbolData.symbolAnnotations[l],a=new SuperMap.Plot.SymbolAnnotation;a.parseSymbolData(s),n.push(a)}if(xh.prototype.initialize.call(this,t,e,i,o),this.symbolAnnotations=n,123===t&&(40301!==e&&4030101!==e&&4030102!==e&&4030103!==e&&4030104!==e||this.isCurve||(this.isCurve=!1)),0===this.libID&&this.symbolType===SuperMap.Plot.SymbolType.ARROWLINE)null!==this.arrowTypeStart&&void 0!==this.arrowTypeStart&&(this.scaleValues[1]=this.arrowTypeStart,delete this.arrowTypeStart),null!==this.arrowTypeEnd&&void 0!==this.arrowTypeEnd&&(this.scaleValues[2]=this.arrowTypeEnd,delete this.arrowTypeEnd);else if(0===this.libID&&this.symbolType===SuperMap.Plot.SymbolType.COMBINATIONALCIRCLE){if(null!=this.radius&&this.radius.length>0){for(var r=0;r<this.radius.length;r++)this.scaleValues[r]=this.radius[r];delete this.radius}}else 0===this.libID&&this.symbolType===SuperMap.Plot.SymbolType.CONCENTRICCIRCLE?(null!==this.startAngle&&void 0!==this.startAngle&&(this.scaleValues[0]=this.startAngle,delete this.startAngle),null!==this.endAngle&&void 0!==this.endAngle&&(this.scaleValues[1]=this.endAngle,delete this.endAngle)):0===this.libID&&this.symbolType===SuperMap.Plot.SymbolType.POLYGONREGION&&(this.annotationPosition>this.getLatLngs()?this.scaleValues[1]=0:null==this.scaleValues[1]&&(this.scaleValues[1]=this.annotationPosition));SuperMap.Plot.AlgoSymbolFactory.isAccessServer(this.libID,this.code)||(this.minEditPts=SuperMap.Plot.AlgoSymbolFactory.getMinEditPts(this.libID,this.code),this.maxEditPts=SuperMap.Plot.AlgoSymbolFactory.getMaxEditPts(this.libID,this.code),0===this.subSymbols.length&&(this.subSymbols=SuperMap.Plot.AlgoSymbolFactory.getDefaultSubSymbols(this.libID,this.code)),null!==this.style&&!1===this.isEdit&&(this.style=SuperMap.Plot.PlottingUtil.copyAttributes(this.style,SuperMap.Plot.AlgoSymbolFactory.getDefaultStyle(this.libID,this.code))),this.controlPoints=L.Util.latLngsToSuperMapPoints(this.latLngs),this.superMapAlgoSymbol=SuperMap.Plot.AlgoSymbolFactory.getAlgoSymbol(this),this.scaleValues=this.superMapAlgoSymbol.scaleValues,0!==this.libID||this.symbolType!==SuperMap.Plot.SymbolType.SYMBOLTEXTBOX&&this.symbolType!==SuperMap.Plot.SymbolType.LINEMARKING||(this.textBoxType=this.superMapAlgoSymbol.textBoxType),100===this.libID&&26400===this.code&&(this.arrowHeadType=2),22===this.libID&&1016===this.code&&(this.arrowTailType=this.superMapAlgoSymbol.arrowTailType),delete this.controlPoints),this._setBasicSymbolName(),!0===this._isSupportAddAnnotation()&&(this.style.sizeFixed=!1)},onAdd:function(t){this.superMapAlgoSymbol&&(this.superMapAlgoSymbol.map=t._map),xh.prototype.onAdd.call(this,t)},getTextContent:function(){return this.textContent},getArrowHeadType:function(){return this.arrowHeadType},getIsCurveLine:function(){if(void 0!==this.isCurve)return this.isCurve},setCurveLine:function(t){void 0!==this.isCurve&&this.isCurve!==t&&(this.isCurve=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},setArrowHeadType:function(t){1016!==this.code&&26400!==this.code||this.arrowHeadType===t||(this.arrowHeadType=t,this.redraw()),this.layer.fire("propertychanged",{feature:this,property:t})},getArrowTailType:function(){return this.arrowTailType},setArrowTailType:function(t){1016===this.code&&this.arrowTailType!==t&&(this.arrowTailType=t,this.redraw()),this.layer.fire("propertychanged",{feature:this,property:t})},getArrowBodyType:function(){return this.arrowBodyType},setArrowBodyType:function(t){1016===this.code&&this.arrowBodyType!==t&&(this.arrowBodyType=t,this.redraw()),this.layer.fire("propertychanged",{feature:this,property:t})},setRotate:function(t){this.dRotate+=t,0!==this.textContent.length&&(void 0===this.style.labelRotation?this.style.labelRotation=-t:this.style.labelRotation+=-t),null===this.anchorPoint&&this.symbolType!==SuperMap.Plot.SymbolType.TEXTSYMBOL&&this.symbolType!==SuperMap.Plot.SymbolType.CONCENTRICCIRCLE?this.anchorPoint=this.getBounds().getCenter():null===this.anchorPoint&&(this.anchorPoint=L.latLng(this.latLngs[0].lat,this.latLngs[0].lng)),this._rotate(t,this.anchorPoint);for(var e=0,i=this.avoidRegions.length;e<i;e++)L.Util.rotateLatLngs(this.avoidRegions[e].getLatLngs(),this.anchorPoint,t)},getScaleByMap:function(){return this.scaleByMap},setScaleByMap:function(t){this.scaleByMap=t,this.redraw(),this._map&&this._map.getPlotEditControl()&&this._map.getPlotEditControl().fire(SuperMap.Plot.Event.featuresmodified,{features:[this]})},setSurroundLineType:function(t){this.surroundLineType=t,this.redraw(),this._map&&this._map.getPlotEditControl()&&this._map.getPlotEditControl().fire(SuperMap.Plot.Event.featuresmodified,{features:[this]})},setSubSymbol:function(t,e,i,o,n){if(null!==i&&void 0!==i||(i=this.libID),void 0==o&&(o="#ff0000"),void 0==n&&(n=2),e<this.subSymbols.length)this.subSymbols[e].libID=i,this.subSymbols[e].code=t,this.subSymbols[e].lineColor=o,this.subSymbols[e].width2D=n;else{if(this.subSymbols.length!==e)return;this.subSymbols.push(new SuperMap.Plot.SubSymbol(i,t)),this.subSymbols[e].lineColor=o,this.subSymbols[e].width2D=n}if(this.superMapAlgoSymbol){var l=new SuperMap.GetSymbolInfoParameters;l.libID=this.subSymbols[e].libID,l.code=this.subSymbols[e].code,L.supermap.symbolInfoService(this.serverUrl).getSymbolInfo(l,function(t){this.subSymbols[e].symbolData=t.result,this.redraw()},this)}else{var s=new SuperMap.GetSymbolInfoParameters;s.libID=this.libID,s.code=this.code,s.inputPoints=L.Util.latLngsToSuperMapPoints(this.getLatLngs()),s.subSymbols=this.subSymbols,L.supermap.symbolInfoService(this.serverUrl).getSymbolInfo(s,function(t){this.symbolData.innerCells=t.result.innerCells,this.redraw()},this)}this.layer.fire("propertychanged",{feature:this,property:this.subSymbols})},move:function(t,e){if(this.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXTBOX||this.symbolType===SuperMap.Plot.SymbolType.LINEMARKING||this.symbolType===SuperMap.Plot.SymbolType.ANNOFRAMESYMBOLM||this.symbolType===SuperMap.Plot.SymbolType.ANNOFRAMESYMBOL)L.Util.moveLatLngs(this.getLatLngs()[0],t,e),L.Util.moveLatLngs(this.getLatLngs()[1],t,e),this.setLatLngs(this.getLatLngs());else{if(xh.prototype._move.call(this,t,e),0!==this.scalePoints.length&&L.Util.moveLatLngs(this.scalePoints,t,e),null!==this.symbolData&&this.symbolData.innerCells)for(var i=0;i<this.symbolData.innerCells.length;i++)for(var o=0;o<this.symbolData.innerCells[i].positionPoints.length;o++)this.symbolData.innerCells[i].positionPoints[o].x+=e,this.symbolData.innerCells[i].positionPoints[o].y+=t;if(null!==this.symbolData&&this.symbolData.innerCells)for(var n=0;n<this.symbolData.scalePoints.length;n++)this.symbolData.scalePoints[n].x+=e,this.symbolData.scalePoints[n].y+=t}for(var l=0,s=this.avoidRegions.length;l<s;l++)L.Util.moveLatLngs(this.avoidRegions[l].getLatLngs(),t,e);this._updateSymbolTexts(),this.layer.fire("propertychanged",{feature:this,property:this.symbolData})},_parseSymbolData:function(){if(xh.prototype._parseSymbolData.call(this),null!==this.symbolData){if(void 0!==this.symbolData.subSymbolScaleValue&&null!==this.symbolData.subSymbolScaleValue&&(this.subSymbolScaleValue=this.symbolData.subSymbolScaleValue),void 0!==this.symbolData.strokeWidth&&null!==this.symbolData.strokeWidth&&(this.strokeWidth=this.symbolData.strokeWidth),void 0!==this.symbolData.constantSize&&null!==this.symbolData.constantSize&&(this.constantSize=this.symbolData.constantSize),void 0!==this.symbolData.baseScale&&null!==this.symbolData.baseScale&&(this.baseScale=this.symbolData.baseScale),this.symbolData.scaleValues&&0!==this.symbolData.scaleValues.length){this.scaleValues=[];for(var t=0;t<this.symbolData.scaleValues.length;t++)this.scaleValues.push(this.symbolData.scaleValues[t])}Object.prototype.hasOwnProperty.call(this.symbolData,"arrowTailType")&&(this.arrowTailType=this.symbolData.arrowTailType),Object.prototype.hasOwnProperty.call(this.symbolData,"arrowBodyType")&&(this.arrowBodyType=this.symbolData.arrowBodyType),Object.prototype.hasOwnProperty.call(this.symbolData,"arrowHeadType")&&(this.arrowHeadType=this.symbolData.arrowHeadType)}},_setSymbolData:function(t){if(xh.prototype._setSymbolData.call(this,t),null!==this.symbolData&&this.superMapAlgoSymbol){if(this.symbolData.subSymbolScaleValue=this.subSymbolScaleValue,this.symbolData.baseScale=this.baseScale,this.symbolData.strokeWidth=this.strokeWidth,this.symbolData.constantSize=this.constantSize,null!==this.annotationPosition&&void 0!==this.annotationPosition&&(this.symbolData.annotationPosition=this.annotationPosition),Object.prototype.hasOwnProperty.call(this.symbolData,"scaleValues")&&null!==this.symbolData.scaleValues)for(var e=0;e<this.scaleValues.length;e++)this.symbolData.scaleValues.length>e?this.symbolData.scaleValues[e]=this.scaleValues[e]:this.symbolData.scaleValues.push(this.scaleValues[e]);else this.symbolData.scaleValues=[],this.symbolData.scaleValues=this.scaleValues;1016===this.code&&(this.symbolData.arrowTailType=this.arrowTailType,this.symbolData.arrowBodyType=this.arrowBodyType,this.symbolData.arrowHeadType=this.arrowHeadType)}},_calculateParts:function(){"none"===this.style.display||null!=this.layer&&"function"==typeof this.layer.getVisibility&&!1===this.layer.getVisibility()||(this.textContent&&""!==this.textContent&&"???"!==this.textContent||this.symbolType!==SuperMap.Plot.SymbolType.TEXTSYMBOL||(this.textContent="请输入文本"),0!==this.textContent.length&&this.dRotate!==this.style.labelRotation&&(this.style.labelRotation=-this.dRotate),this.superMapAlgoSymbol&&0!==this.getLatLngs().length?(this.superMapCalculateParts(),this._setBasicSymbolText()):!this.superMapAlgoSymbol&&this.getLatLngs().length>=this.minEditPts&&(this._calAccessServerSymbol(),this._setBasicSymbolText()),"function"==typeof this.layer.getSymZoomScale?this.prevScale=this.layer.getSymZoomScale():this.prevScale=1)},_calAccessServerSymbol:function(){for(var t=SuperMap.Plot.AnalysisSymbol.analysisSymbolCells(this.symbolData,!0),e=0;e<t.length;e++)t[e].type===SuperMap.Plot.SymbolType.TEXTSYMBOL&&(t[e].style.fontSize*=2);this._transSymbolCellsToLayers(t),this._analysisAlgoBasicInfo(!1),0!==this.symbolData.subSymbols.length&&this.subSymbols.length!==this.symbolData.subSymbols.length&&this._analysisAlgoBasicInfo(!0)},_analysisAlgoBasicInfo:function(t){if(this.symbolData.scaleValues&&0!==this.symbolData.scaleValues.length){this.scaleValues=[];for(var e=0;e<this.symbolData.scaleValues.length;e++)this.scaleValues.push(this.symbolData.scaleValues[e])}if(t&&this.symbolData.subSymbols){this.subSymbols=[];for(var i=0;i<this.symbolData.subSymbols.length;i++)this.subSymbols.push(new SuperMap.Plot.SubSymbol(this.symbolData.libID,this.symbolData.subSymbols[i]))}if(this.symbolData.scalePoints&&0!==this.symbolData.scalePoints.length){this.scalePoints=[];for(var o=0;o<this.symbolData.scalePoints.length;o++)this.scalePoints.push(L.latLng(this.symbolData.scalePoints[o].y,this.symbolData.scalePoints[o].x))}},_modifyPoint:function(t,e){(e=new SuperMapAlgoPlot.Point(e.lng,e.lat)).isScalePoint=!0,this._clearComponents(),this.superMapModifyPoint(t,e),this._calculateAvoidRegions(),this._calculateAnnotaitons()},_reView:function(){if(!1!==this.layer.enableSymScale){if(this.fromZoom!==this._map.getZoom()){var t=this.getBounds();if(!0===this.isEdit&&t.isValid()&&!0===this.scaleByMap){var e=1;if("function"==typeof this.layer.getSymZoomScale&&!0===this.layer.enableSymScale)e=this.layer.getSymZoomScale();else{var i=this._map.getZoomScale(this._map.getZoom(),this.fromZoom);this.dScale*=i,e=this.dScale}if(34!==this.symbolType&&!0!==this._isSupportAddAnnotation()||!1!==this.style.sizeFixed)if(34!==this.symbolType&&!1===this._isSupportAddAnnotation())for(a=0;a<this.components.length;a++){if(this.components[a]instanceof dh&&null!=this.prevScale)this.components[a].options.fontSize=this.components[a].options.fontSize/this.prevScale*e;else if(this.components[a].options&&this.components[a].options.weight&&(this.components[a].options.weight=this.components[a].options.weight/this.prevScale*e,null!=this.components[a].options.dashArray)){for(var o=this.components[a].options.dashArray.split(","),n=0;n<o.length;n++)o[n]=parseInt(o[n])/this.prevScale*e;this.components[a].options.dashArray=o.join(),this.components[a].setStyle(this.components[a].options)}this.components[a]._project&&this.components[a]._project()}else for(a=0;a<this.components.length;a++){if(this.components[index].options.weight=this.components[index].options.weight/this.prevScale*e,null!=this.components[index].options.dashArray){for(var l=this.components[index].options.dashArray.split(","),s=0;s<l.length;s++)l[s]=parseInt(l[s])/this.prevScale*e;this.components[index].options.dashArray=l.join(),this.components[index].setStyle(this.components[index].options)}this.components[index]._project&&this.components[index]._project()}else for(var a=0;a<this.components.length;a++){if(this.components[a]instanceof dh)this.components[a].options.fontSize=this.style.fontSize*e;else if(this.components[a].options&&this.components[a].options.weight&&(this.components[a].options.weight=this.components[a].options.weight/this.prevScale*e,null!=this.components[a].options.dashArray)){for(var r=this.components[a].options.dashArray.split(","),u=0;u<r.length;u++)r[u]=parseInt(r[u])/this.prevScale*e;this.components[a].options.dashArray=r.join(),this.components[a].setStyle(this.components[a].options)}this.components[a]._project&&this.components[a]._project()}22!==this.libID||1012!==this.code&&1013!==this.code&&1014!==this.code&&1015!==this.code||this.dScale>=1&&this.redraw(),this.layer._map.getRenderer(this.layer)instanceof L.Canvas&&this._updateCanvasFills(),this._updateSymbolTexts(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues),this.prevScale=e}this.fromZoom=this._map.getZoom(),(1===this.surroundLineType||2===this.surroundLineType||SuperMap.Plot.AlgoSymbolFactory.zoomCalSymbol(this.libID,this.code))&&this.redraw(),this.symbolType===SuperMap.Plot.SymbolType.TEXTSYMBOL&&this.isSelected&&this._map.getPlotEditControl()&&this._map.getPlotEditControl().fire(SuperMap.Plot.Event.featuresmodified,{features:[this]})}}else this._reView_disableSymScale()},_reView_disableSymScale:function(){if(void 0!==this.prevStrokeWidth&&this.prevStrokeWidth!==this.style.weight&&(this.strokeWidth=this.style.weight),this.fromZoom!==this._map.getZoom()){var t=this.getBounds();if(!0===this.isEdit&&t.isValid()){var e=this._map.getZoomScale(this._map.getZoom(),this.fromZoom);if(this.dScale*=e,void 0!==this.strokeWidth&&null!==this.strokeWidth||(this.strokeWidth=this.style.weight),void 0===this.baseScale){var i=Math.abs(t.getEast()-t.getWest()),o=Math.abs(t.getNorth()-t.getSouth());i<o&&(i=o);var n=this.strokeWidth/.5*5,l=this._map.layerPointToLatLng(L.point(0,0)),s=this._map.layerPointToLatLng(L.point(n,0)),a=Math.sqrt((l.lat-s.lat)*(l.lat-s.lat)+(l.lng-s.lng)*(l.lng-s.lng));this.baseScale=a/i}if(this.dScale<=this.baseScale){this.scaleStrokeWidth=!0;var r=this.strokeWidth/.5*5,u=this.dScale*r/this.baseScale;this.style.weight=Math.round(u/10),this.style.weight>=this.strokeWidth&&(this.style.weight=this.strokeWidth),this.style.weight<=.5&&(this.style.weight=.5)}else!0===this.scaleStrokeWidth&&(this.style.weight=this.strokeWidth,this.scaleStrokeWidth=!1),this.strokeWidth=this.style.weight;if(this.prevStrokeWidth=this.style.weight,34===this.symbolType&&!1===this.style.sizeFixed||34!==this.symbolType){this.textContent.length>0&&(this.style.fontSize*=e);for(var p=0;p<this.components.length;p++)this.components[p]instanceof dh&&(this.components[p].options.fontSize*=e)}for(var h=0;h<this.components.length;h++)if(this.components[h].isSymbolAnnotation){this.redraw();break}22!==this.libID||1012!==this.code&&1013!==this.code&&1014!==this.code&&1015!==this.code||this.dScale>=1&&this.redraw(),this.layer._map.getRenderer(this.layer)instanceof L.Canvas&&this._updateCanvasFills(),this._updateSymbolTexts(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)}this.fromZoom=this._map.getZoom(),(1===this.surroundLineType||2===this.surroundLineType||SuperMap.Plot.AlgoSymbolFactory.zoomCalSymbol(this.libID,this.code))&&this.redraw(),this._redrawSomeAlgoSymbol(),this.symbolType===SuperMap.Plot.SymbolType.TEXTSYMBOL&&this.isSelected&&this._map.getPlotEditControl()&&this._map.getPlotEditControl().fire(SuperMap.Plot.Event.featuresmodified,{features:[this]})}},_redrawSomeAlgoSymbol:function(){123!=this.libID||3002304!=this.code&&3002402!=this.code&&30023!=this.code&&3002301!=this.code&&3002302!=this.code&&3002303!=this.code&&3002305!=this.code&&3002306!=this.code||this.redraw()},_rotate:function(t,e){if(this.symbolType===SuperMap.Plot.SymbolType.TEXTSYMBOL)for(var i=0;i<this.components.length;i++)this.components[i].options.labelRotation=this.style.labelRotation,this.components[i].redraw();if(L.Util.rotateLatLngs(this.getLatLngs(),e,t),L.Util.rotateLatLngs(this.scalePoints,e,t),this.symbolType!==SuperMap.Plot.SymbolType.CONCENTRICCIRCLE||SuperMap.Plot.PlottingUtil.equalFuzzy(Math.abs(this.scaleValues[0]-this.scaleValues[1]),360)||(this.scaleValues[0]+=t,this.scaleValues[1]+=t),SuperMap.Plot.AlgoSymbolFactory.isAccessServer(this.libID,this.code)){var o=new SuperMap.GetSymbolInfoParameters;o.libID=this.libID,o.code=this.code,o.inputPoints=L.Util.latLngsToSuperMapPoints(this.getLatLngs()),o.scaleValues=this.scaleValues,o.subSymbols=this.subSymbols,L.supermap.symbolInfoService(this.serverUrl).getSymbolInfo(o,function(t){this.symbolData.innerCells=t.result.innerCells,this.symbolData.scalePoints=t.result.scalePoints,this.symbolData.scaleValues=t.result.scaleValues,this.redraw(),this._updateSymbolTexts()},this)}else this.superMapAlgoSymbol;this.redraw(),this._updateSymbolTexts()},_resize:function(t,e){xh.prototype._resize.call(this,t,e);var i=new SuperMapAlgoPlot.Point(e.lng,e.lat);if(this.superMapAlgoSymbol){for(var o=0;o<this.superMapAlgoSymbol.controlPoints.length;o++)SuperMap.Plot.PlottingUtil.resize(i,t,this.superMapAlgoSymbol.controlPoints[o]);for(var n=0;n<this.superMapAlgoSymbol.scalePoints.length;n++)SuperMap.Plot.PlottingUtil.resize(i,t,this.superMapAlgoSymbol.scalePoints[n])}else{for(var l=0;l<this.symbolData.innerCells.length;l++)for(var s=0;s<this.symbolData.innerCells[l].positionPoints.length;s++){var a=new SuperMapAlgoPlot.Point(this.symbolData.innerCells[l].positionPoints[s].x,this.symbolData.innerCells[l].positionPoints[s].y);SuperMap.Plot.PlottingUtil.resize(i,t,a),this.symbolData.innerCells[l].positionPoints[s].x=a.x,this.symbolData.innerCells[l].positionPoints[s].y=a.y}for(var r=0;r<this.symbolData.scalePoints.length;r++){var u=new SuperMapAlgoPlot.Point(this.symbolData.scalePoints[r].x,this.symbolData.scalePoints[r].y);SuperMap.Plot.PlottingUtil.resize(i,t,u),this.symbolData.scalePoints[r].x=u.x,this.symbolData.scalePoints[r].y=u.y}}},_setBasicSymbolName:function(){if(null==this.symbolName)if(0===this.libID)this.symbolName=SuperMap.Plot.AlgoSymbolFactory.getSymbolName(this.libID,this.code);else{var t=L.supermap.plotting.getControl(this._map,this.serverUrl).getSymbolLibManager();this.symbolName=t.getSymbolName(this.libID,this.code)}},_isSupportAddAnnotation:function(){return 0===this.libID&&this.code===SuperMap.Plot.SymbolType.CIRCLESYMBOL||this.code===SuperMap.Plot.SymbolType.RECTANGLESYMBOL||this.code===SuperMap.Plot.SymbolType.ARCSYMBOL||this.code===SuperMap.Plot.SymbolType.CHORDSYMBOL||this.code===SuperMap.Plot.SymbolType.PIESYMBOL||this.code===SuperMap.Plot.SymbolType.ELLIPSESYMBOL||this.code===SuperMap.Plot.SymbolType.PARALLELOGRAM||this.code===SuperMap.Plot.SymbolType.ARBITRARYPOLYGONSYMBOL||this.code===SuperMap.Plot.SymbolType.POLYLINESYMBOL||this.code===SuperMap.Plot.SymbolType.POLYBEZIERSYMBOL||this.code===SuperMap.Plot.SymbolType.POLYBEZIERCLOSESYMBOL||this.code===SuperMap.Plot.SymbolType.PARALLELLINE||this.code===SuperMap.Plot.SymbolType.KIDNEY||this.code===SuperMap.Plot.SymbolType.REGULARPOLYGON||this.code===SuperMap.Plot.SymbolType.RUNWAY||this.code===SuperMap.Plot.SymbolType.CURVEEIGHT||this.code===SuperMap.Plot.SymbolType.BRACESYMBOL||this.code===SuperMap.Plot.SymbolType.ARROWLINE||this.code===SuperMap.Plot.SymbolType.CONCENTRICCIRCLE||this.code===SuperMap.Plot.SymbolType.COMBINATIONALCIRCLE||this.code===SuperMap.Plot.SymbolType.FREECURVE||this.code===SuperMap.Plot.SymbolType.NODECHAIN||this.code===SuperMap.Plot.SymbolType.TRAPEZOIDSYMBOL},_setBasicSymbolText:function(){if(!1!==this.textDisplay&&!0===this._isSupportAddAnnotation()){this.textContent=SuperMap.Plot.PlottingUtil.trim(this.textContent);var t=this.getBounds();if(this.textContent&&null!==this.textContent&&0!==this.textContent.length&&null!==t&&t.isValid()){var e=L.latLng((t.getSouth()+t.getNorth())/2,(t.getEast()+t.getWest())/2),i={surroundLineFlag:!1,labelAlign:"cm"};this._createAndDrawLayer(34,[e],i,this.textContent)}}},superMapCalculateParts:function(){this.toSuperMapAlgorithms(),this.superMapAlgoSymbol.calculateParts(),this.fromSuperMapAlgorithms()},superMapModifyPoint:function(t,e){this.toSuperMapAlgorithms(),this.superMapAlgoSymbol.modifyPoint(t,e),this.fromSuperMapAlgorithms()},setDashLine:function(t){this.dashLines=t},toSuperMapAlgorithms:function(){this.superMapAlgoSymbol.isEdit=this.isEdit,this.superMapAlgoSymbol.controlPoints=L.Util.latLngsToSuperMapPoints(this.getLatLngs()),this.superMapAlgoSymbol.subSymbols=this.subSymbols,this.superMapAlgoSymbol.scaleValues=this.scaleValues,this.superMapAlgoSymbol.scalePoints=L.Util.latLngsToSuperMapPoints(this.scalePoints),this.superMapAlgoSymbol.polylineConnectLocationPoint=this.polylineConnectLocationPoint,this.superMapAlgoSymbol.textContent=this.textContent,this.superMapAlgoSymbol.style=this.style,this.superMapAlgoSymbol.dashLines=this.dashLines,"function"==typeof this.layer.getSymZoomScale&&(this.superMapAlgoSymbol.symScaleDefinition=this.layer.getSymZoomScale()),22===this.libID&&1016===this.code&&(this.superMapAlgoSymbol.arrowHeadType=this.arrowHeadType,this.superMapAlgoSymbol.arrowBodyType=this.arrowBodyType,this.superMapAlgoSymbol.arrowTailType=this.arrowTailType),100===this.libID&&26400===this.code&&(this.superMapAlgoSymbol.arrowHeadType=this.arrowHeadType),0===this.libID&&this.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXTBOX&&(this.superMapAlgoSymbol.textBoxType=this.textBoxType,this.superMapAlgoSymbol.roundBox=this.roundBox),0===this.libID&&this.symbolType===SuperMap.Plot.SymbolType.LINEMARKING&&(this.superMapAlgoSymbol.textBoxType=this.textBoxType,this.superMapAlgoSymbol.islocationCircle=this.islocationCircle),123===this.libID&&(40301!==this.code&&4030101!==this.code&&4030102!==this.code&&4030103!==this.code&&4030104!==this.code&&40302!==this.code||(this.superMapAlgoSymbol.isCurve=this.isCurve))},fromSuperMapAlgorithms:function(){this._transSymbolCellsToLayers(this.superMapAlgoSymbol.components),this.scalePoints=L.Util.superMapPointsToLatLngs(this.superMapAlgoSymbol.scalePoints),this.scaleValues=this.superMapAlgoSymbol.scaleValues,null!=this.superMapAlgoSymbol.textContent&&(this.textContent=this.superMapAlgoSymbol.textContent),this.subSymbols.length!==this.superMapAlgoSymbol.subSymbols.length&&(this.subSymbols=this.superMapAlgoSymbol.subSymbols),(this.latLngs.length!==this.superMapAlgoSymbol.controlPoints.length||100===this.libID&&13700===this.code)&&(this.latLngs=L.Util.superMapPointsToLatLngs(this.superMapAlgoSymbol.controlPoints))},convertGraphicObjects:function(){return 22!==this.libID||1023!==this.code&&1001!==this.code&&1003!==this.code&&1004!==this.code&&1017!==this.code?null:this.convertCells(this)},convertCells:function(t){var e=[],i={},o=SuperMap.Util.cloneObject(this.style);i.uuid=t.uuid,i.serverUrl=t.serverUrl,i.serviceParams=t.options.serviceParams,i.custom=t.custom;var n={},l=t.options;if(t instanceof L.Polygon)this._copyStyleForFeature(o,l),(n=L.supermap.plotting.PlottingObject.createSymbol(0,32,t._latlngs[0],i,o,t.custom)).surroundLineType=l.surroundLineType;else if(t instanceof L.Polyline)this._copyStyleForFeature(o,l),(n=L.supermap.plotting.PlottingObject.createSymbol(0,24,t._latlngs,i,o,t.custom)).surroundLineType=l.surroundLineType;else if(t instanceof L.supermap.plotting.Text)this._copyStyleForFeature(o,l),(n=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.TEXTSYMBOL,t._latlng,i,o,t.custom)).textContent=t._text,n.dRotate=-t.options.labelRotation;else if(t instanceof L.supermap.plotting.PlottingObject){for(var s=0;s<t.components.length;s++){var a=t.components[s];if(!0!==a.options.surroundLineFlag)for(var r=this.convertCells(a),u=0;u<r.length;u++)e.push(r[u])}return e}return e.push(n),e},setTextBoxType:function(t){this.textBoxType!==t&&(this.textBoxType=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getTextBoxType:function(){return this.textBoxType},setRoundBox:function(t){this.roundBox!==t&&(this.roundBox=t,this.textBoxType!==SuperMap.Plot.TextBoxType.NONEBOX&&(this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)))},getRoundBox:function(){return this.roundBox},setLocationCircle:function(t){this.islocationCircle!==t&&(this.islocationCircle=t,this.textBoxType!==SuperMap.Plot.TextBoxType.NONEBOX&&(this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)))},getLocationCircle:function(){return this.islocationCircle},canPolylineConnectLocationPoint:function(){return SuperMap.Plot.AlgoSymbolFactory.canPolylineConnect(this.libID,this.code)},getPolylineConnectLocationPoint:function(){return this.polylineConnectLocationPoint},setPolylineConnectLocationPoint:function(t){this.polylineConnectLocationPoint!==t&&SuperMap.Plot.AlgoSymbolFactory.canPolylineConnect(this.libID,this.code)&&(this.polylineConnectLocationPoint=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getStartArrowType:function(){return this.scaleValues[1]},setStartArrowType:function(t){this.scaleValues[1]!==t&&(this.scaleValues[1]=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getEndArrowType:function(){return this.scaleValues[2]},setEndArrowType:function(t){this.scaleValues[2]!==t&&(this.scaleValues[2]=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},setFontAlign:function(t){this.style.labelAlign!==t&&(this.style.labelAlign=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getTextPosition:function(){if(this.symbolType===SuperMap.Plot.SymbolType.POLYGONREGION)return this.scaleValues[1]},setTextPosition:function(t){this.symbolType===SuperMap.Plot.SymbolType.POLYGONREGION&&this.scaleValues[1]!==t&&(this.scaleValues[1]=t,0!==this.textContent.length&&this.redraw())}}),Ih=function(t,e,i,o){return new Eh(t,e,i,o)};L.supermap.plotting.algoSymbol=Ih,L.supermap.plotting.AlgoSymbol=Eh;var Dh=Eh.extend({startAssociatedUuid:null,endAssociatedUuid:null,lineRelationType:SuperMap.Plot.LineRelationType.ARROW,setLineRelationType:function(t){this.lineRelationType!==t&&(this.lineRelationType=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getLineRelationType:function(){return this.lineRelationType},initialize:function(t,e,i,o){this.libID=0,this.code=SuperMap.Plot.SymbolType.LINERELATION,this.symbolType=SuperMap.Plot.SymbolType.LINERELATION,this.symbolName="连接线",Eh.prototype.initialize.call(this,t,e,i,o)},onAdd:function(t){Eh.prototype.onAdd.call(this,t),this.setJoinLineToDotSymbol(this.startAssociatedUuid),this.setJoinLineToDotSymbol(this.endAssociatedUuid)},setStartFeature:function(t){null!==this.startAssociatedUuid&&(this.removeJoinLineFromDotSymbol(this.startAssociatedUuid),this.startAssociatedUuid=null);var e=this._map.getFeatureByUuid(t);null!=e&&e instanceof Ry&&(null!==this.endAssociatedUuid&&t===this.endAssociatedUuid||(this.startAssociatedUuid=t,this.setJoinLineToDotSymbol(this.startAssociatedUuid),null!==this.endAssociatedUuid&&this.setFeatures(this.startAssociatedUuid,this.endAssociatedUuid)))},setEndFeature:function(t){null!==this.endAssociatedUuid&&(this.removeJoinLineFromDotSymbol(this.endAssociatedUuid),this.endAssociatedUuid="");var e=this._map.getFeatureByUuid(t);null!==e&&e instanceof Ry&&(null!==this.startAssociatedUuid&&t===this.startAssociatedUuid||(this.endAssociatedUuid=t,this.setJoinLineToDotSymbol(this.endAssociatedUuid),null!==this.startAssociatedUuid&&this.setFeatures(this.startAssociatedUuid,this.endAssociatedUuid)))},setFeatures:function(t,e){var i=this._map.getFeatureByUuid(t),o=this._map.getFeatureByUuid(e);null!==i&&null!==o&&i instanceof Ry&&o instanceof Ry&&(this.startAssociatedUuid=t,this.endAssociatedUuid=e,this.setJoinLineToDotSymbol(this.startAssociatedUuid),this.setJoinLineToDotSymbol(this.endAssociatedUuid),this.symbolName="连接线:"+i.symbolName+"_"+o.symbolName,this.redraw())},destroy:function(){this.startFeature=null,this.endFeature=null,Eh.prototype.destroy.call(this)},_calculateParts:function(){var t=!1,e=!1,i=null,o=this._map.getFeatureByUuid(this.startAssociatedUuid);if(null!==o&&o instanceof Ry){var n=L.Util.latLngsToSuperMapPoints(o.latLngs);null!==n&&0<n.length&&(i=n[0]);for(var l=0;l<o.joinLines.length;l++)if(this===o.joinLines[l]){t=!0;break}t||o.joinLines.push(this)}var s=null,a=this._map.getFeatureByUuid(this.endAssociatedUuid);if(null!==a&&a instanceof Ry){var r=L.Util.latLngsToSuperMapPoints(a.latLngs);null!==r&&0<r.length&&(s=r[0]);for(l=0;l<a.joinLines.length;l++)if(this===a.joinLines[l]){e=!0;break}e||a.joinLines.push(this)}if(e&&t&&(this.symbolName="连接线:"+o.symbolName+"_"+a.symbolName),this.superMapAlgoSymbol.controlPoints=L.Util.latLngsToSuperMapPoints(this.latLngs),this.superMapAlgoSymbol.lineRelationType=this.lineRelationType,null!==i&&(0===this.superMapAlgoSymbol.controlPoints.length?this.superMapAlgoSymbol.controlPoints.push(i):this.superMapAlgoSymbol.controlPoints[0]=i),null!==s){if(0===this.superMapAlgoSymbol.controlPoints.length)return;1===this.superMapAlgoSymbol.controlPoints.length?this.superMapAlgoSymbol.controlPoints.push(s):this.superMapAlgoSymbol.controlPoints[this.superMapAlgoSymbol.controlPoints.length-1]=s}this.superMapAlgoSymbol.calculateParts(),this.latLngs=L.Util.superMapPointsToLatLngs(this.superMapAlgoSymbol.controlPoints),this._transSymbolCellsToLayers(this.superMapAlgoSymbol.components),"function"==typeof this.layer.getSymZoomScale?this.prevScale=this.layer.getSymZoomScale():this.prevScale=1},move:function(t,e){if(null!==t&&null!==e){for(var i=0;i<this.getLatLngs().length;i++)this.getLatLngs()[i].lat+=t,this.getLatLngs()[i].lng+=e;for(var o=0,n=this.avoidRegions.length;o<n;o++)this.avoidRegions[o].move(t,e);this.redraw()}},_modifyPoint:function(t,e){if(0===t){var i=this.getFeatureByPoint(e);null!==i?this.setStartFeature(i.uuid):this.setStartFeature(null)}else if(this.getLatLngs().length-1===t){var o=this.getFeatureByPoint(e);null!==o?this.setEndFeature(o.uuid):this.setEndFeature(null)}this.redraw()},getFeatureByPoint:function(t){for(var e=this._map.latLngToLayerPoint(t),i=this.layer.features,o=0;o<i.length;o++){if(i[o]instanceof Ry)if(this._map.latLngToLayerPoint(i[o].getLatLngs()[0]).distanceTo(e)<15)return i[o]}return null},setJoinLineToDotSymbol:function(t){var e=this._map.getFeatureByUuid(t);if(null!=e&&e instanceof Ry){for(var i=!1,o=0;o<e.joinLines.length;o++)if(this===e.joinLines[o]){i=!0;break}i||e.joinLines.push(this)}},removeJoinLineFromDotSymbol:function(t){if(t&&"[object String]"===Object.prototype.toString.call(t)){var e=this._map.getFeatureByUuid(t);if(null!==e&&e instanceof Ry)for(var i=0,o=e.joinLines.length;i<o;i++)if(this===e.joinLines[i]){e.joinLines.splice(i,1);break}}},_parseSymbolData:function(){Eh.prototype._parseSymbolData.call(this),this.symbolData&&(Object.prototype.hasOwnProperty.call(this.symbolData,"startAssociatedUuid")&&(this.startAssociatedUuid=this.symbolData.startAssociatedUuid),Object.prototype.hasOwnProperty.call(this.symbolData,"endAssociatedUuid")&&(this.endAssociatedUuid=this.symbolData.endAssociatedUuid),Object.prototype.hasOwnProperty.call(this.symbolData,"lineRelationType")&&(this.lineRelationType=this.symbolData.lineRelationType))},_setSymbolData:function(){Eh.prototype._setSymbolData.call(this),this.symbolData&&(this.symbolData.endAssociatedUuid=this.endAssociatedUuid,this.symbolData.lineRelationType=this.lineRelationType,this.symbolData.startAssociatedUuid=this.startAssociatedUuid)}}),Uh=function(t,e,i,o){return new Dh(t,e,i,o)};function Rh(t){"@babel/helpers - typeof";return(Rh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Nh(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Bh(o.key),o)}}function Bh(t){var e=function(t,e){if("object"!=Rh(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Rh(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Rh(e)?e:e+""}function kh(t,e,i){return e=Fh(e),function(t,e){if(e&&("object"===Rh(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],Fh(t).constructor):e.apply(t,i))}function Fh(t){return(Fh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function jh(t,e){return(jh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}L.supermap.plotting.lineRelation=Uh,L.supermap.plotting.LineRelation=Dh;var Vh=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=kh(this,e)).goAnimations=[],i.curPlayGroup=0,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jh(t,e)}(e,L.Evented),i=e,(o=[{key:"preView",value:function(){if(0!==this.goAnimations.length)for(var t=this.getAllGroups(),e=0;e<t.length;e++)for(var i=t[e],o=0;o<i.length;o++)i[o].play()}},{key:"play",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(0!==this.goAnimations.length){void 0!==t&&(this.curPlayGroup=this.getAnimationGroupByName(t).index),this.isPlay()&&this.curPlayGroup--;var e=this.getAllGroups();this.curPlayGroup>e.length-1&&(this.curPlayGroup=0);for(var i=e[this.curPlayGroup],o=0;o<i.length;o++){i[o].play(!1)}var n=this.isPause();if(0!==this.curPlayGroup||n)for(l=0;l<i.length;l++){i[l].secondPlay=!0}else{for(var l=0;l<e.length;l++)for(i=e[l],o=0;o<i.length;o++){i[o].showAnimationFeature(!0)}this.resetAnimationShowFlag()}this.curPlayGroup++}}},{key:"stop",value:function(){if(0!==this.goAnimations.length){for(var t=0;t<this.goAnimations.length;t++)this.goAnimations[t].stop();this.curPlayGroup=0}}},{key:"pause",value:function(){if(0!==this.goAnimations.length){for(var t=!1,e=0;e<this.goAnimations.length;e++)this.goAnimations[e].animationState===P.PLAYING?(t=!0,this.goAnimations[e].pause()):this.goAnimations[e].stop();t&&this.curPlayGroup>0&&this.curPlayGroup--}}},{key:"reset",value:function(){if(0!==this.goAnimations.length){for(var t=0;t<this.goAnimations.length;t++)this.goAnimations[t].reset();this.curPlayGroup=0}}},{key:"isPlay",value:function(){for(var t=!1,e=0;e<this.goAnimations.length;e++)this.goAnimations[e].animationState===P.PLAYING&&(t=!0);return t}},{key:"isPause",value:function(){for(var t=!1,e=0;e<this.goAnimations.length;e++)this.goAnimations[e].animationState===P.PAUSE&&(t=!0);return t}},{key:"resetAnimationShowFlag",value:function(){if(this.goAnimations.length>0)for(var t=0;t<this.goAnimations.length;t++)this.goAnimations[t].needSetShowFlag=!0}},{key:"getAnimationTimeLength",value:function(t,e){for(var i=!1,o=0,n=0,l=t-1;l>=0;l--){var s=e[l],a=s.startTime+s.duration;if(a>n&&(n=a),s.animationPlayType===b.PLAYAFTERLASTONE){i=!0;for(var r=l-1;r>=0;r--){var u=e[r],p=u.startTime+u.duration;p>o&&(o=p)}}}return{isExist:i,length1:o,length2:n}}},{key:"getAllGroups",value:function(){for(var t=[],e=0;e<this.goAnimations.length;e++){var i=this.goAnimations[e];if(i.animationPlayType===b.PLAYFROMNOW||0===e){var o=[];o.push(i),t.push(o)}else t[t.length-1].push(i)}return t}},{key:"getAnimationGroup",value:function(t){for(var e=null,i=0,o=this.getAllGroups(),n=0;n<o.length;n++)for(var l=o[n],s=0;s<l.length;s++)if(l[s].name===t.name){e=l,i=s;break}return{index:i,group:e}}},{key:"getAnimationGroupByName",value:function(t){for(var e=null,i=0,o=this.getAllGroups(),n=0;n<o.length;n++)for(var l=o[n],s=0;s<l.length;s++)if(l[s].name===t){e=l,i=n;break}return{index:i,group:e}}},{key:"changeAnimationTime",value:function(t){if(null===t)return!1;var e=this.getAnimationGroup(t).group,i=(this.getAnimationGroup(t).index,e.indexOf(t));if(t.animationPlayType===b.PLAYFROMNOW)t.startTime=t.delayTime;else if(t.animationPlayType===b.PLAYSAMELASTONE||t.animationPlayType===b.UNKNOWN){(o=this.getAnimationTimeLength(i,e)).isExist?t.startTime=o.length1+t.delayTime:t.startTime=t.delayTime}else if(t.animationPlayType===b.PLAYAFTERLASTONE){var o=this.getAnimationTimeLength(i,e);t.startTime=o.length2+t.delayTime}}},{key:"moveAnimation",value:function(t,e){if(!(e<0||e>this.goAnimations.length)){var i=this.goAnimations.indexOf(t);if(i!==e){this.goAnimations=this.move(i,e);for(var o=0;o<this.goAnimations.length;o++){t=this.goAnimations[o];this.changeAnimationTime(t)}}}}},{key:"move",value:function(t,e){var i=[].concat(this.goAnimations);return i.splice(e,0,i.splice(t,1)[0]),i}},{key:"getAnimationDelayTime",value:function(t){if(null===t)return!1;var e=0,i=this.getAnimationGroup(t).group,o=(this.getAnimationGroup(t).index,i.indexOf(t));if(t.animationPlayType===b.PLAYFROMNOW||0===o)e=t.startTime;else if(t.animationPlayType===b.PLAYAFTERLASTONE){var n=this.getAnimationTimeLength(o,i);e=t.startTime-n.length2}else if(t.animationPlayType===b.PLAYSAMELASTONE||t.animationPlayType===b.UNKNOW){for(var l=-1,s=o;s>=0;s--){if(i[s].animationPlayType===b.PLAYAFTERLASTONE){l=s;break}}if(-1===l)e=t.startTime;else{n=this.getAnimationTimeLength(l,i);e=t.startTime-n.length2}}return e}},{key:"getSupportAnimationPlayType",value:function(t){if(!t)return null;var e=[GOAnimationType.ANIMATION_WAY,GOAnimationType.ANIMATION_BLINK,GOAnimationType.ANIMATION_ATTRIBUTE,GOAnimationType.ANIMATION_SHOW,GOAnimationType.ANIMATION_ROTATE,GOAnimationType.ANIMATION_SCALE,GOAnimationType.ANIMATION_GROW,GOAnimationType.ANIMATION_HIDE_EXP,GOAnimationType.ANIMATION_REDUCE_EXP,GOAnimationType.ANIMATION_MOVEIN_EXP,GOAnimationType.ANIMATION_MOVEOUT_EXP,GOAnimationType.ANIMATION_ZOOMIN_EXP,GOAnimationType.ANIMATION_ZOOMOUT_EXP,GOAnimationType.ANIMATION_CURVE_EXP,GOAnimationType.ANIMATION_BROKENLINE_EXP,GOAnimationType.ANIMATION_GROW_EXP,GOAnimationType.ANIMATION_WAY_EXP,GOAnimationType.ANIMATION_BLINK_EXP,GOAnimationType.ANIMATION_SHOW_EXP,GOAnimationType.ANIMATION_MOVEVIEW_EXP,GOAnimationType.ANIMATION_WAY_GROUP],i=t.symbolType;return i===n.DOTSYMBOL||i===n.TEXTSYMBOL||i===n.PICTURE||i===n.ANNOFRAMESYMBOL||i===n.CHORDSYMBOL||i===n.PIESYMBOL||i===n.ARCSYMBOL||i===n.NEWCHORDSYMBOL||i===n.NEWPIESYMBOL||i===n.NEWARCSYMBOL||i===n.ANNOFRAMESYMBOLM||i===n.SYMBOLTEXTBOX||i===n.LINEMARKING||i===n.WIRE||i===n.CURVEEIGHT||i===n.CONCENTRICCIRCLE||i===n.RUNWAY?e=(e=(e=e.filter(function(t){return t!==GOAnimationType.ANIMATION_GROW})).filter(function(t){return t!==GOAnimationType.ANIMATION_GROW_EXP})).filter(function(t){return t!==GOAnimationType.ANIMATION_REDUCE_EXP}):i===n.DOTSYMBOL||i===n.PICTURE?e=(e=(e=e.filter(function(t){return t!==GOAnimationType.ANIMATION_WAY})).filter(function(t){return t!==GOAnimationType.ANIMATION_WAY_EXP})).filter(function(t){return t!==GOAnimationType.ANIMATION_CURVE_EXP}):i===n.DOTSYMBOL&&t.symbolData.dotShowMode||i===n.TEXTSYMBOL||i===n.PICTURE?e=(e=e.filter(function(t){return t!==GOAnimationType.ANIMATION_MOVEOUT_EXP})).filter(function(t){return t!==GOAnimationType.ANIMATION_MOVEIN_EXP}):(i===n.DOTSYMBOL&&t.symbolData.dotShowMode||i!==n.DOTSYMBOL)&&(e=(e=e.filter(function(t){return t!==GOAnimationType.ANIMATION_ZOOMIN_EXP})).filter(function(t){return t!==GOAnimationType.ANIMATION_ZOOMOUT_EXP})),e}},{key:"getSupportSettingPath",value:function(t){var e=t.symbolType;return null!=t&&e!==n.DOTSYMBOL&&e!==n.TEXTSYMBOL&&e!==n.PICTURE&&e!==n.ANNOFRAMESYMBOL}}])&&Nh(i.prototype,o),l&&Nh(i,l),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,l}();SuperMapAlgoPlot.GOAnimationManagerBase=Vh;var zh=L.Evented.extend({startTime:0,duration:5,repeat:!1,name:null,caption:null,animationState:SuperMap.Plot.GOAnimationState.UNKNOWN,goFeature:null,animationGOFeature:null,innerStartTime:0,lastExecute:!1,pauseTime:0,ratio:0,symbolTexts:[],animationPlayType:SuperMap.Plot.AnimationPlayType.UNKNOWN,groupName:null,delayTime:0,playSpeed:1,playPastRatio:0,isSendBegin:!0,secondPlay:!1,needSetShowFlag:!0,initialize:function(t){SuperMap.Util.extend(this,t)},destroy:function(){this.showAnimationFeature(!1),this.removeAnimationFeature(),this.goFeature=null,this.animationGOFeature=null,this.name=null,this.animationState=SuperMap.Plot.GOAnimationState.UNKNOWN;for(var t=0;t<this.symbolTexts.length;t++)this.symbolTexts[t]=null;this.symbolTexts=[]},setGOFeature:function(t){if(void 0===t||null===t||null===t.layer)return!1;var e=L.supermap.plotting.getControl().getGOAnimationManager();if(null===e.map)return!1;if(this.goFeature=t,this.animationGOFeature=this.cloneGOFeature(t),null===this.animationGOFeature)return!1;this.animationGOFeature.symbolAnnotations=[];var i=e.getAnimationLayer(t.layer.name);if(i.setSymScaleDefinition(t.layer.getSymScaleDefinition()),i.addFeatures(this.animationGOFeature),this.getGOAnimationType()===SuperMap.Plot.GOAnimationType.ANIMATION_WAY&&0!==t.geoSymbolTexts.length)for(var o=0;o<t.geoSymbolTexts.length;o++){var n=t.geoSymbolTexts[o];if(null!==n){var l=n.getSymbolData();l.associatedUuid=this.animationGOFeature.uuid;var s={symbolData:l,map:n.map,serverUrl:n.serverUrl},a=L.supermap.plotting.PlottingObject.createSymbol(n.libID,n.code,null,s,null);this.symbolTexts.push(a),e.getAnimationLayer(t.layer.name).addFeatures(a)}}return this.showAnimationFeature(!1),!0},getGOFeature:function(){return this.goFeature},setStartTime:function(t){t<0&&(t=0),this.delayTime=t;for(var e=L.supermap.plotting.getControl().getGOAnimationManager(),i=e.getAnimationGroup(this).group,o=i.indexOf(this);o<i.length;o++){var n=i[o];e.changeAnimationTime(n)}e.fire(SuperMap.Plot.Event.animationmodify,{result:this.getJSONData()})},getStartTime:function(){return L.supermap.plotting.getControl().getGOAnimationManager().getAnimationDelayTime(this)},getDuration:function(){return duration},setDuration:function(t){this.duration=t;for(var e=L.supermap.plotting.getControl().getGOAnimationManager(),i=e.getAnimationGroup(this).group,o=i.indexOf(this);o<i.length;o++){var n=i[o];e.changeAnimationTime(n)}e.fire(SuperMap.Plot.Event.animationmodify,{result:this.getJSONData()})},getAnimationPlayType:function(){return this.animationPlayType},setAnimationPlayType:function(t){this.animationPlayType=t;for(var e=L.supermap.plotting.getControl().getGOAnimationManager(),i=e.getAnimationGroup(this).group,o=i.indexOf(this);o<i.length;o++){var n=i[o];e.changeAnimationTime(n)}e.fire(SuperMap.Plot.Event.animationmodify,{result:this.getJSONData()})},play:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=new Date;this.playSpeedTime=e.getTime()/1e3,this.playTime=e.getTime()/1e3;var i=L.supermap.plotting.getControl().getGOAnimationManager();if(this.animationState===SuperMap.Plot.GOAnimationState.PAUSE){var o=e.getTime()/1e3-this.pauseTime;this.innerStartTime+=o}else this.innerStartTime=e.getTime()/1e3,this.goFeature.isSelected&&i.map.getPlotEditControl()&&i.map.getPlotEditControl().unselectFeatures(this.goFeature),t&&this.showAnimationFeature(!0),i.isPause()||(this.playPastRatio=0);this.lastExecute=!1,this.animationState=SuperMap.Plot.GOAnimationState.PLAYING,i.fire(SuperMap.Plot.Event.animationplay,{result:this.name})},stop:function(){this.animationState=SuperMap.Plot.GOAnimationState.STOP,L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animationstop,{result:this.name})},pause:function(){this.animationState=SuperMap.Plot.GOAnimationState.PAUSE;var t=new Date;this.pauseTime=t.getTime()/1e3,L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animationpause,{result:this.name})},reset:function(){this.animationState=SuperMap.Plot.GOAnimationState.RESET,this.needSetShowFlag=!0,this.showAnimationFeature(!1),L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animationreset,{result:this.name}),this.goFeature.fire("latlngchanged",{feature:this.goFeature})},execute:function(){return!1},canExecute:function(){if(this.animationState!==SuperMap.Plot.GOAnimationState.PLAYING)return!1;var t=(new Date).getTime()/1e3;if(this.innerStartTime+this.startTime>t)return!1;var e=this.getRatioByTime();return!(e>1&&this.lastExecute||e<0)},getRatioByTime:function(){if(this.animationState!==SuperMap.Plot.GOAnimationState.PLAYING)return 0;var t=L.supermap.plotting.getControl().getGOAnimationManager(),e=this.computePlayRatio();return e>=1&&!this.lastExecute?(this.repeat?(e=0,this.lastExecute=!1,this.animationState=SuperMap.Plot.GOAnimationState.PLAYING,this.innerStartTime=(new Date).getTime()/1e3,this.playTime=(new Date).getTime()/1e3):(e=1,this.lastExecute=!0,this.isSendBegin=!0,this.animationState=SuperMap.Plot.GOAnimationState.STOP,t.fire(SuperMap.Plot.Event.animationfinished,{result:this.name})),this.playSpeedTime=(new Date).getTime()/1e3,this.playPastRatio=0):this.isSendBegin?(t.fire(SuperMap.Plot.Event.animationbegin,{result:this.name}),this.isSendBegin=!1):this.secondPlay&&(t.fire(SuperMap.Plot.Event.animationbegin,{result:this.name}),this.secondPlay=!1),e<=0&&(e=0,this.playSpeedTime=(new Date).getTime()/1e3,this.playPastRatio=0),this.ratio=e,e},getPlaySpeed:function(){return this.playSpeed},setPlaySpeed:function(t){var e=L.supermap.plotting.getControl().getGOAnimationManager();e.fire(SuperMap.Plot.Event.animationmodifybefore,{name:"setPlaySpeed",result:this.getJSONData()}),t!==this.playSpeed&&(this.setPlayRatioState(),this.playSpeed=t,e.fire(SuperMap.Plot.Event.animationmodify,{name:"setPlaySpeed",result:this.getJSONData()}))},setFastForWardTime:function(t){if(!(t<0)){var e=t/this.duration;e>1&&(e=1),this.playPastRatio+=e,L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animationmodify,{name:"setFastForWardTime",result:this.getJSONData()})}},setRewindTime:function(t){if(!(t<0)){var e=-t/this.duration;e>0&&(e=0),this.playPastRatio+=e,L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animationmodify,{name:"setRewindTime",result:this.getJSONData()})}},setPlayRatioState:function(){this.playSpeedTime=(new Date).getTime()/1e3,this.playPastRatio=this.ratio},computePlayRatio:function(){var t=0,e=(new Date).getTime()/1e3,i=this.duration/this.playSpeed;return t=this.playTime===this.playSpeedTime?(e-this.innerStartTime-this.startTime)/i:(e-this.playSpeedTime)/i,t+=this.playPastRatio,this.innerStartTime+this.startTime>=e||t<0?0:t},showAnimationFeature:function(t){if(null!==this.animationGOFeature&&null!==this.animationGOFeature.style){if(this.animationGOFeature.style.display=t?"display":"none",this.resetAnimationFeature(t),this.getGOAnimationType()!==SuperMap.Plot.GOAnimationType.ANIMATION_REDUCE_EXP&&this.getGOAnimationType()!==SuperMap.Plot.GOAnimationType.ANIMATION_GROW_EXP&&this.getGOAnimationType()!==SuperMap.Plot.GOAnimationType.ANIMATION_GROW&&this.getGOAnimationType()!==SuperMap.Plot.GOAnimationType.ANIMATION_REDUCE&&this.getGOAnimationType()!==SuperMap.Plot.GOAnimationType.ANIMATION_WAY_EXP||(this.animationGOFeature.style.display=t?"display":"none"),this.getGOAnimationType()===SuperMap.Plot.GOAnimationType.ANIMATION_WAY_EXP){var e=L.supermap.plotting.getControl().getGOAnimationManager(),i=e.goAnimations,o=null;if(null!==i)for(var n=0;n<i.length;n++)if(i[n].animationGOFeature===this.animationGOFeature){o=n;break}t||null==o||e.map.removeLayer(i[o].pathFeature)}this.animationGOFeature.redraw()}if(null!==this.goFeature&&null!==this.goFeature.style){if(t){this.goFeature.style.display="none";for(var l=0;l<this.goFeature.geoSymbolTexts.length;l++)this.goFeature.geoSymbolTexts[l].style.display="none"}else{this.goFeature.style.display="display";for(var s=0;s<this.goFeature.geoSymbolTexts.length;s++)this.goFeature.geoSymbolTexts[s].style.display="display"}this.goFeature.redraw();for(var a=0;a<this.goFeature.geoSymbolTexts.length;a++)this.goFeature.geoSymbolTexts[a].redraw()}},resetAnimationFeature:function(t){if(this.needSetShowFlag)if(this.animationGOFeature.symbolData=SuperMap.Plot.PlottingUtil.cloneObject(this.goFeature.getSymbolData()),this.animationGOFeature.symbolData.uuid=this.animationGOFeature.uuid,SuperMap.Plot.AnalysisSymbol.parseSymbolData(this.animationGOFeature,this.animationGOFeature.symbolData,!0),t)if(this.getGOAnimationType()===SuperMap.Plot.GOAnimationType.ANIMATION_GROW_EXP||this.getGOAnimationType()===SuperMap.Plot.GOAnimationType.ANIMATION_GROW){this.animationGOFeature.style.display="none";for(var e=0;e<this.symbolTexts.length;e++)this.symbolTexts[e].style.display="none",this.symbolTexts[e].redraw()}else{this.animationGOFeature.style.display="display";for(var i=0;i<this.symbolTexts.length;i++)this.symbolTexts[i].style.display="display",this.symbolTexts[i].redraw()}else{this.animationGOFeature.style.display="none";for(var o=0;o<this.symbolTexts.length;o++)this.symbolTexts[o].style.display="none",this.symbolTexts[o].redraw();this.getGOAnimationType()!==SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE_EXP&&this.getGOAnimationType()!==SuperMap.Plot.GOAnimationType.ANIMATION_CURVE_EXP&&this.getGOAnimationType()!==SuperMap.Plot.GOAnimationType.ANIMATION_CURVE&&this.getGOAnimationType()!==SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE||null!==this.pathFeature&&(this.pathFeature.options.opacity=0,this.pathFeature.redraw())}},setAnimationShowFlag:function(){var t=L.supermap.plotting.getControl().getGOAnimationManager().findGOAnimationsByUuid(this.goFeature.uuid);if(t.length>0)for(var e=0;e<t.length;e++)t[e].needSetShowFlag=!1},cloneGOFeature:function(t){var e=null,i=L.supermap.plotting.getControl().getGOAnimationManager().goAnimations;if(null!==i)for(var o=0;o<i.length;o++){var n=i[o];if(n.goFeature===t){e=n.animationGOFeature;break}}return null===e&&((e=t.clone()).uuid=t.uuid,e.isAnimation=!0,e.enableEdit=!1),e},removeAnimationFeature:function(){if(null!==this.animationGOFeature){var t=L.supermap.plotting.getControl().getGOAnimationManager().goAnimations,e=!1;if(null!==t)for(var i=0;i<t.length;i++){var o=t[i];if(o!==this&&o.animationGOFeature===this.animationGOFeature){e=!0;break}}if(!e){this.animationGOFeature.layer.removeFeatures(this.animationGOFeature);for(;0<this.symbolTexts.length;)symbolTexts[0].layer.removeFeatures(symbolTexts[0])}}},getAnimationState:function(){return this.animationState},getJSONData:function(){var t={};return t.goFeatureUuid=this.goFeature.uuid,t.name=this.name,t.caption=this.caption,t.startTime=this.startTime,t.duration=this.duration,t.repeat=this.repeat,t.playtype=this.animationPlayType,t.type=this.getGOAnimationType(),t},fromJSONData:function(t){this.caption=t.caption,this.startTime=t.startTime,this.duration=t.duration,this.repeat=t.repeat,this.animationPlayType=t.playtype,t.delayTime||(this.delayTime=this.getStartTime())}});L.supermap.plotting.GOAnimation=zh;var Yh=zh.extend({lineColorAnimation:!1,startLineColor:"#FF0000",endLineColor:"#0000FF",lineWidthAnimation:!1,startLineWidth:0,endLineWidth:5,surroundLineColorAnimation:!1,startSurroundLineColor:"#ffff00",endSurroundLineColor:"#00ffff",surroundLineWidthAnimation:!1,startSurroundLineWidth:0,endSurroundLineWidth:1,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_ATTRIBUTE},resetAnimationFeature:function(t){zh.prototype.resetAnimationFeature.call(this,t),t&&(this.animationGOFeature.style.color=this.startLineColor,this.animationGOFeature.style.weight=this.startLineWidth,this.animationGOFeature.style.surroundLineColor=this.startSurroundLineColor,this.animationGOFeature.style.surroundLineWidth=this.startSurroundLineWidth)},execute:function(){if(!this.canExecute())return!1;var t=this.ratio,e=this._executeLineColorAnimation(t),i=this._executeLineWidthAnimation(t),o=this._executeSurroundLineColorAnimation(t),n=this._executeSurroundLineWidthAnimation(t);return e||i||o||n},_executeLineColorAnimation:function(t){if(!this.lineColorAnimation)return!1;var e=SuperMap.Plot.PlottingUtil.colorStringToRGB(this.startLineColor),i=SuperMap.Plot.PlottingUtil.colorStringToRGB(this.endLineColor),o=parseInt(e.red+(i.red-e.red)*t),n=parseInt(e.green+(i.green-e.green)*t),l=parseInt(e.blue+(i.blue-e.blue)*t);return this.animationGOFeature.setStyle({color:SuperMap.Plot.PlottingUtil.colorRGBToString({red:o,green:n,blue:l})}),!0},_executeLineWidthAnimation:function(t){return!!this.lineWidthAnimation&&(this.animationGOFeature.setStyle({weight:this.startLineWidth+(this.endLineWidth-this.startLineWidth)*t}),!0)},_executeSurroundLineColorAnimation:function(t){if(!this.surroundLineColorAnimation)return!1;var e=SuperMap.Plot.PlottingUtil.colorStringToRGB(this.startSurroundLineColor),i=SuperMap.Plot.PlottingUtil.colorStringToRGB(this.endSurroundLineColor),o=parseInt(e.red+(i.red-e.red)*t),n=parseInt(e.green+(i.green-e.green)*t),l=parseInt(e.blue+(i.blue-e.blue)*t);return this.animationGOFeature.setStyle({surroundLineColor:SuperMap.Plot.PlottingUtil.colorRGBToString({red:o,green:n,blue:l})}),!0},_executeSurroundLineWidthAnimation:function(t){return!!this.surroundLineWidthAnimation&&(this.animationGOFeature.setStyle({surroundLineWidth:this.startSurroundLineWidth+(this.endSurroundLineWidth-this.startSurroundLineWidth)*t}),!0)},getJSONData:function(){var t=zh.prototype.getJSONData.call(this);return t.lineColorAnimation=this.lineColorAnimation,this.startLineColor&&(t.startLineColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(this.startLineColor)),this.endLineColor&&(t.endLineColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(this.endLineColor)),t.lineWidthAnimation=this.lineWidthAnimation,t.startLineWidth=this.startLineWidth,t.endLineWidth=this.endLineWidth,t.surroundLineColorAnimation=this.surroundLineColorAnimation,this.startSurroundLineColor&&(t.startSurroundLineColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(this.startSurroundLineColor)),this.endSurroundLineColor&&(t.endSurroundLineColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(this.endSurroundLineColor)),t.surroundLineWidthAnimation=this.surroundLineWidthAnimation,t.startSurroundLineWidth=this.startSurroundLineWidth,t.endSurroundLineWidth=this.endSurroundLineWidth,t},fromJSONData:function(t){zh.prototype.fromJSONData.call(this,t),this.lineColorAnimation=t.lineColorAnimation,null!=t.startLineColor.red?this.startLineColor=SuperMapAlgoPlot.PlottingUtil.colorRGBToString(t.startLineColor):this.startLineColor=t.startLineColor,null!=t.endLineColor.red?this.endLineColor=SuperMapAlgoPlot.PlottingUtil.colorRGBToString(t.endLineColor):this.endLineColor=t.endLineColor,this.lineWidthAnimation=t.lineWidthAnimation,this.startLineWidth=t.startLineWidth,this.endLineWidth=t.endLineWidth,this.surroundLineColorAnimation=t.surroundLineColorAnimation,null!=t.startSurroundLineColor.red?this.startSurroundLineColor=SuperMapAlgoPlot.PlottingUtil.colorRGBToString(t.startSurroundLineColor):this.startSurroundLineColor=t.startSurroundLineColor,null!=t.endSurroundLineColor.red?this.endSurroundLineColor=SuperMapAlgoPlot.PlottingUtil.colorRGBToString(t.endSurroundLineColor):this.endSurroundLineColor=t.endSurroundLineColor,this.surroundLineWidthAnimation=t.surroundLineWidthAnimation,this.startSurroundLineWidth=t.startSurroundLineWidth,this.endSurroundLineWidth=t.endSurroundLineWidth}});L.supermap.plotting.GOAnimationAttribute=Yh;var Gh=zh.extend({blinkInterval:500,blinkStyle:SuperMap.Plot.BlinkAnimationBlinkStyle.Blink_Frequency,blinkNumber:0,replaceStyle:SuperMap.Plot.BlinkAnimationReplaceStyle.Replace_NoColor,startVisiable:!1,startColor:"#0000ff",endColor:"#ff0000",setStartVisiable:function(t){this.startVisiable=t},getStartVisiable:function(){return this.startVisiable},getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_BLINK},execute:function(){if(!this.canExecute())return"none"===this.goFeature.style.display&&"none"===this.animationGOFeature.style.display&&(this.animationGOFeature.style.display="display",!0);var t=(new Date).getTime()/1e3,e=this.blinkInterval/1e3;return this.blinkStyle===SuperMap.Plot.BlinkAnimationBlinkStyle.Blink_Number&&(e=this.blinkInterval=this.duration/this.blinkNumber),(t-this.innerStartTime)%e<=e/2?this.replaceStyle===SuperMap.Plot.BlinkAnimationReplaceStyle.Replace_Color&&20!=this.animationGOFeature.symbolType&&21!=this.animationGOFeature.symbolType?(this.animationGOFeature.style.color=this.startColor,this.animationGOFeature.style.display="display"):this.lastExecute?this.animationGOFeature.style.display="display":this.animationGOFeature.style.display="none":(this.animationGOFeature.style.display="display",this.replaceStyle===SuperMap.Plot.BlinkAnimationReplaceStyle.Replace_Color&&20!=this.animationGOFeature.symbolType&&21!=this.animationGOFeature.symbolType&&(this.animationGOFeature.style.color=this.endColor)),this.animationGOFeature.redraw(),!0},resetAnimationFeature:function(t){this.needSetShowFlag&&(zh.prototype.resetAnimationFeature.call(this,t),this.startVisiable?this.animationGOFeature.style.display="display":this.animationGOFeature.style.display="none",this.animationGOFeature.redraw(),t&&this.setAnimationShowFlag())},getJSONData:function(){var t=zh.prototype.getJSONData.call(this);return t.blinkStyle=this.blinkStyle,t.blinkInterval=this.blinkInterval,t.blinkNumber=this.blinkNumber,t.replaceStyle=this.replaceStyle,this.startColor&&(t.startColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(this.startColor)),this.endColor&&(t.endColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(this.endColor)),t},fromJSONData:function(t){zh.prototype.fromJSONData.call(this,t),this.blinkStyle=t.blinkStyle,this.blinkInterval=t.blinkInterval,this.blinkNumber=t.blinkNumber,this.replaceStyle=t.replaceStyle,null!=t.startColor.red?this.startColor=SuperMapAlgoPlot.PlottingUtil.colorRGBToString(t.startColor):this.startColor=t.startColor,null!=t.endColor.red?this.endColor=SuperMapAlgoPlot.PlottingUtil.colorRGBToString(t.endColor):this.endColor=t.endColor,L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animatitonpropertyconfig,{jsonData:t})}});L.supermap.plotting.GOAnimationBlink=Gh;var Wh=zh.extend({startScale:0,endScale:1,timeSpace:50,lastDrawTime:0,lineLength:0,controlPoints:[],initialize:function(t){zh.prototype.initialize.call(this,t),this.controlPoints=[],this.lineLength=0},getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_GROW},setStartScale:function(t){this.startScale=t,L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animationmodify,{result:this.getJSONData()})},getStartScale:function(){return this.startScale},setEndScale:function(t){this.endScale=t,L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animationmodify,{result:this.getJSONData()})},getEndScale:function(){return this.endscale},_execute_1004:function(t){if(0===this.lineLength){this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs());var e=new SuperMap.Geometry.Point((this.controlPoints[0].x+this.controlPoints[1].x)/2,(this.controlPoints[0].y+this.controlPoints[1].y)/2);this.lineLength+=SuperMap.Plot.PlottingUtil.distance(e,this.controlPoints[2]);for(var i=3;i<this.controlPoints.length;i++)this.lineLength+=SuperMap.Plot.PlottingUtil.distance(this.controlPoints[i-1],this.controlPoints[i])}if(0===t||Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale)return this._executeAndRatioIsZero(),!0;var o=[],n=[];e=new SuperMap.Geometry.Point((this.controlPoints[0].x+this.controlPoints[1].x)/2,(this.controlPoints[0].y+this.controlPoints[1].y)/2),n.push(e);for(var l=2;l<this.controlPoints.length;l++)n.push(this.controlPoints[l].clone());o.push(this.controlPoints[0]),o.push(this.controlPoints[1]);for(var s=this._findPos(this.lineLength*t,n),a=1;a<=s.pos;a++)o.push(n[a]);return o.push(s.pts),this.animationGOFeature.setLatLngs(L.Util.superMapPointsToLatLngs(o)),!0},_execute_1006:function(t){if(0===this.controlPoints.length){var e=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs());this.controlPoints=SuperMap.Plot.PlottingUtil.operateControlPoints(e)}if(0===t||Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale)return this._executeAndRatioIsZero(),!0;var i=this.controlPoints;if(4!=i.length)return!1;var o=i[0],n=i[1],l=i[2],s=i[3],a=SuperMap.Plot.PlottingUtil.distance(o,s),r=SuperMap.Plot.PlottingUtil.distance(n,l),u=SuperMap.Plot.PlottingUtil.linePnt(o,s,a*t),p=SuperMap.Plot.PlottingUtil.linePnt(n,l,r*t),h=[];return h.push(o),h.push(n),h.push(p),h.push(u),null!==this.animationGOFeature.superMapAlgoSymbol&&Object.prototype.hasOwnProperty.call(this.animationGOFeature.superMapAlgoSymbol,"m_bIsAnimation")&&(this.animationGOFeature.superMapAlgoSymbol.m_bIsAnimation=!0),this.animationGOFeature.setLatLngs(L.Util.superMapPointsToLatLngs(h)),this.animationGOFeature.superMapAlgoSymbol.m_bIsAnimation=!1,!0},_execute_1002:function(t){if(0===this.lineLength&&(this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs()),this.lineLength=SuperMap.Plot.PlottingUtil.polylineDistance(this.controlPoints)),0===t||Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale)return this._executeAndRatioIsZero(),!0;for(var e=[],i=SuperMap.Plot.PlottingUtil.clonePoints(this.controlPoints),o=this._findPos(this.lineLength*t,i),n=0;n<=o.pos;n++)e.push(i[n]);e.push(o.pts);var l=[];return e.length<3&&(l.push(e[0].clone()),l.push(new SuperMap.Geometry.Point((e[0].x+e[1].x)/2,(e[0].y+e[1].y)/2)),l.push(e[1].clone()),e=l),SuperMap.Plot.AlgoSymbolFactory.isAccessServer(this.animationGOFeature.libID,this.animationGOFeature.code)&&this.goFeature.symbolData.algoMinEditPts>e.length?(this._executeAndRatioIsZero(),!0):(this.animationGOFeature.setLatLngs(L.Util.superMapPointsToLatLngs(e)),!0)},_execute_Generalization:function(t){if(0===this.lineLength&&(this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs()),this.lineLength=SuperMap.Plot.PlottingUtil.polylineDistance(this.controlPoints)),0===t||Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale)return this._executeAndRatioIsZero(),!0;for(var e=[],i=SuperMap.Plot.PlottingUtil.clonePoints(this.controlPoints),o=this._findPos(this.lineLength*t,i),n=0;n<=o.pos;n++)e.push(i[n]);return e.push(o.pts),SuperMap.Plot.AlgoSymbolFactory.isAccessServer(this.animationGOFeature.libID,this.animationGOFeature.code)&&this.goFeature.symbolData.algoMinEditPts>e.length?(this._executeAndRatioIsZero(),!0):(this.animationGOFeature.latLngs=L.Util.superMapPointsToLatLngs(e),this.animationGOFeature.redraw(),!0)},_execute_Rect:function(t){0===this.controlPoints.length&&(this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs()));var e=new SuperMap.Geometry.Point((this.controlPoints[0].x+this.controlPoints[1].x)/2,(this.controlPoints[0].y+this.controlPoints[1].y)/2);Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale&&(t=0);var i=Math.abs(this.controlPoints[0].x-this.controlPoints[1].x)/2*t,o=Math.abs(this.controlPoints[0].y-this.controlPoints[1].y)/2*t,n=new SuperMap.Geometry.Point(e.x-i,e.y+o),l=new SuperMap.Geometry.Point(e.x+i,e.y-o);return this.animationGOFeature.setLatLngs(L.Util.superMapPointsToLatLngs([n,l])),!0},_execute_Circle:function(t){0===this.controlPoints.length&&(this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs()));var e=this.controlPoints[0].clone();Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale&&(t=0);var i=t*Math.sqrt((this.controlPoints[0].x-this.controlPoints[1].x)*(this.controlPoints[0].x-this.controlPoints[1].x)+(this.controlPoints[0].y-this.controlPoints[1].y)*(this.controlPoints[0].y-this.controlPoints[1].y));return this.animationGOFeature.setLatLngs(L.Util.superMapPointsToLatLngs([e,new SuperMap.Geometry.Point(e.x+i,e.y)])),!0},_execute_Kidney:function(t){if(0===this.controlPoints.length&&(this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs())),0===t||Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale)return this._executeAndRatioIsZero(),!0;var e=[],i=this.controlPoints.length,o=SuperMap.Plot.PlottingUtil.getPolygonCenterPt(this.controlPoints);if(null===o)return this._executeAndRatioIsZero(),!0;for(var n=0;n<i;n++){var l=SuperMap.Plot.PlottingUtil.distance(o,this.controlPoints[n]),s=l*t;if(s>l)return!1;var a=SuperMap.Plot.PlottingUtil.linePnt(o,this.controlPoints[n],s);e.push(a)}return this.animationGOFeature.setLatLngs(L.Util.superMapPointsToLatLngs(e)),!0},_execute_RegularPloygon:function(t){if(0===this.controlPoints.length&&(this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs())),0===t||Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale)return this._executeAndRatioIsZero(),!0;var e=this.controlPoints.length,i=SuperMap.Plot.PlottingUtil.distance(this.controlPoints[0],this.controlPoints[this.controlPoints.length-1])*t,o=new SuperMap.Geometry.Point(this.controlPoints[0].x+i,this.controlPoints[0].y),n=2*Math.PI/(e+1),l=Math.PI/2+this.animationGOFeature.dRotate,s=o;SuperMap.Plot.PlottingUtil.rotateAngle(this.controlPoints[0],l,s);var a=[];a.push(this.controlPoints[0].clone()),a.push(s);for(var r=s.clone(),u=1;u<e-1;u++)SuperMap.Plot.PlottingUtil.rotateAngle(this.controlPoints[0],n,r),a.push(r.clone());return this.animationGOFeature.setLatLngs(L.Util.superMapPointsToLatLngs(a)),!0},_execute_Ellipse:function(t){0===this.controlPoints.length&&(this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs())),Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale&&(t=0);var e=SuperMap.Plot.PlottingUtil.findPointOnLineByRatio(t,this.controlPoints[0],this.controlPoints[1]),i=SuperMap.Plot.PlottingUtil.findPointOnLineByRatio(t,this.controlPoints[0],this.controlPoints[2]);return this.animationGOFeature.latLngs[1]=L.latLng(e.y,e.x),this.animationGOFeature.latLngs[2]=L.latLng(i.y,i.x),this.animationGOFeature.redraw(),!0},_execute_ArbitraryPolygon:function(t){0===this.controlPoints.length&&(this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs()));var e=this.controlPoints.length,i=SuperMap.Plot.PlottingUtil.getPolygonCenterPt(this.controlPoints);if(null===i)return this._executeAndRatioIsZero(),!0;for(var o=[],n=0;n<e;n++){var l=SuperMap.Plot.PlottingUtil.distance(i,this.controlPoints[n])*t,s=SuperMap.Plot.PlottingUtil.linePnt(i,this.controlPoints[n],l);o.push(s)}return this.animationGOFeature.setLatLngs(L.Util.superMapPointsToLatLngs(o)),!0},_execute_ParallelLine:function(t){if(0===this.lineLength){this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs());for(var e=2;e<this.controlPoints.length;e++)this.lineLength+=SuperMap.Plot.PlottingUtil.distance(this.controlPoints[e-1],this.controlPoints[e])}for(var i=[],o=[],n=1;n<this.controlPoints.length;n++)o.push(this.controlPoints[n].clone());Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale&&(t=0);var l=this._findPos(this.lineLength*t,o);i.push(this.controlPoints[0].clone());for(var s=0;s<=l.pos;s++)i.push(o[s]);return i.push(l.pts),this.animationGOFeature.setLatLngs(L.Util.superMapPointsToLatLngs(i)),!0},_execute_Polybezier:function(t){if(0===this.lineLength){this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs());var e=SuperMapAlgoPlot.PlottingUtil.computeBeizerPoints(this.goFeature.isEdit,this.controlPoints,this.goFeature.scaleValues).beizerPoints;this.lineLength+=SuperMap.Plot.PlottingUtil.polylineDistance(e)}var i=[];e=SuperMap.Plot.PlottingUtil.generateBeizerPointsNoCtrlPt(this.controlPoints,[]),Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale&&(t=0);for(var o=this._findPos(this.lineLength*t,e),n=0;n<=o.pos;n++)i.push(e[n].clone());return i.push(o.pts),this.animationGOFeature.superMapAlgoSymbol.m_bIsAnimation=!0,this.animationGOFeature.setLatLngs(L.Util.superMapPointsToLatLngs(i)),this.animationGOFeature.superMapAlgoSymbol.m_bIsAnimation=!1,!0},_execute_CurveEight:function(t){0===this.controlPoints.length&&(this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs()));var e=SuperMap.Plot.PlottingUtil.getPolygonCenterPt(this.controlPoints),i=[];Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale&&(t=0);for(var o=0;o<this.controlPoints.length;o++){var n=SuperMap.Plot.PlottingUtil.distance(e,this.controlPoints[o])*t,l=SuperMap.Plot.PlottingUtil.linePnt(e,this.controlPoints[o],n);i.push(l)}return this.animationGOFeature.setLatLngs(L.Util.superMapPointsToLatLngs(i)),!0},_execute_AnnotationFrame:function(t){if(0===this.lineLength&&(this.controlPoints=L.Util.latLngsToSuperMapPoints(this.goFeature.getLatLngs()),this.lineLength=SuperMap.Plot.PlottingUtil.polylineDistance(this.controlPoints)),0===t||Math.abs(t-this.endScale)<1e-10&&this.startScale>this.endScale)return this._executeAndRatioIsZero(),!0;var e=[],i=SuperMap.Plot.PlottingUtil.clonePoints(this.controlPoints);if(this.goFeature.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXTBOX||this.goFeature.symbolType===SuperMap.Plot.SymbolType.LINEMARKING){var o=[];o.push(this.controlPoints[0]),o.push(new SuperMap.Geometry.Point(this.goFeature.scaleValues[1],this.goFeature.scaleValues[2]));var n=SuperMap.Plot.PlottingUtil.polylineDistance(o),l=this._findPos(n*t,o);this.animationGOFeature.scaleValues[1]=l.pts.x,this.animationGOFeature.scaleValues[2]=l.pts.y}else for(var s=this.goFeature.scaleValues.length/2,a=0;a<s;a++){var r=[];r.push(this.controlPoints[0]),r.push(new SuperMap.Geometry.Point(this.goFeature.scaleValues[2*a],this.goFeature.scaleValues[2*a+1]));var u=SuperMap.Plot.PlottingUtil.polylineDistance(r),p=this._findPos(u*t,r);this.animationGOFeature.scaleValues[2*a]=p.pts.x,this.animationGOFeature.scaleValues[2*a+1]=p.pts.y}for(var h=this._findPos(this.lineLength*t,i),c=0;c<=h.pos;c++)e.push(i[c]);return e.push(h.pts),this.animationGOFeature.latLngs=L.Util.superMapPointsToLatLngs(e),this.animationGOFeature.redraw(),!0},_executeAndRatioIsZero:function(){this.animationGOFeature.setLatLngs([]),this.animationGOFeature.style.display="none",this.animationGOFeature.redraw(),this.animationGOFeature.grow=SuperMap.Plot.AlgoSymbolFactory.isAccessServer(this.animationGOFeature.libID,this.animationGOFeature.code)},resetAnimationFeature:function(t){this.needSetShowFlag&&(zh.prototype.resetAnimationFeature.call(this,t),this.lineLength=0,this.controlPoints=[],this.startScale<=0&&(this.startScale=0),this.startScale>=1&&(this.startScale=1),this.endScale<=0&&(this.endScale=0),this.endScale>=1&&(this.endScale=1),this.startScale<this.endScale&&t?this.animationGOFeature.style.display="none":this.animationGOFeature.style.display="display",this.animationGOFeature.redraw(),t&&this.setAnimationShowFlag())},execute:function(){if(!(this.goFeature instanceof Eh))return!1;if(!this.canExecute())return!1;if("display"!==this.goFeature.style.display){this.animationGOFeature.style.display="display";for(var t=0;t<this.symbolTexts.length;t++)this.symbolTexts[t].style.display="display",this.symbolTexts[t].redraw()}this.endScale>=1&&(this.endScale=1);var e=(new Date).getTime();if(this.lastDrawTime>0&&e-this.timeSpace<this.lastDrawTime)return!1;var i=this.startScale+this.ratio*(this.endScale-this.startScale);return this.lastDrawTime=e,this._executeAnimation(i)},_executeAnimation:function(t){var e=!1,i=this.animationGOFeature.code,o=this.animationGOFeature.libID;if(0===o)switch(i){case SuperMap.Plot.SymbolType.KIDNEY:case SuperMap.Plot.SymbolType.POLYBEZIERCLOSESYMBOL:case SuperMap.Plot.SymbolType.PARALLELOGRAM:case SuperMap.Plot.SymbolType.TRAPEZOIDSYMBOL:e=this._execute_Kidney(t);break;case SuperMap.Plot.SymbolType.CIRCLESYMBOL:e=this._execute_Circle(t);break;case SuperMap.Plot.SymbolType.RECTANGLESYMBOL:e=this._execute_Rect(t);break;case SuperMap.Plot.SymbolType.REGULARPOLYGON:e=this._execute_RegularPloygon(t);break;case SuperMap.Plot.SymbolType.ELLIPSESYMBOL:e=this._execute_Ellipse(t);break;case SuperMap.Plot.SymbolType.ARBITRARYPOLYGONSYMBOL:case SuperMap.Plot.SymbolType.POLYGONREGION:e=this._execute_ArbitraryPolygon(t);break;case SuperMap.Plot.SymbolType.PARALLELLINE:e=this._execute_ParallelLine(t);break;case SuperMap.Plot.SymbolType.POLYBEZIERSYMBOL:e=this._execute_Polybezier(t);break;case SuperMap.Plot.SymbolType.PIESYMBOL:case SuperMap.Plot.SymbolType.CHORDSYMBOL:case SuperMap.Plot.SymbolType.ARCSYMBOL:case SuperMap.Plot.SymbolType.ANNOFRAMESYMBOL:return!1;case SuperMap.Plot.SymbolType.CURVEEIGHT:e=this._execute_CurveEight(t);break;case SuperMap.Plot.SymbolType.ANNOFRAMESYMBOLM:case SuperMap.Plot.SymbolType.SYMBOLTEXTBOX:case SuperMap.Plot.SymbolType.LINEMARKING:e=this._execute_AnnotationFrame(t);break;default:e=this._execute_Generalization(t)}else if(22===o)switch(i){case 1004:case 2004:case 1010:e=this._execute_1004(t);break;case 1006:case 2006:e=this._execute_1006(t);break;case 1002:case 2002:e=this._execute_1002(t);break;case 32:case 3211:e=this._execute_ArbitraryPolygon(t);break;case 390:case 3911:e=this._execute_Kidney(t);break;default:e=this._execute_Generalization(t)}else if(100===o)switch(i){case 25200:e=this._execute_1004(t);break;default:e=this._execute_Generalization(t)}else if(421===o)switch(i){case 311:e=this._execute_1004(t);break;case 317:e=this._execute_1006(t);break;default:e=this._execute_Generalization(t)}else if(123===o)switch(i){case 60310:case 6031001:case 60207:case 6020701:e=this._execute_1004(t);break;case 50108:e=this._execute_Kidney(t);break;default:e=this._execute_Generalization(t)}else e=this._execute_Generalization(t);return this.animationGOFeature.grow=SuperMap.Plot.AlgoSymbolFactory.isAccessServer(this.animationGOFeature.libID,this.animationGOFeature.code),e},_findPos:function(t,e){var i,o=0,n=0;for(i=1;i<e.length&&!(o+(n=SuperMap.Plot.PlottingUtil.distance(e[i-1],e[i]))>=t);i++)o+=n;var l,s=new Object;return l=i<e.length?SuperMap.Plot.PlottingUtil.findPoint(e[i-1],e[i],t-o,0):e[i-1].clone(),s.pos=i-1,s.pts=l,s},getJSONData:function(){var t=zh.prototype.getJSONData.call(this);return t.startScale=this.startScale,t.endScale=this.endScale,t},fromJSONData:function(t){zh.prototype.fromJSONData.call(this,t),this.startScale=t.startScale,this.endScale=t.endScale,L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animatitonpropertyconfig,{jsonData:t})}});L.supermap.plotting.GOAnimationGrow=Wh;var Xh=zh.extend({rotateDirection:SuperMap.Plot.RotateDirection.ClockWise,startAngle:0,endAngle:360,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_ROTATE},resetAnimationFeature:function(t){this.needSetShowFlag&&(this.animationGOFeature._rotate(this.goFeature.dRotate-this.animationGOFeature.dRotate,this.animationGOFeature.getLatLngs()[0]),zh.prototype.resetAnimationFeature.call(this,t),t&&this.setAnimationShowFlag())},execute:function(){if(this.goFeature.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL)return!1;if(!this.canExecute())return!1;var t=this.ratio,e=this._getCurrentAngle(this.startAngle,this.endAngle,t),i=this.animationGOFeature.dRotate;return this.animationGOFeature._rotate(e-i,this.animationGOFeature.getLatLngs()[0]),!0},_getCurrentAngle:function(t,e,i){var o=0,n=e-t,l=parseInt(Math.abs(n/360));if(t!==e)if(this.rotateDirection===SuperMap.Plot.RotateDirection.AntiClockWise)n<0&&(n+=360*(2*l+1)),o=t+n*i;else{var s=0;o=t+(360-(n=0===(s=n<0?n+360*(l+1):n-360*l)?360*l:360-s+360*l)*i)}return o},getJSONData:function(){var t=zh.prototype.getJSONData.call(this);return t.rotateDirection=this.rotateDirection,t.startAngle=this.startAngle,t.endAngle=this.endAngle,t},fromJSONData:function(t){zh.prototype.fromJSONData.call(this,t),this.rotateDirection=t.rotateDirection,this.startAngle=t.startAngle,this.endAngle=t.endAngle}});L.supermap.plotting.GOAnimationRotate=Xh;var Hh=zh.extend({startScale:0,endScale:1,lastScale:null,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_SCALE},resetAnimationFeature:function(t){this.needSetShowFlag&&(this.lastScale=null,this.animationGOFeature.scale=this.goFeature.scale,zh.prototype.resetAnimationFeature.call(this,t),this.startScale<this.endScale||!t?this.animationGOFeature.style.display="none":this.animationGOFeature.style.display="display",this.animationGOFeature.redraw(),t&&this.setAnimationShowFlag())},execute:function(){if(this.goFeature.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL&&this.goFeature.symbolType!==SuperMap.Plot.SymbolType.PICTURE&&this.goFeature.symbolType!==SuperMap.Plot.SymbolType.MODELPLOT)return!1;if(!this.canExecute())return!1;this.goFeature.symbolType!==SuperMap.Plot.SymbolType.PICTURE&&this.goFeature.symbolType!==SuperMap.Plot.SymbolType.MODELPLOT?this.lastScale=this.animationGOFeature.initialScale.x:this.lastScale=this.animationGOFeature.dScale;var t=this.startScale;0===t&&(t=0);var e,i=this.endScale;return 0===i&&(i=0),"none"==this.animationGOFeature.style.display&&!0!==this.setDisplay&&(this.animationGOFeature.style.display="display",this.setDisplay=!0),this.animationGOFeature.redraw(),this.goFeature.symbolType!==SuperMap.Plot.SymbolType.PICTURE&&this.goFeature.symbolType!==SuperMap.Plot.SymbolType.MODELPLOT?(e=this.goFeature.initialScale.x*(t+this.ratio*(i-t)),this.animationGOFeature._resize(e/this.lastScale,this.animationGOFeature.getLatLngs()[0])):(e=this.goFeature.dScale*(t+this.ratio*(i-t)),this.animationGOFeature.setScale(e)),this.startScale>this.endScale&&e/this.lastScale==0&&(this.animationGOFeature.style.display="none",this.setDisplay=!1,this.animationGOFeature.redraw()),!0},getJSONData:function(){var t=zh.prototype.getJSONData.call(this);return t.startScale=this.startScale,t.endScale=this.endScale,t},fromJSONData:function(t){zh.prototype.fromJSONData.call(this,t),this.startScale=t.startScale,this.endScale=t.endScale,L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animatitonpropertyconfig,{jsonData:t})}});L.supermap.plotting.GOAnimationScale=Hh;var Zh=zh.extend({showEffect:!1,finalDisplay:!1,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_SHOW},execute:function(){if(!this.canExecute())return!1;var t=this.ratio;return this.showEffect?this._executeHaveEffect(t):this._executeNoEffect(t),!0},_executeNoEffect:function(t){this.finalDisplay?this.animationGOFeature.style.display=1-t<.01?"display":"none":this.animationGOFeature.style.display=1-t<.01?"none":"display",this.animationGOFeature.redraw()},_executeHaveEffect:function(t){if(this.finalDisplay||(t=1-t),this.animationGOFeature.style.display="display",this.animationGOFeature.style.opacity=this.goFeature.style.opacity*t,this.animationGOFeature.style.fontOpacity=this.goFeature.style.fontOpacity*t,this.animationGOFeature.subSymbols.length>0)for(var e=0;e<this.animationGOFeature.subSymbols.length;e++){var i=this.animationGOFeature.subSymbols[e].lineColor;i.length<8?i+=Math.round(255*t).toString(16).padStart(2,"0"):i=i.slice(0,7)+Math.round(255*t).toString(16).padStart(2,"0"),this.animationGOFeature.subSymbols[e].lineColor=i}if(this.animationGOFeature.style.surroundLineColorOpacity=this.goFeature.style.surroundLineColorOpacity*t,this.animationGOFeature.symbolType==SuperMap.Plot.SymbolType.PICTURE&&(this.animationGOFeature.style.graphicOpacity=this.goFeature.style.graphicOpacity*t),this.animationGOFeature.style.fill&&(this.animationGOFeature.style.fillOpacity=this.goFeature.style.fillOpacity*t,this.animationGOFeature.style.fillBackOpacity=this.goFeature.style.fillBackOpacity*t),0===t&&this.animationGOFeature.symbolType==SuperMap.Plot.SymbolType.PICTURE&&(this.animationGOFeature.style.display="none"),this.animationGOFeature.redraw(),0===t){var o=L.supermap.plotting.getControl().getGOAnimationManager().goAnimations,n=null;if(null!==o)for(var l=0;l<o.length;l++)if(o[l].animationGOFeature===this.animationGOFeature){n=l;break}null!=n&&(o[n].animationGOFeature.textDisplay=!1,o[n].animationGOFeature.redraw())}},resetAnimationFeature:function(t){this.needSetShowFlag&&(zh.prototype.resetAnimationFeature.call(this,t),this.finalDisplay||!t?this.animationGOFeature.style.display="none":this.animationGOFeature.style.display="display",this.animationGOFeature.redraw(),t&&this.setAnimationShowFlag())},getJSONData:function(){var t=zh.prototype.getJSONData.call(this);return t.showEffect=this.showEffect,t.finalDisplay=this.finalDisplay,t},fromJSONData:function(t){zh.prototype.fromJSONData.call(this,t),this.showEffect=t.showEffect,this.finalDisplay=t.finalDisplay,L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animatitonpropertyconfig,{jsonData:t})}});L.supermap.plotting.GOAnimationShow=Zh;var Jh=zh.extend({showPath:!1,tangentDirection:!1,pathWidth:3,pathColor:"#FF0000",currentPt:null,pathType:SuperMap.Plot.WayPathType.POLYLINE,wayPoints:null,shapePoints:null,pathFeature:null,pathLength:0,path:null,destroy:function(){null!==this.pathFeature&&(L.supermap.plotting.getControl().getGOAnimationManager().map.removeLayer(this.pathFeature),this.pathFeature=null);zh.prototype.destroy.call(this)},getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_WAY},setShowPath:function(t){this.showPath=t,L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animationmodify,{result:this.getJSONData()})},setPath:function(t){this.path=t},setTangentDirection:function(t){this.tangentDirection=t,L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animationmodify,{result:this.getJSONData()})},resetAnimationFeature:function(t){this.needSetShowFlag&&(zh.prototype.resetAnimationFeature.call(this,t),null!==this.wayPoints&&(this.wayPoints.length>=2?this.animationGOFeature.latLngs[0]=L.latLng(this.wayPoints[0].lat,this.wayPoints[0].lng):this.animationGOFeature.latLngs[0]=L.latLng(this.goFeature.latLngs[0].lat,this.goFeature.latLngs[0].lng)),t&&(null!==this.pathFeature&&null!==this.shapePoints||(this._makePath(),this.pathColor&&null!==this.pathFeature&&(this.pathFeature.options.color=this.pathColor),this.pathWidth&&null!==this.pathFeature&&(this.pathFeature.options.weight=this.pathWidth)),null!==this.pathFeature&&(this.pathFeature.options.opacity=0),1!==this.animationGOFeature.symbolType&&null!==this.pathFeature&&(this.pathFeature.options.opacity=0),null!==this.pathFeature&&this.pathFeature.setStyle()),t&&this.setAnimationShowFlag())},execute:function(){if(!this.goFeature)return!1;if(this.goFeature.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL&&this.goFeature.symbolType!==SuperMap.Plot.SymbolType.PICTURE&&this.goFeature.symbolType!==SuperMap.Plot.SymbolType.MODELPLOT)return null!==this.pathFeature&&(this.pathFeature.options.opacity=0),!1;if(!this.canExecute())return!1;null!==this.pathFeature&&this.showPath&&0===this.pathFeature.options.opacity&&(this.pathFeature.options.opacity=1,this.pathFeature.setStyle()),!this.showPath&&this.pathFeature&&(this.pathFeature.options.opacity=0,this.pathFeature.setStyle());var t,e=this.ratio,i=e*this.pathLength,o=new Object;if(null!==this.pathFeature&&null!==this.shapePoints||(this._makePath(),this.pathColor&&null!==this.pathFeature&&(this.pathFeature.options.color=this.pathColor),this.pathWidth&&null!==this.pathFeature&&(this.pathFeature.options.weight=this.pathWidth)),null!==this.shapePoints&&this.shapePoints.length>1){t=this._findPos(i,this.shapePoints,o),this.currentPt=t.clone();var n=this.animationGOFeature.getLatLngs()[0],l=t.y-n.lat,s=t.x-n.lng;this.animationGOFeature.move(l,s)}if(this.tangentDirection){null==this.prevAngle&&(this.prevAngle=0);var a=o.angle;1===e&&(a=0),this.animationGOFeature._rotate(a-this.prevAngle,this.animationGOFeature.getLatLngs()[0]),this.prevAngle=a}return!0},setWayPoints:function(t){this.wayPoints=[],this.wayPoints=L.Util.cloneLatLngs(t);var e=L.supermap.plotting.getControl().getGOAnimationManager();null!==this.pathFeature&&(e.map.removeLayer(this.pathFeature),this.pathFeature=null),e.fire(SuperMap.Plot.Event.animationmodify,{name:"setWayPoints",result:this.getJSONData()})},getWayPoints:function(){return this.wayPoints},getCurrentPt:function(){return this.currentPt},setPathColor:function(t){t&&(this.pathColor=t,this.pathFeature&&null!==this.pathFeature&&(this.pathFeature.options.color=this.pathColor,this.pathFeature.setStyle(this.pathFeature.options),L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animationmodify,{result:this.getJSONData()})))},getPathColor:function(){return this.pathColor},setPathWidth:function(t){t&&(this.pathWidth=t,this.pathFeature&&null!==this.pathWidth&&(this.pathFeature.options.weight=this.pathWidth,this.pathFeature.setStyle(this.pathFeature.options),L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animationmodify,{result:this.getJSONData()})))},getPathWidth:function(){return this.pathWidth},setPathType:function(t){if(void 0!==t&&null!==t&&this.pathType!==t){this.pathType=t;var e=L.supermap.plotting.getControl().getGOAnimationManager();null!==this.pathFeature&&(e.map.removeLayer(this.pathFeature),this.pathFeature.destroy(),this.pathFeature=null),e.fire(SuperMap.Plot.Event.animationmodify,{result:this.getJSONData()})}},getPathType:function(){return this.pathType},_makePath:function(){if(!(null===this.wayPoints||2>this.wayPoints.length)){if(null===this.pathFeature)this.pathType===SuperMap.Plot.WayPathType.POLYLINE?this.shapePoints=L.Util.latLngsToSuperMapPoints(this.wayPoints):this.shapePoints=SuperMap.Plot.PlottingUtil.generateBeizerPointsNoCtrlPt(L.Util.latLngsToSuperMapPoints(this.wayPoints)),this.pathFeature=L.polyline(L.Util.superMapPointsToLatLngs(this.shapePoints),SuperMap.Plot.PlottingUtil.cloneObject(this.animationGOFeature.style)),L.supermap.plotting.getControl().getGOAnimationManager().map.addLayer(this.pathFeature);this.pathLength=0;for(var t=1;t<this.shapePoints.length;t++)this.pathLength+=SuperMap.Plot.PlottingUtil.distance(this.shapePoints[t-1],this.shapePoints[t]);return this.pathFeature}this.shapePoints=this.wayPoints},_findPos:function(t,e,i){var o,n=0,l=0;for(o=1;o<e.length&&!(n+(l=SuperMap.Plot.PlottingUtil.distance(e[o-1],e[o]))>=t);o++)n+=l;var s=SuperMap.Plot.PlottingUtil.findPoint(e[o-1],e[o],t-n,0);return this.tangentDirection&&(i.angle=SuperMap.Plot.PlottingUtil.radian(s,e[o])/Math.PI*180),s},getJSONData:function(){var t=zh.prototype.getJSONData.call(this);if(t.showPath=this.showPath,t.tangentDirection=this.tangentDirection,t.pathType=this.pathType,t.pathWidth=this.pathWidth,this.pathColor&&(t.pathColor=SuperMapAlgoPlot.PlottingUtil.colorStringToRGB(this.pathColor)),t.wayPoints=[],this.wayPoints){for(var e=0;e<this.wayPoints.length;e++)t.wayPoints.push({x:this.wayPoints[e].lng,y:this.wayPoints[e].lat});return t}},fromJSONData:function(t){zh.prototype.fromJSONData.call(this,t),this.showPath=t.showPath,this.tangentDirection=t.tangentDirection,this.pathType=t.pathType,this.pathWidth=t.pathWidth,null!=t.pathColor.red?this.pathColor=SuperMapAlgoPlot.PlottingUtil.colorRGBToString(t.pathColor):this.pathColor=t.pathColor;for(var e=[],i=0;i<t.wayPoints.length;i++)e.push(L.latLng(t.wayPoints[i].y,t.wayPoints[i].x));this.setWayPoints(e),L.supermap.plotting.getControl().getGOAnimationManager().fire(SuperMap.Plot.Event.animatitonpropertyconfig,{jsonData:t})}});L.supermap.plotting.GOAnimationWay=Jh;var qh=Jh.extend({geoGraphicObject:null,duration:5,animationPlayType:SuperMap.Plot.AnimationPlayType.PLAYFROMNOW,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_WAY_EXP},setPath:function(t){if(t instanceof AlgoSymbol){for(var e=[],i=0;i<value.components.length;i++){var o=value.components[i];e=e.concat(o.shapePts)}this.setWayPoints(e)}}});L.supermap.plotting.AnimationWay=qh;var Kh=Jh.extend({pathType:SuperMap.Plot.WayPathType.CURVE,duration:5,animationPlayType:SuperMap.Plot.AnimationPlayType.PLAYFROMNOW,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_CURVE_EXP}});L.supermap.plotting.AnimationCurve=Kh;var Qh=Jh.extend({pathType:SuperMap.Plot.WayPathType.POLYLINE,duration:5,animationPlayType:SuperMap.Plot.AnimationPlayType.PLAYFROMNOW,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE_EXP}});L.supermap.plotting.AnimationBrokenline=Qh;var $h=Wh.extend({startScale:0,endScale:1,duration:2,animationPlayType:SuperMap.Plot.AnimationPlayType.PLAYFROMNOW,animationGrowEXP_isFirstExecute:!0,initialize:function(t){Wh.prototype.initialize.call(this,t)},getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_GROW_EXP},showAnimationFeature:function(t){if(null!==this.animationGOFeature&&null!==this.animationGOFeature.style&&(this.resetAnimationFeature(t),this.animationGOFeature.style.display="none",this.animationGOFeature.redraw()),null!==this.goFeature&&null!==this.goFeature.style){if(t){this.goFeature.style.display="none";for(var e=0;e<this.goFeature.geoSymbolTexts.length;e++)this.goFeature.geoSymbolTexts[e].style.display=unDisplay}else{this.goFeature.style.display="display";for(var i=0;i<this.goFeature.geoSymbolTexts.length;i++)this.goFeature.geoSymbolTexts[i].style.display=display}this.goFeature.redraw();for(var o=0;o<this.goFeature.geoSymbolTexts.length;o++)this.goFeature.geoSymbolTexts[o].redraw()}},execute:function(){if(!(this.goFeature instanceof Eh))return!1;if(!this.canExecute())return!1;if(this.animationGrowEXP_isFirstExecute&&(this.animationGOFeature.style.display="display",this.animationGOFeature.redraw(),this.animationGrowEXP_isFirstExecute=!1),"display"!==this.goFeature.style.display){this.animationGOFeature.style.display="display";for(var t=0;t<this.symbolTexts.length;t++)this.symbolTexts[t].style.display="display",this.symbolTexts[t].redraw()}this.endScale>=1&&(this.endScale=1);var e=(new Date).getTime();if(this.lastDrawTime>0&&e-this.timeSpace<this.lastDrawTime)return!1;var i=this.startScale+this.ratio*(this.endScale-this.startScale);return this.lastDrawTime=e,this._executeAnimation(i)}});L.supermap.plotting.AnimationGrow=$h;var tc=Wh.extend({startScale:1,endScale:0,duration:1,animationPlayType:SuperMap.Plot.AnimationPlayType.PLAYFROMNOW,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_REDUCE_EXP},resetAnimationFeature:function(t){Wh.prototype.resetAnimationFeature.call(this,t)}});L.supermap.plotting.AnimationReduce=tc;var ec=Zh.extend({showEffect:!0,finalDisplay:!0,duration:3,animationPlayType:SuperMap.Plot.AnimationPlayType.PLAYFROMNOW,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_MOVEIN_EXP}});L.supermap.plotting.AnimationMoveIn=ec;var ic=Zh.extend({showEffect:!0,finalDisplay:!1,duration:1,animationPlayType:SuperMap.Plot.AnimationPlayType.PLAYFROMNOW,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_MOVEOUT_EXP}});L.supermap.plotting.AnimationMoveOut=ic;var oc=Hh.extend({startScale:0,endScale:1,duration:2,animationPlayType:SuperMap.Plot.AnimationPlayType.PLAYFROMNOW,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_ZOOMIN_EXP}});L.supermap.plotting.AnimationZoomIn=oc;var nc=Hh.extend({startScale:1,endScale:0,duration:2,animationPlayType:SuperMap.Plot.AnimationPlayType.PLAYFROMNOW,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_ZOOMOUT_EXP}});L.supermap.plotting.AnimationZoomOut=nc;var lc=Zh.extend({showEffect:!1,finalDisplay:!0,duration:1,animationPlayType:SuperMap.Plot.AnimationPlayType.PLAYFROMNOW,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_SHOW_EXP}});L.supermap.plotting.AnimationShow=lc;var sc=Zh.extend({showEffect:!1,finalDisplay:!1,duration:1,animationPlayType:SuperMap.Plot.AnimationPlayType.PLAYFROMNOW,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_HIDE_EXP}});L.supermap.plotting.AnimationHide=sc;var ac=Gh.extend({bVisible:!1,duration:2,animationPlayType:SuperMap.Plot.AnimationPlayType.PLAYFROMNOW,getGOAnimationType:function(){return SuperMap.Plot.GOAnimationType.ANIMATION_BLINK_EXP},getVisible:function(){return this.bVisible},setVisible:function(t){this.bVisible=t},getJSONData:function(){var t=Gh.prototype.getJSONData.call(this);return t.bVisible=this.bVisible,t},fromJSONData:function(t){Gh.prototype.fromJSONData.call(this,t),this.bVisible=t.bVisible}});function rc(t){"@babel/helpers - typeof";return(rc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function uc(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,pc(o.key),o)}}function pc(t){var e=function(t,e){if("object"!=rc(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=rc(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==rc(e)?e:e+""}function hc(t,e,i){return e=cc(e),function(t,e){if(e&&("object"===rc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,function(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return function(){return!!t}()}()?Reflect.construct(e,i||[],cc(t).constructor):e.apply(t,i))}function cc(t){return(cc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function yc(t,e){return(yc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}L.supermap.plotting.AnimationBlink=ac;var gc=function(t){function e(t,i,o){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=hc(this,e,[o])).serverUrl=null,n.map=null,n.goAnimationLayers=[],n.initialize(t,i,o),n.options={serviceParams:{proxy:null,withCredentials:!1,crossOrigin:null,headers:null,serverType:null}},n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yc(t,e)}(e,Vh),i=e,(o=[{key:"initialize",value:function(t,e,i){null===this.goAnimations&&(this.goAnimations=[]),t&&null!==t&&null===this.map&&this.setMap(t),e&&null===this.serverUrl&&(this.serverUrl=e),i&&SuperMap.Util.extend(this.options,i)}},{key:"destroy",value:function(){e.prototype.goAnimations=null;for(var t=0;t<this.goAnimationLayers.length;t++)this.map.removeLayer(this.goAnimationLayers[t]),this.goAnimationLayers[t].destroy();this.goAnimationLayers=[],this.map=null,this.serverUrl=null}},{key:"setMap",value:function(t){if(null===t)return!1;this.map=t}},{key:"getAnimationLayer",value:function(t){for(var e=0;e<this.goAnimationLayers.length;e++)if(this.goAnimationLayers[e].name===t+"_animation")return this.goAnimationLayers[e];var i=L.supermap.plotting.animationLayer(t+"_animation",{displayInLayerSwitcher:!1});return this.map.addLayer(i),this.goAnimationLayers.push(i),i}},{key:"createGOAnimation",value:function(t,e,i){var o,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:SuperMap.Plot.AnimationPlayType.UNKNOWN,s=this.createGOAnimationByType(t,e);if(null===s)return null;if(i._eventParents)for(var a in i._eventParents)o=i._eventParents[a];return i instanceof L.supermap.plotting.Route||o instanceof L.supermap.plotting.Route?null:s.setGOFeature(i)?(this.goAnimations.push(s),l!==SuperMap.Plot.AnimationPlayType.UNKNOWN&&s.setAnimationPlayType(l),n&&this.fire(SuperMap.Plot.Event.animationcreated,{goAnimation:s}),s):null}},{key:"findGOAnimationByName",value:function(t){if(null===this.goAnimations||null===t||""===t)return null;for(var e=null,i=0;i<this.goAnimations.length;i++)if(this.goAnimations[i].name===t){e=this.goAnimations[i];break}return e}},{key:"findGOAnimationsByFeature",value:function(t){var e=[];if(null===this.goAnimations||"undefined"===t||null===t)return e;for(var i=0;i<this.goAnimations.length;i++)this.goAnimations[i].getGOFeature()===t&&e.push(this.goAnimations[i]);return e}},{key:"findGOAnimationsByUuid",value:function(t){if(null===this.goAnimations||"undefined"===t||null===t)return[];var e=this.map.getFeatureByUuid(t);return this.findGOAnimationsByFeature(e)}},{key:"removeGOAnimationByName",value:function(t){if(null===this.goAnimations||null===t||""===t)return!1;var e=this.findGOAnimationByName(t);return this.removeGOAnimation(e)}},{key:"removeGOAnimation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null===this.goAnimations||null===t)return!1;this.fire(SuperMap.Plot.Event.beforeanimationdeleted,{result:t});for(var i=0;i<this.goAnimations.length;i++)if(this.goAnimations[i]===t){t.reset();var o=this.getAnimationGroup(t).group,n=this.getAnimationGroup(t).index;t.destroy(),e||(this.goAnimations.splice(i,1),o.splice(n,1));for(var l=n;l<o.length;l++){var s=o[l];this.changeAnimationTime(s)}break}return this.fire(SuperMap.Plot.Event.animationdeleted,{result:t}),!0}},{key:"removeAllGOAnimation",value:function(){if(null!==this.goAnimations){for(var t=this.goAnimations.length,e=0;e<t;e++)this.removeGOAnimation(this.goAnimations[e],!0);var i=this.getAnimationGroup(this.goAnimations[0]).group;null!=i&&i.splice(0,i.length),this.goAnimations.splice(0,this.goAnimations.length),this.goAnimations=[]}}},{key:"execute",value:function(){if(0===this.goAnimations.length)return!1;for(var t=0;t<this.goAnimations.length;t++)this.goAnimations[t].execute();if(this.hasGrowAnimation())for(var e=0;e<this.goAnimations.length;e++)this.redrawFeature(this.goAnimations[e].animationGOFeature);return 0!==this.goAnimations.length||void 0}},{key:"hasGrowAnimation",value:function(){if(null===this.goAnimations)return!1;for(var t=0;t<this.goAnimations.length;t++)if(this.goAnimations[t].animationGOFeature&&!0===this.goAnimations[t].animationGOFeature.grow&&this.goAnimations[t].canExecute())return!0}},{key:"redrawFeature",value:function(t){if(!(t.grow&&t instanceof Eh))return!0;var e=new SuperMap.GetSymbolInfoParameters;e.libID=t.libID,e.code=t.code,e.surroundLineType=t.surroundLineType,e.inputPoints=L.Util.latLngsToSuperMapPoints(t.getLatLngs()),e.subSymbols=t.subSymbols,e.scaleValues=t.scaleValues,L.supermap.symbolInfoService(t.serverUrl,this.options.serviceParams).getSymbolInfo(e,function(e){t.symbolData.innerCells=e.result.innerCells,t.redraw()},this)}},{key:"createGOAnimationByType",value:function(t,e){if(null===e||""===e||null===this.map)return null;if(null!==this.findGOAnimationByName(e))return null;var i=null;switch(t){case SuperMap.Plot.GOAnimationType.ANIMATION_WAY:i=new Jh;break;case SuperMap.Plot.GOAnimationType.ANIMATION_BLINK:i=new Gh;break;case SuperMap.Plot.GOAnimationType.ANIMATION_ATTRIBUTE:i=new Yh;break;case SuperMap.Plot.GOAnimationType.ANIMATION_SHOW:i=new Zh;break;case SuperMap.Plot.GOAnimationType.ANIMATION_ROTATE:i=new Xh;break;case SuperMap.Plot.GOAnimationType.ANIMATION_SCALE:i=new Hh;break;case SuperMap.Plot.GOAnimationType.ANIMATION_GROW:i=new Wh;break;case SuperMap.Plot.GOAnimationType.ANIMATION_GROW_EXP:i=new $h;break;case SuperMap.Plot.GOAnimationType.ANIMATION_REDUCE_EXP:i=new tc;break;case SuperMap.Plot.GOAnimationType.ANIMATION_SHOW_EXP:i=new lc;break;case SuperMap.Plot.GOAnimationType.ANIMATION_HIDE_EXP:i=new sc;break;case SuperMap.Plot.GOAnimationType.ANIMATION_MOVEIN_EXP:i=new ec;break;case SuperMap.Plot.GOAnimationType.ANIMATION_MOVEOUT_EXP:i=new ic;break;case SuperMap.Plot.GOAnimationType.ANIMATION_ZOOMIN_EXP:i=new oc;break;case SuperMap.Plot.GOAnimationType.ANIMATION_ZOOMOUT_EXP:i=new nc;break;case SuperMap.Plot.GOAnimationType.ANIMATION_BLINK_EXP:i=new ac;break;case SuperMap.Plot.GOAnimationType.ANIMATION_WAY_EXP:i=new qh;break;case SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE_EXP:i=new Qh;break;case SuperMap.Plot.GOAnimationType.ANIMATION_CURVE_EXP:i=new Kh;break;default:return null}return null!==i&&(i.name=e),i}},{key:"getJSONData",value:function(){function t(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].getJSONData());return e}for(var e={ANIMATIONSJSON:" ",AnimationGroups:[]},i=this.getAllGroups(),o=0;o<i.length;o++){var n={ANIMATIONGROUP:"",Caption:"",Description:"",GroupName:(o+1).toString(),Animations:t(i[o])};e.AnimationGroups.push(n)}return e}},{key:"fromJSONData",value:function(t){var e=0;if(Object.prototype.hasOwnProperty.call(t,"ANIMATIONSJSON"))for(var i=0;i<t.AnimationGroups.length;i++){for(var o=0;o<t.AnimationGroups[i].Animations.length;o++){var n=t.AnimationGroups[i].Animations[o],l=n.goLayerUuid||n.goFeatureUuid,s=this.map.getFeatureByUuid(l),a=n.name,r=n.type;if(s&&a&&-1!==r)null!==(p=this.createGOAnimation(r,a,s))&&p.fromJSONData(n)}e+=t.AnimationGroups[i].Animations.length}else{for(var u=0;u<t.animations.length;u++){var p,h=t.animations[u],c=h.goFeatureUuid||h.goLayerUuid,y=this.map.getFeatureByUuid(c),g=h.name,f=h.type;if(y&&g&&-1!==f)null!==(p=this.createGOAnimation(f,g,y))&&p.fromJSONData(h)}e=t.animations.length}this.fire(SuperMap.Plot.Event.animatitonjsonend,{animationNumber:e})}},{key:"saveEvoFile",value:function(){}},{key:"openEvoFileOnServer",value:function(){}}])&&uc(i.prototype,o),n&&uc(i,n),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,o,n}(),fc=function(t,e,i){return new gc(t,e,i)};L.supermap.plotting.goAnimationManager=fc,L.supermap.plotting.GOAnimationManager=gc;var dc=L.Evented.extend({map:null,serverUrl:null,smlInfo:null,smlFileName:null,options:{serviceParams:{proxy:null,withCredentials:!1,crossOrigin:null,headers:null,serverType:null}},initialize:function(t,e,i){i&&SuperMap.Util.extend(this.options,i),t&&null!==t&&null===this.map&&(dc.prototype.map=t),e&&null===this.serverUrl&&(dc.prototype.serverUrl=e),null===this.smlInfo&&(dc.prototype.smlInfo=new SuperMap.Plot.SMLInfoStruct),null===this.smlFileName&&(dc.prototype.smlFileName="situationMap")},destroy:function(){dc.prototype.map=null,dc.prototype.smlInfo.destroy(),dc.prototype.smlInfo=null,dc.prototype.smlFileName=null,dc.prototype.serverUrl=null},getSitDataLayers:function(){return this.map.getPlottingLayers()},getSmlData:function(){var t=this.map.getPlottingLayers(),e=new SuperMap.Plot.SitDataStruct;e.smlInfo=this.smlInfo;var i=new SuperMap.Plot.MapInfoStruct;i.zoom=this.map.getZoom(),i.centerX=this.map.getCenter().lng,i.centerY=this.map.getCenter().lat,e.mapInfo=i,e.layerDatas=[];for(var o=0;o<t.length;o++){var n=t[o].features,l=new SuperMap.Plot.LayerDataStruct;l.layerName=t[o].name,l.spatialAnalystUrl=t[o].spatialAnalystUrl,this.map instanceof L.Map?this.map.getRenderer(t[o])instanceof L.Canvas&&(l.useCanvas=!0):(l.useCanvas=t[o].useCanvas,l.useCanvas2=t[o].useCanvas2),l.isEditable=t[o].getEditable(),l.isLocked=t[o].getLocked(),l.visibility=t[o].getVisibility(),l.enableSymScale=t[o].enableSymScale,l.features=n,e.layerDatas.push(l)}return SuperMap.Plot.PlottingUtil.toJSON(e)},openSmlData:function(t){if(this.smlInfo.fromJSON(t.smlInfo),t.mapInfo){var e=new SuperMap.Plot.MapInfoStruct;e.fromJSON(t.mapInfo),null!==e.zoom&&null!==e.centerX&&null!==e.centerY&&this.map.setView(L.latLng(e.centerY,e.centerX),e.zoom,{reset:!0})}var i,o=t.layerDatas;this.map.clearPlottingLayers();for(var n=0,l=o.length;n<l;n++)(i=L.supermap.plotting.plottingLayer(o[n].layerName,this.serverUrl,{renderer:L.canvas(),serviceParams:this.options.serviceParams})).spatialAnalystUrl=o[n].spatialAnalystUrl,this.map.addLayer(i),this._load(o[n],i),void 0!==o[n].isEditable&&null!==o[n].isEditable&&i.setEditable(o[n].isEditable),void 0!==o[n].isLocked&&null!==o[n].isLocked&&i.setLocked(o[n].isLocked),void 0!==o[n].visibility&&null!==o[n].visibility&&i.setVisibility(o[n].visibility),void 0!==o[n].enableSymScale&&null!==o[n].enableSymScale&&i.enableSymScaleDefinition(o[n].enableSymScale),void 0!==o[n].minVisibleScale&&null!==o[n].minVisibleScale&&i.setMinVisibleScale(o[n].minVisibleScale),void 0!==o[n].maxVisibleScale&&null!==o[n].maxVisibleScale&&i.setMaxVisibleScale(o[n].maxVisibleScale),void 0!==o[n].symScaleDefinition&&null!==o[n].symScaleDefinition&&i.setSymScaleDefinition(o[n].symScaleDefinition)},addSmlData:function(t,e){this.smlInfo.fromJSON(t.smlInfo);for(var i=t.layerDatas,o=null,n=0;n<i.length;n++)if(null!==i[n].layerName){var l=this.map.getLayersByName(i[n].layerName);0!==l.length?o=l[0]:e&&((o=L.supermap.plotting.plottingLayer(i[n].layerName,this.serverUrl,{serviceParams:this.options.serviceParams})).spatialAnalystUrl=i[n].spatialAnalystUrl,this.map.addLayer(o)),null!==o&&this._load(i[n],o)}},addSmlDataToLayer:function(t,e){this.smlInfo.fromJSON(t.smlInfo);var i=t.layerDatas,o=null,n=this.map.getLayersByName(e);0!==n.length?o=n[0]:(o=L.supermap.plotting.plottingLayer(e,this.serverUrl,{serviceParams:this.options.serviceParams}),this.map.addLayer(o));for(var l=0;l<i.length;l++)this._load(i[l],o)},openSmlFile:function(t,e){var i=this.serverUrl+"/smlInfos/",o=document.getElementById(t).value.split("\\"),n=o[o.length-1];i+=n,i=SuperMap.MGISCredential.addToken(i);var l=this;""!==n&&$.ajaxFileUpload({url:i,secureuri:!1,fileElementId:t,dataType:"json",timeout:36e5,success:function(){l.openSmlFileOnServer(n,e)},error:function(){e({success:!1,message:"打开本地态势图文件失败"})}})},addSmlFile:function(t,e,i){var o=this.serverUrl+"/smlInfos/",n=document.getElementById(t).value.split("\\"),l=n[n.length-1];o+=l,o=SuperMap.MGISCredential.addToken(o);var s=this;""!==l&&$.ajaxFileUpload({url:o,secureuri:!1,fileElementId:t,dataType:"json",timeout:36e5,success:function(){s.addSmlFileOnServer(l,e,i)},error:function(){i({success:!1,message:"叠加本地态势图文件失败"})}})},uploadSmlFile:function(t,e){var i=this.serverUrl+"/smlInfos/",o=document.getElementById(t).value.split("\\"),n=o[o.length-1];i+=n,i=SuperMap.MGISCredential.addToken(i),""!==n&&$.ajaxFileUpload({url:i,secureuri:!1,fileElementId:t,dataType:"json",timeout:36e5,success:function(){e({success:!0,message:"上传态势图文件成功"})},error:function(){e({success:!1,message:"上传态势图文件失败"})}})},addSmlFileToLayer:function(t,e,i){var o=this.serverUrl+"/smlInfos/",n=document.getElementById(t).value.split("\\"),l=n[n.length-1];o+=l,o=SuperMap.MGISCredential.addToken(o);var s=this;""!==l&&$.ajaxFileUpload({url:o,secureuri:!1,fileElementId:t,dataType:"json",timeout:36e5,success:function(){s.addSmlFileToLayerOnServer(l,e,i)},error:function(){i({success:!1,message:"打开本地文件失败"})}})},addSmlFileOnServer:function(t,e,i){var o=new SuperMap.EditSmlFileParameters;o.method="GET",o.smlFileName=t,L.supermap.smlFileService(this.serverUrl,this.options.serviceParams).editSMLFile(o,function(t){if(t.result.succeed){var o=t.result;this.smlInfo.fromJSON(o.smlInfo);for(var n=o.layerDatas,l=null,s=0;s<n.length;s++){var a=[];n[s].layerName&&(a=this.map.getLayersByName(n[s].layerName)),0!==a.length?l=a[0]:e&&((l=L.supermap.plotting.plottingLayer(n[s].layerName,this.serverUrl,{serviceParams:this.options.serviceParams})).spatialAnalystUrl=n[s].spatialAnalystUrl,this.map.addLayer(l)),null!==l&&this._load(n[s],l)}null!==l&&"function"==typeof i?i({success:!0,smlFileName:this.smlFileName,sitDataLayers:this.map.getPlottingLayers()}):"function"==typeof i&&i({success:!1,message:"态势图文件不存在与当前态势图同名的图层"})}else"function"==typeof i&&i({success:!1,message:"从服务器上获取态势图文件失败"})},this)},addSmlFileToLayerOnServer:function(t,e,i){var o=new SuperMap.EditSmlFileParameters;o.method="GET",o.smlFileName=t,L.supermap.smlFileService(this.serverUrl,this.options.serviceParams).editSMLFile(o,function(t){if(t.result.succeed){var o=t.result;this.smlInfo.fromJSON(o.smlInfo);var n=o.layerDatas,l=null,s=this.map.getLayersByName(e);0!==s.length?l=s[0]:(l=L.supermap.plotting.plottingLayer(e,this.serverUrl,{serviceParams:this.options.serviceParams}),this.map.addLayer(l));for(var a=0;a<n.length;a++)this._load(n[a],l);"function"==typeof i&&i({success:!0,smlFileName:this.smlFileName,sitDataLayers:this.map.getPlottingLayers()})}else"function"==typeof i&&i({success:!1,message:"从服务器上获取态势图失败"})},this)},downloadSmlFileURL:function(t){var e=this.serverUrl+"/smlFileDownload/".concat(t,".sml");return SuperMap.MGISCredential.addToken(e)},newSmlFile:function(){this.smlFileName="",this.smlInfo.destroy(),this.map.clearPlottingLayers()},saveSmlFile:function(t){var e=this.map.getPlottingLayers();this._save(this.smlFileName,e,!0,t)},saveAsSmlFile:function(t,e){var i=this.map.getPlottingLayers();this._save(t,i,!1,e)},getSMLInfo:function(t,e){var i=new SuperMap.EditSmlFileParameters;i.method="GET",i.smlFileName=t,L.supermap.smlFileService(this.serverUrl,this.options.serviceParams).editSMLFile(i,function(t){t.result.succeed&&"function"==typeof e?e({success:!0,smlInfo:t.result.smlInfo}):"function"==typeof e&&e({success:!1})},this)},getSMLInfos:function(t,e,i){var o=t*e,n=e,l=new SuperMap.GetSMLInfosParameters;l.start=o,l.count=n,L.supermap.smlFileService(this.serverUrl,this.options.serviceParams).getSMLInfos(l,function(t){t.result.succeed&&"function"==typeof i?i({success:!0,smlInfoList:t.result}):"function"==typeof i&&i({success:!1})},this)},_getCompletedInit:function(t,e){if(this.smlFileName=e,this.smlInfo.fromJSON(t.smlInfo),t.mapInfo){var i=new SuperMap.Plot.MapInfoStruct;i.fromJSON(t.mapInfo),null!==i.zoom&&null!==i.centerX&&null!==i.centerY&&this.map.setView(L.latLng(i.centerY,i.centerX),i.zoom,{reset:!0})}var o,n=t.layerDatas;this.map.clearPlottingLayers();for(var l=0,s=n.length;l<s;l++)(o=L.supermap.plotting.plottingLayer(n[l].layerName,this.serverUrl,{renderer:L.canvas(),serviceParams:this.options.serviceParams})).spatialAnalystUrl=n[l].spatialAnalystUrl,this.map.addLayer(o),this._load(n[l],o),void 0!==n[l].isEditable&&null!==n[l].isEditable&&o.setEditable(n[l].isEditable),void 0!==n[l].isLocked&&null!==n[l].isLocked&&o.setLocked(n[l].isLocked),void 0!==n[l].visibility&&null!==n[l].visibility&&o.setVisibility(n[l].visibility),void 0!==n[l].enableSymScale&&null!==n[l].enableSymScale&&o.enableSymScaleDefinition(n[l].enableSymScale),void 0!==n[l].minVisibleScale&&null!==n[l].minVisibleScale&&o.setMinVisibleScale(n[l].minVisibleScale),void 0!==n[l].maxVisibleScale&&null!==n[l].maxVisibleScale&&o.setMaxVisibleScale(n[l].maxVisibleScale),void 0!==n[l].symScaleDefinition&&null!==n[l].symScaleDefinition&&o.setSymScaleDefinition(n[l].symScaleDefinition)},openSmlFileOnServer:function(t,e){var i=new SuperMap.EditSmlFileParameters;i.method="GET",i.smlFileName=t,L.supermap.smlFileService(this.serverUrl,this.options.serviceParams).editSMLFile(i,function(i){i.result.succeed?(this._getCompletedInit(i.result,t),"function"==typeof e&&e({success:!0,smlFileName:this.smlFileName,sitDataLayers:this.map.getPlottingLayers()})):"function"==typeof e&&e({success:!1,message:"打开已发布的态势图文件失败"})},this)},deleteSmlFileOnServer:function(t,e){var i=new SuperMap.EditSmlFileParameters;i.method="DELETE",i.smlFileName=t,L.supermap.smlFileService(this.serverUrl,this.options.serviceParams).editSMLFile(i,function(t){t.result.succeed&&"function"==typeof e?e({success:!0}):"function"==typeof e&&e({success:!1})},this)},_save:function(t,e,i,o){var n=new SuperMap.Plot.SitDataStruct;n.smlInfo=this.smlInfo;var l=new SuperMap.Plot.MapInfoStruct;l.zoom=this.map.getZoom(),l.centerX=this.map.getCenter().lng,l.centerY=this.map.getCenter().lat,n.mapInfo=l,n.layerDatas=[];for(var s=0;s<e.length;s++){var a=e[s].features,r=new SuperMap.Plot.LayerDataStruct;r.layerName=e[s].name,r.spatialAnalystUrl=e[s].spatialAnalystUrl,this.map instanceof L.Map?this.map.getRenderer(e[s])instanceof L.Canvas&&(r.useCanvas=!0):(r.useCanvas=e[s].useCanvas,r.useCanvas2=e[s].useCanvas2),r.minVisibleScale=e[s].getMinVisibleScale(),r.maxVisibleScale=e[s].getMaxVisibleScale(),r.symScaleDefinition=e[s].getSymScaleDefinition(),r.isEditable=e[s].getEditable(),r.isLocked=e[s].getLocked(),r.visibility=e[s].getVisibility(),r.enableSymScale=e[s].enableSymScale,r.features=a,n.layerDatas.push(r)}var u=new SuperMap.EditSmlFileParameters;u.method="POST",u.sitData=n,u.smlFileName=t,u.isCover=i,L.supermap.smlFileService(this.serverUrl,this.options.serviceParams).editSMLFile(u,function(t){t.result.succeed&&"function"==typeof o?o({success:!0}):"function"==typeof o&&o({success:!1})},this)},_load:function(t,e){var i=this;e.spatialAnalystUrl=t.spatialAnalystUrl;for(var o,n,l,s,a=function(){if(null!==(o=t.features[r])){o.resolution?n=i.map.getZoom():o.fromZoom&&(n=o.fromZoom),!1===o.scaleByMap&&(n=i.map.getZoom()),Object.prototype.hasOwnProperty.call(o,"isEdit")||(o.isEdit=!0);var a=o.uuid;if(o.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&null==o.innerCells){var u={};if(u.symbolRank=o.symbolRank,u.surroundLineType=o.surroundLineType,l=!1,0===u.surroundLineType&&0===u.symbolRank||(l=!0),s=e._getSymbolDataFromCache(o.libID,o.code),l||null===s){var p=new SuperMap.GetSymbolInfoParameters({libID:o.libID,code:o.code,symbolRank:u.symbolRank,surroundLineType:u.surroundLineType,inputPoints:o.localePoints,subSymbols:o.subSymbols});L.supermap.symbolInfoService(i.serverUrl,i.options.serviceParams).getSymbolInfo(p,function(t){t.result.libID&&t.result.code&&(t.result.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL||l||e._cacheSymbolData(t.result),s=SuperMap.Util.cloneObject(t.result),SuperMap.Plot.AnalysisSymbol.mergeSymbolDataAndServerData(o,s),e.createSymbol(o.libID,o.code,void 0,a,{},{serverUrl:this.serverUrl,symbolData:o,fromZoom:n,map:this.map,serviceParams:this.options.serviceParams,isGeoJSONData:!0}))},i)}else SuperMap.Plot.AnalysisSymbol.mergeSymbolDataAndServerData(o,s),e.createSymbol(o.libID,o.code,void 0,a,{},{serverUrl:i.serverUrl,symbolData:o,fromZoom:n,map:i.map,isGeoJSONData:!0})}else e.createSymbol(o.libID,o.code,void 0,a,{},{serverUrl:i.serverUrl,symbolData:o,fromZoom:n,map:i.map})}},r=0,u=t.features.length;r<u;r++)a()}}),mc=function(t,e,i){return new dc(t,e,i)};L.supermap.plotting.sitDataManager=mc,L.supermap.plotting.SitDataManager=dc;var Sc=L.Evented.extend({url:null,libID:null,symbolLibData:null,cachedSymbolList:null,needCacheList:null,symbolNames:null,options:{serviceParams:{proxy:null,withCredentials:!1,crossOrigin:null,headers:null,serverType:null}},initialize:function(t){this.cachedSymbolList={},this.needCacheList=[],t&&SuperMap.Util.extend(this.options,t),t&&t.url&&t.libID?(this.url=t.url,this.libID=t.libID):t&&t.symbolLibData&&(this.symbolLibData=t.symbolLibData,this.libID=this.symbolLibData.libID,this.initNeedCacheList())},destroy:function(){this.url=null,this.libID=null,this.symbolLibData=null},initializeAsync:function(){var t=new SuperMap.GetLibInfoParameter;t.libID=this.libID,L.supermap.symbolLibService(this.url,this.options.serviceParams).getLibInfo(t,function(t){t.result.succeed?(this.symbolLibData=t.result,this.libID=this.symbolLibData.libID,this.initNeedCacheList(),this.fire(SuperMap.Plot.Event.initializecompleted,{success:!0})):(this.libID=-1,this.fire(SuperMap.Plot.Event.initializecompleted,{success:!1}))},this)},getSymbolLibName:function(){return null===this.symbolLibData?null:this.symbolLibData.symbolLibName},getSymbolName:function(t){return null===this.symbolLibData?"":(null===this.symbolNames&&(this.symbolNames={},this.getSymbolNameFromList(this.symbolLibData.rootSymbolLibNode)),this.symbolNames[t])},getSymbolNameFromList:function(t){for(var e=0;e<t.childNodeCount;e++)"SYMBOL_GROUP"===t.childNodes[e].symbolNodeType?this.getSymbolNameFromList(t.childNodes[e]):"SYMBOL_NODE"===t.childNodes[e].symbolNodeType&&(this.symbolNames[t.childNodes[e].symbolCode]=t.childNodes[e].symbolName);return""},initNeedCacheList:function(){if(null===this.symbolLibData)return!1;this.initNeedCacheListForNode(this.symbolLibData.rootSymbolLibNode)},initNeedCacheListForNode:function(t){for(var e=0;e<t.childNodeCount;e++)"SYMBOL_GROUP"===t.childNodes[e].symbolNodeType?this.initNeedCacheListForNode(t.childNodes[e]):"SYMBOL_NODE"===t.childNodes[e].symbolNodeType&&"SYMBOL_DOT"===t.childNodes[e].symbolType&&this.needCacheList.push(t.childNodes[e].symbolCode)},cachedSymbols:function(){if(0!==this.needCacheList.length){var t=Math.floor(1e3*Math.random()),e=new SuperMap.GetSymbolInfoParameters;e.libID=this.libID,e.code=this.needCacheList[0],e.dynamicToken=t,L.supermap.symbolInfoService(this.url,this.options.serviceParams).getSymbolInfo(e,function e(i){if(i.result.succeed){if(i.result.dynamicToken&&i.result.dynamicToken===SuperMap.MD5.md5(t.toString()))delete i.result.dynamicToken,this.cacheSymbolData(i.result);else{var o=SuperMap.Util.indexOf(this.needCacheList,i.result.code);-1!==o&&this.needCacheList.splice(o,1)}if(0===this.needCacheList.length)this.fire(SuperMap.Plot.Event.cachecompleted,{success:!0});else{var n=new SuperMap.GetSymbolInfoParameters;n.libID=this.libID,n.code=this.needCacheList[0],n.dynamicToken=t,L.supermap.symbolInfoService(this.url,this.options.serviceParams).getSymbolInfo(n,e,this)}}},this),this.cachedSymbolOK=!0}else this.fire(SuperMap.Plot.Event.cachecompleted,{success:!0})},getSymbolLibID:function(){return this.libID},getSymbolData:function(t){var e=null;return Object.prototype.hasOwnProperty.call(this.cachedSymbolList,t)&&(e=SuperMap.Plot.PlottingUtil.cloneObject(this.cachedSymbolList[t])),e},cacheSymbolData:function(t){var e=SuperMap.Util.indexOf(this.needCacheList,t.code);-1!==e&&(this.cachedSymbolList[t.code]=SuperMap.Plot.PlottingUtil.cloneObject(t),this.needCacheList.splice(e,1))},getSymbolCount:function(){return null===this.symbolLibData?null:this.symbolLibData.symbolCount},querySymbolbyKey:function(t){return this.querySymbol(t,this.getRootSymbolInfo(),this.getRootSymbolIconUrl())},getClassFication:function(){return null===this.symbolLibData?null:this.symbolLibData.classFication},getCreateTime:function(){return null===this.symbolLibData?null:this.symbolLibData.createTime},getCreator:function(){return null===this.symbolLibData?null:this.symbolLibData.creator},getModifyTime:function(){return null===this.symbolLibData?null:this.symbolLibData.modifyTime},getRootSymbolIconUrl:function(){return null===this.symbolLibData?null:this.symbolLibData.rootSymbolIconUrl},getVersion:function(){return null===this.symbolLibData?null:this.symbolLibData.version},getRootSymbolInfo:function(){return null===this.symbolLibData?null:this.symbolLibData.rootSymbolLibNode},querySymbol:function(t,e,i){var o=[];if("SYMBOL_GROUP"===e.symbolNodeType)for(var n=0;n<e.childNodes.length;n++)for(var l=i+"/"+e.symbolName,s=this.querySymbol(t,e.childNodes[n],l),a=0;a<s.length;a++)o.push(s[a]);else t===e.symbolCode.toString()?(e.icon=i+"/"+e.symbolCode+".png",o.push(e)):-1!==e.symbolName.indexOf(t)&&(e.icon=i+"/"+e.symbolCode+".png",o.push(e));return o}}),Pc=function(t){return new Sc(t)};L.supermap.plotting.symbolLib=Pc,L.supermap.plotting.SymbolLib=Sc;var bc=L.Evented.extend({url:null,libIDs:null,symbolLibs:null,symbolLibJsons:null,isInializeOK:!1,options:{serviceParams:{proxy:null,withCredentials:!1,crossOrigin:null,headers:null,serverType:null}},initialize:function(t,e){bc.prototype.url=t,null===this.libIDs&&(bc.prototype.libIDs=[]),null===this.symbolLibs&&(bc.prototype.symbolLibs=[]),null===this.symbolLibJsons&&(bc.prototype.symbolLibJsons=[]),e&&SuperMap.Util.extend(this.options,e)},destroy:function(){bc.prototype.url=null,bc.prototype.libIDs=null,bc.prototype.symbolLibs=null,bc.prototype.symbolLibJsons=null,bc.prototype.isInializeOK=!1,bc.prototype.isInitialize=!1},initializeAsync:function(){this.isInitializeOK()?this.fire(SuperMap.Plot.Event.initializecompleted,{success:!0,libIDs:this.libIDs}):this.isInitialize||(bc.prototype.isInitialize=!0,L.supermap.symbolLibService(this.url,this.options.serviceParams).getLibIDs(function(t){if(void 0!==t.result&&t.result.succeed){if(null!==this.libIDs&&0!==this.libIDs.length)for(var e=0;e<this.libIDs.length;e++){for(var i=!1,o=0;o<t.result.length;o++)if(bc.prototype.libIDs[e]===t.result[o]){i=!0;break}!1===i&&bc.prototype.libIDs.slice(e,1)}else bc.prototype.libIDs=t.result;this.initializeSymbolLib()}else bc.prototype.libIDs=[]},this))},initializeSymbolLib:function(){for(var t=this.libIDs.slice(),e=0,i=this.libIDs.length;e<i;e++){var o=new SuperMap.GetLibInfoParameter;o.libID=this.libIDs[e],L.supermap.symbolLibService(this.url,this.options.serviceParams).getLibInfo(o,function(e){if(e.result.succeed){var i=SuperMap.Util.indexOf(t,e.result.libID);-1!==i&&(t.splice(i,1),bc.prototype.symbolLibJsons.push(e.result),bc.prototype.symbolLibs.push(new Sc({symbolLibData:e.result})),this.symbolLibs[this.symbolLibs.length-1].url=this.url),0===t.length&&(bc.prototype.isInializeOK=!0,this.fire(SuperMap.Plot.Event.initializecompleted,{success:!0,libIDs:this.libIDs}))}},this)}},isInitializeOK:function(){return this.isInializeOK},getSymbolLibNumber:function(){return this.libIDs.length},getSymbolLibID:function(t){return t>=this.libIDs.length?-1:this.libIDs[t]},getSymbolLibJSONInfo:function(t){return t>=this.libIDs.length?null:this.symbolLibJsons[t]},getSymbolLibByIndex:function(t){return t>=this.libIDs.length?null:this.symbolLibs[t]},getSymbolLibByLibId:function(t){for(var e=0;e<this.symbolLibs.length;e++)if(t===this.symbolLibs[e].libID)return this.symbolLibs[e];return null},cacheSymbolData:function(t){var e=t.libID,i=this.getSymbolLibByLibId(e);if(null===i)for(var o in i=new Sc({libID:e}),this.symbolLibs.push(i),t)o!==e&&(i.cachedSymbolList[o]=SuperMap.Plot.PlottingUtil.cloneObject(t[o]))},cacheSymbolLib:function(t){var e=this.getSymbolLibByLibId(t);null!==e&&(e.on(SuperMap.Plot.Event.cachecompleted,function t(){this.fire(SuperMap.Plot.Event.cachecompleted,{success:!0}),e.off(SuperMap.Plot.Event.cachecompleted,t)},this),e.cachedSymbols())},getSymbolName:function(t,e){var i=this.getSymbolLibByLibId(t);return null===i?"":i.getSymbolName(e)},findSymbolByName:function(t){for(var e=[],i=0;i<this.libIDs.length;i++)for(var o=this.getSymbolLibByLibId(this.libIDs[i]).querySymbolbyKey(t),n=0;n<o.length;n++)e.push(o[n]);return e},findSymbolByCode:function(t){for(var e=[],i=0;i<this.libIDs.length;i++)for(var o=this.getSymbolLibByLibId(this.libIDs[i]).querySymbolbyKey(t.toString()),n=0;n<o.length;n++)e.push(o[n]);return e}}),vc=function(t,e){return new bc(t,e)};L.supermap.plotting.symbolLibManager=vc,L.supermap.plotting.SymbolLibManager=bc;var Lc=L.Evented.extend({map:null,undoTransactions:null,redoTransactions:null,maxCount:32,initialize:function(t){this.map=t,this.undoTransactions=[],this.redoTransactions=[],null===this.maxCount&&(this.maxCount=32)},destroy:function(){this.map=null,this.undoTransactions=null,this.redoTransactions=null,this.maxCount=null},setMaxCount:function(t){this.maxCount=t},add:function(t){this.undoTransactions.length>this.maxCount-1&&this.undoTransactions.splice(0,this.undoTransactions.length-this.maxCount+1),this.undoTransactions.push(t)},undo:function(){var t=this.undoTransactions.length;if(t>0){var e=this.undoTransactions[t-1];this.doTransaction(e,!0),this.redoTransactions.push(e),this.undoTransactions.splice(t-1,1)}},redo:function(){var t=this.redoTransactions.length;if(t>0){var e=this.redoTransactions[t-1];this.doTransaction(e),this.undoTransactions.push(e),this.redoTransactions.splice(t-1,1)}},doTransaction:function(t,e){var i=t.transInfos;if(t.transType===SuperMap.Plot.TransactionType.CREATE)for(var o=0,n=i.length;o<n;o++){var l=this.map.getLayer(i[o].layerId);e?l.removeFeatures(i[o].feature):l.addFeatures(i[o].feature)}else if(t.transType===SuperMap.Plot.TransactionType.EDIT)for(var s=0;s<i.length;s++){var a=this.map.getLayer(i[s].layerId),r=null;if(r=a?this.map.getFeatureByUuid(i[s].uuid):L.supermap.plotting.getControl(this.map).getFeatureByUuid(i[s].uuid),null!==a||null!==r){var u=i[s].redoParams;if(e&&(u=i[s].undoParams),"setFontAlign"===i[s].functionName)u.length>0&&r.setFontAlign(u[0]);else if("setLatLngs"===i[s].functionName)u.length>0&&r.setLatLngs(u[0]);else if("modifyPoint"===i[s].functionName)u.length>0&&r._modifyPoint(u[0],u[1]);else if("setTextContent"===i[s].functionName)u.length>0&&r.setTextContent(u[0]);else if("setRadiusText"===i[s].functionName)2===u.length&&r.setRadiusText(u[0],u[1]);else if("setType"===i[s].functionName&&r instanceof L.supermap.plotting.RouteNode)u.length>0&&r.setType(u[0]);else if("setStrokeColor"===i[s].functionName&&r.geometry instanceof SuperMap.Geometry.GroupObject)u.length>0&&r.setStyle(u[0]);else if("addAvoidRegion"===i[s].functionName)u.length>0&&(u[0]&&u[0].layer&&u[0].layer.removeFeatures(u[0]),e?r.removeAvoidRegions(u[0]):r.addAvoidRegion(u[0]));else if("removeAvoidRegions"===i[s].functionName){if(u.length>0){for(var p=0;p<u[0].length;p++)u[0][p]&&u[0][p].layer&&u[0][p].layer.removeFeatures(u[0][p]);if(e)for(var h=0;h<u[0].length;h++)r.addAvoidRegion(u[0][h]);else r.removeAvoidRegions(u[0])}}else if("createGroupObject"===i[s].functionName||"createFlags"===i[s].functionName){var c=null;e?a&&i[s].undoParams.length>0&&(c=a.unGroupObject(i[s].undoParams[0])):"createGroupObject"===i[s].functionName?c=a.createGroupObject(i[s].redoParams[0]):"createFlags"===i[s].functionName&&(c=a.createFlags(i[s].redoParams[0])),null!==c&&a._map.getPlotEditControl().selectFeatures(c)}else"updateSymbolText"===i[s].functionName?u.length>0&&r.updateSymbolText(u[0],u[1]):i[s].functionName&&null!==u&&r[i[s].functionName](u[0],u[1]);if(i[s].propertyName){var y=i[s].undoValue;e||(y=i[s].redoValue),Object.prototype.hasOwnProperty.call(r,i[s].propertyName)?r[i[s].propertyName]=y:null!==r&&(r.style[i[s].propertyName]=y)}r&&r.layer&&(r.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL||8!==r.textPosition||"fontColor"!==i[s].propertyName&&"fontFamily"!==i[s].propertyName||r._calculateParts(),r.redraw(),r.fire(SuperMap.Plot.Event.reseteditmarkersvalues))}}else if(t.transType===SuperMap.Plot.TransactionType.REMOVE)for(var g=0;g<i.length;g++)e?this.map.getLayer(i[g].layerId).addFeatures(i[g].feature):this.map.getLayer(i[g].layerId).removeFeatures(i[g].feature)}});L.supermap.plotting.transactionManager=function(t){return new Lc(t)},L.supermap.plotting.TransactionManager=Lc;var Mc=L.Evented.extend({name:"undefined",map:null,serverUrl:null,symScaleDefinition:null,activePlottingLayer:null,activeChildPlotLayer:null,activeSignSymbolLayer:null,plottingLayers:[],signSymbolLayers:[],_uuids:[],initialize:function(t,e,i){i&&SuperMap.Util.extend(this.options,i),null!=t&&(Mc.prototype.map=t),null!=i.symScaleDefinition&&(Mc.prototype.symScaleDefinition=i.symScaleDefinition),null!=e&&(Mc.prototype.serverUrl=e),this.plottingLayers=[],this.signSymbolLayers=[],this.activePlottingLayer=null,this.activeChildPlotLayer=null},destroy:function(){Mc.prototype.map=null,Mc.prototype.symScaleDefinition=null,Mc.prototype.serverUrl=null,Mc.prototype.name=null},getPlottingLayers:function(){return this.plottingLayers},getSymScaleDefinition:function(){if(null!=this.map)return null==Mc.prototype.symScaleDefinition&&(Mc.prototype.symScaleDefinition=this.getLayerScale()),Mc.prototype.symScaleDefinition},setSymScaleDefinition:function(t){Mc.prototype.symScaleDefinition=t},setActivePlottingLayer:function(t){if(null!==t){if(t instanceof Iy&&t.getVisibility()&&t.getEditable()&&(this.map._plotDrawControl&&null!==this.map._plotDrawControl&&this.map._plotDrawControl.setDrawingLayer(t),this.activePlottingLayer=t,null!=this.activeChildPlotLayer&&this.activeChildPlotLayer.getParent()!==this.activePlottingLayer))for(var e=0;e<this.activePlottingLayer.getChildPlotLayers().length;e++){var i=this.activePlottingLayer.getChildPlotLayers()[e];i.getVisibility()&&(this.activeChildPlotLayer=i)}this.fire("plottinglayeractive",{layer:t})}else this.activePlottingLayer=null},getActivePlottingLayer:function(){return this.activePlottingLayer},setActiveChildPlotLayer:function(t){null!==t?t.getVisibility()&&null!==t.getParent()&&t.getParent().getVisibility()&&t.getParent().getEditable()&&(this.activePlottingLayer!==this.activeChildPlotLayer.getParent()&&(t.getParent().setEditable(!0),this.map._plotDrawControl&&null!==this.map._plotDrawControl&&this.map._plotDrawControl.setDrawingLayer(t.getParent()),this.activePlottingLayer=t.getParent()),this.activeChildPlotLayer=t,this.fire("childplotlayeractive",{layer:t})):this.activeChildPlotLayer=null},getActiveChildPlotLayer:function(){return this.activeChildPlotLayer},saveTo:function(){var t={};return t.name=this.name,t.path="",t.plotLayers=[],t.signSymbolLayers=[],t.specialEffects={},t.symScaleDefinition=this.symScaleDefinition,this._savePlotLayers(t),this._saveSignSymbolLayers(t),this._saveSpecialEffects(t),t.animations=SuperMap.Plot.PlottingUtil.toJSON(L.supermap.plotting.getControl().getGOAnimationManager().getJSONData()),JSON.stringify(t)},loadFrom:function(t){this.removeAllPlottingLayers(),Mc.prototype.symScaleDefinition=t.symScaleDefinition,Mc.prototype.name=t.name,this._uuids.length=0;for(var e=0,i=t.plotLayers.length;e<i;e++)for(var o=0;o<t.plotLayers[e].childPlotLayers.length;o++)for(var n=0;n<t.plotLayers[e].childPlotLayers[o].plotSymbols.length;n++)null!=t.plotLayers[e].childPlotLayers[o].plotSymbols[n].graphicObject?this._uuids.push(t.plotLayers[e].childPlotLayers[o].plotSymbols[n].graphicObject.uuid):this._uuids.push(t.plotLayers[e].childPlotLayers[o].plotSymbols[n].graphicCompound.uuid);var l=this;this._loadPlotLayers(t.plotLayers,function(){l.fire("loadfinished",{data:t.plotLayers}),null!=t.animations&&L.supermap.plotting.getControl().getGOAnimationManager().fromJSONData(JSON.parse(t.animations)),null!=t.specialEffects&&L.supermap.plotting.getControl().getSpecialEffectManager()._fromJSONData(t.specialEffects)}),t.signSymbolLayers&&(this.removeAllSignSymbolLayers(),this._loadSignSymbolLayers(t.signSymbolLayers)),null!=t.specialEffects&&L.supermap.plotting.getControl().getSpecialEffectManager()._fromJSONData(t.specialEffects)},addPlottingLayer:function(t){for(var e=!0;e;){e=!1;for(var i=0;i<this.plottingLayers.length;i++)if(this.plottingLayers[i].name===t.name){t.name+="#1",e=!0;break}}this.plottingLayers.push(t),this.fire("plottinglayeradded",{plottingLayer:t})},addSignSymbolLayer:function(t){for(var e=!0;e;){e=!1;for(var i=0;i<this.signSymbolLayers.length;i++)if(this.signSymbolLayers[i].name===t.name){t.name+="#1",e=!0;break}}this.signSymbolLayers.push(t),this.activeSignSymbolLayer=t,this.fire("signsymbollayeradded",{signSymbolLayer:t})},getSignSymbolLayers:function(){return this.signSymbolLayers},findSignSymbolByUuid:function(t){for(var e=0;e<this.signSymbolLayers.length;e++){var i=this.signSymbolLayers[e].findSignSymbolByUuid(t);if(i)return i}},removePlottingLayer:function(t){var e=SuperMap.Util.indexOf(this.plottingLayers,t);-1!==e&&this.plottingLayers.splice(e,1),this.activePlottingLayer===t&&(this.activePlottingLayer=null,this.activeChildPlotLayer=null),this.fire("plottinglayerremoved",{plottingLayer:t})},removeSignSymbolLayer:function(t){var e=SuperMap.Util.indexOf(this.signSymbolLayers,t);-1!==e&&(t.removeAllFeatures(),this.signSymbolLayers.splice(e,1),this.map.removeLayer(t)),this.activeSignSymbolLayer===t&&(this.activeSignSymbolLayer=null),this.fire("signsymbollayerremoved",{signSymbolLayer:t})},removeAllPlottingLayers:function(){for(;this.map.getPlottingLayers().length>0;)this.map.removeLayer(this.plottingLayers[0]);this.plottingLayers.length=0},removeAllSignSymbolLayers:function(){for(;this.map.getSignSymbolLayers().length>0;)this.removeSignSymbolLayer(this.signSymbolLayers[0]);this.signSymbolLayers.length=0},getLayerScale:function(t){var e=0;if(null===this.map)return 0;var i=this.map._layers;for(var o in i)if(i[o]instanceof L.TileLayer){i[o].getScale&&(e=i[o].getScale(t));break}return e},_savePlotLayers:function(t){for(var e=0;e<map.getPlottingLayers().length;e++){var i={},o=map.getPlottingLayers()[e];i.caption=o.caption,i.name=o.name,i.description="",i.editable=o.getEditable(),i.visible=o.getVisibility(),i.selectable=o.getSelected(),i.symScaleDefinition=o.getSymScaleDefinition(),i.minVisibleScale=o.getMinVisibleScale(),i.maxVisibleScale=o.getMaxVisibleScale(),i.childPlotLayers=[],this._saveChildPlotLayer(i,o),t.plotLayers.push(i)}},_saveSignSymbolLayers:function(t){for(var e=0;e<map.getSignSymbolLayers().length;e++){var i={},o=map.getSignSymbolLayers()[e];i.caption=o.caption,i.name=o.name,i.description="",i.editable=o.getEditable(),i.visible=o.getVisibility(),i.selectable=o.getSelected(),i.symScaleDefinition=o.getSymScaleDefinition(),i.minVisibleScale=o.getMinVisibleScale(),i.maxVisibleScale=o.getMaxVisibleScale(),i.features=[],this._saveSignSymbol(i,o),t.signSymbolLayers.push(i)}},_saveSpecialEffects:function(t){for(var e=L.supermap.plotting.getControl().getSpecialEffectManager().getSpecialEffectList(),i=map.getPlottingLayers(),o=0;o<i.length;o++)for(var n=i[o].features,l=0;l<n.length;l++)if(1==n[l].symbolType){var s=n[l].getSpecialEffects();e=e.concat(s)}for(var a={},r=0;r<e.length;r++)this._saveSpecialEffect(a,e[r]);t.specialEffects=a},_saveChildPlotLayer:function(t,e){for(var i=0;i<e.getChildPlotLayers().length;i++){var o={},n=e.getChildPlotLayers()[i];o.name=n.name,o.caption=n.caption,o.visibility=n.visibility,o.plotSymbols=[],this._savePlotSymbols(o,n),t.childPlotLayers.push(o)}},_savePlotSymbols:function(t,e){for(var i=0;i<e.getFeatures().length;i++){var o=e.getFeatures()[i],n={};if(n.bubbleHeight=o.getBubbleHeight(),n.bubbleWidth=o.getBubbleWidth(),n.description=o.getDescription(),n.mediaList=o.getMediaList(),n.name=o.symbolName,n.renderOrder=2,n.visible="none"!==o.style.display,o instanceof vh||o instanceof Oy||o instanceof cy)n.graphicCompound=JSON.parse(o.toGeoJsonStr()),o instanceof cy&&o.symbolBounds&&(n.graphicCompound.symbolBounds=o.symbolBounds);else if(n.graphicObject=JSON.parse(o.toGeoJsonStr()),null!=o.joinLines){for(var l=[],s=0;s<o.joinLines.length;s++)if(o.joinLines[s].startAssociatedUuid===o.uuid){var a={caption:"joinLines"};a.uuid=o.joinLines[s].uuid,a.visible="none"!==o.joinLines[s].style.display,a.lineRelation=JSON.parse(o.joinLines[s].toGeoJsonStr()),l.push(a)}n.lineRelations=l}t.plotSymbols.push(n)}},_saveSignSymbol:function(t,e){for(var i=0;i<e.getSignSymbols().length;i++){var o=e.getSignSymbols()[i];t.features.push(o.getJSONData())}},_saveSpecialEffect:function(t,e){t.list||(t.list=[]),t.list.push(e.getJSONData())},_loadPlotLayers:function(t,e){for(var i=0,o=t.length;i<o;i++){var n=t[i],l=L.supermap.plotting.plottingLayer(n.name,this.serverUrl);l.removeChildPlotLayer(l.getChildPlotLayers()[0]),l.caption=n.caption,void 0===n.visibility?l.setVisibility(n.visible):l.setVisibility(n.visibility),l.setSelected(n.selectable),l.setEditable(n.editable),l.setMaxVisibleScale(n.maxVisibleScale),l.setMinVisibleScale(n.minVisibleScale),l.setSymScaleDefinition(n.symScaleDefinition,!0),this.activePlottingLayer=l,this.map.addLayer(l),this._loadChildLayers(n.childPlotLayers,l,e)}},_loadChildLayers:function(t,e,i){for(var o=0;o<t.length;o++){var n=t[o],l=L.supermap.plotting.childPlotLayer(n.name);l.caption=n.caption,void 0===n.visibility?l.setVisibility(n.visible):l.setVisibility(n.visibility),e.addChildPlotLayer(l),this._loadSymbols(n.plotSymbols,l,e,i)}},_loadSymbols:function(t,e,i,o){for(var n=[],l=0;l<t.length;l++){var s=t[l];if(null!=s.graphicObject){s.graphicObject.bubbleHeight=s.bubbleHeight,s.graphicObject.bubbleWidth=s.bubbleWidth,s.graphicObject.description=s.description,s.graphicObject.mediaList=s.mediaList,null!=s.name&&(s.graphicObject.symbolName=s.name),null!=s.visible&&(s.graphicObject.visible=s.visible);var a=SuperMap.Plot.PlottingUtil.toJSON(s.graphicObject);if(i.geoJsonToFeature1(a,e,function(t){var e=L.supermap.plotting.getControl().getPlotMapManager();if(0!==e._uuids.length){for(var i=0;i<e._uuids.length;i++)if(e._uuids[i]===t.feature.uuid){e._uuids.splice(i,1);break}0===e._uuids.length&&"function"==typeof o&&o()}}),null!=s.lineRelations&&0!=s.lineRelations.length)for(var r=0;r<s.lineRelations.length;r++){var u=s.lineRelations[r];u.lineRelation.visible=u.visible,n.push(u.lineRelation)}}else{s.graphicCompound.bubbleHeight=s.bubbleHeight,s.graphicCompound.bubbleWidth=s.bubbleWidth,s.graphicCompound.description=s.description,s.graphicCompound.mediaList=s.mediaList,null!=s.name&&(s.graphicCompound.symbolName=s.name),null!=s.visible&&(s.graphicCompound.visible=s.visible);a=SuperMap.Plot.PlottingUtil.toJSON(s.graphicCompound);i.geoJsonToFeature1(a,e,function(t){var e=L.supermap.plotting.getControl().getPlotMapManager();if(0!==e._uuids.length){for(var i=0;i<e._uuids.length;i++)if(e._uuids[i]===t.feature.uuid){e._uuids.splice(i,1);break}0===e._uuids.length&&"function"==typeof o&&o()}})}}for(var p=0;p<n.length;p++)i.geoJsonToFeature1(SuperMap.Plot.PlottingUtil.toJSON(n[p]),e)},_loadSignSymbolLayers:function(t){for(var e=0;e<t.length;e++){var i=t[e],o=L.supermap.plotting.signSymbolLayer(i.name,this.serverUrl);o.caption=i.caption,void 0===i.visibility?o.setVisibility(i.visible):o.setVisibility(i.visibility),o.setSelected(i.selectable),o.setEditable(i.editable),o.setMaxVisibleScale(i.maxVisibleScale),o.setMinVisibleScale(i.minVisibleScale),o.setSymScaleDefinition(i.symScaleDefinition,!0),this.activeSignSymbolLayer=o,this.map.addLayer(o),this._loadSign(i.features,o)}},_loadSign:function(t,e){for(var i=0;i<t.length;i++){var o=t[i],n=new SuperMap.Plot.Sign;n.fromJSON(o.sign),null!=o.associatedUuid?e.createSignSymbol(o.associatedUuid,n,{uuid:o.uuid,symbolName:o.symbolName}):e.createSignSymbolByPosition(L.latLng(o.latLngs.lat,o.latLngs.lng),n,{uuid:o.uuid,symbolName:o.symbolName})}}});L.supermap.plotting.plotMapManager=function(t,e,i){return new Mc(t,e,i)},L.supermap.plotting.PlotMapManager=Mc;var _c=L.Evented.extend({_map:null,effectType:null,uuid:null,createStatus:null,leftTopIcon:L.divIcon({className:"leaflet-supermap-plot-left-top-icon-path",iconSize:[15,15]}),rightTopIcon:L.divIcon({className:"leaflet-supermap-plot-right-top-icon-path",iconSize:[15,15]}),leftBottomIcon:L.divIcon({className:"leaflet-supermap-plot-left-bottom-icon-path",iconSize:[15,15]}),rightBottomIcon:L.divIcon({className:"leaflet-supermap-plot-right-bottom-icon-path",iconSize:[15,15]}),frames:[],initialize:function(t){t&&SuperMap.Util.extend(this,t),this._map=L.supermap.plotting.getControl().getSpecialEffectManager().map},getUuid:function(){return this.uuid},getType:function(){return this.effectType},_getFeature:function(t){return map.getFeatureByUuid(t)},_getPositionById:function(t){var e=this._map.getFeatureByUuid(t);return new L.latLng(e.latLngs[0].lat,e.latLngs[0].lng)},_canCreateSpecialEffect:function(t){if(!t||!this._map.getFeatureByUuid(t))return!0;var e=this._map.getFeatureByUuid(t).symbolType;return e==SuperMap.Plot.SymbolType.DOTSYMBOL||e==SuperMap.Plot.SymbolType.PICTURE||e==SuperMap.Plot.SymbolType.MODELPLOT},_selectedSpecialEffect:function(t){this._unSelectedSpecialEffect(),this._map.getPlotEditControl().unselectFeatures(this._map.getPlottingLayers()[0].features);var e=L.supermap.plotting.getControl().getSpecialEffectManager();this.isSelected=!0;var i=this._getBounds();if(i){this.frames=[];var o=L.latLng(i._northEast.lat,i._northEast.lng),n=L.latLng(i._northEast.lat,i._southWest.lng),l=L.latLng(i._southWest.lat,i._northEast.lng),s=L.latLng(i._southWest.lat,i._southWest.lng),a=L.supermap.plotting.editMarker(o,{icon:this.rightTopIcon,nHandle:-3}),r=L.supermap.plotting.editMarker(n,{icon:this.leftTopIcon,nHandle:-3}),u=L.supermap.plotting.editMarker(l,{icon:this.rightBottomIcon,nHandle:-3}),p=L.supermap.plotting.editMarker(s,{icon:this.leftBottomIcon,nHandle:-3});this.frames.push(a),this.frames.push(r),this.frames.push(u),this.frames.push(p);for(var h=0;h<this.frames.length;h++)this.frames[h].addTo(this._map);this._map.on("click",this._unSelectedSpecialEffect,this);for(var c=e.getSpecialEffectList(),y=0;y<c.length;y++)c[y].uuid!=this.uuid&&c[y]._unSelectedSpecialEffect();e.fire(SuperMap.Plot.Event.specialeffectselected,{specialEffect:this});switch(this.getType()){case SuperMap.Plot.SpecialEffectType.AIM:this.viewUuid;break;case SuperMap.Plot.SpecialEffectType.COMMUNICATION:this.senderUuid;break;default:this.associatedUuid}}else e.fire(SuperMap.Plot.Event.specialeffectselected,{specialEffect:this})},_getBounds:function(){var t;if(this._boundsFeature){if(this._boundsFeature instanceof Array)for(var e=0;e<this._boundsFeature.length;e++){var i=this._boundsFeature[e].getBounds();t?(i._northEast.lat>t._northEast.lat&&(t._northEast.lat=i._northEast.lat),i._northEast.lng>t._northEast.lng&&(t._northEast.lng=i._northEast.lng),i._southWest.lat<t._southWest.lat&&(t._southWest.lat=i._southWest.lat),i._southWest.lng<t._southWest.lng&&(t._southWest.lng=i._southWest.lng)):t=i}else if(this._boundsFeature instanceof HTMLElement){var o=this._left;if(0!=document.getElementsByClassName("leaflet-container").length){var n=document.getElementsByClassName("leaflet-container")[0].offsetLeft;o=this._left-n}var l=L.point(o+30,this._top-30),s=this._map.containerPointToLatLng(l),a=L.point(o-30,this._top+30),r=this._map.containerPointToLatLng(a);t={_northEast:{lat:s.lat,lng:s.lng},_southWest:{lat:r.lat,lng:r.lng}}}else t=this._boundsFeature.getBounds();return t}},_unSelectedSpecialEffect:function(){if(this.isSelected=!1,this.frames)for(var t=0;t<this.frames.length;t++)this._map.removeLayer(this.frames[t]);this.frames=[],this._map.off("click",this._unSelectedSpecialEffect,this),L.supermap.plotting.getControl().getSpecialEffectManager().fire(SuperMap.Plot.Event.specialeffectunselected,{specialEffect:this});var e="";switch(this.getType()){case SuperMap.Plot.SpecialEffectType.AIM:e=this.viewUuid;break;case SuperMap.Plot.SpecialEffectType.COMMUNICATION:e=this.senderUuid;break;default:e=this.associatedUuid}if(this._getFeature(e)&&this._getFeature(e).specialEffectComponents)for(var i=0;i<this._getFeature(e).specialEffectComponents.length;i++)this._getFeature(e).specialEffectComponents[i].uuid===this.uuid&&(this._getFeature(e).specialEffectComponents[i]=this)},_updateSelectedMarker:function(){if(this.isSelected){for(var t=0;t<this.frames.length;t++)this._map.removeLayer(this.frames[t]);this.frames=[];var e=this._getBounds();this.frames=[];var i=L.latLng(e._northEast.lat,e._northEast.lng),o=L.latLng(e._northEast.lat,e._southWest.lng),n=L.latLng(e._southWest.lat,e._northEast.lng),l=L.latLng(e._southWest.lat,e._southWest.lng),s=L.supermap.plotting.editMarker(i,{icon:this.rightTopIcon,nHandle:-3}),a=L.supermap.plotting.editMarker(o,{icon:this.leftTopIcon,nHandle:-3}),r=L.supermap.plotting.editMarker(n,{icon:this.rightBottomIcon,nHandle:-3}),u=L.supermap.plotting.editMarker(l,{icon:this.leftBottomIcon,nHandle:-3});this.frames.push(s),this.frames.push(a),this.frames.push(r),this.frames.push(u);for(var p=0;p<this.frames.length;p++)this.frames[p].addTo(this._map)}}});function Ac(t){"@babel/helpers - typeof";return(Ac="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tc(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,o)}return i}function xc(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Tc(Object(i),!0).forEach(function(e){Oc(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Tc(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function Oc(t,e,i){var o;return(e="symbol"==Ac(o=function(t,e){if("object"!=Ac(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Ac(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(e,"string"))?o:o+"")in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}L.supermap.plotting.BaseEffect=_c;var wc={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:10,ZERO_TOLERANCE:1e-4},Cc=L.Radar=_c.extend({associatedUuid:null,_position:null,style:{},period:null,startAngle:0,_currentAngle:null,loop:!0,radius:null,radiusUnit:0,name:"",_centerFeature:null,_circleFeature:null,_scanArray:null,initialize:function(t,e,i){if(_c.prototype.initialize.call(this),!this._canCreateSpecialEffect(t))return this.createStatus=!1,null;this.createStatus=!0,this._currentAngle=0,this._initStyle(),i&&SuperMap.Util.extend(this,i),i&&void 0!=i.period||(this.period=5),i&&void 0!=i.radius||(this.radiusUnit==SuperMap.Plot.RadiusUnitType.DEGREE?this.radius=5:this.radiusUnit==SuperMap.Plot.RadiusUnitType.PIXEL?this.radius=60:this.radius=600),this.radiusSelfDefine=this.radius,i&&void 0!=i.scanAngle||(this.scanAngle=1.0471975511965976),this.style.scanStyle.opacity=0,this._position=[0,0],null!=t&&""!=t?(this.associatedUuid=t,this._position=this._getPositionById(t),this._initEvent(t)):null!=e&&""!=e&&(this._position=new L.latLng(e.lat,e.lng)),this._calRadiusByUnit(),this._init(),this._addTo(this._map),this.uuid=SuperMap.Plot.PlottingUtil.generateUuid(),this.effectType=SuperMap.Plot.SpecialEffectType.SCANRADAR,this.play(),this.visible=!0,this.innerCircleVisible=!0;this._map.on("zoomstart",this._tempPause(),this),this._map.on("zoomend",this._tempPlay(),this),this.radiusUnit==SuperMap.Plot.RadiusUnitType.PIXEL?this.name="扫描雷达(像素圆)":this.radiusUnit==SuperMap.Plot.RadiusUnitType.METERS?this.name="扫描雷达(地理圆)":this.name="扫描雷达",this.enableEdit=!0,this.isSpecialEffect=!0,this.on("selectspecialeffect",this._selectedSpecialEffect,this),this.radiusUnit==SuperMap.Plot.RadiusUnitType.PIXEL&&this._map.on("zoomend",this._redrawCircle,this);var o=L.supermap.plotting.getControl().getSpecialEffectManager();null!=this.associatedUuid&&""!=this.associatedUuid?(this._getFeature(this.associatedUuid).fire("addSpecialEffect2Symbol",{specialEffect:this}),o.fire(SuperMap.Plot.Event.specialeffectadded)):o.fire("addSpecialEffect2Manager",this)},play:function(){if(!this.isPlay&&(this.isPlay=!0,this.isPauseStauts=!1,this._animation(),this._getFeature(this.associatedUuid)&&this._getFeature(this.associatedUuid).specialEffectComponents))for(var t=0;t<this._getFeature(this.associatedUuid).specialEffectComponents.length;t++)this._getFeature(this.associatedUuid).specialEffectComponents[t].uuid===this.uuid&&(this._getFeature(this.associatedUuid).specialEffectComponents[t]=this)},pause:function(){if(this.isPlay=!1,this.isPauseStauts=!0,window.cancelAnimationFrame(this.aId_),this.pauseAngle=this._currentAngle,this.aId_=null,this._getFeature(this.associatedUuid)&&this._getFeature(this.associatedUuid).specialEffectComponents)for(var t=0;t<this._getFeature(this.associatedUuid).specialEffectComponents.length;t++)this._getFeature(this.associatedUuid).specialEffectComponents[t].uuid===this.uuid&&(this._getFeature(this.associatedUuid).specialEffectComponents[t]=this)},remove:function(){this._offEvent(),this._centerFeature.remove(),this._circleFeature.remove();for(var t=0;t<this._scanArray.length;t++)this._scanArray[t].remove();this.fire("removeEffect",this),this._unSelectedSpecialEffect();var e=this._getFeature(this.associatedUuid);null!=e&&void 0!=e&&e.fire("removeSpecialEffectFromGeo",this)},getPosition:function(){return this._position},setLoop:function(t){this.loop=t},setStartAngle:function(t){this._currentAngle=t*Math.PI/180,this._renderArc(!0),this.startAngle=t*Math.PI/180,this.pauseAngle=null},setScanAngle:function(t){this.scanAngle=t*Math.PI/180,this._renderArc(!0)},setPeriod:function(t){this.period=t},setRadius:function(t){this.radius=t,this.radiusSelfDefine=this.radius,this._calRadiusByUnit(),this._renderArc(!0),this._renderCircle(!0),this._renderCenter(!0),this._updateSelectedMarker()},setRadiusUnitType:function(t){this.radiusUnit=t,this.setRadius(this.radius),t!=SuperMap.Plot.RadiusUnitType.PIXEL?this._map.off("zoomend",this._redrawCircle,this):(this._map.off("zoomend",this._redrawCircle,this),this._map.on("zoomend",this._redrawCircle,this))},setName:function(t){this.name=t},setVisible:function(t){if(this.visible=t,t){this._centerFeature.remove(),this._circleFeature.remove();for(var e=0;e<this._scanArray.length;e++)this._scanArray[e].remove();this._addTo(this.map)}else{this._centerFeature.remove(),this._circleFeature.remove();for(var i=0;i<this._scanArray.length;i++)this._scanArray[i].remove()}},setInnerCircleVisible:function(t){this.innerCircleVisible=t,t?(this._centerFeature.remove(),this._centerFeature.addTo(map)):this._centerFeature.remove()},setStyle:function(t){for(var e in t)switch(e){case"circleStyle":for(var i in this._circleFeature.setStyle(xc({},t[e])),t[e])this.style.circleStyle[i]=t[e][i];break;case"centerStyle":for(var o in this._centerFeature.setStyle(xc({},t[e])),t[e])this.style.centerStyle[o]=t[e][o];break;case"scanStyle":for(var n=this.style.scanStyle.fillOpacity,l=0;l<this._scanArray.length;l++){this._scanArray[l].setStyle(xc({},t[e]))}if(t[e].fillOpacity){n=t[e].fillOpacity;for(var s=0;s<this._scanArray.length;s++){this._scanArray[s].setStyle({fillOpacity:n})}}for(var a in t[e])this.style.scanStyle[a]=t[e][a]}},getJSONData:function(){return{uuid:this.uuid,type:SuperMap.Plot.SpecialEffectType.SCANRADAR,associatedUuid:this.associatedUuid,latLng:this._position,period:this.period,startAngle:180*this.startAngle/Math.PI,loop:this.loop,radius:this.radiusSelfDefine,radiusUnit:this.radiusUnit,style:this.style}},_init:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._renderArc(t),this._renderCircle(t),this._renderCenter(t)},_initStyle:function(){this.style={centerStyle:{fillColor:"#008B00",fillOpacity:.8,color:"#008B00",opacity:0,weight:2},circleStyle:{fillColor:"#76EE00",fillOpacity:.1,color:"#008B00",opacity:1,weight:1},scanStyle:{fillColor:"#7FFF00",fillOpacity:.5,opacity:0}}},_initEvent:function(t){var e=this._getFeature(t);e.on("latlngchanged",this._latlngEvent,this),e.on("featureremoved",this._removeEvent,this),e.on("featurevisiblechanged",this._visibleEvent,this),this._map.getPlotEditControl().on(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this)},_latlngEvent:function(t){if(this.associatedUuid){var e=t.feature.latLngs[0];this._updatePosition(e),this.isSelected&&this._unSelectedSpecialEffect()}},_removeEvent:function(t){this.associatedUuid&&this.remove()},_visibleEvent:function(t){this.associatedUuid&&("display"==t.target.style.display&&1==t.target.layer.visibility?this.setVisible(!0):this.setVisible(!1))},_offEvent:function(){var t=this._getFeature(this.associatedUuid);t&&(t.off("latlngchanged",this._latlngEvent,this),t.off("featureremoved",this._removeEvent,this),t.off("featurevisiblechanged",this._visibleEvent,this),this._map.getPlotEditControl()&&this._map.getPlotEditControl().off(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this))},_setAssociatedUuid:function(t){this.associatedUuid=t,this._initEvent(t)},_renderArc:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._scanArray){this._scanArray=[];var e=Ic(this._position,this.radius,this.radiusUnit,this._currentAngle-this.scanAngle,this._currentAngle,"arc");e.push(this._position);var i=L.polygon([e],xc(xc({},this.style.scanStyle),{},{smoothFactor:0})),o=Math.round(1e3*Math.random()).toString();i._eventParents={},i._eventParents[o]=this,this._scanArray.push(i)}for(var n=0;n<this._scanArray.length;n++){var l=this._scanArray[n];if(t){var s=Ic(this._position,this.radius,this.radiusUnit,this._currentAngle-this.scanAngle,this._currentAngle,"arc");s.push(this._position),l.setLatLngs([s]),l.setStyle(xc({},this.style.scanStyle))}}},_tempPause:function(){window.cancelAnimationFrame(this.aId_),this.pauseAngle=this._currentAngle,this.aId_=null},_tempPlay:function(){this.isPauseStauts||this._animation()},_calRadiusByUnit:function(){if(this.radiusUnit==SuperMap.Plot.RadiusUnitType.PIXEL){var t=this._map.latLngToContainerPoint(this._position);t.x=t.x+this.radius;var e=L.point([t.x,t.y]),i=this._map.containerPointToLatLng(e);this.radius=Math.sqrt(Math.pow(this._position.lat-i.lat,2)+Math.pow(this._position.lng-i.lng,2))}},_renderCenter:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._centerFeature){var e=Ic(this._position,this.radius/10,this.radiusUnit,0,wc.TWO_PI,"circle");this._centerFeature=L.polygon([e],xc(xc({},this.style.centerStyle),{},{smoothFactor:0}));var i=Math.round(1e3*Math.random()).toString();this._centerFeature._eventParents={},this._centerFeature._eventParents[i]=this}if(t){var o=Ic(this._position,this.radius/10,this.radiusUnit,0,wc.TWO_PI,"circle");this._centerFeature.setLatLngs([o]),this._centerFeature.setStyle(xc({},this.style.centerStyle))}},_renderCircle:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._circleFeature){var e=Ic(this._position,this.radius,this.radiusUnit,0,wc.TWO_PI,"circle");this._circleFeature=L.polygon([e],xc(xc({},this.style.circleStyle),{},{smoothFactor:0}));var i=Math.round(1e3*Math.random()).toString();this._circleFeature._eventParents={},this._circleFeature._eventParents[i]=this}if(t){var o=Ic(this._position,this.radius,this.radiusUnit,0,wc.TWO_PI,"circle");this._circleFeature.setLatLngs([o]),this._circleFeature.setStyle(xc({},this.style.circleStyle))}this._boundsFeature=this._circleFeature},_redrawCircle:function(){this.setRadius(this.radiusSelfDefine)},_animation:function(){var t=this;this.aId_&&(window.cancelAnimationFrame(this.aId_),this.aId_=null);var e=(new Date).getTime();!function i(){var o=((new Date).getTime()-e)/(1e3*t.period);if(o>1)t.loop?t._animation():t.pause();else{t._currentAngle=(null!=t.pauseAngle?t.pauseAngle:t.startAngle)+o*Math.PI*2,t._renderArc(!0),t.aId_=window.requestAnimationFrame(i);var n=t._getFeature(t.associatedUuid);n&&n.fire("updateSpecialEffect",t)}}()},_addTo:function(t){this.map=t,this._centerFeature.addTo(t),this._circleFeature.addTo(t);for(var e=0;e<this._scanArray.length;e++)this._scanArray[e].addTo(t);return this},_updatePosition:function(t){this._position=new L.latLng(t.lat,t.lng),this._renderArc(!0),this._renderCircle(!0),this._renderCenter(!0),this.isSelected&&this._updateSelectedMarker()}}),Ec=function(t,e,i){var o=new L.Radar(t,e,i);return o.createStatus?o:null};function Ic(t,e,i,o,n,l){var s,a,r=[],u=n-o;u=u<0?u+wc.TWO_PI:u;var p=wc.FITTING_COUNT;if(p="circle"==l?50:10,i==SuperMap.Plot.RadiusUnitType.METERS)for(var h=0;h<=p;h++){var c=180*(o+u*h/p)/Math.PI,y=Dc(t.lng,t.lat,c,e);r.push(y)}else for(var g=0;g<=p;g++){var f=o+u*g/p;s=t.lng+e*Math.cos(f),a=t.lat+e*Math.sin(f),r.push([a,s])}return r}function Dc(t,e,i,o){var n=i*(Math.PI/180),l=e*(Math.PI/180);return{lng:t+1e3*o*Math.sin(n)/(6371393*Math.cos(l)*Math.PI/180),lat:e+1e3*o*Math.cos(n)/(6371393*Math.PI/180)}}L.supermap.plotting.scanRadar=Ec,L.supermap.plotting.ScanRadar=Cc,L.Path.mergeOptions({dashSpeed:0});var Uc=L.Path.prototype.beforeAdd;L.Path.include({beforeAdd:function(t){Uc.bind(this)(t),this.options.dashSpeed&&(this._lastDashFrame=performance.now(),this._dashFrame=L.Util.requestAnimFrame(this._onDashFrame.bind(this)))},_onDashFrame:function(){if(this._renderer){var t=(performance.now()-this._lastDashFrame)*this.options.dashSpeed/1e3;this.options.dashOffset=Number(this.options.dashOffset||0)+t,this._renderer._updateStyle(this),this._lastDashFrame=performance.now(),this._dashFrame=L.Util.requestAnimFrame(this._onDashFrame.bind(this))}},_offDashFrame:function(){L.Util.cancelAnimFrame(this._dashFrame)},onRemove:function(){this._renderer._removePath(this),this._offDashFrame()}}),L.Canvas.include({_updateDashArray:function(t){if("string"==typeof t.options.dashArray){var e,i,o=t.options.dashArray.split(/[,]+/),n=[];for(i=0;i<o.length;i++){if(e=Number(o[i]),isNaN(e))return;n.push(e)}t.options._dashArray=n}else t.options._dashArray=t.options.dashArray;t.options.dashOffset&&(t.options._dashOffset=t.options.dashOffset)},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),e.options._dashArray?t.lineDashOffset=e.options._dashOffset:t.lineDashOffset=0,t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())}});var Rc=_c.extend({receiverUuid:null,senderUuid:null,dashSpeed:null,name:"",style:null,_movePath:null,_staticPath:null,_positionArr:null,hasRemoved:!0,initialize:function(t,e,i,o,n){_c.prototype.initialize.call(this);var l=this._canCreateSpecialEffect(t),s=this._canCreateSpecialEffect(e);if(!l||!s)return this.createStatus=!1,null;if(this.createStatus=!0,this.style={weight:4,movePathColor:"red",movePathOpacity:1,staticPathColor:"red",staticPathOpacity:.3,dashArray:"15,15"},n)for(var a in n)SuperMap.Util.extend(this[a],n[a]);if(n&&void 0!=n.dashSpeed?this.dashSpeed=n.dashSpeed:this.dashSpeed=30,this._positionArr=[],this.senderUuid=t,this.receiverUuid=e,null!=t&&""!=t&&null!=e&&""!=e){var r=this._getPositionById(t),u=this._getPositionById(e);this._positionArr.push(u),this._positionArr.push(r),this._initSenderEvent(t),this._initReceiverEvent(e)}else null!=i&&""!=i&&null!=o&&""!=o&&(this._positionArr.push(new L.latLng(o.lat,o.lng)),this._positionArr.push(new L.latLng(i.lat,i.lng)));this._init(),this.visible=!0,this.hasRemoved=!1,this.uuid=SuperMap.Plot.PlottingUtil.generateUuid(),this.effectType=SuperMap.Plot.SpecialEffectType.COMMUNICATIONLINK,this.name="通讯链路",this.enableEdit=!0,this.isSpecialEffect=!0,this.isPlay=!0,this.on("selectspecialeffect",this._selectedSpecialEffect,this);var p=L.supermap.plotting.getControl().getSpecialEffectManager();null!=this.senderUuid&&""!=this.senderUuid?this._getFeature(this.senderUuid).fire("addSpecialEffect2Symbol",{specialEffect:this}):p.fire("addSpecialEffect2Manager",this)},play:function(){this.isPlay=!0,this._movePath.setStyle({dashSpeed:this.dashSpeed})},pause:function(){this.isPlay=!1,this._movePath.setStyle({dashSpeed:0})},remove:function(){this._offSenderEvent(),this._offReceiverEvent(),this._movePath&&(this._movePath.remove(),this._movePath=null),this._staticPath&&(this._staticPath.remove(),this._staticPath=null),this.fire("removeEffect",this),this._unSelectedSpecialEffect();var t=this._getFeature(this.senderUuid);null!=t&&void 0!=t&&t.fire("removeSpecialEffectFromGeo",this),this.senderUuid=null,this.receiverUuid=null,this.hasRemoved=!0},getPosition:function(){return{sender:this._positionArr[1],receiver:this._positionArr[0]}},setDashSpeed:function(t){this.dashSpeed=t,this._movePath.setStyle({dashSpeed:t})},setName:function(t){this.name=t},setVisible:function(t){this.visible=t,t?(this._movePath&&this._movePath.remove(),this._staticPath&&this._staticPath.remove(),this._movePath.addTo(map),this._staticPath.addTo(map)):(this._movePath&&this._movePath.remove(),this._staticPath&&this._staticPath.remove())},setStyle:function(t){for(var e in t)switch(e){case"weight":var i=t[e]>2?t[e]:3;this._movePath.setStyle({weight:i-2}),this._staticPath.setStyle({weight:i}),this.style.weight=t[e];break;case"dashArray":this.style.dashArray=t[e],this._movePath.setStyle({dashArray:t[e]});break;case"movePathColor":this.style.movePathColor=t[e],this._movePath.setStyle({color:t[e]});break;case"movePathOpacity":this.style.movePathOpacity=t[e],this._movePath.setStyle({opacity:t[e]});break;case"staticPathColor":this.style.staticPathColor=t[e],this._staticPath.setStyle({color:t[e]});break;case"staticPathOpacity":this.style.staticPathOpacity=t[e],this._staticPath.setStyle({opacity:t[e]})}},getJSONData:function(){return{uuid:this.uuid,type:SuperMap.Plot.SpecialEffectType.COMMUNICATIONLINK,senderUuid:this.senderUuid,receiverUuid:this.receiverUuid,senderPt:this._positionArr?this._positionArr[1]:null,receiverPt:this._positionArr?this._positionArr[0]:null,dashSpeed:this.dashSpeed,style:this.style}},_init:function(){for(var t=[],e=0;e<this._positionArr.length;e++)t.push([this._positionArr[e].lat,this._positionArr[e].lng]);this._movePath=L.polyline(t,{dashArray:this.style.dashArray,dashSpeed:void 0!=this.dashSpeed?this.dashSpeed:-30,opacity:void 0!=this.style.movePathOpacity?this.style.movePathOpacity:1,weight:this.style.weight-2>0?this.style.weight-2:2,color:void 0!=this.style.movePathColor?this.style.movePathColor:"red"}).addTo(map);var i=Math.round(1e3*Math.random()).toString();this._movePath._eventParents={},this._movePath._eventParents[i]=this,this._boundsFeature=this._movePath,this._staticPath=L.polyline(t,{weight:this.style.weight?this.style.weight:4,color:this.style.staticPathColor?this.style.staticPathColor:"red",opacity:void 0!=this.style.staticPathOpacity?this.style.staticPathOpacity:.3}).addTo(map)},_initSenderEvent:function(t){var e=this._getFeature(t);e.on("latlngchanged",this._senderLatlngEvent,this),e.on("featureremoved",this._senderRemoveEvent,this),e.on("featurevisiblechanged",this._senderVisibleEvent,this),this._map.getPlotEditControl().on(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this)},_senderLatlngEvent:function(t){if(this.senderUuid){var e=t.feature.latLngs[0];this._updatePosition(e,0)}},_senderRemoveEvent:function(t){this.senderUuid&&this.remove()},_senderVisibleEvent:function(t){this.hasRemoved||this.senderUuid&&("display"==t.target.style.display&&1==t.target.layer.visibility?this.setVisible(!0):this.setVisible(!1))},_offSenderEvent:function(){var t=this._getFeature(this.senderUuid);t&&(t.off("latlngchanged",this._senderLatlngEvent,this),t.off("featureremoved",this._senderRemoveEvent,this),t.off("featurevisiblechanged",this._senderVisibleEvent,this),this._map.getPlotEditControl().off(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this))},_initReceiverEvent:function(t){var e=this._getFeature(t);e.on("latlngchanged",this._receiverLatlngEvent,this),e.on("featureremoved",this._receiverRemoveEvent,this),e.on("featurevisiblechanged",this._receiverVisibleEvent,this),this._map.getPlotEditControl().on(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this)},_receiverLatlngEvent:function(t){if(this.receiverUuid){var e=t.feature.latLngs[0];this._updatePosition(e,1)}},_receiverRemoveEvent:function(t){this.receiverUuid&&this.remove()},_receiverVisibleEvent:function(t){this.hasRemoved||this.receiverUuid&&("display"==t.target.style.display&&1==t.target.layer.visibility?this.setVisible(!0):this.setVisible(!1))},_offReceiverEvent:function(){var t=this._getFeature(this.receiverUuid);t&&(t.off("latlngchanged",this._receiverLatlngEvent,this),t.off("featureremoved",this._receiverRemoveEvent,this),t.off("featurevisiblechanged",this._receiverVisibleEvent,this),this._map.getPlotEditControl().off(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this))},_setAssociatedUuid:function(t,e){t&&(this.senderUuid=t,this._initSenderEvent(t)),e&&(this.receiverUuid=e,this._initReceiverEvent(e))},_updatePosition:function(t,e){var i=new L.latLng(t.lat,t.lng),o=this._movePath.getLatLngs(),n=this._staticPath.getLatLngs(),l=o.length-1-e;o[l]=[i.lat,i.lng],n[l]=[i.lat,i.lng],this._movePath.setLatLngs(o),this._staticPath.setLatLngs(n),this.isSelected&&this._updateSelectedMarker()}}),Nc=function(t,e,i,o,n){var l=new Rc(t,e,i,o,n);return l.createStatus?l:null};L.supermap.plotting.communicationLink=Nc,L.supermap.plotting.CommunicationLink=Rc;var Bc=_c.extend({aimUuid:null,viewUuid:null,style:null,loop:null,barkTimes:null,radius:null,radiusUnit:0,circle:null,name:"",_viewLine:null,_aimPosition:null,_viewPosition:null,_crosses:null,_isUpdate:!1,_timer:null,barkInterval:null,hasRemoved:!0,initialize:function(t,e,i,o,n){_c.prototype.initialize.call(this);var l=this._canCreateSpecialEffect(t),s=this._canCreateSpecialEffect(e);if(!l||!s)return this.createStatus=!1,null;this.createStatus=!0,n&&SuperMap.Util.extend(this,n),n&&n.style||(this.style={aimTargetColor:"#0dff00",aimLineColor:"#0dff00",aimLineWeight:2,aimLineOpacity:1,aimLineDashArray:"15,15"}),n&&void 0!=n.radius||(this.radiusUnit==SuperMap.Plot.RadiusUnitType.DEGREE?this.radius=2:this.radiusUnit==SuperMap.Plot.RadiusUnitType.PIXEL?this.radius=30:this.radius=300),this.radiusSelfDefine=this.radius,n&&void 0!=n.loop||(this.loop=!0),n&&n.barkTimes||(this.barkTimes=5),n&&n.barkInterval||(this.barkInterval=800),null!=e&&""!=e?(this.aimUuid=e,this._aimPosition=this._getPositionById(e),this._aimPosition=[this._aimPosition.lat,this._aimPosition.lng],this._initAimEvent(e)):null!=o&&""!=o&&(this._aimPosition=[o.lat,o.lng]),null!=t&&""!=t?(this.viewUuid=t,this._viewPosition=this._getPositionById(t),this._viewPosition=[this._viewPosition.lat,this._viewPosition.lng],this._initViewEvent(t)):null!=i&&""!=i&&(this._viewPosition=[i.lat,i.lng]),this._calRadiusByUnit(),this._crosses=[],this.className="dashLines"+Math.round(1e3*Math.random()).toString(),this._init(),this.visible=!0,this.hasRemoved=!1,this.uuid=SuperMap.Plot.PlottingUtil.generateUuid(),this.effectType=SuperMap.Plot.SpecialEffectType.AIM,this._addToMap(),this.showStatus=!0,this.barkIndex=0,this.visible=!0,this.play(),this.isPlay=!0,this.name="瞄准",this.enableEdit=!0,this.isSpecialEffect=!0,this.on("selectspecialeffect",this._selectedSpecialEffect,this),this.radiusUnit==SuperMap.Plot.RadiusUnitType.PIXEL&&this._map.on("zoomend",this._redrawAimCircle,this);var a=L.supermap.plotting.getControl().getSpecialEffectManager();null!=this.viewUuid&&""!=this.viewUuid?(this._getFeature(this.viewUuid).fire("addSpecialEffect2Symbol",{specialEffect:this}),a.fire(SuperMap.Plot.Event.specialeffectadded)):a.fire("addSpecialEffect2Manager",this)},play:function(){var t=this;if(this.isPlay=!0,null==this.timer&&(this._removeFromMap(),this._addToMap(),this.viewLine.setStyle({dashSpeed:0}),this.timer=setInterval(function(){if(t.barkIndex>=2*t.barkTimes&&!t.loop)return t.barkIndex=0,t._showAim(),clearInterval(t.timer),t.timer=null,t.visible||t.setVisible(!1),void(t.isPlay=!1);t.showStatus?(t._hideAim(),t.showStatus=!1):(t._showAim(),t.showStatus=!0),t.barkIndex++},this.barkInterval/2),this._getFeature(this.viewUuid)&&this._getFeature(this.viewUuid).specialEffectComponents))for(var e=0;e<this._getFeature(this.viewUuid).specialEffectComponents.length;e++)this._getFeature(this.viewUuid).specialEffectComponents[e].uuid===this.uuid&&(this._getFeature(this.viewUuid).specialEffectComponents[e]=this)},pause:function(){if(this.isPlay=!1,this.timer&&clearInterval(this.timer),this.showStatus&&this.barkIndex--,this.timer=null,this._getFeature(this.viewUuid)&&this._getFeature(this.viewUuid).specialEffectComponents)for(var t=0;t<this._getFeature(this.viewUuid).specialEffectComponents.length;t++)this._getFeature(this.viewUuid).specialEffectComponents[t].uuid===this.uuid&&(this._getFeature(this.viewUuid).specialEffectComponents[t]=this)},setLoop:function(t){this.loop=t},setBarkTimes:function(t){this.barkTimes=t},setBarkInterval:function(t){this.barkInterval=t,this._redrawAimCircle()},setRadius:function(t){var e=!1;if(this.isPlay&&(e=!0),this.pause(),this._removeFromMap(),this._crosses=[],this.circle=null,this.viewLine=null,this.radius=t,this.radiusSelfDefine=this.radius,this._calRadiusByUnit(),this._isUpdate=!0,this._init(),this._addToMap(),this._updateSelectedMarker(),e&&this.play(),this._getFeature(this.viewUuid)&&this._getFeature(this.viewUuid).specialEffectComponents)for(var i=0;i<this._getFeature(this.viewUuid).specialEffectComponents.length;i++)this._getFeature(this.viewUuid).specialEffectComponents[i].uuid===this.uuid&&(this._getFeature(this.viewUuid).specialEffectComponents[i]=this)},setRadiusUnitType:function(t){this.radiusUnit=t,this.setRadius(this.radius),t!=SuperMap.Plot.RadiusUnitType.PIXEL?this._map.off("zoomend",this._redrawAimCircle,this):(this._map.off("zoomend",this._redrawAimCircle,this),this._map.on("zoomend",this._redrawAimCircle,this))},setName:function(t){this.name=t},setVisible:function(t){this.visible=t,t?(this._removeFromMap(),this._addToMap()):(this.pause(),this._removeFromMap(),this._unSelectedSpecialEffect())},setStyle:function(t){for(var e in t)switch(e){case"aimTargetColor":this.circle.setStyle({color:t[e]}),this.style.aimTargetColor=t[e];for(var i=0;i<this._crosses.length;i++)this._crosses[i].setStyle({color:t[e]});break;case"aimLineColor":this.viewLine.setStyle({color:t[e]}),this.style.aimLineColor=t[e];break;case"aimLineWeight":this.viewLine.setStyle({weight:t[e]}),this.style.aimLineWeight=t[e];break;case"aimLineOpacity":this.viewLine.setStyle({opacity:t[e]}),this.style.aimLineOpacity=t[e];break;case"aimLineDashArray":this.viewLine.setStyle({dashArray:t[e]}),this.style.aimLineDashArray=t[e]}},getJSONData:function(){return{uuid:this.uuid,type:SuperMap.Plot.SpecialEffectType.AIM,viewUuid:this.viewUuid,aimUuid:this.aimUuid,viewPt:this._viewPosition,aimPt:this._aimPosition,loop:this.loop,barkTimes:this.barkTimes,radius:this.radiusSelfDefine,radiusUnit:this.radiusUnit,style:this.style}},_init:function(){if(this.radiusUnit==SuperMap.Plot.RadiusUnitType.DEGREE||this.radiusUnit==SuperMap.Plot.RadiusUnitType.PIXEL){var t=function(t,e,i,o){var n,l,s=[],a=o-i;a=a<0?a+2*Math.PI:a;for(var r=0;r<=300;r++){var u=i+a*r/300;n=t[1]+e*Math.cos(u),l=t[0]+e*Math.sin(u),s.push([l,n])}return s}(this._aimPosition,this.radius,0,2*Math.PI);this.circle=L.polygon([t],{fillOpacity:0,color:this.style.aimTargetColor,opacity:1,smoothFactor:0})}else{var e=new L.latLng(this._aimPosition[0],this._aimPosition[1]);this.circle=L.circle(e,this.radius)}this._boundsFeature=this.circle;var i=Math.round(1e3*Math.random()).toString();this.circle._eventParents={},this.circle._eventParents[i]=this;var o=this.radius*(2*Math.PI*6371004)/360;this._createCross(0,o),this._createCross(90,o),this._createCross(180,o),this._createCross(270,o);var n=[[this._aimPosition[0],this._aimPosition[1]],[this._viewPosition[0],this._viewPosition[1]]];this.viewLine=L.polyline(n,{dashArray:this.style.aimLineDashArray,dashSpeed:0,weight:this.style.aimLineWeight,color:this.style.aimLineColor,opacity:this.style.aimLineOpacity}),this.viewLine._eventParents={},this.viewLine._eventParents[i]=this},_initAimEvent:function(t){var e=this._getFeature(t);e.on("latlngchanged",this._aimLatlngEvent,this),e.on("featureremoved",this._aimRemoveEvent,this),e.on("featurevisiblechanged",this._aimVisibleEvent,this),this._map.getPlotEditControl().on(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this)},_aimLatlngEvent:function(t){if(this.aimUuid){var e=t.feature.latLngs[0];this._updatePosition(e,"aim")}},_aimRemoveEvent:function(t){this.aimUuid&&this.remove()},_aimVisibleEvent:function(t){this.aimUuid&&("display"==t.target.style.display&&1==t.target.layer.visibility?this.setVisible(!0):this.setVisible(!1))},_offAimEvent:function(){var t=this._getFeature(this.aimUuid);t&&(t.off("latlngchanged",this._aimLatlngEvent,this),t.off("featureremoved",this._aimRemoveEvent,this),t.off("featurevisiblechanged",this._aimVisibleEvent,this),this._map.getPlotEditControl().off(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this))},_initViewEvent:function(t){var e=this._getFeature(t);e.on("latlngchanged",this._viewLatlngEvent,this),e.on("featureremoved",this._viewRemoveEvent,this),e.on("featurevisiblechanged",this._viewVisibleEvent,this),this._map.getPlotEditControl().on(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this)},_viewLatlngEvent:function(t){if(this.viewUuid){var e=t.feature.latLngs[0];this._updatePosition(e,"view")}},_viewRemoveEvent:function(t){this.viewUuid&&this.remove()},_viewVisibleEvent:function(t){this.viewUuid&&("display"==t.target.style.display&&1==t.target.layer.visibility?this.setVisible(!0):this.setVisible(!1))},_offViewEvent:function(){var t=this._getFeature(this.viewUuid);t&&(t.off("latlngchanged",this._viewLatlngEvent,this),t.off("featureremoved",this._viewRemoveEvent,this),t.off("featurevisiblechanged",this._viewVisibleEvent,this),this._map.getPlotEditControl().off(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this))},_removeFromMap:function(){this._map.removeLayer(this.circle),this._map.removeLayer(this.viewLine);for(var t=0;t<this._crosses.length;t++)this._map.removeLayer(this._crosses[t])},_redrawAimCircle:function(){this.hasRemoved||(this.hasDownRedraw=!0,this.visible&&this.isPlay&&this.setRadius(this.radiusSelfDefine))},_calRadiusByUnit:function(){if(this.radiusUnit==SuperMap.Plot.RadiusUnitType.PIXEL){var t=new L.latLng(this._aimPosition[0],this._aimPosition[1]),e=this._map.latLngToContainerPoint(t);e.x=e.x+this.radius;var i=L.point([e.x,e.y]),o=this._map.containerPointToLatLng(i);this.radius=Math.sqrt(Math.pow(t.lat-o.lat,2)+Math.pow(t.lng-o.lng,2))}},_setAssociatedUuid:function(t,e){t&&(this.viewUuid=t,this._initViewEvent(t)),e&&(this.aimUuid=e,this._initAimEvent(e))},_getLonAndLat:function(t,e,i,o){for(var n=6378137,l=6356752.3142,s=1/298.257223563,a=1*t,r=1*e,u=o,p=i*(Math.PI/180),h=Math.sin(p),c=Math.cos(p),y=(1-s)*Math.tan(r*(Math.PI/180)),g=1/Math.sqrt(1+y*y),f=y*g,d=Math.atan2(y,c),m=g*h,S=1-m*m,P=S*(n*n-l*l)/(l*l),b=1+P/16384*(4096+P*(P*(320-175*P)-768)),v=P/1024*(256+P*(P*(74-47*P)-128)),L=u/(l*b),M=2*Math.PI;Math.abs(L-M)>1e-12;){var _=Math.cos(2*d+L),A=Math.sin(L),T=Math.cos(L);M=L,L=u/(l*b)+v*A*(_+v/4*(T*(2*_*_-1)-v/6*_*(4*A*A-3)*(4*_*_-3)))}var x=f*A-g*T*c,O=Math.atan2(f*T+g*A*c,(1-s)*Math.sqrt(m*m+x*x)),w=s/16*S*(4+s*(4-3*S));return{lng:a+(Math.atan2(A*m,g*T-f*A*c)-(1-w)*s*m*(L+w*A*(_+w*T*(2*_*_-1))))*(180/Math.PI),lat:O*(180/Math.PI)}},_createCross:function(t,e){var i=this._getLonAndLat(this._aimPosition[1],this._aimPosition[0],t,e),o=this._getLonAndLat(this._aimPosition[1],this._aimPosition[0],t,e/2),n=[[i.lat,i.lng],[o.lat,o.lng]],l=L.polyline(n,{weight:4,color:this.style.aimTargetColor});l.options.interactive=!1,this._crosses.push(l)},_disToPixelDistance:function(t){var e=L.GeometryUtil.destination(map.getCenter(),90,t),i=map.latLngToContainerPoint(map.getCenter()),o=map.latLngToContainerPoint(e);return i.distanceTo(o)},_addToMap:function(){this.circle.addTo(map);for(var t=0;t<this._crosses.length;t++)this._crosses[t].addTo(map);this.viewLine.addTo(map)},_hideAim:function(){this.circle.setStyle({opacity:1});for(var t=0;t<this._crosses.length;t++)this._crosses[t].setStyle({opacity:1})},_showAim:function(){this.circle.setStyle({opacity:0});for(var t=0;t<this._crosses.length;t++)this._crosses[t].setStyle({opacity:0})},_updatePosition:function(t,e){if("none"!=this._getFeature(this.viewUuid).style.display){var i=new L.latLng(t.lat,t.lng);if("aim"===e)this._isUpdate=!0,this._clear(),this._aimPosition=[i.lat,i.lng],this._init(),this._addToMap();else if("view"===e){this.viewLine.remove(),this._viewPosition=[i.lat,i.lng];var o=[[this._aimPosition[0],this._aimPosition[1]],[this._viewPosition[0],this._viewPosition[1]]];this.viewLine=L.polyline(o,{dashArray:this.style.aimLineDashArray,dashSpeed:0,weight:this.style.aimLineWeight,color:this.style.aimLineColor,opacity:this.style.aimLineOpacity}),this.viewLine.addTo(map)}this.isSelected&&this._updateSelectedMarker()}},_clear:function(){this.circle.remove(),this.viewLine.remove();for(var t=0;t<this._crosses.length;t++)this._crosses[t].remove();this.circle=null,this.viewLine=null,this._crosses.splice(0,this._crosses.length),this._isUpdate||this.fire("removeEffect",this),this._isUpdate=!1},remove:function(){var t=this._getFeature(this.viewUuid);if(this._map.off("zoomend",this._redrawAimCircle),this.pause(),this._offAimEvent(),this._offViewEvent(),this.circle&&this.circle.remove(),this.viewLine&&this.viewLine.remove(),this._crosses&&0!=this._crosses.length)for(var e=0;e<this._crosses.length;e++)this._crosses[e].remove();this.circle=null,this.viewLine=null,this._crosses&&0!=this._crosses.length&&this._crosses.splice(0,this._crosses.length),this._isUpdate||this.fire("removeEffect",this),this._isUpdate=!1,this._unSelectedSpecialEffect(),null!=t&&void 0!=t&&t.fire("removeSpecialEffectFromGeo",this),this.hasRemoved=!0},getPosition:function(){return{view:this._viewPosition,aim:this._aimPosition}}});var kc=function(t,e,i,o,n){var l=new Bc(t,e,i,o,n);return l.createStatus?l:null};L.supermap.plotting.aim=kc,L.supermap.plotting.Aim=Bc;var Fc=function(){for(var t="iclient-plot-leaflet",e=document.getElementsByTagName("script"),i=0;i<e.length;i++){var o=e[i];if(o.src.indexOf(t)>-1){for(var n=o.src.split("/"),l=0;l<n.length;l++)n[l].indexOf(t)>-1&&(t=n[l]);var s=o.src.replace(t,"");return s}}}();var jc=_c.extend({associatedUuid:null,boomTimes:null,name:"",_img:null,_imgs:[Fc+"images/explode/e1.gif",Fc+"images/explode/e2.gif",Fc+"images/explode/e3.gif",Fc+"images/explode/e4.gif",Fc+"images/explode/e5.gif",Fc+"images/explode/e6.gif",Fc+"images/explode/e7.gif",Fc+"images/explode/e8.gif",Fc+"images/explode/e9.gif",Fc+"images/explode/e10.gif",Fc+"images/explode/e11.gif",Fc+"images/explode/e12.gif",Fc+"images/explode/e13.gif",Fc+"images/explode/e14.gif",Fc+"images/explode/e15.gif",Fc+"images/explode/e16.gif"],_imgIndex:0,_timer:null,_left:null,_top:null,_loopIndex:0,loop:!1,_boomPosition:null,initialize:function(t,e,i){if(_c.prototype.initialize.call(this),!this._canCreateSpecialEffect(t))return this.createStatus=!1,null;this.createStatus=!0,i&&SuperMap.Util.extend(this,i),null!=t&&""!=t?(this.associatedUuid=t,this._boomPosition=this._getPositionById(t),this._initEvent(t)):null!=e&&""!=e&&(this._boomPosition=new L.latLng(e.lat,e.lng)),i&&void 0!=i.boomTimes||(this.boomTimes=2),i&&void 0!=i.loop||(this.loop=!1),this._init(),this.visible=!0,this.uuid=SuperMap.Plot.PlottingUtil.generateUuid(),this.effectType=SuperMap.Plot.SpecialEffectType.BOOM,this.play(),this.name="爆炸",this.enableEdit=!0,this.isSpecialEffect=!0;var o=L.supermap.plotting.getControl().getSpecialEffectManager();null!=this.associatedUuid&&""!=this.associatedUuid?(this._getFeature(this.associatedUuid).fire("addSpecialEffect2Symbol",{specialEffect:this}),o.fire(SuperMap.Plot.Event.specialeffectadded)):o.fire("addSpecialEffect2Manager",this)},play:function(){var t=this;this.isPlay=!0,this._timer&&clearInterval(this._timer),this._setVisibleTimer&&(clearInterval(this._setVisibleTimer),this._setVisibleTimer=void 0),this._timer=setInterval(function(){t._img.style.display="",t._loopIndex>t.boomTimes-1&&!t.loop?(t._loopIndex=0,t._img.style.display="none",t._img.src=t._imgs[6],clearInterval(t._timer),t._setVisibleTimer||t._watchMapContainer()):t._carouselPic()},20)},pause:function(){this.isPlay=!1,this._timer&&clearInterval(this._timer),this._timer=null,this._setVisibleTimer||this._watchMapContainer()},remove:function(){this._offEvent(),this._map.off("zoomend",this._updateBoomPosition),this._img.remove(),this._timer&&clearInterval(this._timer),clearInterval(this._setVisibleTimer),this._setVisibleTimer=void 0,this.fire("removeEffect",this),this._unSelectedSpecialEffect();var t=this._getFeature(this.associatedUuid);null!=t&&void 0!=t&&t.fire("removeSpecialEffectFromGeo",this)},getPosition:function(){return this._boomPosition},setBoomTimes:function(t){this.boomTimes=t},setLoop:function(t){this.loop=t},setName:function(t){this.name=t},setVisible:function(t){this.visible=t,t?(this._img.style.display="display",this.play()):(this.pause(),this._img.style.display="none")},getJSONData:function(){return{uuid:this.uuid,type:SuperMap.Plot.SpecialEffectType.BOOM,associatedUuid:this.associatedUuid,latLng:this._boomPosition,loop:this.loop,boomTimes:this.boomTimes}},_init:function(){var t=map.latLngToContainerPoint(this._boomPosition),e=document.body;if(this._img=document.createElement("img"),this._img.src="",this._img.style.position="absolute",this._img.style.zIndex=9999,this._left=t.x,this._top=t.y,0!=document.getElementsByClassName("leaflet-container").length){var i=document.getElementsByClassName("leaflet-container")[0].offsetLeft;this._left=this._left+i}this._boundsFeature=this._img,this._img.addEventListener("click",this._selectedSpecialEffect.bind(this)),e.appendChild(this._img),this._map.on("zoomend",this._updateBoomPosition.bind(this)),this._map.on("moveend",this._updateBoomPosition.bind(this))},_initEvent:function(t){var e=this._getFeature(t);e.on("latlngchanged",this._latlngEvent,this),e.on("featureremoved",this._removeEvent,this),e.on("featurevisiblechanged",this._visibleEvent,this),this._map.getPlotEditControl().on(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this)},_latlngEvent:function(t){if(this.associatedUuid){var e=t.feature.latLngs[0];this._updatePosition(e)}},_removeEvent:function(t){this.associatedUuid&&this.remove()},_visibleEvent:function(t){this.associatedUuid&&(this.isPlay||("display"==t.target.style.display&&1==t.target.layer.visibility?this.setVisible(!0):this.setVisible(!1)))},_offEvent:function(){var t=this._getFeature(this.associatedUuid);t&&(t.off("latlngchanged",this._latlngEvent,this),t.off("featureremoved",this._removeEvent,this),t.off("featurevisiblechanged",this._visibleEvent,this),this._map.getPlotEditControl().off(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this))},_watchMapContainer:function(){var t=this;this._setVisibleTimer=setInterval(function(){0==t._map._container.getClientRects().length?(t.visible&&void 0==t.beforeInVisible&&(t.beforeInVisible=!0),t.setVisible(!1)):1==t._map._container.getClientRects().length&&t.beforeInVisible&&(t.beforeInVisible=void 0,t.setVisible(!0))},20)},_setAssociatedUuid:function(t){this.associatedUuid=t,this._initEvent(t)},_updateBoomPosition:function(){var t=map.latLngToContainerPoint(this._boomPosition);if(this._left=t.x,this._top=t.y,0!=document.getElementsByClassName("leaflet-container").length){var e=document.getElementsByClassName("leaflet-container")[0].offsetLeft;this._left=this._left+e}this._img.style.left=this._left-this._img.width/2+"px",this._img.style.top=this._top-this._img.height/2+"px"},_updatePosition:function(t){this._boomPosition=new L.latLng(t.lat,t.lng),this._updateBoomPosition(),this.isSelected&&this._updateSelectedMarker()},_carouselPic:function(){this._imgIndex++,this._imgIndex>15&&(this._imgIndex=0,this._loopIndex++),this._img.src=this._imgs[this._imgIndex],this._img.style.left=this._left-this._img.width/2+"px",this._img.style.top=this._top-this._img.height/2+"px"}}),Vc=function(t,e,i){var o=new jc(t,e,i);return o.createStatus?o:null};L.supermap.plotting.boom=Vc,L.supermap.plotting.Boom=jc;var zc=_c.extend({associatedUuid:null,name:"",_map:null,_model:null,_timer:null,durationTime:null,_currentDuration:0,initialize:function(t,e){var i=this;if(_c.prototype.initialize.call(this),!this._canCreateSpecialEffect(t))return this.createStatus=!1,null;this.createStatus=!0,e&&SuperMap.Util.extend(this,e),e&&void 0!=e.durationTime||(this.durationTime=1e3),this.associatedUuid=t,this._model=this._map.getFeatureByUuid(t),this.uuid=SuperMap.Plot.PlottingUtil.generateUuid(),this.effectType=SuperMap.Plot.SpecialEffectType.DESTROY,this.play(),this.visible=!0,this.dRotate=0,this.name="摧毁",this.enableEdit=!0;var o=L.supermap.plotting.getControl().getSpecialEffectManager();null!=this.associatedUuid&&""!=this.associatedUuid?setTimeout(function(){i._getFeature(i.associatedUuid).fire("addSpecialEffect2Symbol",{specialEffect:i}),o.fire(SuperMap.Plot.Event.specialeffectadded)},100):o.fire("addSpecialEffect2Manager",this)},play:function(){var t=this;this.isPlay=!0,window.fromDestroyPlaySetStyle=!0,this._timer&&clearInterval(this._timer);var e=1;this._model||(this._model=this._getFeature(this.associatedUuid)),this._model&&(this._model.style.display="display",this._model.setStyle(this._model.style),this._timer=setInterval(function(){if(t.durationTime<t._currentDuration)return t._currentDuration=0,t._model.style.display="none",t.visible=!1,t._model.setStyle(t._model.style),t._model.setRotate(0),t._map._plotEditControl.unselectFeatures(t._map.getFeatureByUuid(t.associatedUuid)),window.fromDestroyPlaySetStyle=!1,void clearInterval(t._timer);t.dRotate=t.dRotate+10,t.dRotate>360&&(t.dRotate=0),t._model.setRotate(t.dRotate),t.durationTime-t._currentDuration<=2e3&&(e++,t._model.style.graphicOpacity=(100-e)/100,t._model.setStyle(t._model.style)),t._currentDuration+=20},20))},setName:function(t){this.name=t},setVisible:function(t){this.visible=t;var e=this._getFeature(this.associatedUuid);t?(e.style.display="display",window.fromDestroyPlaySetStyle=!0,e.setStyle(e.style)):(e.style.display="none",window.fromDestroyPlaySetStyle=!0,e.setStyle(e.style))},pause:function(){this.isPlay=!1,this._timer&&clearInterval(this._timer),this._timer=null,this._model||(this._model=this._getFeature(this.associatedUuid)),this._model&&"none"==this._model.style.display&&(window.fromDestroyPlaySetStyle=!0,this._model.style.display="display",this._model.setStyle(this._model.style))},getPosition:function(){return this._model.latLngs[0]},setDurationTime:function(t){this.durationTime=t},remove:function(){this._model.setRotate(0),window.fromDestroyPlaySetStyle=!0,this._model.setStyle({display:"display"}),this._timer&&clearInterval(this._timer),this.fire("removeEffect",this);var t=this._getFeature(this.associatedUuid);null!=t&&void 0!=t&&t.fire("removeSpecialEffectFromGeo",this)},getJSONData:function(){return{uuid:this.uuid,type:SuperMap.Plot.SpecialEffectType.DESTROY,associatedUuid:this.associatedUuid,durationTime:this.durationTime}}});function Yc(t){"@babel/helpers - typeof";return(Yc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gc(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,o)}return i}function Wc(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Gc(Object(i),!0).forEach(function(e){Xc(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Gc(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function Xc(t,e,i){var o;return(e="symbol"==Yc(o=function(t,e){if("object"!=Yc(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Yc(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(e,"string"))?o:o+"")in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}L.supermap.plotting.destroy=function(t,e){var i=new zc(t,e);return i.createStatus?i:null},L.supermap.plotting.Destroy=zc;var Hc={TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,FITTING_COUNT:300,ZERO_TOLERANCE:1e-4},Zc=_c.extend({associatedUuid:null,style:{},scanStyle:{},_position:null,radius:null,radiusUnit:SuperMap.Plot.RadiusUnitType.DEGREE,startAngle:null,angle:null,period:2,_isUpdate:!1,timer:null,isPlay:!1,name:"",hasRemoved:!0,_selfDefineTowardAngle:!0,initialize:function(t,e,i){if(_c.prototype.initialize.call(this),!this._canCreateSpecialEffect(t))return this.createStatus=!1,null;this.createStatus=!0,i&&SuperMap.Util.extend(this,i),this.style={fillColor:"#87CEEB",fillOpacity:.4,color:"#4169e1",opacity:1,weight:1},this.scanStyle={fillColor:"#00bfff",fillOpacity:.7,color:"#00bfff",opacity:.1},i&&i.style&&SuperMap.Util.extend(this.style,i.style),i&&i.scanStyle&&SuperMap.Util.extend(this.scanStyle,i.scanStyle),i&&i.radius||(this.radiusUnit==SuperMap.Plot.RadiusUnitType.DEGREE?this.radius=5:this.radiusUnit==SuperMap.Plot.RadiusUnitType.PIXEL?this.radius=60:this.radius=600),this.radiusSelfDefine=this.radius,i&&void 0!=i.startAngle||(this.startAngle=90),i&&void 0!=i.angle||(this.angle=40),i&&void 0!=i.scanAngle||(this.scanAngle=this.angle/5),this.points=[0,0];if(null!=t&&""!=t?(this.associatedUuid=t,this._position=this._getPositionById(t),this._initEvent(t)):null!=e&&""!=e&&(this._position=new L.latLng(e.lat,e.lng)),this._calRadiusByUnit(),!this.associatedUuid||i&&void 0!=i.towardsAngle&&null!=i.towardsAngle)this.towardsAngle=i.towardsAngle?i.towardsAngle+90:90,this.towardsAngle>360&&(this.towardsAngle=this.towardsAngle-360),this._selfDefineTowardAngle=!0;else{var o=this._map.getFeatureByUuid(this.associatedUuid).getRotate();this._initTowardsAngle(o),this._selfDefineTowardAngle=!1}this.startAngle=(this.towardsAngle+this.angle/2)*Math.PI/180,this.rotateAngle=this.startAngle,this.angle=this.angle*Math.PI/180,this.scanAngle=this.scanAngle*Math.PI/180,this._init(),this._addTo(this._map);this._map.on("zoomstart",this._tempPause(),this),this._map.on("zoomend",this._tempPlay(),this),this.uuid=SuperMap.Plot.PlottingUtil.generateUuid(),this.effectType=SuperMap.Plot.SpecialEffectType.SECTORDETECTIONRANGE,this.visible=!0,this.isPlay=!1,this.hasRemoved=!1,this.play(),this.name="扇形扫描",this.enableEdit=!0,this.isSpecialEffect=!0,this.on("selectspecialeffect",this._selectedSpecialEffect,this),this.radiusUnit==SuperMap.Plot.RadiusUnitType.PIXEL&&this._map.on("zoomend",this._redrawAimCircle,this);var n=L.supermap.plotting.getControl().getSpecialEffectManager();null!=this.associatedUuid&&""!=this.associatedUuid?(this._getFeature(this.associatedUuid).fire("addSpecialEffect2Symbol",{specialEffect:this}),n.fire(SuperMap.Plot.Event.specialeffectadded)):n.fire("addSpecialEffect2Manager",this)},play:function(){if(!this.isPlay&&(this.isPlay=!0,this._animation(),this._getFeature(this.associatedUuid)&&this._getFeature(this.associatedUuid).specialEffectComponents))for(var t=0;t<this._getFeature(this.associatedUuid).specialEffectComponents.length;t++)this._getFeature(this.associatedUuid).specialEffectComponents[t].uuid===this.uuid&&(this._getFeature(this.associatedUuid).specialEffectComponents[t]=this)},_animation:function(){var t=this;this.aId_&&window.cancelAnimationFrame(this.aId_);var e=(new Date).getTime(),i=(this.angle-this.scanAngle)/this.angle;!function o(){var n=((new Date).getTime()-e)/(1e3*t.period),l=n;if(l=null!=t.ratio?n+t.ratio:n,t.ratioTemp=l,l>i)return t.pauseAngle=null,t.ratio=null,"clockWise"==t.direction?t.direction="unclockWise":t.direction="clockWise",void t._animation();"clockWise"==t.direction?t.rotateAngle=t.startAngle-l*t.angle:t.rotateAngle=t.startAngle-t.angle+t.scanAngle+l*t.angle,t._renderScanArc(!0),t.aId_=window.requestAnimationFrame(o);var s=t._getFeature(t.associatedUuid);s&&s.fire("updateSpecialEffect",t)}()},pause:function(){if(this.isPlay=!1,window.cancelAnimationFrame(this.aId_),this.aId_=null,this.pauseAngle=this.rotateAngle,this.ratio=this.ratioTemp,this._getFeature(this.associatedUuid)&&this._getFeature(this.associatedUuid).specialEffectComponents)for(var t=0;t<this._getFeature(this.associatedUuid).specialEffectComponents.length;t++)this._getFeature(this.associatedUuid).specialEffectComponents[t].uuid===this.uuid&&(this._getFeature(this.associatedUuid).specialEffectComponents[t]=this)},getPosition:function(){return this._position},setRadius:function(t){this.radius=t,this.radiusSelfDefine=this.radius;var e=!1;this.isPlay&&(e=!0);var i=!1;this.isSelected&&(i=!0),this._calRadiusByUnit(),this._isUpdate=!0,this.pause(),this._clear(),this._renderArc(!1),this._renderScanArc(!1),this._addTo(this._map),e&&this._animation(),this.isSelected=i,this._updateSelectedMarker(),e&&this.play()},setRadiusUnitType:function(t){this.radiusUnit=t,this.setRadius(this.radius),t!=SuperMap.Plot.RadiusUnitType.PIXEL?this._map.off("zoomend",this._redrawAimCircle,this):(this._map.off("zoomend",this._redrawAimCircle,this),this._map.on("zoomend",this._redrawAimCircle,this))},setAngle:function(t){this.startAngle=(this.towardsAngle+t/2)*Math.PI/180,this.angle=t*Math.PI/180,this._isUpdate=!0;var e=!1;this.isPlay&&(e=!0);var i=!1;this.isSelected&&(i=!0),this.pause(),this._clear(),this._renderArc(!1),this._renderScanArc(!1),this._addTo(this._map),e&&this._animation(),this.isSelected=i,this._updateSelectedMarker(),e&&this.play()},setScanAngle:function(t){if(!(t>180*this.angle/Math.PI/2)){this.scanAngle=t*Math.PI/180,this._isUpdate=!0;var e=!1;this.isPlay&&(e=!0);var i=!1;this.isSelected&&(i=!0),this.pause(),this._clear(),this._renderArc(!1),this._renderScanArc(!1),this._addTo(this._map),e&&this._animation(),this.isSelected=i,this._updateSelectedMarker(),e&&this.play()}},setName:function(t){this.name=t},setVisible:function(t){if(this.visible=t,t){for(var e=0;e<this.arcFeatures_.length;e++)this.arcFeatures_[e].remove();this.scanFeature_.remove(),this._addTo(this._map)}else{for(var i=0;i<this.arcFeatures_.length;i++)this.arcFeatures_[i].remove();this.scanFeature_.remove()}},setStyle:function(t){for(var e in t)this.style[e]=t[e];for(var i=0;i<this.arcFeatures_.length;i++){var o=this.arcFeatures_[i],n=qc(this._position,this.radius,this.radiusUnit,this.startAngle-this.angle,this.startAngle);n.push(this._position),o.setLatLngs([n]),o.setStyle(Wc({},this.style))}},setScanStyle:function(t){for(var e in t)this.scanStyle[e]=t[e];this.scanFeature_.setStyle(Wc({},t))},remove:function(){this._offEvent(),this._map.off("zoomend",this._redrawAimCircle,this);for(var t=0;t<this.arcFeatures_.length;t++)this.arcFeatures_[t].remove();this.arcFeatures_=null,this.aId_&&window.cancelAnimationFrame(this.aId_),this.scanFeature_.remove(),this.scanFeature_=null,this._isUpdate||this.fire("removeEffect",this),this._isUpdate=!1,this.enableEdit=!0,this.isSpecialEffect=!0,this.on("selectspecialeffect",this._selectedSpecialEffect,this),this._unSelectedSpecialEffect();var e=this._getFeature(this.associatedUuid);null!=e&&void 0!=e&&e.fire("removeSpecialEffectFromGeo",this),this.hasRemoved=!0},_clear:function(){for(var t=0;t<this.arcFeatures_.length;t++)this.arcFeatures_[t].remove();this.arcFeatures_=null,this.aId_&&window.cancelAnimationFrame(this.aId_),this.scanFeature_.remove(),this.scanFeature_=null,this._isUpdate||this.fire("removeEffect",this),this._isUpdate=!1;var e=this;this._map.off("zoomstart",function(){e.pause()}),this._map.off("zoomend",function(){e.play()}),this.enableEdit=!0,this.isSpecialEffect=!0,this.on("selectspecialeffect",this._selectedSpecialEffect,this),this.isSelected&&this._unSelectedSpecialEffect()},getJSONData:function(){return{uuid:this.uuid,type:SuperMap.Plot.SpecialEffectType.SECTORDETECTIONRANGE,associatedUuid:this.associatedUuid,latLng:this._position,angle:180*this.angle/Math.PI,radius:this.radiusSelfDefine,radiusUnit:this.radiusUnit,towardsAngle:this.towardsAngle-90,style:this.style,scanStyle:this.scanStyle}},_init:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._renderArc(t),this._renderScanArc(t)},_initTowardsAngle:function(t){t>=0&&t<270?this.towardsAngle=t+90:t>=270&&t<=360?this.towardsAngle=t-270:t<0&&t>-270?this.towardsAngle=t+90:t<=-270&&t>=-360&&(this.towardsAngle=t-270)},_initEvent:function(t){var e=this._getFeature(t);e.on("latlngchanged",this._latlngEvent,this),e.on("featureremoved",this._removeEvent,this),e.on("featurevisiblechanged",this._visibleEvent,this),this._map.getPlotEditControl().on(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this)},_latlngEvent:function(t){if(this.associatedUuid){var e=t.feature.latLngs[0],i=null;if(!this._selfDefineTowardAngle){var o=this._getFeature(this.associatedUuid);i=o.getRotate?o.getRotate():o.dRotate,o.symbolType!=SuperMap.Plot.SymbolType.PICTURE&&o.symbolType!=SuperMap.Plot.SymbolType.MODELPLOT||(i=o.graphic?o.graphic._rotation:o.dRotate)}this._updatePosition(e,i)}},_removeEvent:function(t){this.associatedUuid&&this.remove()},_visibleEvent:function(t){this.associatedUuid&&("display"==t.target.style.display&&1==t.target.layer.visibility?this.setVisible(!0):this.setVisible(!1))},_offEvent:function(){var t=this._getFeature(this.associatedUuid);t&&(t.off("latlngchanged",this._latlngEvent),t.off("featureremoved",this._removeEvent),t.off("featurevisiblechanged",this._visibleEvent),this._map.getPlotEditControl()&&this._map.getPlotEditControl().off(SuperMap.Plot.Event.featuresunselected,this._unSelectedSpecialEffect,this))},_setAssociatedUuid:function(t){this.associatedUuid=t,this._initEvent(t)},_calRadiusByUnit:function(){if(this.radiusUnit==SuperMap.Plot.RadiusUnitType.PIXEL){var t=this._map.latLngToContainerPoint(this._position);t.x=t.x+this.radius;var e=L.point([t.x,t.y]),i=this._map.containerPointToLatLng(e);this.radius=Math.sqrt(Math.pow(this._position.lat-i.lat,2)+Math.pow(this._position.lng-i.lng,2))}else if(this.radiusUnit==SuperMap.Plot.RadiusUnitType.METERS){var o=this._map.options.crs.project(this._position);o.x=o.x+this.radius;var n=this._map.options.crs.unproject(o);this.radius=Math.sqrt(Math.pow(n.lat-this._position.lat,2)+Math.pow(n.lng-this._position.lng,2))}},_renderArc:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.arcFeatures_){this.arcFeatures_=[];var e=qc(this._position,this.radius,this.radiusUnit,this.startAngle-this.angle,this.startAngle);e.push(this._position);var i=L.polygon([e],Wc(Wc({},this.style),{},{smoothFactor:0})),o=Math.round(1e3*Math.random()).toString();i._eventParents={},i._eventParents[o]=this,this.arcFeatures_.push(i)}for(var n=0;n<this.arcFeatures_.length;n++){var l=this.arcFeatures_[n];if(t){var s=qc(this._position,this.radius,this.radiusUnit,this.startAngle-this.angle,this.startAngle);s.push(this._position),l.setLatLngs([s]),l.setStyle(Wc({},this.style))}}this._boundsFeature=this.arcFeatures_[0]},_renderScanArc:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.scanFeature_){this.scanFeature_=null;var e=qc(this._position,this.radius,this.radiusUnit,this.rotateAngle-this.scanAngle,this.rotateAngle);e.push(this._position),this.scanFeature_=L.polygon([e],Wc(Wc({},this.scanStyle),{},{smoothFactor:0}));var i=Math.round(1e3*Math.random()).toString();this.scanFeature_._eventParents={},this.scanFeature_._eventParents[i]=this}if(t){var o=qc(this._position,this.radius,this.radiusUnit,this.rotateAngle-this.scanAngle,this.rotateAngle);o.push(this._position),this.scanFeature_.setLatLngs([o]),this.scanFeature_.setStyle(Wc({},this.scanStyle))}},_redrawAimCircle:function(){this.hasRemoved||this.setRadius(this.radiusSelfDefine)},_updateDetectionRange:function(t){var e=this,i=0;this.timer=setInterval(function(){i>=t.length&&(i=0,clearInterval(e.timer)),e._position=t[i],e._renderArc(!0),i++},1e3)},_tempPause:function(){window.cancelAnimationFrame(this.aId_),this.aId_=null,this.pauseAngle=this.rotateAngle},_tempPlay:function(){0!=this.isPlay&&this._animation()},_addTo:function(t){for(var e=0;e<this.arcFeatures_.length;e++)this.arcFeatures_[e].addTo(t);return this.scanFeature_.addTo(t),this},_updatePosition:function(t,e){if(this._position=new L.latLng(t.lat,t.lng),!this._selfDefineTowardAngle&&null!=e&&void 0!=e){this._initTowardsAngle(e);var i=180*this.angle/Math.PI;this.setAngle(i)}this._renderArc(!0),this._renderScanArc(!0),this.isSelected&&this._updateSelectedMarker()}}),Jc=function(t,e,i,o){var n=new Zc(t,e,i,o);return n.createStatus?n:null};function qc(t,e,i,o,n){var l,s,a=[],r=n-o;if(r=r<0?r+Hc.TWO_PI:r,i==SuperMap.Plot.RadiusUnitType.METERS)for(var u=0;u<=Hc.FITTING_COUNT;u++){var p=o+r*c/Hc.FITTING_COUNT*180/Math.PI,h=Kc(t.lng,t.lat,p,e);a.push(h)}else for(var c=0;c<=Hc.FITTING_COUNT;c++){var y=o+r*c/Hc.FITTING_COUNT;l=t.lng+e*Math.cos(y),s=t.lat+e*Math.sin(y),a.push([s,l])}return a}function Kc(t,e,i,o){var n=i*(Math.PI/180),l=e*(Math.PI/180);return{lng:t+1e3*o*Math.sin(n)/(6371393*Math.cos(l)*Math.PI/180),lat:e+1e3*o*Math.cos(n)/(6371393*Math.PI/180)}}L.supermap.plotting.sectorDetectionRange=Jc,L.supermap.plotting.SectorDetectionRange=Zc;var Qc=L.Evented.extend({specialEffectList:{},specialEffectListByType:{},map:null,initialize:function(t){this.on("addSpecialEffect2Manager",this._addToSpecialEffectList),null!=t&&(this.map=t)},createCommunicationLinkByPosition:function(t,e,i){var o=new Nc(null,null,t,e,i);return Object.keys(o).length?(this.addSpecialEffect(o),o):null},createSectorDetectionRangeByPosition:function(t,e){var i=new Jc(null,t,e);return Object.keys(i).length?(this.addSpecialEffect(i),i):null},createScanRadarByPosition:function(t,e){var i=Ec(null,t,e);return Object.keys(i).length?(this.addSpecialEffect(i),i):null},createBoomByPosition:function(t,e){var i=new Vc(null,t,e);return Object.keys(i).length?(this.addSpecialEffect(i),i):null},createAimByPosition:function(t,e,i){var o=new kc(null,null,t,e,i);return Object.keys(o).length?(this.addSpecialEffect(o),o):null},addSpecialEffect:function(t){if(t){t.getUuid();this._addToSpecialEffectList(t);var e=null;switch(t.getType()){case SuperMap.Plot.SpecialEffectType.AIM:e="aim";break;case SuperMap.Plot.SpecialEffectType.BOOM:e="boom";break;case SuperMap.Plot.SpecialEffectType.COMMUNICATIONLINK:e="communicationLink";break;case SuperMap.Plot.SpecialEffectType.SCANRADAR:e="scanRadar";break;case SuperMap.Plot.SpecialEffectType.DESTROY:e="destroy";break;case SuperMap.Plot.SpecialEffectType.SECTORDETECTIONRANGE:e="sectorDetectionRange"}this.specialEffectListByType[e]||(this.specialEffectListByType[e]=[]),this.specialEffectListByType[e].push(t)}},selectedSpecialEffect:function(t){t._selectedSpecialEffect()},unSelectedSpecialEffect:function(t){t._unSelectedSpecialEffect()},removeSpecialEffect:function(t){var e=this.getSpecialEffectByUuid(t),i=null;switch(e.getType()){case SuperMap.Plot.SpecialEffectType.AIM:e.aimUuid;if(!this.specialEffectListByType.aim)return this.specialEffectList[t].remove(),void delete this.specialEffectList[t];i=this.specialEffectListByType.aim;for(var o=0;o<i.length;o++)i[o].id==e.uuid&&this.specialEffectListByType.aim.splice(o,1);break;case SuperMap.Plot.SpecialEffectType.BOOM:if(e.associatedUuid,!this.specialEffectListByType.boom)return this.specialEffectList[t].remove(),void delete this.specialEffectList[t];i=this.specialEffectListByType.boom;for(var n=0;n<i.length;n++)i[n]==e.uuid&&this.specialEffectListByType.boom.splice(n,1);break;case SuperMap.Plot.SpecialEffectType.COMMUNICATIONLINK:if(!this.specialEffectListByType.communicationLink)return this.specialEffectList[t].remove(),void delete this.specialEffectList[t];i=this.specialEffectListByType.communicationLink;for(var l=0;l<i.length;l++)i[l].id==e.uuid&&this.specialEffectListByType.communicationLink.splice(l,1);break;case SuperMap.Plot.SpecialEffectType.SCANRADAR:if(e.associatedUuid,!this.specialEffectListByType.scanRadar)return this.specialEffectList[t].remove(),void delete this.specialEffectList[t];i=this.specialEffectListByType.scanRadar;for(var s=0;s<i.length;s++)i[s]==e.uuid&&this.specialEffectListByType.scanRadar.splice(s,1);break;case SuperMap.Plot.SpecialEffectType.DESTROY:if(e.associatedUuid,!this.specialEffectListByType.destroy)return this.specialEffectList[t].remove(),void delete this.specialEffectList[t];i=this.specialEffectListByType.destroy;for(var a=0;a<i.length;a++)i[a]==e.uuid&&this.specialEffectListByType.destroy.splice(a,1);break;case SuperMap.Plot.SpecialEffectType.SECTORDETECTIONRANGE:if(e.associatedUuid,!this.specialEffectListByType.sectorDetectionRange)return this.specialEffectList[t].remove(),void delete this.specialEffectList[t];i=this.specialEffectListByType.sectorDetectionRange;for(var r=0;r<i.length;r++)i[r]==e.uuid&&this.specialEffectListByType.sectorDetectionRange.splice(r,1)}this.specialEffectList[t].remove(),delete this.specialEffectList[t]},getSpecialEffectList:function(){var t=[];for(var e in this.specialEffectList)t.push(this.specialEffectList[e]);return t},getSpecialEffectByType:function(t){var e=[];switch(t){case SuperMap.Plot.SpecialEffectType.AIM:e=this.specialEffectListByType.aim;break;case SuperMap.Plot.SpecialEffectType.BOOM:e=this.specialEffectListByType.boom;break;case SuperMap.Plot.SpecialEffectType.COMMUNICATIONLINK:e=this.specialEffectListByType.communicationLink;break;case SuperMap.Plot.SpecialEffectType.SCANRADAR:e=this.specialEffectListByType.scanRadar;break;case SuperMap.Plot.SpecialEffectType.DESTROY:e=this.specialEffectListByType.destroy;break;case SuperMap.Plot.SpecialEffectType.SECTORDETECTIONRANGE:e=this.specialEffectListByType.sectorDetectionRange}return e},getSpecialEffectByUuid:function(t){return this.specialEffectList[t]},_fromJSONData:function(t){for(var e in this.jsonDataUuids||(this.jsonDataUuids=[]),t)for(var i=0;i<t[e].length;i++){var o=t[e][i].type;if(o==SuperMap.Plot.SpecialEffectType.AIM)if(map.getFeatureByUuid(t[e][i].viewUuid)&&map.getFeatureByUuid(t[e][i].aimUuid))L.supermap.plotting.aim(t[e][i].viewUuid,t[e][i].aimUuid,null,null,{style:t[e][i].style});else if(t[e][i].viewUuid||t[e][i].aimUuid)t[e][i].viewUuid||t[e][i].aimUuid;else{if(-1!=this.jsonDataUuids.indexOf(t[e][i].uuid))continue;this.jsonDataUuids.push(t[e][i].uuid);var n=new L.latLng(t[e][i].viewPt[0],t[e][i].viewPt[1]),l=new L.latLng(t[e][i].aimPt[0],t[e][i].aimPt[1]);this.createAimByPosition(n,l,{style:t[e][i].style})}if(o==SuperMap.Plot.SpecialEffectType.BOOM)if(map.getFeatureByUuid(t[e][i].associatedUuid))L.supermap.plotting.boom(t[e][i].associatedUuid,null,{loop:t[e][i].loop,boomTimes:t[e][i].boomTimes});else if(!t[e][i].associatedUuid){if(-1!=this.jsonDataUuids.indexOf(t[e][i].uuid))continue;this.jsonDataUuids.push(t[e][i].uuid);new L.latLng(t[e][i].latLng[0],t[e][i].latLng[1]);this.createBoomByPosition(t[e][i].latLng,{loop:t[e][i].loop,boomTimes:t[e][i].boomTimes})}if(o==SuperMap.Plot.SpecialEffectType.COMMUNICATIONLINK)if(map.getFeatureByUuid(t[e][i].senderUuid)&&map.getFeatureByUuid(t[e][i].receiverUuid))this.jsonDataUuids.push(t[e][i].uuid),L.supermap.plotting.communicationLink(t[e][i].senderUuid,t[e][i].receiverUuid,null,null,{dashSpeed:t[e][i].dashSpeed,style:t[e][i].style});else if(t[e][i].senderUuid||t[e][i].receiverUuid)t[e][i].senderUuid||t[e][i].receiverUuid;else{if(-1!=this.jsonDataUuids.indexOf(t[e][i].uuid))continue;this.jsonDataUuids.push(t[e][i].uuid),this.createCommunicationLinkByPosition(t[e][i].senderPt,t[e][i].receiverPt,{dashSpeed:t[e][i].dashSpeed,style:t[e][i].style})}if(o==SuperMap.Plot.SpecialEffectType.DESTROY){if(-1!=this.jsonDataUuids.indexOf(t[e][i].uuid))continue;this.jsonDataUuids.push(t[e][i].uuid),L.supermap.plotting.destroy(t[e][i].associatedUuid,{durationTime:t[e][i].durationTime})}if(o==SuperMap.Plot.SpecialEffectType.SCANRADAR)if(map.getFeatureByUuid(t[e][i].associatedUuid))L.supermap.plotting.scanRadar(t[e][i].associatedUuid,null,{period:t[e][i].period,startAngle:t[e][i].startAngle,loop:t[e][i].loop,radius:t[e][i].radius,radiusUnit:t[e][i].radiusUnit,style:t[e][i].style});else if(!t[e][i].associatedUuid){if(-1!=this.jsonDataUuids.indexOf(t[e][i].uuid))continue;this.jsonDataUuids.push(t[e][i].uuid),this.createScanRadarByPosition(t[e][i].latLng,{period:t[e][i].period,startAngle:t[e][i].startAngle,loop:t[e][i].loop,radius:t[e][i].radius,radiusUnit:t[e][i].radiusUnit,style:t[e][i].style})}if(o==SuperMap.Plot.SpecialEffectType.SECTORDETECTIONRANGE)if(map.getFeatureByUuid(t[e][i].associatedUuid))L.supermap.plotting.sectorDetectionRange(t[e][i].associatedUuid,null,{angle:t[e][i].angle,radius:t[e][i].radius,radiusUnit:t[e][i].radiusUnit,towardsAngle:t[e][i].towardsAngle,style:t[e][i].style,scanStyle:t[e][i].scanStyle});else if(!t[e][i].associatedUuid){if(-1!=this.jsonDataUuids.indexOf(t[e][i].uuid))continue;this.jsonDataUuids.push(t[e][i].uuid),this.createSectorDetectionRangeByPosition(t[e][i].latLng,{angle:t[e][i].angle,radius:t[e][i].radius,radiusUnit:t[e][i].radiusUnit,towardsAngle:t[e][i].towardsAngle,style:t[e][i].style,scanStyle:t[e][i].scanStyle})}}},_addToSpecialEffectList:function(t){var e=this,i=t.getUuid();this.specialEffectList[i]=t,this.fire(SuperMap.Plot.Event.specialeffectadded);var o=this;t.on("removeEffect",function(t){delete o.specialEffectList[t.uuid],e.fire(SuperMap.Plot.Event.specialeffectremoved)})},_getPositionByIds:function(t){for(var e=[],i=0;i<t.length;i++)for(var o=this._map.getFeatureByUuid(t[i]),n=0;n<o.latLngs.length;n++)e.push(new L.latLng(o.latLngs[n].lat,o.latLngs[n].lng));return e},_getPositionById:function(t){var e=this._map.getFeatureByUuid(t);return new L.latLng(e.latLngs[0].lat,e.latLngs[0].lng)}}),$c=function(t){return new Qc(t)};L.supermap.plotting.specialEffectManager=$c,L.supermap.plotting.SpecialEffectManager=Qc;var ty=L.Evented.extend({serverUrl:null,map:null,defaultStyle:null,sitDataManager:null,symbolLibManager:null,clientID:null,dpi:96,animationManager:null,transManager:null,imageManager:null,plotMapManager:null,touchMode:null,options:{serviceParams:{proxy:null,withCredentials:!1,crossOrigin:null,headers:null,serverType:null}},initialize:function(t,e,i){null!=t&&(ty.prototype.map=t),null!=e&&(ty.prototype.serverUrl=SuperMap.MGISCredential.normalizedUrl(e)),i&&i.serviceParams&&SuperMap.Util.extend(this.options,i),this.defaultStyle=new SuperMap.Plot.DefaultStyle,this.sitDataManager=new dc(this.map,this.serverUrl,this.options),this.symbolLibManager=new bc(this.serverUrl,this.options),this.animationManager=new gc(this.map,this.serverUrl,this.options),this.transManager=new Lc(this.map),this.plotMapManager=new Mc(this.map,this.serverUrl,this.options),this.specialEffectManager=new Qc(this.map),this.imageManager={},this.touchMode=!1},destroy:function(){ty.prototype.serverUrl=null,ty.prototype.map=null,this.defaultStyle&&(this.defaultStyle.destroy(),this.defaultStyle=null),this.sitDataManager&&(this.sitDataManager.destroy(),this.sitDataManager=null),this.symbolLibManager&&(this.symbolLibManager.destroy(),this.symbolLibManager=null),this.clientID=null,null!==this.animationManager&&(this.animationManager.destroy(),this.animationManager=null),this.plotMapManager&&(this.plotMapManager.destroy(),this.plotMapManager=null),g_Plotting=null},getDefaultStyle:function(){return this.defaultStyle},getSitDataManager:function(){return this.sitDataManager},getPlotMapManager:function(){return this.plotMapManager},getSymbolLibManager:function(){return this.symbolLibManager},getGOAnimationManager:function(){return this.animationManager},getSpecialEffectManager:function(){return this.specialEffectManager},getClientID:function(){return this.clientID},setClientID:function(t){this.clientID=t},getTouchMode:function(){return this.touchMode},setTouchMode:function(t){this.touchMode=t},getDPI:function(){return this.dpi},setDPI:function(t){this.dpi=t},getTransManager:function(){return this.transManager},setMap:function(t){ty.prototype.map=t,null===this.sitDataManager.map&&(dc.prototype.map=t),null===this.animationManager.map&&this.animationManager.setMap(t),null===this.transManager.map&&(this.transManager.map=t),null===this.plotMapManager.map&&(Mc.prototype.map=t),null===this.specialEffectManager.map&&(this.specialEffectManager.map=t)},getMap:function(){return this.map},setPlotUrl:function(t){var e=SuperMap.MGISCredential.normalizedUrl(t);ty.prototype.serverUrl=e,null===this.sitDataManager.serverUrl&&(dc.prototype.serverUrl=e),null===this.symbolLibManager.url&&(bc.prototype.url=e),null===this.animationManager.serverUrl&&(gc.prototype.serverUrl=e),null===this.plotMapManager.serverUrl&&(Mc.prototype.serverUrl=e)},setOptions:function(t){t=t||{},L.setOptions(this,t),L.setOptions(this.sitDataManager,t),L.setOptions(this.symbolLibManager,t),L.setOptions(this.animationManager,t),L.setOptions(this.plotMapManager,t)},getFeatureByUuid:function(t){if(null!==this.map){for(var e=this.map.getPlottingLayers(),i=0,o=e.length;i<o;i++){var n=e[i].getFeatureByUuid(t);if(null!==n)return n}return null}return null}}),ey=L.Class.extend({map:null,initialize:function(t){t&&null!==t&&(this.map=t)},destroy:function(){this.map=null,delete this.map},captureGObject:function(t){var e=[];if(t){for(var i=this.map.getPlottingLayers(),o=0;o<i.length;o++)for(var n=i[o],l=0;l<n.features.length;l++){var s=n.features[l];s instanceof bh&&s.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&(t.lng===s.getLatLngs()[0].lng&&t.lat===s.getLatLngs()[0].lat&&e.push(s))}return e}return 0},getGObjectsInPolygon:function(t){var e=[];if(t&&0!==t.length){if(L.Util.isArray(t)||(t=[t]),t.length<=2)return e;for(var i=this.map.getPlottingLayers(),o=0;o<i.length;o++){var n=i[o];for(var l in n.features){if((r=n.features[l])instanceof bh){if(null===(u=r.getBounds().getCenter()))return;this._ptIsInPolygon(t,u)&&e.push(r)}}}var s=this.map.getMovingTargetLayers();for(o=0;o<s.length;o++){var a=s[o];for(var l in a.features){var r;if((r=a.features[l])instanceof bh){var u;if(null===(u=r.latLngs[0]))return;this._ptIsInPolygon(t,u)&&e.push(r)}}}return e}},_ptIsInPolygon:function(t,e){if(!t||null===t||0===t.length)return!1;for(var i=0,o=t.length,n=0;n<o;n++){var l=t[n],s=t[(n+1)%o];if(l.lat!==s.lat){var a=l.lat<s.lat?l.lat:s.lat,r=l.lat>s.lat?l.lat:s.lat;if(!(e.lat<a||e.lat>r))(e.lat-l.lat)*(s.lng-l.lng)/(s.lat-l.lat)+l.lng>e.lng&&i++}}return i%2==1},getGObjectsInCircle:function(t,e){if(t&&e){for(var i=[],o=this.map.getPlottingLayers(),n=0;n<o.length;n++){var l=o[n];for(var s in l.features){if((u=l.features[s])instanceof bh){if(null===(p=u.getBounds().getCenter()))continue;Math.abs(e)>Math.sqrt(Math.pow(t.lng-p.lng,2)+Math.pow(t.lat-p.lat,2))&&i.push(u)}}}var a=this.map.getMovingTargetLayers();for(n=0;n<a.length;n++){var r=a[n];for(var s in r.features){var u;if((u=r.features[s])instanceof bh){var p;if(null===(p=u.latLngs[0]))return;Math.abs(e)>Math.sqrt(Math.pow(t.lng-p.lng,2)+Math.pow(t.lat-p.lat,2))&&i.push(u)}}}return i}},getGObjectsInRect:function(t,e){if(t&&e){for(var i=[],o=this.map.getPlottingLayers(),n=0;n<o.length;n++){var l=o[n];for(var s in l.features){if((u=l.features[s])instanceof bh){if(null===(p=u.getBounds().getCenter()))continue;t.lng<e.lng&&t.lat>e.lat?p.lng>t.lng&&p.lng<e.lng&&p.lat<t.lat&&p.lat>e.lat&&i.push(u):p.lng<t.lng&&p.lng>e.lng&&p.lat<t.lat&&p.lat>e.lat&&i.push(u)}}}var a=this.map.getMovingTargetLayers();for(n=0;n<a.length;n++){var r=a[n];for(var s in r.features){var u;if((u=r.features[s])instanceof bh){var p;if(null===(p=u.latLngs[0]))return;t.lng<e.lng&&t.lat>e.lat?p.lng>t.lng&&p.lng<e.lng&&p.lat<t.lat&&p.lat>e.lat&&i.push(u):p.lng<t.lng&&p.lng>e.lng&&p.lat<t.lat&&p.lat>e.lat&&i.push(u)}}}return i}}}),iy=function(t){return new ey(t)};L.supermap.plotting.query=iy,L.supermap.plotting.Query=ey;var oy=null,ny=function(t,e,i){return null===oy&&(oy=new ty(t,e,i)),t&&null!==t&&null===oy.map&&oy.setMap(t),e&&null!==e&&null===oy.serverUrl&&oy.setPlotUrl(e),null!=i&&oy.setOptions(i),oy};function ly(t){return function(t){if(Array.isArray(t))return sy(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return sy(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return sy(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sy(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=new Array(e);i<e;i++)o[i]=t[i];return o}function ay(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=[],o=function(t){for(var e=[],i=0;i<t.length;i++)t[i]&&e.push([t[i].lat,t[i].lng]);for(var o=[],n=0;n<e.length;n++)for(var l=e[n],s=0;s<l.length;s++)o[s]||(o[s]={min:1e3,max:0}),l[s]<o[s].min&&(o[s].min=l[s]),l[s]>o[s].max&&(o[s].max=l[s]);return o}(t);i=function(t,e,i){t||(t=3);for(var o=[];t--;){for(var n=[],l=0;l<e.length;l++)n[l]=e[l].min+Math.random()*i[l];o.push(n)}return o}(e,o,function(t){for(var e=[],i=0;i<t.length;i++)e[i]=t[i].max-t[i].min;return e}(o));var n,l=0;do{n=i.slice();for(var s=new Array(e).fill(0).map(function(){return[]}),a=new Array(e).fill(0).map(function(){return[]}),r=0;r<t.length;r++){for(var u=[],p=0;p<e;p++){var h=uy(t[r],i[p]);Object.is(h,NaN)||u.push(h)}var c=u.indexOf(Math.min.apply(Math,ly(u)));-1!=c&&(s[c].push(t[r]),a[c].push(r))}for(var y=0;y<e;y++)i[y]=py(s[y]);l++}while(l<100&&!hy(i,n));return{kPoints:s,symbolUuidCluster:a}}function ry(t,e,i){var o={},n={lat:-90,lng:-180},l={lat:90,lng:180},s=l.lng-n.lng,a=l.lat-n.lat,r=null,u=null;if(i)r=i.width,u=i.height;else{var p=20,h=10;t&&t.getZoom()<3&&(p=10,h=5),r=s/p,u=a/h}for(var c=0;c<e.length;c++){var y=e[c].latLngs[0]?e[c].latLngs[0]:new L.latLng(e[c].latLngs.y,e[c].latLngs.x);if(y.lat>n.lat&&y.lat<l.lat&&y.lng>n.lng&&y.lng<l.lng){var g=y.lng-n.lng,f=y.lat-n.lat,d=Math.floor(g/r),m=Math.floor(f/u);if(d<0||m<0)return;o[d]?o[d][m]?o[d][m].push(e[c]):(o[d][m]=[],o[d][m].push(e[c])):(o[d]={},o[d][m]=[],o[d][m].push(e[c]))}}return o}function uy(t,e){for(var i=0,o=[t.lat,t.lng],n=0;n<o.length;n++)i+=Math.pow(o[n]-e[n],2);return Math.sqrt(i)}function py(t){for(var e=[],i=["lat","lng"],o=0;o<i.length;o++){for(var n=0,l=i[o],s=0;s<t.length;s++)n+=t[s][l];e.push(n/t.length)}return e}function hy(t,e){for(var i=0;i<t.length;i++)for(var o=0;o<t[1].length;o++)if(Math.abs(t[i][o]-e[i][o])>1e-4)return!1;return!0}L.supermap.plotting.getControl=ny;var cy=vh.extend({_map:null,subObjects:[],symbolCluster:[],centers:[],style:{},showClusterRange:null,showClusterInfo:null,rangeIsOnlyInCluster:null,infoIsOnlyInCluster:null,_circleRanges:null,_clusterTextNode:null,iconClass:"",_radius:null,initialize:function(t,e,i,o){this.showClusterInfo=!0,this.showClusterRange=!0,this.rangeIsOnlyInCluster=!1,this.infoIsOnlyInCluster=!1,this.components=[],this.symbolName="聚合对象",this.libID=0,this.code=SuperMap.Plot.SymbolType.CLUSTEROBJECT,this.symbolType=SuperMap.Plot.SymbolType.CLUSTEROBJECT,this.symbolBounds=o.symbolBounds?o.symbolBounds:{},bh.prototype.initialize.call(this,t,e,i,o),o&&SuperMap.Util.extend(this,o),this._map=o.map?o.map:this._map,o&&o.style||this.clusterStyle?this.clusterStyle&&(this.style=this.clusterStyle):this.style={rangeColor:"#98bacb",fontBackgroundColor:"rgba(100, 149, 237, 0.5)",fontBackgroundBorderColor:"cornflowerblue"},this._circleRanges=[],this._clusterTextNode=[],this._init(),this.iconClass="leaflet-cluster-textnode"+Math.floor(1e3*Math.random()).toString(),this.isCombine=!0,this.isCluster=!1,this._centerLatLngs=null,this._changeModelShowStatus(this),this._map.on("zoomend",this._reView,this)},setSymbolInfoVisible:function(t,e){if(this.showClusterInfo=t,this.infoIsOnlyInCluster=e,t)if(e)if(this.isCluster)this._addTextNode();else for(var i=0;i<this._clusterTextNode.length;i++)for(var o=0;o<this._clusterTextNode[i].length;o++)this._clusterTextNode[i][o].remove();else this._addTextNode();else for(i=0;i<this._clusterTextNode.length;i++)for(o=0;o<this._clusterTextNode[i].length;o++)this._clusterTextNode[i][o].remove()},setRangeVisible:function(t,e){if(this.showClusterRange=t,this.rangeIsOnlyInCluster=e,t)if(e)if(this.isCluster)this._addCircleRanges();else for(var i=0;i<this._circleRanges.length;i++)this._circleRanges[i].remove();else this._addCircleRanges();else for(i=0;i<this._circleRanges.length;i++)this._circleRanges[i].remove()},setLatLngs:function(t){for(var e=0,i=0,o=0;o<this.subObjects.length;o++)e+=this.subObjects[o].latLngs[0].lat,i+=this.subObjects[o].latLngs[0].lng;e/=this.subObjects.length,i/=this.subObjects.length;for(var n=t.lat-e,l=t.lng-i,s=0;s<this.subObjects.length;s++){var a=this.subObjects[s].latLngs[0].lat+n,r=this.subObjects[s].latLngs[0].lng+l;this.subObjects[s].setLatLngs([new L.latLng(a,r)])}if(this.showClusterRange){var u=yy(p=this._getBlockCenter(this.subObjects),this._radius,0,2*Math.PI);this._circleRanges[0].setLatLngs(u)}if(this.showClusterInfo){var p=this._getBlockCenter(this.subObjects);this._clearTextNode(),this._createTextNote(p,this.subObjects.length),this._addTextNode()}},setStyle:function(t){for(var e in t)switch(e){case"rangeColor":this.style.rangeColor=t[e];for(var i=0;i<this._circleRanges.length;i++)this._circleRanges[i].setStyle({color:this.style.rangeColor});break;case"fontBackgroundBorderColor":this.style.fontBackgroundBorderColor=t[e],document.querySelector("."+this.iconClass).style.border="1px solid "+this.style.fontBackgroundBorderColor;for(var o=0;o<this._clusterTextNode.length;o++)this._clusterTextNode[o][1].setStyle({color:this.style.fontBackgroundBorderColor});break;case"fontBackgroundColor":this.style.fontBackgroundColor=t[e],document.querySelector("."+this.iconClass).style.backgroundColor=this.style.fontBackgroundColor}},destroy:function(){if(bh.prototype.destroy.call(this),this.subObjects=[],null!=this._trajectoryLine)for(var t=0;t<this._trajectoryLine.length;t++)this.layer._removeTrajectory(this._trajectoryLine[t]);this._trajectoryLine=[],this._trajectoryPt||(this._trajectoryPt=[]),this._clearCircleRanges(),this._clearTextNode(),this._map.off("zoomend",this._reView,this)},move:function(t,e){for(var i=[],o=0;o<this.subObjects.length;o++){var n=[];n.push(this.subObjects[o].latLngs[0]),this.subObjects[o].move(t,e);var l=new L.latLng(this.subObjects[o].latLngs[0].lat-t,this.subObjects[o].latLngs[0].lng-e);if(n.push(l),!0===this.subObjects[o].autoRotation){var s=new SuperMap.Geometry.Point(n[0].lng,n[0].lat),a=new SuperMap.Geometry.Point(n[1].lng,n[1].lat),r=SuperMap.Plot.PlottingUtil.radian(s,a)*SuperMap.Plot.PlottingUtil.RTOD;0==r||90==r||180==r||270==r?20==this.subObjects[o].code||21==this.subObjects[o].code?this.subObjects[o].setRotate(r+90):this.subObjects[o].setRotate(r):20==this.subObjects[o].code||21==this.subObjects[o].code?this.subObjects[o].setRotate(r+90):Math.sign(t)!=Math.sign(e)?this.subObjects[o].setRotate(r):this.subObjects[o].setRotate(r+360)}if(this.subObjects[o].trajectory){if(null!=this._trajectoryLine)for(var u=0;u<this._trajectoryLine.length;u++)this.layer._removeTrajectory(this._trajectoryLine[u]);this._trajectoryLine=[],this._trajectoryPt?"display"==this.subObjects[o]._clusterShowStatus?this._trajectoryPt.push(n):(this._trajectoryPt.push([]),i.push(o)):(this._trajectoryPt=[],this._trajectoryPt.push(n))}}if(this.subObjects[0].trajectory){this._trajectoryPt.length>4*this.subObjects.length&&this._trajectoryPt.splice(0,this.subObjects.length);for(var p=0;p<i.length;p++){o=i[p];for(var h=this._trajectoryPt.length/this.subObjects.length,c=0;c<h;c++)this._trajectoryPt[parseInt(o)+c*this.subObjects.length]=[]}}this.symbolBounds=this.getBounds();var y=(this.symbolBounds._northEast.lat+this.symbolBounds._southWest.lat)/2,g=this.symbolBounds._southWest.lng+(this.symbolBounds._northEast.lng-this.symbolBounds._southWest.lng)/2,f=new L.latLng(y,g);if(this.subObjects[0].layer.isMovingTargetLayer)for(o=0;o<this.subObjects.length;o++)if(this.subObjects[o].trajectory)for(var d=this._trajectoryPt.length/this.subObjects.length,m=0;m<d;m++){var S=parseInt(o)+m*this.subObjects.length,P=L.polyline(this._trajectoryPt[S],{color:this.subObjects[o].trajectory.style.color,weight:this.subObjects[o].trajectory.style.weight,opacity:this.subObjects[o].trajectory.style.opacity});"display"==this.subObjects[o]._clusterShowStatus&&(this.layer._addTrajectory(P),this._trajectoryLine.push(P))}if(this.showClusterRange){var b=yy(f,this._radius,0,2*Math.PI);this._circleRanges[0].setLatLngs(b)}this.showClusterInfo&&(this._clearTextNode(),this._createTextNote(f,this.subObjects.length),this._addTextNode()),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},_reView:function(){this.symbolBounds=this.getBounds(),this._changeModelShowStatus(this);for(var t=0;t<this.components.length;t++)this.components[t].redraw();this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},_unGroupObject:function(){this._clearCircleRanges(),this._clearTextNode();for(var t=0;t<this.subObjects.length;t++)this.subObjects[t]._clusterShowStatus=void 0,this.subObjects[t].redraw();this.isCombine=!1,this._map.off("zoomend",this._changeModelShowStatus(this));var e=null;if(0!==this.subObjects.length){e=this.subObjects.slice(),this._clearComponents(),this.layer.isMovingTargetLayer&&this.layer.removeFeatures(this);t=0;for(var i=e.length;t<i;t++)this.layer.addFeatures(e[t]),e[t].ownerGroup=null}return e},_clearComponents:function(){bh.prototype._clearComponents.call(this)},_init:function(){L.supermap.plotting.getControl(this._map).getSymbolLibManager().initializeAsync(),this.symbolCluster=this._classifySymbols(),this.centers=this._getClusterCenter(),this.symbolBounds=this.symbolBounds?this.symbolBounds:this._getmaxFeatureBounds()},_getClusterCenter:function(){for(var t=[],e=0;e<this.symbolCluster.length;e++){for(var i={lat:0,lng:0},o=0;o<this.symbolCluster[e].length;o++)i.lat=i.lat+this.symbolCluster[e][o].latLngs[0].lat,i.lng=i.lng+this.symbolCluster[e][o].latLngs[0].lng;this.symbolCluster[e].length?(i.lat=i.lat/this.symbolCluster[e].length,i.lng=i.lng/this.symbolCluster[e].length):(i.lat=1e3,i.lng=1e3);var n=[new L.latLng(i.lat,i.lng)];t.push(n)}return t},_classifySymbols:function(){var t={};if(0==this.subObjects.length)return[];for(var e=0;e<this.subObjects.length;e++)if(this.subObjects[e].symbolType==SuperMap.Plot.SymbolType.DOTSYMBOL||this.subObjects[e].symbolType==SuperMap.Plot.SymbolType.PICTURE||this.subObjects[e].symbolType==SuperMap.Plot.SymbolType.MODELPLOT){var i=this.subObjects[e].libID.toString()+this.subObjects[e].code.toString();t[i]?t[i].push(this.subObjects[e]):(t[i]=[],t[i].push(this.subObjects[e]))}for(var o=Object.keys(t),n=0,l=0,s=0;s<o.length;s++)t[o[s]].length>n&&(l=o[s],n=t[o[s]].length);return this.subObjects=t[l],t[l]},_clusterByBlockCluster:function(){var t=this._classifySymbols();return ry(this._map,t)},_changeModelShowStatus:function(t){if(this.isCombine){var e;e=t._clusterByBlockCluster(),t._clearCircleRanges(),t._clearTextNode();var i=0;for(var o in e)for(var n in e[o]){var l=e[o][n],s=t._getBlockCenter(l),a=[];if(l.length>2)a=t._getShowSymbolIndexes(l,s),t._setSymbolVisible(a,l),a.length!=l.length&&i++;else for(var r=0;r<l.length;r++)l[r]._clusterShowStatus="display"}this.isCluster=i>0,t._redrawCircleAndInfo()}},_getBlockCenter:function(t){for(var e={lat:0,lng:0},i=0;i<t.length;i++)e.lat=e.lat+t[i].latLngs[0].lat,e.lng=e.lng+t[i].latLngs[0].lng;return t.length?(e.lat=e.lat/t.length,e.lng=e.lng/t.length):(e.lat=0,e.lng=0),L.latLng(e.lat,e.lng)},_redrawCircleAndInfo:function(){this.symbolBounds&&this.symbolBounds._northEast||(this.symbolBounds=this._getmaxFeatureBounds());var t=(this.symbolBounds._northEast.lat+this.symbolBounds._southWest.lat)/2,e=this.symbolBounds._southWest.lng+(this.symbolBounds._northEast.lng-this.symbolBounds._southWest.lng)/2,i=new L.latLng(t,e);this._centerLatLngs=i;var o=[new L.Point(this.symbolBounds._northEast.lat,this.symbolBounds._northEast.lng),new L.Point(this.symbolBounds._southWest.lat,this.symbolBounds._southWest.lng)],n=SuperMapAlgoPlot.PlottingUtil.polylineDistance(o)/2;this._radius=n,this._createSymbolRange(i,n),this._createTextNote(i,this.symbolCluster.length),this.showClusterRange&&(this.isCluster&&this.rangeIsOnlyInCluster||!this.rangeIsOnlyInCluster)&&this._addCircleRanges(),this.showClusterInfo&&(this.isCluster&&this.infoIsOnlyInCluster||!this.infoIsOnlyInCluster)&&this._addTextNode()},getLatLngs:function(){for(var t=this.subObjects.length,e=[],i=0;i<t;i++)e.push(this.subObjects[i].latLngs[0]);return e},_getmaxFeatureBounds:function(){for(var t=null,e=0;e<this.symbolCluster.length;e++)if(t){var i=this._getFeatureBounds(this.symbolCluster[e]);i._northEast.lat>t._northEast.lat&&(t._northEast.lat=i._northEast.lat),i._northEast.lng>t._northEast.lng&&(t._northEast.lng=i._northEast.lng),i._southWest.lat<t._southWest.lat&&(t._southWest.lat=i._southWest.lat),i._southWest.lng<t._southWest.lng&&(t._southWest.lng=i._southWest.lng)}else t=this._getFeatureBounds(this.symbolCluster[e]);return t},_getFeatureBounds:function(t){var e,i,o;return t.graphic&&t.graphic.getBounds?(i=t.graphic.getBounds().max,o=t.graphic.getBounds().min,e={_northEast:this._map.containerPointToLatLng(i),_southWest:this._map.containerPointToLatLng(o)}):t.graphic&&t.graphic._pxBounds?(i=L.point([t.graphic._pxBounds.max.x,t.graphic._pxBounds.max.y]),o=L.point([t.graphic._pxBounds.min.x,t.graphic._pxBounds.min.y]),e={_northEast:this._map.containerPointToLatLng(i),_southWest:this._map.containerPointToLatLng(o)}):t._bounds&&(e=t.getBounds()),e},_addCircleRanges:function(){for(var t=0;t<this._circleRanges.length;t++)this._circleRanges[t].addTo(this._map)},_addTextNode:function(){for(var t=0;t<this._clusterTextNode.length;t++)for(var e=0;e<this._clusterTextNode[t].length;e++)this._clusterTextNode[t][e].addTo(this._map);for(var i=document.querySelectorAll("."+this.iconClass),o=0;o<i.length;o++)i[o].style.backgroundColor=this.style.fontBackgroundColor,i[o].style.fontSize="small",i[o].style.border="1px solid "+this.style.fontBackgroundBorderColor,i[o].style.width="80px",i[o].style.height="20px",i[o].style.textAlign="center",i[o].style.fontWeight="bold"},_setSymbolVisible:function(t,e){for(var i=0;i<e.length;i++)-1==t.indexOf(i)?(e[i]._clusterShowStatus="none",e[i]._oldClusterShowStatus="display"):(e[i]._clusterShowStatus="display",e[i]._oldClusterShowStatus="none")},_getShowSymbolIndexes:function(t){for(var e=[],i=0;i<t.length;i++)if(-1==e.indexOf(i)){var o={x:null,y:null,width:null,height:null};o.width=t[i].symbolSize?t[i].symbolSize.w:t[i].style.graphicWidth,o.height=t[i].symbolSize?t[i].symbolSize.h:t[i].style.graphicHeight;var n=this._map.latLngToContainerPoint(t[i].getLatLngs()[0]);o.x=n.x-o.width/2,o.y=n.y-o.height;for(var l=0;l<t.length;l++)if(i!=l&&-1==e.indexOf(l)){var s={x:null,y:null,width:null,height:null};s.width=t[l].symbolSize?t[l].symbolSize.w:t[l].style.graphicWidth,s.height=t[l].symbolSize?t[l].symbolSize.h:t[l].style.graphicHeight;var a=this._map.latLngToContainerPoint(t[l].getLatLngs()[0]);s.x=a.x-s.width/2,s.y=a.y-s.height,o.x<s.x+s.width&&o.x+o.width>s.x&&o.y<s.y+s.height&&o.y+o.height>s.y&&e.push(l)}}for(var r=[],u=0;u<t.length;u++)-1==e.indexOf(u)&&r.push(u);return r},_createSymbolRange:function(t,e){var i=yy(t,e,0,2*Math.PI),o=L.polygon([i],{color:this.style.rangeColor,weight:1,fillOpacity:.2,opacity:.4,smoothFactor:0});this._circleRanges.push(o)},_clearCircleRanges:function(){for(var t=0;t<this._circleRanges.length;t++)this._circleRanges[t].remove();this._circleRanges&&this._circleRanges.splice(0,this._circleRanges.length)},_createTextNote:function(t,e){var i=map.latLngToContainerPoint(t),o=L.point([i.x+20,i.y-20]),n=this._map.containerPointToLatLng(o),l=L.divIcon({html:"标号个数"+e,className:this.iconClass,iconSize:[80,40]}),s=L.marker([n.lat,n.lng],{icon:l}),a=[t,n],r=L.polyline(a,{color:this.style.fontBackgroundBorderColor});this._clusterTextNode.push([s,r])},_clearTextNode:function(){for(var t=0;t<this._clusterTextNode.length;t++)for(var e=0;e<this._clusterTextNode[t].length;e++)this._clusterTextNode[t][e].remove();this._clusterTextNode&&this._clusterTextNode.splice(0,this._clusterTextNode.length)},_createClusterSymbol:function(t,e){if(e){for(var i=L.supermap.plotting.getControl().symbolLibManager.findSymbolByCode(e.code),o=null,n=0;n<i.length;n++)i[n].libID==e.libID&&(o=i[n].icon);var l=e.symbolSize?e.symbolSize.w:e.style.graphicWidth,s=e.symbolSize?e.symbolSize.w:e.style.graphicHeight;o||(o=e.path);var a=L.icon({iconUrl:o,iconSize:[l,s]}),r=L.marker([t.lat,t.lng],{icon:a}).addTo(this._map);this._clusterMarkers.push(r)}},_clearClusterSymbol:function(){for(var t=0;t<this._clusterMarkers.length;t++)this._clusterMarkers[t].remove();this._clusterMarkers&&this._clusterMarkers.splice(0,this._clusterMarkers.length)}});function yy(t,e,i,o){var n,l,s=[],a=o-i;a=a<0?a+2*Math.PI:a;for(var r=0;r<=50;r++){var u=i+a*r/50;n=t.lng+e*Math.cos(u),l=t.lat+e*Math.sin(u),s.push([l,n])}return s}L.supermap.plotting.symbolGroup=function(t,e,i,o){return new cy(t,e,i,o)};var gy=L.Path.extend({serverUrl:null,features:null,isLocked:!1,isEditable:!0,isSelected:!0,visibility:!0,minVisibleScale:0,maxVisibleScale:0,markerMinVisibleScale:0,markerMaxVisibleScale:0,tolerancePixel:5,cacheImages:null,_editLayer:null,_specialEffectManager:null,_vectorRenderer:null,_detectionRangeCombinations:{},options:{zIndex:300,vectorZIndex:200},_circleRanges:[],_clusterTextNode:[],_clusterMarkers:[],_featureUuid:[],isCluster:!1,unitSize:{},symbolGroups:[],showClusterRange:!1,showClusterInfo:!1,clusterStyle:{},isMovingTargetLayer:!0,batchCount:0,isHighDefinition:!1,createAim:function(t,e,i){var o=this._specialEffectManager.createAim(t,e,i);return o||null},createAimByPosition:function(t,e){var i=this._specialEffectManager.createAimByPosition(t,e);return i||null},createBoom:function(t,e){var i=this._specialEffectManager.createBoom(t,e);return i||null},createBoomByPosition:function(t,e){var i=this._specialEffectManager.createBoomByPosition(t,e);return i||null},createCommunicationLink:function(t,e,i){var o=this._specialEffectManager.createCommunicationLink(t,e,i);return o||null},createCommunicationLinkByPosition:function(t,e,i){var o=this._specialEffectManager.createCommunicationLinkByPosition(t,e,i);return o||null},createDestroy:function(t,e){var i=this._specialEffectManager.createDestroy(t,e);return i||null},createScanRadar:function(t,e){var i=this._specialEffectManager.createScanRadar(t,e);return i||null},createScanRadarByPosition:function(t,e){var i=this._specialEffectManager.createScanRadarByPosition(t,e);return i||null},createSectorDetectionRange:function(t,e){var i=this._specialEffectManager.createSectorDetectionRange(t,e);return i||null},createSectorDetectionRangeByPosition:function(t,e){var i=this._specialEffectManager.createSectorDetectionRangeByPosition(t,e);return i||null},removeSpecialEffect:function(t){this._specialEffectManager.removeSpecialEffect(t)},getSpecialEffectObject:function(t){return this._specialEffectManager.getSpecialEffectByUuid(t)},getSelected:function(){return this.isSelected},setSelected:function(t){this.isSelected!==t&&(this.isSelected=t,!1===this.isSelected&&this.selectedFeatures.length>0&&(this._map&&this._map.getPlotEditControl()&&!0===this.isEditable&&!1===this.isLocked&&(this._editLayer.removeFeatures(this.selectedFeatures),this.addFeatures(this.selectedFeatures)),this.fire(SuperMap.Plot.Event.movingtargetsunselected,{features:this.selectedFeatures}),this.selectedFeatures.length=0))},getEditable:function(){return this.isEditable},setEditable:function(t){this.isEditable!==t&&(this.isEditable=t,!1===this.isEditable&&!1===this.isLocked&&this.selectedFeatures.length>0&&this._map&&this._map.getPlotEditControl()&&(this._editLayer.removeFeatures(this.selectedFeatures),this.addFeatures(this.selectedFeatures)))},getLocked:function(){return this.isLocked},setLocked:function(t){this.isLocked!==t&&(this.isLocked=t,!0===this.isEditable&&!0===this.isLocked&&this.selectedFeatures.length>0&&this._map&&this._map.getPlotEditControl()&&(this._editLayer.removeFeatures(this.selectedFeatures),this.addFeatures(this.selectedFeatures)))},getVisibility:function(){return this.visibility},setVisibility:function(t){if(this.visibility!==t&&(this.visibility=t,this.visibility?(this._renderer._container.style.visibility="visible",this._vectorRenderer._container.style.visibility="visible",this._updatePath()):(this._renderer._container.style.visibility="hidden",this._vectorRenderer._container.style.visibility="hidden"),this._editLayer.setVisibility(this.visibility),t))for(var e=this.getAllSymbolGroups(),i=0;i<e.length;i++)e[i]._reView()},getMinVisibleScale:function(){return null==this.minVisibleScale&&(this.minVisibleScale=0),this.minVisibleScale},setMinVisibleScale:function(t){this.minVisibleScale=t,this.maxVisibleScale>1e-7&&this.maxVisibleScale<t&&(this.minVisibleScale=this.maxVisibleScale)},getMaxVisibleScale:function(){return null==this.maxVisibleScale&&(this.maxVisibleScale=1),this.maxVisibleScale},setMaxVisibleScale:function(t){this.maxVisibleScale=t,this.maxVisibleScale>1e-7&&this.maxVisibleScale<t&&(this.maxVisibleScale=this.minVisibleScale)},clearVisibleScale:function(){this.minVisibleScale=0,this.maxVisibleScale=0},composeDetectionRange:function(t,e,i){if(SuperMap.Util.isArray(t)||(t=[t]),0!==this.features.length){for(var o=t.slice(),n=0;n<o.length;)-1!=L.Util.indexOf(this.features,o[n])?(o[n].composeDetectionRange=e,n++):o.splice(0,1);var l={display:"display",color:"#ff0000",opacity:1,weight:1,fill:!0,fillColor:"#ff0000",fillOpacity:.5};l=SuperMap.Plot.PlottingUtil.copyAttributes(l,i),this._detectionRangeCombinations[e]={features:o,style:l}}},decomposeDetectionRange:function(t){if(Object.prototype.hasOwnProperty.call(this._detectionRangeCombinations,t)){for(var e=0;e<this._detectionRangeCombinations[t].features.length;e++)this._detectionRangeCombinations[t].features[e].composeDetectionRange=null;if(null!=this._detectionRangeCombinations[t].detectionRanges&&this._detectionRangeCombinations[t].detectionRanges.length>0){for(e=0;e<this._detectionRangeCombinations[t].detectionRanges.length;e++)this._removeDetectionRange(this._detectionRangeCombinations[t].detectionRanges[e]),delete this._detectionRangeCombinations[t].detectionRanges[e],this._detectionRangeCombinations[t].detectionRanges[e]=null;this._detectionRangeCombinations[t].detectionRanges.length=0}}delete this._detectionRangeCombinations[t]},createSymbolGroup:function(t,e){for(var i=[],o=0;o<t.length;o++)t[o]&&t[o]instanceof xh&&i.push(t[o]);if(i.length>1){var n=new cy(0,SuperMap.Plot.SymbolType.CLUSTEROBJECT,[],{subObjects:i,uuid:e,map:this._map});return this.addFeatures(n),n}return null},unGroupSymbol:function(t){var e=[];return t.symbolType===SuperMap.Plot.SymbolType.CLUSTEROBJECT?(e=t._unGroupObject(),t.destroy()):e.push(t),this.update(),e},getAllSymbolGroups:function(){for(var t=[],e=0;e<this.features.length;e++)if(999==this.features[e].symbolType){var i=this.features[e];t.push(i)}return t},_classifySymbols:function(){for(var t={},e=this.getFeaturesInBounds(),i=0;i<e.length;i++)if(e[i].symbolType==SuperMap.Plot.SymbolType.DOTSYMBOL||e[i].symbolType==SuperMap.Plot.SymbolType.PICTURE||e[i].symbolType==SuperMap.Plot.SymbolType.MODELPLOT){var o=e[i].libID.toString()+e[i].code.toString();t[o]?t[o].push(e[i]):(t[o]=[],t[o].push(e[i]))}return t},_clusterByKMeans:function(){var t=this._classifySymbols(),e={},i=this.getFeaturesInBounds(),o=0;if(this._map.getZoom()<Math.floor(this._map.getMaxZoom()/4)){for(var n in t){for(var l=[],s=0;s<t[n].length;s++)l.push(t[n][s]);var a=[];a.push(l),e[n]=a}return e}for(var r in this._map.getZoom()<Math.floor(this._map.getMaxZoom()/4*2)&&this._map.getZoom()>=Math.floor(this._map.getMaxZoom()/4)?o=Math.floor(i.length/6)>1?Math.floor(i.length/2):2:this._map.getZoom()>=Math.floor(this._map.getMaxZoom()/4*2)&&this._map.getZoom()>=Math.floor(this._map.getMaxZoom()/4*3)?o=Math.floor(i.length/4)>1?Math.floor(i.length/2):2:this._map.getZoom()>=Math.floor(this._map.getMaxZoom()/4*3)&&(o=Math.floor(i.length/2)>1?Math.floor(i.length/2):2),t){for(var u=[],p=0;p<t[r].length;p++)u.push(t[r][p].latLngs[0]);if(t[r].length<=3){l=[];for(var h=[],c=0;c<t[r].length;c++)h.push(t[r][c]);l.push(h),e[r]=l}else{for(var y=ay(u,o),g=(y.kPoints,y.symbolUuidCluster),f=(l=[],0);f<g.length;f++){h=[];for(var d=0;d<g[f].length;d++){var m=g[f][d];h.push(t[r][m])}l.push(h)}e[r]=l}}return e},_clusterByBlockCluster:function(t){var e=this._classifySymbols(),i={};for(var o in e){var n=ry(this._map,e[o],t);i[o]=n}return i},setSymbolCluster:function(t,e){if(void 0!=t){this.isCluster=t,this.unitSize=e;var i={},o=this;if(t)i=this._clusterByBlockCluster(e);else{for(var n=0;n<this.features.length;n++)this.features[n]._clusterShowStatus="display";this._clearCircleRanges(),this._clearTextNode(),this._map.off("zoomend",function(){o.isCluster&&o.clusterByBlockCluster(e)})}for(var l in this._clearCircleRanges(),this._clearTextNode(),i)for(var s in i[l]){var a=i[l][s];for(var r in a){var u=this._getBlockCenter(a[r]),p=[];if(a[r].length>2)p=this._getShowSymbolIndexes(a[r]),this._setSymbolVisible(p,a[r]);else for(var h=0;h<a[r].length;h++)a[r][h]._clusterShowStatus="display";for(var c=-100,y=0;y<p.length;y++){var g=p[y],f=(a[r][g].latLngs[0].lat-u.lat)*(a[r][g].latLngs[0].lat-u.lat),d=(a[r][g].latLngs[0].lng-u.lng)*(a[r][g].latLngs[0].lng-u.lng),m=Math.sqrt(f+d);c<m&&(c=m)}a[r].length>2&&(this._createSymbolRange(u,c),this._createTextNote(u,a[r].length),this.showClusterRange&&this._addCircleRanges(),this.showClusterInfo&&this._addTextNode())}}this.update()}},setUnitSize:function(t){this.unitSize=t,this.isCluster&&this.setSymbolCluster(this.isCluster,t)},_getBlockCenter:function(t){for(var e={lat:0,lng:0},i=0;i<t.length;i++)e.lat=e.lat+t[i].latLngs[0].lat,e.lng=e.lng+t[i].latLngs[0].lng;return t.length?(e.lat=e.lat/t.length,e.lng=e.lng/t.length):(e.lat=0,e.lng=0),L.latLng(e.lat,e.lng)},_getShowSymbolIndexes:function(t){for(var e=[],i=0;i<t.length;i++)if(-1==e.indexOf(i)){var o={x:null,y:null,width:null,height:null};o.width=t[i].symbolSize?t[i].symbolSize.w:t[i].style.graphicWidth,o.height=t[i].symbolSize?t[i].symbolSize.h:t[i].style.graphicHeight;var n=this._map.latLngToContainerPoint(t[i].getLatLngs()[0]);o.x=n.x-o.width/2,o.y=n.y-o.height;for(var l=0;l<t.length;l++)if(i!=l&&-1==e.indexOf(l)){var s={x:null,y:null,width:null,height:null};s.width=t[l].symbolSize?t[l].symbolSize.w:t[l].style.graphicWidth,s.height=t[l].symbolSize?t[l].symbolSize.h:t[l].style.graphicHeight;var a=this._map.latLngToContainerPoint(t[l].getLatLngs()[0]);s.x=a.x-s.width/2,s.y=a.y-s.height,o.x<s.x+s.width&&o.x+o.width>s.x&&o.y<s.y+s.height&&o.y+o.height>s.y&&e.push(l)}}for(var r=[],u=0;u<t.length;u++)-1==e.indexOf(u)&&r.push(u);return r},setClusterRangeVisible:function(t){if(this.showClusterRange=t,t)this._addCircleRanges();else for(var e=0;e<this._circleRanges.length;e++)this._circleRanges[e].remove()},setClusterInfoVisible:function(t){if(this.showClusterInfo=t,t)this._addTextNode();else for(var e=0;e<this._clusterTextNode.length;e++)this._clusterTextNode[e][0].remove(),this._clusterTextNode[e][1].remove()},setClusterStyle:function(t){for(var e in t)switch(e){case"rangeColor":this.clusterStyle.rangeColor=t[e];for(var i=0;i<this._circleRanges.length;i++)this._circleRanges[i].setStyle({color:t[e]});break;case"fontBackgroundColor":this.clusterStyle.fontBackgroundColor=t[e];for(i=0;i<this._clusterTextNode.length;i++)for(var o=0;o<this._clusterTextNode[i].length;o++)this._clusterTextNode[i][o].remove();this._addTextNode();break;case"fontBackgroundBorderColor":this.clusterStyle.fontBackgroundBorderColor=t[e];for(o=0;o<this._clusterTextNode.length;o++)this._clusterTextNode[o][1].setStyle({color:t[e]})}},_getClusterCenter:function(t){for(var e=[],i=0;i<t.length;i++){for(var o={lat:0,lng:0},n=0;n<t[i].length;n++)o.lat=o.lat+t[i][n].latLngs[0].lat,o.lng=o.lng+t[i][n].latLngs[0].lng;t[i].length?(o.lat=o.lat/t[i].length,o.lng=o.lng/t[i].length):(o.lat=0,o.lng=0);var l=[new L.latLng(o.lat,o.lng)];e.push(l)}return e},_setSymbolVisible:function(t,e){for(var i=0;i<e.length;i++)-1==t.indexOf(i)?e[i]._clusterShowStatus="none":e[i]._clusterShowStatus="display"},_createSymbolRange:function(t,e){var i=this.getArc(t,e,0,2*Math.PI),o=L.polygon([i],{color:this.clusterStyle.rangeColor,smoothFactor:0});this._circleRanges.push(o)},_clearCircleRanges:function(){for(var t=0;t<this._circleRanges.length;t++)this._circleRanges[t].remove();this._circleRanges&&this._circleRanges.length&&0!=this._circleRanges.length&&this._circleRanges.splice(0,this._circleRanges.length)},_addCircleRanges:function(){for(var t=0;t<this._circleRanges.length;t++)this._circleRanges[t].addTo(this._map)},_createTextNote:function(t,e){var i=map.latLngToContainerPoint(t),o=L.point([i.x+20,i.y-20]),n=this._map.containerPointToLatLng(o),l=L.divIcon({html:"标号个数"+e,className:this.iconClass,iconSize:[80,40]}),s=L.marker([n.lat,n.lng],{icon:l}),a=[t,n],r=L.polyline(a,{color:this.clusterStyle.fontBackgroundBorderColor});this._clusterTextNode.push([s,r])},_clearTextNode:function(){for(var t=0;t<this._clusterTextNode.length;t++)for(var e=0;e<this._clusterTextNode[t].length;e++)this._clusterTextNode[t][e].remove();this._clusterTextNode&&this._clusterTextNode.splice(0,this._clusterTextNode.length)},_addTextNode:function(){for(var t=0;t<this._clusterTextNode.length;t++)for(var e=0;e<this._clusterTextNode[t].length;e++)this._clusterTextNode[t][e].addTo(this._map);for(var i=document.querySelectorAll("."+this.iconClass),o=0;o<i.length;o++)i[o].style.backgroundColor=this.clusterStyle.fontBackgroundColor,i[o].style.fontSize="small",i[o].style.border="1px solid "+this.clusterStyle.fontBackgroundBorderColor,i[o].style.width="80px",i[o].style.height="20px",i[o].style.textAlign="center",i[o].style.fontWeight="bold"},_createClusterSymbol:function(t,e){if(e){for(var i=L.supermap.plotting.getControl(this._map,this.serverUrl,{serviceParams:this.options.serviceParams}).getSymbolLibManager().findSymbolByCode(e.code),o=null,n=0;n<i.length;n++)i[n].libID==e.libID&&(o=i[n].icon);var l=e.symbolSize?e.symbolSize.w:e.style.graphicWidth,s=e.symbolSize?e.symbolSize.w:e.style.graphicHeight;o||(o=e.path);var a=L.icon({iconUrl:o,iconSize:[l,s]}),r=L.marker([t.lat,t.lng],{icon:a}).addTo(this._map);this._clusterMarkers.push(r)}},_clearClusterSymbol:function(){for(var t=0;t<this._clusterMarkers.length;t++)this._clusterMarkers[t].remove();this._clusterMarkers&&this._clusterMarkers.splice(0,this._clusterMarkers.length)},getArc:function(t,e,i,o){var n,l,s=[],a=o-i;a=a<0?a+2*Math.PI:a;for(var r=0;r<=300;r++){var u=i+a*r/300;n=t.lng+e*Math.cos(u),l=t.lat+e*Math.sin(u),s.push([l,n])}return s},getMarkerMinVisibleScale:function(){return null==this.markerMinVisibleScale&&(this.markerMinVisibleScale=0),this.markerMinVisibleScale},setMarkerMinVisibleScale:function(t){this.markerMinVisibleScale=t,this.markerMaxVisibleScale>1e-7&&this.markerMaxVisibleScale<t&&(this.markerMinVisibleScale=this.markerMaxVisibleScale)},getMarkerMaxVisibleScale:function(){return null==this.markerMaxVisibleScale&&(this.markerMaxVisibleScale=0),this.markerMaxVisibleScale},setMarkerMaxVisibleScale:function(t){this.markerMaxVisibleScale=t,this.markerMinVisibleScale>1e-7&&this.markerMinVisibleScale>t&&(this.markerMaxVisibleScale=this.markerMinVisibleScale)},clearMarkerVisibleScale:function(){this.markerMinVisibleScale=0,this.markerMaxVisibleScale=0,this._updatePath()},setGraphicZIndex:function(t){this.options.zIndex=t,this._renderer._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._renderer._container.style.zIndex=this.options.zIndex)},setVectorZIndex:function(t){this.options.vectorZIndex=t,this._vectorRenderer._container&&void 0!==this.options.vectorZIndex&&null!==this.options.vectorZIndex&&(this._vectorRenderer._container.style.zIndex=this.options.vectorZIndex)},_getSymbolTextsBoundsSize:function(t,e){for(var i=0;i<t.length;i++)for(var o=0;o<t[i].symbolTexts.length;o++)if(t[i].symbolTexts[o]._bounds&&t[i].symbolTexts[o].textContent==e)return t[i].symbolTexts[o]._bounds;return null},initialize:function(t,e,i){this._editLayer=new Uy(t+"_temportary",e,{layer:this}),i=i||{},L.Util.setOptions(this,i),this.cacheImages={},this.selectedFeatures=[],this.applyedFromServer=[],this.wait2AddFeatures=[],this.wait2CreateFeatures=new Map,this.createNumber=0,this.iterIndex=0,this.hasWait2Add=!1,this.name=t,this.serverUrl=e,this.features=[],this._graphics=[],this._vectors=[];var o=L.supermap.plotting.getControl(map,e);this._specialEffectManager=o.getSpecialEffectManager(),i&&i.clusterStyle||(this.clusterStyle={rangeColor:"#98bacb",fontBackgroundColor:"rgba(100, 149, 237, 0.5)",fontBackgroundBorderColor:"cornflowerblue"}),this.showClusterRange=!1,this.showClusterInfo=!1,this.iconClass="leaflet-cluster-textnode"+Math.floor(1e3*Math.random()).toString(),this._circleRanges=[],this._clusterTextNode=[]},getSymZoomScale:function(t){return 1},getEvents:function(){var t={click:this._handleClick,mousemove:this._onMapMouseMove,contextmenu:this._handleContextmenu};return this._map._zoomAnimated&&(t.zoomanim=this._zoomAnim),t},_zoomAnim:function(t){},_onMapMouseMove:function(t){var e=this._getGraphicsInBounds();if(0!==e.length)for(var i=0,o=e.length;i<o;i++){if(e[i]._containsPoint(this._map.latLngToLayerPoint(t.latlng))){this._renderer._container.style.cursor=e[i].feature.isSelected?"move":"pointer";break}this._renderer._container.style.cursor=""}var n=this._getLayersInBounds();if(0!==n.length)for(var l=0,s=n.length;l<s;l++){for(var a=!1,r=0;r<n[l].components.length;r++)if(n[l].components[r]._containsPoint(this._map.latLngToLayerPoint(t.latlng))){a=!0;break}if(a){this._vectorRenderer._container.style.cursor=n[l].isSelected?"move":"pointer";break}this._vectorRenderer._container.style.cursor=""}},supportTypes:function(t,e){return t===SuperMap.Plot.SymbolType.DOTSYMBOL||t===SuperMap.Plot.SymbolType.PICTURE||t===SuperMap.Plot.SymbolType.MODELPLOT||3e3===t||t===SuperMap.Plot.SymbolType.SYMBOLTEXT||t===SuperMap.Plot.SymbolType.SYMBOLTEXT1||t===SuperMap.Plot.SymbolType.LINERELATION||t===SuperMap.Plot.SymbolType.ALGOSYMBOL||null!=e&&0===e},isGraphic:function(t){return t===SuperMap.Plot.SymbolType.DOTSYMBOL||t===SuperMap.Plot.SymbolType.PICTURE||t===SuperMap.Plot.SymbolType.MODELPLOT||3e3===t||t===SuperMap.Plot.SymbolType.SYMBOLTEXT||t===SuperMap.Plot.SymbolType.SYMBOLTEXT1||t===SuperMap.Plot.SymbolType.TEXTSYMBOL},isVector:function(t,e){return t===SuperMap.Plot.SymbolType.LINERELATION||t===SuperMap.Plot.SymbolType.ALGOSYMBOL||null!=e&&0===e&&t!=SuperMap.Plot.SymbolType.TEXTSYMBOL},addTo:function(t){return L.Path.prototype.addTo.call(this,t),window.hasBindSymbolClusterEvent||(this._map.on("zoomend",function(){if(this.isCluster)this.setSymbolCluster(this.isCluster,this.unitSize);else{if(!this.features)return;for(var t=0;t<this.features.length;t++)this.features[t]._clusterShowStatus="display"}}.bind(this)),this._map.on("mouseup",function(){if(this.isCluster)this.setSymbolCluster(this.isCluster,this.unitSize);else{if(!this.features)return;for(var t=0;t<this.features.length;t++)this.features[t]._clusterShowStatus="display"}}.bind(this)),window.hasBindSymbolClusterEvent=!0),this},getFeatureByUuid:function(t){var e=this.features.find(function(e,i,o){return e.uuid===t});return e||e},getFeatures:function(){return this.features.slice()},addFeatures:function(t){var e=this;L.Util.isArray(t)||(t=[t]);var i=t.length;if(this.batchCount<=1||null==this.batchCount){this._add(t);var o=setInterval(function(){e._checkGraphics()&&(clearInterval(o),e._updatePath(),e.isCluster&&e.setSymbolCluster(!0))},100)}else{for(var n=Math.floor(i/this.batchCount),l=0,s=[],a=[],r=0;r<i;r++)a.push(t[r]),(++l>=n||r==i-1)&&(s.push(a),a=[],l=0);this._clearLayersOutBounds(),this._redrawLayersInBounds(),this._renderer._ctx.clearRect(this._renderer._bounds.min.x,this._renderer._bounds.min.y,this._renderer._ctx.canvas.width,this._renderer._ctx.canvas.height);var u=0;this.addMovingTargetTimer&&(clearInterval(this.addMovingTargetTimer),this.addMovingTargetTimer=void 0),this.addMovingTargetTimer=setInterval(function(){e._add(s[u]),e._map&&e.getVisibility()&&e._renderer._drawPlottingGraphics(e._getCurGraphicsInBounds()),++u>=s.length&&(clearInterval(e.addMovingTargetTimer),e.addMovingTargetTimer=void 0)},1)}},_add:function(t){this._curgraphics=[];for(var e=0,i=t.length;e<i;e++){var o=t[e];if(this.supportTypes(o.symbolType,o.libID))if(this._featureUuid.find(function(t){return o.uuid===t})?(o.uuid=SuperMap.Plot.PlottingUtil.generateUuid(),this._featureUuid.push(o.uuid)):this._featureUuid.push(o.uuid),this.features.push(o),this.isGraphic(o.symbolType)){var n=new fy(o);n.onAdd(this),this._graphics.push(n),this._curgraphics.push(n)}else o.onAdd(this),this._vectors.push(o)}},_checkGraphics:function(){for(var t=0;t<this._graphics.length;t++){var e=this._graphics[t];if(this.features[t].symbolTexts.length>0&&e._image&&0==e._image.symbolTexts.length)return!1}return!0},removeFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=[],i=0,o=t.length;i<o;i++){var n=t[i];-1!=SuperMap.Util.indexOf(this.features,n)&&e.push(n)}this.fire(SuperMap.Plot.Event.beforefeaturesremoved,{features:e});for(var l=0,s=e.length;l<s;l++){var a=e[l],r=SuperMap.Util.indexOf(this.selectedFeatures,a);if(-1!==r&&(this._editLayer.removeFeatures(a),this.selectedFeatures.splice(r,1)),this._map&&this._map.getPlotEditControl()&&(this._map.getPlotEditControl().unselectFeatures(a),this._map.getPlotEditControl().disableEditFeatures(a)),a.symbolType!==SuperMap.Plot.SymbolType.SYMBOLTEXT&&a.symbolType!==SuperMap.Plot.SymbolType.SYMBOLTEXT1||a.removeSymbolTextsFromDotSymbol(a.associatedUuid),a.symbolType===SuperMap.Plot.SymbolType.LINERELATION&&(a.startAssociatedUuid&&a.removeJoinLineFromDotSymbol(a.startAssociatedUuid),a.endAssociatedUuid&&a.removeJoinLineFromDotSymbol(a.endAssociatedUuid)),null!=a.graphic&&a.graphic.layer===this){var u=a.graphic.getUuid();this.cacheImages[u]&&0==--this.cacheImages[u].imgCount&&delete this.cacheImages[u],-1!==(r=SuperMap.Util.indexOf(this._graphics,a.graphic))&&this._graphics.splice(r,1),a.graphic.onRemove()}else a._clearComponents();-1!==(r=SuperMap.Util.indexOf(this.features,a))&&this.features.splice(r,1),-1!==(r=SuperMap.Util.indexOf(this._vectors,a))&&this._vectors.splice(r,1)}this._updatePath(),this.fire(SuperMap.Plot.Event.featuresremoved,{features:e,layername:this.name});for(var p=0;p<e.length;p++)e[p].fire("featureremoved",{feature:e[p]})},removeAllFeatures:function(){this.fire(SuperMap.Plot.Event.beforefeaturesremoved,{features:this.features});for(var t=0;t<this.features.length;t++)this.features[t]._circleRanges&&(this._circleRanges=this._circleRanges.concat(this.features[t]._circleRanges)),this.features[t]._clusterTextNode&&(this._clusterTextNode=this._clusterTextNode.concat(this.features[t]._clusterTextNode)),this.features[t].fire("featureremoved",{feature:this.features[t]}),999===this.features[t].symbolType&&this.features[t].destroy();this.removeFeatures(this.features.slice()),this.fire(SuperMap.Plot.Event.featuresremoved,{features:this.features,layername:this.name}),this._clearCircleRanges(),this._clearTextNode(),this._circleRanges=[],this._clusterTextNode=[]},geoJsonToFeature:function(t,e){var i=this;i._editLayer.geoJsonToFeature(t,function(t){i._editLayer.removeFeatures(t.feature),i.addFeatures(t.feature),"function"==typeof e&&e({feature:t.feature})})},createSymbol:function(t,e,i,o,n,l,s,a){var r;if(l||(l={}),l.uuid=o,l.serverUrl=this.serverUrl,l.serviceParams=this.options.serviceParams,(void 0===l.symbolData||null===l.symbolData)&&SuperMap.Plot.AlgoSymbolFactory.isAccessServer(t,e)){var u=null,p=!1;if(Object.prototype.hasOwnProperty.call(l,"symbolRank")||Object.prototype.hasOwnProperty.call(l,"surroundLineType")?p=!0:u=this._getSymbolDataFromCache(t,e),!u||p){if(this.applyedFromServer.find(function(i){return t.toString()+"-"+e.toString()===i})){y=t.toString()+"-"+e.toString();this.wait2CreateFeatures.get(y)?this.wait2CreateFeatures.get(y).push({latlngs:i,options:l,style:n,custom:a}):(this.wait2CreateFeatures.set(y,[]),this.wait2CreateFeatures.get(y).push({latlngs:i,options:l,style:n,custom:a}))}else{var h=new SuperMap.GetSymbolInfoParameters({libID:t,code:e});i&&(h.inputPoints=L.Util.latLngsToSuperMapPoints(i)),Object.prototype.hasOwnProperty.call(l,"negativeImage")&&(h.negativeImage=l.negativeImage),Object.prototype.hasOwnProperty.call(l,"symbolRank")&&(h.symbolRank=l.symbolRank),Object.prototype.hasOwnProperty.call(l,"surroundLineType")&&(h.surroundLineType=l.surroundLineType);var c=Math.floor(1e3*Math.random());h.dynamicToken=c,L.supermap.symbolInfoService(this.serverUrl,this.options.serviceParams).getSymbolInfo(h,function(i){if(i.result.dynamicToken&&i.result.dynamicToken===SuperMap.MD5.md5(c.toString())){p||i.result.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL||(delete i.result.dynamicToken,this._cacheSymbolData(i.result));for(var o=i.result.libID.toString()+"-"+i.result.code.toString(),n=this.wait2CreateFeatures.get(o),l=0;l<n.length;l++){var a=this.wait2CreateFeatures.get(o)[l].latlngs,u=this.wait2CreateFeatures.get(o)[l].options;u.symbolData=SuperMap.Plot.PlottingUtil.cloneObject(i.result);var h=this.wait2CreateFeatures.get(o)[l].style,y=this.wait2CreateFeatures.get(o)[l].custom;r=L.supermap.plotting.PlottingObject.createSymbol(t,e,a,u,h,y),"function"==typeof s&&s({feature:r}),this.wait2AddFeatures.push(r),this.iterIndex++}this.iterIndex==this.createNumber&&(this.addFeatures(this.wait2AddFeatures),"function"==typeof callback2&&callback2({feature:r}),this.createNumber=0,this.iterIndex=0,this.applyedFromServer=[],this.wait2CreateFeatures=new Map,this.wait2AddFeatures=[])}},this);var y=t.toString()+"-"+e.toString();this.applyedFromServer.push(y),this.wait2CreateFeatures.get(y)?this.wait2CreateFeatures.get(y).push({latlngs:i,options:l,style:n,custom:a}):(this.wait2CreateFeatures.set(y,[]),this.wait2CreateFeatures.get(y).push({latlngs:i,options:l,style:n,custom:a}))}this.createNumber++}else l.symbolData=u,r=L.supermap.plotting.PlottingObject.createSymbol(t,e,i,l,n,a),this.addFeatures(r),"function"==typeof s&&s({feature:r})}},createSymbolText:function(t,e,i,o,n,l){n||(n={}),n.associatedUuid=t,n.symbolTexts=e,n.custom=l,n.uuid=i;var s=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.SYMBOLTEXT,[],n,o,l);return this.addFeatures(s),s},createSymbolText1:function(t,e,i,o,n,l){n||(n={}),n.associatedUuid=t,n.textContent=e,n.custom=l,n.uuid=i;var s=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.SYMBOLTEXT1,[],n,o,l);return this.addFeatures(s),s},createLineRelation:function(t,e,i,o,n,l,s){l||(l={}),l.startAssociatedUuid=t,l.endAssociatedUuid=e,l.lineRelationType=i,l.uuid=o,l.custom=s;var a=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.LINERELATION,null,l,n,s);return this.addFeatures(a),a},updateFeatures:function(t){L.Util.isArray(t)||(t=[t]);var e=[],i=this;t.map(function(t){return i.isGraphic(t.symbolType)?(t.graphic.update(),e.push(t.graphic),t.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&(e=e.concat(t.graphic.getAssociatedGraphics())),t):t}),this._redraw(e)},update:function(){this._clearLayersOutBounds(),this._redrawLayersInBounds(),this._renderer._ctx.clearRect(this._renderer._bounds.min.x,this._renderer._bounds.min.y,this._renderer._ctx.canvas.width,this._renderer._ctx.canvas.height);var t=this._getGraphicsInBounds();this._renderer._drawPlottingGraphics(t),this._updateDetectionRange(t)},redraw:function(){this._clearLayersOutBounds(),this._redrawLayersInBounds(),this._renderer._ctx.clearRect(this._renderer._bounds.min.x,this._renderer._bounds.min.y,this._renderer._ctx.canvas.width,this._renderer._ctx.canvas.height),this._renderer._drawPlottingGraphics(this._getGraphicsInBounds())},beforeAdd:function(t){L.Path.prototype.beforeAdd.call(this,t),this._vectorRenderer=L.svg(),t.hasLayer(this._vectorRenderer)||t.addLayer(this._vectorRenderer),this._vectorRenderer._container.style.zIndex=this.options.vectorZIndex,this._renderer=L.canvas(),t.hasLayer(this._renderer)||t.addLayer(this._renderer),this._renderer._container.style.zIndex=this.options.zIndex},onAdd:function(){L.Path.prototype.onAdd.call(this),this._map.addLayer(this._editLayer);var t=this;this._map.on("zoomend",function(){if(t.getLocked()||!t.getEditable())for(var e=0;e<t.selectedFeatures.length;e++)t.selectedFeatures[e].fire(SuperMap.Plot.Event.reseteditmarkersvalues);t._getRedrawWhenZoom()&&(t._renderer._ctx.clearRect(t._renderer._bounds.min.x,t._renderer._bounds.min.y,t._renderer._ctx.canvas.width,t._renderer._ctx.canvas.height),t._renderer._drawPlottingGraphics(t._getGraphicsInBounds()));var i=t.getAllSymbolGroups();for(e=0;e<i.length;e++)i[e]._reView()})},onRemove:function(){L.Path.prototype.onRemove.call(this),map.hasLayer(this._vectorRenderer)&&map.removeLayer(this._vectorRenderer),map.hasLayer(this._renderer)&&map.removeLayer(this._renderer),this._map.removeLayer(this._editLayer)},getRenderer:function(t){return t!==SuperMap.Plot.SymbolType.DOTSYMBOL&&t!==SuperMap.Plot.SymbolType.SYMBOLTEXT&&t!==SuperMap.Plot.SymbolType.SYMBOLTEXT1&&t!==SuperMap.Plot.SymbolType.PICTURE&&t!==SuperMap.Plot.SymbolType.MODELPLOT&&3e3!==t&&t!==SuperMap.Plot.SymbolType.TEXTSYMBOL?this._vectorRenderer:this._renderer},getFeaturesInBounds:function(){var t=[],e=this,i=this._map.getBounds();return this._graphics.map(function(e){return"none"!==e.feature.style.display&&i.contains(e.getLatLng())?t.push(e.feature):"none"!==e.feature.style.display&&null!=e.feature.trajectory&&e.feature.trajectory.getDisplayLatLngs(i).length>0&&t.push(e.feature),e}),this._vectors.map(function(o){return o.getBounds().isValid()&&e._intersects(i,o.getLatLngs())&&t.push(o),o}),t},_redraw:function(t){var e=this,i=setInterval(function(){if(e._checkGraphics()){clearInterval(i);var o=[];null!=t&&SuperMap.Util.isArray(t)?o=o.concat(t):null!=t&&t instanceof fy&&o.push(t);var n=e;n._renderer._redrawBounds&&(n._renderer._redrawBounds.min._floor(),n._renderer._redrawBounds.max._ceil(),n._renderer._clear(),n._renderer._ctx.clearRect(n._renderer._bounds.min.x,n._renderer._bounds.min.y,n._renderer._ctx.canvas.width,n._renderer._ctx.canvas.height),n._graphics.map(function(t){return null!=t._pxBounds&&t._pxBounds.intersects(n._renderer._redrawBounds)&&-1===SuperMap.Util.indexOf(o,t)&&o.push(t),t}),n._renderer._drawPlottingGraphics(o))}},100)},_update:function(){},_containsPoint:function(){return!1},_updatePath:function(){this._map&&this.getVisibility()&&(this._clearLayersOutBounds(),this._redrawLayersInBounds(),this._featureUuid=[],this._renderer._ctx.clearRect(this._renderer._bounds.min.x,this._renderer._bounds.min.y,this._renderer._ctx.canvas.width,this._renderer._ctx.canvas.height),this._renderer._drawPlottingGraphics(this._getGraphicsInBounds()))},_project:function(){var t=this;t._pxBounds=L.bounds(L.point(0,0),L.point(0,0)),t._getGraphicsInBounds().map(function(e){return e._project(),null!=e._pxBounds&&(t._pxBounds.extend(e._pxBounds.min),t._pxBounds.extend(e._pxBounds.max)),e}),t._getLayersInBounds().map(function(e){return e._project(),t._pxBounds.extend(e._pxBounds.min),t._pxBounds.extend(e._pxBounds.max),e})},_updateDetectionRange:function(t){var e=this;Object.keys(e._detectionRangeCombinations).forEach(function(i){for(var o=e._detectionRangeCombinations[i],n=[],l=0;l<o.features.length;l++)-1!=L.Util.indexOf(t,o.features[l].graphic)&&(n.push(L.Util.latLngsToSuperMapPoints(o.features[l].graphic._detectionRangePoints)),null!=o.features[l].graphic._detectionRange&&(e._removeDetectionRange(o.features[l].graphic._detectionRange),delete o.features[l].graphic._detectionRange,o.features[l].graphic._detectionRange=null));var s=SuperMap.Plot.PlottingUtil.getEnvelopePoints(n);if(null!=o.detectionRanges&&o.detectionRanges.length>0){for(l=0;l<o.detectionRanges.length;l++)e._removeDetectionRange(o.detectionRanges[l]),delete o.detectionRanges[l],o.detectionRanges[l]=null;o.detectionRanges.length=0}else o.detectionRanges=[];for(l=0;l<s.length;l++){var a=L.polygon(L.Util.superMapPointsToLatLngs(s[l]),{color:o.style.color,weight:o.style.weight,opacity:o.style.opacity,fill:o.style.fill,fillColor:o.style.fillColor,fillOpacity:o.style.fillOpacity,smoothFactor:0});e._addDetectionRange(a),o.detectionRanges.push(a)}})},_getGraphicsInBounds:function(){var t=this,e=this,i=[],o=e._map.getBounds();return this._graphics.map(function(n){var l=n.feature.getLatLngs()[0],s=t._getSymbolTextBoundPts(n,e);if("none"!==n.feature.style.display&&"none"!==n.feature._clusterShowStatus)if(0==s.length)o.contains(l)&&(null!=n.getImage()&&n.getUuid()===n.getImage().generateUuidFromFeature()||n.update(),i.push(n));else for(var a=0;a<s.length;a++)if(o.contains(s[a])||o.contains(l)){null!=n.getImage()&&n.getUuid()===n.getImage().generateUuidFromFeature()||n.update(),i.push(n);break}return n}),i},_getCurGraphicsInBounds:function(){var t=this,e=this,i=[],o=e._map.getBounds();return this._curgraphics.map(function(n){var l=n.feature.getLatLngs()[0],s=t._getSymbolTextBoundPts(n,e);if("none"!==n.feature.style.display&&"none"!==n.feature._clusterShowStatus)if(0==s.length)o.contains(l)&&(null!=n.getImage()&&n.getUuid()===n.getImage().generateUuidFromFeature()||n.update(),i.push(n));else for(var a=0;a<s.length;a++)if(o.contains(s[a])||o.contains(l)){null!=n.getImage()&&n.getUuid()===n.getImage().generateUuidFromFeature()||n.update(),i.push(n);break}return n}),i},_getSymbolTextBoundPts:function(t,e){var i=[];if(t.feature.symbolTexts.length>0){var o=t.feature.getLatLngs()[0],n=e._map.latLngToLayerPoint(o),l=t.feature.symbolTexts[0].offsetX,s=t.feature.symbolTexts[0].offsetY;n.x=n.x+l,n.y=n.y+s,i.push(n);var a=n.clone();a.x=a.x+100,a.y=a.y+100,i.push(a);var r=n.clone();r.x=r.x-100,r.y=r.y-100,i.push(r);var u=n.clone();u.x=u.x+100,u.y=u.y-100,i.push(u);var p=n.clone();p.x=p.x-100,p.y=p.y+100,i.push(p);for(var h=0;h<i.length;h++)i[h]=e._map.layerPointToLatLng(i[h])}return i},_getRedrawWhenZoom:function(){var t=!1,e=this._map.getBounds();return this._graphics.map(function(i){return"none"!==i.feature.style.display&&e.contains(i.getLatLng())&&i.feature.symbolTexts.length>0&&(i.feature.layer.getMarkerMinVisibleScale()>0||i.feature.layer.getMarkerMaxVisibleScale()>0)&&(t=!0),i}),t},_getLayersInBounds:function(){var t=this,e=[],i=t._map.getBounds();return this._vectors.map(function(o){return o.getBounds().isValid()&&t._intersects(i,o.getLatLngs())&&e.push(o),o}),e},_clearLayersOutBounds:function(){var t=this,e=t._map.getBounds();this._vectors.map(function(i){return i.getBounds().isValid()&&!t._intersects(e,i.getLatLngs())&&i._clearComponents(),i})},_redrawLayersInBounds:function(){var t=this,e=t._map.getBounds();this._vectors.map(function(i){return!i.getBounds().isValid()&&t._intersects(e,i.getLatLngs())&&i.redraw(),i})},_intersects:function(t,e){for(var i=0;i<e.length;i++)if(t.contains(e[i]))return!0;return!1},_addTrajectory:function(t){t._map=this._map,t._renderer=this._vectorRenderer,t.addEventParent(this),t.onAdd()},_removeTrajectory:function(t){t.removeEventParent(this),t.onRemove()},_addDetectionRange:function(t){t._map=this._map,t._renderer=this._vectorRenderer,t.addEventParent(this),t.onAdd()},_removeDetectionRange:function(t){t.removeEventParent(this),t.onRemove()},_handleClick:function(t){if(this.notHandleClick)this.notHandleClick=!1;else{var e=this;if(!1!==e.isSelected&&!1!==e.visibility){e._editLayer.markerMinVisibleScale=e.markerMinVisibleScale,e._editLayer.markerMaxVisibleScale=e.markerMaxVisibleScale;var i=e.selectedFeatures.slice();e.selectedFeatures.length>0&&!1===t.originalEvent.ctrlKey&&(!0===e.isEditable&&!1===e.isLocked&&e._map&&e._map.getPlotEditControl()&&(e._editLayer.removeFeatures(e.selectedFeatures),e.addFeatures(e.selectedFeatures)),e._map.getPlotEditControl().disableEditFeatures(e.selectedFeatures),e.selectedFeatures.length=0);for(var o=e.getFeaturesInBounds(),n=0,l=o.length;n<l;n++){var s=!1;if(null!=o[n].graphic&&o[n].graphic._containsPoint(e._map.latLngToLayerPoint(t.latlng))&&(s=!0),null==o[n].graphic&&o[n].components.length>0)for(var a=0;a<o[n].components.length;a++)if(o[n].components[a]._containsPoint(e._map.latLngToLayerPoint(t.latlng))){s=!0;break}if(s){if(!0===t.originalEvent.altKey&&!0!==t.originalEvent.ctrlKey&&-1!==SuperMap.Util.indexOf(i,o[n]))continue;if(null===e._map.getPlotEditControl())continue;!1===t.originalEvent.ctrlKey&&e._map.getPlotEditControl().unselectFeatures();var r=[];!0===L.supermap.plotting.getControl().getTouchMode()&&e._map&&e._map.getPlotEditControl()&&!0===e._map.getPlotEditControl()._isMultiSelect&&(r=r.concat(i.slice())),r.push(o[n]),!0===e.isEditable&&!1===e.isLocked&&e._map&&e._map.getPlotEditControl()&&(e.removeFeatures(r),e._editLayer.addFeatures(r));for(var u=!0,p=0;p<r.length;p++)r[p].layer.isMovingTargetLayer&&r[p].type==SuperMap.Plot.SymbolType.CLUSTEROBJECT&&(u=!1);if(u&&e._map.getPlotEditControl().enableEditFeatures(r),e._map.getPlotEditControl().selectFeatures(r),e.selectedFeatures=e.selectedFeatures.concat(r),e._map&&e._map.getPlotEditControl()&&(e._map.getPlotEditControl()._onTriggerMapClick=!1),!0!==t.originalEvent.ctrlKey)break}}i.length>0&&(this.fire(SuperMap.Plot.Event.movingtargetsunselected,{features:i}),i.length=0),this.selectedFeatures.length>0&&this.fire(SuperMap.Plot.Event.movingtargetsselected,{features:e.selectedFeatures}),L.DomEvent.stopPropagation(t)}}},_handleContextmenu:function(t){if(!1!==this.isSelected&&!1!==this.visibility){for(var e=this.getFeaturesInBounds(),i=0,o=e.length;i<o;i++){var n=!1;if(null!=e[i].graphic&&e[i].graphic._containsPoint(this._map.latLngToLayerPoint(t.latlng))&&(n=!0),null==e[i].graphic&&e[i].components.length>0)for(var l=0;l<e[i].components.length;l++)if(e[i].components[l]._containsPoint(this._map.latLngToLayerPoint(t.latlng))){n=!0;break}if(n){this.fire(SuperMap.Plot.Event.movingtargetcontextmenu,{features:[e[i]]});break}}L.DomEvent.stopPropagation(t)}},_getSymbolDataFromCache:function(t,e){var i=L.supermap.plotting.getControl(this._map,this.serverUrl,{serviceParams:this.options.serviceParams}).getSymbolLibManager().getSymbolLibByLibId(t);return null!==i?i.getSymbolData(e):null},_cacheSymbolData:function(t){var e=L.supermap.plotting.getControl(this._map,this.serverUrl,{serviceParams:this.options.serviceParams}).getSymbolLibManager().getSymbolLibByLibId(t.libID);null!==e&&e.cacheSymbolData(t)},_generateFromFeature:function(t){var e="";if(t.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL){if(e=t.libID.toString()+"_"+t.code.toString()+"_"+Math.round(t.symbolSize.w).toString()+"_"+Math.round(t.symbolSize.h).toString()+"_"+t.textContent+"_"+t.annotationPosition.toString()+"_"+t.dRotate.toString()+this._styleToString(t.style)+"_"+t.textDisplay.toString()+"_"+t.surroundLineType.toString(),null!=t.symbolTexts&&t.symbolTexts.length>0)for(var i=0;i<t.symbolTexts.length;i++)e+=this._symbolTextToString(t.symbolTexts[i]);if(null!=t.bloodVolumes&&t.bloodVolumes.length>0)for(var o=0;o<t.bloodVolumes.length;o++)e+=this._bloodVolumeToString(t.bloodVolumes[o]);if(null!=t.pictureFrames&&t.pictureFrames.length>0)for(var n=0;n<t.pictureFrames.length;n++)e+=this._pictureFrameToString(t.pictureFrames[n])}else t.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT?(e=t.libID.toString()+"_"+t.code.toString()+"_"+t.associatedUuid+"_"+t.addFrame.toString(),1===t.symbolTexts.length&&(e+=this._symbolTextToString(t.symbolTexts[0]))):t.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT1&&(e=t.libID.toString()+"_"+t.code.toString()+"_"+t.associatedUuid+"_"+t.textContent+"_"+t.space.toString()+"_"+t.offsetX.toString()+"_"+t.offsetY.toString()+this._styleToString(t.style));return e},_symbolTextToString:function(t){var e="";return null!=t.textContent&&(e+="_"+t.textContent),null!=t.textPosition&&(e+="_"+t.textPosition.toString()),null!=t.offsetX&&(e+="_"+t.offsetX.toString()),null!=t.offsetY&&(e+="_"+t.offsetY.toString()),null!=t.border&&(e+="_"+t.border.toString()),null!=t.showRelationLine&&(e+="_"+t.showRelationLine.toString()),null!=t.paddingX&&(e+="_"+t.paddingX.toString()),null!=t.paddingY&&(e+="_"+t.paddingY.toString()),null!=t.style&&(e+=this._styleToString(t.style)),null!=t.lineStyle&&(null!=t.lineStyle.color&&(e+="_"+t.lineStyle.color),null!=t.lineStyle.lineSymbolID&&(e+="_"+t.lineStyle.lineSymbolID),null!=t.lineStyle.opacity&&(e+="_"+t.lineStyle.opacity),null!=t.lineStyle.weight&&(e+="_"+t.lineStyle.weight)),e},_bloodVolumeToString:function(t){var e="";return null!=t.volume&&(e+="_"+t.volume),null!=t.position&&(e+="_"+t.position.toString()),null!=t.offsetX&&(e+="_"+t.offsetX.toString()),null!=t.offsetY&&(e+="_"+t.offsetY.toString()),null!=t.width&&(e+="_"+t.width.toString()),null!=t.height&&(e+="_"+t.height.toString()),null!=t.style&&(null!=t.style.color&&(e+="_"+t.style.color),null!=t.style.opacity&&(e+="_"+t.style.opacity.toString()),null!=t.style.weight&&(e+="_"+t.style.weight.toString()),null!=t.style.remainingVolumeColor&&(e+="_"+t.style.remainingVolumeColor),null!=t.style.remainingVolumeOpacity&&(e+="_"+t.style.remainingVolumeOpacity.toString()),null!=t.style.consumeVolumeColor&&(e+="_"+t.style.consumeVolumeColor),null!=t.style.consumeVolumeOpacity&&(e+="_"+t.style.consumeVolumeOpacity.toString())),e},_pictureFrameToString:function(t){var e="";return null!=t.path&&(e+="_"+t.path),null!=t.position&&(e+="_"+t.position.toString()),null!=t.offsetX&&(e+="_"+t.offsetX.toString()),null!=t.offsetY&&(e+="_"+t.offsetY.toString()),null!=t.width&&(e+="_"+t.width.toString()),null!=t.height&&(e+="_"+t.height.toString()),e},_styleToString:function(t){var e="";return null!=t.fontFamily&&(e+="_"+t.fontFamily),null!=t.fontSize&&(e+="_"+t.fontSize),null!=t.fontColor&&(e+="_"+t.fontColor),null!=t.fontStroke&&(e+="_"+t.fontStroke),null!=t.fontStrokeColor&&(e+="_"+t.fontStrokeColor),null!=t.fontStrokeWidth&&(e+="_"+t.fontStrokeWidth),null!=t.fontBackground&&(e+="_"+t.fontBackground),null!=t.fontBackgroundColor&&(e+="_"+t.fontBackgroundColor),null!=t.fontShadow&&(e+="_"+t.fontShadow),null!=t.fontShadowColor&&(e+="_"+t.fontShadowColor),null!=t.fontShadowOffsetX&&(e+="_"+t.fontShadowOffsetX),null!=t.fontShadowOffsetY&&(e+="_"+t.fontShadowOffsetY),null!=t.color&&(e+="_"+t.color),null!=t.weight&&(e+="_"+t.weight),null!=t.opacity&&(e+="_"+t.opacity),null!=t.lineSymbolID&&(e+="_"+t.lineSymbolID),null!=t.dashArray&&(e+="_"+t.dashArray),null!=t.fill&&(e+="_"+t.fill),null!=t.fillSymbolID&&(e+="_"+t.fillSymbolID),null!=t.fillColor&&(e+="_"+t.fillColor),null!=t.fillOpacity&&(e+="_"+t.fillOpacity),null!=t.fillBackColor&&(e+="_"+t.fillBackColor),null!=t.fillBackOpacity&&(e+="_"+t.fillBackOpacity),null!=t.fillGradientMode&&(e+="_"+t.fillGradientMode),e}});L.supermap.plotting.movingTargetLayer=function(t,e,i){return new gy(t,e,i)},L.supermap.plotting.MovingTargetLayer=gy;var fy=L.Class.extend({_image:null,_lastPos:null,_lastImage:null,_latlng:null,_uuid:null,_trajectoryLine:null,_trajectoryPoints:null,_trajectoryPointGraphic:{},_detectionRange:null,_detectionRangePoints:null,_rotation:null,_lastLatLngs:[],options:{graphicWidth:0,graphicHeight:0},initialize:function(t,e){e=e||{},this.feature=t,t.graphic=this,this._latlng=e._latlng,this._image=e._image,this._uuid=e._uuid,this._rotation=0,this._trajectoryPoints=[]},onAdd:function(t){this.feature.movingTarget=!0,this.feature._map=t._map,this.feature.layer=t,this.layer=t,this._renderer=t._renderer,this._map=t._map,this.update()},onRemove:function(){null!=this._trajectoryLine&&this.layer instanceof gy&&this.layer._removeTrajectory(this._trajectoryLine);for(var t=0;t<this._trajectoryPoints.length;t++)this.layer._removeTrajectory(this._trajectoryPoints[t]);null!=this._detectionRange&&this.layer instanceof gy&&this.layer._removeDetectionRange(this._detectionRange),this.feature._clearComponents(),this.layer=null,this._renderer=null,this._map=null,delete this.feature.graphic,delete this.feature.movingTarget},redraw:function(){null!=this.layer&&null!=this._renderer&&this.layer.getVisibility()&&this.layer.updateFeatures(this.feature)},update:function(){var t=this;if(null!=this.layer&&null!=this._renderer&&this.layer.isGraphic(this.feature.symbolType)){if(this.feature.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT||this.feature.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT1){var e=this._map.getFeatureByUuid(this.feature.associatedUuid);if(null==e||"none"===e.style.display)return}this._project(),this.layer._renderer._extendRedrawBounds(this);var i=this.feature.getLatLngs()[0];if(this.feature.symbolTexts.length>0){var o=this.feature.getLatLngs()[0],n=this._map.latLngToLayerPoint(o),l=this.feature.symbolTexts[0].offsetX,s=this.feature.symbolTexts[0].offsetY;n.x=n.x+l,n.y=n.y+s,i=this._map.layerPointToLatLng(n)}if("function"==typeof this.layer.getVisibility&&!0===this.layer.getVisibility()&&"none"!==this.feature.style.display&&this._map.getBounds().contains(i)){var a=this._uuid,r="";if(null!=this._image?r=this._image.generateUuidFromFeature():(this._image=new Qg(this.feature),r=this._image.generateUuidFromFeature()),a!==r){if(this.layer.cacheImages[a]&&0==--this.layer.cacheImages[a].imgCount&&delete this.layer.cacheImages[a],this.layer.cacheImages[r])this._cloneImage(r);else{null==this._image&&(this._image=new Qg(this.feature)),this._image.render();var u=setInterval(function(){t._checkGraphics()&&(clearInterval(u),t.layer&&t.layer.cacheImages&&(t.layer.cacheImages[r]={img:t._image.getCacheInfo(),imgCount:1}))},10)}this._uuid=r}else this.layer.cacheImages[r]&&!this.layer.cacheImages[r].img&&(this.layer.cacheImages[r]={img:this._image.getCacheInfo(),imgCount:1},this._updateAll())}if(this.setLatLng(this.feature.getLatLngs()[0]),this.feature.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL){if(this.feature.layer instanceof gy){var p=this._map.getScale();(0==p||this.feature.layer.getVisibility()&&("function"!=typeof this.feature.layer.getMarkerMinVisibleScale&&"function"!=typeof this.feature.layer.getMarkerMaxVisibleScale||"function"==typeof this.feature.layer.getMarkerMinVisibleScale&&"function"!=typeof this.feature.layer.getMarkerMaxVisibleScale&&(p>=this.feature.layer.getMarkerMinVisibleScale()||0===this.feature.layer.getMarkerMinVisibleScale())||"function"!=typeof this.feature.layer.getMarkerMinVisibleScale&&"function"==typeof this.feature.layer.getMarkerMaxVisibleScale&&(0===this.feature.layer.getMarkerMaxVisibleScale()||p<=this.feature.layer.getMarkerMaxVisibleScale())||"function"==typeof this.feature.layer.getMarkerMinVisibleScale&&"function"==typeof this.feature.layer.getMarkerMaxVisibleScale&&0===this.feature.layer.getMarkerMaxVisibleScale()&&p>=this.feature.layer.getMarkerMinVisibleScale()||"function"==typeof this.feature.layer.getMarkerMinVisibleScale&&"function"==typeof this.feature.layer.getMarkerMaxVisibleScale&&0===this.feature.layer.getMarkerMinVisibleScale()&&p<=this.feature.layer.getMarkerMaxVisibleScale()||"function"==typeof this.feature.layer.getMarkerMinVisibleScale&&"function"==typeof this.feature.layer.getMarkerMaxVisibleScale&&(0===this.feature.layer.getMarkerMinVisibleScale()&&0===this.feature.layer.getMarkerMaxVisibleScale()||p>=this.feature.layer.getMarkerMinVisibleScale()&&p<=this.feature.layer.getMarkerMaxVisibleScale())))&&this._updateSymbolTexts()}else this._updateSymbolTexts();this._updateJoinLines(),null==this._lastPos?this._lastPos=L.latLng(this._latlng.lat,this._latlng.lng):(this._lastPos.lat=this._latlng.lat,this._lastPos.lng=this._latlng.lng),null==this._lastImage&&null!=this._image?this._lastImage=[this._image.size[0],this._image.size[1]]:null!=this._image&&(this._lastImage[0]=this._image.size[0],this._lastImage[1]=this._image.size[1])}}},_checkGraphics:function(){var t=!1;return this._image&&0==this._image.symbolTexts.length&&this._image.feature.symbolTexts.length>0?t=!1:this._image&&this._image.feature.symbolTexts.length>0&&this._image.symbolTexts.length==this._image.feature.symbolTexts.length?t=!0:this._image&&0==this._image.symbolTexts.length&&0==this._image.feature.symbolTexts.length&&(t=!0),t},_updateAll:function(){for(var t=0;t<this.layer._graphics.length;t++){var e=this.layer._graphics[t],i=e._uuid;e._image&&e._image.symbolTexts.length>0||this.layer.cacheImages[i]&&e._cloneImage(i)}},getAssociatedGraphics:function(){for(var t=[],e=0;e<this.feature.geoSymbolTexts.length;e++){var i=this.feature.geoSymbolTexts[e];null!==i&&(null!=i.graphic&&null!=i.graphic.layer&&t.push(i.graphic))}return t},_updateSymbolTexts:function(){if(null!=this.feature.geoSymbolTexts&&0!==this.feature.geoSymbolTexts.length&&(null==this._lastPos||this._lastPos.lat!==this._latlng.lat||this._lastPos.lng!==this._latlng.lng||null==this._lastImage||this._lastImage[0]!=this._image.size[0]||this._lastImage[1]!=this._image.size[1]))for(var t=0;t<this.feature.geoSymbolTexts.length;t++){var e=this.feature.geoSymbolTexts[t];null!==e&&(null!=e.graphic&&null!=e.graphic.layer&&"none"!==e.style.display&&(e.graphic._project(),this._renderer._extendRedrawBounds(e.graphic),e._calculatePositionPoints(),e.graphic.update()))}},_updateJoinLines:function(){if(null!=this.feature.joinLines&&0<this.feature.joinLines.length&&(null==this._lastPos||this._lastPos.lat!==this._latlng.lat||this._lastPos.lng!==this._latlng.lng))for(var t=0;t<this.feature.joinLines.length;t++){var e=this.feature.joinLines[t];null!==e&&null!=e.layer&&("none"!==e.style.display&&e instanceof Dh&&e.redraw())}},setLatLng:function(t){if(this._latlng=t,this.layer instanceof gy&&(this.feature.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL||this.feature.symbolType===SuperMap.Plot.SymbolType.PICTURE||this.feature.symbolType===SuperMap.Plot.SymbolType.MODELPLOT||3e3===this.feature.symbolType)&&null!=this.feature.trajectory){if(this.feature.trajectory.addLatLng(t),"none"===this.feature.style.display||void 0!=this.feature._clusterShowStatus&&"none"==this.feature._clusterShowStatus){null!=this._trajectoryLine&&(this.layer._removeTrajectory(this._trajectoryLine),this._trajectoryLine=null);for(var e=0;e<this._trajectoryPoints.length;e++)this.layer._removeTrajectory(this._trajectoryPoints[e]),delete this._trajectoryPoints[e],this._trajectoryPoints[e]=null;return this._trajectoryPoints.length=0,void(null!=this._detectionRange&&(this.layer._removeTrajectory(this._detectionRange),this._detectionRange=null))}if(!0===this.feature.autoRotation&&this.feature.trajectory.latlngs.length>=2){var i=new SuperMap.Geometry.Point(this.feature.trajectory.latlngs[this.feature.trajectory.latlngs.length-2].lng,this.feature.trajectory.latlngs[this.feature.trajectory.latlngs.length-2].lat),o=new SuperMap.Geometry.Point(this.feature.trajectory.latlngs[this.feature.trajectory.latlngs.length-1].lng,this.feature.trajectory.latlngs[this.feature.trajectory.latlngs.length-1].lat),n=SuperMap.Plot.PlottingUtil.radian(i,o)*SuperMap.Plot.PlottingUtil.RTOD;this._rotation=n-90,this.feature.symbolType==SuperMap.Plot.SymbolType.DOTSYMBOL&&(this._rotation=n+180)}var l=this.feature.trajectory.getDisplayLatLngs(this._map.getBounds());if(!0===this.feature.trajectory.showTrackingLine?l.length<=1&&null!=this._trajectoryLine?(this.layer._removeTrajectory(this._trajectoryLine),delete this._trajectoryLine,this._trajectoryLine=null):l.length>1&&null===this._trajectoryLine?(this._trajectoryLine=L.polyline(l,{color:this.feature.trajectory.style.color,weight:this.feature.trajectory.style.weight,opacity:this.feature.trajectory.style.opacity}),this.layer._addTrajectory(this._trajectoryLine)):l.length>1&&null!==this._trajectoryLine&&(this._trajectoryLine.options.color===this.feature.trajectory.style.color&&this._trajectoryLine.options.weight===this.feature.trajectory.style.weight&&this._trajectoryLine.options.opacity===this.feature.trajectory.style.opacity||this._trajectoryLine.setStyle({color:this.feature.trajectory.style.color,weight:this.feature.trajectory.style.weight,opacity:this.feature.trajectory.style.opacity}),this._trajectoryLine.setLatLngs(l)):null!=this._trajectoryLine&&(this.layer._removeTrajectory(this._trajectoryLine),this._trajectoryLine=null),!0===this.feature.trajectory.showTrackingPoint){if(0===l.length&&this._trajectoryPoints.length>0){for(var s=0;s<this._trajectoryPoints.length;s++)this.layer._removeTrajectory(this._trajectoryPoints[s]),delete this._trajectoryPoints[s],this._trajectoryPoints[s]=null;this._trajectoryPoints.length=0}else if(l.length>0){var a=this.feature.trajectory.generateUuidKey(),r=[];if(Object.prototype.hasOwnProperty.call(this._trajectoryPointGraphic,a))for(var u=0;u<this._trajectoryPoints.length;){var p=SuperMap.Util.indexOf(l,this._trajectoryPoints[u].getLatLngs()[0]);-1!==p?(r.push(p),u++):(this.layer._removeTrajectory(this._trajectoryPoints[u]),delete this._trajectoryPoints[u],this._trajectoryPoints[u]=null,this._trajectoryPoints.splice(u,1))}else{for(var h=0;h<this._trajectoryPoints.length;h++)this.layer._removeTrajectory(this._trajectoryPoints[h]),delete this._trajectoryPoints[h],this._trajectoryPoints[h]=null;this._trajectoryPoints.length=0}for(var c=0;c<l.length;c++)if(-1===SuperMap.Util.indexOf(r,c)){var y={externalGraphic:this._generateTrackingPointImage(this.feature.trajectory.trackingPointStyle,this.feature.trajectory.trackingPointRadius,this.feature.trajectory.style,a),graphicWidth:2*this.feature.trajectory.trackingPointRadius,graphicHeight:2*this.feature.trajectory.trackingPointRadius},g=L.supermap.plotting.pointImage([l[c]],y);this.layer._addTrajectory(g),this._trajectoryPoints.push(g)}}}else{for(var f=0;f<this._trajectoryPoints.length;f++)this.layer._removeTrajectory(this._trajectoryPoints[f]),delete this._trajectoryPoints[f],this._trajectoryPoints[f]=null;this._trajectoryPoints.length=0}if(null!=this.feature.detectionRange)if(null==this.feature.detectionRange.style||null==this.feature.detectionRange.style.display||"none"!==this.feature.detectionRange.style.display){if(null!=this.feature.detectionRange.radius&&this.feature.detectionRange.radius>0||null!=this.feature.detectionRange.pixelRadius&&this.feature.detectionRange.pixelRadius>0||null!=this.feature.detectionRange.points&&this.feature.detectionRange.points.length>0){if(this._detectionRangePoints=[],null!=this.feature.detectionRange.radius&&this.feature.detectionRange.radius>0)if(0==this.feature.detectionRange.detectionType)for(var d=0;d<=360;d+=5){var m=SuperMap.Plot.PlottingUtil.destinationVincenty(L.latLng(this._latlng.lat,this._latlng.lng),360-d+90,1e3*this.feature.detectionRange.radius);this._detectionRangePoints.push(m)}else{var S=this.getSectorPoint(L.latLng(this._latlng.lat,this._latlng.lng),10,this._rotation-20,this._rotation+20);this._detectionRangePoints.push(S)}else if(null!=this.feature.detectionRange.pixelRadius&&this.feature.detectionRange.pixelRadius>0){for(var P=new SuperMap.Geometry.Point(this._latlng.lng,this._latlng.lat),b=[],v=0;v<72;v++){var M=(5*v+1)*Math.PI/180,_=new SuperMap.Geometry.Point(Math.cos(M)*this.feature.detectionRange.pixelRadius+P.x,Math.sin(M)*this.feature.detectionRange.pixelRadius+P.y);b.push(_)}this._detectionRangePoints=detectionLatlngs.concat(L.Util.superMapPointsToLatLngs(b))}else null!=this.feature.detectionRange.points&&this.feature.detectionRange.points.length>0&&(this._detectionRangePoints=detectionLatlngs.concat(L.Util.superMapPointsToLatLngs(this.feature.detectionRange.points)));null==this.feature.composeDetectionRange?null==this._detectionRange?(this._detectionRange=L.polygon(this._detectionRangePoints,{color:this.feature.detectionRange.style.color,weight:this.feature.detectionRange.style.weight,opacity:this.feature.detectionRange.style.opacity,fill:this.feature.detectionRange.style.fill,fillColor:this.feature.detectionRange.style.fillColor,fillOpacity:this.feature.detectionRange.style.fillOpacity,smoothFactor:0}),this.layer._addDetectionRange(this._detectionRange)):(this._detectionRange.options.color===this.feature.detectionRange.style.color&&this._detectionRange.options.weight===this.feature.detectionRange.style.weight&&this._detectionRange.options.opacity===this.feature.detectionRange.style.opacity&&this._detectionRange.options.fill===this.feature.detectionRange.style.fill&&this._detectionRange.options.fillColor===this.feature.detectionRange.style.fillColor&&this._detectionRange.options.fillOpacity===this.feature.detectionRange.style.fillOpacity||this._detectionRange.setStyle({color:this.feature.detectionRange.style.color,weight:this.feature.detectionRange.style.weight,opacity:this.feature.detectionRange.style.opacity,fill:this.feature.detectionRange.style.fill,fillColor:this.feature.detectionRange.style.fillColor,fillOpacity:this.feature.detectionRange.style.fillOpacity}),this._detectionRange.setLatLngs(this._detectionRangePoints)):null!=this._detectionRange&&(this.layer._removeDetectionRange(this._detectionRange),delete this._detectionRange,this._detectionRange=null)}}else null!=this._detectionRange&&(this.layer._removeDetectionRange(this._detectionRange),delete this._detectionRange,this._detectionRange=null)}else if(!0===this.feature.autoRotation&&(this.addLatLng(t.clone()),this._lastLatLngs.length>=2)){var A=new SuperMap.Geometry.Point(this._lastLatLngs[this._lastLatLngs.length-2].lng,this._lastLatLngs[this._lastLatLngs.length-2].lat),T=new SuperMap.Geometry.Point(this._lastLatLngs[this._lastLatLngs.length-1].lng,this._lastLatLngs[this._lastLatLngs.length-1].lat),x=SuperMap.Plot.PlottingUtil.radian(A,T)*SuperMap.Plot.PlottingUtil.RTOD;this._rotation=x-90,this.feature.symbolType==SuperMap.Plot.SymbolType.DOTSYMBOL&&(this._rotation=x+180)}},addLatLng:function(t){this._lastLatLngs.length>0&&SuperMap.Plot.PlottingUtil.equalFuzzy(t.lat,this._lastLatLngs[this._lastLatLngs.length-1].lat)&&SuperMap.Plot.PlottingUtil.equalFuzzy(t.lng,this._lastLatLngs[this._lastLatLngs.length-1].lng)||(this._lastLatLngs.length<10?this._lastLatLngs.push(L.latLng(t.lat,t.lng)):(this._lastLatLngs.splice(0,this._lastLatLngs.length-10+1),this._lastLatLngs.push(L.latLng(t.lat,t.lng))))},getSectorPoint:function(t,e,i,o){var n,l,s=[],a=o-i;s.push([t.lat,t.lng]);for(var r=0;r<=300;r++)a=i+(o-i)*r/300,n=t.lng+e*Math.cos(a*Math.PI/180),l=t.lat+e*Math.sin(a*Math.PI/180),s.push([l,n]);return s},setImage:function(t){this._image=t},setUuid:function(t){this._uuid=t},getLatLng:function(){return this._latlng},getImage:function(){return this._image},getUuid:function(){return this._uuid},_cloneImage:function(t){if(this.layer.cacheImages[t]){this.layer.cacheImages[t].imgCount++,null==this._image&&(this._image=new Qg(this.feature)),this._image._ctx.clearRect(0,0,this._image._ctx.width,this._image._ctx.height),this._image.anchor=L.point(this.layer.cacheImages[t].img.anchor.x,this.layer.cacheImages[t].img.anchor.y),this._image.size=[this.layer.cacheImages[t].img.size[0],this.layer.cacheImages[t].img.size[1]],this._image.redrawSize=[this.layer.cacheImages[t].img.redrawSize[0],this.layer.cacheImages[t].img.redrawSize[1]],this._image.redrawAnchor=L.point(this.layer.cacheImages[t].img.redrawAnchor.x,this.layer.cacheImages[t].img.redrawAnchor.y),this._image.bounds=L.latLngBounds(this.layer.cacheImages[t].img.bounds.getSouthEast(),this.layer.cacheImages[t].img.bounds.getNorthWest()),this._image.latLng=L.latLng(this.layer.cacheImages[t].img.latLng.lat,this.layer.cacheImages[t].img.latLng.lng),this._image.fromZoom=this.layer.cacheImages[t].img.fromZoom,null!=this._image.componentLatLngs&&this._image.componentLatLngs.length>0&&(this._image.componentLatLngs.length=0),this._image.componentLatLngs=[];for(var e=0;e<this.layer.cacheImages[t].img.componentLatLngs.length;e++)this._image.componentLatLngs.push(L.Util.cloneLatLngs(this.layer.cacheImages[t].img.componentLatLngs[e]));this._image.canvasEle.width=this._image.size[0],this._image.canvasEle.height=this._image.size[1],this._image._ctx.drawImage(this.layer.cacheImages[t].img.canvas,0,0),this._image.canvas=this._image._ctx.canvas,null!=this.layer.cacheImages[t].img.annotation?(null==this._image.annotation&&(this._image.annotation=new Wg(this._image.feature)),this._image.annotation.clear(),this._image.annotation.anchor=L.point(this.layer.cacheImages[t].img.annotation.anchor.x,this.layer.cacheImages[t].img.annotation.anchor.y),this._image.annotation.size=[this.layer.cacheImages[t].img.annotation.size[0],this.layer.cacheImages[t].img.annotation.size[1]],this._image.annotation.position=this.layer.cacheImages[t].img.annotation.position,this._image.annotation.offsetX=this.layer.cacheImages[t].img.annotation.offsetX,this._image.annotation.offsetY=this.layer.cacheImages[t].img.annotation.offsetY,this._image.annotation.canvasEle.width=this._image.annotation.size[0],this._image.annotation.canvasEle.height=this._image.annotation.size[1],this._image.annotation._ctx.drawImage(this.layer.cacheImages[t].img.annotation.canvas,0,0),this._image.annotation.canvas=this._image.annotation._ctx.canvas):null!=this._image.annotation&&(delete this._image.annotation,this._image.annotation=null),null!=this._image.images&&this._image.images.length>0&&(this._image.images.length=0),this._image.images=[];for(var i=0;i<this.layer.cacheImages[t].img.images.length;i++){var o={};o=SuperMap.Util.copyAttributes(o,this.layer.cacheImages[t].img.images[i]),this._image.images.push(o)}null!=this._image.pictureFrames&&this._image.pictureFrames.length>0&&(this._image.pictureFrames.length=0),this._image.pictureFrames=[];for(var n=0;n<this.layer.cacheImages[t].img.pictureFrames.length;n++){var l={};l=SuperMap.Util.copyAttributes(l,this.layer.cacheImages[t].img.pictureFrames[n]),this._image.pictureFrames.push(l)}for(var s=0;s<this.layer.cacheImages[t].img.symbolTexts.length;s++)this._image.symbolTexts.length<=s&&this._image.symbolTexts.push(new Wg(this._image.feature)),this._image.symbolTexts[s].clear(),this._image.symbolTexts[s].anchor=L.point(this.layer.cacheImages[t].img.symbolTexts[s].anchor.x,this.layer.cacheImages[t].img.symbolTexts[s].anchor.y),this._image.symbolTexts[s].size=[this.layer.cacheImages[t].img.symbolTexts[s].size[0],this.layer.cacheImages[t].img.symbolTexts[s].size[1]],this._image.symbolTexts[s].position=this.layer.cacheImages[t].img.symbolTexts[s].position,this._image.symbolTexts[s].offsetX=this.layer.cacheImages[t].img.symbolTexts[s].offsetX,this._image.symbolTexts[s].offsetY=this.layer.cacheImages[t].img.symbolTexts[s].offsetY,this.layer.isHighDefinition?(this._image.symbolTexts[s]._bounds=this.layer.cacheImages[t].img.symbolTexts[s]._bounds,this._image.symbolTexts[s].canvasEle.width=2*this._image.symbolTexts[s].size[0],this._image.symbolTexts[s].canvasEle.height=2*this._image.symbolTexts[s].size[1],this.layer.cacheImages[t].img.symbolTexts[s].canvas.width=2*this._image.symbolTexts[s].size[0],this.layer.cacheImages[t].img.symbolTexts[s].canvas.height=2*this._image.symbolTexts[s].size[1],this.layer.cacheImages[t].img.symbolTexts[s]._ctx.putImageData(this.layer.cacheImages[t].img.symbolTexts[s].imageData,2*this._image.symbolTexts[s].size[0],2*this._image.symbolTexts[s].size[1]),this._image.symbolTexts[s].imageData=this.layer.cacheImages[t].img.symbolTexts[s].imageData,this._image.symbolTexts[s]._ctx.drawImage(this.layer.cacheImages[t].img.symbolTexts[s].canvas,0,0),this._image.symbolTexts[s]._ctx.setTransform(2,0,0,2,0,0)):(this._image.symbolTexts[s].canvasEle.width=this._image.symbolTexts[s].size[0],this._image.symbolTexts[s].canvasEle.height=this._image.symbolTexts[s].size[1],this._image.symbolTexts[s]._ctx.drawImage(this.layer.cacheImages[t].img.symbolTexts[s].canvas,0,0)),this._image.symbolTexts[s].canvas=this._image.symbolTexts[s]._ctx.canvas;for(var a=this.layer.cacheImages[t].img.symbolTexts.length;a<this._image.symbolTexts.length;)delete this._image.symbolTexts[a],this._image.symbolTexts.splice(a,1);for(var r=0;r<this.layer.cacheImages[t].img.bloodVolumes.length;r++)this._image.bloodVolumes.length<=r&&this._image.bloodVolumes.push(new Wg(this._image.feature)),this._image.bloodVolumes[r].clear(),this._image.bloodVolumes[r].anchor=L.point(this.layer.cacheImages[t].img.bloodVolumes[r].anchor.x,this.layer.cacheImages[t].img.bloodVolumes[r].anchor.y),this._image.bloodVolumes[r].size=[this.layer.cacheImages[t].img.bloodVolumes[r].size[0],this.layer.cacheImages[t].img.bloodVolumes[r].size[1]],this._image.bloodVolumes[r].position=this.layer.cacheImages[t].img.bloodVolumes[r].position,this._image.bloodVolumes[r].offsetX=this.layer.cacheImages[t].img.bloodVolumes[r].offsetX,this._image.bloodVolumes[r].offsetY=this.layer.cacheImages[t].img.bloodVolumes[r].offsetY,this._image.bloodVolumes[r].canvasEle.width=this._image.bloodVolumes[r].size[0],this._image.bloodVolumes[r].canvasEle.height=this._image.bloodVolumes[r].size[1],this._image.bloodVolumes[r]._ctx.drawImage(this.layer.cacheImages[t].img.bloodVolumes[r].canvas,0,0),this._image.bloodVolumes[r].canvas=this._image.bloodVolumes[r]._ctx.canvas;for(var u=this.layer.cacheImages[t].img.bloodVolumes.length;u<this._image.bloodVolumes.length;)delete this._image.bloodVolumes[u],this._image.bloodVolumes.splice(u,1)}},_getHandleAndCenterPoints:function(){var t={handlePoints:[],centerPoints:[]},e=this.getBounds();if(!e.isValid())return t;var i=L.point((e.min.x+e.max.x)/2,(e.min.y+e.max.y)/2),o=e.max.x-e.min.x,n=e.max.y-e.min.y,l=o;n>o&&(l=n),l+=10;var s=L.point(i.x-l/2,i.y+l/2),a=L.point(i.x-l/2,i.y-l/2),r=L.point(i.x+l/2,i.y-l/2),u=L.point(i.x+l/2,i.y+l/2),p=this._map.layerPointToLatLng(s),h=this._map.layerPointToLatLng(a),c=this._map.layerPointToLatLng(r),y=this._map.layerPointToLatLng(u);t.handlePoints=[p.clone(),h.clone(),c.clone(),y.clone()];for(var g=1,f=0;f<t.handlePoints.length;f++)t.handlePoints[f].nHandle=g++;for(f=0;f<t.handlePoints.length;f++)t.handlePoints[f].tag=f;var d=this._map.layerPointToLatLng(L.point((e.min.x+e.max.x)/2,(e.min.y+e.max.y)/2));return d.isCenterPoint=!0,t.centerPoints=[d],t},getBounds:function(){if(null!=this._latlng&&null!=this._image){var t=this._map.latLngToLayerPoint(this._latlng),e=!0===this.feature.autoRotation?-(this._rotation+this.getImage().feature.dRotate):-this.getImage().feature.dRotate,i=L.point(t.x-this._image.anchor.x,t.y-this._image.anchor.y),o=L.point(t.x+(this._image.size[0]-this._image.anchor.x),t.y+(this._image.size[1]-this._image.anchor.y)),n=this._map.layerPointToLatLng(i),l=this._map.layerPointToLatLng(o),s=new SuperMap.Geometry.Point(n.lng,n.lat),a=new SuperMap.Geometry.Point(l.lng,l.lat);SuperMap.Plot.PlottingUtil.rotateAngle(new SuperMap.Geometry.Point(this._latlng.lng,this._latlng.lat),(360-e)/180*Math.PI,s),SuperMap.Plot.PlottingUtil.rotateAngle(new SuperMap.Geometry.Point(this._latlng.lng,this._latlng.lat),(360-e)/180*Math.PI,a);var r=L.bounds(this._map.latLngToLayerPoint(L.latLng(s.y,s.x)),this._map.latLngToLayerPoint(L.latLng(a.y,a.x)));return r.min._floor(),r.max._ceil(),r}return null},_containsPoint:function(t){if(null!=this._latlng&&null!=this._image){var e=this._map.latLngToLayerPoint(this._latlng),i=!0===this.feature.autoRotation?-(this._rotation+this.getImage().feature.dRotate):-this.getImage().feature.dRotate,o=L.point(e.x-this._image.anchor.x,e.y-this._image.anchor.y),n=L.point(e.x+(this._image.size[0]-this._image.anchor.x),e.y+(this._image.size[1]-this._image.anchor.y)),l=this._map.layerPointToLatLng(o),s=this._map.layerPointToLatLng(n),a=new SuperMap.Geometry.Point(l.lng,l.lat),r=new SuperMap.Geometry.Point(s.lng,s.lat);SuperMap.Plot.PlottingUtil.rotateAngle(new SuperMap.Geometry.Point(this._latlng.lng,this._latlng.lat),(360-i)/180*Math.PI,a),SuperMap.Plot.PlottingUtil.rotateAngle(new SuperMap.Geometry.Point(this._latlng.lng,this._latlng.lat),(360-i)/180*Math.PI,r);var u=L.bounds(this._map.latLngToLayerPoint(L.latLng(a.y,a.x)),this._map.latLngToLayerPoint(L.latLng(r.y,r.x)));if(u.min._floor(),u.max._ceil(),null!=u&&u.contains(t))return!0}return!1},_project:function(){if(null!=this._latlng&&null!=this._image){var t=this._map.latLngToLayerPoint(this._latlng),e=L.point(t.x-this._image.redrawAnchor.x,t.y-this._image.redrawAnchor.y),i=L.point(t.x+(this._image.redrawSize[0]-this._image.redrawAnchor.x),t.y+(this._image.redrawSize[1]-this._image.redrawAnchor.y));this._pxBounds=L.bounds(e,i),this._pxBounds.min._floor(),this._pxBounds.max._ceil()}},_generateTrackingPointImage:function(t,e,i,o){var n=null;if(Object.prototype.hasOwnProperty.call(this._trajectoryPointGraphic,o))return this._trajectoryPointGraphic[o];delete this._trajectoryPointGraphic;var l=document.createElement("canvas");l.width=2*e+2*i.weight,l.height=2*e+2*i.weight,document.body.appendChild(l);var s=l.getContext("2d");return 0===t?(s.fillStyle=i.color,s.beginPath(),s.arc(e+i.weight,e+i.weight,e,0,2*Math.PI),s.fill()):1===t?(s.globalAlpha=i.opacity,s.strokeStyle=i.color,s.lineWidth=i.weight,s.beginPath(),s.arc(e+i.weight,e+i.weight,e,0,2*Math.PI),s.stroke()):2===t?(s.fillStyle=i.color,s.beginPath(),s.moveTo(i.weight,2*e+i.weight),s.lineTo(2*e+i.weight,2*e+i.weight),s.lineTo(e+i.weight,i.weight),s.lineTo(i.weight,2*e+i.weight),s.fill()):3===t?(s.globalAlpha=i.opacity,s.strokeStyle=i.color,s.lineWidth=i.weight,s.beginPath(),s.moveTo(i.weight,2*e+i.weight),s.lineTo(2*e+i.weight,2*e+i.weight),s.lineTo(e+i.weight,i.weight),s.lineTo(i.weight,2*e+i.weight),s.stroke()):4===t&&(s.globalAlpha=i.opacity,s.strokeStyle=i.color,s.lineWidth=i.weight,s.beginPath(),s.moveTo(i.weight,e+i.weight),s.lineTo(2*e+i.weight,e+i.weight),s.moveTo(e+i.weight,i.weight),s.lineTo(e+i.weight,2*e+i.weight),s.stroke()),n=l.toDataURL("image/png","image/octet-stream"),document.body.removeChild(l),this._trajectoryPointGraphic[o]=n,n}}),dy=L.Path.extend({serverUrl:null,features:null,isLocked:!1,isEditable:!0,isSelected:!0,visibility:!0,cacheImages:null,graphics:null,_editLayer:null,options:{renderer:L.canvas()},getSelected:function(){return this.isSelected},setSelected:function(t){this.isSelected!==t&&(this.isSelected=t,this._map&&this._map.getPlotEditControl()&&(this.isSelected?this._map.getPlotEditControl().enableEditFeatures(this.features):(this._map.getPlotEditControl().unselectFeatures(this.features),this._map.getPlotEditControl().disableEditFeatures(this.features))))},getEditable:function(){return this.isEditable},setEditable:function(t){if(this.isEditable!==t&&(this.isEditable=t,this._map&&this._map.getPlotEditControl())){var e=this._map.getPlotEditControl().getSelectedFeatures();this._map.getPlotEditControl().unselectFeatures(this.features),this._map.getPlotEditControl().selectFeatures(e)}},getLocked:function(){return this.isLocked},setLocked:function(t){if(this.isLocked!==t&&(this.isLocked=t,this._map&&this._map.getPlotEditControl())){var e=this._map.getPlotEditControl().getSelectedFeatures();this._map.getPlotEditControl().unselectFeatures(this.features),this._map.getPlotEditControl().selectFeatures(e)}},getVisibility:function(){return this.visibility},setVisibility:function(t){this.visibility!==t&&(this.visibility=t,this.visibility?this._renderer._container.style.display="block":this._renderer._container.style.display="none")},initialize:function(t,e,i){this._editLayer=new Uy(t+"_temportary",e,{layer:this}),i=i||{},L.Util.setOptions(this,i),this.cacheImages={},this.graphics=[],this.selectedFeatures=[],this.name=t,this.serverUrl=e,this.features=[]},getSymZoomScale:function(t){return 1},getEvents:function(){var t={click:this._handleClick,mousemove:this._onMapMouseMove};return this._map._zoomAnimated&&(t.zoomanim=this._zoomAnim),t},_getSymbolDataFromCache:function(t,e){var i=L.supermap.plotting.getControl(this._map,this.serverUrl,{serviceParams:this.options.serviceParams}).getSymbolLibManager().getSymbolLibByLibId(t);return null!==i?i.getSymbolData(e):null},_cacheSymbolData:function(t){var e=L.supermap.plotting.getControl(this._map,this.serverUrl,{serviceParams:this.options.serviceParams}).getSymbolLibManager().getSymbolLibByLibId(t.libID);null!==e&&e.cacheSymbolData(t)},_zoomAnim:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._getCenterOffset(t.center)._multiplyBy(-e).subtract(this._map._getMapPanePos());L.DomUtil.setTransform?L.DomUtil.setTransform(this._canvas,i,e):L.DomUtil.setPosition(this._canvas,i)},_onMapMouseMove:function(t){var e=this._getGraphicsInBounds();if(0!==e.length)for(var i=0,o=e.length;i<o;i++){if(e[i]._containsPoint(this._map.latLngToLayerPoint(t.latlng))){this._editLayer._renderer._container.style.cursor=e[i].feature.isSelected?"move":"pointer";break}this._editLayer._renderer._container.style.cursor=""}},isGraphic:function(t){return t===SuperMap.Plot.SymbolType.DOTSYMBOL},isSupportType:function(t){return t===SuperMap.Plot.SymbolType.DOTSYMBOL},getFeatureByUuid:function(t){for(var e=0;e<this.features.length;e++)if(this.features[e].uuid===t)return this.features[e];return null},getFeatures:function(){return this.features.slice()},addFeatures:function(t){L.Util.isArray(t)||(t=[t]);for(var e=0,i=t.length;e<i;e++){var o=t[e];if(this.isSupportType(o.symbolType)){if(null!=this._map.getFeatureByUuid(o.uuid)&&(o.uuid=SuperMap.Plot.PlottingUtil.generateUuid()),o.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL){var n=new fy(o);n.onAdd(this),this.graphics.push(n)}this.features.push(o)}}this._update()},removeFeatures:function(t){var e=[];SuperMap.Util.isArray(t)||(t=[t]);for(var i=0,o=t.length;i<o;i++){var n=t[i];-1!=SuperMap.Util.indexOf(this.features,n)&&e.push(n.graphic)}this.fire(SuperMap.Plot.Event.beforefeaturesremoved,{features:t}),this.removeGraphics(e),this.fire(SuperMap.Plot.Event.featuresremoved,{features:t,layername:this.name})},removeAllFeatures:function(){this.fire(SuperMap.Plot.Event.beforefeaturesremoved,{features:this.features}),this.removeAllGraphics(),this.fire(SuperMap.Plot.Event.featuresremoved,{features:this.features,layername:this.name})},updateGraphics:function(t){L.Util.isArray(t)||(t=[t]);t.map(function(t){return t.update(),t}),this._update()},removeGraphics:function(t){L.Util.isArray(t)||(t=[t]);var e=this;t.map(function(t){var i=SuperMap.Util.indexOf(e.selectedFeatures,t.feature);-1!==i&&(e._editLayer.removeFeatures(t.feature),e.selectedFeatures.splice(i,1)),e._map&&e._map.getPlotEditControl()&&(e._map.getPlotEditControl().unselectFeatures(t.feature),e._map.getPlotEditControl().disableEditFeatures(t.feature));var o=t.getUuid();return e.cacheImages[o]&&0==--e.cacheImages[o].imgCount&&delete e.cacheImages[o],-1!==(i=SuperMap.Util.indexOf(e.graphics,t))&&e.graphics.splice(i,1),t.onRemove(),-1!==(i=SuperMap.Util.indexOf(e.features,t.feature))&&e.features.splice(i,1),t}),this._update()},removeAllGraphics:function(){this.removeGraphics(this.graphics.slice()),this.selectedFeatures=[],this.graphics=[],this.features=[],this.cacheImages={}},redraw:function(){this._update()},_generateFromFeature:function(t){var e="";return t.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL?e=t.libID.toString()+"_"+t.code.toString()+"_"+Math.round(t.symbolSize.w).toString()+"_"+Math.round(t.symbolSize.h).toString()+"_"+t.textContent+"_"+t.annotationPosition.toString()+"_"+t.dRotate.toString()+this._styleToString(t.style)+"_"+t.textDisplay.toString()+"_"+t.surroundLineType.toString():t.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT?(e=t.libID.toString()+"_"+t.code.toString()+"_"+t.associatedUuid+"_"+t.addFrame.toString(),1===t.symbolTexts.length&&(null!=t.symbolTexts[0].textContent&&(e+="_"+t.symbolTexts[0].textContent),null!=t.symbolTexts[0].textPosition&&(e+="_"+t.symbolTexts[0].textPosition.toString()),null!=t.symbolTexts[0].offsetX&&(e+="_"+t.symbolTexts[0].offsetX.toString()),null!=t.symbolTexts[0].offsetY&&(e+="_"+t.symbolTexts[0].offsetY.toString()),null!=t.symbolTexts[0].style&&(e+=this._styleToString(t.symbolTexts[0].style)))):t.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT1&&(e=t.libID.toString()+"_"+t.code.toString()+"_"+t.associatedUuid+"_"+t.textContent+"_"+t.space.toString()+"_"+t.offsetX.toString()+"_"+t.offsetY.toString()+this._styleToString(t.style)),e},_styleToString:function(t){var e="";return null!=t.fontFamily&&(e+="_"+t.fontFamily),null!=t.fontSize&&(e+="_"+t.fontSize),null!=t.fontColor&&(e+="_"+t.fontColor),null!=t.fontStroke&&(e+="_"+t.fontStroke),null!=t.fontStrokeColor&&(e+="_"+t.fontStrokeColor),null!=t.fontStrokeWidth&&(e+="_"+t.fontStrokeWidth),null!=t.fontBackground&&(e+="_"+t.fontBackground),null!=t.fontBackgroundColor&&(e+="_"+t.fontBackgroundColor),null!=t.fontShadow&&(e+="_"+t.fontShadow),null!=t.fontShadowColor&&(e+="_"+t.fontShadowColor),null!=t.fontShadowOffsetX&&(e+="_"+t.fontShadowOffsetX),null!=t.fontShadowOffsetY&&(e+="_"+t.fontShadowOffsetY),null!=t.color&&(e+="_"+t.color),null!=t.weight&&(e+="_"+t.weight),null!=t.opacity&&(e+="_"+t.opacity),null!=t.lineSymbolID&&(e+="_"+t.lineSymbolID),null!=t.dashArray&&(e+="_"+t.dashArray),null!=t.fill&&(e+="_"+t.fill),null!=t.fillSymbolID&&(e+="_"+t.fillSymbolID),null!=t.fillColor&&(e+="_"+t.fillColor),null!=t.fillOpacity&&(e+="_"+t.fillOpacity),null!=t.fillBackColor&&(e+="_"+t.fillBackColor),null!=t.fillBackOpacity&&(e+="_"+t.fillBackOpacity),null!=t.fillGradientMode&&(e+="_"+t.fillGradientMode),e},onAdd:function(){this._canvas=document.createElement("canvas");var t=this._map.getPixelBounds().getSize().x,e=this._map.getPixelBounds().getSize().y;this._canvas.width=t,this._canvas.height=e,this._ctx=this._canvas.getContext("2d"),L.Path.prototype.onAdd.call(this),this._map.addLayer(this._editLayer)},onRemove:function(){L.Path.prototype.onRemove.call(this),this._map.removeLayer(this._editLayer)},_update:function(){this._map&&this.getVisibility()&&this._updatePath()},_containsPoint:function(){return!1},_updatePath:function(){this._renderer._ctx.clearRect(this._renderer._bounds.min.x,this._renderer._bounds.min.y,this._renderer._ctx.canvas.width,this._renderer._ctx.canvas.height),this._renderer._drawPlottingGraphics(this._getGraphicsInBounds())},_project:function(){var t=this;t._pxBounds=L.bounds(L.point(0,0),L.point(0,0)),t._getGraphicsInBounds().map(function(e){return e._project(),t._pxBounds.extend(e._pxBounds.min),t._pxBounds.extend(e._pxBounds.max),e})},_getGraphicsInBounds:function(){var t=[],e=this._map.getBounds();return this.graphics.map(function(i){return"none"!==i.feature.style.display&&e.contains(i.getLatLng())&&(null!=i.getImage()&&i.getUuid()===i.getImage().generateUuidFromFeature()||i.update(),t.push(i)),i}),t},_handleClick:function(t){var e=this;if(null!=e._map.getPlotEditControl()){if(0!==this.selectedFeatures.length)for(var i=0,o=this.selectedFeatures.length;i<o;i++)e._editLayer.removeFeatures(this.selectedFeatures),this.addFeatures(this.selectedFeatures);this.selectedFeatures=[];for(var n=e._getGraphicsInBounds(),l=0,s=n.length;l<s;l++)if(n[l]._containsPoint(this._map.latLngToLayerPoint(t.latlng))){this.removeFeatures(n[l].feature),e._editLayer.addFeatures(n[l].feature),e._map.getPlotEditControl()&&(e._map.getPlotEditControl().unselectFeatures(),n[l].feature.enableEdit||e._map.getPlotEditControl().enableEditFeatures(n[l].feature),e._map.getPlotEditControl().selectFeatures(n[l].feature)),this.selectedFeatures.push(n[l].feature),e._map.getPlotEditControl()&&(e._map.getPlotEditControl()._onTriggerMapClick=!1);break}L.DomEvent.stopPropagation(t)}}}),my=function(t,e,i){return new dy(t,e,i)};L.supermap.plotting.graphicLayer=my,L.supermap.plotting.GraphicLayer=dy;i(618),i(713);L.Canvas.include({_drawPlottingGraphics:function(t){var e=this,i=[];t.map(function(t){if("function"==typeof t.layer.getVisibility&&!1===t.layer.getVisibility())return t;if("none"===t.feature.style.display||"none"===t.feature._clusterShowStatus)return t;if(t.feature.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT||t.feature.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT1){var o=e._map.getFeatureByUuid(t.feature.associatedUuid);if(null==o||"none"===o.style.display)return t}return t.getImage()?(t.getImage().complete()?e._drawPlottingGraphic(t):i.push(t),t):t}),i.length>0&&setTimeout(function(){for(var t=0;t<i.length;t++)e._drawPlottingGraphic(i[t])},100),this._redrawBounds=null},_drawPlottingLayers:function(t){t.map(function(e){return e instanceof L.Polyline&&e._update(),e instanceof L.Polygon&&e._update(),t})},getEvents:function(){var t=this;this._map.on("layeradd",function(e){e.layer===t&&L.DomEvent.on(t._container,"mousemove",L.Util.throttle(t._onMove,32,t),t)});var e=L.Renderer.prototype.getEvents.call(this);return e.zoomstart=this._onZoomStart,e},_drawPlottingGraphic:function(t){var e=this;if("none"===t.feature.style.display)return t;if(t.feature.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT||t.feature.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT1){var i=e._map.getFeatureByUuid(t.feature.associatedUuid);if(null==i||"none"===i.style.display)return t}var o=e._map.latLngToLayerPoint(t.getLatLng()),n=t.getImage().img||t.getImage().canvas,l=o.x,s=o.y,a=-1*t.getImage().anchor.x,r=-1*t.getImage().anchor.y;e._ctx.save(),e._ctx.translate(l,s);var u=!0===t.feature.autoRotation?-(t._rotation+t.getImage().feature.dRotate):-t.getImage().feature.dRotate;e._ctx.rotate(u/180*Math.PI),e._ctx.translate(a,r);var p=L.Canvas.drawImageScaleFactor||(L.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);t.graphicHeight&&t.graphicWidth?e._ctx.drawImage(n,0,0,t.graphicHeight*p,t.graphicWidth*p):e._ctx.drawImage(n,0,0,t.getImage().size[0]*p,t.getImage().size[1]*p);for(var h=0;h<t.getImage().images.length;h++){var c=t.getImage().images[h].style,y=c.graphicWidth||c.graphicHeight,g=c.graphicHeight||c.graphicWidth;y=y||2*c.pointRadius,g=g||2*c.pointRadius;var f=-.5*y+c.graphicXOffset,d=-.5*g+c.graphicYOffset,m=t.getImage().images[h].point;e._ctx.translate(f,d);var S=L.supermap.plotting.getControl().imageManager[t.getImage().images[h].path];e._ctx.drawImage(S,m.x,m.y,y*p,g*p),e._ctx.translate(-f,-d)}e._ctx.translate(-a,-r),e._ctx.rotate(-u/180*Math.PI);var P=t.getImage().getBounds(t.getImage().feature.getLatLngs()[0],-u);if(null!=t.getImage().annotation){var b=null;switch(t.getImage().annotation.position){case SuperMap.Plot.AnnoPosition.LEFTTOP:b=L.latLng(P.getNorth(),P.getWest());break;case SuperMap.Plot.AnnoPosition.LEFTBOTTOM:b=L.latLng(P.getSouth(),P.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHTTOP:b=L.latLng(P.getNorth(),P.getEast());break;case SuperMap.Plot.AnnoPosition.RIGHTBOTTOM:b=L.latLng(P.getSouth(),P.getEast());break;case SuperMap.Plot.AnnoPosition.TOP:b=L.latLng(P.getNorth(),(P.getWest()+P.getEast())/2);break;case SuperMap.Plot.AnnoPosition.BOTTOM:b=L.latLng(P.getSouth(),(P.getWest()+P.getEast())/2);break;case SuperMap.Plot.AnnoPosition.LEFT:b=L.latLng((P.getSouth()+P.getNorth())/2,P.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHT:b=L.latLng((P.getSouth()+P.getNorth())/2,P.getEast())}var v=e._map.latLngToLayerPoint(b),M=v.x+t.getImage().annotation.offsetX-o.x,_=v.y+t.getImage().annotation.offsetY-o.y;e._ctx.translate(M,_),e._ctx.translate(-t.getImage().annotation.anchor.x,-t.getImage().annotation.anchor.y),e._ctx.drawImage(t.getImage().annotation.canvas,0,0,t.getImage().annotation.size[0]*p,t.getImage().annotation.size[1]*p),e._ctx.translate(t.getImage().annotation.anchor.x,t.getImage().annotation.anchor.y),e._ctx.translate(-M,-_)}for(var A=0;A<t.getImage().pictureFrames.length;A++){var T=null;switch(t.getImage().pictureFrames[A].position){case SuperMap.Plot.AnnoPosition.TOP:T=L.latLng(P.getNorth(),(P.getWest()+P.getEast())/2);break;case SuperMap.Plot.AnnoPosition.BOTTOM:T=L.latLng(P.getSouth(),(P.getWest()+P.getEast())/2);break;case SuperMap.Plot.AnnoPosition.LEFT:T=L.latLng((P.getSouth()+P.getNorth())/2,P.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHT:T=L.latLng((P.getSouth()+P.getNorth())/2,P.getEast())}var x=e._map.latLngToLayerPoint(T),O=x.x+t.getImage().pictureFrames[A].offsetX-o.x,w=x.y+t.getImage().pictureFrames[A].offsetY-o.y;e._ctx.translate(O,w);var C=t.getImage().pictureFrames[A].style,E=C.graphicWidth||C.graphicHeight,I=C.graphicHeight||C.graphicWidth;E=E||2*C.pointRadius,I=I||2*C.pointRadius;var D=void 0!==C.graphicXOffset?C.graphicXOffset:-.5*E,U=void 0!==C.graphicYOffset?C.graphicYOffset:-.5*I;e._ctx.translate(D,U);var R=L.supermap.plotting.getControl().imageManager[t.getImage().pictureFrames[A].path];e._ctx.drawImage(R,0,0,E*p,I*p),e._ctx.translate(-D,-U),e._ctx.translate(-O,-w)}if(t.feature.layer instanceof gy){var N=e._map.getScale(),B=e._map.getZoom();if(0==N||t.feature.layer.getVisibility()&&("function"!=typeof t.feature.layer.getMarkerMinVisibleScale&&"function"!=typeof t.feature.layer.getMarkerMaxVisibleScale||"function"==typeof t.feature.layer.getMarkerMinVisibleScale&&"function"!=typeof t.feature.layer.getMarkerMaxVisibleScale&&(N>=t.feature.layer.getMarkerMinVisibleScale()||0===t.feature.layer.getMarkerMinVisibleScale())||"function"!=typeof t.feature.layer.getMarkerMinVisibleScale&&"function"==typeof t.feature.layer.getMarkerMaxVisibleScale&&(0===t.feature.layer.getMarkerMaxVisibleScale()||N<=t.feature.layer.getMarkerMaxVisibleScale())||"function"==typeof t.feature.layer.getMarkerMinVisibleScale&&"function"==typeof t.feature.layer.getMarkerMaxVisibleScale&&0===t.feature.layer.getMarkerMaxVisibleScale()&&N>=t.feature.layer.getMarkerMinVisibleScale()||"function"==typeof t.feature.layer.getMarkerMinVisibleScale&&"function"==typeof t.feature.layer.getMarkerMaxVisibleScale&&0===t.feature.layer.getMarkerMinVisibleScale()&&N<=t.feature.layer.getMarkerMaxVisibleScale()||"function"==typeof t.feature.layer.getMarkerMinVisibleScale&&"function"==typeof t.feature.layer.getMarkerMaxVisibleScale&&(0===t.feature.layer.getMarkerMinVisibleScale()&&0===t.feature.layer.getMarkerMaxVisibleScale()||N>=t.feature.layer.getMarkerMinVisibleScale()&&N<=t.feature.layer.getMarkerMaxVisibleScale())))for(var k=0;k<t.getImage().symbolTexts.length;k++)if("none"!=t.feature.symbolTexts[k].style.display&&!(t.feature.symbolTexts[k].minVisibleLevel>B||t.feature.symbolTexts[k].maxVisibleLevel<B)){var F=null;switch(t.getImage().symbolTexts[k].position){case SuperMap.Plot.AnnoPosition.LEFTTOP:F=L.latLng(P.getNorth(),P.getWest());break;case SuperMap.Plot.AnnoPosition.LEFTBOTTOM:F=L.latLng(P.getSouth(),P.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHTTOP:F=L.latLng(P.getNorth(),P.getEast());break;case SuperMap.Plot.AnnoPosition.RIGHTBOTTOM:F=L.latLng(P.getSouth(),P.getEast());break;case SuperMap.Plot.AnnoPosition.TOP:F=L.latLng(P.getNorth(),(P.getWest()+P.getEast())/2);break;case SuperMap.Plot.AnnoPosition.BOTTOM:F=L.latLng(P.getSouth(),(P.getWest()+P.getEast())/2);break;case SuperMap.Plot.AnnoPosition.LEFT:F=L.latLng((P.getSouth()+P.getNorth())/2,P.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHT:F=L.latLng((P.getSouth()+P.getNorth())/2,P.getEast());break;case SuperMap.Plot.AnnoPosition.ANCHOR:F=L.latLng(t.getLatLng().lat,t.getLatLng().lng)}var j=e._map.latLngToLayerPoint(F),V=j.x+t.getImage().symbolTexts[k].offsetX-o.x,z=j.y+t.getImage().symbolTexts[k].offsetY-o.y;e._ctx.translate(V,z),e._ctx.translate(-t.getImage().symbolTexts[k].anchor.x,-t.getImage().symbolTexts[k].anchor.y),t.feature.layer.isHighDefinition?(t.getImage().symbolTexts[k].canvas.width=t.getImage().symbolTexts[k].imageData.width,t.getImage().symbolTexts[k].canvas.height=t.getImage().symbolTexts[k].imageData.height,t.getImage().symbolTexts[k]._ctx.putImageData(t.getImage().symbolTexts[k].imageData,0,0),e._ctx.drawImage(t.getImage().symbolTexts[k].canvas,0,0,t.getImage().symbolTexts[k].size[0]*p,t.getImage().symbolTexts[k].size[1]*p),t.getImage().symbolTexts[k].clear(),t.getImage().symbolTexts[k].canvas.width=0,t.getImage().symbolTexts[k].canvas.height=0):e._ctx.drawImage(t.getImage().symbolTexts[k].canvas,0,0,t.getImage().symbolTexts[k].size[0]*p,t.getImage().symbolTexts[k].size[1]*p),e._ctx.translate(t.getImage().symbolTexts[k].anchor.x,t.getImage().symbolTexts[k].anchor.y),e._ctx.translate(-V,-z)}}else for(var Y=0;Y<t.getImage().symbolTexts.length;Y++)if("none"!=t.feature.symbolTexts[Y].style.display){var G=null;switch(t.getImage().symbolTexts[Y].position){case SuperMap.Plot.AnnoPosition.LEFTTOP:G=L.latLng(P.getNorth(),P.getWest());break;case SuperMap.Plot.AnnoPosition.LEFTBOTTOM:G=L.latLng(P.getSouth(),P.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHTTOP:G=L.latLng(P.getNorth(),P.getEast());break;case SuperMap.Plot.AnnoPosition.RIGHTBOTTOM:G=L.latLng(P.getSouth(),P.getEast());break;case SuperMap.Plot.AnnoPosition.TOP:G=L.latLng(P.getNorth(),(P.getWest()+P.getEast())/2);break;case SuperMap.Plot.AnnoPosition.BOTTOM:G=L.latLng(P.getSouth(),(P.getWest()+P.getEast())/2);break;case SuperMap.Plot.AnnoPosition.LEFT:G=L.latLng((P.getSouth()+P.getNorth())/2,P.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHT:G=L.latLng((P.getSouth()+P.getNorth())/2,P.getEast());break;case SuperMap.Plot.AnnoPosition.ANCHOR:G=L.latLng(t.getLatLng().lat,t.getLatLng().lng)}var W=e._map.latLngToLayerPoint(G),X=W.x+t.getImage().symbolTexts[Y].offsetX-o.x,H=W.y+t.getImage().symbolTexts[Y].offsetY-o.y;e._ctx.translate(X,H),e._ctx.translate(-t.getImage().symbolTexts[Y].anchor.x,-t.getImage().symbolTexts[Y].anchor.y),e._ctx.drawImage(t.getImage().symbolTexts[Y].canvas,0,0,t.getImage().symbolTexts[Y].size[0]*p,t.getImage().symbolTexts[Y].size[1]*p),e._ctx.translate(t.getImage().symbolTexts[Y].anchor.x,t.getImage().symbolTexts[Y].anchor.y),e._ctx.translate(-X,-H)}for(var Z=0;Z<t.getImage().bloodVolumes.length;Z++){var J=null;switch(t.getImage().bloodVolumes[Z].position){case SuperMap.Plot.AnnoPosition.TOP:J=L.latLng(P.getNorth(),(P.getWest()+P.getEast())/2);break;case SuperMap.Plot.AnnoPosition.BOTTOM:J=L.latLng(P.getSouth(),(P.getWest()+P.getEast())/2);break;case SuperMap.Plot.AnnoPosition.LEFT:J=L.latLng((P.getSouth()+P.getNorth())/2,P.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHT:J=L.latLng((P.getSouth()+P.getNorth())/2,P.getEast())}var q=e._map.latLngToLayerPoint(J),K=q.x+t.getImage().bloodVolumes[Z].offsetX-o.x,Q=q.y+t.getImage().bloodVolumes[Z].offsetY-o.y;e._ctx.translate(K,Q),e._ctx.translate(-t.getImage().bloodVolumes[Z].anchor.x,-t.getImage().bloodVolumes[Z].anchor.y),e._ctx.drawImage(t.getImage().bloodVolumes[Z].canvas,0,0,t.getImage().bloodVolumes[Z].size[0]*p,t.getImage().bloodVolumes[Z].size[1]*p),e._ctx.translate(t.getImage().bloodVolumes[Z].anchor.x,t.getImage().bloodVolumes[Z].anchor.y),e._ctx.translate(-K,-Q)}e._ctx.restore()},_updateTextPt:function(t,e){var i=e.options,o=1;100!==i.fontPercent&&(o=i.fontPercent/100),this._ctx.fillStyle=i.fontColor,!0===i.fontStroke&&(this._ctx.strokeStyle=i.fontStrokeColor,this._ctx.setLineDash([]),this._ctx.lineWidth=i.fontStrokeWidth),this._ctx.globalAlpha=i.fontOpacity||1;var n=[i.fontStyle?i.fontStyle:"normal","normal",i.fontWeight?i.fontWeight:"normal",i.fontSize?i.fontSize+"px":"1em",i.fontFamily?i.fontFamily:"sans-serif"].join(" "),l=0,s=[];if(l=e.options.text instanceof Array?(s=e.options.text).length:e.options.text.indexOf(";")>-1?(s=e.options.text.split(";")).length:e.options.text.indexOf("；")>-1?(s=e.options.text.split("；")).length:(s=e.options.text.split("\n")).length,this._ctx.fillText){this._ctx.font=n,this._ctx.textAlign=L.Canvas.LABEL_ALIGN[i.labelAlign[0]]||"center",this._ctx.textBaseline=L.Canvas.LABEL_ALIGN[i.labelAlign[1]]||"middle";var a=L.Canvas.LABEL_FACTOR[i.labelAlign[1]];null==a&&(a=-.5);var r=this._ctx.measureText("Mg").height||this._ctx.measureText("xx").width;t.y+=r*a*(l-1);for(var u=0;u<l;u++)if(0!=i.fontSpace){var p=0,h=s[u].split(""),c=this._ctx.measureText(s[u]).width+i.fontSpace*(h.length-1),y=i.labelAlign[0]||"c";"c"===y?p-=c/2-this._ctx.measureText(s[u][0]).width/2:"r"===y&&(p-=c-i.fontSize);var g=0,f=s[u].split(""),d="";this._ctx.save(),this._ctx.translate(t.x,t.y),0!=i.labelRotation&&this._ctx.rotate(i.labelRotation*Math.PI/180),this._ctx.scale(o,1);for(var m=0;m<f.length;m++)!0===i.fontStroke&&this._ctx.strokeText(f[m],p+g,r*u),this._ctx.fillText(f[m],p+g,r*u),d+=f[m],g=this._ctx.measureText(d).width+parseFloat(i.fontSpace)*(m+1);this._ctx.restore()}else this._ctx.save(),this._ctx.translate(t.x,t.y),0!=i.labelRotation&&this._ctx.rotate(i.labelRotation*Math.PI/180),this._ctx.scale(o,1),!0===i.fontStroke&&this._ctx.strokeText(s[u],0,r*u),this._ctx.fillText(s[u],0,r*u+1),this._ctx.restore()}},_updateText:function(t){if(this._drawing&&void 0!=t.options.text&&!(t.options.fontSize<6)){void 0===t.options.fontPercent&&(t.options.fontPercent=100),t.options.fontPercent<0&&(t.options.fontPercent=0),t.options.fontPercent>400&&(t.options.fontPercent=400),void 0===t.options.fontSpace&&(t.options.fontSpace=0),t.options.fontSpace>30||t.options.fontSpace<0&&(t.options.fontSpace=0);var e=t._latlng,i=this._map.latLngToLayerPoint(e);if(void 0!=i){if(t.options.labelXOffset||t.options.labelYOffset){var o=isNaN(t.options.labelXOffset)?0:t.options.labelXOffset,n=isNaN(t.options.labelYOffset)?0:t.options.labelYOffset;i.x+=o,i.y-=n}if(!0===t.options.fontBackground){this._ctx.font=[t.options.fontStyle?t.options.fontStyle:"normal","normal",t.options.fontWeight?t.options.fontWeight:"normal",t.options.fontSize?t.options.fontSize+"px":"1em",t.options.fontFamily?t.options.fontFamily:"sans-serif"].join(" ");var l=t.options.labelRotation;t.options.labelRotation=0;var s=t.getPxBounds();t.options.labelRotation=l;var a=i.x,r=i.y,u=s.max.x-s.min.x,p=s.max.y-s.min.y;this._ctx.fillStyle=t.options.fontBackgroundColor,this._ctx.globalAlpha=1,this._ctx.save(),this._ctx.translate(a,r),0!=t.options.labelRotation&&this._ctx.rotate(t.options.labelRotation*Math.PI/180);var h=t.options.labelAlign||"cm";"lt"===h?"等线"==t.options.fontFamily?this._ctx.fillRect(0,0,u,p+3):this._ctx.fillRect(0,0,u,p):"ct"===h?"等线"==t.options.fontFamily?this._ctx.fillRect(-.5*u,0,u,p+3):this._ctx.fillRect(-.5*u,0,u,p):"rt"===h?"等线"==t.options.fontFamily?this._ctx.fillRect(-1*u,0,u,p+3):this._ctx.fillRect(-1*u,0,u,p):"lb"===h?"等线"==t.options.fontFamily?this._ctx.fillRect(0,-1*p-3,u,p+3):this._ctx.fillRect(0,-1*p,u,p):"cb"===h?"等线"==t.options.fontFamily||"微软雅黑"==t.options.fontFamily?this._ctx.fillRect(-.5*u,-1*p,u,p+3):this._ctx.fillRect(-.5*u,-1*p,u,p):"rb"===h?"等线"==t.options.fontFamily?this._ctx.fillRect(-1*u,-1*p-3,u,p+3):this._ctx.fillRect(-1*u,-1*p,u,p):"lm"===h?"等线"==t.options.fontFamily?this._ctx.fillRect(0,-.5*p,u,p+3):this._ctx.fillRect(0,-.5*p,u,p):"cm"===h?this._ctx.fillRect(-.5*u,-.5*p,u,p):"rm"===h&&("等线"==t.options.fontFamily?this._ctx.fillRect(-1*u,-.5*p,u,p+3):this._ctx.fillRect(-1*u,-.5*p,u,p)),this._ctx.restore()}if(!0===t.options.fontShadow){var c=L.point(i.x,i.y);if(t.options.fontShadowOffsetX&&(c.x+=t.options.fontShadowOffsetX),t.options.fontShadowOffsetY&&(c.y+=t.options.fontShadowOffsetY),0!==t.options.labelRotation){var y=i.x,g=i.y,f=t.options.labelRotation*Math.PI/180,d=Math.sqrt(Math.pow(c.x-y,2)+Math.pow(c.y-g,2)),m=f+Math.atan2(c.y-g,c.x-y);c.x=y+d*Math.cos(m),c.y=g+d*Math.sin(m)}var S=t.options.fontStroke;t.options.fontStroke=!1;var P=t.options.fontColor;t.options.fontColor=t.options.fontShadowColor,this._updateTextPt(c,t),t.options.fontColor=P,t.options.fontStroke=S}if(Object.prototype.hasOwnProperty.call(t,"_eventParents"))for(var b in t._eventParents)Object.prototype.hasOwnProperty.call(t._eventParents[b],"ownerGroup")&&null!==t._eventParents[b].ownerGroup&&(t._eventParents[b].ownerGroup.symbolType!==SuperMap.Plot.SymbolType.NAVYDEPLOYMENT&&t._eventParents[b].ownerGroup.symbolType!==SuperMap.Plot.SymbolType.AIRDEPLOYMENT||t._updateBounds());this._updateTextPt(i,t)}}},_updateImage:function(t){if(this._drawing){var e=this,i=function(){var i=this.style,o=i.graphicWidth||i.graphicHeight,n=i.graphicHeight||i.graphicWidth;o=o||2*i.pointRadius,n=n||2*i.pointRadius;var l=0,s=0;t.isPictureFrame||(l=-.5*o,s=-.5*n);var a=i.graphicOpacity||i.fillOpacity,r=this.point,u=r.x+i.graphicXOffset,p=r.y+i.graphicYOffset;if(!isNaN(u)&&!isNaN(p)){var h;e._ctx.save(),i.rotation&&(h=i.rotation/180*Math.PI),e._ctx.translate(u,p),h&&e._ctx.rotate(h),e._ctx.translate(l,s),e._ctx.globalAlpha=a;var c=L.Canvas.drawImageScaleFactor||(L.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);e._ctx.drawImage(this.img,0,0,o*c,n*c),e._ctx.restore()}},o=new Image;"firefox"==SuperMap.Browser.name?(o.onload=function(){i.call({point:t._point,style:t.options,img:o}),o.onload=null},t.options.graphicTitle&&(o.title=t.options.graphicTitle),t.options.img?(o=t.options.img,i.call({point:t._point,style:t.options,img:o})):(o.src=t.options.externalGraphic,window.ActiveXObject||"ActiveXObject"in window?o.onload():o.complete&&o.onload())):(o.onload=o.onerror=o.onreadystatechange=function(){i.call({point:t._point,style:t.options,img:o}),o=o.onload=o.onerror=o.onreadystatechange=null},t.options.graphicTitle&&(o.title=t.options.graphicTitle),t.options.img?(o=t.options.img,i.call({point:t._point,style:t.options,img:o})):(o.src=t.options.externalGraphic,window.ActiveXObject||"ActiveXObject"in window?o.onload():o.complete&&o.onload()))}},_updateArc:function(t){if(this._drawing&&!t._empty()){var e=t._point,i=this._ctx,o=t._radius,n=(t._radiusY||o)/o,l=(360-t.options.endAngle)*(Math.PI/180),s=(360-t.options.startAngle)*(Math.PI/180);this._drawnLayers[t._leaflet_id]=t,1!==n&&(i.save(),i.scale(1,n)),i.beginPath(),i.arc(e.x,e.y/n,o,l,s,!1),1!==n&&i.restore(),this._fillStroke(i,t)}},_afterTo:function(t,e){var i=t._order;if(i){var o=i.next,n=i.prev;if(n)n.next=o;else if(o)return;o?o.prev=n:n&&(this._drawLast=n);var l=e._order,s=l.next;l.next=i,i.prev=l,s?(s.prev=i,i.next=s):(i.next=null,this._drawLast=i),this._requestRedraw(t)}},_beforePath:function(t,e){this._updateDashArray(t),this._layers[L.Util.stamp(t)]=t;var i=e._order,o=i.prev,n=t._order={layer:t,prev:o,next:i};null==n.prev?this._drawFirst=n:o.next=n,i.prev=n},_onMove:function(t){if((!this.layers||this.currentSymbolText)&&this.currentMoveingTargetLayer){var e=this._map.mouseEventToLayerPoint(t),i=e.x-this.downPt.x,o=e.y-this.downPt.y;this.currentSymbolText.offsetX=this.originalOffsetX+i,this.currentSymbolText.offsetY=this.originalOffsetY+o,this.currentMoveingTargetLayer._updatePath()}},_onClick:function(t){var e,i=this,o=this._map.mouseEventToLayerPoint(t),n=[],l=[],s=0,a=[];for(var r in this._map._layers)if(this._map._layers[r]._drawFirst)for(var u=this._map._layers[r]._drawFirst;u;u=u.next)if(u.layer.options.interactive&&u.layer._containsPoint(o)&&!this._map._draggableMoved(u.layer)&&(e=u.layer,Object.prototype.hasOwnProperty.call(e,"_eventParents")&&null!==e._eventParents))for(var p in e._eventParents)-1==a.indexOf(e._eventParents[p].uuid)&&(l.push(e),n.push(e._eventParents[p]),a.push(e._eventParents[p].uuid));if(e&&l.length>1&&n.length>0){for(var h=!1,c=[],y=[],g=0,f=n.length;g<f;g++)n[g].isSelected&&n[g].moveend&&(h=!0),n[g].enableEdit&&(c.push(n[g]),y.push(l[g]),n[g].libID&&(e=l[g]));if(t.altKey){for(var d=0;d<n.length;d++){if(1===n[d].symbolType){s=d;break}n[d].getBounds().contains(n[s].getBounds())||(s=d)}return void this._fireEvent([y[s]],t)}for(var m=0,S=c.length;m<S;m++){if(c[m].isSelected&&c[m].moveend){this._fireEvent([y[m]],t);break}if(c[m].isSelected&&c.length>1){this._fireEvent([y[m]],t);break}if(!h){this._fireEvent([y[y.length-1]],t);break}}}if(l.length>=1&&n[n.length-1].isSpecialEffect&&n[0].isSpecialEffect?n[n.length-1].fire("selectspecialeffect",{specialEffect:n[0]}):this._fireEvent(!!e&&[e],t),void 0!=e&&e.isMeasureObj&&e.fire("selectedMeasureObject",{id:e._id}),"mouseup"==t.type){if(!this.currentMoveingTargetLayer)return;2==t.button&&this.currentMoveingTargetLayer.fire(SuperMap.Plot.Event.signcontextmenu,{sign:this.currentSymbolText,symbol:this.currentFeature}),this._map.dragging.enable(),this.currentMoveingTargetLayer._updatePath(),this.currentMoveingTargetLayer=null,this.originalOffsetX=null,this.originalOffsetY=null,this.currentSymbolText=null,this._map.isDraggingSymbolText=!1,this.currentFeature=null}else if("mousedown"==t.type){this.layers=this._getmoveingLayers();for(var P,b,v,L,M,_,A,T,x,O,w,C,E,I=function(){if(!(P=i.layers[D]).features)return{v:void 0};function e(t,e){for(var i=0;i<t.length;i++)for(var o=0;o<t[i].symbolTexts.length;o++)if(t[i].symbolTexts[o]._bounds&&t[i].symbolTexts[o].textContent==e)return t[i].symbolTexts[o]._bounds;return null}for(i.features=P.features,i.downPt=i._map.mouseEventToLayerPoint(t),b=0;b<i.features.length;b++){if(i.symbolBounds=i.features[b].graphic.getBounds(),v=null,L=i.features[b].symbolTexts,M=null,_=null,!L)return{v:void 0};for(A=L.length-1;A>=0;A--)if(i.features[b].graphic.getImage()&&i.features[b].graphic.getImage().symbolTexts[A]&&"none"!=L[A].style.display&&P.visibility){var o=i._map.getZoom();if(!(L[A].minVisibleLevel>o||L[A].maxVisibleLevel<o)){var n=null;switch(L[A]._bounds?(n=L[A]._bounds,M=n.max.x-n.min.x,_=n.max.y-n.min.y):i.features[b].graphic.getImage().symbolTexts[A]._bounds?(n=i.features[b].graphic.getImage().symbolTexts[A]._bounds,M=n.max.x-n.min.x,_=n.max.y-n.min.y):(n=e(i.features,L[A].textContent),M=n.max.x-n.min.x,_=n.max.y-n.min.y),T=i.features[b].graphic.getImage().symbolTexts[A].position,x=null,O=null,w=null,C=null,T){case SuperMap.Plot.AnnoPosition.LEFTTOP:v={x:i.symbolBounds.min.x,y:i.symbolBounds.min.y},x=v.x+L[A].offsetX-M,O=v.y+L[A].offsetY-_,w=v.x+L[A].offsetX,C=v.y+L[A].offsetY;break;case SuperMap.Plot.AnnoPosition.LEFTBOTTOM:v={x:i.symbolBounds.min.x,y:i.symbolBounds.max.y},x=v.x+L[A].offsetX-M,O=v.y+L[A].offsetY,w=v.x+L[A].offsetX,C=v.y+L[A].offsetY+_;break;case SuperMap.Plot.AnnoPosition.RIGHTTOP:v={x:i.symbolBounds.max.x,y:i.symbolBounds.min.y},x=v.x+L[A].offsetX,O=v.y+L[A].offsetY-_,w=v.x+L[A].offsetX+M,C=v.y+L[A].offsetY;break;case SuperMap.Plot.AnnoPosition.RIGHTBOTTOM:v={x:i.symbolBounds.max.x,y:i.symbolBounds.max.y},x=v.x+L[A].offsetX,O=v.y+L[A].offsetY,w=v.x+L[A].offsetX+M,C=v.y+L[A].offsetY+_;break;case SuperMap.Plot.AnnoPosition.TOP:v={x:(i.symbolBounds.max.x+i.symbolBounds.min.x)/2,y:i.symbolBounds.min.y},x=v.x+L[A].offsetX-M/2,O=v.y+L[A].offsetY-_,w=v.x+L[A].offsetX+M/2,C=v.y+L[A].offsetY;break;case SuperMap.Plot.AnnoPosition.BOTTOM:v={x:(i.symbolBounds.max.x+i.symbolBounds.min.x)/2,y:i.symbolBounds.max.y},x=v.x+L[A].offsetX-M/2,O=v.y+L[A].offsetY,w=v.x+L[A].offsetX+M/2,C=v.y+L[A].offsetY+_;break;case SuperMap.Plot.AnnoPosition.LEFT:v={x:i.symbolBounds.min.x,y:(i.symbolBounds.min.y+i.symbolBounds.max.y)/2},x=v.x+L[A].offsetX-M,O=v.y+L[A].offsetY-_/3,w=v.x+L[A].offsetX,C=v.y+L[A].offsetY+2*_/3;break;case SuperMap.Plot.AnnoPosition.RIGHT:v={x:i.symbolBounds.max.x,y:(i.symbolBounds.min.y+i.symbolBounds.max.y)/2},x=v.x+L[A].offsetX,O=v.y+L[A].offsetY-_/2,w=v.x+L[A].offsetX+M,C=v.y+L[A].offsetY+_/2;break;case SuperMap.Plot.AnnoPosition.ANCHOR:v=i._map.latLngToLayerPoint(i.features[b].latLngs[0]),x=v.x+L[A].offsetX-M/2,O=v.y+L[A].offsetY-_/2,w=v.x+L[A].offsetX+M/2,C=v.y+L[A].offsetY+_/2}if(i.downPt.x>x&&i.downPt.x<w&&i.downPt.y>O&&i.downPt.y<C){i.originalOffsetX=L[A].offsetX,i.originalOffsetY=L[A].offsetY,i._map.dragging.disable(),i.currentMoveingTargetLayer=P,i.currentSymbolText=L[A],i._map.isDraggingSymbolText=!0,i.currentFeature=i.features[b],i.currentFeature._symbolTextInit=!0;break}}}}},D=0;D<this.layers.length;D++)if(E=I())return E.v;this.currentMoveingTargetLayer&&(this.currentMoveingTargetLayer._isDragging=!0)}},_getmoveingLayers:function(){var t=this,e=[];return Object.keys(this._map._layers).forEach(function(i){var o=t._map._layers[i];o instanceof gy&&e.push(o)}),e}}),L.Polyline.prototype._containsPoint=function(t,e){var i,o,n,l,s,a,r=this._clickTolerance()+10;if(this._pxBounds&&!this._pxBounds.contains(t))return!1;for(i=0,l=this._parts.length;i<l;i++)for(o=0,n=(s=(a=this._parts[i]).length)-1;o<s;n=o++)if((e||0!==o)&&L.LineUtil.pointToSegmentDistance(t,a[n],a[o])<=r)return!0;return!1},L.Polygon.prototype._containsPoint=function(t){var e,i,o,n,l,s,a,r,u=!1;if(this._pxBounds&&!this._pxBounds.contains(t))return!1;for(n=0,a=this._parts.length;n<a;n++)for(l=0,s=(r=(e=this._parts[n]).length)-1;l<r;s=l++)i=e[l],o=e[s],i.y>t.y!=o.y>t.y&&t.x<(o.x-i.x)*(t.y-i.y)/(o.y-i.y)+i.x&&(u=!u);return u||L.Polyline.prototype._containsPoint.call(this,t,!0)},L.Polygon.prototype._project=function(){L.Polyline.prototype._project.call(this),this._pxBounds.min.x-=2*this.options.weight,this._pxBounds.min.y-=2*this.options.weight,this._pxBounds.max.x+=2*this.options.weight,this._pxBounds.max.y+=2*this.options.weight},L.supermap.plotting.Text.prototype._containsPoint=function(t){return this._pxBounds.contains(t)},L.supermap.plotting.PointImage.prototype._containsPoint=function(t){return this._pxBounds.contains(t)},L.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},L.Canvas.LABEL_ALIGN_Microsoft={l:"left",r:"right",t:"hanging",b:"alphabetic"},L.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},L.Canvas.drawImageScaleFactor=null;var Sy=L.Evented.extend({options:{},uuid:null,associatedUuid:null,libID:null,code:null,maxEditPts:0,minEditPts:0,symbolType:null,latLngs:[],style:{fill:!1,color:"#0000ff",lineSymbolID:2,opacity:1,weight:1},components:[],initialize:function(t,e,i,o){this.components=[],this.minEditPts=3,this.maxEditPts=9999,this.libID=0,this.code=SuperMap.Plot.SymbolType.AVOIDREGION,this.symbolType=SuperMap.Plot.SymbolType.AVOIDREGION,this.symbolName="避让区域",o.style&&(this.style=SuperMap.Plot.PlottingUtil.cloneObject(o.style)),o&&o.symbolData&&this._parseSymbolData(o.symbolData),L.Util.isArray(i)||(i=[i]),i.length>0&&(this.latLngs=L.Util.isArray(i)?i:[i]),SuperMap.Util.extend(this,o),void 0!==this.uuid&&null!==this.uuid||(this.uuid=SuperMap.Plot.PlottingUtil.generateUuid())},destroy:function(){this.libID=null,this.code=null,this.symbolType=null,this.symbolName=null,this.uuid=null,this.associatedUuid=null,this.minEditPts=null,this.maxEditPts=null,this.latLngs=null,this.components=null},onAdd:function(t){this.layer=t,this._renderer=t._renderer,this._map=t._map,this.redraw(),Th&&(this.dragging||(this.dragging=new Th(this)))},_clearComponents:function(){for(var t=0;t<this.components.length;t++)this.components[t].removeEventParent(this),this.components[t].onRemove(),delete this.components[t];this.components.length=0},_addComponents:function(t){t._map=this._map,t._renderer=this._renderer,t.addEventParent(this),t.onAdd(),this.components.push(t)},_project:function(){var t=this;t._pxBounds=L.bounds(L.point(0,0),L.point(0,0)),t.components.map(function(e){return t._pxBounds.extend(e._pxBounds.min),t._pxBounds.extend(e._pxBounds.max),e})},getBounds:function(){var t=this;return t._bounds=new L.LatLngBounds,t.components.map(function(e){return t._bounds.extend(e.getBounds()),e}),t._bounds},setLatLngs:function(t){return this.latLngs=t,this.redraw()},getLatLngs:function(){return this.latLngs},addLatLng:function(t){if(this.latLngs[this.latLngs.length-1].lat!==t.lat||this.latLngs[this.latLngs.length-1].lng!==t.lng)return this.latLngs.push(t),this.redraw()},redraw:function(){if(this._clearComponents(),this.getLatLngs().length>=this.minEditPts){var t=new L.Polygon(this.getLatLngs(),{smoothFactor:.05});this._addComponents(t),t.setStyle(this.style)}else if(this.getLatLngs().length>=2&&this.getLatLngs().length<this.minEditPts){var e=new L.Polyline(this.getLatLngs(),{smoothFactor:.05});this._addComponents(e),e.setStyle(this.style)}},_modifyPoint:function(){this.redraw(),this._map.getFeatureByUuid(this.associatedUuid).redraw()},move:function(t,e){(L.Util.moveLatLngs(this.getLatLngs(),t,e),this.redraw(),null!==this._map&&void 0!==this._map)&&this._map.getFeatureByUuid(this.associatedUuid).redraw()},rotate:function(t,e){(L.Util.rotateLatLngs(this.getLatLngs(),e,t),null!==this._map&&void 0!==this._map)&&this._map.getFeatureByUuid(this.associatedUuid).redraw()},_reView:function(){},_parseSymbolData:function(t){if(null!==t&&(this.libID=t.libID,this.code=t.code,this.symbolType=t.symbolType,this.maxEditPts=t.algoMaxEditPts,this.minEditPts=t.algoMinEditPts,void 0!==t.uuid&&(this.uuid=t.uuid),void 0!==t.associatedUuid&&(this.associatedUuid=t.associatedUuid),this.latLngs=[],t.controlPoints))for(var e=0;e<t.controlPoints.length;e++)this.latLngs.push(L.latLng(t.controlPoints[e].y,t.controlPoints[e].x))},getSymbolData:function(){var t={};t.uuid=this.uuid,t.associatedUuid=this.associatedUuid,t.libID=this.libID,t.code=this.code,t.symbolType=this.symbolType,t.algoMaxEditPts=this.maxEditPts,t.algoMinEditPts=this.minEditPts,t.controlPoints=[];for(var e=0;e<this.latLngs.length;e++)t.controlPoints.push({x:this.getLatLngs()[e].lng,y:this.getLatLngs()[e].lat,z:0});return t},clone:function(){var t=SuperMap.Plot.PlottingUtil.cloneObject(this.getSymbolData());return t.uuid=SuperMap.Plot.PlottingUtil.generateUuid(),L.supermap.plotting.avoidRegion(0,SuperMap.Plot.SymbolType.AVOIDREGION,L.Util.cloneLatLngs(this.getLatLngs()),{symbolData:t,style:SuperMap.Plot.PlottingUtil.cloneObject(this.style)})},_containsPoint:function(t){var e=L.Util.latLngsToSuperMapPoints(this.getLatLngs());e.push(e[0].clone());var i=SuperMap.Number.limitSigDigs,o=i(t.x,14),n=i(t.y,14);function l(t,e,i,o,n){return(o-e)/(n-i)*(t-n)+o}for(var s,a,r,u,p,h,c,y=e.length-1,g=0,f=0;f<y;++f)if(r=i((s=e[f]).x,14),u=i(s.y,14),p=i((a=e[f+1]).x,14),u!==(h=i(a.y,14))){if((c=i(l(n,r,u,p,h),14))===o&&(u<h&&n>=u&&n<=h||u>h&&n<=u&&n>=h)){g=-1;break}c<=o||r!==p&&(c<Math.min(r,p)||c>Math.max(r,p))||(u<h&&n>=u&&n<h||u>h&&n<u&&n>=h)&&++g}else if(n===u&&(r<=p&&o>=r&&o<=p||r>=p&&o<=r&&o>=p)){g=-1;break}return-1===g?1:!!(1&g)},_relationToLayer:function(t){var e=2,i=[];if(t instanceof L.Polygon)(i=L.Util.latLngsToSuperMapPoints(t.getLatLngs()[0])).push(i[0].clone());else if(t instanceof L.Polyline)i=L.Util.latLngsToSuperMapPoints(t.getLatLngs());else if(t instanceof dh){var o=t.getBounds();i.push(new SuperMap.Geometry.Point(o.left,o.top)),i.push(new SuperMap.Geometry.Point(o.left,o.bottom)),i.push(new SuperMap.Geometry.Point(o.right,o.bottom)),i.push(new SuperMap.Geometry.Point(o.top,o.right))}if(0===i.length)e=2;else{var n=this._containsPoint(i[0]);n&&(e=1);for(var l=1;l<i.length;l++)if(n!==this._containsPoint(i[l])){e=0;break}if(2===e){var s=L.Util.latLngsToSuperMapPoints(this.getLatLngs());s.push(s[0].clone());for(var a=0;a<i.length-1;a++){for(var r=0;r<s.length-1;r++)if(SuperMap.Plot.PlottingUtil.isCross(i[a],i[a+1],s[r],s[r+1])){e=0;break}if(0===e)break}}}return e},_getWithoutPts:function(t,e){var i=L.Util.latLngsToSuperMapPoints(t);!0===e&&i[0].x!==i[i.length-1].x&&i[0].y!==i[i.length-1].y&&i.push(i[0]);for(var o=[],n=[],l=0;l<i.length;l++)if(this._containsPoint(i[l])||n.push(i[l].clone()),l<=i.length-2)for(var s=this._intersectSegs(i[l],i[l+1]),a=0;a<s.length;a++)n.push(s[a].clone()),n.length>1&&(o.push(n),n=[]);0!==n.length&&o.push(n);var r=o.length;if(!0===e&&r>1&&SuperMap.Plot.PlottingUtil.equalFuzzy(o[0][0].x,o[r-1][o[r-1].length-1].x)&&SuperMap.Plot.PlottingUtil.equalFuzzy(o[0][0].y,o[r-1][o[r-1].length-1].y)){for(var u=0;u<o[0].length;u++)o[r-1].push(o[0][u]);o.splice(0,1)}return o},_intersectSegs:function(t,e){var i=L.Util.latLngsToSuperMapPoints(this.getLatLngs());i.push(i[0].clone()),i[0].x!==i[i.length-1].x&&i[0].y!==i[i.length-1].y&&i.push(i[0]);for(var o=[],n=0;n<i.length-1;n++){var l=new SuperMap.Geometry.Point;SuperMap.Plot.PlottingUtil.intersectLineSegs(t,e,i[n],i[n+1],l)&&o.push(l)}for(var s=[];o.length>0;)if(1===o.length)s.push(o[0]),o.splice(0,1);else{for(var a=0,r=SuperMap.Plot.PlottingUtil.distance(t,o[0]),u=1;u<o.length;u++)SuperMap.Plot.PlottingUtil.distance(t,o[u])<r&&(r=SuperMap.Plot.PlottingUtil.distance(t,o[u]),a=u);s.push(o[a]),o.splice(a,1)}return s}}),Py=function(t,e,i,o){return new Sy(t,e,i,o)};L.supermap.plotting.avoidRegion=Py,L.supermap.plotting.AvoidRegion=Sy;var by=xh.extend({route:null,towardNode:null,startRouteNode:null,textAnchor:null,space:null,inner:null,setPosition:function(t){this.textPosition=t,this._calculateOffset()},initialize:function(t,e,i,o){this.symbolName="标牌文字",this.symbolType=SuperMap.Plot.SymbolType.LITERATESIGN,xh.prototype.initialize.call(this,t,e,i,o)},destroy:function(){this.space=null,this.inner=null,this.textAnchor=null,xh.prototype.destroy.call(this)},_calculateParts:function(){if(null!==this.startRouteNode&&null!==this.towardNode&&null!==this.towardNode.textContent&&0!==this.towardNode.textContent.length){for(var t=this.route._getNodeByUuid(this.towardNode.routeNodeId),e=new SuperMap.Geometry.Point(this.startRouteNode.x,this.startRouteNode.y),i=new SuperMap.Geometry.Point(t.x,t.y),o=L.latLng((e.y+i.y)/2,(e.x+i.x)/2),n=SuperMap.Plot.PlottingUtil.getTextCount(this.towardNode.textContent[0]),l=1;l<this.towardNode.textContent.length;l++){var s=SuperMap.Plot.PlottingUtil.getTextCount(this.towardNode.textContent[l]);n<s&&(n=s)}if(null===this.towardNode.offsetX||null===this.towardNode.offsetY){var a=this.space+(this.dScale*this.style.fontSize+1)*n/2,r=this._innerOutlineDir(),u=this._map.layerPointToLatLng(L.point(0,0)),p=this._map.layerPointToLatLng(L.point(a,0)),h=new SuperMap.Geometry.Point(u.lng,u.lat),c=new SuperMap.Geometry.Point(p.lng,p.lat),y=r*SuperMap.Plot.PlottingUtil.distance(h,c);!0===this.inner&&(y=-y);var g=SuperMap.Plot.PlottingUtil.parallel([e,i],y);this.latLngs=[];var f=L.latLng((g[0].y+g[1].y)/2,(g[0].x+g[1].x)/2);this.latLngs.push(f);var d=this._map.latLngToLayerPoint(o),m=this._map.latLngToLayerPoint(f);this.towardNode.offsetX=m.x-d.x,this.towardNode.offsetY=m.y-d.y}else{var S=this._map.latLngToLayerPoint(o),P=L.point(S.x+this.towardNode.offsetX,S.y+this.towardNode.offsetY),b=this._map.layerPointToLatLng(P);0===this.latLngs.length?this.latLngs.push(b):this.latLngs[0]=b}var v=180*SuperMap.Plot.PlottingUtil.radian(e,i)/Math.PI,M=this._getTextContentsCells(n),_="";null!==this._map&&this._map instanceof L.Map&&(_=this._map.options.crs.code);for(var A=0;A<M.length;A++){var T=M[A];L.Util.isMercatorProjection(_)&&(T.positionPoints=L.Util.conventProjectPts(L.Util.superMapPointsToLatLngs(T.positionPoints))),T.positionPoints=SuperMap.Plot.Primitives.getSpatialData(T.type,T.positionPoints,T.angle);for(var x=[],O=0;O<T.positionPoints.length;O++)x.push(SuperMap.Plot.PlottingUtil.coordinateTrans(new SuperMap.Geometry.Point(this.latLngs[0].lng,this.latLngs[0].lat),T.positionPoints[O],v));var w=null;if(L.Util.isMercatorProjection(_)){for(var C=[],E=0,I=(w=L.Util.unConventProjectPts(x)).length;E<I;E++)C.push(SuperMap.Plot.PlottingUtil.coordinateTrans(new SuperMap.Geometry.Point(this.latLngs[0].lng,this.latLngs[0].lat),L.Util.latLngsToSuperMapPoints(w[E])[0],0));w=L.Util.superMapPointsToLatLngs(C)}else w=L.Util.superMapPointsToLatLngs(x);T.type===SuperMap.Plot.SymbolType.TEXTSYMBOL?0!==T.textContent.length&&(T.style.labelRotation=90-v,this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,w,T.style,T.textContent)):this._createAndDrawLayer(T.type,w,T.style,T.textContent)}}},_innerOutlineDir:function(){for(var t=[],e=0;e<this.route.routeNodes.length;e++)t.push(new SuperMap.Geometry.Point(this.route.routeNodes[e].x,this.route.routeNodes[e].y));return SuperMap.Plot.PlottingUtil.innerOutlineDir(t)},move:function(t,e){for(var i=0;i<this.components.length;i++)L.Util.moveLatLngs(this.components[i].getLatLngs(),t,e),this.components[i].setLatLngs(this.components[i].getLatLngs());L.Util.moveLatLngs(this.getLatLngs(),t,e),this._calculateOffset()},_reView:function(){this.scaleByMap&&!1!==this.scaleByMap?(this.dScale*=this._map.getZoomScale(this._map.getZoom(),this.fromZoom),this.dScale>5?this.dScale=5:this.dScale<1&&(this.dScale=1),this.redraw()):this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues),this.fromZoom=this._map.getZoom()},_calculateOffset:function(){var t=this.route._getNodeByUuid(this.towardNode.routeNodeId),e=L.latLng((this.startRouteNode.y+t.y)/2,(this.startRouteNode.x+t.x)/2),i=this._map.latLngToLayerPoint(e),o=this._map.latLngToLayerPoint(this.latLngs[0]);this.towardNode.offsetX=o.x-i.x,this.towardNode.offsetY=o.y-i.y},_getTextContentsCells:function(t){var e=this.towardNode.textContent,i=this.dScale*this.style.fontSize+1,o=this._map.layerPointToLatLng(L.point(0,0)),n=this._map.layerPointToLatLng(L.point(i,0)),l=SuperMap.Plot.PlottingUtil.distance({x:o.lng,y:o.lat},{x:n.lng,y:n.lat}),s=l,a=l*t,r=e.length+2,u=[],p=r*s*.5,h=new Object;h.type=SuperMap.Plot.SymbolType.ARBITRARYPOLYGONSYMBOL,h.positionPoints=[],h.positionPoints.push(new SuperMap.Geometry.Point(p,0)),h.positionPoints.push(new SuperMap.Geometry.Point(-2*s+p,.5*a)),h.positionPoints.push(new SuperMap.Geometry.Point(-r*s+p,.5*a)),h.positionPoints.push(new SuperMap.Geometry.Point(-r*s+p,-.5*a)),h.positionPoints.push(new SuperMap.Geometry.Point(-2*s+p,-.5*a)),h.style={surroundLineFlag:!1,fontSize:12},u.push(h);for(var c=1;c<=e.length;c++){var y=new Object;y.type=SuperMap.Plot.SymbolType.POLYLINESYMBOL,y.positionPoints=[],y.positionPoints.push(new SuperMap.Geometry.Point(-(c+1)*s+p,.5*a)),y.positionPoints.push(new SuperMap.Geometry.Point(-(c+1)*s+p,-.5*a)),y.style={surroundLineFlag:!1,fontSize:12},u.push(y);var g=new Object;g.type=SuperMap.Plot.SymbolType.TEXTSYMBOL,g.positionPoints=[],g.positionPoints.push(new SuperMap.Geometry.Point(-(.5+c+1)*s+p,0)),g.textContent=e[c-1],g.style={surroundLineFlag:!1,fontSize:12,fontFamily:"Microsoft YaHei"},g.style.labelAlign="cm",u.push(g)}var f=new SuperMap.Geometry.Point(-1.4*s+p,0),d=new Object;d.type=SuperMap.Plot.SymbolType.TEXTSYMBOL,d.positionPoints=[],d.positionPoints.push(f),d.textContent=this.towardNode.index.toString(),d.style={surroundLineFlag:!1,fontSize:12,fontSizeLimit:!0,fontFamily:"Microsoft YaHei"},d.style.labelAlign="cm",u.push(d);var m=new Object;return m.type=SuperMap.Plot.SymbolType.CIRCLESYMBOL,m.positionPoints=[],m.positionPoints.push(f),m.positionPoints.push(new SuperMap.Geometry.Point(f.x,.4*s)),m.style={surroundLineFlag:!1,fontSize:12},u.push(m),u}});L.supermap.plotting.literateSign=function(t,e,i,o){return new by(t,e,i,o)},L.supermap.plotting.LiterateSign=by;var vy=Eh.extend({relLineText:0,showPathLine:!0,showPathLineArrow:!1,isCurve:!1,isAvoid:!1,textToLineDistance:0,fontSpace:0,getRelLineText:function(){return this.relLineText},setRelLineText:function(t){this.relLineText!==t&&(this.relLineText=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},setFontSpace:function(t){this.fontSpace!==t&&(this.fontSpace=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getShowPathLine:function(){return this.showPathLine},setShowPathLine:function(t){this.showPathLine!==t&&(this.showPathLine=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getShowPathLineArrow:function(){return this.showPathLineArrow},setShowPathLineArrow:function(t){this.showPathLineArrow!==t&&(this.showPathLineArrow=t,this.showPathLine&&(this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)))},getIsCurveLine:function(){return this.isCurve},setCurveLine:function(t){this.isCurve!==t&&(this.isCurve=t,this.showPathLine&&(this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)))},getIsAvoidLine:function(){return this.isAvoid},setAvoidLine:function(t){this.isAvoid!==t&&(this.isAvoid=t,this.relLineText===SuperMap.Plot.RelLineText.ONLINE&&this.showPathLine&&(this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)))},getSpace:function(){return this.textToLineDistance},setSpace:function(t){this.textToLineDistance!==t&&(this.textToLineDistance=t,this.relLineText!==SuperMap.Plot.RelLineText.ONLINE&&(this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)))},initialize:function(t,e,i,o){this.code=SuperMap.Plot.SymbolType.PATHTEXT,this.libID=0,this.symbolType=SuperMap.Plot.SymbolType.PATHTEXT,this.symbolName="沿线注记",this.minEditPts=2,this.maxEditPts=9999,o.scaleByMap=!1,Eh.prototype.initialize.call(this,t,e,i,o)},_reView:function(){this.fromZoom!==this._map.getZoom()&&(this.redraw(),this.fromZoom=this._map.getZoom())},toSuperMapAlgorithms:function(){Eh.prototype.toSuperMapAlgorithms.call(this),this.superMapAlgoSymbol.relLineText=this.relLineText,this.superMapAlgoSymbol.showPathLine=this.showPathLine,this.superMapAlgoSymbol.showPathLineArrow=this.showPathLineArrow,this.superMapAlgoSymbol.isCurve=this.isCurve,this.superMapAlgoSymbol.isAvoid=this.isAvoid,this.superMapAlgoSymbol.textToLineDistance=this.textToLineDistance}}),Ly=function(t,e,i,o){return new vy(t,e,i,o)};L.supermap.plotting.pathText=Ly,L.supermap.plotting.PathText=vy;var My=xh.extend({route:null,routeNode:null,_isFirstNode:function(){for(var t=0;t<this.route.routeNodes.length;t++)for(var e=0;e<this.route.routeNodes[t].towardNodes.length;e++)if(this.route.routeNodes[t].towardNodes[e].routeNodeId===this.routeNode.id)return!1;return!0},_isLastNode:function(){return 0===this.routeNode.towardNodes.length},setType:function(t){this.routeNode.type=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},setName:function(t){this.routeNode.name=t,this.redraw()},setPosition:function(t,e){this.routeNode.y=this.latLngs[0].lat=t,this.routeNode.x=this.latLngs[0].lng=e;for(var i=0;i<this.route.routeNodes.length;i++)this.route.routeNodes[i].routeNodeId===this.routeNode.id&&(this.route.routeNodes[i].x=this.routeNode.x,this.route.routeNodes[i].y=this.routeNode.y);if(0!==this.route.arrRoutePts.length){if(this.route.arrRoutePts=[],this.route.redraw(),this.route.highlightFlag){var o=SuperMap.Util.cloneObject(this.route.highlightStyle);this.route.highlightStyle&&SuperMap.Util.copyAttributes(o,this.route.highlightStyle),this.route.highlight(o)}}else{for(var n=this.route._getFeatureStartWith(this.routeNode),l=0;l<n.length;l++)n[l]instanceof by||(n[l].latLngs[0]=L.latLng(t,e)),n[l].redraw();for(var s=this.route._getFeatureEndWith(this.routeNode),a=0;a<s.length;a++)s[a]instanceof by||(s[a].latLngs[1]=L.latLng(t,e)),s[a].redraw();this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)}},setRotate:function(t){this.routeNode.type===SuperMap.Plot.RouteNodeType.STANDBY&&this.routeNode.rotate!==t&&(this.routeNode.rotate=t,this.redraw())},getRotate:function(){return this.routeNode.rotate},initialize:function(t,e,i,o){xh.prototype.initialize.call(this,t,e,i,o),this.symbolName=SuperMap.Plot.RouteNodePrimitives.getRouteNodeNameByType(this.routeNode.type),this.symbolType=SuperMap.Plot.SymbolType.ROUTENODE,this.anchorPoint=L.latLng(0,0)},destroy:function(){this.route=null,this.routeNode=null,xh.prototype.destroy.call(this)},_calculateParts:function(){if(0===this.getLatLngs().length?this.latLngs=[L.latLng(this.routeNode.y,this.routeNode.x)]:(this.latLngs[0].lat=this.routeNode.y,this.latLngs[0].lng=this.routeNode.x),this.latLngs.length>=this.minEditPts){if(this.routeNode.type===SuperMap.Plot.RouteNodeType.STANDBY){var t=SuperMap.Plot.RouteNodePrimitives.getRouteNodeCells(this.routeNode.type,!1,this.routeNode.rotate);this._transformSymbolCellsToGeometrys(t);var e=SuperMap.Plot.RouteNodePrimitives.getRouteNodeCells(this.routeNode.type,!0);this._transformSymbolCellsToGeometrys(e)}else{var i=SuperMap.Plot.RouteNodePrimitives.getRouteNodeCells(this.routeNode.type);this._transformSymbolCellsToGeometrys(i)}if(this.routeNode.style=this.style,null!==this.routeNode.name&&""!==this.routeNode.name){var o=this.getBounds(),n=L.latLng(o.getNorth(),o.getEast()),l=this.routeNode.style;l.labelAlign="lb",this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,[n],l,this.routeNode.name).isNameLayer=!0}}},_transformSymbolCellsToGeometrys:function(t){for(var e=this._map.latLngToLayerPoint(this.latLngs[0]),i=0;i<t.length;i++){var o=t[i];o.type===SuperMap.Plot.SymbolType.TEXTSYMBOL&&(o.style.fontSize=this.dScale*o.style.fontSize,o.style.labelRotation+=-this.dRotate);for(var n=0;n<o.positionPoints.length;n++){o.positionPoints[n].x=o.positionPoints[n].x*this.dScale,o.positionPoints[n].y=o.positionPoints[n].y*this.dScale;var l=this.dRotate*(Math.PI/180);SuperMap.Plot.PlottingUtil.rotateAngle({x:this.anchorPoint.lng,y:this.anchorPoint.lat},l,o.positionPoints[n]),o.positionPoints[n]=this._transitionPoint(o.positionPoints[n],e)}o.positionPoints=L.Util.latLngsToSuperMapPoints(o.positionPoints)}this._transSymbolCellsToLayers(t)},_transitionPoint:function(t,e){var i=e.x+t.x*(96/254),o=e.y-t.y*(96/254);return this._map.layerPointToLatLng(L.point(i,o))},move:function(t,e){this.routeNode.x+=e,this.routeNode.y+=t,this.setPosition(this.routeNode.y,this.routeNode.x)},getBounds:function(){for(var t=new L.LatLngBounds,e=0;e<this.components.length;e++){var i=this.components[e];i.isNameLayer||t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t},_reView:function(){this.fromZoom!==this._map.getZoom()&&(this.scaleByMap&&!1!==this.scaleByMap?(this.dScale*=this._map.getZoomScale(this._map.getZoom(),this.fromZoom),this.dScale>5?this.dScale=5:this.dScale<1&&(this.dScale=1),this.redraw()):this.redraw(),this.fromZoom=this._map.getZoom(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))}});L.supermap.plotting.routeNode=function(t,e,i,o){return new My(t,e,i,o)},L.supermap.plotting.RouteNode=My;var _y=bh.extend({routeNodes:[],nextRouteNodeType:SuperMap.Plot.RouteNodeType.TURNING,arrRoutePts:[],initialize:function(t,e,i,o){this.scaleByMap=!1,this.minEditPts=1,this.maxEditPts=9999,this.routeNodes=[],this.arrRoutePts=[],this.prevRouteNode=[],this.prevLiterateSign=[],bh.prototype.initialize.call(this,t,e,i,o)},destroy:function(){this.routeNodes=null,this.arrRoutePts=null,bh.prototype.destroy.apply(this,arguments)},highlight:function(t){this.highlightFlag=!0,this.highlightStyle=t;for(var e=0;e<this.components.length;e++)if(this.components[e]instanceof Eh){var i=SuperMap.Util.copyAttributes(this.components[e].style,t);this.components[e].setStyle(i)}},unhighlight:function(){for(var t=0;t<this.components.length;t++)if(this.components[t]instanceof Eh){var e=SuperMap.Util.copyAttributes(this.components[t].style,this.style);this.components[t].setStyle(e)}this.highlightFlag=!1,this.highlightStyle=null},blinkRoute:function(t,e,i,o){void 0===i&&(i=2),void 0===t&&(t={color:"#ff0000"}),void 0===e&&(e={color:"#0000ff"}),void 0===o&&(o=300);for(var n=[],l=0;l<i;l++)n.push(t),n.push(e);!0===this.highlightFlag&&this.highlightStyle&&null!==this.highlightStyle?n.push(this.highlightStyle):n.push(this.lineStyle);for(var s=this,a=n.length,r=0;r<a;r++)setTimeout(function(){for(var t=0;t<s.components.length;t++)if(s.components[t]instanceof Eh){var e=SuperMap.Util.copyAttributes(s.components[t].style,n[0]);s.components[t].setStyle(e)}n.splice(0,1)},o*r)},applyTextStyle:function(t){for(var e,i=0;i<this.components.length;i++)(this.components[i]instanceof by||this.components[i]instanceof vy)&&(this.components[i].setStyle(SuperMap.Util.copyAttributes(this.components[i].style,t)),e=this.components[i].style);for(var o=0;o<this.routeNodes.length;o++)for(var n=0;n<this.routeNodes[o].towardNodes.length;n++)this.routeNodes[o].towardNodes[n].style=SuperMap.Util.copyAttributes(this.routeNodes[o].towardNodes[n].style,e)},applyLineStyle:function(t){for(var e=0;e<this.components.length;e++)this.components[e]instanceof by||this.components[e]instanceof vy||this.components[e]instanceof My||this.components[e].setStyle(SuperMap.Util.copyAttributes(this.components[e].style,t));this.style=SuperMap.Util.copyAttributes(this.style,t)},applyNodeStyle:function(t){for(var e=0;e<this.components.length;e++)this.components[e]instanceof My&&this.components[e].setStyle(SuperMap.Util.copyAttributes(this.components[e].style,t));for(var i=0;i<this.routeNodes.length;i++)this.routeNodes[i].style=SuperMap.Util.copyAttributes(this.routeNodes[i].style,t)},deleteRouteNode:function(t){if(null!==this._getNodeByUuid(t.id)){var e=this._getNodeFeature(t);e.isSelected&&null!==this._map.getPlotEditControl()&&this._map.getPlotEditControl().unselectFeatures(e),this.arrRoutePts=[];for(var i=0;i<this.routeNodes.length;i++)for(var o=0;o<this.routeNodes[i].towardNodes.length;o++)if(this.routeNodes[i].towardNodes[o].routeNodeId!==t.id);else{this.routeNodes[i].towardNodes.splice(o,1);for(var n=0;n<t.towardNodes.length;n++)t.towardNodes[n].routeNodeId!==this.routeNodes[i].id&&this.routeNodes[i].towardNodes.push(t.towardNodes[n])}for(var l=0;l<this.routeNodes.length;l++)this.routeNodes[l].id===t.id&&this.routeNodes.splice(l,1);this.redraw()}},updateRouteNode:function(t){if(0!==this.arrRoutePts.length){this.arrRoutePts=[];var e=this._getNodeByUuid(t.id);if(null!==e?e=t:this.routeNodes.push(t),this.redraw(),this.highlightFlag){var i=SuperMap.Util.cloneObject(this.highlightStyle);this.highlightStyle&&SuperMap.Util.copyAttributes(i,this.highlightStyle),this.highlight(i)}}else{var o=this._getNodeFeature(t);if(null!==o){o.routeNode=t,o.redraw();for(var n=this._getFeatureStartWith(t),l=0;l<n.length;l++)n[l].latLngs[0]=L.latLng(t.y,t.x),n[l].redraw();for(var s=this._getFeatureEndWith(t),a=0;a<s.length;a++)s[a].latLngs[1]=L.latLng(t.y,t.x),s[a].redraw();return}}},insertRouteNode:function(t,e,i,o,n,l,s,a){if(void 0===o&&(o=!0),this.arrRoutePts=[],o&&i)for(var r=0;r<e.towardNodes.length;r++)e.towardNodes[r].routeNodeId===i.id&&e.towardNodes.splice(r,1);if(null===this._getNodeByUuid(t.id)&&this.routeNodes.push(t),e){for(var u=!1,p=0;p<e.towardNodes.length;p++)e.towardNodes[p].routeNodeId===t.id&&(u=!0);if(!1===u){var h=new SuperMap.Plot.TowardNode;h.routeNodeId=t.id,void 0!==n&&(h.textContent=n),void 0!==l&&(h.relLineText=l),e.towardNodes.push(h)}}if(i){for(var c=!1,y=0;y<t.towardNodes.length;y++)t.towardNodes[y].routeNodeId===i.id&&(c=!0);if(!1===c){var g=new SuperMap.Plot.TowardNode;g.routeNodeId=i.id,void 0!==s&&(g.textContent=s),void 0!==a&&(g.relLineText=a),t.towardNodes.push(g)}}this.redraw()},addRouteNode:function(t,e,i,o){if(null===this._getNodeByUuid(t.id)&&(this.arrRoutePts=[],this.routeNodes.push(t)),e){for(var n=!1,l=0;l<e.towardNodes.length;l++)e.towardNodes[l].routeNodeId===t.id&&(n=!0);if(!1===n){var s=new SuperMap.Plot.TowardNode;s.routeNodeId=t.id,void 0!==i&&(s.textContent=i),void 0!==o&&(s.relLineText=o),e.towardNodes.push(s)}}this.redraw()},_addRouteNodeByNode:function(t,e,i){if(null===this._getNodeByUuid(t.id))return null;var o=new SuperMap.Plot.RouteNode;if(o.x=t.x,o.y=t.y,o.name="",o.type=this.nextRouteNodeType,!0===e){var n=new SuperMap.Plot.TowardNode;n.routeNodeId=t.id,o.towardNodes.push(n)}else if(!0===i){var l=new SuperMap.Plot.TowardNode;l.routeNodeId=o.id,t.towardNodes.push(l)}return this.routeNodes.push(o),this.redraw(),this._getNodeFeature(o)},_addRouteNodeByPosWithoutLast:function(t,e){for(var i=0;i<this.routeNodes.length;i++){var o=this.routeNodes[i];if(null!==o&&(o.towardNodes&&null!==o.towardNodes))for(var n=0;n<o.towardNodes.length;n++){var l=this._getNodeByUuid(o.towardNodes[n].routeNodeId);if(null!==l){var s=SuperMap.Plot.PlottingUtil.computePointToLineMinDis({x:t.lng,y:t.lat},[{x:o.x,y:o.y},{x:l.x,y:l.y}]);if(-1!==s.index&&s.minDis<e){var a=new SuperMap.Plot.RouteNode;a.x=t.lng,a.y=t.lat,a.type=this.nextRouteNodeType,a.name="",a.towardNodes.push(o.towardNodes[n]),o.towardNodes.splice(n,1);var r=new SuperMap.Plot.TowardNode;return r.routeNodeId=a.id,o.towardNodes.push(r),this.arrRoutePts=[],this.routeNodes.push(a),this.redraw(),this._getNodeFeature(a)}}}}return null},_addRouteNodeByPos:function(t,e){for(var i=[],o=0;o<this.routeNodes.length;o++){var n=this.routeNodes[o];if(null!==n&&(n.towardNodes&&null!==n.towardNodes)){0===n.towardNodes.length&&i.push(n);for(var l=0;l<n.towardNodes.length;l++){var s=this._getNodeByUuid(n.towardNodes[l].routeNodeId);if(null!==s){var a=SuperMap.Plot.PlottingUtil.computePointToLineMinDis({x:t.lng,y:t.lat},[{x:n.x,y:n.y},{x:s.x,y:s.y}]);if(-1!==a.index&&a.minDis<e){var r=new SuperMap.Plot.RouteNode;r.x=t.lng,r.y=t.lat,r.type=this.nextRouteNodeType,r.name=(this.routeNodes.length+1).toString(),r.towardNodes.push(n.towardNodes[l]),n.towardNodes.splice(l,1);var u=new SuperMap.Plot.TowardNode;return u.routeNodeId=r.id,n.towardNodes.push(u),this.arrRoutePts=[],this.routeNodes.push(r),void this.redraw()}}}}}var p=new SuperMap.Plot.RouteNode;if(p.x=t.lng,p.y=t.lat,0!==this.routeNodes.length?p.type=this.nextRouteNodeType:p.type=SuperMap.Plot.RouteNodeType.AIMING,p.name=(this.routeNodes.length+1).toString(),0!==i.length){var h=new SuperMap.Plot.TowardNode;h.routeNodeId=p.id,i[0].towardNodes.push(h)}this.routeNodes.push(p),this.redraw()},setNextRouteNodeType:function(t){this.nextRouteNodeType=t},_getNodeFeature:function(t){for(var e=0;e<this.components.length;e++)if(this.components[e]instanceof My&&this.components[e].routeNode.id===t.id)return this.components[e];return null},_getFeatureStartWith:function(t){for(var e=[],i=0;i<this.components.length;i++)this.components[i]._startRouteNode&&this.components[i]._startRouteNode===t.id&&e.push(this.components[i]);return e},_getFeatureEndWith:function(t){for(var e=[],i=0;i<this.components.length;i++)this.components[i]._endRouteNode&&this.components[i]._endRouteNode===t.id&&e.push(this.components[i]);return e},_selectNodeLayer:function(t){L.Util.isArray(t)||(t=[t]);for(var e=0;e<this.components.length;e++)if((this.components[e]instanceof My||this.components[e]instanceof by)&&this.components[e].getBounds().contains(t))return this.components[e];return null},redraw:function(){if(this._initRoute(),this.arrRoutePts&&0!==this.arrRoutePts.length)for(var t=0;t<this.arrRoutePts.length;t++){var e=this.arrRoutePts[t];if(!(e.length<2)){var i=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.POLYLINESYMBOL,e,{enableEdit:!1,scaleByMap:!1},this.style);i.route=this,this._addComponents(i)}}for(var o=0;o<this.routeNodes.length;o++){var n=this.routeNodes[o];if(null!==n&&(n.towardNodes&&null!==n.towardNodes)){for(var l=0;l<n.towardNodes.length;l++){var s=this._getNodeByUuid(n.towardNodes[l].routeNodeId);if(null!==s){var a=[];if(a.push(L.latLng(n.y,n.x)),a.push(L.latLng(s.y,s.x)),0===this.arrRoutePts.length){var r=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.POLYLINESYMBOL,a,{enableEdit:!1,scaleByMap:!1},this.style);this._addComponents(r),r._startRouteNode=n.id,r._endRouteNode=s.id}var u=n.towardNodes[l].textContent;if(null!==u){var p=n.towardNodes[l].relLineText;void 0!==p&&null!==p||(p=SuperMap.Plot.RelLineText.ONLEFTLINE);var h=SuperMap.Util.copyAttributes(SuperMap.Plot.PlottingUtil.cloneObject(this.style),n.towardNodes[l].style),c=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.PATHTEXT,a,{relLineText:p,showPathLine:!1,textContent:u,enableEdit:!1,scaleByMap:!1},h);this._addComponents(c),c._startRouteNode=n.id,c._endRouteNode=s.id}}}this._createRouteNode(n)}}this._finishRoute()},_initRoute:function(){this.prevRouteNode.length=0,this.prevLiterateSign.length=0;for(var t=0;t<this.components.length;t++)this.components[t]instanceof My?this.prevRouteNode.push(this.components[t]):this.components[t]instanceof by?this.prevLiterateSign.push(this.components[t]):this.components[t]._clearComponents();this.components.length=0},_finishRoute:function(){for(var t=0;t<this.prevRouteNode.length;t++)this.prevRouteNode[t]._clearComponents();for(var e=0;e<this.prevLiterateSign.length;e++)this.prevLiterateSign[e]._clearComponents();this.prevRouteNode=[],this.prevLiterateSign=[]},_createRouteNode:function(t){if(SuperMap.Util.applyDefaults(t.style,this._defaultStyle),null!==t){for(var e=0;e<this.prevRouteNode.length;){if(this.prevRouteNode[e].routeNode.id===t.id)return this.prevRouteNode[e].routeNode=t,this.prevRouteNode[e].redraw(),this.components.push(this.prevRouteNode[e]),void this.prevRouteNode.splice(e,1);e++}var i=SuperMap.Util.copyAttributes(SuperMap.Plot.PlottingUtil.cloneObject(this.style),t.style),o=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.ROUTENODE,[L.latLng(t.y,t.x)],{routeNode:t,route:this},i);this._addComponents(o)}},_addComponents:function(t){vh.prototype._addComponents.call(this,t)},_clearComponents:function(){vh.prototype._clearComponents.call(this)},clone:function(){var t=SuperMap.Plot.PlottingUtil.cloneObject(this.getSymbolData());return t.uuid=SuperMap.Plot.PlottingUtil.generateUuid(),L.supermap.plotting.PlottingObject.createSymbol(this.libID,this.code,null,{symbolData:t,serverUrl:this.serverUrl})},_parseSymbolData:function(){if(bh.prototype._parseSymbolData.call(this),this.symbolData){this.routeNodes=this.symbolData.routeNodes,this.routeNodes=[];for(var t=0;t<this.symbolData.routeNodes.length;t++){var e=new SuperMap.Plot.RouteNode;null===this.symbolData.routeNodes[t].id&&void 0===this.symbolData.routeNodes[t].id||(e.id=this.symbolData.routeNodes[t].id),e.type=this.symbolData.routeNodes[t].type,e.name=this.symbolData.routeNodes[t].name,e.rotate=this.symbolData.routeNodes[t].rotate,Object.prototype.hasOwnProperty.call(this.symbolData.routeNodes[t],"positionPoint")?(e.x=this.symbolData.routeNodes[t].positionPoint.x,e.y=this.symbolData.routeNodes[t].positionPoint.y):(e.x=this.symbolData.routeNodes[t].x,e.y=this.symbolData.routeNodes[t].y),e.towardNodes=[];for(var i=0;i<this.symbolData.routeNodes[t].towardNodes.length;i++){var o=new SuperMap.Plot.TowardNode;o.routeNodeId=this.symbolData.routeNodes[t].towardNodes[i].routeNodeId,o.relLineText=this.symbolData.routeNodes[t].towardNodes[i].relLineText,o.textContent=this.symbolData.routeNodes[t].towardNodes[i].textContent,o.offsetX=this.symbolData.routeNodes[t].towardNodes[i].offsetX,o.offsetY=this.symbolData.routeNodes[t].towardNodes[i].offsetY,o.style=this.symbolData.routeNodes[t].towardNodes[i].style,e.towardNodes.push(o)}e.style=this.symbolData.routeNodes[t].style,this.routeNodes.push(e)}this.arrRoutePts=[];for(var n=0;n<this.symbolData.arrRoutePts.length;n++){for(var l=[],s=0;s<this.symbolData.arrRoutePts[n].length;s++)Object.prototype.hasOwnProperty.call(this.symbolData.arrRoutePts[n][s],"x")&&Object.prototype.hasOwnProperty.call(this.symbolData.arrRoutePts[n][s],"y")?l.push(L.latLng(this.symbolData.arrRoutePts[n][s].y,this.symbolData.arrRoutePts[n][s].x)):l.push(L.latLng(this.symbolData.arrRoutePts[n][s].lat,this.symbolData.arrRoutePts[n][s].lng));this.arrRoutePts.push(l)}this.lineStyle=this.symbolData.lineStyle}},_setSymbolData:function(){bh.prototype._setSymbolData.call(this),this.symbolData&&(this.symbolData.routeNodes=this.routeNodes,this.symbolData.arrRoutePts=this.arrRoutePts,this.symbolData.lineStyle=this.lineStyle)},_getNodeByUuid:function(t){for(var e=0;e<this.routeNodes.length;e++)if(this.routeNodes[e].id===t)return this.routeNodes[e];return null},_reView:function(){if(this.fromZoom!==this._map.getZoom())for(var t=0;t<this.components.length;t++)this.components[t].symbolType!==SuperMap.Plot.SymbolType.POLYLINESYMBOL&&this.components[t]._reView();this.fromZoom=this._map.getZoom(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)}});L.supermap.plotting.Route=_y;var Ay=L.Path.extend({name:"图元层",serverUrl:null,features:null,visibility:!0,symScaleDefinition:null,enableSymScale:null,options:{serviceParams:{proxy:null,withCredentials:!1,crossOrigin:null,headers:null,serverType:null}},getVisibility:function(){return this.visibility},setVisibility:function(t){if(this.visibility!==t){this.visibility=t;for(var e=0;e<this.features.length;e++)if(this.features[e].redraw(),this.features[e].fire("featurevisiblechanged"),this._map&&this._map.getPlotEditControl()){if(Object.prototype.hasOwnProperty.call(this._map.getPlotEditControl()._editMarkers,this.features[e].uuid))for(var i=this._map.getPlotEditControl()._editMarkers[this.features[e].uuid],o=0;o<i.length;o++)this.visibility?i[o].setOpacity(1):i[o].setOpacity(0);null!=this.features[e].dragging&&null!=this.features[e].dragging.moveMarker&&(this.visibility?this.features[e].dragging.moveMarker.setOpacity(1):this.features[e].dragging.moveMarker.setOpacity(0))}}},enableSymScaleDefinition:function(t){this.enableSymScale=t},getSymScaleDefinition:function(){return null==this.symScaleDefinition&&!0===this.enableSymScale&&(this.symScaleDefinition=L.supermap.plotting.getControl().getPlotMapManager().getSymScaleDefinition()),this.symScaleDefinition},setSymScaleDefinition:function(t,e){if(!1!==this.enableSymScale){var i=this.symScaleDefinition;this.symScaleDefinition=t;for(var o=0;o<this.features.length;o++)this.features[o].redraw();if(0!==this.symScaleDefinition&&0!==i&&!e){var n=this.symScaleDefinition/i;for(o=0;o<this.features.length;o++)if(this.features[o]instanceof Ry){n<this.features[o].minScale?n=this.features[o].minScale:n>this.features[o].maxScale&&(n=this.features[o].maxScale);var l=this.features[o].getSymbolSize().w*n,s=this.features[o].getSymbolSize().h*n;this.features[o].setSymbolSize(l,s)}}}},initialize:function(t,e,i){this.enableSymScale=!1,i=i||{},L.setOptions(this,i),this.name=t,this.serverUrl=e,this.features=[]},destroy:function(){this.name="",this.serverUrl=null,this.features=null},beforeAdd:function(t){L.Path.prototype.beforeAdd.call(this,t)},onAdd:function(t){var e=this;L.Path.prototype.onAdd.call(this,t),this._map=t;var i=this;null==Mc.prototype.map&&(Mc.prototype.map=t),i instanceof Iy&&(L.supermap.plotting.getControl().getPlotMapManager().addPlottingLayer(i),i.getSymScaleDefinition()),i._isSignSymbolLayer&&(L.supermap.plotting.getControl().getPlotMapManager().addSignSymbolLayer(i),i.getSymScaleDefinition()),this._map.on("zoomend",function(){var t=Mc.prototype.getLayerScale();if(0==t||"function"==typeof i.getMinVisibleScale&&i.getMinVisibleScale()>0&&t<i.getMinVisibleScale()||"function"==typeof i.getMaxVisibleScale&&i.getMaxVisibleScale()>0&&t>i.getMaxVisibleScale())for(var e=0;e<i.features.length;e++)null!=i.features[e].components&&i.features[e].components.length>0&&(i.features[e].redraw(),i.features[e].fromZoom=i._map.getZoom());else for(var o=0;o<i.features.length;o++)null!=i.features[o].components&&0===i.features[o].components.length||i.features[o]._clusterShowStatus?(i.features[o]._clusterShowStatus&&i.features[o]._reView(),i.features[o].redraw(),i.features[o].fromZoom=i._map.getZoom()):i.features[o]._reView()}),this._map.on("zoomend",function(){if(i.isCombine)i._doCluster(i.unitSize);else{if(!this.features)return;for(var t=0;t<this.features.length;t++)this.features[t]._clusterShowStatus="display",this.features[t]._oldClusterShowStatus="none"}}),this._map.on("mouseup",function(){if(i.isCombine)i._doCluster(i.unitSize);else{if(!this.features)return;for(var t=0;t<this.features.length;t++)this.features[t]._clusterShowStatus="display",this.features[t]._oldClusterShowStatus="none"}}),this._map.on("mousedown",function(t){if(e._map){e.players=e._map.getPlottingLayers();for(var i,o,n,l,s,a,r,u,p,h,c,y,g,f,d=function(){if(!(i=e.players[m]).features||0==i.features.length)return{v:void 0};function f(t,e){for(var i=0;i<t.length;i++)for(var o=0;o<t[i].symbolTexts.length;o++)if(t[i].symbolTexts[o]._bounds&&JSON.stringify(t[i].symbolTexts[o].textContent)==JSON.stringify(e))return t[i].symbolTexts[o]._bounds;return null}for(e.pfeatures=i.features,e.downPt=t.layerPoint,o=0;o<e.pfeatures.length;o++)if((0!==e.pfeatures[o].libID||999!==e.pfeatures[o].code)&&e.pfeatures[o]&&e.pfeatures[o].getBounds){if(e.symbolBounds=e.pfeatures[o].getBounds(),n=null,l=e.pfeatures[o].symbolTexts,s=null,a=null,!l)return{v:void 0};for(r=0;r<l.length;r++){if(l[r]._bounds)s=l[r]._bounds.max.x-l[r]._bounds.min.x,a=l[r]._bounds.max.y-l[r]._bounds.min.y;else{if(null==(u=f(e.pfeatures,l[r].textContent)))return{v:void 0};s=u.max.x-u.min.x,a=u.max.y-u.min.y}switch(p=l[r].textPosition,h=null,c=null,y=null,g=null,p){case SuperMap.Plot.AnnoPosition.LEFTTOP:n=e._map.latLngToLayerPoint(L.latLng(e.symbolBounds.getNorth(),e.symbolBounds.getWest())),h=n.x+l[r].offsetX-s,c=n.y+l[r].offsetY-a,y=n.x+l[r].offsetX,g=n.y+l[r].offsetY;break;case SuperMap.Plot.AnnoPosition.LEFTBOTTOM:n=e._map.latLngToLayerPoint(L.latLng(e.symbolBounds.getSouth(),e.symbolBounds.getWest())),h=n.x+l[r].offsetX-s,c=n.y+l[r].offsetY,y=n.x+l[r].offsetX,g=n.y+l[r].offsetY+a;break;case SuperMap.Plot.AnnoPosition.RIGHTTOP:n=e._map.latLngToLayerPoint(L.latLng(e.symbolBounds.getNorth(),e.symbolBounds.getEast())),h=n.x+l[r].offsetX,c=n.y+l[r].offsetY-a,y=n.x+l[r].offsetX+s,g=n.y+l[r].offsetY;break;case SuperMap.Plot.AnnoPosition.RIGHTBOTTOM:n=e._map.latLngToLayerPoint(L.latLng(e.symbolBounds.getSouth(),e.symbolBounds.getEast())),h=n.x+l[r].offsetX,c=n.y+l[r].offsetY,y=n.x+l[r].offsetX+s,g=n.y+l[r].offsetY+a;break;case SuperMap.Plot.AnnoPosition.TOP:n=e._map.latLngToLayerPoint(L.latLng(e.symbolBounds.getNorth(),(e.symbolBounds.getWest()+e.symbolBounds.getEast())/2)),h=n.x+l[r].offsetX-s/2,c=n.y+l[r].offsetY-a,y=n.x+l[r].offsetX+s/2,g=n.y+l[r].offsetY;break;case SuperMap.Plot.AnnoPosition.BOTTOM:n=e._map.latLngToLayerPoint(L.latLng(e.symbolBounds.getSouth(),(e.symbolBounds.getWest()+e.symbolBounds.getEast())/2)),h=n.x+l[r].offsetX-s/2,c=n.y+l[r].offsetY,y=n.x+l[r].offsetX+s/2,g=n.y+l[r].offsetY+a;break;case SuperMap.Plot.AnnoPosition.LEFT:n=e._map.latLngToLayerPoint(L.latLng((e.symbolBounds.getSouth()+e.symbolBounds.getNorth())/2,e.symbolBounds.getWest())),h=n.x+l[r].offsetX-s,c=n.y+l[r].offsetY-a/3,y=n.x+l[r].offsetX,g=n.y+l[r].offsetY+2*a/3;break;case SuperMap.Plot.AnnoPosition.RIGHT:n=e._map.latLngToLayerPoint(L.latLng((e.symbolBounds.getSouth()+e.symbolBounds.getNorth())/2,e.symbolBounds.getEast())),h=n.x+l[r].offsetX,c=n.y+l[r].offsetY-a/2,y=n.x+l[r].offsetX+s,g=n.y+l[r].offsetY+a/2;break;case SuperMap.Plot.AnnoPosition.ANCHOR:n=e._map.latLngToLayerPoint(e.features[o].latLngs[0]),h=n.x+l[r].offsetX-s/2,c=n.y+l[r].offsetY-a/2,y=n.x+l[r].offsetX+s/2,g=n.y+l[r].offsetY+a/2}if(e.downPt.x>h&&e.downPt.x<y&&e.downPt.y>c&&e.downPt.y<g){e.currentSymbolText=l[r],e.originalOffsetX=l[r].offsetX,e.originalOffsetY=l[r].offsetY,e.currentSymbol=e.pfeatures[o],e.currentPlottingLayer=i,e._map.isDraggingSymbolText=!0,e.currentSymbol._symbolTextInit=!0,e._map.dragging.disable();break}}}},m=0;m<e.players.length;m++)if(f=d())return f.v}}),this._map.on("mousemove",function(t){if(e.currentSymbolText&&e.currentSymbol&&e.currentPlottingLayer){var i=t.layerPoint.x-e.downPt.x,o=t.layerPoint.y-e.downPt.y;e.currentSymbolText.offsetX=e.originalOffsetX+i,e.currentSymbolText.offsetY=e.originalOffsetY+o;for(var n=0;n<e.features.length;n++)e.features[n].redraw()}}),this._map.on("mouseup",function(t){e.currentPlottingLayer&&(e.currentPlottingLayer=null,e.currentSymbolText=null,e.currentSymbol=null,e._map&&(e._map.dragging.enable(),e._map.isDraggingSymbolText=!1),e._update())}),this._isDragging=!0},_getPlottingLayers:function(){var t=this,e=[];return this._map&&this._map._layers&&Object.keys(this._map._layers).forEach(function(i){var o=t._map._layers[i];o instanceof Iy&&e.push(o)}),e},onRemove:function(){L.Path.prototype.onRemove.call(this),this.removeAllFeatures(),L.supermap.plotting.getControl().getPlotMapManager().removePlottingLayer(this)},addFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=0;e<t.length;)t[e]instanceof bh||t[e]instanceof Sy?(this.features.push(t[e]),t[e].onAdd(this),e++):t.splice(e,1)},removeFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=0,i=t.length;e<i;e++){var o=t[e];if(-1!=SuperMap.Util.indexOf(this.features,o)&&(o instanceof bh||t[e]instanceof Sy)){(o instanceof vh||o instanceof _y)&&this._map&&this._map.getPlotEditControl()&&(this._map.getPlotEditControl().unselectFeatures(o.components),this._map.getPlotEditControl().disableEditFeatures(o.components)),this._map&&this._map.getPlotEditControl()&&(this._map.getPlotEditControl().unselectFeatures(o),this._map.getPlotEditControl().disableEditFeatures(o)),o.symbolType===SuperMap.Plot.SymbolType.ROUTENODE&&o.route&&o.route.deleteRouteNode(o.routeNode),o.symbolType!==SuperMap.Plot.SymbolType.SYMBOLTEXT&&o.symbolType!==SuperMap.Plot.SymbolType.SYMBOLTEXT1||o.removeSymbolTextsFromDotSymbol(o.associatedUuid),o.symbolType===SuperMap.Plot.SymbolType.LINERELATION&&(o.startAssociatedUuid&&o.removeJoinLineFromDotSymbol(o.startAssociatedUuid),o.endAssociatedUuid&&o.removeJoinLineFromDotSymbol(o.endAssociatedUuid)),o.ownerGroup?(o.ownerGroup.removeComponents(),this.removeFeatures(o)):(o._clearComponents(),o.geoSymbolTexts&&o.geoSymbolTexts.length>0&&this.removeFeatures(o.geoSymbolTexts));var n=SuperMap.Util.indexOf(this.features,o);-1!==n&&this.features.splice(n,1),o.layer=null}}this._update()},getFeatures:function(){return this.features.slice()},removeAllFeatures:function(){this.removeFeatures(this.features.slice()),this.features=[]},getSymZoomScale:function(t){return null==this.getSymScaleDefinition()||0==this.getSymScaleDefinition()||!0!==this.enableSymScale?1:L.supermap.plotting.getControl().getPlotMapManager().getLayerScale(t)/this.getSymScaleDefinition()},_getSymbolDataFromCache:function(t,e){var i=L.supermap.plotting.getControl(this._map,this.serverUrl,{serviceParams:this.options.serviceParams}).getSymbolLibManager().getSymbolLibByLibId(t);return null!==i?i.getSymbolData(e):null},_cacheSymbolData:function(t){var e=L.supermap.plotting.getControl(this._map,this.serverUrl,{serviceParams:this.options.serviceParams}).getSymbolLibManager().getSymbolLibByLibId(t.libID);null!==e&&e.cacheSymbolData(t)},_setCursorStyle:function(t){void 0===t&&(t="");var e=!1;if(this._map.getPlottingLayers().length>1){var i=this._map.getPlottingLayers();for(var o in i)if(i[o]._renderer instanceof L.Canvas)i[o]._renderer._container.style.cursor=t;else if(i[o]._renderer instanceof L.SVG)for(var n=0;n<i[o]._renderer._rootGroup.childNodes.length;n++)i[o]._renderer._rootGroup.childNodes[n].style.cursor=t;e=!0}if(!e)if(this._renderer instanceof L.Canvas)this._renderer._container.style.cursor=t;else if(this._renderer instanceof L.SVG&&!L.Browser.ie){for(var l=0;l<this._renderer._rootGroup.childNodes.length;l++)this._renderer._rootGroup.childNodes[l].style.cursor=t;this._map._panes.overlayPane.style.cursor=t,this._map._panes.overlayPane.style.width=this._renderer._svgSize.x+"px",this._map._panes.overlayPane.style.height=this._renderer._svgSize.y+"px"}},_update:function(){this._map&&this._updatePath()},_containsPoint:function(){return!1},_updatePath:function(){this._renderer._drawPlottingLayers(this._getLayersInBounds())},_project:function(){var t=this;t._pxBounds=L.bounds(L.point(0,0),L.point(0,0)),t._getLayersInBounds().map(function(e){return e._project(),void 0!==e._pxBounds.min&&void 0!==e._pxBounds.max&&(t._pxBounds.extend(e._pxBounds.min),t._pxBounds.extend(e._pxBounds.max)),e})},_getLayersInBounds:function(){var t=[],e=this._map.getBounds();return this.features.map(function(i){var o=i.getBounds();return null!=o&&o.isValid()&&e.contains(o)&&t.push(i),i}),t},bringToBack:function(){return L.Path.prototype.beforeAdd.call(this),this._map&&(L.DomUtil.toBack(this._getContainer()),this._setAutoZIndex(Math.max)),this},bringToFront:function(){return L.Path.prototype.bringToFront.call(this),this._map&&(L.DomUtil.toFront(this._getContainer()),this._setAutoZIndex(Math.min)),this},_setAutoZIndex:function(t){for(var e,i=this.getPane().children,o=-t(-1/0,1/0),n=0,l=i.length;n<l;n++)e=i[n].style.zIndex,i[n]!==this._container&&e&&(o=t(o,+e));isFinite(o)&&(this.options.zIndex=o+t(-1,1),this._updateZIndex())},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_getContainer:function(){return this._renderer._container}}),Ty=Ay.extend({caption:"标牌图层",tolerancePixel:5,isLocked:!1,isEditable:!0,isSelected:!0,minVisibleScale:0,maxVisibleScale:0,selectedSignSymbol:null,initialize:function(t,e,i){this.visibility=!0,Ay.prototype.initialize.call(this,t,e,i),null!=i&&i.caption&&(this.caption=i.caption),this._isSignSymbolLayer=!0,this.setVisibility(this.visibility),this.setSymScaleDefinition(L.supermap.plotting.getControl().getPlotMapManager().getSymScaleDefinition(),!0)},getEvents:function(){var t={click:this._handleClick,mousemove:this._onMapMouseMove,contextmenu:this._handleContextmenu};return this._map._zoomAnimated&&(t.zoomanim=this._zoomAnim),t},_handleClick:function(t){var e=this;if(!1!==e.isSelected&&!1!==e.visibility){e.selectedFeatures&&(e._map.getPlotEditControl().unselectSignSymbol(),e.selectedFeatures=null);for(var i=e.getSignSymbols(),o=i.length-1;o>=0;o--){var n=!1;if(i[o].components.length>0)for(var l=0;l<i[o].components.length;l++)i[o].components[l].options.isSignSymbol&&i[o].components[l]._containsPoint(e._map.latLngToLayerPoint(t.latlng))&&i[o].getEnableSelected()&&(n=!0);if(n)return e._map.getPlotEditControl().getSelectedFeatures().length>0&&e._map.getPlotEditControl().unselectFeatures(),e._map.getPlotEditControl().getSelectedSignSymbols().length>0&&e._map.getPlotEditControl().unselectSignSymbol(),void(i[o].getVisible()&&(e._map.getPlotEditControl().selectSignSymbol(i[o]),e.selectedFeatures=i[o]))}}},createSignSymbol:function(t,e,i,o){var n,l=SuperMap.Util.cloneObject(i);if(null===this._map||void 0===this._map)return null;var s=e.clone(),a=t.clone();if(null===(n=new Ch(a,s,l)))return null;this.addFeatures(n),"function"==typeof o&&n.once("signsymbolcreated",o)},findSignSymbolByUuid:function(t){if(null===this.features||null===t||""===t)return null;for(var e=null,i=0;i<this.features.length;i++)if(this.features[i].uuid===t){e=this.features[i];break}return e},addFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]),0!==t.length&&(this.fire(SuperMap.Plot.Event.beforesignsymbolsadded,{features:t}),Ay.prototype.addFeatures.call(this,t),this.fire(SuperMap.Plot.Event.signsymbolsadded,{features:t,layername:this.name}))},removeFeatures:function(t){if(SuperMap.Util.isArray(t)||(t=[t]),null===this.features)return!1;if(0!==t.length){this.fire("beforesignsymbolremoved",{signSymbols:t,layername:this.name});for(var e=0;e<t.length;e++)for(var i=0;i<this.features.length;i++)this.features[i].uuid==t[e].uuid&&(null!==this._map.getPlotEditControl()&&this._map.getPlotEditControl().unselectSignSymbol(this.features[i]),1==this.features[i]._bAdd&&this.features[i]._removeEvent(),this.features[i]._polyline&&this.features[i]._polyline.remove(),this.features[i].symbolText.destroy(),this.features[i]._clearComponents(),this.features.splice(i,1));this.fire("signsymbolsremoved",{signSymbols:t,layername:this.name})}},removeAllFeatures:function(){if(null===this.features)return!1;for(;this.features.length>0;)this.removeFeatures(this.features[0]);return this.features=[],!0},destroy:function(){this.removeAllFeatures(),this.map=null},getMinVisibleScale:function(){return null==this.minVisibleScale&&(this.minVisibleScale=0),this.minVisibleScale},setMinVisibleScale:function(t){this.minVisibleScale=t,this.maxVisibleScale>1e-7&&this.maxVisibleScale<t&&(this.minVisibleScale=this.maxVisibleScale)},getMaxVisibleScale:function(){return null==this.maxVisibleScale&&(this.maxVisibleScale=1),this.maxVisibleScale},setMaxVisibleScale:function(t){this.maxVisibleScale=t,this.maxVisibleScale>1e-7&&this.maxVisibleScale<t&&(this.maxVisibleScale=this.minVisibleScale)},clearVisibleScale:function(){this.minVisibleScale=0,this.maxVisibleScale=0},getSelected:function(){return this.isSelected},setSelected:function(t){if(this.isSelected!==t){this.isSelected=t;for(var e=0;e<this.features.length;e++)this.features[e].setEnableSelected(t)}},getEditable:function(){return this.isEditable},setEditable:function(t){if(this.isEditable!==t){this.isEditable=t;for(var e=0;e<this.features.length;e++)this.features[e].setEdit(t)}},getLocked:function(){return this.isLocked},setLocked:function(t){if(this.isLocked!==t){this.isLocked=t;for(var e=0;e<this.features.length;e++)this.features[e].setLocked(t)}},getVisibility:function(){return this.visibility},setVisibility:function(t){Ay.prototype.setVisibility.call(this,t)},getSignSymbols:function(){return this.features},setSelectedSignSymbol:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._map.getPlotEditControl().unselectFeatures(),this._map.getPlotEditControl().unselectSignSymbol(),t.getVisible()&&(this._map.getPlotEditControl().selectSignSymbol(t,e),this.selectedFeatures=t)},getJSONData:function(){for(var t={features:[]},e=0;e<this.features.length;e++)t.features.push(this.features[e].getJSONData());return t},fromJSONData:function(t){for(var e=t.features,i=0;i<e.length;i++){var o=e[i],n=new SuperMap.Plot.Sign(o.symbolText),l=L.latLng(o.latLngs.lat,o.latLngs.lng);this.createSignSymbol(l,n,{uuid:o.uuid})}}}),xy=function(t,e,i){return new Ty(t,e,i)};L.supermap.plotting.signSymbolLayer=xy,L.supermap.plotting.SignSymbolLayer=Ty,L.Map.include({getFeatureByUuid:function(t){var e=[];for(var i in this._layers){var o;if(this._layers[i]instanceof Iy)null!=(o=this._layers[i].getFeatureByUuid(t))&&e.push(o);if(this._layers[i]instanceof dy)null!=(o=this._layers[i].getFeatureByUuid(t))&&e.push(o);if(this._layers[i]instanceof gy)null!=(o=this._layers[i].getFeatureByUuid(t))&&e.push(o)}return 0===e.length?null:e[0]},getSignSymbolByUuid:function(t){var e=[];for(var i in this._layers)if(this._layers[i]instanceof Ty){var o=this._layers[i].findSignSymbolByUuid(t);null!=o&&e.push(o)}return 0==e.length?null:e[0]},getPlotDrawControl:function(){return void 0!=this._getPlotDrawControl?this._getPlotDrawControl():null},getPlotEditControl:function(){return void 0!=this._getPlotEditControl?this._getPlotEditControl():null},getScale:function(t){var e=0,i=this._layers;for(var o in i)if(i[o]instanceof L.TileLayer){i[o].getScale&&(e=i[o].getScale(t));break}return e},getPlottingLayers:function(){var t=[],e=this._layers;for(var i in e)e[i]instanceof Iy&&t.push(e[i]);return t},getSignSymbolLayers:function(){var t=[],e=this._layers;for(var i in e)e[i]instanceof Ty&&t.push(e[i]);return t},getMovingTargetLayers:function(){var t=[],e=this._layers;for(var i in e)e[i]instanceof gy&&t.push(e[i]);return t},clearPlottingLayers:function(){var t=this._layers;for(var e in t)t[e]instanceof Iy&&(t[e].removeAllFeatures(),this.removeLayer(t[e]))},getLayer:function(t){var e=this._layers;for(var i in e)if(e[i]._leaflet_id===t)return e[i]},getLayersByName:function(t){return this.getLayersBy("name",t)},getLayersBy:function(t,e){return this.getBy("_layers",t,e)},getBy:function(t,e,i){var o="function"==typeof i.test,n=[];for(var l in this[t])n.push(this[t][l]);return SuperMap.Array.filter(n,function(t){return t[e]===i||o&&i.test(t[e])})},latLngToLayerPoint:function(t){return this.project(L.latLng(t))._subtract(this.getPixelOrigin())},getTiledMapLayer:function(){var t=[],e=this._layers;for(var i in e)"tilePane"==e[i].options.pane&&t.push(e[i]);return t},getBaseTiledMapLayer:function(){var t,e=this._layers;for(var i in e)"tilePane"==e[i].options.pane&&e[i].isBaseLayer&&(t=e[i]);return t}});var Oy=vh.extend({ratio:null,scalePoints:null,scaleValues:null,initialize:function(t,e,i,o){vh.prototype.initialize.call(this,t,e,i,o),this.libID=0,this.code=SuperMap.Plot.SymbolType.FLAGGROUP,this.symbolType=SuperMap.Plot.SymbolType.FLAGGROUP,this.symbolName="多旗",o.subObjects&&(this.subObjects=o.subObjects),null===this.ratio&&(this.ratio=.8),this.scaleByMap=!0,this.minScale=1,this.maxScale=5},destroy:function(){vh.prototype.destroy.call(this),this.ratio=[]},setRotate:function(t){isNaN(t)||(this.dRotate+=t,this.redraw())},redraw:function(){if("none"===this.style.display||null!=this.layer&&"function"==typeof this.layer.getVisibility&&!1===this.layer.getVisibility())this._clearComponents();else{if(L.Util.isArray(this.ratio)||(this.ratio=[this.ratio]),0===this.components.length&&0!==this.subObjects.length)for(var t=0,e=this.subObjects.length;t<e;t++)this.layer&&this.layer.removeFeatures(this.subObjects[t]),this.subObjects[t].enableEdit=!0,this.subObjects[t].ownerGroup=this,this._addComponents(this.subObjects[t]);if(0!==this.components.length){this.scalePoints=[],this.components[0].setRotate(this.dRotate);var i=L.latLng(this.components[0].getLatLngs()[0].lat,this.components[0].getLatLngs()[0].lng),o=this._map.latLngToLayerPoint(i);if(!0===this.components[0].positionOffset){var n=1;"function"==typeof this.layer.getSymZoomScale&&(n=this.layer.getSymZoomScale()),null!=this.minScale&&n<this.minScale&&(n=this.minScale),null!=this.maxScale&&n>this.maxScale&&(n=this.maxScale),o.x+=this.components[0].positionOffsetX*n,o.y+=this.components[0].positionOffsetY*n}i=this._map.layerPointToLatLng(o),this.anchorPoint=i.clone();var l=new L.latLng(i);l.tag=0,this.scalePoints.push(l);for(var s=1,a=this.components.length;s<a;s++){for(;this.ratio.length<s;)this.ratio.push(this.ratio[this.ratio.length-1]);var r=this.ratio[s-1],u=this.components[s-1],p=this._calculateFlagTop(u),h=L.Util.cloneLatLngs(u.getLatLngs())[0],c=this._map.latLngToLayerPoint(h);!0===u.positionOffset&&(c.x+=u.positionOffsetX*n,c.y+=u.positionOffsetY*n),h=this._map.layerPointToLatLng(c),p=this._pointRotate(this.dRotate,h,p);var y=this._findPointOnLineByRatio(r,h,p);this.components[s].dRotate=this.dRotate,this.components[s].setLatLngs([y]);var g=new L.latLng(y);g.tag=s,this.scalePoints.push(g)}}}},_pointRotate:function(t,e,i){t*=Math.PI/180;var o=Math.sqrt(Math.pow(e.lng-i.lng,2)+Math.pow(e.lat-i.lat,2)),n=t+Math.atan2(i.lat-e.lat,i.lng-e.lng);return i.lng=e.lng+o*Math.cos(n),i.lat=e.lat+o*Math.sin(n),i},_findPointOnLineByRatio:function(t,e,i){var o=new L.latLng(0,0);return o.lng=e.lng+(i.lng-e.lng)*t,o.lat=e.lat+(i.lat-e.lat)*t,o},_calculateFlagTop:function(t){var e=t.dRotate;t.dRotate=0,0===t.dRotate&&(t.isNotRedrawText=!0,t.redraw(),delete t.isNotRedrawText);var i=t.getBounds();return t.dRotate=e,t.redraw(),new L.latLng(i.getNorth(),t.latLngs[0].lng)},_projectPoint:function(t,e,i){if(e===i)return e;var o=new L.latLng(0,0),n=i.lng-e.lng,l=e.lat-i.lat,s=n*n,a=l*l,r=n*l,u=n*n+l*l;return o.lng=(r*(e.lat-t.lat)+e.lng*a+t.lng*s)/u,o.lat=(r*(e.lng-t.lng)+e.lat*s+t.lat*a)/u,o},_modifyPoint:function(t,e){var i=1;if("function"==typeof this.layer.getSymZoomScale&&(i=this.layer.getSymZoomScale()),null!=this.minScale&&i<this.minScale&&(i=this.minScale),null!=this.maxScale&&i>this.maxScale&&(i=this.maxScale),0===t)if(!0===this.subObjects[0].positionOffset){var o=this._map.latLngToLayerPoint(e),n=this._map.latLngToLayerPoint(this.subObjects[0].getLatLngs()[0]);this.components[0].positionOffsetX=(o.x-n.x)/i,this.components[0].positionOffsetY=(o.y-n.y)/i}else this.subObjects[0].setLatLngs([e]);else{var l=this.subObjects[t-1].latLngs[0];if(!0===this.subObjects[t-1].positionOffset)(n=this._map.latLngToLayerPoint(l)).x+=this.components[0].positionOffsetX*i,n.y+=this.components[0].positionOffsetY*i,l=this._map.layerPointToLatLng(n);var s=this._calculateFlagTop(this.subObjects[t-1]);s=this._pointRotate(this.dRotate,this.subObjects[0].latLngs[0],s);var a=Math.sqrt(Math.pow(l.lng-s.lng,2)+Math.pow(l.lat-s.lat,2)),r=this._projectPoint(e,l,s),u=Math.sqrt(Math.pow(l.lng-r.lng,2)+Math.pow(l.lat-r.lat,2));this.ratio[t-1]=u/a}this.redraw()},_reView:function(){for(var t=0;t<this.components.length;t++)this.components[t].scaleByMap=this.scaleByMap,this.components[t].minScale=this.minScale,this.components[t].maxScale=this.maxScale,this.components[t]._reView();this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},_parseSymbolData:function(){vh.prototype._parseSymbolData.call(this),this.symbolData&&(this.ratio=this.symbolData.ratio)},_setSymbolData:function(){vh.prototype._setSymbolData.call(this),this.symbolData&&(this.symbolData.ratio=this.ratio)}}),wy=function(t,e,i,o){return new Oy(t,e,i,o)};L.supermap.plotting.flagGroup=wy,L.supermap.plotting.FlagGroup=Oy;var Cy=L.Control.extend({_mouseTolerance:10,_editMarkers:null,_editMode:SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE,feature:null,_temportary:null,options:{avoidRegionStyle:{fill:!1,color:"#0000ff",dashArray:"2, 2",opacity:1,weight:1},draggable:!0,avoidIcon:L.divIcon({className:"leaflet-supermap-plot-avoid-icon-path",iconSize:[8,8]}),icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(t,e){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode()&&(this.options.avoidIcon=L.divIcon({className:"leaflet-supermap-plot-avoid-icon-path",iconSize:[15,15]}),this.options.icon=new L.DivIcon({iconSize:new L.Point(15,15),className:"leaflet-div-icon leaflet-editing-icon"})),L.Control.prototype.initialize.call(this,e),L.setOptions(this,e),this._temportary=new Ay("avoidRegionControl-temportary",t.serverUrl,{serviceParams:t.serviceParams}),this._editMarkers={},this.feature=t},onAdd:function(t){if(this.feature&&!this.feature.getLocked())return this.controlDiv=L.DomUtil.create("div","supermap-iclient-avoidregion"),this._map=t,this._markers=[],this._latlngs=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._map.addLayer(this._temportary),this._map.on("mousemove",this._onMouseMove,this).on("click",this._onMapClick,this),this._showAvoidRegions(),this.controlDiv},onRemove:function(){this._hideAvoidRegions(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,delete this._latlngs,this.plotting&&(this._temportary.removeFeatures(this.plotting),delete this.plotting,this.plotting=null),this._map.removeLayer(this._temportary),delete this._temportary,this._map.off("mousemove",this._onMouseMove,this).off("click",this._onMapClick,this)},_showAvoidRegions:function(){for(var t=0;t<this.feature.avoidRegions.length;t++){var e=this.feature.avoidRegions[t];this._temportary.addFeatures(e),this._selectFeature(e)}},_hideAvoidRegions:function(){for(var t=0;t<this.feature.avoidRegions.length;t++){var e=this.feature.avoidRegions[t];this._unselectFeature(e),this._temportary.removeFeatures(e)}},_selectFeature:function(t){t.symbolType===SuperMap.Plot.SymbolType.AVOIDREGION&&(this._collectEditMarkers(t),t.on("mousemove",this._onMouseMove,this).on("mouseout",this._onMouseOut,this).on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),t.dragging.enable())},_unselectFeature:function(t){t.symbolType===SuperMap.Plot.SymbolType.AVOIDREGION&&(this._removeMarkers(t),t.off("mousemove",this._onMouseMove,this).off("mouseout",this._onMouseOut,this).off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),t.dragging.disable())},_onMouseOut:function(t){t.target.layer._renderer._container.style.cursor=""},_onMapClick:function(t){if(this.moveend)this.moveend=!1;else{var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);this.plotting?this._addVertex(i):(this.plotting=L.supermap.plotting.avoidRegion(0,SuperMap.Plot.SymbolType.AVOIDREGION,[],{style:this.options.avoidRegionStyle}),this._temportary.addFeatures(this.plotting),this._addVertex(i)),L.DomEvent.preventDefault(t.originalEvent)}},_collectEditMarkers:function(t){var e=[];if(t.symbolType===SuperMap.Plot.SymbolType.AVOIDREGION)for(var i=0;i<t.getLatLngs().length;i++){var o=new L.LatLng(t.getLatLngs()[i].lat,t.getLatLngs()[i].lng),n=L.supermap.plotting.editMarker(o,{icon:this.options.avoidIcon,nHandle:-1,tag:i});this._addToMapAndBindMarker(n),e.push(n),n.owner=t}this._editMarkers[t.uuid]=e},_removeMarkers:function(t){for(var e=this._editMarkers[t.uuid],i=0;i<e.length;i++)this._unbindMarkerEvents(e[i]),this._map.removeLayer(e[i]);delete this._editMarkers[t.uuid]},_unbindMarkerEvents:function(t){t.off("mousemove",this._moveMove,this),t.off("mouseout",this._moveOut,this),t.off("click",this._removePoint,this),t.off("drag",this.redraw,this),t.dragging.disable()},_addToMapAndBindMarker:function(t){t.addTo(this._map),t.on("mousemove",this._moveMove,this),t.on("mouseout",this._moveOut,this),t.on("click",this._removePoint,this),t.on("drag",this._dragPoint,this),t.dragging.enable()},_removePoint:function(t){if(this._editMode===SuperMap.Plot.EditMode.ADDCONTROLPOINT&&t.target.owner.isSelected){var e=this._editMarkers[t.target.owner.uuid],i=e.indexOf(t.target);this._map.removeLayer(e[i]),e.splice(i,1),t.target.owner.latLngs.splice(i,1),t.target.owner.redraw()}},_dragPoint:function(t){var e=t.target.owner;if(e.symbolType===SuperMap.Plot.SymbolType.AVOIDREGION){var i=this._editMarkers[e.uuid],o=SuperMap.Util.indexOf(i,t.target);e.getLatLngs()[o]=t.latlng,e._modifyPoint(),this.moveend=!0}},_moveMove:function(t){t.target._icon.style.cursor="pointer"},_moveOut:function(t){t.target._icon.style.cursor=""},_addVertex:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});this._markerGroup.addLayer(e),this._markers.push(e),this._latlngs.push(t),this.plotting.setLatLngs(this._latlngs);var i=this._markers.length;i>1&&this._markers[i-1].on("click",this._finishShape,this),i>2&&this._markers[i-2].off("click",this._finishShape,this)},_finishShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this),L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode()&&this._latlngs.length+1<this.plotting.maxEditPts&&this._latlngs.length!==this.plotting.getLatLngs().length&&this.plotting.setLatLngs(this._latlngs);var t=this.plotting.clone();this._markerGroup.clearLayers(),this._markers=[],this._latlngs=[],this._temportary.removeFeatures(this.plotting),delete this.plotting,this.plotting=null,this._temportary.addFeatures(t),this.feature.addAvoidRegion(t),this._selectFeature(t);var e=new SuperMap.Plot.Transaction;e.transType=SuperMap.Plot.TransactionType.EDIT;var i=new SuperMap.Plot.TransactionInfo;i.layerId=this.feature.layer._leaflet_id,i.uuid=this.feature.uuid,i.functionName="addAvoidRegion",i.undoParams=[t],i.redoParams=[t],e.transInfos.push(i),L.supermap.plotting.getControl().getTransManager().add(e),t.on("contextmenu",function(){})},_onDragStart:function(t){for(var e=t.target,i=this._editMarkers[e.uuid],o=0;o<i.length;o++)i[o].setOpacity(0)},_onDrag:function(t){t.target.move(t.dLat,t.dLng)},_onDragEnd:function(t){var e=t.target;this._collectEditMarkers(e),this.moveend=!0},_onMouseMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);if(this.plotting){var o=L.Util.cloneLatLngs(this._latlngs);0===o.length?o.push(i):o[o.length-1].lat===i.lat&&o[o.length-1].lng===i.lng||o.push(i),this.plotting.setLatLngs(o)}L.DomEvent.preventDefault(t.originalEvent)}}),Ey=(i(580),L.Path.extend({name:"子图层",caption:"子图层",visibility:!0,features:null,parent:null,initialize:function(t,e){e=e||{},L.Util.setOptions(this,e),null!=t&&(this.name=t),null!=e&&e.caption&&(this.caption=e.caption),this.features=[]},getParent:function(){return this.parent},setParent:function(t){this.parent=t},getVisibility:function(){return this.visibility},setVisibility:function(t){if(this.visibility!==t){this.visibility=t;for(var e=0;e<this.features.length;e++)if(this.features[e].redraw(),this._map&&this._map.getPlotEditControl()){if(Object.prototype.hasOwnProperty.call(this._map.getPlotEditControl()._editMarkers,this.features[e].uuid))for(var i=this._map.getPlotEditControl()._editMarkers[this.features[e].uuid],o=0;o<i.length;o++)this.visibility?i[o].setOpacity(1):i[o].setOpacity(0);null!=this.features[e].dragging&&null!=this.features[e].dragging.moveMarker&&(this.visibility?this.features[e].dragging.moveMarker.setOpacity(1):this.features[e].dragging.moveMarker.setOpacity(0))}}},addFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=t.slice(),i=0;i<t.length;i++)!(t[i]instanceof bh)||t[i]instanceof Sy||t[i]instanceof Dh?e.splice(i,1):(t[i].childLayer=this,this.features.push(t[i]));L.supermap.plotting.getControl().getPlotMapManager().fire("featuresadded",{features:e,parent:this,layername:this.name})},removeFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]);var e=t.slice();e.length>0&&L.supermap.plotting.getControl().getPlotMapManager().fire("beforefeaturesremoved",{features:e,parent:this,layername:this.name});for(var i=0,o=t.length;i<o;i++){var n=t[i];if(-1!=SuperMap.Util.indexOf(this.features,n)){var l=SuperMap.Util.indexOf(this.features,n);-1!==l&&this.features.splice(l,1),999===n.symbolType?n.destroy():n.childLayer=null}else e.splice(i,1)}e.length>0&&L.supermap.plotting.getControl().getPlotMapManager().fire("featuresremoved",{features:e,parent:this,layername:this.name})},removeAllFeatures:function(){this.removeFeatures(this.features.slice()),this.features=[]},getFeatures:function(){return this.features.slice()}}));L.supermap.plotting.childPlotLayer=function(t,e){return new Ey(t,e)};var Iy=Ay.extend({caption:"图元层",tolerancePixel:5,isLocked:!1,isEditable:!0,isSelected:!0,childPlotLayers:null,minVisibleScale:0,maxVisibleScale:0,_circleRanges:[],_clusterTextNode:[],_clusterMarkers:[],isCluster:!1,unitSize:{},showClusterRange:!1,showClusterInfo:!1,clusterStyle:{},addChildPlotLayer:function(t){for(var e=!0;e;){e=!1;for(var i=0;i<this.childPlotLayers.length;i++)if(this.childPlotLayers[i].name===t.name){t.name+="#1",e=!0;break}}this.childPlotLayers.push(t),t.setParent(this),L.supermap.plotting.getControl().getPlotMapManager().fire("childplotlayeradded",{childPlotLayer:t,parent:this})},getChildPlotLayers:function(){return this.childPlotLayers},removeChildPlotLayer:function(t){this.removeFeatures(t.features.slice());var e=SuperMap.Util.indexOf(this.childPlotLayers,t);-1!==e&&this.childPlotLayers.splice(e,1),L.supermap.plotting.getControl().getPlotMapManager().fire("childplotlayerremoved",{childPlotLayer:t,parent:this})},getMinVisibleScale:function(){return null==this.minVisibleScale&&(this.minVisibleScale=0),this.minVisibleScale},setMinVisibleScale:function(t){this.minVisibleScale=t,this.maxVisibleScale>1e-7&&this.maxVisibleScale<t&&(this.minVisibleScale=this.maxVisibleScale)},getMaxVisibleScale:function(){return null==this.maxVisibleScale&&(this.maxVisibleScale=1),this.maxVisibleScale},setMaxVisibleScale:function(t){this.maxVisibleScale=t,this.maxVisibleScale>1e-7&&this.maxVisibleScale<t&&(this.maxVisibleScale=this.minVisibleScale)},clearVisibleScale:function(){this.minVisibleScale=0,this.maxVisibleScale=0},getSelected:function(){return this.isSelected},setSelected:function(t){this.isSelected!==t&&(this.isSelected=t,this._map&&this._map.getPlotEditControl()&&(this.isSelected?this._map.getPlotEditControl().enableEditFeatures(this.features):(this._map.getPlotEditControl().unselectFeatures(this.features),this._map.getPlotEditControl().disableEditFeatures(this.features))))},getEditable:function(){return this.isEditable},setEditable:function(t){if(this.isEditable!==t&&(this.isEditable=t,this._map&&this._map.getPlotEditControl())){var e=this._map.getPlotEditControl().getSelectedFeatures();this._map.getPlotEditControl().unselectFeatures(this.features),this._map.getPlotEditControl().selectFeatures(e)}},getLocked:function(){return this.isLocked},setLocked:function(t){if(this.isLocked!==t&&(this.isLocked=t,this._map&&this._map.getPlotEditControl())){var e=this._map.getPlotEditControl().getSelectedFeatures();this._map.getPlotEditControl().unselectFeatures(this.features),this._map.getPlotEditControl().selectFeatures(e)}},getVisibility:function(){return this.visibility},setVisibility:function(t){Ay.prototype.setVisibility.call(this,t)},enableSymScaleDefinition:function(t){Ay.prototype.enableSymScaleDefinition.call(this,t)},getSymScaleDefinition:function(){return Ay.prototype.getSymScaleDefinition.call(this)},setSymScaleDefinition:function(t,e){Ay.prototype.setSymScaleDefinition.call(this,t,e)},initialize:function(t,e,i){this.childPlotLayers=[],this.features=[],this.visibility=!0,Ay.prototype.initialize.call(this,t,e,i),null!=i&&i.caption&&(this.caption=i.caption);var o=L.supermap.plotting.childPlotLayer("子图层",i);this.addChildPlotLayer(o),this.setVisibility(this.visibility),null!=i&&i.enableSymScale&&this.enableSymScaleDefinition(i.enableSymScale),this.setSymScaleDefinition(L.supermap.plotting.getControl().getPlotMapManager().getSymScaleDefinition(),!0),i&&i.clusterStyle||(this.clusterStyle={rangeColor:"#98bacb",fontBackgroundColor:"rgba(100, 149, 237, 0.5)",fontBackgroundBorderColor:"cornflowerblue"}),this.iconClass="leaflet-cluster-textnode"+Math.floor(1e3*Math.random()).toString();this._circleRanges=[],this._clusterTextNode=[]},moveTo:function(t,e){var i=SuperMap.Util.indexOf(this.features,t);if(i!==e){var o=null,n=e;n>=0&&n<this.features.length&&(o=this.features[n]);for(var l=0;l<t.components.length;l++)0===e?this._renderer._bringToBack(t.components[l]):e===this.features.length-1?this._renderer._bringToFront(t.components[l]):null!=o&&this._renderer._afterTo(t.components[l],o.components[0]);this.features.splice(i,1),this.features.splice(e,0,t)}},getFeatureByUuid:function(t){for(var e=0;e<this.features.length;e++){if(this.features[e].uuid===t)return this.features.find(function(e){return e.uuid===t});if(this.features[e]instanceof L.supermap.plotting.GroupObject||this.features[e]instanceof L.supermap.plotting.Route)return this.features[e].components.find(function(e){return e.uuid===t})}return null},addFeatures:function(t,e){if(SuperMap.Util.isArray(t)||(t=[t]),0!==t.length){null==e&&(e=L.supermap.plotting.getControl().getPlotMapManager().getActiveChildPlotLayer());var i=SuperMap.Util.indexOf(this.getChildPlotLayers(),e);-1!==i?this.getChildPlotLayers()[i].addFeatures(t):this.getChildPlotLayers().length>0&&this.getChildPlotLayers()[0].addFeatures(t),this.fire(SuperMap.Plot.Event.beforefeaturesadded,{features:t}),Ay.prototype.addFeatures.call(this,t),this.fire(SuperMap.Plot.Event.featuresadded,{features:t,layername:this.name}),this._map.getPlotEditControl()&&this.isSelected&&this._map.getPlotEditControl().enableEditFeatures(t),this.isCluster&&this.setSymbolCluster(!0)}},removeFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=0;e<this.getChildPlotLayers().length;e++)this.getChildPlotLayers()[e].removeFeatures(t);this.fire(SuperMap.Plot.Event.beforefeaturesremoved,{features:t,layername:this.name}),Ay.prototype.removeFeatures.call(this,t),this.fire(SuperMap.Plot.Event.featuresremoved,{features:t,layername:this.name});for(var i=0;i<t.length;i++)t[i].fire("featureremoved",{feature:t[i]})},removeAllFeatures:function(){for(var t=0;t<this.getChildPlotLayers().length;t++){for(var e=0;e<this.features.length;e++)999==this.features[e].symbolType&&(this.features[e].isCluster=!1);for(var i=0;i<this.features.length;i++)this.features[i].fire("featureremoved",{feature:this.features[i]});this.getChildPlotLayers()[t].removeFeatures(this.features)}this.fire(SuperMap.Plot.Event.beforefeaturesremoved,{features:this.features}),Ay.prototype.removeAllFeatures.call(this),this.fire(SuperMap.Plot.Event.featuresremoved,{features:this.features,layername:this.name}),this._clearCircleRanges(),this._clearTextNode()},createSymbol:function(t,e,i,o,n,l,s,a){var r;if(l||(l={}),l.uuid=o,l.serverUrl=this.serverUrl,l.serviceParams=this.options.serviceParams,void 0!==l.symbolData&&null!==l.symbolData||!SuperMap.Plot.AlgoSymbolFactory.isAccessServer(t,e))if((r=L.supermap.plotting.PlottingObject.createSymbol(t,e,i,l,n,a)).subSymbols&&0!==r.subSymbols.length&&!SuperMap.Plot.AlgoSymbolFactory.isAccessServer(t,e)){for(var u=[],p=0,h=r.subSymbols.length;p<h;p++)null===r.subSymbols[p].symbolData&&(r.subSymbols[p].symbolData=this._getSymbolDataFromCache(r.subSymbols[p].libID,r.subSymbols[p].code),null===r.subSymbols[p].symbolData&&-1===SuperMap.Util.indexOf(u,r.subSymbols[p])&&u.push(r.subSymbols[p]));for(var c=u.slice(),y=0;y<u.length;y++){var g=new SuperMap.GetSymbolInfoParameters({libID:u[y].libID,code:u[y].code});L.supermap.symbolInfoService(this.serverUrl,this.options.serviceParams).getSymbolInfo(g,function(t){this._cacheSymbolData(t.result);for(var e=0,i=r.subSymbols.length;e<i;e++)if(null===r.subSymbols[e].symbolData&&r.subSymbols[e].libID===t.result.libID&&r.subSymbols[e].code===t.result.code){var o=SuperMap.Util.indexOf(c,r.subSymbols[e]);-1!==o&&c.splice(o,1),r.subSymbols[e].symbolData=SuperMap.Plot.PlottingUtil.cloneObject(t.result),0===c.length&&(r.isEdit=!1,this.addFeatures(r),"function"==typeof s&&s({feature:r}))}},this)}if(0===u.length)return this.addFeatures(r),"function"==typeof s&&s({feature:r}),r}else{if(!SuperMap.Plot.AlgoSymbolFactory.isAccessServer(t,e)||r.symbolData.innerCells)return this.addFeatures(r),"function"==typeof s&&s({feature:r}),r;var f=Math.floor(1e3*Math.random()),d=new SuperMap.GetSymbolInfoParameters({libID:r.libID,code:r.code,surroundLineType:r.surroundLineType,scaleValues:r.scaleValues,subSymbols:r.subSymbols});d.inputPoints=L.Util.latLngsToSuperMapPoints(r.getLatLngs()),d.dynamicToken=f,L.supermap.symbolInfoService(this.serverUrl,this.options.serviceParams).getSymbolInfo(d,function(t){t.result.dynamicToken&&t.result.dynamicToken===SuperMap.MD5.md5(f.toString())&&(r.symbolData.innerCells=t.result.innerCells,this.addFeatures(r))},this)}else{var m=null,S=!1;if(Object.prototype.hasOwnProperty.call(l,"symbolRank")||Object.prototype.hasOwnProperty.call(l,"surroundLineType")?S=!0:m=this._getSymbolDataFromCache(t,e),!m||S){var P=new SuperMap.GetSymbolInfoParameters({libID:t,code:e});i&&(P.inputPoints=L.Util.latLngsToSuperMapPoints(i)),Object.prototype.hasOwnProperty.call(l,"negativeImage")&&(P.negativeImage=l.negativeImage),Object.prototype.hasOwnProperty.call(l,"symbolRank")&&(P.symbolRank=l.symbolRank),Object.prototype.hasOwnProperty.call(l,"surroundLineType")&&(P.surroundLineType=l.surroundLineType);var b=Math.floor(1e3*Math.random());P.dynamicToken=b,L.supermap.symbolInfoService(this.serverUrl,this.options.serviceParams).getSymbolInfo(P,function(o){o.result.dynamicToken&&o.result.dynamicToken===SuperMap.MD5.md5(b.toString())&&(S||o.result.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL||(delete o.result.dynamicToken,this._cacheSymbolData(o.result)),l.symbolData=SuperMap.Plot.PlottingUtil.cloneObject(o.result),r=L.supermap.plotting.PlottingObject.createSymbol(t,e,i,l,n,a),this.addFeatures(r),"function"==typeof s&&s({feature:r}))},this)}else l.symbolData=m,r=L.supermap.plotting.PlottingObject.createSymbol(t,e,i,l,n,a),this.addFeatures(r),"function"==typeof s&&s({feature:r})}},createGroupObject:function(t,e){for(var i=[],o=0;o<t.length;o++)t[o]&&t[o]instanceof xh&&i.push(t[o]);if(i.length>1){var n=new vh(0,SuperMap.Plot.SymbolType.GROUPOBJECT,[],{subObjects:i,uuid:e});return this.addFeatures(n),n}return null},unGroupObject:function(t){var e=[];return t.symbolType===SuperMap.Plot.SymbolType.GROUPOBJECT||t.symbolType===SuperMap.Plot.SymbolType.FLAGGROUP?(e=t._unGroupObject(),t.destroy()):e.push(t),e},createSymbolGroup:function(t,e){for(var i=[],o=0;o<t.length;o++)t[o]&&t[o]instanceof xh&&i.push(t[o]);if(i.length>1){var n=new cy(0,SuperMap.Plot.SymbolType.CLUSTEROBJECT,[],{subObjects:i,uuid:e,map:this._map});return this.addFeatures(n),n}return null},unGroupSymbol:function(t){var e=[];return t.symbolType===SuperMap.Plot.SymbolType.CLUSTEROBJECT?(e=t._unGroupObject(),t.destroy()):e.push(t),e},getAllSymbolGroups:function(){for(var t=[],e=0;e<this.features.length;e++)if(999==this.features[e].symbolType){var i=this.features[e];t.push(i)}return t},_clusterByBlockCluster:function(t){var e=this._classifySymbols(this.features),i={};for(var o in e){var n=ry(this._map,e[o],t);i[o]=n}return i},setSymbolCluster:function(t,e){this.isCluster=t,this.unitSize=e;var i=this;if(t)this._doCluster(e);else{for(var o=0;o<this.features.length;o++)this.features[o]._clusterShowStatus=void 0;this._clearCircleRanges(),this._clearTextNode(),this._map.off("zoomend",function(){i.isCluster&&i._doCluster(e)})}for(var n=0;n<this.features.length;n++)this.features[n].redraw()},setUnitSize:function(t){this.unitSize=t,this.isCluster&&this._doCluster(t)},_doCluster:function(t){for(var e in this.symbolClusterObj=this._clusterByBlockCluster(t),this._clearCircleRanges(),this._clearTextNode(),this.symbolClusterObj){for(var i="#",o=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n=0;n<6;n++){i+=o[Math.floor(Math.random()*o.length)]}for(var l in this.symbolClusterObj[e]){var s=this.symbolClusterObj[e][l];for(var a in s){var r=this._getBlockCenter(s[a]),u=[];if(s[a].length>2)u=this._getShowSymbolIndexes(s[a]),this._setSymbolVisible(u,s[a]),24==s[a].length&&s[a];else for(var p=0;p<s[a].length;p++)s[a][p]._clusterShowStatus="display",s[a][p]._oldClusterShowStatus="none";for(var h=-100,c=0;c<u.length;c++){var y=u[c],g=(s[a][y].latLngs[0].lat-r.lat)*(s[a][y].latLngs[0].lat-r.lat),f=(s[a][y].latLngs[0].lng-r.lng)*(s[a][y].latLngs[0].lng-r.lng),d=Math.sqrt(g+f);h<d&&(h=d)}s[a].length>2&&(this._createSymbolRange(r,h,i),this._createTextNote(r,s[a].length),this.showClusterRange&&this._addCircleRanges(),this.showClusterInfo&&this._addTextNode())}}}},_getBlockCenter:function(t){for(var e={lat:0,lng:0},i=0;i<t.length;i++)e.lat=e.lat+t[i].latLngs[0].lat,e.lng=e.lng+t[i].latLngs[0].lng;return t.length?(e.lat=e.lat/t.length,e.lng=e.lng/t.length):(e.lat=0,e.lng=0),L.latLng(e.lat,e.lng)},setClusterRangeVisible:function(t){if(this.showClusterRange=t,t)this._addCircleRanges();else for(var e=0;e<this._circleRanges.length;e++)this._circleRanges[e].remove()},setClusterInfoVisible:function(t){if(this.showClusterInfo=t,t)this._addTextNode();else for(var e=0;e<this._clusterTextNode.length;e++)this._clusterTextNode[e][0].remove(),this._clusterTextNode[e][1].remove()},setClusterStyle:function(t){for(var e in t)switch(e){case"rangeColor":this.clusterStyle.rangeColor=t[e];for(var i=0;i<this._circleRanges.length;i++)this._circleRanges[i].setStyle({color:t[e]});break;case"fontBackgroundColor":this.clusterStyle.fontBackgroundColor=t[e];for(i=0;i<this._clusterTextNode.length;i++)for(var o=0;o<this._clusterTextNode[i].length;o++)this._clusterTextNode[i][o].remove();this._addTextNode();break;case"fontBackgroundBorderColor":this.clusterStyle.fontBackgroundBorderColor=t[e];for(i=0;i<this._clusterTextNode.length;i++)for(o=0;o<this._clusterTextNode[i].length;o++)this._clusterTextNode[i][o].remove();this._addTextNode();for(o=0;o<this._clusterTextNode.length;o++)this._clusterTextNode[o][1].setStyle({color:t[e]})}},_setSymbolVisible:function(t,e){for(var i=0;i<e.length;i++)-1==t.indexOf(i)?(e[i]._clusterShowStatus="none",e[i]._oldClusterShowStatus="display"):(e[i]._clusterShowStatus="display",e[i]._oldClusterShowStatus="none")},_getShowSymbolIndexes:function(t){for(var e=[],i=0;i<t.length;i++)if(-1==e.indexOf(i)){var o={x:null,y:null,width:null,height:null};o.width=t[i].symbolSize?t[i].symbolSize.w:t[i].style.graphicWidth,o.height=t[i].symbolSize?t[i].symbolSize.h:t[i].style.graphicHeight;var n=this._map.latLngToContainerPoint(t[i].getLatLngs()[0]);o.x=n.x-o.width/2,o.y=n.y-o.height;for(var l=0;l<t.length;l++)if(i!=l&&-1==e.indexOf(l)){var s={x:null,y:null,width:null,height:null};s.width=t[l].symbolSize?t[l].symbolSize.w:t[l].style.graphicWidth,s.height=t[l].symbolSize?t[l].symbolSize.h:t[l].style.graphicHeight;var a=this._map.latLngToContainerPoint(t[l].getLatLngs()[0]);s.x=a.x-s.width/2,s.y=a.y-s.height,o.x<s.x+s.width&&o.x+o.width>s.x&&o.y<s.y+s.height&&o.y+o.height>s.y&&e.push(l)}}for(var r=[],u=0;u<t.length;u++)-1==e.indexOf(u)&&r.push(u);return r},_notInViewBounds:function(t){var e=this._map.getBounds(),i=t.getLatLngs()[0].lat,o=t.getLatLngs()[0].lng;return i>e._northEast.lat||i<e._southWest.lat||o<e._southWest.lng||o>e._northEast.lng},_classifySymbols:function(t){for(var e={},i=0;i<t.length;i++)if(t[i].symbolType==SuperMap.Plot.SymbolType.DOTSYMBOL||t[i].symbolType==SuperMap.Plot.SymbolType.PICTURE||t[i].symbolType==SuperMap.Plot.SymbolType.MODELPLOT){if("none"==t[i].style.display||this._notInViewBounds(t[i]))continue;var o=t[i].libID.toString()+t[i].code.toString();e[o]?e[o].push(t[i]):(e[o]=[],e[o].push(t[i]))}return e},_symbolCombine:function(){var t=this._classifySymbols(this.features),e={},i=0;if(this._map.getZoom()<Math.floor(this._map.getMaxZoom()/4)){for(var o in t){for(var n=[],l=0;l<t[o].length;l++)n.push(t[o][l]);var s=[];s.push(n),e[o]=s}return e}for(var a in this._map.getZoom()<Math.floor(this._map.getMaxZoom()/4*2)&&this._map.getZoom()>=Math.floor(this._map.getMaxZoom()/4)?i=Math.floor(this.features.length/6)>1?Math.floor(this.features.length/2):2:this._map.getZoom()>=Math.floor(this._map.getMaxZoom()/4*2)&&this._map.getZoom()>=Math.floor(this._map.getMaxZoom()/4*3)?i=Math.floor(this.features.length/4)>1?Math.floor(this.features.length/2):2:this._map.getZoom()>=Math.floor(this._map.getMaxZoom()/4*3)&&(i=Math.floor(this.features.length/2)>1?Math.floor(this.features.length/2):2),t){for(var r=[],u=0;u<t[a].length;u++)r.push(t[a][u].latLngs[0]);if(t[a].length<=3){n=[];for(var p=[],h=0;h<t[a].length;h++)p.push(t[a][h]);n.push(p),e[a]=n}else{for(var c=ay(r,i),y=(c.kPoints,c.symbolUuidCluster),g=(n=[],0);g<y.length;g++){p=[];for(var f=0;f<y[g].length;f++){var d=y[g][f];p.push(t[a][d])}n.push(p)}e[a]=n}}return e},_getClusterCenter:function(t){for(var e=[],i=0;i<t.length;i++){for(var o={lat:0,lng:0},n=0;n<t[i].length;n++)o.lat=o.lat+t[i][n].latLngs[0].lat,o.lng=o.lng+t[i][n].latLngs[0].lng;t[i].length?(o.lat=o.lat/t[i].length,o.lng=o.lng/t[i].length):(o.lat=0,o.lng=0);var l=[new L.latLng(o.lat,o.lng)];e.push(l)}return e},_createSymbolRange:function(t,e){var i=this.getArc(t,e,0,2*Math.PI),o=L.polygon([i],{color:this.clusterStyle.rangeColor,smoothFactor:0});this._circleRanges.push(o)},_clearCircleRanges:function(){for(var t=0;t<this._circleRanges.length;t++)this._circleRanges[t].remove();this._circleRanges&&this._circleRanges.length&&0!=this._circleRanges.length&&this._circleRanges.splice(0,this._circleRanges.length)},_createTextNote:function(t,e){var i=map.latLngToContainerPoint(t),o=L.point([i.x+20,i.y-20]),n=this._map.containerPointToLatLng(o),l=L.divIcon({html:"标号个数"+e,className:this.iconClass,iconSize:[80,40]}),s=L.marker([n.lat,n.lng],{icon:l}),a=[t,n],r=L.polyline(a,{color:this.clusterStyle.fontBackgroundBorderColor});this._clusterTextNode.push([s,r])},_clearTextNode:function(){for(var t=0;t<this._clusterTextNode.length;t++)for(var e=0;e<this._clusterTextNode[t].length;e++)this._clusterTextNode[t][e].remove();this._clusterTextNode&&this._clusterTextNode.splice(0,this._clusterTextNode.length)},_createClusterSymbol:function(t,e){if(e){for(var i=L.supermap.plotting.getControl().symbolLibManager.findSymbolByCode(e.code),o=null,n=0;n<i.length;n++)i[n].libID==e.libID&&(o=i[n].icon);var l=e.symbolSize?e.symbolSize.w:e.style.graphicWidth,s=e.symbolSize?e.symbolSize.w:e.style.graphicHeight;o||(o=e.path);var a=L.icon({iconUrl:o,iconSize:[l,s]}),r=L.marker([t.lat,t.lng],{icon:a}).addTo(this._map);this._clusterMarkers.push(r)}},_addCircleRanges:function(){for(var t=0;t<this._circleRanges.length;t++)this._circleRanges[t].addTo(this._map)},_addTextNode:function(){for(var t=0;t<this._clusterTextNode.length;t++)for(var e=0;e<this._clusterTextNode[t].length;e++)this._clusterTextNode[t][e].addTo(this._map);for(var i=document.querySelectorAll("."+this.iconClass),o=0;o<i.length;o++)i[o].style.backgroundColor=this.clusterStyle.fontBackgroundColor,i[o].style.fontSize="small",i[o].style.border="1px solid "+this.clusterStyle.fontBackgroundBorderColor,i[o].style.width="80px",i[o].style.height="20px",i[o].style.textAlign="center",i[o].style.fontWeight="bold"},_clearClusterSymbol:function(){for(var t=0;t<this._clusterMarkers.length;t++)this._clusterMarkers[t].remove();this._clusterMarkers&&this._clusterMarkers.splice(0,this._clusterMarkers.length)},getArc:function(t,e,i,o){var n,l,s=[],a=o-i;a=a<0?a+2*Math.PI:a;for(var r=0;r<=300;r++){var u=i+a*r/300;n=t.lng+e*Math.cos(u),l=t.lat+e*Math.sin(u),s.push([l,n])}return s},createLineRelation:function(t,e,i,o,n,l,s){l||(l={}),l.startAssociatedUuid=t,l.endAssociatedUuid=e,l.lineRelationType=i,l.uuid=o,l.custom=s;var a=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.LINERELATION,null,l,n,s);return this.addFeatures(a),a},createInterferenceBeam:function(t,e,i,o,n,l){n||(n={}),n.associatedUuid=t,n.uuid=i,n.custom=l;var s=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.INTERFERENCEBEAM,e,n,o,l);return this.addFeatures(s),s},createSatellite:function(t,e,i,o,n,l,s,a,r){var u=this._getSymbolDataFromCache(t,e);if(null===u){var p=new SuperMap.GetSymbolInfoParameters({libID:t,code:e});L.supermap.symbolInfoService(this.serverUrl,this.options.serviceParams).getSymbolInfo(p,function(u){this._cacheSymbolData(u.result),s||(s={}),s.serverUrl=this.serverUrl,s.serviceParams=this.options.serviceParams,s.orbitPoints=i,s.textContent=o,s.uuid=n,s.custom=r,s.subSymbols=[{libID:t,code:e,symbolData:SuperMap.Plot.PlottingUtil.cloneObject(u.result),textContent:o}];var p=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.SATELLITE,[],s,l,r);this.addFeatures(p),"function"==typeof a&&a({feature:p})},this)}else{s||(s={}),s.serverUrl=this.serverUrl,s.serviceParams=this.options.serviceParams,s.orbitPoints=i,s.textContent=o,s.uuid=n,s.custom=r,s.subSymbols=[{libID:t,code:e,symbolData:u,textContent:o}];var h=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.SATELLITE,[],s,l,r);this.addFeatures(h),"function"==typeof a&&a({feature:h})}},createSatelliteTimeWindows:function(t,e,i,o,n,l){n||(n={}),n.associatedUuid=t,n.timeWindows=e,n.custom=l,n.uuid=i;var s=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS,[],n,o,l);return this.addFeatures(s),s},createSatelliteTimeWindows1:function(t,e,i,o,n,l){n||(n={}),n.associatedUuid=t;for(var s=0;s<e.length;s++)e[s].type="number";n.timeWindows=e,n.custom=l,n.uuid=i;var a=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS,[],n,o,l);return this.addFeatures(a),a},createSatelliteTimeWindows2:function(t,e,i,o,n,l){n||(n={}),n.associatedUuid=t;for(var s=0;s<e.length;s++)e[s].type="Time";n.timeWindows=e,n.custom=l,n.uuid=i;var a=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS,[],n,o,l);return this.addFeatures(a),a},createSymbolText:function(t,e,i,o,n,l){n||(n={}),n.associatedUuid=t,n.symbolTexts=e,n.custom=l,n.uuid=i;var s=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.SYMBOLTEXT,[],n,o,l);return this.addFeatures(s),s},createSymbolText1:function(t,e,i,o,n,l){n||(n={}),n.associatedUuid=t,n.textContent=e,n.custom=l,n.uuid=i;var s=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.SYMBOLTEXT1,[],n,o,l);return this.addFeatures(s),s},createNavyDeployment:function(t,e,i,o,n,l,s){if(n||(n={}),n.associatedUuid=t,n.custom=s,n.serverUrl=this.serverUrl,n.serviceParams=this.options.serviceParams,e&&0!==e.length){for(var a=[],r=0,u=e.length;r<u;r++)null===e[r].symbolData&&(e[r].symbolData=this._getSymbolDataFromCache(e[r].libID,e[r].code),null===e[r].symbolData&&-1===SuperMap.Util.indexOf(a,e[r])&&a.push(e[r]));if(0!==a.length)for(var p=a.slice(),h=0;h<a.length;h++){var c=new SuperMap.GetSymbolInfoParameters({libID:a[h].libID,code:a[h].code});L.supermap.symbolInfoService(this.serverUrl,this.options.serviceParams).getSymbolInfo(c,function(t){this._cacheSymbolData(t.result);for(var i=0,a=e.length;i<a;i++)if(null===e[i].symbolData&&e[i].libID===t.result.libID&&e[i].code===t.result.code){var r=SuperMap.Util.indexOf(p,e[i]);-1!==r&&p.splice(r,1),e[i].symbolData=SuperMap.Plot.PlottingUtil.cloneObject(t.result)}if(0===p.length){n.subSymbols=e;var u=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.NAVYDEPLOYMENT,[],n,o,s);this.addFeatures(u),"function"==typeof l&&l({feature:u})}},this)}else{n.subSymbols=e;var y=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.NAVYDEPLOYMENT,[],n,o,s);this.addFeatures(y),"function"==typeof l&&l({feature:y})}}},createAirDeployment:function(t,e,i,o,n,l,s){if(n||(n={}),n.associatedUuid=t,n.custom=s,n.serverUrl=this.serverUrl,n.serviceParams=this.options.serviceParams,e&&0!==e.length){for(var a=[],r=0,u=e.length;r<u;r++)null===e[r].symbolData&&(e[r].symbolData=this._getSymbolDataFromCache(e[r].libID,e[r].code),null===e[r].symbolData&&-1===SuperMap.Util.indexOf(a,e[r])&&a.push(e[r]));if(0!==a.length)for(var p=a.slice(),h=0;h<a.length;h++){var c=new SuperMap.GetSymbolInfoParameters({libID:a[h].libID,code:a[h].code});L.supermap.symbolInfoService(this.serverUrl,this.options.serviceParams).getSymbolInfo(c,function(t){this._cacheSymbolData(t.result);for(var i=0,a=e.length;i<a;i++)if(null===e[i].symbolData&&e[i].libID===t.result.libID&&e[i].code===t.result.code){var r=SuperMap.Util.indexOf(p,e[i]);-1!==r&&p.splice(r,1),e[i].symbolData=SuperMap.Plot.PlottingUtil.cloneObject(t.result)}if(0===p.length){n.subSymbols=e;var u=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.AIRDEPLOYMENT,[],n,o,s);this.addFeatures(u),"function"==typeof l&&l({feature:u})}},this)}else{n.subSymbols=e;var y=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.AIRDEPLOYMENT,[],n,o,s);this.addFeatures(y),"function"==typeof l&&l({feature:y})}}},createNavyRoute:function(t,e,i,o,n,l){n||(n={}),n.routeNodes=e,n.uuid=i,n.custom=l,n.arrRoutePts=t;var s=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.NAVYROUTE,[],n,o,l);return this.addFeatures(s),s},createMissileRoute:function(t,e,i,o,n,l){n||(n={}),n.routeNodes=e,n.uuid=i,n.custom=l,n.arrRoutePts=t;var s=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.MISSILEROUTE,[],n,o,l);return this.addFeatures(s),s},createAirRoute:function(t,e,i,o,n,l){n||(n={}),n.routeNodes=e,n.uuid=i,n.custom=l,n.arrRoutePts=t;var s=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.AIRROUTE,[],n,o,l);return this.addFeatures(s),s},createFlags:function(t,e,i){for(var o=[],n=0;n<t.length;n++)(100===t[n].libID&&(t[n].code>=2800&&t[n].code<=2900||t[n].code.toString().startsWith("10201"))||123===t[n].libID&&(t[n].code.toString().startsWith("10201")||t[n].code.toString().startsWith("10202")||t[n].code.toString().startsWith("10205")))&&o.push(t[n]);var l=null;return o.length>1&&(l=new Oy(0,SuperMap.Plot.SymbolType.FLAGGROUP,[],{subObjects:o,ratio:e,uuid:i}),this.addFeatures(l)),l},createArcRegion:function(t,e,i,o,n,l,s,a,r,u,p){r||(r={}),r.centerPoint=t,r.radius=e,r.startAngle=i,r.endAngle=o,r.textContent=n,r.textPosition=l,r.uuid=s,r.custom=p;var h=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.ARCREGION,[],r,a,p);return this.addFeatures(h),h},geoJsonToFeature:function(t,e){this.geoJsonToFeature1(t,null,e)},geoJsonToFeature1:function(t,e,i){var o=JSON.parse(t),n=parseInt(o.libID),l=parseInt(o.code);if(o.isEdit=!0,!this._map.getFeatureByUuid(o.id))if(SuperMap.Plot.AlgoSymbolFactory.isAccessServer(n,l)){var s={};s.symbolRank=parseInt(o.symbolRank),s.surroundLineType=parseInt(o.surroundLineType);var a=!1;0===s.surroundLineType&&0===s.symbolRank||(a=!0);var r=this._getSymbolDataFromCache(n,l);if(a||null===r){var u=new SuperMap.GetSymbolInfoParameters({libID:n,code:l,symbolRank:s.symbolRank,surroundLineType:s.surroundLineType,inputPoints:o.localePoints,subSymbols:3002403!=l?o.subSymbols:[]}),p=this._map;L.supermap.symbolInfoService(this.serverUrl,this.options.serviceParams).getSymbolInfo(u,function(t){if(t.result&&t.result.libID&&t.result.code){t.result.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL||a||this._cacheSymbolData(t.result),r=SuperMap.Util.cloneObject(t.result),SuperMap.Plot.AnalysisSymbol.mergeSymbolDataAndServerData(o,r);var s={symbolData:o,serverUrl:this.serverUrl,serviceParams:this.options.serviceParams,isGeoJSONData:!0},u=L.supermap.plotting.PlottingObject.createSymbol(n,l,null,s);if(this.addFeatures(u,e),null!=o.lineRelations)for(var h=0;h<o.lineRelations.length;h++){var c=p.getFeatureByUuid(o.lineRelations[h]);null!=c&&(c.startAssociatedUuid===o.uuid?c.setStartFeature(o.uuid):c.endAssociatedUuid===o.uuid&&c.setEndFeature(o.uuid))}"function"==typeof i&&i({feature:u})}},this)}else{SuperMap.Plot.AnalysisSymbol.mergeSymbolDataAndServerData(o,r);var h={symbolData:o,serverUrl:this.serverUrl,isGeoJSONData:!0},c=L.supermap.plotting.PlottingObject.createSymbol(n,l,null,h);this.addFeatures(c,e),"function"==typeof i&&i({feature:c})}}else if(o.subSymbols&&0!==o.subSymbols.length){for(var y=[],g=0,f=o.subSymbols.length;g<f;g++)if(!o.subSymbols[g].symbolData){var d=L.supermap.plotting.getControl(this._map,this.serverUrl,{serviceParams:this.options.serviceParams}).getSymbolLibManager().getSymbolLibByLibId(o.subSymbols[g].libID);if(d)d.querySymbolbyKey(l.toString()).length>0&&(o.subSymbols[g].symbolData=this._getSymbolDataFromCache(o.subSymbols[g].libID,o.subSymbols[g].code),null===o.subSymbols[g].symbolData&&this.isIndexOf(y,o.subSymbols[g])&&y.push(o.subSymbols[g]))}for(var m=y.slice(),S=0;S<y.length;S++){var P=new SuperMap.GetSymbolInfoParameters({libID:y[S].libID,code:y[S].code});L.supermap.symbolInfoService(this.serverUrl,this.options.serviceParams).getSymbolInfo(P,function(t){this._cacheSymbolData(t.result);for(var s=0,a=o.subSymbols.length;s<a;s++)if(null===o.subSymbols[s].symbolData&&o.subSymbols[s].libID===t.result.libID&&o.subSymbols[s].code===t.result.code){var r=SuperMap.Util.indexOf(m,o.subSymbols[s]);-1!==r&&m.splice(r,1),o.subSymbols[s].symbolData=SuperMap.Plot.PlottingUtil.cloneObject(t.result)}if(0===m.length){var u={symbolData:o,serverUrl:this.serverUrl,serviceParams:this.options.serviceParams,symbolType:o.symbolType,isGeoJSONData:!0},p=L.supermap.plotting.PlottingObject.createSymbol(n,l,null,u);this.addFeatures(p,e),"function"==typeof i&&i({feature:p})}},this)}if(0===y.length){var b={symbolData:o,serverUrl:this.serverUrl,serviceParams:this.options.serviceParams,symbolType:o.symbolType,isGeoJSONData:!0},v=L.supermap.plotting.PlottingObject.createSymbol(n,l,null,b);this.addFeatures(v,e),"function"==typeof i&&i({feature:v})}}else if(o.geometries&&0!==o.geometries.length){var M=[];for(g=0;g<o.geometries.length;g++){var _=parseInt(o.geometries[g].libID),A=parseInt(o.geometries[g].code);if(SuperMap.Plot.AlgoSymbolFactory.isAccessServer(_,A)&&!Object.prototype.hasOwnProperty.call(o.geometries[g],"innerCells")){for(var T=!0,x=0;x<M.length;x++)if(M[x].libID===_&&M[x].code===A){T=!1;break}T&&M.push(o.geometries[g])}else o.geometries[g].subSymbols&&o.geometries[g].subSymbols.length}var O=M.slice();for(S=0;S<M.length;S++){if(null!=(r=this._getSymbolDataFromCache(M[S].libID,M[S].code))){var w=0;for(f=o.geometries.length;w<f;w++)if(o.geometries[w].libID===r.libID&&o.geometries[w].code===r.code){var C=SuperMap.Util.indexOf(O,o.geometries[w]);-1!==C&&O.splice(C,1),SuperMap.Plot.AnalysisSymbol.mergeSymbolDataAndServerData(o.geometries[w],r)}}else{var E=new SuperMap.GetSymbolInfoParameters({libID:M[S].libID,code:M[S].code});L.supermap.symbolInfoService(this.serverUrl,this.options.serviceParams).getSymbolInfo(E,function(t){this._cacheSymbolData(t.result);for(var s=0,a=o.geometries.length;s<a;s++)if(o.geometries[s].libID===t.result.libID&&o.geometries[s].code===t.result.code){var r=SuperMap.Util.indexOf(O,o.geometries[s]);-1!==r&&O.splice(r,1);var u=SuperMap.Util.cloneObject(t.result);SuperMap.Plot.AnalysisSymbol.mergeSymbolDataAndServerData(o.geometries[s],u)}if(0===O.length){var p={symbolData:o,serverUrl:this.serverUrl,serviceParams:this.options.serviceParams,symbolType:o.symbolType,isGeoJSONData:!0},h=L.supermap.plotting.PlottingObject.createSymbol(n,l,null,p);this.addFeatures(h,e),"function"==typeof i&&i({feature:h})}},this)}}if(0===O.length){var I={symbolData:o,serverUrl:this.serverUrl,serviceParams:this.options.serviceParams,symbolType:o.symbolType,isGeoJSONData:!0,map:this._map,symbolBounds:o.symbolBounds},D=L.supermap.plotting.PlottingObject.createSymbol(n,l,null,I);this.addFeatures(D,e),"function"==typeof i&&i({feature:D})}}else{var U={symbolData:o,serverUrl:this.serverUrl,serviceParams:this.options.serviceParams,symbolType:o.symbolType,isGeoJSONData:!0},R=L.supermap.plotting.PlottingObject.createSymbol(n,l,null,U);this.addFeatures(R,e),"function"==typeof i&&i({feature:R})}},isIndexOf:function(t,e){if(t.length>=1){for(var i=0;i<t.length;i++)if(t[i].libID==e.libID&&t[i].code==e.code)return!1;return!0}return!0},_getFeatureFromEvent:function(t){var e=null;if(!this._map)return e;if(this.isSelected)for(var i=this._map.layerPointToLatLng(L.point(0,0)),o=this._map.layerPointToLatLng(L.point(this._clickTolerance(),0)),n=new SuperMap.Geometry.Point(i.lng,i.lat),l=new SuperMap.Geometry.Point(o.lng,o.lat),s=SuperMap.Plot.PlottingUtil.distance(n,l),a=this.features.length-1;a>=0&&null===(e=this._selectFeature(this.features[a],t.latlng,s));a--);return e},_isAvoidRegion:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if(0!==e.length){var o=null;if(0===e[0].avoidRegions.length)return e[0];if(o=new Cy(e[0]),this._map.addControl(o),!0){for(var n=0,l=e[0].avoidRegions.length;n<l;n++)this.removeFeatures(e[0].avoidRegions[n]);return this._map.removeControl(o),!1,e[0]}}},_selectFeature:function(t,e,i){if(null==t)return null;if(void 0!==t.style&&null!==t.style&&"none"===t.style.display)return null;if(!(t instanceof bh))return null;if(t instanceof vh){for(var o=0;o<t.components.length;o++)if(this._selectFeature(t.components[o],e,i))return t.isSelected?t.components[o]:t}else if(t instanceof _y){for(var n=0;n<t.components.length;n++)if(this._selectFeature(t.components[n],e,i))return t.components[n]===SuperMap.Plot.SymbolType.ROUTENODE||t.components[n]===SuperMap.Plot.SymbolType.LITERATESIGN?t.components[n]:t}else if(t.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT){for(var l=0;l<t.components.length;l++)if(this._selectFeature(e,i,t.components[l]))return t}else if(t.symbolType===SuperMap.Plot.SymbolType.ROUTENODE||t.symbolType===SuperMap.Plot.SymbolType.LITERATESIGN){var s=t.getBounds();if(s&&s.isValid()&&e.lng>=s.getWest()&&e.lng<=s.getEast()&&e.lat>=s.getSouth()&&e.lat<=s.getNorth())return t}else for(var a=this._map.latLngToLayerPoint(e),r=0,u=t.components.length;r<u;r++)if(t.components[r]._containsPoint&&t.components[r]._containsPoint(a))return t;return null}}),Dy=function(t,e,i){return new Iy(t,e,i)};L.supermap.plotting.plottingLayer=Dy,L.supermap.plotting.PlottingLayer=Iy;var Uy=Ay.extend({layer:null,initialize:function(t,e,i){Ay.prototype.initialize.call(this,t,e,i),this.symScaleDefinition=1,i&&i.layer&&(this.layer=i.layer)},addFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]),0!==t.length&&(Ay.prototype.addFeatures.call(this,t),this._map.getPlotEditControl()&&this.isSelected&&this._map.getPlotEditControl().enableEditFeatures(t))},removeFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=0,i=t.length;e<i;e++){var o=t[e];if(-1!=SuperMap.Util.indexOf(this.features,o)){this._map&&this._map.getPlotEditControl()&&(this._map.getPlotEditControl().unselectFeatures(o),this._map.getPlotEditControl().disableEditFeatures(o)),o._clearComponents();var n=SuperMap.Util.indexOf(this.features,o);-1!==n&&this.features.splice(n,1),o.layer=null}}this._update()}}),Ry=xh.extend({symbolSizeInLib:null,dRotate:0,initialScale:null,symbolSize:null,positionOffset:!1,positionOffsetType:null,positionOffsetX:null,positionOffsetY:null,symbolRank:null,negativeImage:null,horizontalMirror:null,verticalMirror:null,middleMarkBounds:null,flagTextSize:60,space:7,deployments:null,joinLines:null,trajectory:null,detectionRange:null,limitWidthHeight:!0,symbolTexts:null,symbolTextComponents:null,specialEffects:null,specialEffectComponents:null,bloodVolumes:null,bloodVolumeComponents:null,pictureFrames:null,pictureFrameComponents:null,antoRotation:null,initialize:function(t,e,i,o){if(this.autoRotation=!1,this.symbolType=SuperMap.Plot.SymbolType.DOTSYMBOL,this.minEditPts=1,this.maxEditPts=1,this.joinLines=[],this.deployments=[],this.symbolTexts=[],this.bloodVolumes=[],this.pictureFrames=[],this.specialEffects=[],this.symbolTextComponents=[],this.bloodVolumeComponents=[],this.pictureFrameComponents=[],this.specialEffectComponents=[],this.minScale=1,this.maxScale=5,this.symbolSizeInLib=new SuperMap.Size(0,0),this.symbolSizeInLib=new SuperMap.Size(0,0),this.symbolSize=new SuperMap.Size(0,0),this._signUtils=[],this._symbolTextInit=!1,null===this.initialScale&&(this.initialScale={}),xh.prototype.initialize.call(this,t,e,i,o),null===this.positionOffsetType&&(this.positionOffsetType=SuperMap.Plot.PositionOffsetType.LINE),null===this.positionOffsetX&&(this.positionOffsetX=0),null===this.positionOffsetY&&(this.positionOffsetY=0),void 0===this.actualScale&&(this.actualScale=this.dScale),null!=this.maxScale&&this.dScale>this.maxScale?this.dScale=this.maxScale:null!=this.minScale&&this.dScale<this.minScale&&(this.dScale=this.minScale),(this.symbolSize==={}||0===this.symbolSize.w&&0===this.symbolSize.h)&&(this.symbolSize.w=this.symbolSizeInLib.w,this.symbolSize.h=this.symbolSizeInLib.h),!this.initialScale.x){var n=this.symbolSizeInLib.w,l=this.symbolSize.w;this.symbolSizeInLib.w<this.symbolSizeInLib.h&&(n=this.symbolSizeInLib.h,l=this.symbolSize.h),this.initialScale.x=l/n,isNaN(this.initialScale.x)||this.initialScale.x===1/0||(!0===this.limitWidthHeight?(this.symbolSize.w=this.initialScale.x*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale.x*this.symbolSizeInLib.h):(this.symbolSize.w=this.initialScale.x*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale.y*this.symbolSizeInLib.h),void 0===this.fontSize&&(void 0===this.style.fontSize&&(this.style.fontSize=12),this.fontSize=this.style.fontSize/this.initialScale.x))}this.on("addSpecialEffect2Symbol",this._addSpecialEffect),this.on("removeSpecialEffectFromGeo",this._removeSpecialEffect),this.on("updateSpecialEffect",this._updateSpecialEffect)},destroy:function(){if(this.symbolRank=null,this.negativeImage=null,this.horizontalMirror=null,this.verticalMirror=null,this.annotationIndex=-1,this.textPosition=null,this.symbolSizeInLib=null,this.symbolSize=null,this.middleMarkBounds=null,this.positionOffsetX=null,this.positionOffsetY=null,this.trajectory=null,this.detectionRange=null,null!==this.joinLines&&void 0!==this.joinLines)for(var t=0;t<this.joinLines.length;t++)null!==this.joinLines[t]&&(this.joinLines[t].startAssociatedUuid===this.uuid&&(this.joinLines[t].removeJoinLineFromDotSymbol(),this.joinLines[t].startAssociatedUuid=null),this.joinLines[t].endAssociatedUuid===this.uuid&&(this.joinLines[t].removeJoinLineFromDotSymbol(),this.joinLines[t].endAssociatedUuid=null));this.joinLines=null,this.deployments=null,xh.prototype.destroy.call(this)},_reView:function(){if(!1!==this.layer.enableSymScale){if(this.fromZoom!==this._map.getZoom()||this._clusterShowStatus){if(this.scaleByMap&&!1!==this.scaleByMap){var t=1;if("function"==typeof this.layer.getSymZoomScale&&(t=this.layer.getSymZoomScale()),null!=this.maxScale&&t>this.maxScale&&(t=this.maxScale),null!=this.minScale&&t<this.minScale&&(t=this.minScale),0!==this.textContent.length&&8===this.annotationPosition){var e;!0===this.limitWidthHeight?e=this.middleMarkBounds.scale(t*this.initialScale.x,this.anchorPoint):this._widthHeightLimitScale();var i=96*e.getWidth()/25.4/10,o=96*e.getHeight()/25.4/10;this.components[this._annotationId].options.graphicWidth=i,this.components[this._annotationId].options.graphicHeight=o}for(var n=0;n<this.components.length;n++){if(n===this._annotationId&&this.components[n]instanceof dh)this.components[n].options.fontSize=this.style.fontSize*t;else if(n!==this._annotationId&&this.components[n]instanceof dh)this.components[n].options.fontSize=this.components[n].options.fontSize/this.prevScale*t;else if(n!==this._annotationId&&!0!==this.components[n].isLeadLine&&(this.components[n].options.weight=this.components[n].options.weight/this.prevScale*t,null!=this.components[n].options.dashArray)){for(var l=this.components[n].options.dashArray.split(","),s=0;s<l.length;s++)l[s]=parseInt(l[s])/this.prevScale*t;this.components[n].options.dashArray=l.join(),this.components[n].setStyle(this.components[n].options)}this.components[n]._project&&this.components[n]._project()}for(var a=0;a<this.geoSymbolTexts.length;a++){var r=this.geoSymbolTexts[a];null!==r&&r._calculateParts()}if("function"==typeof this.layer.getSymZoomScale&&(t!==this.layer.getSymZoomScale()||this.prevScale!==this.layer.getSymZoomScale(this.fromZoom))){var u=this.prevScale*this._map.getZoomScale(this._map.getZoom(),this.fromZoom);this._resizeCells(t*(1/u),this.getLatLngs()[0])}this._renderer instanceof L.Canvas&&"function"==typeof this.layer.getSymZoomScale&&t!==this.layer.getSymZoomScale()&&!0===this.positionOffset&&(this._clearComponents(),this._calculateParts()),this.prevScale=t,this._calculateLabel(),this._calculateBloodVolume(),this._calculatePictureFrame()}else{for(var p=0;p<this.geoSymbolTexts.length;p++)this.geoSymbolTexts[p].fromZoom=this._map.getZoom();var h=this._map.getZoomScale(this.fromZoom,this._map.getZoom()),c=this.getLatLngs()[0];this._resizeCells(h,c)}this.fromZoom=this._map.getZoom(),this.layer._map.getRenderer(this.layer)instanceof L.Canvas&&this._updateCanvasFills(),this._updateSymbolTexts();var y="";null!==this._map&&this._map instanceof L.Map&&(y=this._map.options.crs.code,L.Util.isMercatorProjection(y)&&this.redraw()),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues),this.isSelected&&this._map.getPlotEditControl()&&this._map.getPlotEditControl().fire(SuperMap.Plot.Event.featuresmodified,{features:[this]})}}else this._reView_disableSymScale()},_reView_disableSymScale:function(){if(void 0!==this.prevStrokeWidth&&this.prevStrokeWidth!==this.style.weight&&(this.strokeWidth=this.style.weight,this.prevStrokeWidth=this.style.weight),void 0!==this.prevFontSize&&this.prevFontSize!==this.style.fontSize&&(this.fontSize=this.style.fontSize/this.dScale/this.initialScale.x,this.prevFontSize=this.style.fontSize),void 0!==this.prevPositionOffsetX&&this.prevPositionOffsetX!==this.positionOffsetX&&(this.prevPositionOffsetX=this.positionOffsetX/this.dScale),void 0!==this.prevPositionOffsetY&&this.prevPositionOffsetY!==this.positionOffsetY&&(this.prevPositionOffsetY=this.positionOffsetY/this.dScale),void 0!==this.prevSpace&&this.prevSpace*this.dScale!==this.space&&(this.prevSpace=this.space/this.dScale),this.fromZoom!==this._map.getZoom()){if(!1===this.isEdit)return void(this.fromZoom=this._map.getZoom());if(this.scaleByMap&&!1!==this.scaleByMap)if(void 0===this.actualScale&&(this.actualScale=this.dScale),void 0===this.prevScale&&(this.prevScale=this.dScale),this.actualScale*=this._map.getZoomScale(this._map.getZoom(),this.fromZoom),null!=this.maxScale&&this.actualScale>this.maxScale?this.dScale=this.maxScale:null!=this.minScale&&this.actualScale<this.minScale?this.dScale=this.minScale:this.dScale=this.actualScale,this.dScale!==this.prevScale){var t=this.initialScale.x*this.dScale;!0===this.limitWidthHeight?(this.symbolSize.w=t*this.symbolSizeInLib.w,this.symbolSize.h=t*this.symbolSizeInLib.h):this.prevScale?(this.symbolSize.w=this.initialScale.x*this.dScale*this.symbolSizeInLib.w/this.prevScale,this.symbolSize.h=this.initialScale.y*this.dScale*this.symbolSizeInLib.h/this.prevScale):(this.symbolSize.w=this.initialScale.x*this.dScale*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale.y*this.dScale*this.symbolSizeInLib.h),void 0===this.prevSpace&&(this.prevSpace=this.space),this.prevScale?this.space=this.space*this.dScale/this.prevScale:this.space=this.space*this.dScale,void 0===this.strokeWidth&&(this.strokeWidth=this.style.weight);var e=this.strokeWidth/.5*5;if(this.symbolSize.w<e&&this.symbolSize.h<e){this.scaleStrokeWidth=!0;var i=this.symbolSize.w>this.symbolSize.h?this.symbolSize.w:this.symbolSize.h;this.style.weight=Math.round(i/10),this.style.weight>=this.weight&&(this.style.weight=this.weight),this.style.weight<=.5&&(this.style.weight=.5)}else!0===this.scaleStrokeWidth&&(this.scaleStrokeWidth=!1),this.style.weight=this.strokeWidth;if(this.prevStrokeWidth=this.style.weight,this.style.fontSize=this.style.fontSize*this._map.getZoomScale(this._map.getZoom(),this.fromZoom),this.prevFontSize=this.style.fontSize,!0!==this.positionOffset||0===this.positionOffsetX&&0===this.positionOffsetY||(this.prevScale?this.positionOffsetX=this.positionOffsetX*this.dScale/this.prevScale:this.positionOffsetX=this.positionOffsetX*this.dScale,this.prevScale?this.positionOffsetY=this.positionOffsetY*this.dScale/this.prevScale:this.positionOffsetY=this.positionOffsetY*this.dScale,this.prevPositionOffsetX=this.positionOffsetX,this.prevPositionOffsetY=this.positionOffsetY),0!==this.textContent.length&&8===this.annotationPosition){var o;!0===this.limitWidthHeight?o=this.middleMarkBounds.scale(this.dScale*this.initialScale.x,this.anchorPoint):this._widthHeightLimitScale();var n=96*o.getWidth()/25.4/10,l=96*o.getHeight()/25.4/10;this.style.graphicWidth=n,this.style.graphicHeight=l,this.components[this._annotationId].options.graphicWidth=n,this.components[this._annotationId].options.graphicHeight=l,this.components[this._annotationId].style||(this.components[this._annotationId].style={}),this.components[this._annotationId].style.graphicWidth=this.style.graphicWidth,this.components[this._annotationId].style.graphicHeight=this.style.graphicHeight}for(var s=0;s<this.components.length;s++)s===this._annotationId&&this.components[s]instanceof dh?this.components[s].options.fontSize=this.style.fontSize:s!==this._annotationId&&this.components[s]instanceof dh?this.components[s].options.fontSize=t*(this.components[s].options.fontSize/this.prevScale/this.initialScale.x):s!==this._annotationId&&!0!==this.components[s].isLeadLine&&(this.components[s].options.weight=this.style.weight);for(var a=0;a<this.geoSymbolTexts.length;a++){var r=this.geoSymbolTexts[a];null!==r&&r._calculateParts()}var u=this.dScale/this.prevScale,p=this._map.getZoomScale(this._map.getZoom(),this.fromZoom);u!==p&&this._resizeCells(u*(1/p),this.getLatLngs()[0]),this.prevScale=this.dScale,this._calculateLabel(),this._calculateBloodVolume(),this._calculatePictureFrame()}else{var h=this._map.getZoomScale(this.fromZoom,this._map.getZoom());this._resizeCells(h,this.getLatLngs()[0])}else{for(var c=0;c<this.geoSymbolTexts.length;c++)this.geoSymbolTexts[c].fromZoom=this._map.getZoom();var y=this._map.getZoomScale(this.fromZoom,this._map.getZoom()),g=this.getLatLngs()[0];this._resizeCells(y,g)}this.fromZoom=this._map.getZoom(),this.layer._map.getRenderer(this.layer)instanceof L.Canvas&&this._updateCanvasFills(),this._updateSymbolTexts();var f="";null!==this._map&&this._map instanceof L.Map&&(f=this._map.options.crs.code,L.Util.isMercatorProjection(f)&&this.redraw()),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues),this.isSelected&&this._map.getPlotEditControl()&&this._map.getPlotEditControl().fire(SuperMap.Plot.Event.featuresmodified,{features:[this]})}},setLatLngs:function(t){this.latLngs=t,this.redraw();for(var e=0;e<this.deployments.length;e++){var i=this.deployments[e];null!==i&&null!=i.layer&&(i.symbolType!==SuperMap.Plot.SymbolType.NAVYDEPLOYMENT&&i.symbolType!==SuperMap.Plot.SymbolType.AIRDEPLOYMENT||(i.style.display=this.style.display,i.redraw()))}this._updateJoinLines(),this._updateSymbolTexts(),this.layer.fire("propertychanged",{feature:this,property:t}),this.fire("latlngchanged",{feature:this,property:t})},getSpace:function(){return this.space},setSpace:function(t){this.space!==t&&(this.space=t,0!==this.textContent.length&&(null!=this.graphic&&null!=this.graphic.layer&&!0===this.graphic.layer.getVisibility()?this.graphic.redraw():null==this.layer||null!=this.layer.getVisibility&&!0!==this.layer.getVisibility()||this._handleAnnotation()))},setRotate:function(t){if(!isNaN(t)){var e=t-this.dRotate;this.dRotate=t;for(var i=0,o=this.avoidRegions.length;i<o;i++)L.Util.rotateLatLngs(this.avoidRegions[i].getLatLngs(),this.getLatLngs()[0],e);this.redraw(),this._updateSymbolTexts()}},getScale:function(){return!0===this.limitWidthHeight?this.initialScale.x:this.initialScale={x:this.symbolSize.w/this.symbolSizeInLib.w,y:this.symbolSize.h/this.symbolSizeInLib.h}},setScale:function(t,e){isNaN(t)||(!0===this.limitWidthHeight?(this.initialScale.x=t,null!=this.layer&&!1===this.layer.enableSymScale||this.dScale>1?(this.symbolSize.w=this.initialScale.x*this.dScale*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale.x*this.dScale*this.symbolSizeInLib.h):(this.symbolSize.w=this.initialScale.x*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale.x*this.symbolSizeInLib.h)):(this.symbolSize.w=t*this.symbolSizeInLib.w,this.symbolSize.h=e*this.symbolSizeInLib.h),null!=this.layer&&!1===this.layer.enableSymScale||this.dScale>1?this.style.fontSize=this.fontSize*this.dScale*this.initialScale.x:this.style.fontSize=this.fontSize*this.initialScale.x,this.prevFontSize=this.style.fontSize,this.redraw(),this._updateSymbolTexts())},setPositionOffset:function(t){this.positionOffset!==t&&(this.positionOffset=t,!1===this.positionOffset&&(this.positionOffsetX=0,this.positionOffsetY=0),this.redraw())},getPositionOffset:function(){return this.positionOffset},setPositionOffsetType:function(t){this.positionOffsetType!==t&&(this.positionOffsetType=t,this.positionOffset&&this.redraw())},getPositionOffsetType:function(){return this.positionOffsetType},setTextContent:function(t){this.textContent=t,null!=this.graphic&&null!=this.graphic.layer&&!0===this.graphic.layer.getVisibility()?this.graphic.redraw():null==this.layer||null!=this.layer.getVisibility&&!0!==this.layer.getVisibility()||this._handleAnnotation(),this.layer.fire("propertychanged",{feature:this,property:t})},middleMarkExist:function(){return this.symbolData.middleMarkExist},setTextPosition:function(t){8===t&&!1===this.symbolData.middleMarkExist||this.annotationPosition!==t&&(this.annotationPosition=t,null!=this.graphic&&null!=this.graphic.layer&&!0===this.graphic.layer.getVisibility()?this.graphic.redraw():null==this.layer||null!=this.layer.getVisibility&&!0!==this.layer.getVisibility()||this._handleAnnotation(),this.layer.fire("propertychanged",{feature:this,property:this.annotationPosition}))},getSymbolSize:function(){return this.symbolSize},setSymbolSize:function(t,e,i,o){if(void 0!=o&&o&&(this.fontSize=null),0===this.symbolSizeInLib.w||0===this.symbolSizeInLib.h)this.initialScale.x=1;else{null===this.symbolSize&&(this.symbolSize=new SuperMap.Size(0,0)),null==this.layer&&(this.layer=Mc.prototype.getActivePlottingLayer());var n=1,l=1;null!=this.layer&&!1===this.layer.enableSymScale||this.dScale>1?(n=t/this.dScale/this.symbolSizeInLib.w,l=e/this.dScale/this.symbolSizeInLib.h):(n=t/this.symbolSizeInLib.w,l=e/this.symbolSizeInLib.h),!0===this.limitWidthHeight?(this.initialScale.x!==n?this.initialScale.x=n:this.initialScale.x!==l&&(this.initialScale.x=l),null!=this.layer&&!1===this.layer.enableSymScale||this.dScale>1?(this.symbolSize.w=this.initialScale.x*this.dScale*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale.x*this.dScale*this.symbolSizeInLib.h):(this.symbolSize.w=this.initialScale.x*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale.x*this.symbolSizeInLib.h)):(this.initialScale.x=n,this.initialScale.y=l,null!=this.layer&&!1===this.layer.enableSymScale||this.dScale>1?(this.symbolSize.w=this.initialScale.x*this.dScale*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale.y*this.dScale*this.symbolSizeInLib.h):(this.symbolSize.w=this.initialScale.x*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale.y*this.symbolSizeInLib.h))}var s;s=!1===this.limitWidthHeight?this.initialScale.x<this.initialScale.y?this.initialScale.x:this.initialScale.y:this.initialScale.x,null==this.fontSize?this.fontSize=this.style.fontSize/s:this.style.fontSize=this.fontSize*s,this.prevFontSize=this.style.fontSize,null==i&&(i=!0),i&&this._map&&(this.redraw(),this.layer.fire("propertychanged",{feature:this,property:this.symbolSize}))},setSurroundLineType:function(t){if(this.surroundLineType!==t){var e=new SuperMap.GetSymbolInfoParameters;e.libID=this.libID,e.code=this.code,e.symbolRank=this.symbolRank,e.surroundLineType=t,L.supermap.symbolInfoService(this.serverUrl).getSymbolInfo(e,function(t){this.symbolData.innerCells=t.result.innerCells,this.surroundLineType=t.result.surroundLineType,this.redraw(),this._map&&this._map.getPlotEditControl()&&this._map.getPlotEditControl().fire(SuperMap.Plot.Event.featuresmodified,{features:[this]})},this)}},getSymbolRanks:function(){return this.symbolData.symbolRanks},getSymbolRank:function(){return this.symbolRank},setSymbolRank:function(t){if(this.symbolRank!==t){var e=new SuperMap.GetSymbolInfoParameters;e.libID=this.libID,e.code=this.code,e.symbolRank=t,e.surroundLineType=this.surroundLineType,L.supermap.symbolInfoService(this.serverUrl).getSymbolInfo(e,function(t){this.symbolData.innerCells=t.result.innerCells,this.symbolRank=t.result.symbolRank,this.redraw(),this._map&&this._map.getPlotEditControl()&&this._map.getPlotEditControl().fire(SuperMap.Plot.Event.featuresmodified,{features:[this]})},this)}},getNegativeImage:function(){return this.negativeImage},setNegativeImage:function(t){this.negativeImage!==t&&(this.negativeImage=t,this.redraw(),this.layer.fire("propertychanged",{feature:this,property:this.negativeImage}))},getHorizontalMirror:function(){return this.horizontalMirror},setHorizontalMirror:function(t){this.horizontalMirror!==t&&(this.horizontalMirror=t,this.redraw())},getVerticalMirror:function(){return this.verticalMirror},setVerticalMirror:function(t){this.verticalMirror!==t&&(this.verticalMirror=t,this.redraw())},setWidthHeightLimit:function(t){this.limitWidthHeight!==t&&(t.constructor===Boolean&&(this.limitWidthHeight=t),!1===this.limitWidthHeight?(this.initialScale.x=this.symbolSize.w/this.symbolSizeInLib.w,this.initialScale.y=this.symbolSize.h/this.symbolSizeInLib.h):!0===this.limitWidthHeight&&(this.initialScale.x=this.initialScale.x<this.initialScale.y?this.initialScale.y:this.initialScale.x,this.redraw()))},getWidthHeightLimit:function(){return this.limitWidthHeight},getBloodVolumes:function(){return this.bloodVolumes},getSymbolTexts:function(){return this.symbolTexts},getSpecialEffects:function(){return this.specialEffectComponents},_addSpecialEffect:function(t){var e=t.specialEffect.effectType;(e==SuperMap.Plot.SpecialEffectType.AIM?t.specialEffect.viewUuid:e==SuperMap.Plot.SpecialEffectType.COMMUNICATIONLINK?t.specialEffect.senderUuid:t.specialEffect.associatedUuid)===this.uuid&&this.specialEffectComponents.push(t.specialEffect)},_removeSpecialEffect:function(t){for(var e=null,i=0;i<this.specialEffectComponents.length;i++)if(t.uuid==this.specialEffectComponents[i].uuid){e=i;break}this.specialEffectComponents.splice(e,1)},_updateSpecialEffect:function(t){for(var e=0;e<this.specialEffectComponents.length;e++)if(t.uuid==this.specialEffectComponents[e].uuid){this.specialEffectComponents[e].aId_=t.aId_;break}},removeSpecialEffect:function(t){for(var e=null,i=0;i<this.specialEffectComponents.length;i++)if(t.uuid==this.specialEffectComponents[i].uuid){e=i;break}this.specialEffectComponents[e].remove(),this.specialEffectComponents.splice(e,1)},getPictureFrames:function(){return this.pictureFrames},setSymbolTextVisible:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(void 0==e&&null!==this.symbolTexts&&this.symbolTexts.length>0)for(var i=0,o=this.symbolTexts.length;i<o;i++){this.symbolTexts[i].style.display=t?"display":"none"}else null!==this.symbolTexts&&this.symbolTexts.length>e-1&&(this.symbolTexts[e].style.display=t?"display":"none");this._symbolTextInit=!0,this.layer instanceof gy?this.layer.update():this.redraw()},move:function(t,e){if(Object.prototype.hasOwnProperty.call(this,"_eventParents")&&null!==this._eventParents)for(var i in this._eventParents){var o=this._eventParents[i];if(o.symbolType===SuperMap.Plot.SymbolType.FLAGGROUP&&!1===o.isSelected)return void this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)}if(this.positionOffset){var n=1;"function"==typeof this.layer.getSymZoomScale&&(n=this.layer.getSymZoomScale()),null!=this.minScale&&n<this.minScale&&(n=this.minScale),null!=this.maxScale&&n>this.maxScale&&(n=this.maxScale);var l=this._map.latLngToLayerPoint(L.latLng(this.getLatLngs()[0].lat+t,this.getLatLngs()[0].lng+e)),s=this._map.latLngToLayerPoint(this.getLatLngs()[0]);this.positionOffsetX+=(l.x-s.x)/n,this.positionOffsetY+=(l.y-s.y)/n,this.prevPositionOffsetX=this.positionOffsetX,this.prevPositionOffsetY=this.positionOffsetY,this.redraw()}else xh.prototype._move.call(this,t,e);if(this._updateJoinLines(),null!==this.deployments&&0<this.deployments.length)for(var a=0;a<this.deployments.length;a++){var r=this.deployments[a];if(null!==r&&(r.symbolType===SuperMap.Plot.SymbolType.NAVYDEPLOYMENT||r.symbolType===SuperMap.Plot.SymbolType.AIRDEPLOYMENT)){for(var u=0;u<r.components.length;u++)r.components[u].symbolType===SuperMap.Plot.SymbolType.ANNOFRAMESYMBOL&&(r.components[u].latLngs[2]=this.latLngs[0],r.components[u].redraw());for(var p=0;p<r.subObjects.length;p++)r.subObjects[p].redraw()}}for(var h=0,c=this.avoidRegions.length;h<c;h++)L.Util.moveLatLngs(this.avoidRegions[h].getLatLngs(),t,e);var y="";null!==this._map&&this._map instanceof L.Map&&(y=this._map.options.crs.code,L.Util.isMercatorProjection(y)&&this.redraw()),this._updateSymbolTexts(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues),this.layer.fire("propertychanged",{feature:this,property:this.symbolData.localePoints})},getBounds:function(){var t=new L.LatLngBounds;if(this.layer instanceof gy&&this._boundslatlng)t=this._boundslatlng;else for(var e=0;e<this.components.length;e++){var i=this.components[e];i.isLeadLine||i.isAnnotation||i.isSymbolText||i.isBloodVolume||i.isPictureFrame||t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t},getBoundsWithText:function(){for(var t=new L.LatLngBounds,e=0;e<this.components.length;e++){var i=this.components[e];i.isLeadLine||t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t},_calculateParts:function(){if(!(this.getLatLngs().length<this.minEditPts))if("none"===this.style.display||null!=this.layer&&"function"==typeof this.layer.getVisibility&&!1===this.layer.getVisibility())this._updateSymbolTexts();else{var t=1;!1===this.layer.enableSymScale?t=this.dScale:!0===this.scaleByMap&&("function"==typeof this.layer.getSymZoomScale&&(t=this.layer.getSymZoomScale()),null!=this.minScale&&t<this.minScale&&(t=this.minScale),null!=this.maxScale&&t>this.maxScale&&(t=this.maxScale));var e=SuperMap.Plot.AnalysisSymbol.analysisSymbolCells(this.symbolData,!0),i=this._map.latLngToLayerPoint(this.getLatLngs()[0]);if(!0===this.positionOffset&&(!1===this.layer.enableSymScale?(i.x+=this.positionOffsetX,i.y+=this.positionOffsetY):(i.x+=this.positionOffsetX*t,i.y+=this.positionOffsetY*t)),!0===this.limitWidthHeight)var o=this.initialScale.x*t;for(var n=0,l=e.length;n<l;n++){var s=e[n];if(0!==this.surroundLineType||!0!==s.surroundLineFlag){if(this.negativeImage||this.horizontalMirror){var a=new SuperMap.Plot.Point(this.anchorPoint.x,100),r=this.anchorPoint;this._computeNegativeImage(s,a,r)}if(this.verticalMirror){var u=this.anchorPoint,p=new SuperMap.Plot.Point(100,this.anchorPoint.y);this._computeNegativeImage(s,u,p)}s.type===SuperMap.Plot.SymbolType.TEXTSYMBOL&&(!1===this.layer.enableSymScale?s.style.fontSize=o*(s.style.fontSize/10):s.style.fontSize=this.initialScale.x*(s.style.fontSize/10),s.style.labelRotation+=-this.dRotate),null!=s.polybezierClose&&(s.type===SuperMap.Plot.SymbolType.POLYBEZIERSYMBOL||s.type===SuperMap.Plot.SymbolType.POLYBEZIERCLOSESYMBOL?(s.type,SuperMap.Plot.SymbolType.POLYBEZIERSYMBOL,s.positionPoints=SuperMap.Plot.PlottingUtil.generateBeizerPointsWithCtrlPt(s.positionPoints),s.isClosed&&s.positionPoints[0]!==s.positionPoints[s.positionPoints.length-1]&&s.positionPoints.push(s.positionPoints[0])):s.type===SuperMap.Plot.SymbolType.KIDNEY&&(s.positionPoints=SuperMap.Plot.Primitives.getSpatialData(s.type,s.positionPoints)));for(var h=0,c=s.positionPoints.length;h<c;h++){s.positionPoints[h].x-=this.symbolData.anchorPoint.x,s.positionPoints[h].y-=this.symbolData.anchorPoint.y,!0===this.limitWidthHeight?(Object.is(o,NaN)&&(o=1),s.positionPoints[h].x=s.positionPoints[h].x*o,s.positionPoints[h].y=s.positionPoints[h].y*o):(s.positionPoints[h].x=s.positionPoints[h].x*this.symbolSize.w/this.symbolSizeInLib.w,s.positionPoints[h].y=s.positionPoints[h].y*this.symbolSize.h/this.symbolSizeInLib.h);var y=this.dRotate*(Math.PI/180);SuperMap.Plot.PlottingUtil.rotateAngle({x:0,y:0},y,s.positionPoints[h]),s.positionPoints[h]=this._transitionPoint(s.positionPoints[h],i)}s.positionPoints=L.Util.latLngsToSuperMapPoints(s.positionPoints)}}this._transSymbolCellsToLayers(e),this._calculateBloodVolume(),this._calculatePictureFrame(),this._generateLeadLine(),this._annotationId=-1,this._handleAnnotation(),this._calculateLabel(),this._calculateSpecialEffect(),this._updateSymbolTexts(),this._bounds=this.getBounds(),this.prevScale=t}},_calculateBloodVolume:function(t,e){for(var i=0;i<this.components.length;)!0===this.components[i].isBloodVolume?(null!=this.components[i]._renderer&&(this.components[i].removeEventParent(this),this.components[i].onRemove()),delete this.components[i],this.components.splice(i,1)):i++;if(this.bloodVolumeComponents.length=0,!(this.getLatLngs().length<this.minEditPts)&&null!=this.bloodVolumes&&0!==this.bloodVolumes.length){null==t&&(t=this.getBounds()),null==e&&(e=this.getLatLngs()[0]);var o=this._map.latLngToLayerPoint(e),n=1;"function"==typeof this.layer.getSymZoomScale&&(n=this.layer.getSymZoomScale()),null!=this.minScale&&n<this.minScale&&(n=this.minScale),null!=this.maxScale&&n>this.maxScale&&(n=this.maxScale);for(var l=0;l<this.bloodVolumes.length;l++){var s=[],a=null;if(null!=this.bloodVolumes[l].width)a=Math.abs(this._map.layerPointToLatLng(L.point(o.x+this.bloodVolumes[l].width,o.y)).lng-e.lng);else{var r=Math.abs(this._map.layerPointToLatLng(L.point(o.x+40,o.y)).lng-e.lng);(a=Math.abs(t.getEast()-t.getWest()))<r&&(a=r)}var u,p,h=null;if(null!=this.bloodVolumes[l].height)h=Math.abs(this._map.layerPointToLatLng(L.point(o.x,o.y+this.bloodVolumes[l].height)).lat-e.lat);else{h=Math.abs(this._map.layerPointToLatLng(L.point(o.x,o.y+8)).lat-e.lat)}if(a*=n,h*=n,this.bloodVolumes[l].position===SuperMap.Plot.Position.TOP){var c=L.latLng(t.getNorth(),t.getCenter().lng),y=this._map.latLngToLayerPoint(c);y.x+=this.bloodVolumes[l].offsetX*n,y.y+=this.bloodVolumes[l].offsetY*n,c=this._map.layerPointToLatLng(y),u=L.latLng(c.lat+h,c.lng-.5*a),p=L.latLng(c.lat,c.lng+.5*a)}else if(this.bloodVolumes[l].position===SuperMap.Plot.Position.BOTTOM){var g=L.latLng(t.getSouth(),t.getCenter().lng),f=this._map.latLngToLayerPoint(g);f.x+=this.bloodVolumes[l].offsetX*n,f.y+=this.bloodVolumes[l].offsetY*n,g=this._map.layerPointToLatLng(f),u=L.latLng(g.lat,g.lng-.5*a),p=L.latLng(g.lat-h,g.lng+.5*a)}else if(this.bloodVolumes[l].position===SuperMap.Plot.Position.LEFT){var d=L.latLng(t.getCenter().lat,t.getWest()),m=this._map.latLngToLayerPoint(d);m.x+=this.bloodVolumes[l].offsetX*n,m.y+=this.bloodVolumes[l].offsetY*n,d=this._map.layerPointToLatLng(m),u=L.latLng(d.lat+.5*a,d.lng-h),p=L.latLng(d.lat-.5*a,d.lng)}else if(this.bloodVolumes[l].position===SuperMap.Plot.Position.RIGHT){var S=L.latLng(t.getCenter().lat,t.getEast()),P=this._map.latLngToLayerPoint(S);P.x+=this.bloodVolumes[l].offsetX*n,P.y+=this.bloodVolumes[l].offsetY*n,S=this._map.layerPointToLatLng(P),u=L.latLng(S.lat+.5*a,S.lng),p=L.latLng(S.lat-.5*a,S.lng+h)}var b=this.bloodVolumes[l].style.color;null==b&&(b="#808080");var v=this.bloodVolumes[l].style.weight;null==v&&(v=4);var M=this.bloodVolumes[l].style.opacity;null==M&&(M=1);var _=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[u,p],{fillLimit:!0,fillSymbolID:1,lineWidthLimit:!0,weight:v,lineColorLimit:!0,color:b,opacity:M});_.isBloodVolume=!0,_.fromZoom=this._map.getZoom(),s.push(_);var A=this.bloodVolumes[l].style.remainingVolumeColor;null==A&&(A="#00ff00");var T=this.bloodVolumes[l].style.remainingVolumeOpacity;null==T&&(T=.8);var x=this.bloodVolumes[l].style.consumeVolumeColor;null==x&&(x="#000000");var O=this.bloodVolumes[l].style.consumeVolumeOpacity;null==O&&(O=.8);var w=this.components[this.components.length-1].getBounds();if(this.bloodVolumes[l].position===SuperMap.Plot.Position.TOP||this.bloodVolumes[l].position===SuperMap.Plot.Position.BOTTOM){if(!SuperMap.Plot.PlottingUtil.equalFuzzy(0,this.bloodVolumes[l].volume)){var C=w.getNorthWest(),E=L.latLng(w.getSouthEast().lat,C.lng+this.bloodVolumes[l].volume*a),I=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[C,E],{fillLimit:!0,fillSymbolID:0,fillColorLimit:!0,fillColor:A,fillOpacity:T,lineColorLimit:!0,opacity:0});I.isBloodVolume=!0,I.fromZoom=this._map.getZoom(),s.push(I)}if(!SuperMap.Plot.PlottingUtil.equalFuzzy(1,this.bloodVolumes[l].volume)){var D=w.getSouthEast(),U=L.latLng(w.getNorthWest().lat,w.getNorthWest().lng+this.bloodVolumes[l].volume*a),R=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[D,U],{fillLimit:!0,fillSymbolID:0,fillColorLimit:!0,fillColor:x,fillOpacity:O,lineColorLimit:!0,opacity:0});R.isBloodVolume=!0,R.fromZoom=this._map.getZoom(),s.push(R)}}else if(this.bloodVolumes[l].position===SuperMap.Plot.Position.LEFT||this.bloodVolumes[l].position===SuperMap.Plot.Position.RIGHT){if(!SuperMap.Plot.PlottingUtil.equalFuzzy(0,this.bloodVolumes[l].volume)){var N=w.getSouthWest(),B=L.latLng(N.lat+this.bloodVolumes[l].volume*a,w.getNorthEast().lng),k=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[N,B],{fillLimit:!0,fillSymbolID:0,fillColorLimit:!0,fillColor:A,fillOpacity:T,lineColorLimit:!0,opacity:0});k.isBloodVolume=!0,k.fromZoom=this._map.getZoom(),s.push(k)}if(!SuperMap.Plot.PlottingUtil.equalFuzzy(1,this.bloodVolumes[l].volume)){var F=w.getNorthEast(),j=L.latLng(w.getSouthWest().lat+this.bloodVolumes[l].volume*a,w.getSouthWest().lng),V=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[F,j],{fillLimit:!0,fillSymbolID:0,fillColorLimit:!0,fillColor:x,fillOpacity:O,lineColorLimit:!0,opacity:0});V.isBloodVolume=!0,V.fromZoom=this._map.getZoom(),s.push(V)}}this.bloodVolumeComponents.push(s)}}},_calculatePictureFrame:function(t){for(var e=0;e<this.components.length;)!0===this.components[e].isPictureFrame?(null!=this.components[e]._renderer&&(this.components[e].removeEventParent(this),this.components[e].onRemove()),delete this.components[e],this.components.splice(e,1)):e++;if(this.pictureFrameComponents.length=0,!(this.getLatLngs().length<this.minEditPts)&&null!=this.pictureFrames&&0!==this.pictureFrames.length){null==t&&(t=this.getBounds());for(var i=0;i<this.pictureFrames.length;i++){var o=[],n=void 0,l=0,s=0;if(this.pictureFrames[i].position===SuperMap.Plot.Position.TOP){var a=L.latLng(t.getNorth(),t.getCenter().lng),r=this._map.latLngToLayerPoint(a);r.x+=this.pictureFrames[i].offsetX,r.y+=this.pictureFrames[i].offsetY,n=this._map.layerPointToLatLng(r),l=-.5*this.pictureFrames[i].width,s=-this.pictureFrames[i].height}else if(this.pictureFrames[i].position===SuperMap.Plot.Position.BOTTOM){var u=L.latLng(t.getSouth(),t.getCenter().lng),p=this._map.latLngToLayerPoint(u);p.x+=this.pictureFrames[i].offsetX,p.y+=this.pictureFrames[i].offsetY,n=this._map.layerPointToLatLng(p),l=-.5*this.pictureFrames[i].width}else if(this.pictureFrames[i].position===SuperMap.Plot.Position.LEFT){var h=L.latLng(t.getCenter().lat,t.getWest()),c=this._map.latLngToLayerPoint(h);c.x+=this.pictureFrames[i].offsetX,c.y+=this.pictureFrames[i].offsetY,n=this._map.layerPointToLatLng(c),l=-this.pictureFrames[i].width,s=-.5*this.pictureFrames[i].height}else if(this.pictureFrames[i].position===SuperMap.Plot.Position.RIGHT){var y=L.latLng(t.getCenter().lat,t.getEast()),g=this._map.latLngToLayerPoint(y);g.x+=this.pictureFrames[i].offsetX,g.y+=this.pictureFrames[i].offsetY,n=this._map.layerPointToLatLng(g),s=-.5*this.pictureFrames[i].height}var f={externalGraphic:this.pictureFrames[i].path,graphicWidth:this.pictureFrames[i].width,graphicHeight:this.pictureFrames[i].height,graphicXOffset:l,graphicYOffset:s},d=L.supermap.plotting.pointImage([n],f);d.isPictureFrame=!0,d.fromZoom=this._map.getZoom(),this._addComponents(d),o.push(d),this.pictureFrameComponents.push(o)}}},_generateLeadLine:function(){if(this.positionOffset){var t=1;if("function"==typeof this.layer.getSymZoomScale&&(t=this.layer.getSymZoomScale()),null!=this.minScale&&t<this.minScale&&(t=this.minScale),null!=this.maxScale&&t>this.maxScale&&(t=this.maxScale),this.positionOffsetType===SuperMap.Plot.PositionOffsetType.LINE){var e=this._map.latLngToLayerPoint(this.getLatLngs()[0]),i=L.point(e.x+this.positionOffsetX*t,e.y+this.positionOffsetY*t),o=this._map.layerPointToLatLng(i),n=[this.getLatLngs()[0].clone(),o];this._createAndDrawLayer(24,n,{surroundLineFlag:!1,lineTypeLimit:!0}).isLeadLine=!0}else{var l,s,a=this._map.latLngToLayerPoint(this.getLatLngs()[0]),r=L.point(a.x+this.positionOffsetX*t,a.y+this.positionOffsetY*t),u=this._map.layerPointToLatLng(r),p=new SuperMap.Geometry.Point(this.getLatLngs()[0].lng,this.getLatLngs()[0].lat),h=new SuperMap.Geometry.Point(u.lng,u.lat),c=180*SuperMap.Plot.PlottingUtil.radian(p,h)/Math.PI;if(c>45&&c<135||c>225&&c<315){var y=L.point(r.x-this.style.weight/2,r.y),g=L.point(r.x+this.style.weight/2,r.y);l=this._map.layerPointToLatLng(y),s=this._map.layerPointToLatLng(g)}else{var f=L.point(r.x,r.y-this.style.weight/2),d=L.point(r.x,r.y+this.style.weight/2);l=this._map.layerPointToLatLng(f),s=this._map.layerPointToLatLng(d)}var m=[this.getLatLngs()[0],l,s];this._createAndDrawLayer(32,m,{surroundLineFlag:!1,lineWidthLimit:!0,weight:0,fillLimit:!0,fill:!0}).isLeadLine=!0}}},_handleAnnotation:function(t){if(null!=this._annotationId&&-1!==this._annotationId&&(null!=this.components[this._annotationId]._renderer&&(this.components[this._annotationId].removeEventParent(this),this.components[this._annotationId].onRemove()),delete this.components[this._annotationId],this.components.splice(this._annotationId,1),this._annotationId=-1),!1!==this.textDisplay&&(this.textContent=SuperMap.Plot.PlottingUtil.trim(this.textContent),null==t&&(t=this.getBounds()),t.isValid()&&this.textContent&&null!==this.textContent&&0!==this.textContent.length&&null!==t&&t.isValid())){var e={};SuperMap.Plot.PlottingUtil.cloneObject(this.style);var i=1;!1===this.layer.enableSymScale?i=this.dScale:!0===this.scaleByMap&&("function"==typeof this.layer.getSymZoomScale&&(i=this.layer.getSymZoomScale()),null!=this.minScale&&i<this.minScale?i=this.minScale:null!=this.maxScale&&i>this.maxScale&&(i=this.maxScale));var o=this.space,n=null;if(0===this.annotationPosition){e.labelAlign="rb";var l=L.latLng(t.getNorth(),t.getWest()),s=this._map.latLngToLayerPoint(l);s.x-=o,n=this._map.layerPointToLatLng(s)}else if(1===this.annotationPosition){e.labelAlign="rt";var a=L.latLng(t.getSouth(),t.getWest()),r=this._map.latLngToLayerPoint(a);r.x-=o,n=this._map.layerPointToLatLng(r)}else if(2===this.annotationPosition){e.labelAlign="lb";var u=L.latLng(t.getNorth(),t.getEast()),p=this._map.latLngToLayerPoint(u);p.x+=o,n=this._map.layerPointToLatLng(p)}else if(3===this.annotationPosition){e.labelAlign="lt";var h=L.latLng(t.getSouth(),t.getEast()),c=this._map.latLngToLayerPoint(h);c.x+=o,n=this._map.layerPointToLatLng(c)}else if(4===this.annotationPosition){e.labelAlign="cb";var y=L.latLng(t.getNorth(),(t.getWest()+t.getEast())/2),g=this._map.latLngToLayerPoint(y);g.y-=o,n=this._map.layerPointToLatLng(g)}else if(5===this.annotationPosition){e.labelAlign="ct";var f=L.latLng(t.getSouth(),(t.getWest()+t.getEast())/2),d=this._map.latLngToLayerPoint(f);d.y+=o,n=this._map.layerPointToLatLng(d)}else if(6===this.annotationPosition){e.labelAlign="rm";var m=L.latLng((t.getSouth()+t.getNorth())/2,t.getWest()),S=this._map.latLngToLayerPoint(m);S.x-=o,n=this._map.layerPointToLatLng(S)}else if(7===this.annotationPosition){e.labelAlign="lm";var P=L.latLng((t.getSouth()+t.getNorth())/2,t.getEast()),b=this._map.latLngToLayerPoint(P);b.x+=o,n=this._map.layerPointToLatLng(b)}else if(8===this.annotationPosition&&this.symbolData.middleMarkExist){var v;v=!0===this.limitWidthHeight?this.middleMarkBounds.scale(this.initialScale.x*i,this.anchorPoint):this._widthHeightLimitScale();var M=new SuperMap.Geometry.Point((v.left+v.right)/2,(v.top+v.bottom)/2);if(this.negativeImage||this.horizontalMirror){var _=SuperMap.Plot.PlottingUtil.projectPoint(M,new SuperMap.Geometry.Point(this.anchorPoint.x,100),new SuperMap.Geometry.Point(this.anchorPoint.x,this.anchorPoint.y));SuperMap.Plot.PlottingUtil.rotateAngle(_,Math.PI,M)}if(this.verticalMirror){_=SuperMap.Plot.PlottingUtil.projectPoint(M,new SuperMap.Geometry.Point(this.anchorPoint.x,this.anchorPoint.y),new SuperMap.Geometry.Point(100,this.anchorPoint.y));SuperMap.Plot.PlottingUtil.rotateAngle(_,Math.PI,M)}M.x-=this.anchorPoint.x,M.y-=this.anchorPoint.y;var A=this.dRotate*(Math.PI/180);SuperMap.Plot.PlottingUtil.rotateAngle(new SuperMap.Geometry.Point(0,0),A,M);var T=this._map.latLngToLayerPoint(this.getLatLngs()[0]);!0===this.positionOffset&&(T.x+=this.positionOffsetX,T.y+=this.positionOffsetY);var x=96*v.getWidth()/25.4/10,O=96*v.getHeight()/25.4/10;e.graphicWidth=x,e.graphicHeight=O,n=this._transitionPoint(M,T)}if(8===this.annotationPosition&&this.symbolData.middleMarkExist){e.rotation=-this.dRotate,e.labelAlign="cm",e.fontOpacity=this.style.fontOpacity,e.fontColor=this.style.fontColor,e.fontFamily=this.style.fontFamily,e.fontWeight=this.style.fontWeight,e.fontStyle=this.style.fontStyle,e.fontStroke=this.style.fontStroke,e.fontStrokeColor=this.style.fontStrokeColor,e.fontStrokeWidth=this.style.fontStrokeWidth,e.externalGraphic=this._getTextGraphic(this.textContent,e);var w={externalGraphic:e.externalGraphic,graphicWidth:e.graphicWidth,graphicHeight:e.graphicHeight,rotation:-this.dRotate},C=L.supermap.plotting.pointImage([n],w);this._annotationId=this.components.length,C.fromZoom=this._map.getZoom(),this._addComponents(C)}else if(8!==this.annotationPosition){e.fontSize=this.style.fontSize*i,e.fontSizeLimit=!1,e.labelRotation=0,this._annotationId=this.components.length;var E=this._createAndDrawLayer(34,[n],e,this.textContent);E.isAnnotation=!0,E.fromZoom=this._map.getZoom()}}},setSymbolTextStyle:function(t){if(null!=t){this._symbolTextInit=!0;var e=[];e=t.index?[this.symbolTexts[index]]:this.symbolTexts;for(var i=0;i<e.length;i++)if(null!=this._signUtils[i]){var o=e[i];if(t.templateUrl&&(o.templateUrl=t.templateUrl,this._signUtils[i]._templateUrl=t.templateUrl),t.dom&&(o.domStr=t.dom,this._signUtils[i]._dom=t.dom),null!=t.signType&&void 0!=t.signType&&(o.signType=t.signType,this._signUtils[i]._signType=t.signType,this._signUtils[i]._isExist=!1),null!=t.signRenderMode&&void 0!=t.signRenderMode&&(o.signRenderMode=t.signRenderMode,this._signUtils[i]._signRenderMode=t.signRenderMode),null!=t.textPosition&&void 0!=t.textPosition&&(o.textPosition=t.textPosition),null!=t.signMode&&void 0!=t.signMode&&(o.signMode=t.signMode,this._signUtils[i]._signMode=t.signMode),t.texts)if(t.texts instanceof Array)o.texts=t.texts,this._signUtils[i]._texts=t.texts;else{var n=t.texts.split("\n");o.texts=n,this._signUtils[i]._texts=n}t.title&&(o.title=t.title,this._signUtils[i]._title=t.title),t.signImage&&(o.signImage=t.signImage,this._signUtils[i]._signImage=t.signImage),t.titleStyle&&this._signUtils[i]._setTitleStyle(t.titleStyle),t.titleFrameStyle&&this._signUtils[i]._setTitleFrameStyle(t.titleFrameStyle),t.textStyle&&(t.textIndex?this._signUtils[i]._setTextStyle(t.textStyle,t.textIndex):this._signUtils[i]._setTextStyle_(t.textStyle)),t.textStyles&&t.textStyles instanceof Array&&this._signUtils[i]._setTextStyles(t.textStyles),t.contentFrameStyle&&this._signUtils[i]._setContentFrameStyle(t.contentFrameStyle),t.trayStyle&&this._signUtils[i]._setTrayStyle(t.trayStyle),t.iconStyle&&this._signUtils[i]._setIconStyle(t.iconStyle),t.indecatorLineStyle&&(t.indecatorLineStyle.lineWidth&&(o.lineStyle.weight=t.indecatorLineStyle.lineWidth),t.indecatorLineStyle.lineColor&&(o.lineStyle.color=t.indecatorLineStyle.lineColor),t.indecatorLineStyle.lineSymbolID&&(o.lineStyle.lineSymbolID=t.indecatorLineStyle.lineSymbolID),t.indecatorLineStyle.opacity&&(o.lineStyle.opacity=t.indecatorLineStyle.opacity)),t.scale&&(isNaN(t.scale)||(0==t.scale&&(t.scale=1e-10),o.scale=t.scale)),t.offset&&(o.offsetX=t.offset.x,o.offsetY=t.offset.y),t.visible&&(o.visible=t.visible),t.symbolText&&(o=t.symbolText),this._images=null,this.redraw()}}},getSymbolTextStyle:function(){for(var t=[],e=0;e<this._signUtils.length;e++)t.push(this._signUtils[e]._getOptions());return t},setSymbolText:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(this._symbolTextInit=!0,void 0!=e)delete this._signUtils[e],this._signUtils.splice(e,1),delete this.symbolTexts[e],this.symbolTexts.splice(e,1);else for(var i=0;i<this.symbolTexts.length;i++)delete this._signUtils[e],this._signUtils.splice(e,1),delete this.symbolTexts[e],this.symbolTexts.splice(e,1);this._images=null,this.redraw()},removeSymbolText:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!(t<0||t+1>this.symbolTexts.length)){if(void 0!=t)delete this._signUtils[t],this._signUtils.splice(t,1),delete this.symbolTexts[t],this.symbolTexts.splice(t,1);else for(var e=0;e<this.symbolTexts.length;e++)delete this._signUtils[t],this._signUtils.splice(t,1),delete this.symbolTexts[t],this.symbolTexts.splice(t,1);0==this.symbolTexts.length&&(this._symbolTextInit=!1),this._images=null,this.redraw()}},_calculateLabel:function(t,e){for(var i=0;i<this.components.length;)!0===this.components[i].isSymbolText?(null!=this.components[i]._renderer&&(this.components[i].removeEventParent(this),this.components[i].onRemove()),delete this.components[i],this.components.splice(i,1)):i++;if(this.symbolTextComponents.length=0,null!=this.symbolTexts&&0!==this.symbolTexts.length){var o={surroundLineFlag:!1,lineColorLimit:!0,fillColorLimit:!0,lineWidthLimit:!0,lineTypeLimit:!0,fontColorLimit:!0,fontSizeLimit:!0,fillLimit:!0};if(null==t&&(t=this.getBounds()),t&&t.isValid()){null==e&&(e=this.latLngs[0]);var n=1;"function"==typeof this.layer.getSymZoomScale&&(n=this.layer.getSymZoomScale()),null!=this.minScale&&n<this.minScale&&(n=this.minScale),null!=this.maxScale&&n>this.maxScale&&(n=this.maxScale);for(var l=0;l<this.symbolTexts.length;l++){var s=[];if(null!=this.symbolTexts[l].textContent&&0!==this.symbolTexts[l].textContent.length)if(null==this.symbolTexts[l].style||"none"!==this.symbolTexts[l].style.display){if(this.layer instanceof Uy){var a=this._map.getZoom();if(this.symbolTexts[l].minVisibleLevel>a||this.symbolTexts[l].maxVisibleLevel<a)continue;var r=this._map.getScale();if(0!=this.layer.markerMinVisibleScale&&this.layer.markerMinVisibleScale>r||0!=this.layer.markerMaxVisibleScale&&this.layer.markerMaxVisibleScale<r)continue}var u,p=this.symbolTexts[l];this._mergeStyleToSymbolText(p),p.textPosition=null==p.textPosition?0:p.textPosition,p.textContent instanceof Array?null==p.signType?(u=1===p.textContent.length?p.textContent[0].split("\n"):p.textContent,p._textContent=u):(u=p.textContent,p._textContent=p.textContent):(p.signType,u=p.textContent.split("\n"),p._textContent=u),p.title instanceof Array||(p.title=[p.title]),this._symbolTextInit||this._signUtils.push(this._init(p));var h=u.length,c=0,y=0,g=0,f=0,d=0,m=SuperMap.Plot.PlottingUtil.cloneObject(p.style),S=SuperMap.Plot.PlottingUtil.cloneObject(p.style);m.fontSize*=n,S.fontSize=S.titleFontSize*n,S.fontFamily=S.titleFontFamily,c=SuperMap.Plot.PlottingUtil.getTextWidth(m,u[0])+p.paddingX*n*2,p.title[0]&&(d=g=SuperMap.Plot.PlottingUtil.getTextWidth(S,p.title[0])+p.paddingX*n*2);for(var P=1;P<h;P++){var b=SuperMap.Plot.PlottingUtil.getTextWidth(m,u[P])+p.paddingX*n*2;b>c&&(c=b)}SuperMap.Plot.PlottingUtil.getTextWidth(m,u[0])+p.paddingX*n*2,y=parseInt(p.style.fontSize*n*h)+p.paddingY*n*2,parseInt(p.style.fontSize*n*1),p.title[0]&&(f=parseInt(p.style.titleFontSize*n*1)+p.paddingY*n*2,g);var v=L.point(0,0),M=L.point(0,0),_=SuperMap.Util.copyAttributes(o,p.style);if(null==p.signType&&2!=p.signMode&&3!=p.signMode){var A,T;0==p.signMode&&(c=0,y=0),p.image&&p.image.path&&(A=p.image.width?p.image.width:f,T=p.image.height?p.image.width:f,A>f&&(A=f),T>f&&(T=f),d=g+A);var x={scaleValue:n,iComponents:s,symbolText:p,symbolBounds:t,textWidth:c,textTitleWidth:d,textHeight:y,textTilteHeight:f,latLng:e},O=this._calculateLine(x);v=O.pixelRect1,M=O.pixelRect2;var w=v.x<M.x?v.x:M.x,C=v.y<M.y?v.y:M.y,E=v.x>M.x?v.x:M.x,I=v.y>M.y?v.y:M.y,D=L.point(w,C),U=L.point(E,I);p._bounds=L.bounds(D,U),s=O.iComponents;O.controlPoint;if(p.path&&!p.border){var R=v.clone(),N=M.clone(),B=this._map.layerPointToLatLng(R),k=this._map.layerPointToLatLng(N);(o=SuperMap.Util.cloneObject(_)).opacity="0.0",o.fillOpacity="0.0";var F=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[B,k],o);F.isSymbolText=!0,F.fromZoom=this._map.getZoom(),s.push(F);var j=this._map.layerPointToLatLng(L.point(R.x,R.y)),V={externalGraphic:p.path,graphicWidth:Math.abs(N.x-R.x),graphicHeight:N.y-R.y,rotation:0,graphicXOffset:0,graphicYOffset:0,graphicOpacity:1},z=this._createAndDrawLayer(SuperMap.Plot.SymbolType.PICTURE,[j],SuperMap.Util.cloneObject(_),null,V);if(z.isSymbolText=!0,z.fromZoom=this._map.getZoom(),s.push(z),p.title[0]){(S=SuperMap.Util.cloneObject(_)).fontColor=S.titleColor,S.fontFamily=S.titleFontFamily,S.fontSize=S.titleFontSize,S.labelAlign=p.style.titleLabelAlign,S.fontBackground=!1;var Y=this._calculateTextPosition(R,N,p.style.titleLabelAlign,p,c,y,g,f),G=this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,[Y.titlePt],S,p.title[0]);G.isSymbolText=!0,G.fromZoom=this._map.getZoom(),s.push(G)}Y=this._calculateTextPosition(R,N,p.style.contentLabelAlign,p,c,y,g,f);var W=SuperMap.Util.cloneObject(_);W.labelAlign=p.style.contentLabelAlign,W.fontBackground=!1;var X=this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,[Y.contentPt],W,p.textContent);X.isSymbolText=!0,X.fromZoom=this._map.getZoom(),s.push(X)}if(p.border){var H=v.clone(),Z=M.clone(),J=(B=this._map.layerPointToLatLng(H),k=this._map.layerPointToLatLng(Z),this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[B,k],SuperMap.Util.cloneObject(_)));if(J.isSymbolText=!0,J.fromZoom=this._map.getZoom(),s.push(J),p.title[0]){(S=SuperMap.Util.cloneObject(_)).fontColor=S.titleColor,S.fontFamily=S.titleFontFamily,S.fontSize=S.titleFontSize,S.labelAlign=p.style.titleLabelAlign,S.fontBackground=!1;Y=this._calculateTextPosition(D,U,p.style.titleLabelAlign,p,c,y,g,f);var q=this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,[Y.titlePt],S,p.title[0]);q.isSymbolText=!0,q.fromZoom=this._map.getZoom(),s.push(q)}if(1==p.signMode&&void 0!==p.textContent&&null!==p.textContent&&""!==p.textContent){Y=this._calculateTextPosition(D,U,p.style.contentLabelAlign,p,c,y,g,f);var K=SuperMap.Util.cloneObject(_);K.labelAlign=p.style.contentLabelAlign,K.fontBackground=!1;var Q=this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,[Y.contentPt],K,p.textContent);Q.isSymbolText=!0,Q.fromZoom=this._map.getZoom(),s.push(Q)}if(p.image&&p.image.path){var $,tt;0==p.image.position?($=w+(E-w-g)/2,tt=C+f/2,x={externalGraphic:p.image.path,graphicWidth:A,graphicHeight:T,rotation:0,graphicXOffset:0,graphicYOffset:0,graphicOpacity:1}):1==p.image.position&&($=w+(E-w-g)/2+g,tt=C+f/2,x={externalGraphic:p.image.path,graphicWidth:A,graphicHeight:T,rotation:0,graphicXOffset:0,graphicYOffset:0,graphicOpacity:1});var et=this._createAndDrawLayer(SuperMap.Plot.SymbolType.PICTURE,[this._map.layerPointToLatLng(L.point($,tt))],SuperMap.Util.cloneObject(_),null,x);et.isSymbolText=!0,et.fromZoom=this._map.getZoom(),s.push(et)}}else if(!p.path){if(p.title[0]){(S=SuperMap.Util.cloneObject(_)).fontColor=S.titleColor,S.fontFamily=S.titleFontFamily,S.fontSize=S.titleFontSize,S.labelAlign=p.style.titleLabelAlign,S.fontBackground=!1;Y=this._calculateTextPosition(D,U,p.style.titleLabelAlign,p,c,y,g,f);var it=this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,[Y.titlePt],S,p.title[0]);it.isSymbolText=!0,it.fromZoom=this._map.getZoom(),s.push(it)}if(1==p.signMode&&void 0!==p.textContent&&null!==p.textContent&&""!==p.textContent){Y=this._calculateTextPosition(D,U,p.style.contentLabelAlign,p,c,y,g,f);var ot=SuperMap.Util.cloneObject(_);ot.labelAlign=p.style.contentLabelAlign,ot.fontBackground=!1;var nt=this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,[Y.contentPt],ot,p.textContent);nt.isSymbolText=!0,nt.fromZoom=this._map.getZoom(),s.push(nt)}}this.symbolTextComponents.push(s)}else{if(0==p.signMode&&0===p.title.length)continue;if(1==p.signMode&&0===p.title.length&&0===p.textContent.length)continue;if(2==p.signMode&&!p.templateUrl&&!p.domStr)continue;if(3==p.signMode&&!p.signImage)continue;this._symbolStyle=_,this._symbolText=p,this._iComponents=s,this._scaleValue=n,this._symbolBounds=t,null==this._images||""==this._images||this._images instanceof String?(this.on("signsymbolcompleted",this._createSignSymbol),this._initSignSymbol(p,l)):s=this._createSignSymbol(!0)}}else this.symbolTextComponents.push(null)}}}},_init:function(t){var e={signType:t.signType,signMode:t.signMode,signRenderMode:t.signRenderMode,texts:t._textContent,title:t.title,templateUrl:t.templateUrl,dom:t.domStr,signImage:t.signImage,symbolText:t};return this._signUtil=L.supermap.plotting.signUtil(e),this._signUtil},_initSignSymbol:function(t,e){var i=this;this._signUtils[e]._generateImageData().then(function(e){switch(t.signRenderMode){case SuperMap.Plot.SignRenderMode.Billboard:e.toDataURL?(i._canvas=e,i._width=i._canvas.width,i._height=i._canvas.height,i._images=e.toDataURL("image/png"),i.fire("signsymbolcompleted")):(i._canvas=e.canvas,i._images=e.image,i._width=i._canvas.width,i._height=i._canvas.height,i.fire("signsymbolcompleted"));break;case SuperMap.Plot.SignRenderMode.DOM:}})},_addDivSignContent:function(t,e){this._domSignContent=document.createElement("div"),this._domSignContent.id="DivSignContent_"+SuperMap.Plot.PlottingUtil.generateUuid(),this._domSignContent.style.setProperty("position","fixed"),this._domSignContent.style.setProperty("z-index","9999"),t.appendChild(this._domSignContent);var i=null;i=e.toDataURL?e:e.canvas,this._domSignContent.appendChild(i),this._signMode!=SuperMap.Plot.SignMode.Simple&&this._signMode!=SuperMap.Plot.SignMode.Complex||(this._domSignContent.style.setProperty("width",i.width+"px"),this._domSignContent.style.setProperty("height",i.height+"px")),this._domSignContentWidth=this._domSignContent.offsetWidth,this._domSignContentHeight=this._domSignContent.offsetHeight},_createSignSymbol:function(t){this._symbolText.scale&&(this.scale=this._symbolText.signMode!=SuperMap.Plot.SignMode.Image?.5*this._symbolText.scale:this._symbolText.scale);var e=this._calculateLine({}),i=e.pixelRect1,o=e.pixelRect2,n=i.x<o.x?i.x:o.x,l=i.y<o.y?i.y:o.y,s=i.x>o.x?i.x:o.x,a=i.y>o.y?i.y:o.y,r=L.point(n,l),u=L.point(s,a);this._symbolText._bounds=L.bounds(r,u);var p=Math.abs(i.x-o.x),h=Math.abs(i.y-o.y),c=(i.x+o.x)/2,y=(i.y+o.y)/2,g=L.point(c,y),f=this._map.layerPointToLatLng(g);if(null==f)return null;if(this._symbolText.signRenderMode==SuperMap.Plot.SignRenderMode.DOM)this._domSign&&document.body.removeChild(this._domSign),this._domSign=document.createElement("div"),this._domSign.id="DivSign"+SuperMap.Plot.PlottingUtil.generateUuid(),this._domSign.style.setProperty("position","fixed"),document.body.appendChild(this._domSign),this._addDivSignContent(this._domSign,this._canvas);else{var d={externalGraphic:this._images,externalCanvas:this._canvas,graphicWidth:p,graphicHeight:h,rotation:0,graphicXOffset:0,graphicYOffset:0,graphicOpacity:1,fillOpacity:0,isSignSymbol:!0},m=this._createAndDrawLayer(SuperMap.Plot.SymbolType.PICTURE,[f],SuperMap.Util.cloneObject(this._symbolStyle),null,d);m.isSymbolText=!0,m.fromZoom=this._map.getZoom(),this._iComponents.push(m),null==this._images&&this.off("signsymbolcompleted",this._createSignSymbol),this.symbolTextComponents.push(this._iComponents),this.layer&&this.layer instanceof gy&&null!=this.graphic&&null!=this.graphic._image&&null!=this.graphic._image.bounds&&(this.graphic._image._drawSymbolText(),"boolean"!=typeof t||t?"boolean"!=typeof t&&this.graphic.update():this.graphic.update())}},_calculateLine:function(t){var e,i,o=t.scaleValue?t.scaleValue:this._scaleValue,n=t.iComponents?t.iComponents:this._iComponents,l=t.symbolText?t.symbolText:this._symbolText,s=t.symbolBounds?t.symbolBounds:this._symbolBounds,a=t.textWidth,r=t.textTitleWidth,u=t.textHeight,p=t.textTilteHeight,h=t.latLng?t.latLng:this.latLngs[0],c=L.point(0,0),y=L.point(0,0);switch(l.textPosition){case SuperMap.Plot.AnnoPosition.LEFTTOP:l.style.labelAlign="rb",e=L.latLng(s.getNorth(),s.getWest()),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(c.x=i.x-this._width*this.scale,c.y=i.y-this._height*this.scale,y.x=i.x,y.y=i.y):(c.x=i.x,c.y=i.y,y.x=i.x-this._width*this.scale,y.y=i.y-this._height*this.scale):l.title[0]?(l.path||l.title[0])&&(c.x=i.x-a-r,c.y=i.y-u-p,y.x=i.x,y.y=i.y):(c.x=i.x,c.y=i.y,y.x=i.x-a,y.y=i.y-u);break;case SuperMap.Plot.AnnoPosition.LEFTBOTTOM:l.style.labelAlign="rt",e=L.latLng(s.getSouth(),s.getWest()),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(c.x=i.x-this._width*this.scale,c.y=i.y,y.x=i.x,y.y=i.y+this._height*this.scale):(c.x=i.x,c.y=i.y,y.x=i.x-this._width*this.scale,y.y=i.y+this._height*this.scale):l.title[0]?(l.path||l.title[0])&&(c.x=i.x-a-r,c.y=i.y,y.x=i.x,y.y=i.y+u+p):(c.x=i.x,c.y=i.y,y.x=i.x-a,y.y=i.y+u);break;case SuperMap.Plot.AnnoPosition.RIGHTTOP:l.style.labelAlign="lb",e=L.latLng(s.getNorth(),s.getEast()),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(c.x=i.x,c.y=i.y-this._height*this.scale,y.x=i.x+this._width*this.scale,y.y=i.y):(c.x=i.x,c.y=i.y,y.x=i.x+this._width*this.scale,y.y=i.y-this._height*this.scale):l.title[0]?(l.path||l.title[0])&&(c.x=i.x,c.y=i.y-u-p,y.x=i.x+a+r,y.y=i.y):(c.x=i.x,c.y=i.y,y.x=i.x+a,y.y=i.y-u);break;case SuperMap.Plot.AnnoPosition.RIGHTBOTTOM:l.style.labelAlign="lt",e=L.latLng(s.getSouth(),s.getEast()),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(c.x=i.x,c.y=i.y,y.x=i.x+this._width*this.scale,y.y=i.y+this._height*this.scale):(c.x=i.x,c.y=i.y,y.x=i.x+this._width*this.scale,y.y=i.y+this._height*this.scale):l.title[0]?(l.path||l.title[0])&&(c.x=i.x,c.y=i.y,y.x=i.x+a+r,y.y=i.y+u+p):(c.x=i.x,c.y=i.y,y.x=i.x+a,y.y=i.y+u);break;case SuperMap.Plot.AnnoPosition.TOP:l.style.labelAlign="cb",e=L.latLng(s.getNorth(),(s.getWest()+s.getEast())/2),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(c.x=i.x-this._width*this.scale/2,c.y=i.y-this._height*this.scale,y.x=i.x+this._width*this.scale/2,y.y=i.y):(c.x=i.x-this._width*this.scale/2,c.y=i.y,y.x=i.x+this._width*this.scale/2,y.y=i.y-this._height*this.scale):l.title[0]?(l.path||l.title[0])&&(c.x=i.x-(a>r?a:r)/2,c.y=i.y-u-p,y.x=i.x+(a>r?a:r)/2,y.y=i.y):(c.x=i.x-a/2,c.y=i.y,y.x=i.x+a/2,y.y=i.y-u);break;case SuperMap.Plot.AnnoPosition.BOTTOM:l.style.labelAlign="ct",e=L.latLng(s.getSouth(),(s.getWest()+s.getEast())/2),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(c.x=i.x-this._width*this.scale/2,c.y=i.y,y.x=i.x+this._width*this.scale/2,y.y=i.y+this._height*this.scale):(c.x=i.x-this._width*this.scale/2,c.y=i.y,y.x=i.x+this._width*this.scale/2,y.y=i.y+this._height*this.scale):l.title[0]?(l.path||l.title[0])&&(c.x=i.x-(a>r?a:r)/2,c.y=i.y,y.x=i.x+(a>r?a:r)/2,y.y=i.y+u+p):(c.x=i.x-a/2,c.y=i.y,y.x=i.x+a/2,y.y=i.y+u);break;case SuperMap.Plot.AnnoPosition.LEFT:l.style.labelAlign="rm",e=L.latLng((s.getSouth()+s.getNorth())/2,s.getWest()),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(c.x=i.x-this._width*this.scale,c.y=i.y-this._height*this.scale/2,y.x=i.x,y.y=i.y+this._height*this.scale/2):(c.x=i.x,c.y=i.y+this._height*this.scale/2,y.x=i.x-this._width*this.scale,y.y=i.y-this._height*this.scale/2):l.title[0]?(l.path||l.title[0])&&(c.x=i.x-(a>r?a:r),c.y=i.y-(u+p)/2,y.x=i.x,y.y=i.y+(u+p)/2):(c.x=i.x,c.y=i.y+u/2,y.x=i.x-a,y.y=i.y-u/2);break;case SuperMap.Plot.AnnoPosition.RIGHT:l.style.labelAlign="lm",e=L.latLng((s.getSouth()+s.getNorth())/2,s.getEast()),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(c.x=i.x,c.y=i.y-this._height*this.scale/2,y.x=i.x+this._width*this.scale,y.y=i.y+this._height*this.scale/2):(c.x=i.x,c.y=i.y+this._height*this.scale/2,y.x=i.x+this._width*this.scale,y.y=i.y-this._height*this.scale/2):l.title[0]?(l.path||l.title[0])&&(c.x=i.x,c.y=i.y-(u+p)/2,y.x=i.x+(a>r?a:r),y.y=i.y+(u+p)/2):(c.x=i.x,c.y=i.y+u/2,y.x=i.x+a,y.y=i.y-u/2);break;case SuperMap.Plot.AnnoPosition.ANCHOR:l.style.labelAlign="lm",e=L.latLng(h.lat,h.lng),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?(l.style.labelAlign="lm",l.title[0]?(l.path||l.title[0])&&(c.x=i.x-this._width/2*this.scale,c.y=i.y+this._height*this.scale/2,y.x=i.x+this._width/2*this.scale,y.y=i.y-this._height*this.scale/2):(c.x=i.x-this._width/2*this.scale,c.y=i.y+this._height*this.scale/2,y.x=i.x+this._width/2*this.scale,y.y=i.y-this._height*this.scale/2)):(l.style.labelAlign="lm",l.title[0]?(l.path||l.title[0])&&(c.x=i.x,c.y=i.y+u/2+p/2,y.x=i.x+(a>=r?a:r),y.y=i.y-u/2-p/2):(c.x=i.x,c.y=i.y+u/2,y.x=i.x+a,y.y=i.y-u/2))}var g=this._map.layerPointToLatLng(i),f=this._map.latLngToLayerPoint(e),d=this._getMinDisPoint(c,y,f),m=this._map.layerPointToLatLng(d);if(!0===l.showRelationLine&&(0!==l.offsetX||0!==l.offsetY)){var S=l.lineStyle;null==l.lineStyle&&(S=SuperMap.Util.copyAttributes(S,this.style)),S.lineColorLimit=!0,S.lineTypeLimit=!0,S.lineWidthLimit=!0;var P=this._createAndDrawLayer(SuperMap.Plot.SymbolType.POLYLINESYMBOL,[m,e],S);P.isSymbolText=!0,P.fromZoom=this._map.getZoom(),n.push(P)}return{pixelRect1:c,pixelRect2:y,iComponents:n,controlPoint:g}},_calculateSpecialEffect:function(t){if(!0!==window.fromDestroyPlaySetStyle&&null!=this.specialEffects&&0!==this.specialEffects.length){null==t&&(t=this.latLngs[0]);for(var e=0;e<this.specialEffects.length;e++){var i=this.specialEffects[e];if(i){var o=this._createAndDrawSpecialEffect(t,i);null!=o&&(o.isSpecialEffect=!0,o.fromZoom=this._map.getZoom())}}}},_getMinDisPoint:function(t,e,i){var o=t,n={x:t.x,y:(t.y+e.y)/2},l={x:t.x,y:e.y},s={x:(t.x+e.x)/2,y:e.y},a={x:e.x,y:e.y},r={x:e.x,y:(t.y+e.y)/2},u={x:e.x,y:t.y},p={x:(t.x+e.x)/2,y:t.y},h=(i.x-o.x)*(i.x-o.x)+(i.y-o.y)*(i.y-o.y),c=(i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y),y=(i.x-l.x)*(i.x-l.x)+(i.y-l.y)*(i.y-l.y),g=(i.x-s.x)*(i.x-s.x)+(i.y-s.y)*(i.y-s.y),f=(i.x-a.x)*(i.x-a.x)+(i.y-a.y)*(i.y-a.y),d=(i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y),m=(i.x-u.x)*(i.x-u.x)+(i.y-u.y)*(i.y-u.y),S=(i.x-p.x)*(i.x-p.x)+(i.y-p.y)*(i.y-p.y),P=[];P.push(h),P.push(c),P.push(y),P.push(g),P.push(f),P.push(d),P.push(m),P.push(S);for(var b=P[0],v=0,L=1;L<P.length;L++)P[L]<b&&(b=P[L],v=L);return 0==v?o:1==v?n:2==v?l:3==v?s:4==v?a:5==v?r:6==v?u:7==v?p:null},_calculateTextPosition:function(t,e,i,o,n,l,s,a){var r=t.clone(),u=e.clone(),p=Math.abs(u.x-r.x),h=(Math.abs(u.y-r.y),o.paddingX,o.paddingY,L.point(0,0)),c=L.point(0,0);switch(i){case"lt":h.x=r.x,h.y=r.y,c.x=r.x,c.y=r.y+a;break;case"lm":h.x=r.x,h.y=r.y+a/2,c.x=r.x,c.y=r.y+l/2+a;break;case"lb":h.x=r.x,h.y=r.y+a,c.x=r.x,c.y=r.y+l+a;break;case"ct":h.x=r.x+p/2,h.y=r.y,c.x=r.x+p/2,c.y=r.y+a;break;case"cm":h.x=r.x+p/2,h.y=r.y+a/2,c.x=r.x+p/2,c.y=r.y+l/2+a;break;case"cb":h.x=r.x+p/2,h.y=r.y+a,c.x=r.x+p/2,c.y=r.y+l+a;break;case"rt":h.x=u.x,h.y=r.y,c.x=u.x,c.y=r.y+l/2+a;break;case"rm":h.x=u.x,h.y=r.y+a/2,c.x=u.x,c.y=r.y+l/2+a;break;case"rb":h.x=u.x,h.y=r.y+a,c.x=u.x,c.y=r.y+l+a}return{contentPt:this._map.layerPointToLatLng(c),titlePt:this._map.layerPointToLatLng(h)}},_getTextGraphic:function(t,e){var i=SuperMap.Plot.PlottingUtil.cloneObject(e);i.fontPercent=100,i.fontSpace=0,void 0!==this.flagTextSize?i.fontSize=this.flagTextSize:i.fontSize=60,i.labelAlign="cm";var o=document.createElement("canvas"),n=SuperMap.Plot.PlottingUtil.getTextWidth(i,t);o.width=n+20,o.height=parseFloat(i.fontSize)+10,document.body.appendChild(o);var l=o.getContext("2d");!0===i.fontStroke&&(l.strokeStyle=i.fontStrokeColor,l.setLineDash([]),l.lineWidth=i.fontStrokeWidth),l.fillStyle=i.fontColor,l.globalAlpha=i.fontOpacity;var s=[i.fontStyle?i.fontStyle:"normal","normal",i.fontWeight?i.fontWeight:"normal",i.fontSize?new String(i.fontSize)+"px":"1em",i.fontFamily?i.fontFamily:"sans-serif"].join(" ");if(l.fillText)l.font=s,l.textAlign="center",l.textBaseline="middle",!0===i.fontStroke&&l.strokeText(t,o.width/2,o.height/2),l.fillText(t,o.width/2,o.height/2);else if(l.mozDrawText){l.mozTextStyle=s;var a=-.5;L.PlotCanvas.LABEL_FACTOR[e.labelAlign[0]],null==a&&(a=-.5);var r=-.5;L.PlotCanvas.LABEL_FACTOR[e.labelAlign[1]],null==r&&(r=-.5);var u=[0,0],p=l.mozMeasureText("xx");u[1]+=p*(1+r*numRows);var h=u[0]+a*l.mozMeasureText(t),c=u[1]+p;l.translate(h,c),l.mozDrawText(t),l.translate(-h,-c)}var y=o.toDataURL("image/png","image/octet-stream");return document.body.removeChild(o),y},_transitionPoint:function(t,e){var i=e.x+t.x*(96/254),o=e.y-t.y*(96/254);return this._map.layerPointToLatLng(L.point(i,o))},_widthHeightLimitScale:function(){var t=this.initialScale.x,e=this.initialScale.y,i=this.anchorPoint.x,o=this.anchorPoint.y,n=(this.middleMarkBounds.left-i)*t+i,l=(this.middleMarkBounds.bottom-o)*e+o,s=(this.middleMarkBounds.right-i)*t+i,a=(this.middleMarkBounds.top-o)*e+o;return new SuperMap.Bounds(n,l,s,a)},_updateJoinLines:function(){if(null!==this.joinLines&&0<this.joinLines.length)for(var t=0;t<this.joinLines.length;t++){var e=this.joinLines[t];null!==e&&null!=e.layer&&(e instanceof Dh&&e.redraw())}},_mergeStyleToSymbolText:function(t){if(null!==this.components)for(var e in null!==t.style&&void 0!==t.style||(t.style={}),this.style)Object.prototype.hasOwnProperty.call(t.style,e)||(t.style[e]=this.style[e])},_resizeCells:function(t,e){for(var i=0;i<this.components.length;i++)L.Util.resizeLatLngs(this.components[i].getLatLngs(),e,t),this.components[i].setLatLngs(this.components[i].getLatLngs());this._renderer instanceof L.Canvas&&this._updateCanvasFills()},_rotate:function(t,e){xh.prototype._rotate.call(this,t,e),this.dRotate+=t},_resize:function(t,e){xh.prototype._resize.call(this,t,e),!0===this.limitWidthHeight?(this.initialScale.x*=t,this.symbolSize.w=this.initialScale.x*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale.x*this.symbolSizeInLib.h):(this.symbolSize.w=this.initialScale.x*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale.y*this.symbolSizeInLib.h),this.style.fontSize=this.fontSize*this.initialScale.x,this.prevFontSize=this.style.fontSize},_computeNegativeImage:function(t,e,i){for(var o=0;o<t.positionPoints.length;o++){var n=t.positionPoints[o];if(!SuperMap.Plot.PlottingUtil.isOnLine(n,e,i)){var l=SuperMap.Plot.PlottingUtil.pointProjectToSegment(n,e,i).projectPoint;n=SuperMap.Plot.PlottingUtil.rotateAngle(l,Math.PI,n)}t.positionPoints[o].x=n.x,t.positionPoints[o].y=n.y}},_setSymbolData:function(t){if(xh.prototype._setSymbolData.call(this,t),this.symbolData){Object.prototype.hasOwnProperty.call(this.symbolData,"type")||(this.symbolData.type="GRAPHICOBJECT"),this.symbolData.symbolRank=this.symbolRank,this.symbolData.negativeImage=this.negativeImage,this.symbolData.horizontalMirror=this.horizontalMirror,this.symbolData.verticalMirror=this.verticalMirror,this.symbolData.space=this.space,this.symbolData.flagTextSize=this.flagTextSize,this.symbolData.maxScale=this.maxScale,this.symbolData.minScale=this.minScale,this.symbolData.textDisplay=this.textDisplay,this.symbolData.initialScale=this.initialScale,this.symbolData.actualScale=this.actualScale,void 0!==this.fontSize&&(this.symbolData.fontSize=this.fontSize),void 0!==this.strokeWidth&&(this.symbolData.strokeWidth=this.strokeWidth);var e=25.4*this.symbolSize.w*10/96,i=25.4*this.symbolSize.h*10/96;this.symbolData.symbolSize={x:e,y:i};var o=25.4*this.symbolSizeInLib.w*10/96,n=25.4*this.symbolSizeInLib.h*10/96;this.symbolData.symbolSizeInLib={x:o,y:n},this.symbolData.positionOffset=this.positionOffset,this.symbolData.positionOffsetType=this.positionOffsetType,this.symbolData.positionOffsetX=this.positionOffsetX,this.symbolData.positionOffsetY=this.positionOffsetY}},_parseBasicData:function(){if(this.symbolName=this.symbolData.symbolName,void 0!==this.symbolData.symbolSizeInLib?(this.symbolSizeInLib.w=Math.round(96*this.symbolData.symbolSizeInLib.x/25.4/10),this.symbolSizeInLib.h=Math.round(96*this.symbolData.symbolSizeInLib.y/25.4/10)):void 0!==this.symbolData.symbolSize&&(this.symbolSizeInLib.w=Math.round(96*this.symbolData.symbolSize.x/25.4/10),this.symbolSizeInLib.h=Math.round(96*this.symbolData.symbolSize.y/25.4/10)),null===this.initialScale||isNaN(this.initialScale)||this.initialScale===1/0){var t=L.supermap.plotting.getControl(this.map,this.serverUrl).getDefaultStyle();if(t&&!0===t.defaultFlag&&this.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&-1!==t.dotSymbolSize){var e=this.symbolSizeInLib.w;if(this.symbolSizeInLib.h>this.symbolSizeInLib.w&&(e=this.symbolSizeInLib.h),0===e||0===t.dotSymbolSize)this.symbolSize.w=this.symbolSizeInLib.w,this.symbolSize.h=this.symbolSizeInLib.h;else if(0!==this.symbolSize.w||0===this.symbolData.symbolSize.x||0!==this.symbolSize.h||0===this.symbolData.symbolSize.y||this.minEditPts)if(0!==this.symbolSize.w||0!==this.symbolSize.h);else{var i=t.dotSymbolSize/e;this.symbolSize.w=i*this.symbolSizeInLib.w,this.symbolSize.h=i*this.symbolSizeInLib.h}else{this.symbolSize.w=96*this.symbolData.symbolSize.x/25.4/10,this.symbolSize.h=96*this.symbolData.symbolSize.y/25.4/10;var o=this.symbolSize.w/this.dScale/this.symbolSizeInLib.w,n=this.symbolSize.h/this.dScale/this.symbolSizeInLib.h;this.initialScale!==o?this.initialScale=o:this.initialScale!==n&&(this.initialScale=n),this.symbolSize.w=this.initialScale*this.dScale*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale*this.dScale*this.symbolSizeInLib.h}}var l=this.symbolSizeInLib.w,s=this.symbolSize.w;this.symbolSizeInLib.w<this.symbolSizeInLib.h&&(l=this.symbolSizeInLib.h,s=this.symbolSize.h),this.initialScale=s/l,this.symbolSize.w=this.initialScale*this.dScale*this.symbolSizeInLib.w,this.symbolSize.h=this.initialScale*this.dScale*this.symbolSizeInLib.h,(void 0===this.fontSize||isNaN(this.fontSize))&&(void 0===this.style.fontSize&&(this.style.fontSize=12),this.fontSize=this.style.fontSize/this.initialScale)}this.anchorPoint=new SuperMap.Geometry.Point(this.symbolData.anchorPoint.x,this.symbolData.anchorPoint.y),this.middleMarkBounds=new SuperMap.Bounds(this.symbolData.middleMarkBounds.leftBottom.x,this.symbolData.middleMarkBounds.leftBottom.y,this.symbolData.middleMarkBounds.rightTop.x,this.symbolData.middleMarkBounds.rightTop.y),this.symbolRank=this.symbolData.symbolRank,this.negativeImage=this.symbolData.negativeImage,this.horizontalMirror=this.symbolData.horizontalMirror,this.verticalMirror=this.symbolData.verticalMirror},_parseSymbolData:function(){if(xh.prototype._parseSymbolData.call(this),null!==this.symbolData){if(void 0!==this.symbolData.symbolSizeInLib?(this.symbolSizeInLib.w=Math.round(96*this.symbolData.symbolSizeInLib.x/25.4/10),this.symbolSizeInLib.h=Math.round(96*this.symbolData.symbolSizeInLib.y/25.4/10)):this.symbolData.innerCells&&(this.symbolSizeInLib.w=Math.round(96*this.symbolData.symbolSize.x/25.4/10),this.symbolSizeInLib.h=Math.round(96*this.symbolData.symbolSize.y/25.4/10)),this.symbolRank=this.symbolData.symbolRank,this.negativeImage=this.symbolData.negativeImage,this.horizontalMirror=this.symbolData.horizontalMirror,this.verticalMirror=this.symbolData.verticalMirror,void 0!==this.symbolData.anchorPoint&&(this.anchorPoint=new SuperMap.Geometry.Point(this.symbolData.anchorPoint.x,this.symbolData.anchorPoint.y)),void 0!==this.symbolData.middleMarkBounds&&null!==this.symbolData.middleMarkBounds&&(this.middleMarkBounds=new SuperMap.Bounds(this.symbolData.middleMarkBounds.leftBottom.x,this.symbolData.middleMarkBounds.leftBottom.y,this.symbolData.middleMarkBounds.rightTop.x,this.symbolData.middleMarkBounds.rightTop.y)),void 0!==this.symbolData.actualScale&&null!==this.symbolData.actualScale&&(this.actualScale=this.symbolData.actualScale),void 0!==this.symbolData.fontSize&&null!==this.symbolData.fontSize&&(this.fontSize=this.symbolData.fontSize),void 0!==this.symbolData.strokeWidth&&void 0!==this.symbolData.strokeWidth&&(this.strokeWidth=this.symbolData.strokeWidth),void 0!==this.symbolData.space&&null!==this.symbolData.space&&(this.space=this.symbolData.space),void 0!==this.symbolData.flagTextSize&&null!==this.symbolData.flagTextSize&&(this.flagTextSize=this.symbolData.flagTextSize),void 0!==this.symbolData.maxScale&&null!==this.symbolData.maxScale&&(this.maxScale=this.symbolData.maxScale),void 0!==this.symbolData.minScale&&null!==this.symbolData.minScale&&(this.minScale=this.symbolData.minScale),void 0!==this.symbolData.textDisplay&&null!==this.symbolData.textDisplay&&(this.textDisplay=this.symbolData.textDisplay),void 0!==this.symbolData.initialScale&&null!==this.symbolData.initialScale){this.initialScale=this.symbolData.initialScale;var t=this.initialScale*this.symbolSizeInLib.w*this.dScale,e=this.initialScale*this.symbolSizeInLib.h*this.dScale;this.symbolSize=new SuperMap.Size(t,e),this.symbolSize.w=t,this.symbolSize.h=e}else if(!1!==this.isEdit){var i=96*this.symbolData.symbolSize.x/25.4/10,o=96*this.symbolData.symbolSize.y/25.4/10;this.setSymbolSize(i,o)}void 0!==this.symbolData.positionOffset&&null!==this.symbolData.positionOffset&&(this.positionOffset=this.symbolData.positionOffset),void 0!==this.symbolData.positionOffsetType&&null!==this.symbolData.positionOffsetType&&(this.positionOffsetType=this.symbolData.positionOffsetType),void 0!==this.symbolData.positionOffsetX&&null!==this.symbolData.positionOffsetX&&(this.positionOffsetX=this.symbolData.positionOffsetX),void 0!==this.symbolData.positionOffsetY&&null!==this.symbolData.positionOffsetY&&(this.positionOffsetY=this.symbolData.positionOffsetY)}}}),Ny=function(t,e,i,o){return new Ry(t,e,i,o)};L.supermap.plotting.dotSymbol=Ny,L.supermap.plotting.DotSymbol=Ry;var By=xh.extend({path:null,img:null,symbolTexts:null,symbolTextComponents:null,bloodVolumes:null,bloodVolumeComponents:null,trajectory:null,antoRotation:null,specialEffects:null,specialEffectComponents:null,getPath:function(){return this.path},setPath:function(t,e,i){this.path=t,this.style.externalGraphic=t,this.style.graphicWidth=e,this.style.graphicHeight=i,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},getBloodVolumes:function(){return this.bloodVolumes},getSymbolTexts:function(){return this.symbolTexts},getSpecialEffects:function(){return this.specialEffectComponents},_addSpecialEffect:function(t){var e=t.effectType;(e==SuperMap.Plot.SpecialEffectType.AIM?t.viewUuid:e==SuperMap.Plot.SpecialEffectType.COMMUNICATIONLINK?t.senderUuid:t.associatedUuid)===this.uuid&&this.specialEffectComponents.push(t)},_removeSpecialEffect:function(t){for(var e=null,i=0;i<this.specialEffectComponents.length;i++)if(t.uuid==this.specialEffectComponents[i].uuid){e=i;break}this.specialEffectComponents.splice(e,1)},_updateSpecialEffect:function(t){for(var e=0;e<this.specialEffectComponents.length;e++)if(t.uuid==this.specialEffectComponents[e].uuid){this.specialEffectComponents[e].aId_=t.aId_;break}},removeSpecialEffect:function(t){for(var e=null,i=0;i<this.specialEffectComponents.length;i++)if(t.uuid==this.specialEffectComponents[i].uuid){e=i;break}this.specialEffectComponents[e].remove(),this.specialEffectComponents.splice(e,1)},setScale:function(t){isNaN(t)||(0==t&&(t=1e-10),this.style.graphicHeight*=t/this.initialScale.x,this.style.graphicWidth*=t/this.initialScale.x,this.initialScale.x=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getScale:function(){return this.initialScale.x},setRotate:function(t){isNaN(t)||(this.dRotate=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},setOpacity:function(t){this.style.graphicOpacity=t,this.redraw()},setOffset:function(t,e){this.style.graphicXOffset=0,this.style.graphicYOffset=0,this.redraw(),this.style.graphicXOffset=t,this.style.graphicYOffset=e,this.redraw()},setScaleByMap:function(t){this.scaleByMap=t,this.redraw()},getScaleByMap:function(){return this.scaleByMap},initialize:function(t,e,i,o){if(e==SuperMap.Plot.SymbolType.PICTURE||3e3==e?this.code=SuperMap.Plot.SymbolType.PICTURE:21==e?this.code=SuperMap.Plot.SymbolType.MODELPLOT:22==e&&(this.code=SuperMap.Plot.SymbolType.BOARD),o.symbolType?this.symbolType=o.symbolType:e==SuperMap.Plot.SymbolType.PICTURE||3e3==e?this.symbolType=SuperMap.Plot.SymbolType.PICTURE:21==e?this.symbolType=SuperMap.Plot.SymbolType.MODELPLOT:22==e&&(this.symbolType=SuperMap.Plot.SymbolType.BOARD),this.libID=0,o.symbolData)if(""===o.symbolData.symbolName||"模型"===o.symbolData.symbolName){var n=o.symbolData.picturePath.split("/");n=(n=n[n.length-1]).split(".")[0],this.symbolType==SuperMap.Plot.SymbolType.PICTURE?(this.symbolName=n+"图片",o.symbolData.symbolName=n+"图片"):this.symbolType==SuperMap.Plot.SymbolType.MODELPLOT&&(this.symbolName=n+"模型",o.symbolData.symbolName=n+"模型")}else this.symbolName=o.symbolData.symbolName;else this.symbolType==SuperMap.Plot.SymbolType.PICTURE?o.name?this.symbolName=o.name+"图片":this.symbolName="图片":this.symbolType==SuperMap.Plot.SymbolType.MODELPLOT&&(this.symbolName=o.name+"模型");this.minEditPts=1,this.maxEditPts=1,this.symbolTexts=[],this.bloodVolumes=[],this.specialEffects=[],this.symbolTextComponents=[],this.bloodVolumeComponents=[],this.specialEffectComponents=[],this._signUtils=[],this._symbolTextInit=!1,this.autoRotation=!1,null===this.path&&(o.symbolData?null!=o.symbolData.path&&""!=o.symbolData.path?this.path=o.symbolData.path:this.path="../img/marker.png":o.path?this.path=o.path:this.path="../img/marker.png"),null===this.img&&(this.img=o.img),null!==this.initialScale&&void 0!==this.initialScale||(this.initialScale={}),xh.prototype.initialize.call(this,t,e,i,o),null==this.path&&(this.path="../img/marker.png",3e3===this.code&&(this.code=20)),this.scaleByMap=null!=o.scaleByMap&&void 0!=o.scaleByMap&&o.scaleByMap,this.minScale=o.minScale?o.minScale:1,this.maxScale=o.maxScale?o.maxScale:5,this.initialScale.x||(this.initialScale.x=this.dScale),this.on("addSpecialEffect2Symbol",this._addSpecialEffect),this.on("removeSpecialEffectFromGeo",this._removeSpecialEffect),this.on("updateSpecialEffect",this._updateSpecialEffect)},_calculateParts:function(){if(!(this.getLatLngs().length<this.minEditPts||"none"===this.style.display||null!=this.layer&&"function"==typeof this.layer.getVisibility&&!1===this.layer.getVisibility())){var t=1;!0===this.layer.enableSymScale&&!0===this.scaleByMap&&"function"==typeof this.layer.getSymZoomScale&&(t=this.layer.getSymZoomScale(),null!=this.minScale&&t<this.minScale&&(t=this.minScale),null!=this.maxScale&&t>this.maxScale&&(t=this.maxScale));var e={surroundLineFlag:!1};this.style.externalGraphic=e.externalGraphic=this.style.externalGraphic?this.style.externalGraphic:this.path,this.style.graphicOpacity=e.graphicOpacity=this.style.graphicOpacity?this.style.graphicOpacity:1,this.style.graphicWidth=this.style.graphicWidth?this.style.graphicWidth:32,this.style.graphicHeight=this.style.graphicHeight?this.style.graphicHeight:32,e.graphicWidth=this.style.graphicWidth*t,e.graphicHeight=this.style.graphicHeight*t,e.rotation=-this.dRotate,this.style.graphicXOffset=e.graphicXOffset=this.style.graphicXOffset?this.style.graphicXOffset:0,this.style.graphicYOffset=e.graphicYOffset=this.style.graphicYOffset?this.style.graphicYOffset:0;var i={externalGraphic:e.externalGraphic,graphicWidth:e.graphicWidth,graphicHeight:e.graphicHeight,rotation:-this.dRotate,graphicXOffset:e.graphicXOffset,graphicYOffset:e.graphicYOffset,graphicOpacity:e.graphicOpacity,img:this.img},o=L.supermap.plotting.pointImage(L.Util.cloneLatLngs(this.getLatLngs()),i);this._addComponents(o),this._bounds=this.getBounds(),this._calculateLabel(),this._calculateBloodVolume(),this._calculateSpecialEffect()}},getBounds:function(){var t=new L.latLngBounds;if("none"!==this.style.display&&this.getLatLngs().length>0){var e=this._map.latLngToLayerPoint(this.getLatLngs()[0]);void 0==this.style.graphicXOffset&&(this.style.graphicXOffset=0),void 0==this.style.graphicYOffset&&(this.style.graphicYOffset=0),void 0==this.style.graphicWidth&&(this.style.graphicWidth=32),void 0==this.style.graphicHeight&&(this.style.graphicHeight=32);var i=.5*this.style.graphicWidth-this.style.graphicXOffset,o=.5*this.style.graphicHeight-this.style.graphicYOffset;0!=this.components.length&&this.components[0].options.graphicWidth&&(i=.5*this.components[0].options.graphicWidth,o=.5*this.components[0].options.graphicHeight);var n,l=L.point(e.x-i,e.y-o);n=L.point(e.x+i,e.y+o);var s=this._map.layerPointToLatLng(l),a=this._map.layerPointToLatLng(n);if(0!==this.dRotate){var r=[];r.push(new SuperMap.Geometry.Point(s.lng,s.lat)),r.push(new SuperMap.Geometry.Point(a.lng,s.lat)),r.push(new SuperMap.Geometry.Point(a.lng,a.lat)),r.push(new SuperMap.Geometry.Point(s.lng,a.lat));for(var u=null,p=null,h=null,c=null,y=this.dRotate*(Math.PI/180),g=0;g<r.length;g++){var f=e.x+this.style.graphicXOffset,d=e.y+this.style.graphicYOffset,m=this._map.layerPointToLatLng(L.point(f,d));SuperMap.Plot.PlottingUtil.rotateAngle(new SuperMap.Geometry.Point(m.lng,m.lat),y,r[g]),null==u?u=r[g].x:u>r[g].x&&(u=r[g].x),null==p?p=r[g].x:p<r[g].x&&(p=r[g].x),null==h?h=r[g].y:h>r[g].y&&(h=r[g].y),null==c?c=r[g].y:c<r[g].y&&(c=r[g].y)}t=L.latLngBounds(L.latLng(h,p),L.latLng(c,u))}else t=L.latLngBounds(s,a)}return t},setSymbolTextStyle:function(t){if(null!=t){this._symbolTextInit=!0;var e=[];e=t.index?[this.symbolTexts[index]]:this.symbolTexts;for(var i=0;i<e.length;i++){var o=e[i];if(null!=this._signUtils[i]){if(t.templateUrl&&(o.templateUrl=t.templateUrl,this._signUtils[i]._templateUrl=t.templateUrl),t.dom&&(o.domStr=t.dom,this._signUtils[i]._dom=t.dom),null!=t.signType&&void 0!=t.signType&&(o.signType=t.signType,this._signUtils[i]._signType=t.signType,this._signUtils[i]._isExist=!1),null!=t.signRenderMode&&void 0!=t.signRenderMode&&(o.signRenderMode=t.signRenderMode,this._signUtils[i]._signRenderMode=t.signRenderMode),null!=t.textPosition&&void 0!=t.textPosition&&(o.textPosition=t.textPosition),null!=t.signMode&&void 0!=t.signMode&&(o.signMode=t.signMode,this._signUtils[i]._signMode=t.signMode),t.texts)if(t.texts instanceof Array)o.texts=t.texts,this._signUtils[i]._texts=t.texts;else{var n=t.texts.split("\n");o.texts=n,this._signUtils[i]._texts=n}t.title&&(o.title=t.title,this._signUtils[i]._title=t.title),t.signImage&&(o.signImage=t.signImage,this._signUtils[i]._signImage=t.signImage),t.titleStyle&&this._signUtils[i]._setTitleStyle(t.titleStyle),t.titleFrameStyle&&this._signUtils[i]._setTitleFrameStyle(t.titleFrameStyle),t.textStyle&&(t.textIndex?this._signUtils[i]._setTextStyle(t.textStyle,t.textIndex):this._signUtils[i]._setTextStyle_(t.textStyle)),t.textStyles&&t.textStyles instanceof Array&&this._signUtils[i]._setTextStyles(t.textStyles),t.contentFrameStyle&&this._signUtils[i]._setContentFrameStyle(t.contentFrameStyle),t.trayStyle&&this._signUtils[i]._setTrayStyle(t.trayStyle),t.iconStyle&&this._signUtils[i]._setIconStyle(t.iconStyle),t.indecatorLineStyle&&(t.indecatorLineStyle.lineWidth&&(o.lineStyle.weight=t.indecatorLineStyle.lineWidth),t.indecatorLineStyle.lineColor&&(o.lineStyle.color=t.indecatorLineStyle.lineColor),t.indecatorLineStyle.lineSymbolID&&(o.lineStyle.lineSymbolID=t.indecatorLineStyle.lineSymbolID),t.indecatorLineStyle.opacity&&(o.lineStyle.opacity=t.indecatorLineStyle.opacity)),t.scale&&(isNaN(t.scale)||(0==t.scale&&(t.scale=1e-10),o.scale=t.scale)),t.offset&&(o.offsetX=t.offset.x,o.offsetY=t.offset.y),t.visible&&(o.visible=t.visible),t.symbolText&&(o=t.symbolText),this._images=null,this.redraw()}}}},getSymbolTextStyle:function(){for(var t=[],e=0;e<this._signUtils.length;e++)t.push(this._signUtils[e]._getOptions())},setSymbolText:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(this._symbolTextInit=!0,void 0==e)for(var i=0;i<this.symbolTexts.length;i++)this._signUtils[i]._isExist=!1,this.symbolTexts[i]=t;else for(var o=0;o<this.symbolTexts.length;o++)o==e&&(this._signUtils[o]._isExist=!1,this.symbolTexts[o]=t);this._images=null,this.redraw()},removeSymbolText:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!(t<0||t+1>this.symbolTexts.length)){if(void 0!=t)delete this._signUtils[t],this._signUtils.splice(t,1),delete this.symbolTexts[t],this.symbolTexts.splice(t,1);else for(var e=0;e<this.symbolTexts.length;e++)delete this._signUtils[t],this._signUtils.splice(t,1),delete this.symbolTexts[t],this.symbolTexts.splice(t,1);0==this.symbolTexts.length&&(this._symbolTextInit=!1),this._images=null,this.redraw()}},_calculateLabel:function(t,e){for(var i=0;i<this.components.length;)!0===this.components[i].isSymbolText?(null!=this.components[i]._renderer&&(this.components[i].removeEventParent(this),this.components[i].onRemove()),delete this.components[i],this.components.splice(i,1)):i++;if(this.symbolTextComponents.length=0,null!=this.symbolTexts&&0!==this.symbolTexts.length){var o={surroundLineFlag:!1,lineColorLimit:!0,fillColorLimit:!0,lineWidthLimit:!0,lineTypeLimit:!0,fontColorLimit:!0,fontSizeLimit:!0,fillLimit:!0};if(null==t&&(t=this.getBounds()),t&&t.isValid()){null==e&&(e=this.latLngs[0]);var n=1;"function"==typeof this.layer.getSymZoomScale&&(n=this.layer.getSymZoomScale()),null!=this.minScale&&n<this.minScale&&(n=this.minScale),null!=this.maxScale&&n>this.maxScale&&(n=this.maxScale);for(var l=0;l<this.symbolTexts.length;l++){var s=[];if(null!=this.symbolTexts[l].textContent&&0!==this.symbolTexts[l].textContent.length)if(null==this.symbolTexts[l].style||"none"!==this.symbolTexts[l].style.display){if(this.layer instanceof Uy){var a=this._map.getZoom();if(this.symbolTexts[l].minVisibleLevel>a||this.symbolTexts[l].maxVisibleLevel<a)continue;var r=this._map.getScale();if(0!=this.layer.markerMinVisibleScale&&this.layer.markerMinVisibleScale>r||0!=this.layer.markerMaxVisibleScale&&this.layer.markerMaxVisibleScale<r)continue}var u,p=this.symbolTexts[l];this._mergeStyleToSymbolText(p),p.textPosition=null==p.textPosition?0:p.textPosition,p.textContent instanceof Array?null==p.signType?(u=1===p.textContent.length?p.textContent[0].split("\n"):p.textContent,p._textContent=u):(u=p.textContent,p._textContent=p.textContent):(p.signType,u=p.textContent.split("\n"),p._textContent=u),p.title instanceof Array||(p.title=[p.title]),this._symbolTextInit||this._signUtils.push(this._init(p));var h=u.length,c=0,y=0,g=0,f=0,d=0;if(p.border||p.path){var m=SuperMap.Plot.PlottingUtil.cloneObject(p.style),S=SuperMap.Plot.PlottingUtil.cloneObject(p.style);m.fontSize*=n,S.fontSize=S.titleFontSize*n,S.fontFamily=S.titleFontFamily,c=SuperMap.Plot.PlottingUtil.getTextWidth(m,u[0])+p.paddingX*n*2,p.title[0]&&(d=g=SuperMap.Plot.PlottingUtil.getTextWidth(S,p.title[0])+p.paddingX*n*2);for(var P=1;P<h;P++){var b=SuperMap.Plot.PlottingUtil.getTextWidth(m,u[P])+p.paddingX*n*2;b>c&&(c=b)}SuperMap.Plot.PlottingUtil.getTextWidth(m,u[0])+p.paddingX*n*2,y=parseInt(p.style.fontSize*n*h)+p.paddingY*n*2,parseInt(p.style.fontSize*n*1),p.title[0]&&(f=parseInt(p.style.titleFontSize*n*1)+p.paddingY*n*2,g)}var v=L.point(0,0),M=L.point(0,0),_=SuperMap.Util.copyAttributes(o,p.style);if(null==p.signType&&2!=p.signMode&&3!=p.signMode){var A,T;0==p.signMode&&(c=0,y=0),p.image&&p.image.path&&(A=p.image.width?p.image.width:f,T=p.image.height?p.image.width:f,A>f&&(A=f),T>f&&(T=f),d=g+A);var x={scaleValue:n,iComponents:s,symbolText:p,symbolBounds:t,textWidth:c,textTitleWidth:d,textHeight:y,textTilteHeight:f},O=this._calculateLine(x);v=O.pixelRect1,M=O.pixelRect2;var w=v.x<M.x?v.x:M.x,C=v.y<M.y?v.y:M.y,E=v.x>M.x?v.x:M.x,I=v.y>M.y?v.y:M.y,D=L.point(w,C),U=L.point(E,I);p._bounds=L.bounds(D,U),s=O.iComponents;var R=O.controlPoint,N=SuperMap.Util.cloneObject(_);if(N.externalGraphic=void 0,p.path&&!p.border){var B=v.clone(),k=M.clone(),F=this._map.layerPointToLatLng(B),j=this._map.layerPointToLatLng(k);(o=SuperMap.Util.cloneObject(N)).opacity="0.0",o.fillOpacity="0.0";var V=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[F,j],o);V.isSymbolText=!0,V.fromZoom=this._map.getZoom(),s.push(V);var z=this._map.layerPointToLatLng(L.point(B.x,B.y)),Y={externalGraphic:p.path,graphicWidth:Math.abs(k.x-B.x),graphicHeight:k.y-B.y,rotation:0,graphicXOffset:0,graphicYOffset:0,graphicOpacity:1},G=this._createAndDrawLayer(SuperMap.Plot.SymbolType.PICTURE,[z],SuperMap.Util.cloneObject(N),null,Y);if(G.isSymbolText=!0,G.fromZoom=this._map.getZoom(),s.push(G),p.title[0]){(S=SuperMap.Util.cloneObject(N)).fontColor=S.titleColor,S.fontFamily=S.titleFontFamily,S.fontSize=S.titleFontSize,S.labelAlign=p.style.titleLabelAlign,S.fontBackground=!1;var W=this._calculateTextPosition(B,k,p.style.titleLabelAlign,p,c,y,g,f),X=this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,[W.titlePt],S,p.title[0]);X.isSymbolText=!0,X.fromZoom=this._map.getZoom(),s.push(X)}W=this._calculateTextPosition(B,k,p.style.contentLabelAlign,p,c,y,g,f);var H=SuperMap.Util.cloneObject(N);H.labelAlign=p.style.contentLabelAlign,H.fontBackground=!1;var Z=this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,[W.contentPt],H,p.textContent);Z.isSymbolText=!0,Z.fromZoom=this._map.getZoom(),s.push(Z)}if(p.border){var J=v.clone(),q=M.clone(),K=(F=this._map.layerPointToLatLng(J),j=this._map.layerPointToLatLng(q),this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[F,j],SuperMap.Util.cloneObject(N)));if(K.isSymbolText=!0,K.fromZoom=this._map.getZoom(),s.push(K),p.title[0]){(S=SuperMap.Util.cloneObject(N)).fontColor=S.titleColor,S.fontFamily=S.titleFontFamily,S.fontSize=S.titleFontSize,S.labelAlign=p.style.titleLabelAlign,S.fontBackground=!1;W=this._calculateTextPosition(D,U,p.style.titleLabelAlign,p,c,y,g,f);var Q=this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,[W.titlePt],S,p.title[0]);Q.isSymbolText=!0,Q.fromZoom=this._map.getZoom(),s.push(Q)}if(1==p.signMode&&void 0!==p.textContent&&null!==p.textContent&&""!==p.textContent){W=this._calculateTextPosition(D,U,p.style.contentLabelAlign,p,c,y,g,f);var $=SuperMap.Util.cloneObject(N);$.labelAlign=p.style.contentLabelAlign,$.fontBackground=!1;var tt=this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,[W.contentPt],$,p.textContent);tt.isSymbolText=!0,tt.fromZoom=this._map.getZoom(),s.push(tt)}if(p.image&&p.image.path&&g>0){var et,it;0==p.image.position?(et=w+(E-w-g)/2,it=C+f/2,x={externalGraphic:p.image.path,graphicWidth:A,graphicHeight:T,rotation:0,graphicXOffset:0,graphicYOffset:0,graphicOpacity:1}):1==p.image.position&&(et=w+(E-w-g)/2+g,it=C+f/2,x={externalGraphic:p.image.path,graphicWidth:A,graphicHeight:T,rotation:0,graphicXOffset:0,graphicYOffset:0,graphicOpacity:1});var ot=this._createAndDrawLayer(SuperMap.Plot.SymbolType.PICTURE,[this._map.layerPointToLatLng(L.point(et,it))],SuperMap.Util.cloneObject(N),null,x);ot.isSymbolText=!0,ot.fromZoom=this._map.getZoom(),s.push(ot)}}else if(!p.path){var nt=this._createAndDrawLayer(SuperMap.Plot.SymbolType.TEXTSYMBOL,[R],SuperMap.Util.cloneObject(N),p.textContent);nt.isSymbolText=!0,nt.fromZoom=this._map.getZoom(),s.push(nt)}this.symbolTextComponents.push(s)}else{if(0==p.signMode&&0===p.title.length)continue;if(1==p.signMode&&0===p.title.length&&0===p.textContent.length)continue;if(2==p.signMode&&!p.templateUrl&&!p.domStr)continue;if(3==p.signMode&&!p.signImage)continue;this._symbolStyle=_,this._symbolText=p,this._iComponents=s,this._scaleValue=n,this._symbolBounds=t,null==this._images||""==this._images||this._images instanceof String?(this.on("signsymbolcompleted",this._createSignSymbol),this._initSignSymbol(p,l)):s=this._createSignSymbol(!0)}}else this.symbolTextComponents.push(null)}}}},_init:function(t){var e={signType:t.signType,signMode:t.signMode,signRenderMode:t.signRenderMode,texts:t._textContent,title:t.title,templateUrl:t.templateUrl,dom:t.domStr,signImage:t.signImage,symbolText:t};return this._signUtil=L.supermap.plotting.signUtil(e),this._signUtil},_initSignSymbol:function(t,e){var i=this;this._signUtils[e]._generateImageData().then(function(e){switch(t.signRenderMode){case SuperMap.Plot.SignRenderMode.Billboard:e.toDataURL?(i._canvas=e,i._width=i._canvas.width,i._height=i._canvas.height,i._images=e.toDataURL("image/png"),i.fire("signsymbolcompleted")):(i._canvas=e.canvas,i._images=e.image,i._width=i._canvas.width,i._height=i._canvas.height,i.fire("signsymbolcompleted"));break;case SuperMap.Plot.SignRenderMode.DOM:}})},_addDivSignContent:function(t,e){this._domSignContent=document.createElement("div"),this._domSignContent.id="DivSignContent_"+SuperMap.Plot.PlottingUtil.generateUuid(),this._domSignContent.style.setProperty("position","fixed"),this._domSignContent.style.setProperty("z-index","9999"),t.appendChild(this._domSignContent);var i=null;i=e.toDataURL?e:e.canvas,this._domSignContent.appendChild(i),this._signMode!=SuperMap.Plot.SignMode.Simple&&this._signMode!=SuperMap.Plot.SignMode.Complex||(this._domSignContent.style.setProperty("width",i.width+"px"),this._domSignContent.style.setProperty("height",i.height+"px")),this._domSignContentWidth=this._domSignContent.offsetWidth,this._domSignContentHeight=this._domSignContent.offsetHeight},_createSignSymbol:function(t){this._symbolText.scale&&(this.scale=this._symbolText.signMode!=SuperMap.Plot.SignMode.Image?.5*this._symbolText.scale:this._symbolText.scale);var e=this._calculateLine({}),i=e.pixelRect1,o=e.pixelRect2,n=i.x<o.x?i.x:o.x,l=i.y<o.y?i.y:o.y,s=i.x>o.x?i.x:o.x,a=i.y>o.y?i.y:o.y,r=L.point(n,l),u=L.point(s,a);this._symbolText._bounds=L.bounds(r,u);var p=Math.abs(i.x-o.x),h=Math.abs(i.y-o.y),c=(i.x+o.x)/2,y=(i.y+o.y)/2,g=L.point(c,y),f=this._map.layerPointToLatLng(g);if(null==f)return null;if(this._symbolText.signRenderMode==SuperMap.Plot.SignRenderMode.DOM)this._domSign&&document.body.removeChild(this._domSign),this._domSign=document.createElement("div"),this._domSign.id="DivSign"+SuperMap.Plot.PlottingUtil.generateUuid(),this._domSign.style.setProperty("position","fixed"),document.body.appendChild(this._domSign),this._addDivSignContent(this._domSign,this._canvas);else{var d={externalGraphic:this._images,externalCanvas:this._canvas,graphicWidth:p,graphicHeight:h,rotation:0,graphicXOffset:0,graphicYOffset:0,graphicOpacity:1,fillOpacity:0,isSignSymbol:!0},m=SuperMap.Util.cloneObject(this._symbolStyle);m.graphicWidth=void 0,m.graphicHeight=void 0,m.externalGraphic=void 0;var S=this._createAndDrawLayer(SuperMap.Plot.SymbolType.PICTURE,[f],m,null,d);S.isSymbolText=!0,S.fromZoom=this._map.getZoom(),this._iComponents.push(S),null==this._images&&this.off("signsymbolcompleted",this._createSignSymbol),this.symbolTextComponents.push(this._iComponents),this.layer&&this.layer instanceof gy&&null!=this.graphic&&null!=this.graphic._image&&null!=this.graphic._image.bounds&&(this.graphic._image._drawSymbolText(),"boolean"!=typeof t||t?"boolean"!=typeof t&&this.graphic.update():this.graphic.update())}},_calculateLine:function(t){var e,i,o=t.scaleValue?t.scaleValue:this._scaleValue,n=t.iComponents?t.iComponents:this._iComponents,l=t.symbolText?t.symbolText:this._symbolText,s=t.symbolBounds?t.symbolBounds:this._symbolBounds,a=t.textWidth,r=t.textTitleWidth,u=t.textHeight,p=t.textTilteHeight,h=L.point(0,0),c=L.point(0,0);switch(l.textPosition){case SuperMap.Plot.AnnoPosition.LEFTTOP:l.style.labelAlign="rb",e=L.latLng(s.getNorth(),s.getWest()),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(h.x=i.x-this._width*this.scale,h.y=i.y-this._height*this.scale,c.x=i.x,c.y=i.y):(h.x=i.x,h.y=i.y,c.x=i.x-this._width*this.scale,c.y=i.y-this._height*this.scale):l.title[0]?(l.path||l.title[0])&&(h.x=i.x-a-r,h.y=i.y-u-p,c.x=i.x,c.y=i.y):(h.x=i.x,h.y=i.y,c.x=i.x-a,c.y=i.y-u);break;case SuperMap.Plot.AnnoPosition.LEFTBOTTOM:l.style.labelAlign="rt",e=L.latLng(s.getSouth(),s.getWest()),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(h.x=i.x-this._width*this.scale,h.y=i.y,c.x=i.x,c.y=i.y+this._height*this.scale):(h.x=i.x,h.y=i.y,c.x=i.x-this._width*this.scale,c.y=i.y+this._height*this.scale):l.title[0]?(l.path||l.title[0])&&(h.x=i.x-a-r,h.y=i.y,c.x=i.x,c.y=i.y+u+p):(h.x=i.x,h.y=i.y,c.x=i.x-a,c.y=i.y+u);break;case SuperMap.Plot.AnnoPosition.RIGHTTOP:l.style.labelAlign="lb",e=L.latLng(s.getNorth(),s.getEast()),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(h.x=i.x,h.y=i.y-this._height*this.scale,c.x=i.x+this._width*this.scale,c.y=i.y):(h.x=i.x,h.y=i.y,c.x=i.x+this._width*this.scale,c.y=i.y-this._height*this.scale):l.title[0]?(l.path||l.title[0])&&(h.x=i.x,h.y=i.y-u-p,c.x=i.x+a+r,c.y=i.y):(h.x=i.x,h.y=i.y,c.x=i.x+a,c.y=i.y-u);break;case SuperMap.Plot.AnnoPosition.RIGHTBOTTOM:l.style.labelAlign="lt",e=L.latLng(s.getSouth(),s.getEast()),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(h.x=i.x,h.y=i.y,c.x=i.x+this._width*this.scale,c.y=i.y+this._height*this.scale):(h.x=i.x,h.y=i.y,c.x=i.x+this._width*this.scale,c.y=i.y+this._height*this.scale):l.title[0]?(l.path||l.title[0])&&(h.x=i.x,h.y=i.y,c.x=i.x+a+r,c.y=i.y+u+p):(h.x=i.x,h.y=i.y,c.x=i.x+a,c.y=i.y+u);break;case SuperMap.Plot.AnnoPosition.TOP:l.style.labelAlign="cb",e=L.latLng(s.getNorth(),(s.getWest()+s.getEast())/2),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(h.x=i.x-this._width*this.scale/2,h.y=i.y-this._height*this.scale,c.x=i.x+this._width*this.scale/2,c.y=i.y):(h.x=i.x-this._width*this.scale/2,h.y=i.y,c.x=i.x+this._width*this.scale/2,c.y=i.y-this._height*this.scale):l.title[0]?(l.path||l.title[0])&&(h.x=i.x-(a>r?a:r)/2,h.y=i.y-u-p,c.x=i.x+(a>r?a:r)/2,c.y=i.y):(h.x=i.x-a/2,h.y=i.y,c.x=i.x+a/2,c.y=i.y-u);break;case SuperMap.Plot.AnnoPosition.BOTTOM:l.style.labelAlign="ct",e=L.latLng(s.getSouth(),(s.getWest()+s.getEast())/2),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(h.x=i.x-this._width*this.scale/2,h.y=i.y,c.x=i.x+this._width*this.scale/2,c.y=i.y+this._height*this.scale):(h.x=i.x-this._width*this.scale/2,h.y=i.y,c.x=i.x+this._width*this.scale/2,c.y=i.y+this._height*this.scale):l.title[0]?(l.path||l.title[0])&&(h.x=i.x-(a>r?a:r)/2,h.y=i.y,c.x=i.x+(a>r?a:r)/2,c.y=i.y+u+p):(h.x=i.x-a/2,h.y=i.y,c.x=i.x+a/2,c.y=i.y+u);break;case SuperMap.Plot.AnnoPosition.LEFT:l.style.labelAlign="rm",e=L.latLng((s.getSouth()+s.getNorth())/2,s.getWest()),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(h.x=i.x-this._width*this.scale,h.y=i.y-this._height*this.scale/2,c.x=i.x,c.y=i.y+this._height*this.scale/2):(h.x=i.x,h.y=i.y+this._height*this.scale/2,c.x=i.x-this._width*this.scale,c.y=i.y-this._height*this.scale/2):l.title[0]?(l.path||l.title[0])&&(h.x=i.x-(a>r?a:r),h.y=i.y-(u+p)/2,c.x=i.x,c.y=i.y+(u+p)/2):(h.x=i.x,h.y=i.y+u/2,c.x=i.x-a,c.y=i.y-u/2);break;case SuperMap.Plot.AnnoPosition.RIGHT:l.style.labelAlign="lm",e=L.latLng((s.getSouth()+s.getNorth())/2,s.getEast()),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?l.title[0]?(l.path||l.title[0])&&(h.x=i.x,h.y=i.y-this._height*this.scale/2,c.x=i.x+this._width*this.scale,c.y=i.y+this._height*this.scale/2):(h.x=i.x,h.y=i.y+this._height*this.scale/2,c.x=i.x+this._width*this.scale,c.y=i.y-this._height*this.scale/2):l.title[0]?(l.path||l.title[0])&&(h.x=i.x,h.y=i.y-(u+p)/2,c.x=i.x+(a>r?a:r),c.y=i.y+(u+p)/2):(h.x=i.x,h.y=i.y+u/2,c.x=i.x+a,c.y=i.y-u/2);break;case SuperMap.Plot.AnnoPosition.ANCHOR:l.style.labelAlign="lm",e=L.latLng(latLng.lat,latLng.lng),(i=this._map.latLngToLayerPoint(e)).x+=l.offsetX*o,i.y+=l.offsetY*o,null!=l.signType||0!=l.signMode&&1!=l.signMode?(l.style.labelAlign="lm",l.title[0]?(l.path||l.title[0])&&(h.x=i.x-this._width/2*this.scale,h.y=i.y+this._height*this.scale/2,c.x=i.x+this._width/2*this.scale,c.y=i.y-this._height*this.scale/2):(h.x=i.x-this._width/2*this.scale,h.y=i.y+this._height*this.scale/2,c.x=i.x+this._width/2*this.scale,c.y=i.y-this._height*this.scale/2)):(l.style.labelAlign="lm",l.title[0]?(l.path||l.title[0])&&(h.x=i.x,h.y=i.y+u/2+p/2,c.x=i.x+(a>=r?a:r),c.y=i.y-u/2-p/2):(h.x=i.x,h.y=i.y+u/2,c.x=i.x+a,c.y=i.y-u/2))}var y=this._map.layerPointToLatLng(i),g=this._map.latLngToLayerPoint(e),f=this._getMinDisPoint(h,c,g),d=this._map.layerPointToLatLng(f);if(!0===l.showRelationLine&&(0!==l.offsetX||0!==l.offsetY)){var m=l.lineStyle;null==l.lineStyle&&(m=SuperMap.Util.copyAttributes(m,this.style)),m.lineColorLimit=!0,m.lineTypeLimit=!0,m.lineWidthLimit=!0;var S=this._createAndDrawLayer(SuperMap.Plot.SymbolType.POLYLINESYMBOL,[d,e],m);S.isSymbolText=!0,S.fromZoom=this._map.getZoom(),n.push(S)}return{pixelRect1:h,pixelRect2:c,iComponents:n,controlPoint:y}},_getMinDisPoint:function(t,e,i){var o=t,n={x:t.x,y:(t.y+e.y)/2},l={x:t.x,y:e.y},s={x:(t.x+e.x)/2,y:e.y},a={x:e.x,y:e.y},r={x:e.x,y:(t.y+e.y)/2},u={x:e.x,y:t.y},p={x:(t.x+e.x)/2,y:t.y},h=(i.x-o.x)*(i.x-o.x)+(i.y-o.y)*(i.y-o.y),c=(i.x-n.x)*(i.x-n.x)+(i.y-n.y)*(i.y-n.y),y=(i.x-l.x)*(i.x-l.x)+(i.y-l.y)*(i.y-l.y),g=(i.x-s.x)*(i.x-s.x)+(i.y-s.y)*(i.y-s.y),f=(i.x-a.x)*(i.x-a.x)+(i.y-a.y)*(i.y-a.y),d=(i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y),m=(i.x-u.x)*(i.x-u.x)+(i.y-u.y)*(i.y-u.y),S=(i.x-p.x)*(i.x-p.x)+(i.y-p.y)*(i.y-p.y),P=[];P.push(h),P.push(c),P.push(y),P.push(g),P.push(f),P.push(d),P.push(m),P.push(S);for(var b=P[0],v=0,L=1;L<P.length;L++)P[L]<b&&(b=P[L],v=L);return 0==v?o:1==v?n:2==v?l:3==v?s:4==v?a:5==v?r:6==v?u:7==v?p:null},_calculateTextPosition:function(t,e,i,o,n,l,s,a){var r=t.clone(),u=e.clone(),p=Math.abs(u.x-r.x),h=(Math.abs(u.y-r.y),o.paddingX,o.paddingY,L.point(0,0)),c=L.point(0,0);switch(i){case"lt":h.x=r.x,h.y=r.y,c.x=r.x,c.y=r.y+a;break;case"lm":h.x=r.x,h.y=r.y+a/2,c.x=r.x,c.y=r.y+l/2+a;break;case"lb":h.x=r.x,h.y=r.y+a,c.x=r.x,c.y=r.y+l+a;break;case"ct":h.x=r.x+p/2,h.y=r.y,c.x=r.x+p/2,c.y=r.y+a;break;case"cm":h.x=r.x+p/2,h.y=r.y+a/2,c.x=r.x+p/2,c.y=r.y+l/2+a;break;case"cb":h.x=r.x+p/2,h.y=r.y+a,c.x=r.x+p/2,c.y=r.y+l+a;break;case"rt":h.x=u.x,h.y=r.y,c.x=u.x,c.y=r.y+l/2+a;break;case"rm":h.x=u.x,h.y=r.y+a/2,c.x=u.x,c.y=r.y+l/2+a;break;case"rb":h.x=u.x,h.y=r.y+a,c.x=u.x,c.y=r.y+l+a}return{contentPt:this._map.layerPointToLatLng(c),titlePt:this._map.layerPointToLatLng(h)}},_calculateSpecialEffect:function(t){if(!0!==window.fromDestroyPlaySetStyle&&null!=this.specialEffects&&0!==this.specialEffects.length){null==t&&(t=this.latLngs[0]);for(var e=0;e<this.specialEffects.length;e++){var i=this.specialEffects[e];if(i){var o=this._createAndDrawSpecialEffect(t,i);null!=o&&(o.isSpecialEffect=!0,o.fromZoom=this._map.getZoom())}}}},_calculateBloodVolume:function(t,e){for(var i=0;i<this.components.length;)!0===this.components[i].isBloodVolume?(null!=this.components[i]._renderer&&(this.components[i].removeEventParent(this),this.components[i].onRemove()),delete this.components[i],this.components.splice(i,1)):i++;if(this.bloodVolumeComponents.length=0,!(this.getLatLngs().length<this.minEditPts)&&null!=this.bloodVolumes&&0!==this.bloodVolumes.length){null==t&&(t=this.getBounds()),null==e&&(e=this.getLatLngs()[0]);for(var o=this._map.latLngToLayerPoint(e),n=0;n<this.bloodVolumes.length;n++){var l=[],s=null;if(null!=this.bloodVolumes[n].width)s=Math.abs(this._map.layerPointToLatLng(L.point(o.x+this.bloodVolumes[n].width,o.y)).lng-e.lng);else{var a=Math.abs(this._map.layerPointToLatLng(L.point(o.x+40,o.y)).lng-e.lng);(s=Math.abs(t.getEast()-t.getWest()))<a&&(s=a)}var r,u,p=null;if(null!=this.bloodVolumes[n].height)p=Math.abs(this._map.layerPointToLatLng(L.point(o.x,o.y+this.bloodVolumes[n].height)).lat-e.lat);else{p=Math.abs(this._map.layerPointToLatLng(L.point(o.x,o.y+8)).lat-e.lat)}if(this.bloodVolumes[n].position===SuperMap.Plot.Position.TOP){var h=L.latLng(t.getNorth(),t.getCenter().lng),c=this._map.latLngToLayerPoint(h);c.x+=this.bloodVolumes[n].offsetX,c.y+=this.bloodVolumes[n].offsetY,h=this._map.layerPointToLatLng(c),r=L.latLng(h.lat+p,h.lng-.5*s),u=L.latLng(h.lat,h.lng+.5*s)}else if(this.bloodVolumes[n].position===SuperMap.Plot.Position.BOTTOM){var y=L.latLng(t.getSouth(),t.getCenter().lng),g=this._map.latLngToLayerPoint(y);g.x+=this.bloodVolumes[n].offsetX,g.y+=this.bloodVolumes[n].offsetY,y=this._map.layerPointToLatLng(g),r=L.latLng(y.lat,y.lng-.5*s),u=L.latLng(y.lat-p,y.lng+.5*s)}else if(this.bloodVolumes[n].position===SuperMap.Plot.Position.LEFT){var f=L.latLng(t.getCenter().lat,t.getWest()),d=this._map.latLngToLayerPoint(f);d.x+=this.bloodVolumes[n].offsetX,d.y+=this.bloodVolumes[n].offsetY,f=this._map.layerPointToLatLng(d),r=L.latLng(f.lat+.5*s,f.lng-p),u=L.latLng(f.lat-.5*s,f.lng)}else if(this.bloodVolumes[n].position===SuperMap.Plot.Position.RIGHT){var m=L.latLng(t.getCenter().lat,t.getEast()),S=this._map.latLngToLayerPoint(m);S.x+=this.bloodVolumes[n].offsetX,S.y+=this.bloodVolumes[n].offsetY,m=this._map.layerPointToLatLng(S),r=L.latLng(m.lat+.5*s,m.lng),u=L.latLng(m.lat-.5*s,m.lng+p)}var P=this.bloodVolumes[n].style.color;null==P&&(P="#808080");var b=this.bloodVolumes[n].style.weight;null==b&&(b=4);var v=this.bloodVolumes[n].style.opacity;null==v&&(v=1);var M=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[r,u],{fillLimit:!0,fillSymbolID:1,lineWidthLimit:!0,weight:b,lineColorLimit:!0,color:P,opacity:v});M.isBloodVolume=!0,M.fromZoom=this._map.getZoom(),l.push(M);var _=this.bloodVolumes[n].style.remainingVolumeColor;null==_&&(_="#00ff00");var A=this.bloodVolumes[n].style.remainingVolumeOpacity;null==A&&(A=.8);var T=this.bloodVolumes[n].style.consumeVolumeColor;null==T&&(T="#000000");var x=this.bloodVolumes[n].style.consumeVolumeOpacity;null==x&&(x=.8);var O=this.components[this.components.length-1].getBounds();if(this.bloodVolumes[n].position===SuperMap.Plot.Position.TOP||this.bloodVolumes[n].position===SuperMap.Plot.Position.BOTTOM){if(!SuperMap.Plot.PlottingUtil.equalFuzzy(0,this.bloodVolumes[n].volume)){var w=O.getNorthWest(),C=L.latLng(O.getSouthEast().lat,w.lng+this.bloodVolumes[n].volume*s),E=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[w,C],{fillLimit:!0,fillSymbolID:0,fillColorLimit:!0,fillColor:_,fillOpacity:A,lineColorLimit:!0,opacity:0});E.isBloodVolume=!0,E.fromZoom=this._map.getZoom(),l.push(E)}if(!SuperMap.Plot.PlottingUtil.equalFuzzy(1,this.bloodVolumes[n].volume)){var I=O.getSouthEast(),D=L.latLng(O.getNorthWest().lat,O.getNorthWest().lng+this.bloodVolumes[n].volume*s),U=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[I,D],{fillLimit:!0,fillSymbolID:0,fillColorLimit:!0,fillColor:T,fillOpacity:x,lineColorLimit:!0,opacity:0});U.isBloodVolume=!0,U.fromZoom=this._map.getZoom(),l.push(U)}}else if(this.bloodVolumes[n].position===SuperMap.Plot.Position.LEFT){if(!SuperMap.Plot.PlottingUtil.equalFuzzy(0,this.bloodVolumes[n].volume)){var R=O.getSouthWest(),N=L.latLng(R.lat+this.bloodVolumes[n].volume*s,O.getNorthEast().lng),B=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[R,N],{fillLimit:!0,fillSymbolID:0,fillColorLimit:!0,fillColor:_,fillOpacity:A,lineColorLimit:!0,opacity:0});B.isBloodVolume=!0,B.fromZoom=this._map.getZoom(),l.push(B)}if(!SuperMap.Plot.PlottingUtil.equalFuzzy(1,this.bloodVolumes[n].volume)){var k=O.getNorthEast(),F=L.latLng(O.getSouthWest().lat+this.bloodVolumes[n].volume*s,O.getSouthWest().lng),j=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[k,F],{fillLimit:!0,fillSymbolID:0,fillColorLimit:!0,fillColor:T,fillOpacity:x,lineColorLimit:!0,opacity:0});j.isBloodVolume=!0,j.fromZoom=this._map.getZoom(),l.push(j)}}else if(this.bloodVolumes[n].position===SuperMap.Plot.Position.RIGHT){if(!SuperMap.Plot.PlottingUtil.equalFuzzy(0,this.bloodVolumes[n].volume)){var V=O.getNorthEast(),z=L.latLng(V.lat-this.bloodVolumes[n].volume*s,O.getSouthWest().lng),Y=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[V,z],{fillLimit:!0,fillSymbolID:0,fillColorLimit:!0,fillColor:_,fillOpacity:A,lineColorLimit:!0,opacity:0});Y.isBloodVolume=!0,Y.fromZoom=this._map.getZoom(),l.push(Y)}if(!SuperMap.Plot.PlottingUtil.equalFuzzy(1,this.bloodVolumes[n].volume)){var G=O.getSouthWest(),W=L.latLng(O.getNorthEast().lat-this.bloodVolumes[n].volume*s,O.getNorthEast().lng),X=this._createAndDrawLayer(SuperMap.Plot.SymbolType.RECTANGLESYMBOL,[G,W],{fillLimit:!0,fillSymbolID:0,fillColorLimit:!0,fillColor:T,fillOpacity:x,lineColorLimit:!0,opacity:0});X.isBloodVolume=!0,X.fromZoom=this._map.getZoom(),l.push(X)}}this.bloodVolumeComponents.push(l)}}},move:function(t,e){xh.prototype._move.call(this,t,e)},_mergeStyleToSymbolText:function(t){if(null!==this.components)for(var e in null!==t.style&&void 0!==t.style||(t.style={}),this.style)Object.prototype.hasOwnProperty.call(t.style,e)||(t.style[e]=this.style[e])},_reView:function(){if(this.fromZoom!==this._map.getZoom()){if(!0===this.scaleByMap)if(!0===this.layer.enableSymScale){var t=1;"function"==typeof this.layer.getSymZoomScale&&(t=this.layer.getSymZoomScale()),null!=this.maxScale&&t>this.maxScale&&(t=this.maxScale),null!=this.minScale&&t<this.minScale&&(t=this.minScale),this.components.length>0&&(this.components[0].options.graphicHeight=this.style.graphicHeight*t,this.components[0].options.graphicWidth=this.style.graphicWidth*t)}else void 0===this.actualScale&&(this.actualScale=this.dScale),void 0===this.prevScale&&(this.prevScale=this.dScale),null!=this.maxScale&&this.actualScale>this.maxScale?this.dScale=this.maxScale:null!=this.minScale&&this.actualScale<this.minScale?this.dScale=this.minScale:this.dScale=this.actualScale,this.components.length>0&&(this.style.graphicHeight=this.style.graphicHeight/this.prevScale*this.dScale,this.style.graphicWidth=this.style.graphicWidth/this.prevScale*this.dScale,this.components[0].options.graphicHeight=this.style.graphicHeight,this.components[0].options.graphicWidth=this.style.graphicWidth),this.prevScale=this.dScale;this._calculateLabel(),this._calculateBloodVolume(),21==this.symbolType&&(null!=this._annotationId&&-1!==this._annotationId&&(null!=this.components[this._annotationId]._renderer&&(this.components[this._annotationId].removeEventParent(this),this.components[this._annotationId].onRemove()),delete this.components[this._annotationId],this.components.splice(this._annotationId,1),this._annotationId=-1),this._handleAnnotation()),this.fromZoom=this._map.getZoom()}0!=this.components.length&&this.components[0].redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)}});L.supermap.plotting.picture=function(t,e,i,o){return new By(t,e,i,o)},L.supermap.plotting.Picture=By;var ky=Eh.extend({centerPoint:null,radius:null,startAngle:null,endAngle:null,textPosition:null,radiusText:null,radiusPosAngle:null,radiusLineType:null,subSymbolDefaultPixelSize:15,getCirclePts:function(){return this.getArcPts(this.startAngle,this.endAngle)},setLatLngs:function(t){return this.latLngs=t,2===this.latLngs.length&&(this.centerPoint=this.latLngs[0],this.radius=SuperMap.Plot.PlottingUtil.distVincenty(this.latLngs[0],this.latLngs[1])),3===this.latLngs.length&&(this.startAngle=180*SuperMap.Plot.PlottingUtil.radian(new SuperMap.Geometry.Point(this.latLngs[0].lng,this.latLngs[0].lat),new SuperMap.Geometry.Point(this.latLngs[1].lng,this.latLngs[1].lat))/Math.PI,this.endAngle=180*SuperMap.Plot.PlottingUtil.radian(new SuperMap.Geometry.Point(this.latLngs[0].lng,this.latLngs[0].lat),new SuperMap.Geometry.Point(this.latLngs[2].lng,this.latLngs[2].lat))/Math.PI),this.redraw()},setRadius:function(t){this.radius!==t&&(this.radius=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getRadius:function(){return this.radius},setStartAngle:function(t){this.startAngle!==t&&(this.startAngle=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getStartAngle:function(){return this.startAngle},setEndAngle:function(t){this.endAngle!==t&&(this.endAngle=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getEndAngle:function(){return this.endAngle},setTextPosition:function(t){this.textPosition!==t&&(this.textPosition=t,0!==this.textContent.length&&(this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)))},setRadiusText:function(t,e){e>1&&(e=1),e<0&&(e=0),this.radiusText[e]!==t&&(this.radiusText[e]=t,this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getRadiusText:function(t){return t>1&&(t=1),t<0&&(t=0),this.radiusText[t]},setRadiusTextPos:function(t){this.radiusPosAngle!==t&&(this.radiusPosAngle=t,0!==this.radiusText.length&&(this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)))},getRadiusTextPos:function(){return this.radiusPosAngle},setRadiusLineType:function(t){this.radiusLineType!==t&&(this.radiusLineType=t,0!==this.radiusText.length&&(this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)))},getRadiusLineType:function(){return this.radiusLineType},initialize:function(t,e,i,o){this.scalePoints=[],this.scaleValues=[],xh.prototype.initialize.call(this,t,e,i,o),this.libID=0,this.code=SuperMap.Plot.SymbolType.ARCREGION,this.symbolType=SuperMap.Plot.SymbolType.ARCREGION,this.symbolName="扇形区域",this.minEditPts=2,this.maxEditPts=3,null===this.circlePts&&(this.circlePts=[]),null===this.textPosition&&(this.textPosition=(this.startAngle+this.endAngle)/2),null===this.radiusText&&(this.radiusText=[]),null===this.radiusPosAngle&&(this.radiusPosAngle=(this.startAngle+this.endAngle)/2),null===this.radiusLineType&&(this.radiusLineType=SuperMap.Plot.RadiusLineType.NONE),void 0!==o.constantSize&&null!==o.constantSize||!1!==this.isEdit||(this.constantSize=!0),this.subSymbolDefaultPixelSize=15,0===this.scaleValues.length&&this.scaleValues.push(.1)},destroy:function(){this.centerPoint=null,this.radius=null,this.startAngle=null,this.endAngle=null,this.textPosition=null,this.radiusText=null,this.radiusPosAngle=null,this.radiusLineType=null,Eh.prototype.destroy.call(this)},_calculateParts:function(){if(this.scalePoints=[],this.isEdit?1===this.latLngs.length&&this.centerPoint!==this.latLngs[0]&&(this.centerPoint=this.latLngs[0]):(2===this.latLngs.length&&(this.centerPoint=this.latLngs[0],this.radius=SuperMap.Plot.PlottingUtil.distVincenty(this.latLngs[0],this.latLngs[1])),3===this.latLngs.length&&(this.startAngle=180*SuperMap.Plot.PlottingUtil.radian(new SuperMap.Geometry.Point(this.latLngs[0].lng,this.latLngs[0].lat),new SuperMap.Geometry.Point(this.latLngs[1].lng,this.latLngs[1].lat))/Math.PI,this.endAngle=180*SuperMap.Plot.PlottingUtil.radian(new SuperMap.Geometry.Point(this.latLngs[0].lng,this.latLngs[0].lat),new SuperMap.Geometry.Point(this.latLngs[2].lng,this.latLngs[2].lat))/Math.PI)),this.centerPoint&&null!==this.centerPoint&&this.radius&&null!==this.radius){this.startAngle%=360,this.endAngle%=360,this.startAngle>this.endAngle&&(this.endAngle+=360);var t=SuperMap.Plot.PlottingUtil.equalFuzzy(this.startAngle,this.endAngle);t&&(this.startAngle=0,this.endAngle=360);var e=this.getArcPts(this.startAngle,this.endAngle);if(!t){var i=e[0][0].clone();i.isScalePoint=!0,i.tag=0;var o=e[e.length-1][e[e.length-1].length-1].clone();o.isScalePoint=!0,o.tag=1,this.scalePoints.push(i),this.scalePoints.push(o),e[0].splice(0,0,this.centerPoint.clone()),e[e.length-1].push(this.centerPoint.clone()),this.latLngs.length>2&&this.latLngs.splice(1,this.latLngs.length-1)}for(var n=0;n<e.length;n++)this.scaleByMap=!1,this._createAndDrawLayer(SuperMap.Plot.SymbolType.POLYLINESYMBOL,e[n],{surroundLineFlag:!1});0===this.latLngs.length&&this.latLngs.push(this.centerPoint.clone()),1===this.latLngs.length&&t&&this.latLngs.push(e[Math.ceil(e.length/2)].clone()),this._textGeometry(),this._radiusGeometry()}},_textGeometry:function(){if(0!==this.textContent.length){var t=90,e=!1;this.textPosition%=360,this.endAngle>this.startAngle&&(this.textPosition<this.endAngle&&this.textPosition>this.startAngle?(this.endAngle-this.textPosition<t&&(t=this.endAngle-this.textPosition),this.textPosition-this.startAngle<t&&(t=this.textPosition-this.startAngle)):this.textPosition+360<this.endAngle&&this.textPosition+360>this.startAngle?(this.textPosition+=360,this.endAngle-this.textPosition<t&&(t=this.endAngle-this.textPosition),this.textPosition-this.startAngle<t&&(t=this.textPosition-this.startAngle)):e=!0),this.startAngle>this.endAngle&&(this.textPosition>this.startAngle||this.textPosition<this.endAngle?e=!0:(this.startAngle-this.textPosition<t&&(t=this.startAngle-this.textPosition),this.textPosition-this.endAngle<t&&(t=this.textPosition-this.endAngle))),2*t<4&&(e=!0);var i=null;if(!0===e){var o=this.getBounds().getCenter();this.scaleByMap=!1,this._createAndDrawLayer(34,[o],{surroundLineFlag:!1,labelAlign:"cm"},this.textContent),i=o.clone()}else{var n=this.textPosition+t,l=this.textPosition-t,s=this.getArcPts(l,n),a=SuperMap.Plot.RelLineText.ONLEFTLINE;SuperMap.Plot.PlottingUtil.isPloyClockwise(s[0])&&(a=SuperMap.Plot.RelLineText.ONRIGHTLINE);for(var r=SuperMap.Plot.PlottingUtil.clonePoints(s[0]),u=[],p=r.length-1;p>=0;p--)u.push(r[p]);this.scaleByMap=!1,this._addComponents(L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.PATHTEXT,u,{textContent:this.textContent,showPathLine:!1,isCurve:!1,relLineText:a,scaleByMap:!1},this.style)),i=s[0][Math.ceil(s[0].length/2)].clone()}i.isScalePoint=!0,i.tag=2,this.scalePoints.push(i)}},_radiusGeometry:function(){if(0!==this.radiusText.length){this.radiusPosAngle%=360;var t=SuperMap.Plot.PlottingUtil.destinationVincenty(this.centerPoint,360-this.radiusPosAngle+90,1e3*this.radius),e=new SuperMap.Geometry.Point(t.lng,t.lat),i=new SuperMap.Geometry.Point(this.centerPoint.lng,this.centerPoint.lat),o=SuperMap.Plot.PlottingUtil.distance(i,e),n=[];if(n.push(this.centerPoint),n.push(L.latLng(e.y,e.x)),SuperMap.Plot.RadiusLineType.NONE!==this.radiusLineType&&this._createAndDrawLayer(SuperMap.Plot.SymbolType.POLYLINESYMBOL,n,{surroundLineFlag:!1}),this.radiusLineType===SuperMap.Plot.RadiusLineType.ARROW){var l;if(null===this.map)l=0;else{var s=this._map.layerPointToLatLng(L.point(0,0)),a=this._map.layerPointToLatLng(L.point(this.subSymbolDefaultPixelSize,0));l=SuperMap.Plot.PlottingUtil.distance(new SuperMap.Geometry.Point(s.lng,s.lat),new SuperMap.Geometry.Point(a.lng,a.lat))}var r=SuperMap.Plot.PlottingUtil.findPoint(e,i,l,12.5),u=SuperMap.Plot.PlottingUtil.findPoint(e,i,l,-12.5),p=[];p.push(L.latLng(e.y,e.x)),p.push(L.latLng(r.y,r.x)),p.push(L.latLng(u.y,u.x)),this.scaleByMap=!1,this._createAndDrawLayer(SuperMap.Plot.SymbolType.ARBITRARYPOLYGONSYMBOL,p,{surroundLineFlag:!1,fill:!0,fillLimit:!0,lineTypeLimit:!0})}if(SuperMap.Util.isArray(this.radiusText)||(this.radiusText=[this.radiusText]),this.radiusText.length>=1){var h=SuperMap.Plot.PlottingUtil.findPoint(i,e,.2*o,0),c=SuperMap.Plot.PlottingUtil.findPoint(i,e,.8*o,0),y=SuperMap.Plot.PlottingUtil.findPoint(h,e,.02*o,90),g=SuperMap.Plot.PlottingUtil.findPoint(c,e,.02*o,90),f=L.latLng(y.y,y.x),d=L.latLng(g.y,g.x),m=SuperMap.Plot.RelLineText.ONLEFTLINE,S=[];y.x<g.x?(S.push(f),S.push(d)):(S.push(d),S.push(f),m=SuperMap.Plot.RelLineText.ONRIGHTLINE),this._addComponents(L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.PATHTEXT,S,{textContent:this.radiusText[0],showPathLine:!1,relLineText:m,scaleByMap:!1},this.style))}if(2===this.radiusText.length){var P=SuperMap.Plot.RelLineText.ONRIGHTLINE,b=SuperMap.Plot.PlottingUtil.findPoint(h,e,.02*o,270),v=SuperMap.Plot.PlottingUtil.findPoint(c,e,.02*o,270),M=L.latLng(b.y,b.x),_=L.latLng(v.y,v.x),A=[];b.x<v.x?(A.push(M),A.push(_)):(A.push(_),A.push(M),P=SuperMap.Plot.RelLineText.ONLEFTLINE),this._addComponents(L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.PATHTEXT,A,{textContent:this.radiusText[1],showPathLine:!1,relLineText:P,scaleByMap:!1},this.style))}var T=L.latLng(e.y,e.x);T.isScalePoint=!0,T.tag=this.scalePoints.length,this.scalePoints.push(T)}},_parseSymbolData:function(){Eh.prototype._parseSymbolData.call(this),this.symbolData&&(this.centerPoint=L.latLng(this.symbolData.centerPoint.y,this.symbolData.centerPoint.x),this.endAngle=this.symbolData.endAngle,this.radius=this.symbolData.radius,this.radiusPosAngle=this.symbolData.radiusPosAngle,this.startAngle=this.symbolData.startAngle,this.textPosition=this.symbolData.textPosition,this.radiusLineType=this.symbolData.radiusLineType,this.radiusText=this.symbolData.radiusText)},_setSymbolData:function(){this.latLngs=[],Eh.prototype._setSymbolData.call(this),this.symbolData&&(this.symbolData.centerPoint||(this.symbolData.centerPoint={}),this.symbolData.centerPoint.x=this.centerPoint.lng,this.symbolData.centerPoint.y=this.centerPoint.lat,this.symbolData.endAngle=this.endAngle,this.symbolData.radius=this.radius,this.symbolData.radiusPosAngle=this.radiusPosAngle,this.symbolData.startAngle=this.startAngle,this.symbolData.textPosition=this.textPosition,this.symbolData.radiusLineType=this.radiusLineType,this.symbolData.radiusText=this.radiusText)},_reView:function(){void 0!==this.prevStrokeWidth&&this.prevStrokeWidth!==this.feature.style.strokeWidth&&(this.strokeWidth=this.style.strokeWidth),this.fromZoom!==this._map.getZoom()&&(!0===this.isEdit&&this.redraw(),this.fromZoom=this._map.getZoom())},_modifyPoint:function(t,e){if(!0===e.isScalePoint){if(0===t)this.radius=SuperMap.Plot.PlottingUtil.distVincenty(this.centerPoint,e),this.startAngle=180*SuperMap.Plot.PlottingUtil.radian(new SuperMap.Geometry.Point(this.latLngs[0].lng,this.latLngs[0].lat),new SuperMap.Geometry.Point(e.lng,e.lat))/Math.PI;else if(1===t)this.radius=SuperMap.Plot.PlottingUtil.distVincenty(this.centerPoint,e),this.endAngle=180*SuperMap.Plot.PlottingUtil.radian(new SuperMap.Geometry.Point(this.latLngs[0].lng,this.latLngs[0].lat),new SuperMap.Geometry.Point(e.lng,e.lat))/Math.PI;else if(2===t&&0!==this.textContent.length){var i=180*SuperMap.Plot.PlottingUtil.radian(new SuperMap.Geometry.Point(this.latLngs[0].lng,this.latLngs[0].lat),new SuperMap.Geometry.Point(e.lng,e.lat))/Math.PI;(i>this.startAngle&&i<this.endAngle||i+360>this.startAngle&&i+360<this.endAngle)&&(this.textPosition=i)}else if(3===t||2===t&&0===this.textContent.length){var o=180*SuperMap.Plot.PlottingUtil.radian(new SuperMap.Geometry.Point(this.latLngs[0].lng,this.latLngs[0].lat),new SuperMap.Geometry.Point(e.lng,e.lat))/Math.PI;this.startAngle%360==this.endAngle%360?this.radiusPosAngle=o:(o>this.startAngle&&o<this.endAngle||o+360>this.startAngle&&o+360<this.endAngle)&&(this.radiusPosAngle=o)}}else this.latLngs.length>0&&(this.centerPoint=this.latLngs[0].clone()),2===this.latLngs.length&&(this.radius=SuperMap.Plot.PlottingUtil.distVincenty(this.latLngs[0],this.latLngs[1]));this.redraw()},_resizeLatLngs:function(t,e,i,o){var n=!1;1===this.latLngs.length&&(n=!0,this.latLngs.push(this.scalePoints[0])),Eh.prototype._resizeLatLngs.call(this,t,e,i,o),this.centerPoint.lng=this.latLngs[0].lng,this.centerPoint.lat=this.latLngs[0].lat,this.radius=SuperMap.Plot.PlottingUtil.distVincenty(this.latLngs[0],this.latLngs[1]),n&&this.latLngs.splice(1,1)},setRotate:function(t){if(this.dRotate=t,this._rotate(t,this.centerPoint),this.radiusPosAngle+=t,this.startAngle+=t,this.endAngle+=t,this.textPosition+=t,this.latLngs=[],0!==this.avoidRegions.length)for(var e=0,i=this.avoidRegions.length;e<i;e++)L.Util.rotateLatLngs(this.avoidRegions[e].getLatLngs(),this.centerPoint,t);this.redraw()},move:function(t,e){for(var i=0,o=this.avoidRegions.length;i<o;i++)L.Util.moveLatLngs(this.avoidRegions[i].getLatLngs(),t,e);L.Util.moveLatLngs([this.centerPoint],t,e),this.latLngs=[],this.redraw()},getArcPts:function(t,e){for(var i=[],o=[],n=t;n<=e;n+=5){var l=SuperMap.Plot.PlottingUtil.destinationVincenty(this.centerPoint,360-n+90,1e3*this.radius);o.length>2&&Math.abs(l.lng-o[o.length-1].lng)>180&&(i.push(o.slice()),o.length=0),o.push(l)}if(n-e>0&&n-e<5){var s=SuperMap.Plot.PlottingUtil.destinationVincenty(this.centerPoint,360-e+90,1e3*this.radius);o.push(s)}return i.push(o.slice()),i}}),Fy=function(t,e,i,o){return new ky(t,e,i,o)};L.supermap.plotting.arcRegion=Fy;var jy=vh.extend({colNum:null,space:null,initialize:function(t,e,i,o){vh.prototype.initialize.call(this,t,e,i,o),this.libID=0,this.code=SuperMap.Plot.SymbolType.NAVYDEPLOYMENT,this.symbolType=SuperMap.Plot.SymbolType.NAVYDEPLOYMENT,this.symbolName="海军兵力部署",null===this.colNum&&(this.colNum=1),null===this.space&&(this.space=10),this.scaleByMap=!0},destroy:function(){this.space=null,this.colNum=null,vh.prototype.destroy.call(this)},redraw:function(){"none"===this.style.display||null!=this.layer&&"function"==typeof this.layer.getVisibility&&!1===this.layer.getVisibility()?this._clearComponents():this._redrawComponents()},_calculateParts:function(){var t=this._map.getFeatureByUuid(this.associatedUuid);if(null!==t&&t.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&0!==t.latLngs.length){for(var e=!1,i=0;i<t.deployments.length;i++)if(this===t.deployments[i]){e=!0;break}e||t.deployments.push(this),null==this.minScale&&(this.minScale=t.minScale),null==this.maxScale&&(this.maxScale=t.maxScale);var o=1;if("function"==typeof this.layer.getSymZoomScale&&(o=this.layer.getSymZoomScale()),null!=this.minScale&&o<this.minScale?o=this.minScale:null!=this.maxScale&&o>this.maxScale&&(o=this.maxScale),0!==this.subObjects.length&&0===this.components.length)for(var n=0,l=this.subObjects.length;n<l;n++)this.subObjects[n].ownerGroup=this,this.subObjects[n].enableEdit=!0,this._addComponents(this.subObjects[n]);this.subObjects=[];var s=L.Util.cloneLatLngs(t.latLngs[0]),a=this._map.latLngToLayerPoint(L.latLng(s[0].lat,s[0].lng)),r=this._transitionPoint(new SuperMap.Geometry.Point(this.space*o,0),a),u=Math.abs(r.lng-s[0].lng),p=new SuperMap.Geometry.Point(0,0),h=this._transitionPoint(p,a),c=new SuperMap.Geometry.Point(100*o,100*o),y=this._transitionPoint(c,a),g=new L.LatLngBounds(L.latLng(h.lat,h.lng),L.latLng(y.lat,y.lng)),f=Math.ceil(this._getSubSymbolCount(this.subSymbols.length-1)/this.colNum),d=Math.abs(g.getNorth()-g.getSouth())*f+u*(f+1),m=L.latLng(s[0].lat+d/2,s[0].lng-5*u);this._clearComponents();for(var S=0;S<this.subSymbols.length;S++)for(var P=0;P<this.subSymbols[S].totalNum;P++){var b=this._getSubSymbolCount(S-1)+P+1,v=Math.ceil(b/f),M=b-f*(v-1);if(1!==v&&1===M){var _=this.bounds;m.lng=_.getWest()}this.subSymbols[S].symbolData.textContent=this.subSymbols[S].textContent;for(var A=m.lng,T=m.lat-M*(Math.abs(g.getNorth()-g.getSouth())+u),x=0,O=0,w=0,C=0,E=0;E<this.subSymbols[S].symbolData.innerCells.length;E++)for(var I=0;I<this.subSymbols[S].symbolData.innerCells[E].positionPoints.length;I++)x<=this.subSymbols[S].symbolData.innerCells[E].positionPoints[I].x*o&&(x=this.subSymbols[S].symbolData.innerCells[E].positionPoints[I].x*o),O>=this.subSymbols[S].symbolData.innerCells[E].positionPoints[I].x*o&&(O=this.subSymbols[S].symbolData.innerCells[E].positionPoints[I].x*o),w<=this.subSymbols[S].symbolData.innerCells[E].positionPoints[I].y*o&&(w=this.subSymbols[S].symbolData.innerCells[E].positionPoints[I].y*o),C>=this.subSymbols[S].symbolData.innerCells[E].positionPoints[I].y*o&&(C=this.subSymbols[S].symbolData.innerCells[E].positionPoints[I].y*o);var D=L.latLng(T,A),U=this._map.latLngToLayerPoint(L.latLng(T,A)),R=new SuperMap.Geometry.Point(x,(w+C)/2),N=new SuperMap.Geometry.Point(R.x,R.y),B=new SuperMap.Geometry.Point(this.subSymbols[S].symbolData.anchorPoint.x,this.subSymbols[S].symbolData.anchorPoint.y),k=this._transitionPoint(N,U),F=this._transitionPoint(B,U);D.lat+=F.lat-k.lat,D.lng+=F.lng-k.lng;var j=this.subSymbols[S].symbolData.libID,V=this.subSymbols[S].symbolData.code;this.subSymbols[S].symbolData.annotationPosition=6;var z=SuperMap.Util.cloneObject(this.subSymbols[S].symbolData),Y=L.supermap.plotting.PlottingObject.createSymbol(j,V,D,{serverUrl:this.serverUrl,symbolData:z,scaleByMap:this.scaleByMap,minScale:this.minScale,maxScale:this.maxScale,space:0});Y.enableEdit=!0,Y.ownerGroup=this,this._addComponents(Y),this.bounds=new L.LatLngBounds,this.bounds.extend(Y.getBoundsWithText()),this.subObjects.push(Y)}if(this.bounds=new L.LatLngBounds,this.bounds=this._calculateBounds(),null!==this.textContent&&0!==this.textContent.length){var G=L.latLng(s[0].lat+d/2+u,s[0].lng-5*u),W=L.supermap.plotting.PlottingObject.createSymbol(0,34,[G],{textContent:this.textContent,serverUrl:this.serverUrl,scaleByMap:this.scaleByMap,minScale:this.minScale,maxScale:this.maxScale});W.style.labelAlign="rb",W.style.scaleByMap=!0,W.enableEdit=!0,W.ownerGroup=this,this._addComponents(W),this.bounds.extend(W.getBounds()),this.subObjects.push(W)}var X=new L.LatLngBounds(L.latLng(this.bounds.getSouth()-u,this.bounds.getWest()-u),L.latLng(this.bounds.getNorth()+u,this.bounds.getEast()+u)),H=[];H.push(L.latLng(X.getNorth(),X.getWest())),H.push(L.latLng(X.getSouth(),X.getEast()));var Z=L.latLng(s[0].lat,s[0].lng);Z.isFixedPos=!0,H.push(Z);var J=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.ANNOFRAMESYMBOL,H,{serverUrl:this.serverUrl,scaleByMap:this.scaleByMap,minScale:this.minScale,maxScale:this.maxScale});for(var q in J.enableEdit=!0,J.ownerGroup=this,this.subObjects.splice(0,0,J),this._addComponents(J),this.subObjects)this.subObjects[q].ownerGroup=this,this.subObjects[q].enableEdit=!0,this._addComponents(this.subObjects[q])}},_reView:function(){this.redraw(),this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},move:function(t,e){for(var i in this.subObjects)this.subObjects[i].move(t,e);this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},_resize:function(t,e){for(var i in this.subObjects)this.subObjects[i]._resize(t,e)},_transitionPoint:function(t,e){var i=e.x+t.x*(96/254),o=e.y-t.y*(96/254);return this._map.layerPointToLatLng(L.point(i,o))},_getSubSymbolCount:function(t){var e=0;if(t<0)return e;t>this.subSymbols.length-1&&(t=this.subSymbols.length-1);for(var i=0;i<=t;i++)e+=this.subSymbols[t].totalNum;return e},_calculateBounds:function(){for(var t in this.bounds=new L.LatLngBounds,this.components)0!==t&&this.components[t].symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&this.bounds.extend(this.components[t].getBoundsWithText());return this.bounds},setTextContent:function(t){if(this.textContent!==t){this.textContent=t;for(var e=0;e<this.subObjects.length;e++)this.subObjects[e].symbolType===SuperMap.Plot.SymbolType.TEXTSYMBOL&&(this.subObjects[e].textContent=this.textContent,this.subObjects[e].redraw())}}}),Vy=function(t,e,i,o){return new jy(t,e,i,o)};L.supermap.plotting.navyDeployment=Vy,L.supermap.plotting.NavyDeployment=jy;var zy=jy.extend({isShowTooltip:!0,getShowTooltip:function(){return this.isShowTooltip},setShowTooltip:function(t){if(this.isShowTooltip!==t)if(this.isShowTooltip=t,this.isShowTooltip&&0!==this.components.length){var e=this._map.getFeatureByUuid(this.associatedUuid),i=L.Util.cloneLatLngs(e.latLngs[0]),o=this._map.latLngToLayerPoint(L.latLng(i[0].lat,i[0].lng)),n=this._transitionPoint(new SuperMap.Geometry.Point(this.space,0),o),l=Math.abs(n.lng-i[0].lng),s=new L.LatLngBounds(L.latLng(this.bounds.getSouth()-l,this.bounds.getWest()-l),L.latLng(this.bounds.getNorth()+l,this.bounds.getEast()+l)),a=[];a.push(L.latLng(s.getNorth(),s.getWest())),a.push(L.latLng(s.getSouth(),s.getEast()));var r=L.latLng(i[0].lat,i[0].lng);r.isFixedPos=!0,a.push(r);var u=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.ANNOFRAMESYMBOL,a,{serverUrl:this.serverUrl});this._addComponents(u)}else for(var p=0;p<this.components.length;p++)if(320===this.components[p].symbolType){this.subObjects.splice(SuperMap.Util.indexOf(this.subObjects,this.components[p]),1);var h=SuperMap.Util.indexOf(this.components,this.components[p]);if(-1!==h){this.components[h]._clearComponents(),this.components.splice(h,1);break}}},initialize:function(t,e,i,o){jy.prototype.initialize.call(this,t,e,i,o),this.libID=0,this.code=SuperMap.Plot.SymbolType.AIRDEPLOYMENT,this.symbolType=SuperMap.Plot.SymbolType.AIRDEPLOYMENT,this.symbolName="空军兵力部署",null===this.isShowTooltip&&(this.isShowTooltip=!0),this.scaleByMap=!0},destroy:function(){this.isShowTooltip=null,jy.prototype.destroy.call(this)},_calculateParts:function(){var t=this._map.getFeatureByUuid(this.associatedUuid);if(null!==t&&t.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&0!==t.latLngs.length){for(var e=!1,i=0;i<t.deployments.length;i++)if(this===t.deployments[i]){e=!0;break}e||t.deployments.push(this),null==this.minScale&&(this.minScale=t.minScale),null==this.maxScale&&(this.maxScale=t.maxScale);var o=1;if("function"==typeof this.layer.getSymZoomScale&&(o=this.layer.getSymZoomScale()),null!=this.minScale&&o<this.minScale?o=this.minScale:null!=this.maxScale&&o>this.maxScale&&(o=this.maxScale),0!==this.subObjects.length&&0===this.components.length)for(var n=0,l=this.subObjects.length;n<l;n++)this.subObjects[n].enableEdit=!0,this.subObjects[n].ownerGroup=this,this._addComponents(this.subObjects[n]);this.subObjects=[];var s=L.Util.cloneLatLngs(t.latLngs[0]),a=this._map.latLngToLayerPoint(L.latLng(s[0].lat,s[0].lng)),r=this._transitionPoint(new SuperMap.Geometry.Point(this.space*o,0),a),u=Math.abs(r.lng-s[0].lng),p=new SuperMap.Geometry.Point(0,0),h=this._transitionPoint(p,a),c=new SuperMap.Geometry.Point(100*o,100*o),y=this._transitionPoint(c,a),g=new L.LatLngBounds(L.latLng(h.lat,h.lng),L.latLng(y.lat,y.lng)),f=Math.ceil(this._getSubSymbolCount(this.subSymbols.length-1)/this.colNum),d=Math.abs(g.getWest()-g.getEast())*this.colNum+u*(this.colNum-1),m=L.latLng(s[0].lat-u,s[0].lng-.5*d+.5*Math.abs(g.getEast()-g.getWest()));!0===this.isShowTooltip&&(m.lat-=4*u),this._setSubSymbolText();for(var S=[],P=0;P<this.subSymbols.length;P++)for(var b=0;b<this.subSymbols[P].totalNum;b++)S.push(this.subSymbols[P]);this._clearComponents();for(var v=0,M=0;M<f;M++){for(b=0;b<this.colNum&&!(v>=S.length);b++){var _=S[v];if(void 0!==_.symbolData&&null!==_.symbolData){for(var A=_.symbolData.libID,T=_.symbolData.code,x=m.lng+b*(u+Math.abs(g.getEast()-g.getWest())),O=m.lat-(2*u+Math.abs(g.getNorth()-g.getSouth())/2),w=0,C=0,E=0,I=0,D=0;D<_.symbolData.innerCells.length;D++)for(var U=0;U<_.symbolData.innerCells[D].positionPoints.length;U++)w<=_.symbolData.innerCells[D].positionPoints[U].x*o&&(w=_.symbolData.innerCells[D].positionPoints[U].x*o),C>=_.symbolData.innerCells[D].positionPoints[U].x*o&&(C=_.symbolData.innerCells[D].positionPoints[U].x*o),E<=_.symbolData.innerCells[D].positionPoints[U].y*o&&(E=_.symbolData.innerCells[D].positionPoints[U].y*o),I>=_.symbolData.innerCells[D].positionPoints[U].y*o&&(I=_.symbolData.innerCells[D].positionPoints[U].y*o);var R=L.latLng(O,x),N=this._map.latLngToLayerPoint(L.latLng(O,x)),B=new SuperMap.Geometry.Point((w+C)/2,E),k=new SuperMap.Geometry.Point(B.x,B.y),F=new SuperMap.Geometry.Point(S[v].symbolData.anchorPoint.x,S[v].symbolData.anchorPoint.y),j=this._transitionPoint(k,N),V=this._transitionPoint(F,N);R.lat+=V.lat-j.lat,R.lng+=V.lng-j.lng,_.symbolData.annotationPosition=5;var z=SuperMap.Util.cloneObject(_.symbolData),Y=L.supermap.plotting.PlottingObject.createSymbol(A,T,R,{symbolData:z,scaleByMap:this.scaleByMap,minScale:this.minScale,maxScale:this.maxScale,space:0});Y.enableEdit=!0,Y.ownerGroup=this,this._addComponents(Y),this.subObjects.push(Y),v++}}this.bounds=this._calculateBounds(),m.lat=this.bounds.getSouth()}if(this.isShowTooltip){this.bounds=new L.LatLngBounds,this.bounds=this._calculateBounds();var G=new L.LatLngBounds(L.latLng(this.bounds.getSouth()-u,this.bounds.getWest()-u),L.latLng(this.bounds.getNorth()+5*u,this.bounds.getEast()+u)),W=[];W.push(L.latLng(G.getNorth(),G.getWest())),W.push(L.latLng(G.getSouth(),G.getEast()));var X=L.latLng(s[0].lat,s[0].lng);X.isFixedPos=!0,W.push(X);var H=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.ANNOFRAMESYMBOL,W,{serverUrl:this.serverUrl,scaleByMap:this.scaleByMap,minScale:this.minScale,maxScale:this.maxScale});H.enableEdit=!0,H.ownerGroup=this,this.subObjects.splice(0,0,H),this._addComponents(H),this._clearComponents();for(var Z=0;Z<this.subObjects.length;Z++)this.subObjects[Z].enableEdit=!0,this.subObjects[Z].ownerGroup=this,this._addComponents(this.subObjects[Z])}}},_setSubSymbolText:function(){for(var t=0;t<this.subSymbols.length;t++)null!==this.subSymbols[t].symbolData&&(this.subSymbols[t].symbolData.textContent=this.subSymbols[t].textContent)},_parseSymbolData:function(){jy.prototype._parseSymbolData.call(this),this.symbolData&&(this.isShowTooltip=this.symbolData.isShowTooltip)},_setSymbolData:function(){jy.prototype._setSymbolData.call(this),this.symbolData&&(this.symbolData.isShowTooltip=this.isShowTooltip)}}),Yy=function(t,e,i,o){return new zy(t,e,i,o)};L.supermap.plotting.airDeployment=Yy,L.supermap.plotting.AirDeployment=zy;var Gy=_y.extend({space:null,inner:null,initialize:function(t,e,i,o){_y.prototype.initialize.call(this,t,e,i,o),this.libID=0,this.code=SuperMap.Plot.SymbolType.AIRROUTE,this.symbolType=SuperMap.Plot.SymbolType.AIRROUTE,this.symbolName="空军航线",null===this.space&&(this.space=20),null===this.inner&&(this.inner=!1)},destroy:function(){this.space=null,this.inner=null,_y.prototype.destroy.call(this)},redraw:function(){if(this._initRoute(),void 0!==this.arrRoutePts&&null!==this.arrRoutePts)for(var t=0;t<this.arrRoutePts.length;t++){var e=this.arrRoutePts[t];if(SuperMap.Util.isArray(e)&&!(e.length<2)){var i=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.POLYLINESYMBOL,e,{serverUrl:this.serverUrl,enableEdit:!1,scaleByMap:!1});this._addComponents(i)}}for(var o=0;o<this.routeNodes.length;o++){var n=this.routeNodes[o];if(null!==n&&(n.towardNodes&&null!==n.towardNodes)){for(var l=0;l<n.towardNodes.length;l++)if(n.towardNodes[l]instanceof SuperMap.Plot.TowardNode){var s=this._getNodeByUuid(n.towardNodes[l].routeNodeId);if(null!==s){if(0===this.arrRoutePts.length){var a=[];a.push(L.latLng(n.y,n.x)),a.push(L.latLng(s.y,s.x));var r=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.POLYLINESYMBOL,a,{enableEdit:!1,scaleByMap:!1});this._addComponents(r),r._startRouteNode=n.id,r._endRouteNode=s.id}this._createLiterateSign(n,n.towardNodes[l])}}this._createRouteNode(n)}}this._finishRoute()},_createLiterateSign:function(t,e){for(var i=0;i<this.prevLiterateSign.length;){if(this.prevLiterateSign[i]._startRouteNode===t.id&&this.prevLiterateSign[i]._endRouteNode===e.routeNodeId)return this.prevLiterateSign[i].startRouteNode=t,this.prevLiterateSign[i].towardNode=e,this.prevLiterateSign[i].redraw(),this.components.push(this.prevLiterateSign[i]),void this.prevLiterateSign.splice(i,1);i++}if(null!==e.textContent&&0!==e.textContent.length){var o=SuperMap.Util.copyAttributes(SuperMap.Plot.PlottingUtil.cloneObject(this.style),e.style),n=L.supermap.plotting.PlottingObject.createSymbol(0,SuperMap.Plot.SymbolType.LITERATESIGN,null,{startRouteNode:t,towardNode:e,route:this,inner:this.inner,space:this.space,scaleByMap:!1},o);this._addComponents(n),n._startRouteNode=t.id,n._endRouteNode=e.routeNodeId}}}),Wy=function(t,e,i,o){return new Gy(t,e,i,o)};L.supermap.plotting.airRoute=Wy,L.supermap.plotting.AirRoute=Gy;var Xy=_y.extend({initialize:function(t,e,i,o){this.libID=0,this.code=SuperMap.Plot.SymbolType.MISSILEROUTE,this.symbolType=SuperMap.Plot.SymbolType.MISSILEROUTE,this.symbolName="导弹航线",_y.prototype.initialize.call(this,t,e,i,o)}}),Hy=function(t,e,i,o){return new Xy(t,e,i,o)};L.supermap.plotting.missileRoute=Hy,L.supermap.plotting.MissileRoute=Xy;var Zy=_y.extend({initialize:function(t,e,i,o){this.libID=0,this.code=SuperMap.Plot.SymbolType.NAVYROUTE,this.symbolType=SuperMap.Plot.SymbolType.NAVYROUTE,this.symbolName="海军航线",_y.prototype.initialize.call(this,t,e,i,o)}}),Jy=function(t,e,i,o){return new Zy(t,e,i,o)};L.supermap.plotting.navyRoute=Jy,L.supermap.plotting.NavyRoute=Zy;var qy=Eh.extend({initialize:function(t,e,i,o){this.code=SuperMap.Plot.SymbolType.FREECURVE,this.libID=0,this.symbolType=SuperMap.Plot.SymbolType.FREECURVE,this.symbolName="自由曲线",this.minEditPts=2,this.maxEditPts=9999,Eh.prototype.initialize.call(this,t,e,i,o)},destroy:function(){Eh.prototype.destroy.apply(this,arguments)},_calculateParts:function(){null!==this.getLatLngs()&&this.getLatLngs().length>=this.minEditPts&&this._createAndDrawLayer(24,this.latLngs,this.style,""),"function"==typeof this.layer.getSymZoomScale?this.prevScale=this.layer.getSymZoomScale():this.prevScale=1},move:function(t,e){L.Util.moveLatLngs(this.getLatLngs(),t,e);for(var i=0,o=this.avoidRegions.length;i<o;i++)this.avoidRegions[i].move(t,e);this.redraw()},setRotate:function(t){this.dRotate=t,null===this.anchorPoint&&(this.anchorPoint=this.getBounds().getCenter());for(var e=0;e<this.components.length;e++)L.Util.rotateLatLngs(this.components[e].getLatLngs(),this.anchorPoint,t),this.components[e].setLatLngs(this.components[e].getLatLngs());for(var i=0,o=this.avoidRegions.length;i<o;i++)this.avoidRegions[i].rotate(this.dRotate,this.anchorPoint)}}),Ky=function(t,e,i,o){return new qy(t,e,i,o)};L.supermap.plotting.freeCurve=Ky,L.supermap.plotting.FreeCurve=qy;var Qy=xh.extend({initialize:function(t,e,i,o){xh.prototype.initialize.call(this,t,e,i,o),this.libID=0,this.code=SuperMap.Plot.SymbolType.INTERFERENCEBEAM,this.symbolType=SuperMap.Plot.SymbolType.INTERFERENCEBEAM,this.symbolName="干扰波束",this.minEditPts=3,this.maxEditPts=9999},destroy:function(){xh.prototype.destroy.apply(this,arguments)},_calculateParts:function(){null!==this.getLatLngs()&&this.getLatLngs().length>=this.minEditPts&&(this.scaleByMap=!0,this._createAndDrawLayer(32,this.latLngs,this.style,""))},move:function(t,e){L.Util.moveLatLngs(this.getLatLngs(),t,e);for(var i=0,o=this.avoidRegions.length;i<o;i++)this.avoidRegions[i].move(t,e);this.redraw()},setRotate:function(t){this.dRotate=t,null===this.anchorPoint&&(this.anchorPoint=this.getBounds().getCenter());for(var e=0;e<this.components.length;e++)L.Util.rotateLatLngs(this.components[e].getLatLngs(),this.anchorPoint,t),this.components[e].setLatLngs(this.components[e].getLatLngs());for(var i=0,o=this.avoidRegions.length;i<o;i++)this.avoidRegions[i].rotate(this.dRotate,this.anchorPoint)},_reView:function(){}}),$y=function(t,e,i,o){return new Qy(t,e,i,o)};L.supermap.plotting.interferenceBeam=$y,L.supermap.plotting.InterferenceBeam=Qy;var tg=xh.extend({orbitPoints:[],visible:null,timeWindows:null,setVisible:function(t){this.visible!==t&&(this.visible=t,this.redraw(),null!==this._map.getPlotEditControl()&&this.isSelected&&this.fire(SuperMap.Plot.Event.reseteditmarkersvalues))},getBounds:function(){var t=this;return t._bounds=new L.LatLngBounds,t.components.map(function(e){return e.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL?t._bounds.extend(e.getBoundsWithText()):t._bounds.extend(e.getBounds()),e}),t._bounds},getVisible:function(){return this.visible},initialize:function(t,e,i,o){this.libID=0,this.code=SuperMap.Plot.SymbolType.SATELLITE,this.symbolType=SuperMap.Plot.SymbolType.SATELLITE,this.symbolName="卫星",null===this.visible&&(this.visible=!0),null===this.timeWindows&&(this.timeWindows=[]),0===this.orbitPoints.length&&(this.orbitPoints=[]),this.scaleValues||(this.scaleValues=[]),xh.prototype.initialize.call(this,t,e,i,o),this.scaleByMap=!0},_calculateParts:function(){if(null!==this.orbitPoints&&this.visible){if(null===this.latLngs||0===this.latLngs.length)this.latLngs=L.Util.superMapPointsToLatLngs(this.orbitPoints);else for(var t=0,e=this.latLngs.length;t<e;t++)this.orbitPoints[t].x=this.latLngs[t].lng,this.orbitPoints[t].y=this.latLngs[t].lat;this.scaleByMap=!0,this._createAndDrawLayer(24,L.Util.cloneLatLngs(this.latLngs),this.style,"")}0===this.scaleValues.length&&this.scaleValues.push(.5);var i=L.Util.latLngsToSuperMapPoints(this.latLngs),o=SuperMap.Plot.PlottingUtil.polylineDistance(i),n=SuperMap.Plot.PlottingUtil.findPointInPolyLine(i,o*this.scaleValues[0]).pt.clone(),l=Math.floor(this.orbitPoints.length/2),s=new SuperMap.Geometry.Point(this.orbitPoints[l].x,this.orbitPoints[l].y),a=SuperMap.Plot.PlottingUtil.radian(s,new SuperMap.Geometry.Point(this.orbitPoints[l-1].x,this.orbitPoints[l-1].y));this.subSymbols[0].symbolData.dRotate=180*a/Math.PI,this.subSymbols[0].symbolData.textContent=this.textContent,this.subSymbols[0].symbolData.annotationPosition=7;var r={symbolData:SuperMap.Util.cloneObject(this.subSymbols[0].symbolData),serverUrl:this.serverUrl,enableEdit:!1,style:this.style,scaleByMap:!0},u=SuperMap.Plot.PlottingUtil.cloneObject(this.style),p=L.supermap.plotting.PlottingObject.createSymbol(this.subSymbols[0].libID,this.subSymbols[0].code,[new L.latLng(n.y,n.x)],r,u);p.minScale=this.minScale,p.maxScale=this.maxScale,this._addComponents(p),p.isEdit=!0,this.scalePoints=[];var h=new L.latLng(n.y,n.x);h.isScalePoint=!0,h.tag=0,this.scalePoints.push(h)},move:function(t,e){L.Util.moveLatLngs(this.getLatLngs(),t,e);for(var i=0,o=this.orbitPoints.length;i<o;i++)this.orbitPoints[i].x+=e,this.orbitPoints[i].y+=t;for(var n=0,l=this.timeWindows.length;n<l;n++){var s=this.timeWindows[n];null!==s&&s.redraw()}if(0!==this.avoidRegions.length)for(var a=0,r=this.avoidRegions.length;a<r;a++)L.Util.moveLatLngs(this.avoidRegions[a].getLatLngs(),t,e);if(!1===this.visible)for(var u=0;u<this.components.length;u++)this.components[u].symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&this.components[u].move(t,e);else this.redraw()},_resizeLatLngs:function(t,e,i,o){xh.prototype._resizeLatLngs.call(this,t,e,i,o);for(var n=0,l=this.orbitPoints.length;n<l;n++)this.orbitPoints[n].x=this.latLngs[n].lng,this.orbitPoints[n].y=this.latLngs[n].lat;for(var s=0,a=this.timeWindows.length;s<a;s++){var r=this.timeWindows[s];null!==r&&r.redraw()}},setRotate:function(t){this.dRotate=t,null===this.anchorPoint&&(this.anchorPoint=this.getBounds().getCenter());for(var e=0,i=this.avoidRegions.length;e<i;e++)this.avoidRegions[e].rotate(t,this.anchorPoint);xh.prototype._rotate.call(this,t,this.anchorPoint);for(var o=0,n=this.orbitPoints.length;o<n;o++)this.orbitPoints[o].x=this.latLngs[o].lng,this.orbitPoints[o].y=this.latLngs[o].lat;for(var l=0;l<this.timeWindows.length;l++){var s=this.timeWindows[l];null!==s&&s.redraw()}this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},_reView:function(){for(var t=0,e=this.components.length;t<e;t++)this.components[t].symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&(this.components[t]._reView(),this.components[t]._handleAnnotation(),this.subSymbols[0].symbolData=SuperMap.Util.cloneObject(this.components[t].getSymbolData()))},_modifyPoint:function(t,e){if(e.isScalePoint){if(0!==t)return;var i=L.Util.latLngsToSuperMapPoints(this.getLatLngs()),o=L.Util.latLngsToSuperMapPoints(e),n=SuperMap.Plot.PlottingUtil.clonePoints(i);if((n=SuperMap.Plot.PlottingUtil.clearSamePts(n)).length<this.minEditPts)return;var l=SuperMap.Plot.PlottingUtil.generateBeizerPointsNoCtrlPt(n);l=SuperMap.Plot.PlottingUtil.clearSamePts(l);for(var s,a=SuperMap.Plot.PlottingUtil.polylineDistance(l),r=SuperMap.Plot.PlottingUtil.distance(l[0],o[0]),u=0;u<l.length;u++)r>SuperMap.Plot.PlottingUtil.distance(l[u],o[0])&&(r=SuperMap.Plot.PlottingUtil.distance(l[u],o[0]),s=u);var p=0;0===s&&(s=1);for(var h=0;h<s;h++)p+=SuperMap.Plot.PlottingUtil.distance(l[h],l[h+1]);this.scaleValues[0]=p/a}this.redraw()}}),eg=function(t,e,i,o){return new tg(t,e,i,o)};L.supermap.plotting.satellite=eg,L.supermap.plotting.Satellite=tg;var ig=xh.extend({timeWindows:[],initialize:function(t,e,i,o){this.libID=0,this.code=SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS,this.symbolType=SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS,this.symbolName="卫星时间窗",xh.prototype.initialize.call(this,t,e,i,o),this.scaleValues||(this.scaleValues=[]),this.scaleByMap=!0},_calculateParts:function(){if(this.associatedUuid){var t=this._map.getFeatureByUuid(this.associatedUuid);if(null===t||null===t.orbitPoints)return}for(var e=!1,i=0;i<t.timeWindows.length;i++)if(this===t.timeWindows[i]){e=!0;break}if(e||t.timeWindows.push(this),this.type)for(var o=0;o<this.timeWindows.length;o++)this.timeWindows[o].type=this.type;if(this.scalePoints=[],null!==this.timeWindows)for(var n=t.orbitPoints,l=0;l<this.timeWindows.length;l++){var s,a;if("number"===this.timeWindows[l].type){for(var r=0,u=n.length;r<u;r++)if(this.timeWindows[l].startOrbitPoint===n[r].number&&(s=r),this.timeWindows[l].endOrbitPoint===n[r].number){a=r;break}}else if("Time"===this.timeWindows[l].type)for(var p=0;p<n.length;p++)if(this.timeWindows[l].startOrbitPoint===n[p].time&&(s=p),this.timeWindows[l].endOrbitPoint===n[p].time){a=p;break}for(var h=[],c=s;c<=a;c++)h.push(new L.latLng(n[c].y,n[c].x));h.length>1&&(this.scaleByMap=!0,this._createAndDrawLayer(24,h,{surroundLineFlag:!1,lineWidthLimit:!0,weight:4*t.style.weight+this.style.weight}),h[0].isScalePoint=!0,h[0].tag=2*l,this.scalePoints.push(h[0]),h[h.length-1].isScalePoint=!0,h[h.length-1].tag=2*l+1,this.scalePoints.push(h[h.length-1]))}},calculateBounds:function(){this.bounds=null;var t=new L.Bounds,e=this.components;if(e)for(var i=0;i<e.length;i++)t.extend(e[i].getBounds());null!==t.left&&null!==t.bottom&&null!==t.right&&null!==t.top&&this.setBounds(t)},move:function(){},_modifyPoint:function(t,e){if(e.isScalePoint){var i=this._map.getFeatureByUuid(this.associatedUuid);if(!i)return;var o=i.getLatLngs(),n=i.orbitPoints,l=L.Util.latLngsToSuperMapPoints(e),s=L.Util.latLngsToSuperMapPoints(o);if(t%2==0){var a;t/=2,a=this.timeWindows[t].endOrbitPoint-this.timeWindows[t].startOrbitPoint;for(var r=SuperMap.Plot.PlottingUtil.distance(l[0],s[0]),u=0,p=0;p<o.length-a;p++)r>=SuperMap.Plot.PlottingUtil.distance(l[0],s[p])&&(r=SuperMap.Plot.PlottingUtil.distance(l[0],s[p]),u=p);for(var h=0;h<this.timeWindows.length;h++)"number"===this.timeWindows[h].type?(this.timeWindows[t].startOrbitPoint=u+n[0].number,this.timeWindows[t].endOrbitPoint=u+a+n[0].number):"Time"===this.timeWindows[h].type&&(this.timeWindows[t].startOrbitPoint=u+n[0].time,this.timeWindows[t].endOrbitPoint=u+a+n[0].time)}else{t=(t-1)/2;for(var c=SuperMap.Plot.PlottingUtil.distance(l[0],s[s.length-1]),y=0;y<o.length;y++)c>=SuperMap.Plot.PlottingUtil.distance(l[0],s[y])&&(c=SuperMap.Plot.PlottingUtil.distance(l[0],s[y]),u=y);for(var g=0;g<this.timeWindows.length;g++)"number"===this.timeWindows[g].type?(this.timeWindows[t].endOrbitPoint=u+n[0].number,this.timeWindows[t].endOrbitPoint<=this.timeWindows[t].startOrbitPoint&&(this.timeWindows[t].endOrbitPoint=this.timeWindows[t].startOrbitPoint+1)):"Time"===this.timeWindows[g].type&&(this.timeWindows[t].endOrbitPoint=u+n[0].time,this.timeWindows[t].endOrbitPoint<=this.timeWindows[t].startOrbitPoint&&(this.timeWindows[t].endOrbitPoint=this.timeWindows[t].startOrbitPoint+1))}}this.redraw()}}),og=function(t,e,i,o){return new ig(t,e,i,o)};L.supermap.plotting.satelliteTimeWindows=og,L.supermap.plotting.SatelliteTimeWindows=ig;var ng=xh.extend({symbolTexts:[],addFrame:!1,getFrame:function(){return this.addFrame},setFrame:function(t){this.addFrame!==t&&(this.addFrame=t,this.redraw())},updateSymbolText:function(t,e){this.symbolTexts.length>e&&(this.symbolTexts[e]=t,this.redraw())},removeSymbolTextsFromDotSymbol:function(t){if(t&&"string"==typeof t){var e=this._map.getFeatureByUuid(t);if(e)for(var i=0,o=e.geoSymbolTexts.length;i<o;i++)if(this===e.geoSymbolTexts[i]){e.geoSymbolTexts.splice(i,1);break}}},initialize:function(t,e,i,o){this.libID=0,this.code=SuperMap.Plot.SymbolType.SYMBOLTEXT,this.symbolType=SuperMap.Plot.SymbolType.SYMBOLTEXT,this.symbolName="对象标注",xh.prototype.initialize.call(this,t,e,i,o),this.scaleByMap=!0,this.style.sizeFixed=!1},_calculateParts:function(){if(!("none"===this.style.display||null!=this.layer&&"function"==typeof this.layer.getVisibility&&!1===this.layer.getVisibility()||this.symbolTexts.length<=0)){var t=this._map.getFeatureByUuid(this.associatedUuid);if(null!=t&&"none"!==t.style.display){this.latLngs=[];for(var e=[],i=this.symbolTexts,o=!1,n=t.geoSymbolTexts,l=0,s=n.length;l<s;l++)if(this===n[l]){o=!0;break}o||n.push(this),null==this.minScale&&(this.minScale=t.minScale),null==this.maxScale&&(this.maxScale=t.maxScale);var a=1;"function"==typeof this.layer.getSymZoomScale&&(a=this.layer.getSymZoomScale()),null!=this.minScale&&a<this.minScale?a=this.minScale:null!=this.maxScale&&a>this.maxScale&&(a=this.maxScale);var r={surroundLineFlag:!1,lineColorLimit:!0,fillColorLimit:!0,lineWidthLimit:!0,lineTypeLimit:!0,fontColorLimit:!0,fontSizeLimit:!0,fillLimit:!0},u=t.getBounds();if((null==u||!u.isValid())&&null!=t.graphic&&null!=t.graphic.layer&&null!=t.graphic.getImage()){t.graphic._project();var p=t.graphic._pxBounds;null!=p&&p.isValid()&&(u.extend(this._map.layerPointToLatLng(p.min)),u.extend(this._map.layerPointToLatLng(p.max)))}if(u&&u.isValid()){for(var h=0,c=i.length;h<c;h++){this._mergeStyleToSymbolText(i[h]);var y=i[h].textContent;if(null!==y&&0!==y.length){var g=this.addFrame||i[h].border;i[h].textPosition=void 0===i[h].textPosition?0:i[h].textPosition;var f,d,m,S=0,P=0;if(g)(r=SuperMap.Plot.PlottingUtil.cloneObject(i[h].style)).fontSize*=a,S=SuperMap.Plot.PlottingUtil.getTextWidth(r,i[h].textContent)+i[h].paddingX*a*2,P=parseInt(r.fontSize)+i[h].paddingY*a*2;var b=L.point(0,0),v=L.point(0,0);switch(i[h].textPosition){case SuperMap.Plot.AnnoPosition.LEFTTOP:i[h].style.labelAlign="rb",f=L.latLng(u.getNorth(),u.getWest()),(d=this._map.latLngToLayerPoint(f)).x+=i[h].offsetX*a,d.y+=i[h].offsetY*a,!0===g&&(b.x=d.x,b.y=d.y,v.x=d.x-S,v.y=d.y-P);break;case SuperMap.Plot.AnnoPosition.LEFTBOTTOM:i[h].style.labelAlign="rt",f=L.latLng(u.getSouth(),u.getWest()),(d=this._map.latLngToLayerPoint(f)).x+=i[h].offsetX*a,d.y+=i[h].offsetY*a,!0===g&&(b.x=d.x,b.y=d.y,v.x=d.x-S,v.y=d.y+P);break;case SuperMap.Plot.AnnoPosition.RIGHTTOP:i[h].style.labelAlign="lb",f=L.latLng(u.getNorth(),u.getEast()),(d=this._map.latLngToLayerPoint(f)).x+=i[h].offsetX*a,d.y+=i[h].offsetY*a,!0===g&&(b.x=d.x,b.y=d.y,v.x=d.x+S,v.y=d.y-P);break;case SuperMap.Plot.AnnoPosition.RIGHTBOTTOM:i[h].style.labelAlign="lt",f=L.latLng(u.getSouth(),u.getEast()),(d=this._map.latLngToLayerPoint(f)).x+=i[h].offsetX*a,d.y+=i[h].offsetY*a,!0===g&&(b.x=d.x,b.y=d.y,v.x=d.x+S,v.y=d.y+P);break;case SuperMap.Plot.AnnoPosition.TOP:i[h].style.labelAlign="cb",f=L.latLng(u.getNorth(),(u.getWest()+u.getEast())/2),(d=this._map.latLngToLayerPoint(f)).x+=i[h].offsetX*a,d.y+=i[h].offsetY*a,!0===g&&(b.x=d.x-S/2,b.y=d.y,v.x=d.x+S/2,v.y=d.y-P);break;case SuperMap.Plot.AnnoPosition.BOTTOM:i[h].style.labelAlign="ct",f=L.latLng(u.getSouth(),(u.getWest()+u.getEast())/2),(d=this._map.latLngToLayerPoint(f)).x+=i[h].offsetX*a,d.y+=i[h].offsetY*a,!0===g&&(b.x=d.x-S/2,b.y=d.y,v.x=d.x+S/2,v.y=d.y+P);break;case SuperMap.Plot.AnnoPosition.LEFT:i[h].style.labelAlign="rm",f=L.latLng((u.getSouth()+u.getNorth())/2,u.getWest()),(d=this._map.latLngToLayerPoint(f)).x+=i[h].offsetX*a,d.y+=i[h].offsetY*a,!0===g&&(b.x=d.x,b.y=d.y+P/2,v.x=d.x-S,v.y=d.y-P/2);break;case SuperMap.Plot.AnnoPosition.RIGHT:i[h].style.labelAlign="lm",f=L.latLng((u.getSouth()+u.getNorth())/2,u.getEast()),(d=this._map.latLngToLayerPoint(f)).x+=i[h].offsetX*a,d.y+=i[h].offsetY*a,!0===g&&(b.x=d.x,b.y=d.y+P/2,v.x=d.x+S,v.y=d.y-P/2);break;case SuperMap.Plot.AnnoPosition.ANCHOR:i[h].style.labelAlign="lm",f=t.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL?t.latLngs[0]:u.getCenter(),(d=this._map.latLngToLayerPoint(f)).x+=i[h].offsetX*a,d.y+=i[h].offsetY*a,i[h].offsetX>0?(i[h].style.labelAlign="lm",!0===g&&(b.x=d.x,b.y=d.y+P/2,v.x=d.x+S,v.y=d.y-P/2)):(i[h].style.labelAlign="rm",!0===g&&(b.x=d.x,b.y=d.y+P/2,v.x=d.x-S,v.y=d.y-P/2))}var M=this._map.layerPointToLatLng(d);if(0!==i[h].offsetX||0!==i[h].offsetY){var _={};_.positionPoints=[M,f],_.style={},_.type=SuperMap.Plot.SymbolType.POLYLINESYMBOL,e.push(_)}var A=SuperMap.Util.copyAttributes(r,this.symbolTexts[h].style);if(g){var T=this._map.layerPointToLatLng(b),x=this._map.layerPointToLatLng(v),O={};O.positionPoints=[T,x],O.style=SuperMap.Util.cloneObject(A),O.type=SuperMap.Plot.SymbolType.RECTANGLESYMBOL,e.push(O),m=L.latLng((x.lat-T.lat)/2+T.lat,(T.lng-x.lng)/2+x.lng)}else m=M;var w={};w.positionPoints=m,w.type=SuperMap.Plot.SymbolType.TEXTSYMBOL,w.style=SuperMap.Util.cloneObject(A),w.textContent=i[h].textContent,g&&(w.style.labelAlign="cm"),e.push(w),this.latLngs.push(M)}}for(var C,E=0;E<e.length;E++)C=L.Util.isArray(e[E].positionPoints)?e[E].positionPoints:[e[E].positionPoints],this._createAndDrawLayer(e[E].type,C,e[E].style,e[E].textContent)}}}},_calculatePositionPoints:function(){this.latLngs=[];var t=this.symbolTexts;if(t.length>0){var e=this._map.getFeatureByUuid(this.associatedUuid);if(null===e||void 0===e)return;var i=e.getBounds();if((null==i||!i.isValid())&&null!=e.graphic&&null!=e.graphic.layer&&null!=e.graphic.getImage()){e.graphic._project();var o=e.graphic._pxBounds;null!=o&&o.isValid()&&(i.extend(this._map.layerPointToLatLng(o.min)),i.extend(this._map.layerPointToLatLng(o.max)))}if(!i||!i.isValid())return;for(var n=0,l=t.length;n<l;n++){var s=t[n].textContent;if(null!==s&&0!==s.length){var a;switch(t[n].textPosition=void 0===t[n].textPosition?0:t[n].textPosition,t[n].textPosition){case SuperMap.Plot.AnnoPosition.LEFTTOP:a=L.latLng(i.getNorth(),i.getWest());break;case SuperMap.Plot.AnnoPosition.LEFTBOTTOM:a=L.latLng(i.getSouth(),i.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHTTOP:a=L.latLng(i.getNorth(),i.getEast());break;case SuperMap.Plot.AnnoPosition.RIGHTBOTTOM:a=L.latLng(i.getSouth(),i.getEast());break;case SuperMap.Plot.AnnoPosition.TOP:a=L.latLng(i.getNorth(),(i.getWest()+i.getEast())/2);break;case SuperMap.Plot.AnnoPosition.BOTTOM:a=L.latLng(i.getSouth(),(i.getWest()+i.getEast())/2);break;case SuperMap.Plot.AnnoPosition.LEFT:a=L.latLng((i.getSouth()+i.getNorth())/2,i.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHT:a=L.latLng((i.getSouth()+i.getNorth())/2,i.getEast());break;case SuperMap.Plot.AnnoPosition.ANCHOR:t[n].style.labelAlign="lm",a=e.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL?e.latLngs[0]:i.getCenter()}var r=this._map.latLngToLayerPoint(a);r.x+=t[n].offsetX,r.y+=t[n].offsetY,this.latLngs.push(this._map.layerPointToLatLng(r))}}}},destroy:function(){this.frame=!1,this.symbolTexts=null,xh.prototype.destroy.call(this)},_mergeStyleToSymbolText:function(t){if(null!==this.components)for(var e in null!==t.style&&void 0!==t.style||(t.style={}),this.style)Object.prototype.hasOwnProperty.call(t.style,e)||(t.style[e]=this.style[e])},_modifyPoint:function(t,e){this._calculateOffset(t,e),this.redraw()},_calculateOffset:function(t,e){if(t<this.symbolTexts.length){var i=this.symbolTexts[t].textPosition,o=this._map.latLngToLayerPoint(e),n=this._map.getFeatureByUuid(this.associatedUuid);if(null===n||void 0===n)return;var l=n.getBounds();if((null==l||!l.isValid())&&null!=n.graphic&&null!=n.graphic.layer&&null!=n.graphic.getImage()){n.graphic._project();var s=n.graphic._pxBounds;null!=s&&s.isValid()&&(l.extend(this._map.layerPointToLatLng(s.min)),l.extend(this._map.layerPointToLatLng(s.max)))}if(!l||!l.isValid())return;var a,r,u=1;"function"==typeof this.layer.getSymZoomScale&&(u=this.layer.getSymZoomScale()),null!=this.minScale&&u<this.minScale?u=this.minScale:null!=this.maxScale&&u>this.maxScale&&(u=this.maxScale),0===i?(a=L.latLng(l.getNorth(),l.getWest()),r=this._map.latLngToLayerPoint(a),this.symbolTexts[t].offsetX=(o.x-r.x)/u,this.symbolTexts[t].offsetY=(o.y-r.y)/u):1===i?(a=L.latLng(l.getSouth(),l.getWest()),r=this._map.latLngToLayerPoint(a),this.symbolTexts[t].offsetX=(o.x-r.x)/u,this.symbolTexts[t].offsetY=(o.y-r.y)/u):2===i?(a=L.latLng(l.getNorth(),l.getEast()),r=this._map.latLngToLayerPoint(a),this.symbolTexts[t].offsetX=(o.x-r.x)/u,this.symbolTexts[t].offsetY=(o.y-r.y)/u):3===i?(a=L.latLng(l.getSouth(),l.getEast()),r=this._map.latLngToLayerPoint(a),this.symbolTexts[t].offsetX=(o.x-r.x)/u,this.symbolTexts[t].offsetY=(o.y-r.y)/u):4===i?(a=L.latLng(l.getNorth(),(l.getWest()+l.getEast())/2),r=this._map.latLngToLayerPoint(a),this.symbolTexts[t].offsetX=(o.x-r.x)/u,this.symbolTexts[t].offsetY=(o.y-r.y)/u):5===i?(a=L.latLng(l.getSouth(),(l.getWest()+l.getEast())/2),r=this._map.latLngToLayerPoint(a),this.symbolTexts[t].offsetX=(o.x-r.x)/u,this.symbolTexts[t].offsetY=(o.y-r.y)/u):6===i?(a=L.latLng((l.getNorth()+l.getSouth())/2,l.getWest()),r=this._map.latLngToLayerPoint(a),this.symbolTexts[t].offsetX=(o.x-r.x)/u,this.symbolTexts[t].offsetY=(o.y-r.y)/u):7===i?(a=L.latLng((l.getNorth()+l.getSouth())/2,l.getEast()),r=this._map.latLngToLayerPoint(a),this.symbolTexts[t].offsetX=(o.x-r.x)/u,this.symbolTexts[t].offsetY=(o.y-r.y)/u):i===SuperMap.Plot.AnnoPosition.ANCHOR&&(a=n.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL?n.latLngs[0]:l.getCenter(),r=this._map.latLngToLayerPoint(a),this.symbolTexts[t].offsetX=(o.x-r.x)/u,this.symbolTexts[t].offsetY=(o.y-r.y)/u)}},_reView:function(){this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},move:function(){},_parseSymbolData:function(){if(xh.prototype._parseSymbolData.call(this),this.symbolData){this.addFrame=this.symbolData.addFrame,this.symbolTexts=[];for(var t=0,e=this.symbolData.symbolTexts.length;t<e;t++){var i=new SuperMap.Plot.GeoSymbolText;i.textContent=this.symbolData.symbolTexts[t].textContent,i.textPosition=this.symbolData.symbolTexts[t].textPosition,i.style=this.symbolData.symbolTexts[t].style,i.offsetX=this.symbolData.symbolTexts[t].offsetX,i.offsetY=this.symbolData.symbolTexts[t].offsetY,this.symbolTexts.push(i)}}},_setSymbolData:function(){xh.prototype._setSymbolData.call(this),this.symbolData&&(this.symbolData.symbolTexts=this.symbolTexts,this.symbolData.addFrame=this.addFrame)},setStyle:function(t){if(t.fontSize&&this.style.fontSize!==t.fontSize||this.style.display!==t.display&&t.display){SuperMap.Util.extend(this.style,t);for(var e=0,i=this.symbolTexts.length;e<i;e++)SuperMap.Util.copyAttributes(this.symbolTexts[e].style,t);this.redraw()}else{SuperMap.Util.extend(this.style,t);for(var o=0;o<this.symbolTexts.length;o++)SuperMap.Util.copyAttributes(this.symbolTexts[o].style,t);for(var n=0;n<this.components.length;n++)delete t.labelAlign,SuperMap.Util.copyAttributes(this.components[n].options,t),this._copyStyleForCell(this.components[n].options,this.style,this.components[n]),this.components[n].setStyle(this.components[n].options)}}}),lg=function(t,e,i,o){return new ng(t,e,i,o)};L.supermap.plotting.symbolText=lg,L.supermap.plotting.SymbolText=ng;var sg=xh.extend({space:null,offsetX:null,offsetY:null,initialize:function(t,e,i,o){this.minEditPts=1,this.maxEditPts=1,this.libID=0,this.code=SuperMap.Plot.SymbolType.SYMBOLTEXT1,this.symbolType=SuperMap.Plot.SymbolType.SYMBOLTEXT1,this.symbolName="对象标注(带指示线)",null===this.space&&(this.space=10),null===this.offsetX&&(this.offsetX=60),null===this.offsetY&&(this.offsetY=30),xh.prototype.initialize.call(this,t,e,i,o),this.scaleByMap=!0,this.style.sizeFixed=!1},destroy:function(){this.space=null,this.offsetX=null,this.offsetY=null,xh.prototype.destroy.call(this)},removeSymbolTextsFromDotSymbol:function(t){if(t&&"string"==typeof t){var e=this._map.getFeatureByUuid(t);if(e)for(var i=0,o=e.geoSymbolTexts.length;i<o;i++)if(this===e.geoSymbolTexts[i]){e.geoSymbolTexts.splice(i,1);break}}},_calculateParts:function(){if("none"!==this.style.display&&(null==this.layer||"function"!=typeof this.layer.getVisibility||!1!==this.layer.getVisibility())){var t=this._map.getFeatureByUuid(this.associatedUuid);if(null!=t&&"none"!==t.style.display){this.latLngs=[];for(var e=[],i=!1,o=0;o<t.geoSymbolTexts.length;o++)if(this===t.geoSymbolTexts[o]){i=!0;break}i||t.geoSymbolTexts.push(this),null==this.minScale&&(this.minScale=t.minScale),null==this.maxScale&&(this.maxScale=t.maxScale);var n=1;"function"==typeof this.layer.getSymZoomScale&&(n=this.layer.getSymZoomScale()),null!=this.minScale&&n<this.minScale?n=this.minScale:null!=this.maxScale&&n>this.maxScale&&(n=this.maxScale);var l=t.latLngs[0],s=this._map.latLngToLayerPoint(l),a=new SuperMap.Pixel(s.x+this.offsetX*n,s.y+this.offsetY*n),r=this._map.layerPointToLatLng(a);0===this.latLngs.length?this.latLngs.push(r):(this.latLngs[0].lng=r.lng,this.latLngs[0].lat=r.lat);var u=L.Util.cloneLatLngs(this.latLngs[0]);u.push(l);var p={style:{surroundLineFlag:!1}};p.style=SuperMap.Util.copyAttributes(p.style,this.style),p.positionPoints=u,p.type=24,e.push(p),SuperMap.Util.isArray(this.textContent)||(this.textContent=[this.textContent]);var h=this.textContent.length,c=this.style.fontSize*h*n+h+1,y=this._map.latLngToLayerPoint(L.latLng(this.latLngs[0].lat,this.latLngs[0].lng)),g=L.point(y.x,y.y-c/2),f=L.point(y.x,y.y+c/2),d=[this._map.layerPointToLatLng(g),this._map.layerPointToLatLng(f)],m={};m.positionPoints=d,m.style={surroundLineFlag:!1},m.style=SuperMap.Util.copyAttributes(m.style,this.style),m.type=24,e.push(m);var S,P=new SuperMap.Geometry.Point(this.latLngs[0].lng,this.latLngs[0].lat);if(0!==this.textContent.length){for(var b=t.getBounds(),v=new SuperMap.Geometry.Point((b.getWest()+b.getEast())/2,b.getNorth()),M=new SuperMap.Geometry.Point((b.getWest()+b.getEast())/2,b.getSouth()),_=SuperMap.Plot.PlottingUtil.pointIsRightToLine(v,M,P),A="",T=0;T<this.textContent.length;T++)A+=this.textContent[T],T!==this.textContent.length-1&&(A+="\r\n");var x=null;x=!0===_?L.point(y.x-this.space,y.y):L.point(y.x+this.space,y.y);var O={},w=this._map.layerPointToLatLng(x);O.positionPoints=w,O.type=34,O.textContent=A,O.style={},O.style=SuperMap.Util.copyAttributes(O.style,this.style),Object.prototype.hasOwnProperty.call(O.style,"sizeFixed")&&delete O.style.sizeFixed,O.style.labelAlign=!0===_?"rm":"lm",e.push(O)}for(var C=0;C<e.length;C++)S=L.Util.isArray(e[C].positionPoints)?e[C].positionPoints:[e[C].positionPoints],this._createAndDrawLayer(e[C].type,S,e[C].style,e[C].textContent)}}},_calculateSize:function(t){this.scaleByMap=t.scaleByMap,!1===this.scaleByMap||!0===this.style.sizeFixed?this.fromZoom=this._map.getZoom():this.fromZoom<=this._map.getZoom()&&(this.dScale=scale),void 0!==this.prevOffsetX&&this.prevOffsetX!==this.offsetX&&(this.scaleBeforeOffsetX=this.offsetX/scale,this.prevOffsetX=this.offsetX),!0===this.scaleByMap&&(void 0===this.scaleBeforeOffsetX&&(this.scaleBeforeOffsetX=this.offsetX),this.offsetX=this.scaleBeforeOffsetX*scale,this.prevOffsetX=this.offsetX),void 0!==this.prevOffsetY&&this.prevOffsetY!==this.offsetY&&(this.scaleBeforeOffsetY=this.offsetY/scale,this.prevOffsetY=this.offsetY),!0===this.scaleByMap&&(void 0===this.scaleBeforeOffsetY&&(this.scaleBeforeOffsetY=this.offsetY),this.offsetY=this.scaleBeforeOffsetY*scale,this.prevOffsetY=this.offsetY),void 0!==this.prevStrokeWidth&&this.prevStrokeWidth!==this.style.weight&&(this.strokeWidth=this.style.weight,this.prevStrokeWidth=this.style.weight),!0===this.scaleByMap&&(void 0===this.weight&&(this.weight=this.style.weight),this.fromZoom<=this._map.getZoom()?this.style.weight=t.style.weight:this.style.weight=this.weight,this.prevStrokeWidth=this.style.weight),void 0!==this.prevFontSize&&this.prevFontSize!==this.style.fontSize&&(this.fontSize=this.style.fontSize/scale,this.prevFontSize=this.style.fontSize),!0===this.scaleByMap&&(void 0===this.fontSize&&(this.fontSize=this.style.fontSize),this.style.fontSize=this.fontSize,this.prevFontSize=this.style.fontSize)},_reView:function(){this.fire(SuperMap.Plot.Event.reseteditmarkersvalues)},_modifyPoint:function(){var t=this._map.getFeatureByUuid(this.associatedUuid);if(null!==t){var e=this._map.latLngToLayerPoint(L.latLng(t.latLngs[0].lat,t.latLngs[0].lng)),i=this._map.latLngToLayerPoint(L.latLng(this.latLngs[0].lat,this.latLngs[0].lng)),o=1;"function"==typeof this.layer.getSymZoomScale&&(o=this.layer.getSymZoomScale()),null!=this.minScale&&o<this.minScale?o=this.minScale:null!=this.maxScale&&o>this.maxScale&&(o=this.maxScale),this.offsetX=(i.x-e.x)/o,this.offsetY=(i.y-e.y)/o,this.redraw()}},_parseSymbolData:function(){xh.prototype._parseSymbolData.call(this),this.symbolData&&(void 0!==this.symbolData.space&&(this.space=this.symbolData.space),void 0!==this.symbolData.offsetX&&(this.offsetX=this.symbolData.offsetX),void 0!==this.symbolData.offsetY&&(this.offsetY=this.symbolData.offsetY),void 0!==this.symbolData.scaleBeforeOffsetX&&(this.scaleBeforeOffsetX=this.symbolData.scaleBeforeOffsetX),void 0!==this.symbolData.scaleBeforeOffsetY&&(this.scaleBeforeOffsetY=this.symbolData.scaleBeforeOffsetY))},_setSymbolData:function(){xh.prototype._setSymbolData.call(this),this.symbolData&&(this.symbolData.space=this.space,this.symbolData.offsetX=this.offsetX,this.symbolData.offsetY=this.offsetY,void 0!==this.scaleBeforeOffsetX&&(this.symbolData.scaleBeforeOffsetX=this.scaleBeforeOffsetX),void 0!==this.scaleBeforeOffsetY&&(this.symbolData.scaleBeforeOffsetY=this.scaleBeforeOffsetY))}}),ag=function(t,e,i,o){return new sg(t,e,i,o)};L.supermap.plotting.symbolText1=ag,L.supermap.plotting.SymbolText1=sg;var rg=function(t,e,i,o,n,l){o||(o={}),o.custom=l;var s=null;if(o&&o.symbolData&&o.symbolData.textStyle2D&&void 0===o.symbolData.textStyle2D.sizeFixed&&(o.symbolData.textStyle2D.sizeFixed=!0),null==i||SuperMap.Util.isArray(i)||(i=[i]),0===t)switch(e){case SuperMap.Plot.SymbolType.ARCREGION:s=L.supermap.plotting.arcRegion(t,e,i,o);break;case SuperMap.Plot.SymbolType.MISSILEROUTE:s=L.supermap.plotting.missileRoute(t,e,i,o);break;case SuperMap.Plot.SymbolType.NAVYROUTE:s=L.supermap.plotting.navyRoute(t,e,i,o);break;case SuperMap.Plot.SymbolType.AIRROUTE:s=L.supermap.plotting.airRoute(t,e,i,o);break;case SuperMap.Plot.SymbolType.LITERATESIGN:s=L.supermap.plotting.literateSign(t,e,i,o);break;case SuperMap.Plot.SymbolType.ROUTENODE:s=L.supermap.plotting.routeNode(t,e,i,o);break;case SuperMap.Plot.SymbolType.PATHTEXT:s=L.supermap.plotting.pathText(t,e,i,o);break;case SuperMap.Plot.SymbolType.FREECURVE:s=L.supermap.plotting.freeCurve(t,e,i,o);break;case SuperMap.Plot.SymbolType.LINERELATION:s=L.supermap.plotting.lineRelation(t,e,i,o);break;case SuperMap.Plot.SymbolType.GROUPOBJECT:s=L.supermap.plotting.groupObject(t,e,i,o);break;case SuperMap.Plot.SymbolType.INTERFERENCEBEAM:s=L.supermap.plotting.interferenceBeam(t,e,i,o);break;case SuperMap.Plot.SymbolType.SATELLITE:s=L.supermap.plotting.satellite(t,e,i,o);break;case SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS:s=L.supermap.plotting.satelliteTimeWindows(t,e,i,o);break;case SuperMap.Plot.SymbolType.SYMBOLTEXT:s=L.supermap.plotting.symbolText(t,e,i,o);break;case SuperMap.Plot.SymbolType.SYMBOLTEXT1:s=L.supermap.plotting.symbolText1(t,e,i,o);break;case SuperMap.Plot.SymbolType.FLAGGROUP:s=L.supermap.plotting.flagGroup(t,e,i,o);break;case SuperMap.Plot.SymbolType.NAVYDEPLOYMENT:s=L.supermap.plotting.navyDeployment(t,e,i,o);break;case SuperMap.Plot.SymbolType.AIRDEPLOYMENT:s=L.supermap.plotting.airDeployment(t,e,i,o);break;case SuperMap.Plot.SymbolType.AVOIDREGION:return L.supermap.plotting.avoidRegion(t,e,i,o);case SuperMap.Plot.SymbolType.PICTURE:case 3e3:case SuperMap.Plot.SymbolType.MODELPLOT:case SuperMap.Plot.SymbolType.BOARD:s=L.supermap.plotting.picture(t,e,i,o);break;case SuperMap.Plot.SymbolType.CLUSTEROBJECT:s=L.supermap.plotting.symbolGroup(t,e,i,o);break;default:s=L.supermap.plotting.algoSymbol(t,e,i,o)}else s=o.symbolData&&o.symbolData.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL?L.supermap.plotting.dotSymbol(t,e,i,o):L.supermap.plotting.algoSymbol(t,e,i,o);var a=L.supermap.plotting.getControl().getDefaultStyle();return SuperMap.Plot.AnalysisSymbol.mergeDefaultStyleToFeature(s,a,!0),n&&SuperMap.Util.extend(s.style,n),null!=i&&i.length>0&&(i.length>s.maxEditPts&&(i=i.slice(0,s.maxEditPts)),s.latLngs=L.Util.cloneLatLngs(i)),s};function ug(t){"@babel/helpers - typeof";return(ug="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pg(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,hg(o.key),o)}}function hg(t){var e=function(t,e){if("object"!=ug(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=ug(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ug(e)?e:e+""}L.supermap.plotting.PlottingObject.createSymbol=rg,L.supermap.plotting.createSymbol=rg;var cg=function(t,e,i){return e&&pg(t.prototype,e),i&&pg(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}),yg=function(){return{escape:function(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:e,mimeType:function(t){var i=e(t).toLowerCase();return(o="application/font-woff",{woff:o,woff2:o,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[i]||"";var o},dataAsUrl:function(t,e){return"data:"+e+";base64,"+t},isDataUrl:function(t){return-1!==t.search(/^(data:)/)},canvasToBlob:function(t){return t.toBlob?new Promise(function(e){t.toBlob(e)}):function(t){return new Promise(function(e){for(var i=window.atob(t.toDataURL().split(",")[1]),o=i.length,n=new Uint8Array(o),l=0;l<o;l++)n[l]=i.charCodeAt(l);e(new Blob([n],{type:"image/png"}))})}(t)},resolveUrl:function(t,e){var i=document.implementation.createHTMLDocument(),o=i.createElement("base");i.head.appendChild(o);var n=i.createElement("a");return i.body.appendChild(n),o.href=e,n.href=t,n.href},getAndEncode:function(t){var e=3e4;cg.impl.options.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());return new Promise(function(i){var o,n=new XMLHttpRequest;if(n.onreadystatechange=function(){if(4!==n.readyState)return;if(200!==n.status)return void(o?i(o):s("cannot fetch resource: "+t+", status: "+n.status));var e=new FileReader;e.onloadend=function(){var t=e.result.split(/,/)[1];i(t)},e.readAsDataURL(n.response)},n.ontimeout=function(){o?i(o):s("timeout of "+e+"ms occured while fetching resource: "+t)},n.responseType="blob",n.timeout=e,n.open("GET",t,!0),n.send(),cg.impl.options.imagePlaceholder){var l=cg.impl.options.imagePlaceholder.split(/,/);l&&l[1]&&(o=l[1])}function s(t){console.error(t),i("")}})},uid:(t=0,function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+t++}),delay:function(t){return function(e){return new Promise(function(i){setTimeout(function(){i(e)},t)})}},asArray:function(t){for(var e=[],i=t.length,o=0;o<i;o++)e.push(t[o]);return e},escapeXhtml:function(t){return t.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(t){return new Promise(function(e,i){var o=new Image;o.onload=function(){e(o)},o.onerror=i,o.src=t})},width:function(t){var e=i(t,"border-left-width"),o=i(t,"border-right-width");return t.scrollWidth+e+o},height:function(t){var e=i(t,"border-top-width"),o=i(t,"border-bottom-width");return t.scrollHeight+e+o}};var t;function e(t){var e=/\.([^\.\/]*?)$/g.exec(t);return e?e[1]:""}function i(t,e){var i=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(i.replace("px",""))}}(),gg=function(){var t=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(t,n,l){return e(t)?Promise.resolve(t).then(i).then(function(e){var i=Promise.resolve(t);return e.forEach(function(t){i=i.then(function(e){return o(e,t,n,l)})}),i}):Promise.resolve(t)},shouldProcess:e,impl:{readUrls:i,inline:o}};function e(e){return-1!==e.search(t)}function i(e){for(var i,o=[];null!==(i=t.exec(e));)o.push(i[1]);return o.filter(function(t){return!yg.isDataUrl(t)})}function o(t,e,i,o){return Promise.resolve(e).then(function(t){return i?yg.resolveUrl(t,i):t}).then(o||yg.getAndEncode).then(function(t){return yg.dataAsUrl(t,yg.mimeType(e))}).then(function(i){return t.replace(function(t){return new RegExp("(url\\(['\"]?)("+yg.escape(t)+")(['\"]?\\))","g")}(e),"$1"+i+"$3")})}}(),fg=function(){return{resolveAll:function(){return t(document).then(function(t){return Promise.all(t.map(function(t){return t.resolve()}))}).then(function(t){return t.join("\n")})},impl:{readAll:t}};function t(){return Promise.resolve(yg.asArray(document.styleSheets)).then(function(t){var e=[];return t.forEach(function(t){try{yg.asArray(t.cssRules||[]).forEach(e.push.bind(e))}catch(e){console.log("Error while reading CSS rules from "+t.href,e.toString())}}),e}).then(function(t){return t.filter(function(t){return t.type===CSSRule.FONT_FACE_RULE}).filter(function(t){return gg.shouldProcess(t.style.getPropertyValue("src"))})}).then(function(e){return e.map(t)});function t(t){return{resolve:function(){var e=(t.parentStyleSheet||{}).href;return gg.inlineAll(t.cssText,e)},src:function(){return t.style.getPropertyValue("src")}}}}}(),dg=function(){return{inlineAll:function e(i){if(!(i instanceof Element))return Promise.resolve(i);return function(t){var e=t.style.getPropertyValue("background");return e?gg.inlineAll(e).then(function(e){t.style.setProperty("background",e,t.style.getPropertyPriority("background"))}).then(function(){return t}):Promise.resolve(t)}(i).then(function(){return i instanceof HTMLImageElement?t(i).inline():Promise.all(yg.asArray(i.childNodes).map(function(t){return e(t)}))})},impl:{newImage:t}};function t(t){return{inline:function(e){return yg.isDataUrl(t.src)?Promise.resolve():Promise.resolve(t.src).then(e||yg.getAndEncode).then(function(e){return yg.dataAsUrl(e,yg.mimeType(t.src))}).then(function(e){return new Promise(function(i,o){t.onload=i,t.onerror=o,t.src=e})})}}}}(),mg={imagePlaceholder:void 0,cacheBust:!1};function Sg(t,e){return function(t){void 0===t.imagePlaceholder?cg.impl.options.imagePlaceholder=mg.imagePlaceholder:cg.impl.options.imagePlaceholder=t.imagePlaceholder;void 0===t.cacheBust?cg.impl.options.cacheBust=mg.cacheBust:cg.impl.options.cacheBust=t.cacheBust}(e=e||{}),Promise.resolve(t).then(function(t){return function(t,e,i){if(!i&&e&&!e(t))return Promise.resolve();return Promise.resolve(t).then(function(t){return t instanceof HTMLCanvasElement?yg.makeImage(t.toDataURL()):t.cloneNode(!1)}).then(function(i){return function(t,e,i){var o=t.childNodes;return 0===o.length?Promise.resolve(e):function(t,e,i){var o=Promise.resolve();return e.forEach(function(e){o=o.then(function(){return bg(e,i)}).then(function(e){e&&t.appendChild(e)})}),o}(e,yg.asArray(o),i).then(function(){return e})}(t,i,e)}).then(function(e){return function(t,e){return e instanceof Element?Promise.resolve().then(function(){var i,o;i=window.getComputedStyle(t),o=e.style,i.cssText?o.cssText=i.cssText:function(t,e){yg.asArray(t).forEach(function(i){e.setProperty(i,t.getPropertyValue(i),t.getPropertyPriority(i))})}(i,o)}).then(function(){[":before",":after"].forEach(function(i){!function(i){var o=window.getComputedStyle(t,i),n=o.getPropertyValue("content");if(""!==n&&"none"!==n){var l=yg.uid();e.className=e.className+" "+l;var s=document.createElement("style");s.appendChild(function(t,e,i){var o="."+t+":"+e,n=i.cssText?function(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}(i):function(t){return yg.asArray(t).map(function(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}).join("; ")+";"}(i);return document.createTextNode(o+"{"+n+"}")}(l,i,o)),e.appendChild(s)}}(i)})}).then(function(){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}).then(function(){e instanceof SVGElement&&(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e instanceof SVGRectElement&&["width","height"].forEach(function(t){var i=e.getAttribute(t);i&&e.style.setProperty(t,i)}))}).then(function(){return e}):e}(t,e)})}(t,e.filter,!0)}).then(vg).then(Lg).then(function(t){e.bgcolor&&(t.style.backgroundColor=e.bgcolor);e.width&&(t.style.width=e.width+"px");e.height&&(t.style.height=e.height+"px");e.style&&Object.keys(e.style).forEach(function(i){t.style[i]=e.style[i]});return t}).then(function(i){return function(t,e,i){return Promise.resolve(t).then(function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(t)}).then(yg.escapeXhtml).then(function(t){return'<foreignObject x="0" y="0" width="100%" height="100%">'+t+"</foreignObject>"}).then(function(t){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+i+'">'+t+"</svg>"}).then(function(t){return"data:image/svg+xml;charset=utf-8,"+t})}(i,e.width||yg.width(t),e.height||yg.height(t))})}function Pg(t,e){return Sg(t,e).then(yg.makeImage).then(yg.delay(100)).then(function(i){var o=function(t){var i=document.createElement("canvas"),o=i.getContext("2d");o.mozImageSmoothingEnabled=!1,o.webkitImageSmothingEnabled=!1,o.msImageSmothingEnabled=!1,o.imageSmoothingEnabled=!1;var n=e.scale||1;i.width=e.width||yg.width(t)*n,i.height=e.height||yg.height(t)*n,o.scale(n,n),e.bgcolor&&(o.fillStyle=e.bgcolor,o.fillRect(0,0,i.width,i.height));return i}(t);return o.getContext("2d").drawImage(i,0,0),o})}function bg(t,e,i){if(!i&&e&&!e(t))return Promise.resolve();return Promise.resolve(t).then(o).then(function(i){return n(t,i,e)}).then(function(e){return l(t,e)});function o(t){return t instanceof HTMLCanvasElement?yg.makeImage(t.toDataURL()):t.cloneNode(!1)}function n(t,e,i){var o=t.childNodes;return 0===o.length?Promise.resolve(e):function(t,e,i){var o=Promise.resolve();return e.forEach(function(e){o=o.then(function(){return bg(e,i)}).then(function(e){e&&t.appendChild(e)})}),o}(e,yg.asArray(o),i).then(function(){return e});function n(t,e,i){var o=Promise.resolve();return e.forEach(function(e){o=o.then(function(){return bg(e,i)}).then(function(e){e&&t.appendChild(e)})}),o}}function l(t,e){return e instanceof Element?Promise.resolve().then(function(){!function(t,e){t.cssText?e.cssText=t.cssText:function(t,e){yg.asArray(t).forEach(function(i){e.setProperty(i,t.getPropertyValue(i),t.getPropertyPriority(i))})}(t,e)}(window.getComputedStyle(t),e.style)}).then(function(){[":before",":after"].forEach(function(i){!function(i){var o=window.getComputedStyle(t,i),n=o.getPropertyValue("content");if(""===n||"none"===n)return;var l=yg.uid();e.className=e.className+" "+l;var s=document.createElement("style");s.appendChild(function(t,e,i){var o="."+t+":"+e,n=i.cssText?function(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}(i):function(t){return yg.asArray(t).map(function(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}).join("; ")+";"}(i);return document.createTextNode(o+"{"+n+"}")}(l,i,o)),e.appendChild(s)}(i)})}).then(function(){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value);t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}).then(function(){if(!(e instanceof SVGElement))return;if(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),!(e instanceof SVGRectElement))return;["width","height"].forEach(function(t){var i=e.getAttribute(t);i&&e.style.setProperty(t,i)})}).then(function(){return e}):e;function i(){function i(t,e){if(t.cssText)e.cssText=t.cssText;else i(t,e);function i(t,e){yg.asArray(t).forEach(function(i){e.setProperty(i,t.getPropertyValue(i),t.getPropertyPriority(i))})}}i(window.getComputedStyle(t),e.style)}function o(){function i(i){var o=window.getComputedStyle(t,i),n=o.getPropertyValue("content");if(n===""||n==="none")return;var l=yg.uid();e.className=e.className+" "+l;var s=document.createElement("style");function a(t,e,i){var o="."+t+":"+e,n=i.cssText?l(i):s(i);return document.createTextNode(o+"{"+n+"}");function l(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}function s(t){return yg.asArray(t).map(e).join("; ")+";";function e(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}}}s.appendChild(a(l,i,o)),e.appendChild(s)}[":before",":after"].forEach(function(t){i(t)})}function n(){if(t instanceof HTMLTextAreaElement)e.innerHTML=t.value;if(t instanceof HTMLInputElement)e.setAttribute("value",t.value)}function l(){if(!(e instanceof SVGElement))return;if(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),!(e instanceof SVGRectElement))return;["width","height"].forEach(function(t){var i=e.getAttribute(t);if(!i)return;e.style.setProperty(t,i)})}}}function vg(t){return fg.resolveAll().then(function(e){var i=document.createElement("style");return t.appendChild(i),i.appendChild(document.createTextNode(e)),t})}function Lg(t){return dg.inlineAll(t).then(function(){return t})}function Mg(t){"@babel/helpers - typeof";return(Mg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _g(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Ag(o.key),o)}}function Ag(t){var e=function(t,e){if("object"!=Mg(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Mg(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Mg(e)?e:e+""}cg.toSvg=Sg,cg.toPng=function(t,e){return Pg(t,e||{}).then(function(t){return{image:t.toDataURL(),canvas:t}})},cg.toJpeg=function(t,e){return Pg(t,e=e||{}).then(function(t){return t.toDataURL("image/jpeg",e.quality||1)})},cg.toBlob=function(t,e){return Pg(t,e||{}).then(yg.canvasToBlob)},cg.toPixelData=function(t,e){return Pg(t,e||{}).then(function(e){return e.getContext("2d").getImageData(0,0,yg.width(t),yg.height(t)).data})},cg.impl={fontFaces:fg,images:dg,util:yg,inliner:gg,options:{}};var Tg=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._canvasPaddingX=xg(4),this._canvasPaddingY=xg(2),this._canvasMarginX=xg(.7),this._canvasMarginY=xg(.7),this._pixScale=2,this._pixOffsetX=0,this._pixOffsetY=0},(e=[{key:"createSimpleSign",value:function(t){var e=this,i=t.texts,o=t.defaultTextStyle,n=t.textStyles,l=t.titleStyle,s=t.title,a=t.signRenderMode,r=t.contentFrameStyle,u=t.titleFrameStyle,p=t.trayStyle,h=t.signMode,c=t.signType,y=t.iconStyle;return t.pixScale&&(this._pixScale=t.pixScale),h==SuperMap.Plot.SignMode.Simple?(l.visible=!0,u.visible=!0,r.visible=!1):h==SuperMap.Plot.SignMode.Complex&&(l.visible=!0,u.visible=!0,r.visible=!0,7!=c&&9!=c&&10!=c&&12!=c&&14!=c||(l.visible=!0,u.visible=!1)),null!=s&&0!=s.length||(l.visible=!1,u.visible=!1),new Promise(function(t,h){var c,g,f,d,m=document.createElement("canvas"),S=m.getContext("2d"),P=Math.ceil(function(t,e,i,o){for(var n=0,l=0;l<e.length;l++){var s=0;t.font=Ig(i[l],o),(s=t.measureText(e[l]).width)>n&&(n=s)}return n}(S,i,n,o)+e._canvasPaddingX),b=function(t,e,i){for(var o=0,n=0;n<t.length;n++){var l=0;l=e[n]&&e[n].fontSize?xg(e[n].fontSize):xg(i.fontSize),0!=n&&(l+=.3*l),o+=l}return o+=xg(1)}(i,n,o)+e._canvasPaddingY,v=0,L=0,M=0;if(l.visible&&(M=xg(l.fontSize)+xg(1),v=M,((L=Math.ceil(function(t,e,i){var o=0,n=0;t.font=Dg(i,i),(n=t.measureText(e).width)>o&&(o=n);return o}(S,s[0],l)+e._canvasPaddingX))>P||!r.visible)&&(P=L)),r.visible&&l.visible?e._canvasHeight=b+v:!r.visible||u.visible||l.visible?e._canvasHeight=v:e._canvasHeight=b,y&&y.visible&&u.visible?(P+=M,m.width=P+2*e._canvasMarginX,m.height=e._canvasHeight+2*e._canvasMarginY):(m.width=P+2*e._canvasMarginX,m.height=e._canvasHeight+2*e._canvasMarginY),1!==a&&(m.width*=e._pixScale,m.height*=e._pixScale,S.scale(e._pixScale,e._pixScale)),u.visible&&l.visible&&(c=new Promise(function(t,i){if(u.imagePath){var o=new Image;o.src=u.imagePath,o.setAttribute("crossOrigin","Anonymous"),o.onload=function(){S.drawImage(o,1,0,P-1,v),Og(e._canvasMarginX,e._canvasMarginY,S,v,10,P,u,s,l),t()}}else Og(e._canvasMarginX,e._canvasMarginY,S,v,10,P,u,s,l),t()})),r.visible&&(u.visible&&l.visible||!u.visible&&!l.visible)&&(g=new Promise(function(t,l){if(r.imagePath){var s=new Image;s.src=r.imagePath,s.setAttribute("crossOrigin","Anonymous"),s.onload=function(){S.drawImage(s,1,v,P-1,b),Cg(e._canvasMarginX,e._canvasMarginY,e._canvasPaddingX,S,v,b,10,P,r,i,n,o),t()}}else Cg(e._canvasMarginX,e._canvasMarginY,e._canvasPaddingX,S,v,b,10,P,r,i,n,o),t()})),y&&y.visible&&(d=new Promise(function(t,i){if(y.imgPath){var o=new Image;o.src=y.imgPath,o.setAttribute("crossOrigin","Anonymous"),o.onload=function(){if(0==y.symbolTextPicturePosition){var i=(P-L)/2-M/2,n=e._canvasMarginY,l=M,s=M;S.drawImage(o,i,n,l,s)}else if(1==y.symbolTextPicturePosition){var a=(P-L)/2+L-e._canvasPaddingX/2,r=e._canvasMarginY,u=M,p=M;S.drawImage(o,a,r,u,p)}t()}}else t()})),r.visible&&!u.visible&&l.visible&&(f=new Promise(function(t,a){if(r.imagePath){var p=new Image;p.src=r.imagePath,p.setAttribute("crossOrigin","Anonymous"),p.onload=function(){S.drawImage(p,1,0,P-1,v+b),Eg(e._canvasMarginX,e._canvasMarginY,e._canvasPaddingX,S,v,b,10,P,r,u,s,l,i,n,o),t()}}else Eg(e._canvasMarginX,e._canvasMarginY,e._canvasPaddingX,S,v,b,10,P,r,u,s,l,i,n,o),t()})),r.visible&&p.visible){var _=0;r.arcCorner&&(_=10);var A=e._canvasMarginX+_+xg(r.lineWidth/2),T=e._canvasMarginX+P-_-xg(r.lineWidth/2);if(p.lineColor.length>1){var x=S.createLinearGradient(A,0,T,0);x.addColorStop(0,Ng(p.lineColor[0]));for(var O=(1/p.lineColor.length).toFixed(2),w=1;w<p.lineColor.length-1;w++)x.addColorStop(O*w,Ng(p.lineColor[w]));x.addColorStop(1,Ng(p.lineColor[p.lineColor.length-1])),S.strokeStyle=x}else 1==p.lineColor.length&&(S.strokeStyle=[p.lineColor[0]]);S.lineWidth=xg(p.lineWidth),S.setLineDash([xg(p.lineDash)]),S.beginPath(),S.moveTo(A,b+v+e._canvasMarginY),S.lineTo(T,b+v+e._canvasMarginY),S.stroke()}else if(p.visible){var C=e._canvasMarginX+xg(r.lineWidth/2),E=e._canvasMarginX+P-xg(r.lineWidth/2);if(p.lineColor.length>1){var I=S.createLinearGradient(C,0,E,0);I.addColorStop(0,Ng(p.lineColor[0]));for(var D=(1/p.lineColor.length).toFixed(2),U=1;U<p.lineColor.length-1;U++)I.addColorStop(D*U,Ng(p.lineColor[U]));I.addColorStop(1,Ng(p.lineColor[p.lineColor.length-1])),S.strokeStyle=I}else 1==p.lineColor.length&&(S.strokeStyle=[p.lineColor[0]]);S.lineWidth=xg(p.lineWidth),S.setLineDash([xg(p.lineDash)]),S.beginPath(),S.moveTo(C,b+v+e._canvasMarginY),S.lineTo(E,b+v+e._canvasMarginY),S.stroke()}Promise.all([c,g,f,d]).then(function(){t(m)})})}},{key:"createCustomSign",value:function(t){var e=this,i=t.templateUrl,o=t.texts,n=t.dom,l=t.signRenderMode,s=t.title;t.pixScale&&(this._pixScale=t.pixScale);var a=void 0;if(n&&""!=n){var r=(new DOMParser).parseFromString(n,"text/html");a=r.body.firstChild}else{var u=function(t){if(!t)return;if(-1==(t=t.replace(/\\+/g,"/")).lastIndexOf("/"))return;var e=function(){var t=null;try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=null}}t||"undefined"==typeof XMLHttpRequest||(t=new XMLHttpRequest);return t}();e.open("GET",t,!1),e.send();var i=e.responseText;if(404===e.status||!i)return;return i}(i);if(!u)return new Promise(function(t,e){t(void 0)});var p=i.replaceAll("\\","/"),h=p.substr(0,p.lastIndexOf("/")+1);u=(u=(u=u.replaceAll("url(","url("+h)).replaceAll('src="','src="'+h)).replaceAll("src='","src='"+h);var c=(new DOMParser).parseFromString(u,"text/html");if(o.length>0){var y=SuperMapAlgoPlot.PlottingUtil.cloneObject(o);s.length>0&&y.splice(0,0,s[0]);for(var g=0;g<y.length;g++){var f=y[g],d=c.getElementById(String(g));d&&(d.innerHTML=f)}}a=c.getElementById("sign")}return new Promise(function(t,i){1===l?t(a):a&&(document.body.appendChild(a),cg.toPng(a,{scale:e._pixScale}).then(function(e){document.body.removeChild(a),t({image:e.image,canvas:e.canvas})}).catch(function(t){i(void 0)}))})}},{key:"createImageSign",value:function(t){var e=t.signImage,i=t.signRenderMode;return new Promise(function(t,o){if(e&&"string"==typeof e)if(function(t){if("string"!=typeof t)return;return Bg.test(t)}(e)||function(t){if("string"!=typeof t)return;return kg.test(t)}(e))t(e);else if(1===i)t(e);else{var n=new Image;n.src=e,n.setAttribute("crossOrigin","Anonymous"),n.onload=function(){var i=e.substring(e.lastIndexOf(".1")).toLowerCase(),o=document.createElement("canvas");o.width=n.width,o.height=n.height,o.getContext("2d").drawImage(n,0,0,n.width,n.height);var l=o.toDataURL("image/"+i);t({image:l,canvas:o})}}})}}])&&_g(t.prototype,e),i&&_g(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();function xg(t){return 96*t/25.4}function Og(t,e,i,o,n,l,s,a,r){i.beginPath();var u={startX:t,startY:e,endX:l,endY:o};i.fillStyle=Ug(i,s.backgroundColor,s.backgroundColorGradientType,u),i.strokeStyle=Ug(i,s.lineColor,s.lineColorGradientType,u),i.lineWidth=xg(s.lineWidth),i.setLineDash([xg(s.lineDash)]),s.arcCorner?(i.arc(n+t,n+e,n,Math.PI,1.5*Math.PI),i.arc(l-n+t,n+e,n,1.5*Math.PI,2*Math.PI),i.arc(l-n+t,o-n+e,n,0,.5*Math.PI),i.arc(n+t,o-n+e,n,.5*Math.PI,Math.PI),i.lineTo(t,n+o+e)):0===s.lineWidth?i.fillRect(t,e,l,o):i.rect(t,e,l,o),i.fill(),i.stroke(),i.textAlign=s.textAlign,i.font=Dg(r,r),i.fillStyle=r.color.toCssColorString?r.color.toCssColorString():wg(r.color),i.fillText(a,l/2+t,o+e-xg(1.4))}function wg(t){return t.red?"rgba("+255*t.red+","+255*t.green+","+255*t.blue+","+t.alpha+")":t}function Cg(t,e,i,o,n,l,s,a,r,u,p,h){o.beginPath();var c={startX:t,startY:n+e,endX:a,endY:l};o.fillStyle=Ug(o,r.backgroundColor,r.backgroundColorGradientType,c),o.strokeStyle=Ug(o,r.lineColor,r.lineColorGradientType,c),o.lineWidth=xg(r.lineWidth),o.setLineDash([xg(r.lineDash)]),r.arcCorner?(o.arc(s+t,s+n+e,s,Math.PI,1.5*Math.PI),o.arc(a+t-s,s+n+e,s,1.5*Math.PI,2*Math.PI),o.arc(a-s+t,l-s+n+e,s,0,.5*Math.PI),o.arc(s+t,l-s+n+e,s,.5*Math.PI,Math.PI),o.lineTo(t,s+n+e)):0===r.lineWidth?o.fillRect(t,n+e,a,l):o.rect(t,n+e,a,l),o.fill(),o.stroke(),o.textAlign=r.textAlign?r.textAlign:"left";for(var y=0;y<u.length;y++){var g=u[y];o.font=p[y]?Ig(p[y],h):Ig(h,h);var f=void 0;f=p[y]?p[y].color.toCssColorString?p[y].color.toCssColorString():wg(p[y].color):h.color.toCssColorString?h.color.toCssColorString():wg(h.color),o.fillStyle=f,"center"==r.textAlign?o.fillText(g,a/2,Rg(p,y+1,h)+n):o.fillText(g,i/2+t,Rg(p,y+1,h)+n)}}function Eg(t,e,i,o,n,l,s,a,r,u,p,h,c,y,g){o.beginPath();var f={startX:t,startY:e,endX:a,endY:l+n};o.fillStyle=Ug(o,r.backgroundColor,r.backgroundColorGradientType,f),o.strokeStyle=Ug(o,r.lineColor,r.lineColorGradientType,f),o.lineWidth=xg(r.lineWidth),o.setLineDash([xg(r.lineDash)]),r.arcCorner?(o.arc(s+t,s+e,s,Math.PI,1.5*Math.PI),o.arc(a-s+t,s+e,s,1.5*Math.PI,2*Math.PI),o.arc(a-s+t,l+n-s+e,s,0,.5*Math.PI),o.arc(s+t,l+n-s+e,s,.5*Math.PI,Math.PI),o.lineTo(t,s+e)):0===r.lineWidth?o.fillRect(t,e,a,l+n):o.rect(t,e,a,l+n),o.fill(),o.stroke();var d=p;p.length>0&&(o.textAlign=u.textAlign,o.font=Dg(h,h),o.fillStyle=h.color.toCssColorString?h.color.toCssColorString():wg(h.color),"center"===o.textAlign?o.fillText(d,(a+2*t)/2,n+e-xg(1)):"left"===o.textAlign&&o.fillText(d,(i+2*e)/2,n+e-xg(1))),o.textAlign=r.textAlign?r.textAlign:"left";for(var m=0;m<c.length;m++){var S=c[m];o.font=y[m]?Ig(y[m],g):Ig(g,g);var P=void 0;P=y[m]?y[m].color.toCssColorString?y[m].color.toCssColorString():wg(y[m].color):g.color.toCssColorString?g.color.toCssColorString():wg(g.color),o.fillStyle=P,"center"==r.textAlign?o.fillText(S,a/2,Rg(y,m+1,g)+n):o.fillText(S,i/2+t,Rg(y,m+1,g)+n)}}function Ig(t,e){return(t&&t.fontStyle?t.fontStyle:e.fontStyle)+" "+(t&&t.fontWeight?t.fontWeight:e.fontWeight)+" "+(t&&t.fontSize?xg(t.fontSize):xg(e.fontSize))+"px "+(t&&t.fontFamily?t.fontFamily:e.fontFamily)}function Dg(t,e){return(t&&t.fontStyle?t.fontStyle:e.fontStyle)+" "+(t&&t.fontWeight?t.fontWeight:e.fontWeight)+" "+(t&&t.fontSize?xg(t.fontSize):xg(e.fontSize))+"px "+(t&&t.fontFamily?t.fontFamily:e.fontFamily)}function Ug(t,e,i,o){if(e.length>1){var n=void 0;if(0==i?n=t.createLinearGradient(o.startX,0,o.endX,0):1==i?n=t.createLinearGradient(0,o.startY,0,o.endY):2==i&&(n=t.createLinearGradient(o.startX,o.startY,o.endX,o.endY)),n){var l=e[0].toCssColorString?e[0].toCssColorString():wg(e[0]);n.addColorStop(0,l);for(var s=(1/e.length).toFixed(2),a=1;a<e.length-1;a++)l=e[a].toCssColorString?e[a].toCssColorString():wg(e[a]),n.addColorStop(s*a,l);return l=e[e.length-1].toCssColorString?e[e.length-1].toCssColorString():wg(e[e.length-1]),n.addColorStop(1,l),n}return[e[0].toCssColorString?e[0].toCssColorString():wg(e[0])]}if(1==e.length)return[e[0].toCssColorString?e[0].toCssColorString():wg(e[0])]}function Rg(t,e,i){for(var o=0,n=0;n<e;n++){var l=0;l=t[n]&&t[n].fontSize?xg(t[n].fontSize):xg(i.fontSize),0!=n&&(l+=.3*l),o+=l}return o+=xg(1)}function Ng(t){return t.toCssColorString?t.toCssColorString():wg(t)}var Bg=/^blob:/i;var kg=/^data:/i;function Fg(t){"@babel/helpers - typeof";return(Fg="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jg(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,Vg(o.key),o)}}function Vg(t){var e=function(t,e){if("object"!=Fg(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=Fg(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Fg(e)?e:e+""}SuperMapAlgoPlot.createSignImage=function(){return new Tg},SuperMapAlgoPlot.CreateSignImage=Tg;var zg=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._signType=e.signType,this._signMode=e.signMode,this._signRenderMode=e.signRenderMode,this._texts=e.texts,this._title=e.title,this._templateUrl=e.templateUrl,this._dom=e.dom,this._signImage=e.signImage,this._isExist=!1},(e=[{key:"_getOptions",value:function(){var t=null;return this._signMode===SuperMap.Plot.SignMode.Simple||this._signMode===SuperMap.Plot.SignMode.Complex?this._isExist?t={texts:this._texts,title:this._title,signRenderMode:this._signRenderMode,defaultTextStyle:this._textStyle,textStyles:this._textStyles,titleStyle:this._titleStyle,contentFrameStyle:this._contentFrameStyle,titleFrameStyle:this._titleFrameStyle,trayStyle:this._trayStyle,templateUrl:this._templateUrl,dom:this._dom,signMode:this._signMode,signType:this._signType,iconStyle:this._iconStyle}:(this._initStyles(this._signType),t={texts:this._texts,title:this._title,signRenderMode:this._signRenderMode,defaultTextStyle:this._textStyle,textStyles:this._textStyles,titleStyle:this._titleStyle,contentFrameStyle:this._contentFrameStyle,titleFrameStyle:this._titleFrameStyle,trayStyle:this._trayStyle,templateUrl:this._templateUrl,dom:this._dom,signMode:this._signMode,signType:this._signType,iconStyle:this._iconStyle},this._isExist=!0,t):this._signMode===SuperMap.Plot.SignMode.Custom?t={templateUrl:this._templateUrl,dom:this._dom,title:this._title,texts:this._texts,signRenderMode:this._signRenderMode}:this._signMode===SuperMap.Plot.SignMode.Image?t={signImage:this._signImage,signRenderMode:this._signRenderMode}:void 0}},{key:"_initStyles",value:function(t){switch(t){case SuperMap.Plot.SignType.Sign1:this._changeColor(SuperMap.Plot.SignObjects.SignEffect1);break;case SuperMap.Plot.SignType.Sign2:this._changeColor(SuperMap.Plot.SignObjects.SignEffect2);break;case SuperMap.Plot.SignType.Sign3:this._changeColor(SuperMap.Plot.SignObjects.SignEffect3);break;case SuperMap.Plot.SignType.Sign4:this._changeColor(SuperMap.Plot.SignObjects.SignEffect4);break;case SuperMap.Plot.SignType.Sign5:this._changeColor(SuperMap.Plot.SignObjects.SignEffect5);break;case SuperMap.Plot.SignType.Sign6:this._changeColor(SuperMap.Plot.SignObjects.SignEffect6);break;case SuperMap.Plot.SignType.Sign7:this._changeColor(SuperMap.Plot.SignObjects.SignEffect7);break;case SuperMap.Plot.SignType.Sign8:this._changeColor(SuperMap.Plot.SignObjects.SignEffect8);break;case SuperMap.Plot.SignType.Sign9:this._changeColor(SuperMap.Plot.SignObjects.SignEffect9);break;case SuperMap.Plot.SignType.Sign10:this._changeColor(SuperMap.Plot.SignObjects.SignEffect10);break;case SuperMap.Plot.SignType.Sign11:this._changeColor(SuperMap.Plot.SignObjects.SignEffect11);break;case SuperMap.Plot.SignType.Sign12:this._changeColor(SuperMap.Plot.SignObjects.SignEffect12);break;case SuperMap.Plot.SignType.Sign13:this._changeColor(SuperMap.Plot.SignObjects.SignEffect13);break;case SuperMap.Plot.SignType.Sign14:this._changeColor(SuperMap.Plot.SignObjects.SignEffect14);break;case SuperMap.Plot.SignType.Sign15:this._changeColor(SuperMap.Plot.SignObjects.SignEffect15)}var e=L.supermap.plotting.getControl().serverUrl;""!==e&&e.includes("/iserver")&&(this._titleFrameStyle&&this._titleFrameStyle.imagePath&&(this._titleFrameStyle.imagePath=this._titleFrameStyle.imagePath.replaceAll("http://localhost:8090",e.split("/iserver")[0])),this._contentFrameStyle&&this._contentFrameStyle.imagePath&&(this._contentFrameStyle.imagePath=this._contentFrameStyle.imagePath.replaceAll("http://localhost:8090",e.split("/iserver")[0])))}},{key:"_changeColor",value:function(t){var e=SuperMap.Util.cloneObject(t);e.titleFrameStyle.lineColor=this._colorsConvert(e.titleFrameStyle.lineColor),e.titleFrameStyle.backgroundColor=this._colorsConvert(e.titleFrameStyle.backgroundColor),e.contentFrameStyle.lineColor=this._colorsConvert(e.contentFrameStyle.lineColor),e.contentFrameStyle.backgroundColor=this._colorsConvert(e.contentFrameStyle.backgroundColor),e.trayStyle.lineColor=this._colorsConvert(e.trayStyle.lineColor),this._textStyle=e.defaultTextStyle,this._textStyles=[],this._textStyles.push(SuperMap.Util.cloneObject(this._textStyle)),this._titleStyle=e.defaultTitleStyle,this._iconStyle=e.iconStyle,this._contentFrameStyle=e.contentFrameStyle,this._titleFrameStyle=e.titleFrameStyle,this._trayStyle=e.trayStyle,e.indecatorLineStyle&&(this._indecatorLineStyle=e.indecatorLineStyle)}},{key:"_colorsConvert",value:function(t){for(var e=[],i=0;i<t.length;i++){var o=t[i];e.push(o)}return e}},{key:"_generateImageData",value:function(){var t=this;return new Promise(function(e){var i=t._getOptions();switch(t._signMode){case SuperMap.Plot.SignMode.Simple:case SuperMap.Plot.SignMode.Complex:SuperMapAlgoPlot.createSignImage().createSimpleSign(i).then(function(t){e(t)});break;case SuperMap.Plot.SignMode.Custom:SuperMapAlgoPlot.createSignImage().createCustomSign(i).then(function(t){e(t)});break;case SuperMap.Plot.SignMode.Image:SuperMapAlgoPlot.createSignImage().createImageSign(i).then(function(t){e(t)})}})}},{key:"_setTitleStyle",value:function(t){t.visible&&(this._titleStyle.visible=t.visible),t.color&&(this._titleStyle.color=t.color),t.fontFamily&&(this._titleStyle.fontFamily=t.fontFamily),t.fontStyle&&(this._titleStyle.fontStyle=t.fontStyle),t.fontSize&&(this._titleStyle.fontSize=t.fontSize),t.fontWeight&&(this._titleStyle.fontWeight=t.fontWeight)}},{key:"_setTitleFrameStyle",value:function(t){t.visible&&(this._titleFrameStyle.visible=t.visible),t.lineWidth&&(this._titleFrameStyle.lineWidth=t.lineWidth),t.lineColor&&(this._titleFrameStyle.lineColor=t.lineColor),t.lineColorGradientType&&(this._titleFrameStyle.lineColorGradientType=t.lineColorGradientType),t.lineDash&&(this._titleFrameStyle.lineDash=t.lineDash),t.backgroundColor&&(this._titleFrameStyle.backgroundColor=t.backgroundColor),t.backgroundColorGradientType&&(this._titleFrameStyle.backgroundColorGradientType=t.backgroundColorGradientType),t.arcCorner&&(this._titleFrameStyle.arcCorner=t.arcCorner),t.imagePath&&(this._titleFrameStyle.imagePath=t.imagePath)}},{key:"_setTextStyle_",value:function(t){for(var e=0;e<this._textStyles.length;e++)t.visible&&(this._textStyles[e].visible=t.visible),t.color&&(this._textStyles[e].color=t.color),t.fontFamily&&(this._textStyles[e].fontFamily=t.fontFamily),t.fontStyle&&(this._textStyles[e].fontStyle=t.fontStyle),t.fontSize&&(this._textStyles[e].fontSize=t.fontSize),t.fontWeight&&(this._textStyles[e].fontWeight=t.fontWeight);this._textStyle=SuperMap.Util.cloneObject(this._textStyles[0])}},{key:"_setTextStyle",value:function(t,e){if(this._textStyles[e])t.visible&&(this._textStyles[e].visible=t.visible),t.color&&(this._textStyles[e].color=t.color),t.fontFamily&&(this._textStyles[e].fontFamily=t.fontFamily),t.fontStyle&&(this._textStyles[e].fontStyle=t.fontStyle),t.fontSize&&(this._textStyles[e].fontSize=t.fontSize),t.fontWeight&&(this._textStyles[e].fontWeight=t.fontWeight);else{for(var i=0;i<e-this._textStyles.length;i++)this._textStyles.push(this._textStyle);this._textStyles.push(t)}}},{key:"_setTextStyles",value:function(t){this._textStyles=[];for(var e=0;e<t.length;e++){var i=SuperMap.Util.cloneObject(t[e]);this._textStyles.push(i)}this._textStyle=SuperMap.Util.cloneObject(this._textStyles[0])}},{key:"_setContentFrameStyle",value:function(t){t.visible&&(this._contentFrameStyle.visible=t.visible),t.lineWidth&&(this._contentFrameStyle.lineWidth=t.lineWidth),t.lineColor&&(this._contentFrameStyle.lineColor=t.lineColor),t.lineColorGradientType&&(this._contentFrameStyle.lineColorGradientType=t.lineColorGradientType),t.lineDash&&(this._contentFrameStyle.lineDash=t.lineDash),t.backgroundColor&&(this._contentFrameStyle.backgroundColor=t.backgroundColor),t.backgroundColorGradientType&&(this._contentFrameStyle.backgroundColorGradientType=t.backgroundColorGradientType),t.arcCorner&&(this._contentFrameStyle.arcCorner=t.arcCorner),t.imagePath&&(this._contentFrameStyle.imagePath=t.imagePath)}},{key:"_setTrayStyle",value:function(t){!1===t.visible?this._trayStyle.visible=t.visible:t.visible&&(this._trayStyle.visible=t.visible),t.lineWidth&&(this._trayStyle.lineWidth=t.lineWidth),t.lineColor&&(this._trayStyle.lineColor=t.lineColor),t.lineDash&&(this._trayStyle.lineDash=t.lineDash)}},{key:"_setIconStyle",value:function(t){t.visible&&(this._iconStyle.imgPath=t.imgPath),t.lineWidth&&(this._iconStyle.imgWidth=t.imgWidth),t.lineColor&&(this._iconStyle.imgHeight=t.imgHeight),t.lineDash&&(this._iconStyle.symbolTextPicturePosition=t.symbolTextPicturePosition),t.lineDash&&(this._iconStyle.visible=t.visible)}},{key:"_setIndecatorLineStyle",value:function(t){if(t.lineWidth&&(this._indecatorLineStyle.lineWidth=t.lineWidth),t.aryLineColors){this._indecatorLineStyle.aryLineColors=[];for(var e=0;e<t.aryLineColors.length;e++)this._indecatorLineStyle.aryLineColors.push(t.aryLineColors[e].clone())}}}])&&jg(t.prototype,e),i&&jg(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i}();L.supermap.plotting.SignUtil=zg,L.supermap.plotting.signUtil=function(t){return new zg(t)};var Yg=SuperMap.Plot.SignObjects={},Gg=function(){for(var t="iclient-plot-leaflet",e=document.getElementsByTagName("script"),i=0;i<e.length;i++){var o=e[i];if(o.src.indexOf(t)>-1){for(var n=o.src.split("/"),l=0;l<n.length;l++)n[l].indexOf(t)>-1&&(t=n[l]);var s=o.src.replace(t,"");return s}}}();Yg.SignEffect1={defaultTitleStyle:{visible:!1,color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:8,fontWeight:"400"},titleFrameStyle:{visible:!1,lineWidth:.3,lineColor:["rgba(56, 213, 253, 0.5)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336497F"],backgroundColorGradientType:d.Horizontal,textAlign:"center"},defaultTextStyle:{color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:5.5,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!1,lineWidth:.3,lineColor:["#00FFFF7F"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336497F"],backgroundColorGradientType:d.Horizontal},trayStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(0, 255, 255, 1)"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["rgba(0, 255, 255, 1)"]}},Yg.SignEffect2={defaultTitleStyle:{visible:!1,color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:8,fontWeight:"400"},titleFrameStyle:{visible:!1,lineWidth:.3,lineColor:["rgba(56, 213, 253, 0.5)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#FF00644C"],backgroundColorGradientType:d.Horizontal,textAlign:"center"},defaultTextStyle:{color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:5.3,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!1,lineWidth:.3,lineColor:["#FF00007F"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#FF00644C"],backgroundColorGradientType:d.Horizontal},trayStyle:{visible:!0,lineWidth:.3,lineColor:["#FF0000CC"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["#FF0000CC"]}},Yg.SignEffect3={defaultTitleStyle:{visible:!0,color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:5.5,fontWeight:"500"},titleFrameStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 0)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336494C"],backgroundColorGradientType:d.Horizontal,textAlign:"center",imagePath:Gg+"images/sign/keji.png"},defaultTextStyle:{color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:4.2,fontWeight:"500"},contentFrameStyle:{visible:!0,arcCorner:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 1)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336494C"],backgroundColorGradientType:d.Horizontal},trayStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 1)"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["rgba(56, 213, 253, 1)"]}},Yg.SignEffect4={defaultTitleStyle:{visible:!0,color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:5.5,fontWeight:"500"},titleFrameStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 1)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336497F"],backgroundColorGradientType:d.Horizontal,textAlign:"center"},defaultTextStyle:{color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:4.2,fontWeight:"500"},contentFrameStyle:{visible:!0,arcCorner:!1,lineWidth:.3,lineColor:["rgba(56, 213, 253, 1)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336497F"],backgroundColorGradientType:d.Horizontal},trayStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 1)"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["rgba(56, 213, 253, 1)"]}},Yg.SignEffect5={defaultTitleStyle:{visible:!0,color:"#FFFF00FE",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:5.5,fontWeight:"400"},titleFrameStyle:{visible:!0,lineWidth:.3,lineColor:["#00A0E9FF"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#00FFFF47"],backgroundColorGradientType:d.Horizontal,textAlign:"center"},defaultTextStyle:{color:"#F79646FF",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:4.2,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!1,lineWidth:.3,lineColor:["#00A0E9FF"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#00FFFF47"],backgroundColorGradientType:d.Horizontal},trayStyle:{visible:!0,lineWidth:.3,lineColor:["#36E107FF"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["#36E107FF"]}},Yg.SignEffect6={defaultTitleStyle:{visible:!0,color:"#00FFFFFE",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:5.5,fontWeight:"400"},titleFrameStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 1)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336497F"],backgroundColorGradientType:d.Horizontal,textAlign:"center"},defaultTextStyle:{color:"#00FFFFFE",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:4.4,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!1,lineWidth:.3,lineColor:["#3770707f"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336497F"],backgroundColorGradientType:d.Horizontal},trayStyle:{visible:!0,lineWidth:.3,lineColor:["#00FFFFFE"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["#00FFFFFE"]}},Yg.SignEffect7={defaultTitleStyle:{visible:!0,color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:5.5,fontWeight:"400"},titleFrameStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 0.1)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["rgba(56, 213, 253, 0.1)"],backgroundColorGradientType:d.Horizontal,textAlign:"center",imagePath:Gg+"images/sign/biaopai1.png"},defaultTextStyle:{color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:4.4,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 1)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336494C"],backgroundColorGradientType:d.Horizontal},trayStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 1)"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["rgba(56, 213, 253, 1)"]}},Yg.SignEffect8={defaultTitleStyle:{visible:!0,color:"rgba(255, 255, 255,1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:5.3,fontWeight:"400"},titleFrameStyle:{visible:!1,lineWidth:.3,lineColor:["#00A0E9FF"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#00FFFF47"],backgroundColorGradientType:d.Horizontal,textAlign:"center"},defaultTextStyle:{color:"rgba(255, 255, 255,1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:4.2,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!1,lineWidth:0,lineColor:["rgba(56, 213, 253, 0)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#00FFFF47"],backgroundColorGradientType:d.Horizontal,imagePath:Gg+"images/sign/keji.png"},trayStyle:{visible:!0,lineWidth:.3,lineColor:["#36E107FF"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["#36E107FF"]}},Yg.SignEffect9={defaultTitleStyle:{visible:!0,color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:5.4,fontWeight:"400"},titleFrameStyle:{visible:!0,arcCorner:!0,lineWidth:0,lineColor:["rgba(56, 213, 253, 1)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336494C"],backgroundColorGradientType:d.Horizontal,textAlign:"center",imagePath:Gg+"images/sign/fangxing1.png"},defaultTextStyle:{color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:4.8,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 1)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336494C"],backgroundColorGradientType:d.Horizontal},trayStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 1)"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["rgba(56, 213, 253, 1)"]}},Yg.SignEffect10={defaultTitleStyle:{visible:!0,color:"rgba(255, 255, 255,1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:5.5,fontWeight:"400"},titleFrameStyle:{visible:!1,lineWidth:.3,lineColor:["rgba(86, 71, 236,1)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["rgba(86, 71, 236,0.3)"],backgroundColorGradientType:d.Horizontal,textAlign:"center"},defaultTextStyle:{color:"rgba(255, 255, 255,1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:4.4,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 0)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#00FFFF47"],backgroundColorGradientType:d.Horizontal,imagePath:Gg+"images/sign/fangxing3.png"},trayStyle:{visible:!0,lineWidth:.3,lineColor:["#36E107FF"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["#36E107FF"]}},Yg.SignEffect11={defaultTitleStyle:{visible:!0,color:"rgba(255, 255, 255,1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:5.5,fontWeight:"400"},titleFrameStyle:{visible:!1,lineWidth:.3,lineColor:["rgba(58, 6, 0, 1)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["rgba(142, 72, 0, 0.3)"],backgroundColorGradientType:d.Horizontal,textAlign:"center"},defaultTextStyle:{color:"rgba(255, 255, 255,1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:4.4,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!0,lineWidth:0,lineColor:["rgba(56, 213, 253, 0)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336494C"],backgroundColorGradientType:d.Horizontal,imagePath:Gg+"images/sign/fangxing4.png"},trayStyle:{visible:!0,lineWidth:.3,lineColor:["#36E107FF"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["#36E107FF"]}},Yg.SignEffect12={defaultTitleStyle:{visible:!0,color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:5.5,fontWeight:"400"},titleFrameStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(56, 213, 253, 0.1)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["rgba(56, 213, 253, 0.1)"],backgroundColorGradientType:d.Horizontal,textAlign:"center",imagePath:Gg+"images/sign/fangxing5.png"},defaultTextStyle:{color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:4.4,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!1,lineWidth:.5,lineColor:["rgba(79, 233, 238, 1)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["rgba(0, 232, 232, 0.38)"],backgroundColorGradientType:d.Horizontal},trayStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(79, 233, 238, 1)"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["rgba(79, 233, 238, 1)"]}},Yg.SignEffect13={defaultTitleStyle:{visible:!1,color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:6,fontWeight:"400"},titleFrameStyle:{visible:!1,lineWidth:.5,lineColor:["rgba(56, 213, 253, 0.5)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336497F"],backgroundColorGradientType:d.Horizontal,textAlign:"center"},defaultTextStyle:{color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:4.4,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!1,lineWidth:.5,lineColor:["#00FFFF7F"],lineColorGradientType:d.Horizontal,lineDash:.7,backgroundColor:["#0336497F"],backgroundColorGradientType:d.Horizontal},trayStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(0, 255, 255, 1)"],lineColorGradientType:d.Horizontal,lineDash:.7},indecatorLineStyle:{lineWidth:.5,aryLineColors:["rgba(0, 255, 255, 1)"]}},Yg.SignEffect14={defaultTitleStyle:{visible:!1,color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:8,fontWeight:"400"},titleFrameStyle:{visible:!1,lineWidth:.5,lineColor:["rgba(56, 213, 253, 0.5)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336497F"],backgroundColorGradientType:d.Horizontal,textAlign:"center"},defaultTextStyle:{color:"rgba(255, 255, 255, 1)",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:4.4,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!1,lineWidth:.5,lineColor:["#00FFFF7F","rgba(255, 213, 253, 0.5)"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#0336497F","rgba(255, 213, 253, 0.5)"],backgroundColorGradientType:d.Horizontal},trayStyle:{visible:!0,lineWidth:.3,lineColor:["rgba(0, 255, 255, 1)"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["rgba(0, 255, 255, 1)"]}},Yg.SignEffect15={defaultTitleStyle:{visible:!0,color:"#ff0000",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:3.8,fontWeight:"400"},titleFrameStyle:{visible:!1,lineWidth:1,lineColor:["#ffffff37"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#00ff0037"],backgroundColorGradientType:d.Horizontal,textAlign:"center"},defaultTextStyle:{color:"#000000",fontFamily:"微软雅黑",fontStyle:"normal",fontSize:3.6,fontWeight:"400"},contentFrameStyle:{visible:!0,arcCorner:!1,lineWidth:1,lineColor:["#ffffff37"],lineColorGradientType:d.Horizontal,lineDash:0,backgroundColor:["#00ff0037"],backgroundColorGradientType:d.Horizontal,textAlign:"center"},trayStyle:{visible:!1,lineWidth:.3,lineColor:["#00FFFFFE"],lineColorGradientType:d.Horizontal,lineDash:0},indecatorLineStyle:{lineWidth:.5,aryLineColors:["#00ffffff"]},iconStyle:{imgPath:"../img/marker.png",imgWidth:16,imgHeight:16,symbolTextPicturePosition:SuperMap.Plot.SymbolTextPicturePosition.RIGHT,visible:!0}};var Wg=Sh.extend({components:null,position:null,offsetX:null,offsetY:null,initialize:function(t,e,i,o,n,l,s){this.feature=t,this.components=e,this.latLng=i,this.position=o,this.offsetX=n,this.offsetY=l,s=s||{},L.Util.setOptions(this,s),this.canvasEle=document.createElement("canvas"),this.canvasEle.width=0,this.canvasEle.height=0,this._ctx=this.canvasEle.getContext("2d"),this.imageData=null,this._bounds=null},setComponents:function(t,e,i,o,n){delete this.bounds,this.bounds=null,this.components=t,this.latLng=e,this.position=i,this.offsetX=o,this.offsetY=n,this.render()},render:function(){this._computeImageSize(),this.feature.layer&&this.feature.layer.isHighDefinition?(this.canvasEle.width=2*this.size[0],this.canvasEle.height=2*this.size[1],this._ctx.setTransform(2,0,0,2,0,0),this._ctx.clearRect(0,0,this.canvasEle.width,this.canvasEle.height),this.canvas=this._ctx.canvas,this._drawFeatures(),this.imageData=this._ctx.getImageData(0,0,2*this.size[0],2*this.size[1]),this._ctx.clearRect(0,0,this.canvasEle.width,this.canvasEle.height),this.canvasEle.width=0,this.canvasEle.height=0):(this.canvasEle.width=this.size[0],this.canvasEle.height=this.size[1],this._ctx.clearRect(0,0,this.canvasEle.width,this.canvasEle.height),this.canvas=this._ctx.canvas,this._drawFeatures())},clear:function(){this._ctx.clearRect(0,0,this.canvasEle.width,this.canvasEle.height)},getCacheInfo:function(){var t=document.createElement("canvas"),e=t.getContext("2d");return this.feature.layer&&this.feature.layer.isHighDefinition?(e.clearRect(0,0,t.width,t.height),e.canvas.width=0,e.canvas.height=0,{canvas:e.canvas,imageData:this.imageData,_ctx:e,position:this.position,offsetX:this.offsetX,offsetY:this.offsetY,_bounds:this._bounds,anchor:L.point(this.anchor.x,this.anchor.y),size:[this.size[0],this.size[1]]}):(t.width=this.canvas.width,t.height=this.canvas.height,e.clearRect(0,0,t.width,t.height),e.drawImage(this.canvas,0,0),{canvas:e.canvas,_ctx:e,position:this.position,offsetX:this.offsetX,offsetY:this.offsetY,anchor:L.point(this.anchor.x,this.anchor.y),size:[this.size[0],this.size[1]]})},_computeImageSize:function(){if(null==this.bounds){this.bounds=L.latLngBounds();for(var t=0;t<this.components.length;t++)this.bounds.extend(this.components[t].getBounds?this.components[t].getBounds():this.components[t].getLatLng())}var e=new L.Bounds;e.extend(this.feature._map.latLngToLayerPoint(this.bounds.getNorthEast())),e.extend(this.feature._map.latLngToLayerPoint(this.bounds.getNorthWest())),e.extend(this.feature._map.latLngToLayerPoint(this.bounds.getSouthEast())),e.extend(this.feature._map.latLngToLayerPoint(this.bounds.getSouthWest())),this.leftTopPixel=L.point(e.min.x,e.min.y);var i=e.getSize(),o=this.feature.style.weight;i.x+=2*o,i.y+=2*o,this.anchor=this._latlngToLayerPoint([this.latLng])[0],this.size=[i.x,i.y]},_latlngToLayerPoint:function(t){for(var e=[],i=0;i<t.length;i++){var o=this.feature._map.latLngToLayerPoint(L.latLng(t[i].lat,t[i].lng));o.x=o.x-this.leftTopPixel.x+this.feature.style.weight,o.y=o.y-this.leftTopPixel.y+this.feature.style.weight,e.push(o)}return e},_drawFeatures:function(){this._ctx.translate(0,0);for(var t=0;t<this.components.length;t++){var e=this.components[t];if(dh&&e instanceof dh)this._drawText(e,this._ctx);else if(L.Rectangle&&e instanceof L.Rectangle)this._drawRectangle(e,this._ctx);else if(L.Polygon&&e instanceof L.Polygon)this._drawPolygon(e,this._ctx);else if(L.Polyline&&e instanceof L.Polyline)this._drawPolyline(e,this._ctx);else if(mh&&e instanceof mh)this._drawImageInSymbolTextImage(e,this._ctx)}}});L.supermap.plotting.componentStyle=function(t){return new Wg(t)};var Xg=function(t){var e=[];L.Util.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++)e.push(new SuperMap.Geometry.Point(t[i].lng,t[i].lat));return e},Hg=function(t){var e=[];L.Util.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++)void 0!==t[i]&&e.push(L.latLng(t[i].y,t[i].x));return e},Zg=function(t){var e=[];L.Util.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++)L.Util.isArray(t[i])?e.push(L.Util.cloneLatLngs(t[i])):e.push(t[i].clone());return e},Jg=function(t,e,i){L.Util.isArray(t)||(t=[t]);for(var o=0;o<t.length;o++)L.Util.isArray(t[o])?L.Util.moveLatLngs(t[o],e,i):(t[o].lat+=e,t[o].lng+=i)},qg=function(t,e,i){L.Util.isArray(t)||(t=[t]);for(var o=i*(Math.PI/180),n=Math.cos(o),l=Math.sin(o),s=0;s<t.length;s++)if(L.Util.isArray(t[s]))L.Util.rotateLatLngs(t[s],e,i);else{var a=t[s].lat-e.lat,r=t[s].lng-e.lng;t[s].lat=r*l+a*n+e.lat,t[s].lng=r*n-a*l+e.lng}},Kg=function(t,e,i){L.Util.isArray(t)||(t=[t]);for(var o=0;o<t.length;o++)L.Util.isArray(t[o])?L.Util.resizeLatLngs(t[o],e,i):(t[o].lat=e.lat+i*(t[o].lat-e.lat),t[o].lng=e.lng+i*(t[o].lng-e.lng))};L.Util.bounds=function(t){L.Util.isArray(t)||(t=[t]);for(var e=L.latLngBounds(),i=0;i<t.length;i++)L.Util.isArray(t[i])?e.extend(L.Util.bounds(t[i])):e.extend(t[i]);return e},L.Util.latLngsToSuperMapPoints=Xg,L.Util.superMapPointsToLatLngs=Hg,L.Util.cloneLatLngs=Zg,L.Util.moveLatLngs=Jg,L.Util.rotateLatLngs=qg,L.Util.rotateBounds=function(t,e,i){if(t instanceof L.LatLngBounds){var o=L.latLngBounds(),n=i*(Math.PI/180),l=Math.cos(n),s=Math.sin(n),a=[];a.push(L.latLng(t.getNorth(),t.getWest())),a.push(L.latLng(t.getNorth(),t.getEast())),a.push(L.latLng(t.getSouth(),t.getWest())),a.push(L.latLng(t.getSouth(),t.getEast()));for(var r=0;r<a.length;r++){var u=a[r].lat-e.lat,p=a[r].lng-e.lng;a[r].lat=p*s+u*l+e.lat,a[r].lng=p*l-u*s+e.lng,o.extend(a[r])}return o}},L.Util.resizeLatLngs=Kg,L.Util.conventProjectPts=function(t){var e=[];L.Util.isArray(t)||(t=[t]);for(var i=0,o=t.length;i<o;i++)e.push(L.CRS.EPSG3857.project(t[i]));return e},L.Util.unConventProjectPts=function(t){var e=[];L.Util.isArray(t)||(t=[e]);for(var i=0,o=t.length;i<o;i++)e.push(L.CRS.EPSG3857.unproject(t[i]));return e},L.Util.isMercatorProjection=function(t){if(void 0!==t&&"string"==typeof t)switch(t.toUpperCase()){case"EPSG:3857":return!0;case"EPSG:4326":default:return!1}},L.Util.isPlottingLayer=function(t){return t instanceof Iy};var Qg=Sh.extend({redrawAnchor:null,redrawSize:null,lastStyleKey:null,lastMainKey:null,lastSymbolTextKey:null,lastBloodVolumeKey:null,lastAnnotationKey:null,lastPictureFrameKey:null,images:null,annotation:null,pictureFrames:null,symbolTexts:null,bloodVolumes:null,componentLatLngs:null,initialize:function(t,e){this.feature=t,e=e||{},L.Util.setOptions(this,e),this.canvasEle=document.createElement("canvas"),this.canvasEle.width=0,this.canvasEle.height=0,this._ctx=this.canvasEle.getContext("2d"),this.images=[],this.symbolTexts=[],this.bloodVolumes=[],this.pictureFrames=[],this.componentLatLngs=[]},render:function(){this._redrawFeature()},complete:function(){if((null==this.symbolTexts||0===this.symbolTexts.length)&&this.feature.symbolTexts.length>0)return!1;if(!(null!=this.pictureFrames&&0!==this.pictureFrames.length||null!=this.images&&0!==this.images.length))return!0;for(var t=0;t<this.pictureFrames.length;t++)if(null!=L.supermap.plotting.getControl().imageManager[this.pictureFrames[t].path]&&!0!==L.supermap.plotting.getControl().imageManager[this.pictureFrames[t].path].complete)return!1;for(var e=0;e<this.images.length;e++)if(null!=L.supermap.plotting.getControl().imageManager[this.images[e].path]&&!0!==L.supermap.plotting.getControl().imageManager[this.images[e].path].complete)return!1;return!0},getBounds:function(t,e){if(this.feature.symbolType===SuperMap.Plot.SymbolType.PICTURE||this.feature.symbolType===SuperMap.Plot.SymbolType.MODELPLOT||3e3===this.feature.symbolType)return this.feature.getBounds();for(var i=new L.LatLngBounds,o=t.lat-this.latLng.lat,n=t.lng-this.latLng.lng,l=this.feature._map.getZoomScale(this.fromZoom,this.feature._map.getZoom()),s=0;s<this.componentLatLngs.length;s++){var a=L.Util.cloneLatLngs(this.componentLatLngs[s]);L.Util.moveLatLngs(a,o,n),L.Util.resizeLatLngs(a,t,l),L.Util.rotateLatLngs(a,t,e),i.extend(L.Util.bounds(a))}return i},getComponentLatLngs:function(){this.componentLatLngs.length=0;for(var t=0;t<this.feature.components.length;t++){var e=this.feature.components[t];e.isLeadLine||e.isAnnotation||e.isSymbolText||e.isBloodVolume||e.isPictureFrame||this.componentLatLngs.push(e.getLatLngs())}},_redrawFeature:function(){if(0===this.feature.components.length){this.latLng=L.latLng(this.feature.getLatLngs()[0].lat,this.feature.getLatLngs()[0].lng),this.fromZoom=this.feature._map.getZoom();var t=this.feature.dRotate;this.feature.dRotate=0,this.feature._calculateParts(),this.feature.dRotate=t,this.lastStyleKey=this._generateFromFeatureStyle(this.feature.style),this.lastMainKey=this._generateFromFeature(),this.lastAnnotationKey=this._generateFromAnnotation(),this.lastSymbolTextKey=this._generateFromSymbolText(),this.lastPictureFrameKey=this._generateFromPictureFrame(),this.lastBloodVolumeKey=this._generateFromBloodVolume(),this.bounds=L.latLngBounds(L.latLng(this.feature.getBounds().getNorth(),this.feature.getBounds().getWest()),L.latLng(this.feature.getBounds().getSouth(),this.feature.getBounds().getEast())),this.getComponentLatLngs(),this._drawFeatures(),this._drawAnnotation(),this._drawSymbolText(),this._drawBloodVolume(),this._drawPictureFrame()}else{var e=this._generateFromFeature();if(this.lastMainKey!==e){for(var i=0;i<this.feature.components.length;i++)delete this.feature.components[i];this.feature.components.length=0;var o=this.feature.dRotate;this.feature.dRotate=0,this.feature._calculateParts(),this.feature.dRotate=o,this.lastMainKey=e,this.lastAnnotationKey=this._generateFromAnnotation(),this.lastSymbolTextKey=this._generateFromSymbolText(),this.lastPictureFrameKey=this._generateFromPictureFrame(),this.lastBloodVolumeKey=this._generateFromBloodVolume(),this.lastStyleKey=this._generateFromFeatureStyle(this.feature.style),this.fromZoom=this.feature._map.getZoom(),this.latLng=L.latLng(this.feature.getLatLngs()[0].lat,this.feature.getLatLngs()[0].lng),this.bounds=L.latLngBounds(L.latLng(this.feature.getBounds().getNorth(),this.feature.getBounds().getWest()),L.latLng(this.feature.getBounds().getSouth(),this.feature.getBounds().getEast())),this.getComponentLatLngs(),this._drawFeatures(),this._drawAnnotation(),this._drawSymbolText(),this._drawBloodVolume(),this._drawPictureFrame()}else{var n=this._generateFromAnnotation();this.lastAnnotationKey!==n&&(this.feature._handleAnnotation(this._scaleBounds(this.bounds)),this._drawAnnotation(),this.lastAnnotationKey=n);var l=this._generateFromSymbolText();this.lastSymbolTextKey!==l&&(this.feature._calculateLabel(this._scaleBounds(this.bounds),this.latLng),this._drawSymbolText(),this.lastSymbolTextKey=l);var s=this._generateFromBloodVolume();this.lastBloodVolumeKey!==s&&(this.feature._calculateBloodVolume(this._scaleBounds(this.bounds),this.latLng),this._drawBloodVolume(),this.lastBloodVolumeKey=s);var a=this._generateFromPictureFrame();this.lastPictureFrameKey!==a&&(this.feature._calculatePictureFrame(this._scaleBounds(this.bounds)),this._drawPictureFrame(),this.lastPictureFrameKey=a)}var r=this._generateFromFeatureStyle(this.feature.style);if(this.lastStyleKey!==r&&"function"==typeof this.feature._copyStyleForCell){for(var u=0;u<this.feature.components.length;u++){var p=this.feature.components[u];if(!(p.isSymbolText||p.isBloodVolume||p.isPictureFrame)){var h=p.options;this.feature._copyStyleForCell(h,this.feature.style,p),L.setOptions(p,h)}}8===this.feature.annotationPosition&&0!==this.feature.textContent.length&&this.feature._handleAnnotation(this._scaleBounds(this.bounds)),this._drawFeatures(),this._drawAnnotation()}this.lastStyleKey=r}this._computeRedrawSize()},getCacheInfo:function(){var t=document.createElement("canvas"),e=t.getContext("2d");t.width=this.canvas.width,t.height=this.canvas.height,e.clearRect(0,0,t.width,t.height),e.drawImage(this.canvas,0,0);for(var i={canvas:e.canvas,anchor:L.point(this.anchor.x,this.anchor.y),size:[this.size[0],this.size[1]],redrawSize:[this.redrawSize[0],this.redrawSize[1]],redrawAnchor:L.point(this.redrawAnchor.x,this.redrawAnchor.y),bounds:L.latLngBounds(this.bounds.getSouthEast(),this.bounds.getNorthWest()),fromZoom:this.fromZoom,latLng:L.latLng(this.latLng.lat,this.latLng.lng),componentLatLngs:[]},o=0;o<this.componentLatLngs.length;o++)i.componentLatLngs.push(L.Util.cloneLatLngs(this.componentLatLngs[o]));null!=this.annotation&&(i.annotation=this.annotation.getCacheInfo()),i.images=[];for(var n=0;n<this.images.length;n++){var l={};l=SuperMap.Util.copyAttributes(l,this.images[n]),i.images.push(l)}i.pictureFrames=[];for(var s=0;s<this.pictureFrames.length;s++){var a={};a=SuperMap.Util.copyAttributes(a,this.pictureFrames[s]),i.pictureFrames.push(a)}i.symbolTexts=[];for(var r=0;r<this.symbolTexts.length;r++)null!=this.symbolTexts[r]&&i.symbolTexts.push(this.symbolTexts[r].getCacheInfo());i.bloodVolumes=[];for(var u=0;u<this.bloodVolumes.length;u++)i.bloodVolumes.push(this.bloodVolumes[u].getCacheInfo());return i},generateUuidFromFeature:function(){var t="";return this.feature.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL?(t+=this._generateFromFeature(),t+="_"+this._generateFromAnnotation(),t+="_"+this._generateFromSymbolText(),t+="_"+this._generateFromBloodVolume(),t+="_"+this._generateFromPictureFrame(),t+="_"+this._generateFromFeatureStyle(this.feature.style)):this.feature.symbolType===SuperMap.Plot.SymbolType.PICTURE||this.feature.symbolType===SuperMap.Plot.SymbolType.MODELPLOT||3e3===this.feature.symbolType?(t=this.feature.libID.toString()+"_"+this.feature.code.toString()+"_"+this.feature.path+this.feature.style.graphicWidth+this.feature.style.graphicHeight+this.feature.style.graphicXOffset+this.feature.style.graphicYOffset,t+="_"+this._generateFromSymbolText(),t+="_"+this._generateFromBloodVolume()):this.feature.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT?(t=this.feature.libID.toString()+"_"+this.feature.code.toString()+"_"+this.feature.associatedUuid+"_"+this.feature.addFrame.toString(),t+="_"+this._generateFromSymbolText()):this.feature.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT1&&(t=this.feature.libID.toString()+"_"+this.feature.code.toString()+"_"+this.feature.associatedUuid+"_"+this.feature.textContent+"_"+this.feature.space.toString()+"_"+this.feature.offsetX.toString()+"_"+this.feature.offsetY.toString(),t+="_"+this._generateFromFeatureStyle(this.feature.style)),t},_computeImageSize:function(){var t=this._scaleBounds(this.bounds),e=new L.Bounds;e.extend(this.feature._map.latLngToLayerPoint(t.getNorthEast())),e.extend(this.feature._map.latLngToLayerPoint(t.getNorthWest())),e.extend(this.feature._map.latLngToLayerPoint(t.getSouthEast())),e.extend(this.feature._map.latLngToLayerPoint(t.getSouthWest()));var i=new L.Bounds(e.min,e.max);this.leftTopPixel=L.point(e.min.x,e.min.y);var o=i.getSize();o.x+=2*this.feature.style.weight,o.y+=2*this.feature.style.weight,this.anchor=this._latlngToLayerPoint([this.latLng])[0],this.size=[o.x,o.y]},_computeRedrawSize:function(){var t=this._scaleBounds(this.bounds),e=this.getBounds(this.latLng,this.feature.dRotate),i=e.getWest()-t.getWest(),o=e.getEast()-t.getEast(),n=e.getNorth()-t.getNorth(),l=e.getSouth()-t.getSouth();if(this.feature.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL||this.feature.symbolType===SuperMap.Plot.SymbolType.PICTURE||this.feature.symbolType===SuperMap.Plot.SymbolType.MODELPLOT||3e3===this.feature.symbolType)for(var s=0;s<this.feature.components.length;s++){var a=this.feature.components[s];(a.isAnnotation||a.isSymbolText||a.isBloodVolume||a.isPictureFrame)&&t.extend(a.getBounds?a.getBounds():a.getLatLng())}var r=new L.Bounds;r.extend(this.feature._map.latLngToLayerPoint(L.latLng(t.getNorth()+n,t.getEast()+o))),r.extend(this.feature._map.latLngToLayerPoint(L.latLng(t.getNorth()+n,t.getWest()+i))),r.extend(this.feature._map.latLngToLayerPoint(L.latLng(t.getSouth()+l,t.getEast()+o))),r.extend(this.feature._map.latLngToLayerPoint(L.latLng(t.getSouth()+l,t.getWest()+i))),this.leftTopPixel=L.point(r.min.x,r.min.y);var u=r.getSize(),p=this.feature.style.weight;u.x+=2*p,u.y+=2*p,this.redrawAnchor=this._latlngToLayerPoint([this.latLng])[0],this.redrawSize=[u.x,u.y]},_latlngToLayerPoint:function(t,e){null==e&&(e=this.fromZoom);for(var i=this.feature._map.getZoomScale(e,this.feature._map.getZoom()),o=this.latLng,n=[],l=0;l<t.length;l++){var s=o.lat+i*(t[l].lat-o.lat),a=o.lng+i*(t[l].lng-o.lng),r=this.feature._map.latLngToLayerPoint(L.latLng(s,a));r.x=r.x-this.leftTopPixel.x+this.feature.style.weight,r.y=r.y-this.leftTopPixel.y+this.feature.style.weight,n.push(r)}return n},_scaleBounds:function(t){if(this.fromZoom!==this.feature._map.getZoom()){var e=this.feature._map.getZoomScale(this.fromZoom,this.feature._map.getZoom()),i=this.latLng,o=i.lat+e*(t.getNorth()-i.lat),n=i.lat+e*(t.getSouth()-i.lat),l=i.lng+e*(t.getWest()-i.lng),s=i.lng+e*(t.getEast()-i.lng);return L.latLngBounds(L.latLng(o,l),L.latLng(n,s))}return L.latLngBounds(L.latLng(t.getNorth(),t.getWest()),L.latLng(t.getSouth(),t.getEast()))},_scaleCompount:function(t){if(this.fromZoom!==this.feature._map.getZoom()){var e=this.feature._map.getZoomScale(this.fromZoom,this.feature._map.getZoom()),i=this.latLng,o=i.lat+e*(t.getNorth()-i.lat),n=i.lat+e*(t.getSouth()-i.lat),l=i.lng+e*(t.getWest()-i.lng),s=i.lng+e*(t.getEast()-i.lng);return L.latLngBounds(L.latLng(o,l),L.latLng(n,s))}return L.latLngBounds(L.latLng(t.getNorth(),t.getWest()),L.latLng(t.getSouth(),t.getEast()))},_drawFeatures:function(){this.images.length=0,this._computeImageSize(),this.canvasEle.width=this.size[0],this.canvasEle.height=this.size[1],this._ctx.clearRect(0,0,this.canvasEle.width,this.canvasEle.height),this.canvas=this._ctx.canvas,this._ctx.translate(0,0);for(var t=0;t<this.feature.components.length;t++){var e=this.feature.components[t];!0!==e.isSymbolText&&!0!==e.isBloodVolume&&!0!==e.isPictureFrame&&!0!==e.isAnnotation&&(mh&&e instanceof mh?this.images.push(this._drawImage(e,this._ctx)):dh&&e instanceof dh?this._drawText(e,this._ctx):L.Rectangle&&e instanceof L.Rectangle?this._drawRectangle(e,this._ctx):L.Polygon&&e instanceof L.Polygon?this._drawPolygon(e,this._ctx):L.Polyline&&e instanceof L.Polyline&&this._drawPolyline(e,this._ctx))}},_drawAnnotation:function(){for(var t=!1,e=this._scaleBounds(this.bounds),i=(this.latLng,0);i<this.feature.components.length;i++)if(!0===this.feature.components[i].isAnnotation&&8!==this.feature.annotationPosition){t=!0;var o=null;switch(this.feature.annotationPosition){case SuperMap.Plot.AnnoPosition.LEFTTOP:o=L.latLng(e.getNorth(),e.getWest());break;case SuperMap.Plot.AnnoPosition.LEFTBOTTOM:o=L.latLng(e.getSouth(),e.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHTTOP:o=L.latLng(e.getNorth(),e.getEast());break;case SuperMap.Plot.AnnoPosition.RIGHTBOTTOM:o=L.latLng(e.getSouth(),e.getEast());break;case SuperMap.Plot.AnnoPosition.TOP:o=L.latLng(e.getNorth(),(e.getWest()+e.getEast())/2);break;case SuperMap.Plot.AnnoPosition.BOTTOM:o=L.latLng(e.getSouth(),(e.getWest()+e.getEast())/2);break;case SuperMap.Plot.AnnoPosition.LEFT:o=L.latLng((e.getSouth()+e.getNorth())/2,e.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHT:o=L.latLng((e.getSouth()+e.getNorth())/2,e.getEast())}null==this.annotation?(this.annotation=new Wg(this.feature,[this.feature.components[i]],o,this.feature.annotationPosition,0,0,this.options),this.annotation.render()):(this.annotation.clear(),this.annotation.setComponents([this.feature.components[i]],o,this.feature.annotationPosition,0,0));break}!1===t&&null!=this.annotation&&(delete this.annotation,this.annotation=null)},_drawSymbolText:function(){var t=this._scaleBounds(this.bounds),e=this.latLng;if(this.feature.symbolTextComponents){for(var i=0;i<this.feature.symbolTextComponents.length;i++){var o=null;switch(this.feature.symbolTexts[i].textPosition){case SuperMap.Plot.AnnoPosition.LEFTTOP:o=L.latLng(t.getNorth(),t.getWest());break;case SuperMap.Plot.AnnoPosition.LEFTBOTTOM:o=L.latLng(t.getSouth(),t.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHTTOP:o=L.latLng(t.getNorth(),t.getEast());break;case SuperMap.Plot.AnnoPosition.RIGHTBOTTOM:o=L.latLng(t.getSouth(),t.getEast());break;case SuperMap.Plot.AnnoPosition.TOP:o=L.latLng(t.getNorth(),(t.getWest()+t.getEast())/2);break;case SuperMap.Plot.AnnoPosition.BOTTOM:o=L.latLng(t.getSouth(),(t.getWest()+t.getEast())/2);break;case SuperMap.Plot.AnnoPosition.LEFT:o=L.latLng((t.getSouth()+t.getNorth())/2,t.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHT:o=L.latLng((t.getSouth()+t.getNorth())/2,t.getEast());break;case SuperMap.Plot.AnnoPosition.ANCHOR:o=L.latLng(e.lat,e.lng)}var n;if(this.symbolTexts.length<=i)if(null==this.feature.symbolTextComponents[i])this.symbolTexts.push(null);else(n=new Wg(this.feature,this.feature.symbolTextComponents[i],o,this.feature.symbolTexts[i].textPosition,0,0,this.options)).render(),n._bounds=this.feature.symbolTexts[i]._bounds,this.symbolTexts.push(n);else if(null==this.symbolTexts[i]&&null!=this.feature.symbolTextComponents[i])(n=new Wg(this.feature,this.feature.symbolTextComponents[i],o,this.feature.symbolTexts[i].textPosition,0,0,this.options)).render(),n._bounds=this.feature.symbolTexts[i]._bounds,this.symbolTexts[i]=n;else null!=this.symbolTexts[i]&&null!=this.feature.symbolTextComponents[i]&&(this.symbolTexts[i].clear(),this.symbolTexts[i].setComponents(this.feature.symbolTextComponents[i],o,this.feature.symbolTexts[i].textPosition,0,0),this.symbolTexts[i]._bounds=this.feature.symbolTexts[i]._bounds)}for(var l=this.feature.symbolTextComponents.length;l<this.symbolTexts.length;)delete this.symbolTexts[l],this.symbolTexts.splice(l,1)}},_drawBloodVolume:function(){if(this.feature.bloodVolumeComponents){for(var t=0;t<this.feature.bloodVolumeComponents.length;t++){var e=this._scaleBounds(this.bounds),i=null;switch(this.feature.bloodVolumes[t].position){case SuperMap.Plot.AnnoPosition.TOP:i=L.latLng(e.getNorth(),(e.getWest()+e.getEast())/2);break;case SuperMap.Plot.AnnoPosition.BOTTOM:i=L.latLng(e.getSouth(),(e.getWest()+e.getEast())/2);break;case SuperMap.Plot.AnnoPosition.LEFT:i=L.latLng((e.getSouth()+e.getNorth())/2,e.getWest());break;case SuperMap.Plot.AnnoPosition.RIGHT:i=L.latLng((e.getSouth()+e.getNorth())/2,e.getEast())}if(this.bloodVolumes.length<=t){var o=new Wg(this.feature,this.feature.bloodVolumeComponents[t],i,this.feature.bloodVolumes[t].position,0,0,this.fromZoom,this.options);o.render(),this.bloodVolumes.push(o)}else this.bloodVolumes[t].clear(),this.bloodVolumes[t].setComponents(this.feature.bloodVolumeComponents[t],i,this.feature.bloodVolumes[t].position,0,0,this.fromZoom)}for(var n=this.feature.bloodVolumeComponents.length;n<this.bloodVolumes.length;)delete this.bloodVolumes[n],this.bloodVolumes.splice(n,1)}},_drawPictureFrame:function(){if(this.pictureFrames.length=0,null!=this.feature.pictureFrameComponents)for(var t=0;t<this.feature.pictureFrameComponents.length;t++){var e=this.feature.pictureFrames[t].offsetX,i=this.feature.pictureFrames[t].offsetY,o=this.feature.pictureFrameComponents[t][0];if(mh&&o instanceof mh){var n=this._drawImage(o,this._ctx);this.pictureFrames.push({path:n.path,style:n.style,position:this.feature.pictureFrames[t].position,offsetX:e,offsetY:i})}}},_generateFromFeature:function(){var t="";return this.feature.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL?t=this.feature.libID.toString()+"_"+this.feature.code.toString()+"_"+Math.round(this.feature.symbolSize.w).toString()+"_"+Math.round(this.feature.symbolSize.h).toString()+"_"+ +this.feature.dRotate.toString()+"_"+this.feature.symbolRank.toString()+this.feature.surroundLineType.toString()+this.feature.textContent+this.feature.annotationPosition:this.feature.symbolType!==SuperMap.Plot.SymbolType.PICTURE&&this.feature.symbolType!==SuperMap.Plot.SymbolType.MODELPLOT&&3e3!==this.feature.symbolType||(t=this.feature.libID.toString()+"_"+this.feature.code.toString()+"_"+this.feature.path+this.feature.style.graphicWidth+this.feature.style.graphicHeight+this.feature.style.graphicXOffset+this.feature.style.graphicYOffset,t+="_"+this._generateFromSymbolText(),t+="_"+this._generateFromBloodVolume()),t},_generateFromAnnotation:function(){return this.feature.textContent+"_"+this.feature.annotationPosition.toString()},_generateFromSymbolText:function(){var t="";if(null==this.feature.symbolTexts)return t;for(var e=0;e<this.feature.symbolTexts.length;e++){var i=this.feature.symbolTexts[e];"none"!=i.style.display&&(null!=i.textContent&&(t+="_"+i.textContent),null!=i.textPosition&&(t+="_"+i.textPosition.toString()),null!=i.offsetX&&(t+="_"+i.offsetX.toString()),null!=i.offsetY&&(t+="_"+i.offsetY.toString()),null!=i.border&&(t+="_"+i.border.toString()),null!=i.showRelationLine&&(t+="_"+i.showRelationLine.toString()),null!=i.paddingX&&(t+="_"+i.paddingX.toString()),null!=i.paddingY&&(t+="_"+i.paddingY.toString()),null!=i.style&&(t+=this._generateFromFeatureStyle(i.style)),null!=i.lineStyle&&(null!=i.lineStyle.color&&(t+="_"+i.lineStyle.color),null!=i.lineStyle.lineSymbolID&&(t+="_"+i.lineStyle.lineSymbolID),null!=i.lineStyle.opacity&&(t+="_"+i.lineStyle.opacity),null!=i.lineStyle.weight&&(t+="_"+i.lineStyle.weight)),0==this.feature._signUtils.length&&(null!=i.signType&&(t+="_"+i.signType.toString()),null!=i.signMode&&(t+="_"+i.signMode.toString()),null!=i.templateUrl&&(t+="_"+i.templateUrl.toString()),null!=i.domStr&&(t+="_"+i.domStr.toString())))}if(this.feature._signUtils.length>0)for(var o=0;o<this.feature._signUtils.length;o++)t+="_"+JSON.stringify(this.feature._signUtils[o]._getOptions());return t},_generateFromBloodVolume:function(){var t="";if(null==this.feature.bloodVolumes)return t;for(var e=0;e<this.feature.bloodVolumes.length;e++){var i=this.feature.bloodVolumes[e];null!=i.volume&&(t+="_"+i.volume),null!=i.position&&(t+="_"+i.position.toString()),null!=i.offsetX&&(t+="_"+i.offsetX.toString()),null!=i.offsetY&&(t+="_"+i.offsetY.toString()),null!=i.width&&(t+="_"+i.width.toString()),null!=i.height&&(t+="_"+i.height.toString()),null!=i.style&&(null!=i.style.color&&(t+="_"+i.style.color),null!=i.style.opacity&&(t+="_"+i.style.opacity.toString()),null!=i.style.weight&&(t+="_"+i.style.weight.toString()),null!=i.style.remainingVolumeColor&&(t+="_"+i.style.remainingVolumeColor),null!=i.style.remainingVolumeOpacity&&(t+="_"+i.style.remainingVolumeOpacity.toString()),null!=i.style.consumeVolumeColor&&(t+="_"+i.style.consumeVolumeColor),null!=i.style.consumeVolumeOpacity&&(t+="_"+i.style.consumeVolumeOpacity.toString()))}return t},_generateFromPictureFrame:function(){var t="";if(null==this.feature.pictureFrames)return t;for(var e=0;e<this.feature.pictureFrames.length;e++){var i=this.feature.pictureFrames[0];null!=i.path&&(t+="_"+i.path),null!=i.position&&(t+="_"+i.position.toString()),null!=i.offsetX&&(t+="_"+i.offsetX.toString()),null!=i.offsetY&&(t+="_"+i.offsetY.toString()),null!=i.width&&(t+="_"+i.width.toString()),null!=i.height&&(t+="_"+i.height.toString())}return t},_generateFromFeatureStyle:function(t){var e="";return null!=t.fontFamily&&(e+=t.fontFamily),null!=t.fontSize&&(e+="_"+t.fontSize),null!=t.fontColor&&(e+="_"+t.fontColor),null!=t.fontStroke&&(e+="_"+t.fontStroke),null!=t.fontStrokeColor&&(e+="_"+t.fontStrokeColor),null!=t.fontStrokeWidth&&(e+="_"+t.fontStrokeWidth),null!=t.fontBackground&&(e+="_"+t.fontBackground),null!=t.fontBackgroundColor&&(e+="_"+t.fontBackgroundColor),null!=t.fontShadow&&(e+="_"+t.fontShadow),null!=t.fontShadowColor&&(e+="_"+t.fontShadowColor),null!=t.fontShadowOffsetX&&(e+="_"+t.fontShadowOffsetX),null!=t.fontShadowOffsetY&&(e+="_"+t.fontShadowOffsetY),null!=t.color&&(e+="_"+t.color),null!=t.weight&&(e+="_"+t.weight),null!=t.opacity&&(e+="_"+t.opacity),null!=t.lineSymbolID&&(e+="_"+t.lineSymbolID),null!=t.dashArray&&(e+="_"+t.dashArray),null!=t.fill&&(e+="_"+t.fill),null!=t.fillSymbolID&&(e+="_"+t.fillSymbolID),null!=t.fillColor&&(e+="_"+t.fillColor),null!=t.fillOpacity&&(e+="_"+t.fillOpacity),null!=t.fillBackColor&&(e+="_"+t.fillBackColor),null!=t.fillBackOpacity&&(e+="_"+t.fillBackOpacity),null!=t.fillGradientMode&&(e+="_"+t.fillGradientMode),null!=t.surroundLineColor&&(e+="_"+t.surroundLineColor),null!=t.surroundLineColorOpacity&&(e+="_"+t.surroundLineColorOpacity),null!=t.surroundLineWidth&&(e+="_"+t.surroundLineWidth),e}});L.supermap.plotting.dotSymbolStyle=function(t){return new Qg(t)};var $g=Ay.extend({addFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]),Ay.prototype.addFeatures.call(this,t)}});L.supermap.plotting.animationLayer=function(t,e){return new $g(t,e)};var tf=L.Evented.extend({options:{position:"topright"},initialize:function(t){L.setOptions(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),o=t._controlCorners[i];return L.DomUtil.addClass(e,"leaflet-control"),-1!==i.indexOf("bottom")?o.insertBefore(e,o.firstChild):o.appendChild(e),this},remove:function(){return this._map?(L.DomUtil.remove(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}});L.Map.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",i=this._controlContainer=L.DomUtil.create("div",e+"control-container",this._container);function o(o,n){var l=e+o+" "+e+n;t[o+n]=L.DomUtil.create("div",l,i)}o("top","left"),o("top","right"),o("bottom","left"),o("bottom","right")},_clearControlPos:function(){L.DomUtil.remove(this._controlContainer)}});var ef=tf.extend({_mouseTolerance:10,_polyline:null,_currentpolyline:null,_editMarkers:null,wayAnimation:null,wayPath:[],_able:null,options:{wayAnimationStyle:{fill:!1,color:"#ff0000",dashArray:"2, 2",opacity:1,weight:1},draggable:!0,avoidIcon:L.divIcon({className:"leaflet-supermap-plot-avoid-icon-path",iconSize:[8,8]}),icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(t){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode()&&(this.options.avoidIcon=L.divIcon({className:"leaflet-supermap-plot-avoid-icon-path",iconSize:[15,15]}),this.options.icon=new L.DivIcon({iconSize:new L.Point(15,15),className:"leaflet-div-icon leaflet-editing-icon"})),L.Control.prototype.initialize.call(this,t),L.setOptions(this,t),this._editMarkers={},this._polyline=null,this._lineType=null},onAdd:function(t){return this.controlDiv=L.DomUtil.create("div","supermap-iclient-wayanmation"),this._map=t,this._markers=[],this._latlngs=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._map.on("mousemove",this._onMouseMove,this).on("click",this._onMapClick,this),this.controlDiv},onRemove:function(){this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,delete this._latlngs,this._polyline&&(delete this._polyline,this._polyline=null),this._map.off("mousemove",this._onMouseMove,this).off("click",this._onMapClick,this)},setWayAnimation:function(t){this.wayAnimation=t,this._lineType=this.wayAnimation.getGOAnimationType();try{if(this._lineType!=SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE_EXP&&this._lineType!=SuperMap.Plot.GOAnimationType.ANIMATION_CURVE_EXP)throw new Error("The type of animation is error!");if(null!=this.wayAnimation.path){var e=!1;if(this.wayAnimation.path._featureControlPoints.length==this.wayAnimation.wayPoints.length)for(var i=0;i<this.wayAnimation.path._featureControlPoints.index;i++)if(!this.wayAnimation.path._featureControlPoints[i].equals(this.wayAnimation.wayPoints[i])){e=!0;break}if(this.wayAnimation.path._featureControlPoints.length!==this.wayAnimation.wayPoints.length||e){if(this._currentpolyline=this.wayAnimation.path,this._polyline=this._map.getLayer(this.wayAnimation.path._leaflet_id),this._polyline.setStyle({weight:this.wayAnimation.pathWidth}),this._latlngs=this.wayAnimation.wayPoints,this._lineType==SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE_EXP)this._polyline.setLatLngs(this._latlngs);else if(this._lineType==SuperMap.Plot.GOAnimationType.ANIMATION_CURVE_EXP){var o=this._latLng2AlgoPlot(this._latlngs);o=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(o),o=this._algoPlot2LatLng(o),this._polyline.setLatLngs(o)}this._polyline._featureControlPoints=this._latlngs,this.disable(),this.wayAnimation.setPath(this._polyline),this._currentpolyline=this._polyline,this._latlngs=[],delete this._polyline,this._lineType=null,this._polyline=null}else this._currentpolyline=this.wayAnimation.path}else if(this.wayAnimation.wayPoints){if(this._polyline=L.polyline([],{color:"red",weight:3}),this._polyline.addTo(this._map),this._latlngs=this.wayAnimation.wayPoints,this._lineType==SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE_EXP)null!=this._polyline.type&&void 0!=this._polyline.type||(this._polyline.type="polyline"),this._polyline.setLatLngs(this._latlngs);else if(this._lineType==SuperMap.Plot.GOAnimationType.ANIMATION_CURVE_EXP){null!=this._polyline.type&&void 0!=this._polyline.type||(this._polyline.type="curve");var n=this._latLng2AlgoPlot(this._latlngs);n=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(n),n=this._algoPlot2LatLng(n),this._polyline.setLatLngs(n)}this._markers=[],this._polyline._featureControlPoints=this._latlngs,this.disable(),this.wayAnimation.setPath(this._polyline),this._currentpolyline=this._polyline,this._latlngs=[],delete this._polyline,this._lineType=null,this._polyline=null}}catch(t){console.log(t.message)}},setSelected:function(){if(null==this._currentpolyline)return!1;var t=this._currentpolyline._leaflet_id,e=this._map.getLayer(t);this._collectEditMarkers(e)},unSelected:function(){if(null==this._currentpolyline)return!1;var t=this._currentpolyline._leaflet_id,e=this._map.getLayer(t);this._removeMarkers(e)},setVisiable:function(t){var e=null;if(e=t?1:0,null!=this._currentpolyline){var i=this._map.getLayer(this._currentpolyline._leaflet_id).options.weight,o=this._map.getLayer(this._currentpolyline._leaflet_id).options.color;this._map.getLayer(this._currentpolyline._leaflet_id).setStyle({color:o,weight:i,opacity:e})}},getVisibale:function(){if(null!=this._currentpolyline){var t=this._currentpolyline.options.opacity;if(1==t)return!0;if(0==t)return!1}},enable:function(){this._able=!0},disable:function(){this._able=!1},_onMouseOut:function(t){t.target.layer._renderer._container.style.cursor=""},_onMapClick:function(t){if(this._able){if(this.moveend)return void(this.moveend=!1);var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);this._polyline?this._addVertex(i):(this._polyline=L.polyline([],{color:"red",weight:3}),this._polyline.options.color="red",this._polyline.redraw(),this._lineType==SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE_EXP?this._polyline.type="polyline":this._lineType==SuperMap.Plot.GOAnimationType.ANIMATION_CURVE_EXP&&(this._polyline.type="curve"),this._polyline.addLatLng(i),this._polyline.addTo(this._map),this._addVertex(i)),L.DomEvent.preventDefault(t.originalEvent)}},_collectEditMarkers:function(t){var e=[];void 0!=this._editMarkers[t._leaflet_id]&&0!=this._editMarkers[t._leaflet_id].length&&this._removeMarkers(t);for(var i=0;i<t._featureControlPoints.length;i++){var o=new L.LatLng(t._featureControlPoints[i].lat,t._featureControlPoints[i].lng),n=L.supermap.plotting.editMarker(o,{icon:this.options.avoidIcon,nHandle:-1,tag:i});this._addToMapAndBindMarker(n),e.push(n),n.owner=t}this._editMarkers[t._leaflet_id]=e},_removeMarkers:function(t){var e=this._editMarkers[t._leaflet_id];if(e){for(var i=0;i<e.length;i++)this._unbindMarkerEvents(e[i]),this._map.removeLayer(e[i]);delete this._editMarkers[t._leaflet_id]}},_unbindMarkerEvents:function(t){t.off("mousemove",this._moveMove,this),t.off("mouseout",this._moveOut,this),t.off("dragend",this._dragEnd,this),t.off("dragstart",this._dragStart,this),t.off("drag",this.redraw,this),t.dragging.disable()},_addToMapAndBindMarker:function(t){t.addTo(this._map),t.on("mousemove",this._moveMove,this),t.on("mouseout",this._moveOut,this),t.on("dragend",this._dragEnd,this),t.on("dragstart",this._dragStart,this),t.on("drag",this._dragPoint,this),t.dragging.enable()},_removePoint:function(t){if(t.target.owner.isSelected){var e=this._editMarkers[t.target.owner._leaflet_id],i=e.indexOf(t.target);this._map.removeLayer(e[i]),e.splice(i,1),t.target.owner.latLngs.splice(i,1),t.target.owner.redraw()}},_dragPoint:function(t){var e=t.target.owner,i=this._editMarkers[e._leaflet_id],o=SuperMap.Util.indexOf(i,t.target);e._featureControlPoints[o]=t.latlng,this._changeAnimationPath(e),this.moveend=!0,this.fire(SuperMap.Plot.Event.waymarkerdrag,{index:o,latLng:t.latlng})},_dragStart:function(t){this.fire(SuperMap.Plot.Event.beforewaymarkerdragstart,{feature:t.target.owner});var e=t.target.owner,i=this._editMarkers[e._leaflet_id],o=SuperMap.Util.indexOf(i,t.target);"polyline"==e.type?this._lineType=SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE_EXP:this._lineType=SuperMap.Plot.GOAnimationType.ANIMATION_CURVE_EXP,this.fire(SuperMap.Plot.Event.waymarkerdragstart,{index:o,latLng:t.latlng})},_changeAnimationPath:function(t){var e=t._featureControlPoints,i=t._leaflet_id;if(this._lineType==SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE_EXP)this._map.getLayer(i).setLatLngs(e),this._map.getLayer(i)._featureControlPoints=e,this.wayAnimation.setPath(this._map.getLayer(i)),this.wayAnimation.setWayPoints(e);else if(this._lineType==SuperMap.Plot.GOAnimationType.ANIMATION_CURVE_EXP){var o=this._latLng2AlgoPlot(e);o=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(o),o=this._algoPlot2LatLng(o),this._map.getLayer(i).setLatLngs(o),this._map.getLayer(i)._featureControlPoints=e,this.wayAnimation.setPath(this._map.getLayer(i)),this.wayAnimation.setWayPoints(e)}},_moveMove:function(t){t.target._icon.style.cursor="pointer"},_moveOut:function(t){t.target._icon.style.cursor=""},_dragEnd:function(t){this.moveend=!1,this.fire(SuperMap.Plot.Event.wayfeaturemodifyfinished,{result:t.target.owner._featureControlPoints,animation:this.wayAnimation})},_addVertex:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});if(this._markerGroup.addLayer(e),this._markers.push(e),this._latlngs.push(t),this._lineType==SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE_EXP)this._polyline.setLatLngs(this._latlngs);else{var i=this._latLng2AlgoPlot(this._latlngs);i=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(i),i=this._algoPlot2LatLng(i),this._polyline.setLatLngs(i)}var o=this._markers.length;o>1&&this._markers[o-1].on("click",this._finishShape,this),o>2&&this._markers[o-2].off("click",this._finishShape,this)},_finishShape:function(){if(this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this),L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode())if(this._lineType==SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE_EXP)this._polyline.setLatLngs(this._latlngs);else{var t=this._latLng2AlgoPlot(this._latlngs);t=SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t),t=this._algoPlot2LatLng(t),this._polyline.setLatLngs(t)}this._markerGroup.clearLayers(),this._markers=[],this._polyline._featureControlPoints=this._latlngs,this.disable(),this.wayAnimation.setPath(this._polyline),this._currentpolyline=this._polyline,this.wayAnimation.setWayPoints(this._polyline._featureControlPoints),this._polyline.setStyle({opacity:0}),this.fire(SuperMap.Plot.Event.wayfeaturedrawfinished,{feature:this._polyline,animation:this.wayAnimation}),this._latlngs=[],delete this._polyline,this._lineType=null,this._polyline=null},_onMouseMove:function(t){if(this._able){var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);if(this._polyline){var o=L.Util.cloneLatLngs(this._latlngs);if(0===o.length?o.push(i):o[o.length-1].lat===i.lat&&o[o.length-1].lng===i.lng||o.push(i),this._lineType==SuperMap.Plot.GOAnimationType.ANIMATION_BROKENLINE_EXP)this._polyline.setLatLngs(o);else{var n,l;n=this._latLng2AlgoPlot(o);var s=this._calBeizer(n);l=this._algoPlot2LatLng(s),this._polyline.setLatLngs(l)}}L.DomEvent.preventDefault(t.originalEvent)}},_calBeizer:function(t){return SuperMapAlgoPlot.PlottingUtil.generateBeizerPointsNoCtrlPt(t)},_latLng2AlgoPlot:function(t){for(var e=[],i=0;i<t.length;i++){var o=new SuperMapAlgoPlot.Point(t[i].lng,t[i].lat);e.push(o)}return e},_algoPlot2LatLng:function(t){for(var e=[],i=0;i<t.length;i++){var o=L.latLng(t[i].y,t[i].x);e.push(o)}return e}});function of(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return nf(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return nf(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var o=0,n=function(){};return{s:n,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,s=!0,a=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){a=!0,l=t},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw l}}}}function nf(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,o=new Array(e);i<e;i++)o[i]=t[i];return o}L.supermap.plotting.wayAnimationControl=function(t){return new ef(t)};var lf=tf.extend({drawType:null,_editMarkers:null,_polyline:null,_polygon:null,_drawObject:null,_positionMarkers:null,_active:null,_measureService:null,_disIndex:null,_areaIndex:null,_angleIndex:null,icon:null,leftTopIcon:L.divIcon({className:"leaflet-supermap-plot-left-top-icon-path",iconSize:[15,15]}),rightTopIcon:L.divIcon({className:"leaflet-supermap-plot-right-top-icon-path",iconSize:[15,15]}),leftBottomIcon:L.divIcon({className:"leaflet-supermap-plot-left-bottom-icon-path",iconSize:[15,15]}),rightBottomIcon:L.divIcon({className:"leaflet-supermap-plot-right-bottom-icon-path",iconSize:[15,15]}),options:{measureShapeStyle:{fill:!1,color:"#ffff00",dashArray:"2, 2",opacity:1,weight:1},draggable:!0,avoidIcon:L.divIcon({className:"leaflet-supermap-plot-avoid-icon-path",iconSize:[8,8]}),icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"})},lineStyle:null,areaStyle:null,initialize:function(t,e){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");if(!t)throw new Error("请输入量算服务地址");if(L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode()&&(this.options.avoidIcon=L.divIcon({className:"leaflet-supermap-plot-avoid-icon-path",iconSize:[15,15]}),this.options.icon=new L.DivIcon({iconSize:new L.Point(15,15),className:"leaflet-div-icon leaflet-editing-icon"})),L.Control.prototype.initialize.call(this,e),e&&e.drawType?this.drawType=e.drawType:this.drawType=0,this.iconSize=e&&e.iconSize?e.iconSize:[40,40],e&&e.iconUrl)if(this.defaultImgPath=L.Icon.Default.imagePath,e.iconUrl.includes("http"))L.Icon.Default.imagePath=e.iconUrl,this.iconUrl="";else{var i=document.location.href;if(i.endsWith("/"))L.Icon.Default.imagePath=document.location.href;else{var o=i.lastIndexOf("/"),n=i.slice(o),l=i.replace(n,"")+"/";L.Icon.Default.imagePath=l}this.iconUrl=e.iconUrl,this.icon=new L.Icon({iconUrl:e.iconUrl,iconSize:this.iconSize})}else this.defaultImgPath&&(L.Icon.Default.imagePath=this.defaultImgPath),this.iconUrl="marker-icon.png";this._editMarkers={},this._polyline=null,this._polygon=null,this._drawObject=new Map,this._positionMarkers=new Map,this._measureService=t,this._initStyle(e),this._disIndex=0,this._areaIndex=0,this._angleIndex=0},_initStyle:function(t){this.disLineStyle={color:"#ffff00",weight:2},this.angLineStyle={color:"#ffff00",weight:2},this.areaStyle={color:"#ffff00",weight:2,fillOpacity:.3},t&&(t.disLineStyle&&(t.disLineStyle.color&&(this.disLineStyle.color=t.disLineStyle.color),t.disLineStyle.weight&&(this.disLineStyle.weight=t.disLineStyle.weight)),t.angLineStyle&&(t.angLineStyle.color&&(this.angLineStyle.color=t.angLineStyle.color),t.angLineStyle.weight&&(this.angLineStyle.weight=t.angLineStyle.weight)),t.areaStyle&&(t.areaStyle.color&&(this.areaStyle.color=t.areaStyle.color),t.areaStyle.weight&&(this.areaStyle.weight=t.areaStyle.weight),t.areaStyle.fillOpacity&&(this.areaStyle.fillOpacity=t.areaStyle.fillOpacity)))},onAdd:function(t){return this.controlDiv=L.DomUtil.create("div","supermap-iclient"),this._map=t,this._markers=[],this._latlngs=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._map.on("mousemove",this._onMouseMove,this).on("click",this._onMapClick,this).on("contextmenu",this.disable,this),this.controlDiv},onRemove:function(){this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,delete this._latlngs,this._polyline&&(delete this._polyline,this._polyline=null),this._polygon&&(delete this._polygon,this.polygon=null),this._map.off("mousemove",this._onMouseMove,this).off("click",this._onMapClick,this).off("contextmenu",this.disable,this)},setMeasureType:function(t){this.drawType=t},enable:function(){this._active=!0,this._map.doubleClickZoom.disable(),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:this.icon?this.icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._mouseMarker.on("contextmenu",this._finishShape,this).addTo(this._map),this._mouseMarker.on("dblclick",this._finishShape,this).addTo(this._map)},disable:function(){this._finishShape(),this._active=!1,this._mouseMarker&&(this._mouseMarker.off("click",this._onClick,this),this._mouseMarker.off("contextmenu",this._finishShape,this).addTo(this._map),this._mouseMarker.off("dblclick",this._finishShape,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker)},getMarkObject:function(){return this._finishShape(),{drawObject:this._drawObject,positionMarkers:this._positionMarkers}},clearMarkObject:function(t){if(t){for(var e=0;e<t.drawObject.length;e++)t.drawObject[e]&&this._map.removeLayer(t.drawObject[e]);for(var i=0;i<t.positionMarkers.length;i++)t.positionMarkers[i]&&this._map.removeLayer(t.positionMarkers[i])}},clear:function(){this._unSelectedMeasureObj(),this._active=!1,this._latlngs=[],this._polyline=null,this._polygon=null;var t,e=of(this._drawObject.keys());try{for(e.s();!(t=e.n()).done;){var i=t.value;this._drawObject.get(i)&&this._map.removeLayer(this._drawObject.get(i))}}catch(t){e.e(t)}finally{e.f()}this._drawObject.clear();var o,n=of(this._positionMarkers.keys());try{for(n.s();!(o=n.n()).done;){var l=o.value;if(this._positionMarkers.get(l))for(var s=0;s<this._positionMarkers.get(l).length;s++)this._map.removeLayer(this._positionMarkers.get(l)[s])}}catch(t){n.e(t)}finally{n.f()}this._positionMarkers.clear(),this._markers=[],this.disable()},removeMeasureById:function(t){if(this._active=!1,this._drawObject.get(t)&&this._map.removeLayer(this._drawObject.get(t)),this._drawObject.delete(t),this._positionMarkers.get(t))for(var e=0;e<this._positionMarkers.get(t).length;e++)this._map.removeLayer(this._positionMarkers.get(t)[e]);this.disable(),this._unSelectedMeasureObj()},setDisLineStyle:function(t,e){for(var i in e)switch(i){case"color":this._drawObject.get(t).setStyle({color:e[i]});break;case"weight":this._drawObject.get(t).setStyle({weight:e[i]})}},setAngLineStyle:function(t,e){this.setDisLineStyle(t,e)},setAreaStyle:function(t,e){for(var i in e)switch(i){case"color":this._drawObject.get(t).setStyle({color:e[i]});break;case"weight":this._drawObject.get(t).setStyle({weight:e[i]});break;case"fillOpacity":this._drawObject.get(t).setStyle({fillOpacity:e[i]})}},_measureDistance:function(t){if(null!=t&&1!==t.length){for(var e=[],i=0;i<t.length;i++)e.push(t[i]);for(var o=[],n=0;n<e.length-1;n++){var l=this._calculateDistance(e[n],e[n+1]);o.push(l)}for(var s=0;s<e.length-1;s++)this._markers[t.length-1].bindPopup("距离:"+o[s]+"米").openPopup(this._markers[t.length-1].getLatLng())}},_calculateDistance:function(t,e){return this._map.distance(t,e)},_getAddress:function(){var t="";try{t=window.location.href.split("//")[1].split(":")[0]}catch(e){t="localhost"}var e="";window.location.href.includes("iserver")?e="http://"+t+":"+window.location.href.split("//")[1].split(":")[1].split("/")[0]+"/iserver/services/map-china400/rest/maps/China_4326":e="http://"+t+":8090/iserver/services/map-china400/rest/maps/China_4326";return e},_measureArea:function(t){if(!(t.length<3)){for(var e=[],i=0;i<t.length;i++)e.push(t[i]);this._measureService||(this._measureService=this._getAddress());var o=new L.supermap.MeasureService(this._measureService),n=new L.supermap.MeasureParameters;n.geometry=this._polygon,o.measureArea(n,function(t){if(void 0!==t.result){var e="面积："+t.result.area+"平方米";this._polygon&&this._polygon.bindPopup(e).openPopup(this._polygon.getCenter())}}.bind(this))}},_measureAzimuth:function(t){if(null!=t&&1!==t.length){for(var e=[],i=0;i<t.length;i++)e.push(t[i]);for(var o=[],n=0;n<e.length-1;n++){var l=this.calculateazimuth(e[n],e[n+1]);o.push(l)}for(var s=0;s<e.length-1;s++)if(o[s]<0){var a=o[s]+360;this._markers[t.length-1].bindPopup("方位角为："+a+"°").openPopup(this._markers[t.length-1].getLatLng())}else this._markers[t.length-1].bindPopup("方位角为："+o[s]+"°").openPopup(this._markers[t.length-1].getLatLng())}},calculateazimuth:function(t,e){var i=t.lat*(Math.PI/180),o=t.lng*(Math.PI/180),n=e.lat*(Math.PI/180),l=e.lng*(Math.PI/180);return Math.atan2(Math.sin(l-o)*Math.cos(n),Math.cos(i)*Math.sin(n)-Math.sin(i)*Math.cos(n)*Math.cos(l-o))*(180/Math.PI)},getSelectedObject:function(t){return this._drawObject.get(t)},_onMouseOut:function(t){t.target.layer._renderer._container.style.cursor=""},_onMapClick:function(t){if(this._active){if(this.moveend)return void(this.moveend=!1);var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);this._polyline||this._polygon?(this._addVertex(i),0===this.drawType?this._measureDistance(this._latlngs):1===this.drawType?this._measureArea(this._latlngs):2===this.drawType&&this._measureAzimuth(this._latlngs)):(this._markers=[],1!=this.drawType?(0===this.drawType?this._polyline=L.polyline([],{color:this.disLineStyle.color,weight:this.disLineStyle.weight}):this._polyline=L.polyline([],{color:this.angLineStyle.color,weight:this.angLineStyle.weight}),this._polyline.addLatLng(i),this._polyline.addTo(this._map),this._addVertex(i),0===this.drawType?this._measureDistance(this._latlngs):2===this.drawType&&this._measureAzimuth(this._latlngs),this._polyline.isMeasureObj=!0,this._polyline.on("selectedMeasureObject",this._selectedMeasureObj,this)):1===this.drawType&&(this._polygon=L.polygon([],{color:this.areaStyle.color,weight:this.areaStyle.weight,fillOpacity:this.areaStyle.fillOpacity}),this._polygon.addLatLng(i),this._polygon.addTo(this._map),this._addVertex(i),this._measureArea(this._latlngs),this._polygon.isMeasureObj=!0,this._polygon.on("selectedMeasureObject",this._selectedMeasureObj,this))),L.DomEvent.preventDefault(t.originalEvent)}},_onClick:function(t){if(this._active){if(this.moveend)return void(this.moveend=!1);var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);this._polyline||this._polygon?(this._addVertex(i),0===this.drawType?this._measureDistance(this._latlngs):1===this.drawType?this._measureArea(this._latlngs):2===this.drawType&&this._measureAzimuth(this._latlngs)):1!=this.drawType?(0===this.drawType?this._polyline=L.polyline([],{color:this.disLineStyle.color,weight:this.disLineStyle.weight}):this._polyline=L.polyline([],{color:this.angLineStyle.color,weight:this.angLineStyle.weight}),this._polyline.addLatLng(i),this._polyline.addTo(this._map),this._addVertex(i),0===this.drawType?this._measureDistance(this._latlngs):2===this.drawType&&this._measureAzimuth(this._latlngs),this._polyline.isMeasureObj=!0,this._polyline.on("selectedMeasureObject",this._selectedMeasureObj,this)):1===this.drawType&&(this._polygon=L.polygon([],{color:this.areaStyle.color,weight:this.areaStyle.weight,fillColor:this.areaStyle.fillColor,fillOpacity:this.areaStyle.fillOpacity}),this._polygon.addLatLng(i),this._polygon.addTo(this._map),this._addVertex(i),this._measureArea(this._latlngs),this._polygon.isMeasureObj=!0,this._polygon.on("selectedMeasureObject",this._selectedMeasureObj,this)),L.DomEvent.preventDefault(t.originalEvent)}},_selectedMeasureObj:function(t){if(!this._active){var e=this._drawObject.get(t.id);if(e){this.frames&&this._unSelectedMeasureObj();var i=e.getBounds();if(i){this.frames=[];var o=L.latLng(i._northEast.lat,i._northEast.lng),n=L.latLng(i._northEast.lat,i._southWest.lng),l=L.latLng(i._southWest.lat,i._northEast.lng),s=L.latLng(i._southWest.lat,i._southWest.lng),a=L.supermap.plotting.editMarker(o,{icon:this.rightTopIcon,nHandle:-3}),r=L.supermap.plotting.editMarker(n,{icon:this.leftTopIcon,nHandle:-3}),u=L.supermap.plotting.editMarker(l,{icon:this.rightBottomIcon,nHandle:-3}),p=L.supermap.plotting.editMarker(s,{icon:this.leftBottomIcon,nHandle:-3});this.frames.push(a),this.frames.push(r),this.frames.push(u),this.frames.push(p);for(var h=0;h<this.frames.length;h++)this.frames[h].addTo(this._map);this._map.on("click",this._unSelectedMeasureObj,this)}e&&this.fire(SuperMap.Plot.Event.selectedmeasureobject,t)}}},_unSelectedMeasureObj:function(){if(this.frames){for(var t=0;t<this.frames.length;t++)this._map.removeLayer(this.frames[t]);this.frames=[]}},_addVertex:function(t){var e=new L.Marker(t);if(e.options.icon.options.iconUrl=this.iconUrl,e.options.icon.options.iconRetinaUrl=this.iconUrl,e.options.icon.options.shadowUrl=this.iconUrl,e.options.icon.options.iconSize=[18,30],e.options.icon.options.iconAnchor=[10,28],e.options.icon.options.shadowSize=[0,0],this._map.addLayer(e),this._markerGroup.addLayer(e),this._markers.push(e),0===this.drawType){var i="0-"+this._disIndex.toString();this._positionMarkers.set(i,this._markers)}else if(1===this.drawType){i="1-"+this._angleIndex.toString();this._positionMarkers.set(i,this._markers)}else if(2===this.drawType){i="2-"+this._areaIndex.toString();this._positionMarkers.set(i,this._markers)}this._latlngs.push(t),1!=this.drawType?this._polyline.setLatLngs(this._latlngs):this._polygon.setLatLngs(this._latlngs);var o=this._markers.length;o>1&&this._markers[o-1].on("click",this._finishShape,this),o>2&&this._markers[o-2].off("click",this._finishShape,this)},_finishShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this),1!=this.drawType&&this._polyline?(this._polyline&&this._polyline.setLatLngs(this._latlngs),0===this.drawType?(this._measureDistance(this._latlngs),this._polyline._id="0-"+this._disIndex.toString(),this._disIndex++):2===this.drawType&&(this._measureAzimuth(this._latlngs),this._polyline._id="2-"+this._areaIndex.toString(),this._areaIndex++),this._drawObject.set(this._polyline._id,this._polyline)):1===this.drawType&&this._polygon&&(this._polygon&&this._polygon.setLatLngs(this._latlngs),this._measureArea(this._latlngs),this._polygon._id="1-"+this._angleIndex.toString(),this._angleIndex++,this._drawObject.set(this._polygon._id,this._polygon)),this._polyline?(this._polyline._featureControlPoints=this._latlngs,delete this._polyline,this._polyline=null):this._polygon&&(this._polygon._featureControlPoints=this._latlngs,delete this._polygon,this._polygon=null),this._latlngs=[]},_onMouseMove:function(t){if(this._active){var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);if(this._polyline||this._polygon){var o=L.Util.cloneLatLngs(this._latlngs);0===o.length?o.push(i):o[o.length-1].lat===i.lat&&o[o.length-1].lng===i.lng||o.push(i),1!=this.drawType?(this._polyline.setLatLngs(o),0===this.drawType?this._measureDistance(this._latlngs):2===this.drawType&&this._measureAzimuth(this._latlngs)):(this._polygon.setLatLngs(o),this._measureArea(this._latlngs)),this._mouseMarker.setLatLng(i)}L.DomEvent.preventDefault(t.originalEvent)}}});L.supermap.plotting.measureControl=function(t,e){return new lf(t,e)},L.supermap.plotting.MeasureControl=lf;var sf=L.Handler.extend({symbolData:null,plotting:null,_isDrawing:!1,libID:0,code:24,serverUrl:"",path:null,isFreeCure:!1,_drawingLayer:null,_tempDrawingLayer:null,_control:null,options:{tolerancePixel:6,allowIntersection:!0,repeatMode:!0,icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),touchIcon:new L.DivIcon({iconSize:new L.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#3388ff",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,feet:!0,nautic:!1,showLength:!0,zIndexOffset:2e3},initialize:function(t,e,i){L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode()&&(this.options.icon=this.options.touchIcon),this._map=t,this._drawingLayer=e,this._tempDrawingLayer=new Ay("drawControl-temportary"),this._container=t._container,this._overlayPane=t._panes.overlayPane,L.setOptions(this,i)},addHooks:function(){this._map&&(this._map.dragging.disable(),this._isDrawing=!1,this._markers=[],this._latlngs=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._map.addLayer(this._tempDrawingLayer),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mousedown",this._onMouseDown,this).on("mouseup",this._onMouseUp,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("zoomend",this._onZoomEnd,this),this._map.getPlotEditControl()&&this._map.getPlotEditControl()._avoidEditing&&this._map.getPlotEditControl().avoidEdit(!1),null!=this._map.doubleClickZoom&&this._map.doubleClickZoom.enabled()&&(this.doubleClickZoomEnabled=!0,this._map.doubleClickZoom.disable()))},removeHooks:function(){this._isDrawing=!1,this._map.dragging.enable(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,delete this._latlngs,delete this.isFreeCure,this.plotting&&(this._tempDrawingLayer.removeFeatures(this.plotting),delete this.plotting,this.plotting=null),this._map.removeLayer(this._tempDrawingLayer),this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseup",this._onMouseUp,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this),null!=this._map.doubleClickZoom&&!0===this.doubleClickZoomEnabled&&this._map.doubleClickZoom.enable()},deleteLastVertex:function(){if(!(this._markers.length<=1)){this._latlngs.pop();var t=this._markers.pop(),e=this.plotting.getLatLngs(),i=e.splice(-1,1)[0];this.plotting.setLatLngs(e),this._markerGroup.removeLayer(t),this.plotting.getLatLngs().length<2&&this._tempDrawingLayer.removeFeatures(this.plotting),this._vertexChanged(i,!1)}},addVertex:function(t){if(this._markers.push(this._createMarker(t)),this._latlngs.push(t),this.plotting&&0===this.libID&&1023===this.code&&!0===this.isFreeCure)this.plotting.setLatLngs(this._freeCurveResample(this._latlngs));else if(this.plotting&&SuperMap.Plot.AlgoSymbolFactory.isAccessServer(this.plotting.libID,this.plotting.code)&&this._latlngs.length>=this.plotting.minEditPts){var e=new SuperMap.GetSymbolInfoParameters({libID:this.libID,code:this.code});e.inputPoints=L.Util.latLngsToSuperMapPoints(this._latlngs),L.supermap.symbolInfoService(this._drawingLayer.serverUrl,this._drawingLayer.options.serviceParams).getSymbolInfo(e,function(t){this.plotting.symbolData=t.result,this.plotting.setLatLngs(this._latlngs)},this)}else if(this.plotting&&this.plotting instanceof _y){var i=this._map.layerPointToLatLng(L.point(0,0)),o=this._map.layerPointToLatLng(L.point(this.options.tolerancePixel,0)),n=SuperMap.Plot.PlottingUtil.distance({x:i.lng,y:i.lat},{x:o.lng,y:o.lat});this.plotting._addRouteNodeByPos(t,n)}else if(100==this.libID&&23800==this.code){var l=[];l.push(this._latlngs[0]);for(var s=2;s<this._latlngs.length;s++)l.push(this._latlngs[s]);this._latlngs.length>2&&l.push(this._latlngs[1]),this.plotting.setLatLngs(l)}else this.plotting&&this.plotting.setLatLngs(this._latlngs);this._vertexChanged(t,!0)},_finishShape:function(){this._markers.length>1&&(this._markers[this._markers.length-1].off("click",this._finishShape,this),this._markers[this._markers.length-1].off("contextmenu",this._finishShape,this)),L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode()&&this._latlngs.length+1<this.plotting.maxEditPts&&"function"==typeof this.plotting.getLatLngs&&this._latlngs.length!==this.plotting.getLatLngs().length&&this.plotting.setLatLngs(this._latlngs),0===this.libID&&this.code===SuperMap.Plot.SymbolType.FREECURVE&&!0===this.isFreeCure&&(this.isFreeCure=!1),null!=this.plotting&&-1===this.plotting.libID&&(this.plotting.libID=this.libID,this.plotting.code=this.code);var t=null;if(null!=this.plotting&&(t=this.plotting.clone()),this._markerGroup.clearLayers(),this._markers=[],this._latlngs=[],this._tempDrawingLayer.removeFeatures(this.plotting),delete this.plotting,null!=t&&this._drawingLayer.addFeatures(t),null!=t&&this._drawingLayer._renderer instanceof L.SVG&&(t.isFirstAdd=!0),this._control.fire(SuperMap.Plot.Event.featureadded,{feature:t}),this._isDrawing=!1,this.options.repeatMode||this.disable(),null!=t&&null!=t.layer){var e=new SuperMap.Plot.Transaction;e.transType=SuperMap.Plot.TransactionType.CREATE;var i=new SuperMap.Plot.TransactionInfo;i.layerId=t.layer._leaflet_id,i.feature=t,e.transInfos.push(i),L.supermap.plotting.getControl(this._map,this.serverUrl,{serviceParams:this._drawingLayer.options.serviceParams}).getTransManager().add(e)}},_onZoomEnd:function(){this._markers},_onMouseMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent),i=this._map.layerPointToLatLng(e);if(this._currentLatLng=i,!this.plotting||!0!==this._isDrawing||this.plotting instanceof _y)!1===this._isDrawing&&(this._isDrawing=!0,this._createFeature());else{var o=L.Util.cloneLatLngs(this._latlngs);if(0===o.length?o.push(i):o[o.length-1].lat===i.lat&&o[o.length-1].lng===i.lng||o.push(i),0===this.libID&&this.code===SuperMap.Plot.SymbolType.FREECURVE&&!0===this.isFreeCure){this._latlngs.push(i);var n=this._freeCurveResample(this._latlngs);this.plotting.setLatLngs(n),i.lat=n[n.length-1].lat,i.lng=n[n.length-1].lng}else if(this.plotting.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL&&SuperMap.Plot.AlgoSymbolFactory.isAccessServer(this.plotting.libID,this.plotting.code)&&o.length>=this.plotting.minEditPts){var l=new SuperMap.GetSymbolInfoParameters({libID:this.libID,code:this.code});l.inputPoints=L.Util.latLngsToSuperMapPoints(o),L.supermap.symbolInfoService(this._drawingLayer.serverUrl,this._drawingLayer.options.serviceParams).getSymbolInfo(l,function(t){this.plotting.symbolData=t.result,this.plotting.setLatLngs(o)},this)}else if(100==this.libID&&23800==this.code){var s=[];s.push(o[0]);for(var a=2;a<o.length;a++)s.push(o[a]);o.length>2&&s.push(o[1]),this.plotting.setLatLngs(s)}else this.plotting.setLatLngs(o)}this._mouseMarker.setLatLng(i);var r="右键单击结束绘制",u=i;if(this.symbolData&&this.symbolData.code==this.code&&this.symbolData.symbolType==SuperMap.Plot.SymbolType.DOTSYMBOL){var p=this._map.latLngToContainerPoint(i);window.x=p.x-25.4*this.symbolData.anchorPoint.x/96,p.y=p.y-25.4*(this.symbolData.symbolSize.y-this.symbolData.anchorPoint.y)/96;var h=L.point([p.x,p.y]);u=this._map.containerPointToLatLng(h)}else r="双击或右键单击结束本次绘制，再次右键单击结束绘制";void 0===this.plotting||null===this.plotting?this._mouseMarker.closePopup():this._mouseMarker.bindPopup(r,{autoPan:!1}).openPopup(u),L.DomEvent.preventDefault(t.originalEvent)},_createFeature:function(t){if("function"==typeof this._drawingLayer.getSymScaleDefinition&&(this._tempDrawingLayer.setSymScaleDefinition(this._drawingLayer.getSymScaleDefinition()),this._tempDrawingLayer.enableSymScale=this._drawingLayer.enableSymScale),0!==this.libID||this.code!==SuperMap.Plot.SymbolType.PICTURE&&3e3!==this.code&&this.code!==SuperMap.Plot.SymbolType.MODELPLOT)if(SuperMap.Plot.AlgoSymbolFactory.isAccessServer(this.libID,this.code))if(this.symbolData=this._drawingLayer._getSymbolDataFromCache(this.libID,this.code),null===this.symbolData){var e=Math.floor(1e3*Math.random()),i=new SuperMap.GetSymbolInfoParameters({libID:this.libID,code:this.code});i.dynamicToken=e,L.supermap.symbolInfoService(this._drawingLayer.serverUrl,this._drawingLayer.options.serviceParams).getSymbolInfo(i,function(i){i.result.dynamicToken&&i.result.dynamicToken===SuperMap.MD5.md5(e.toString())?this.libID!==i.result.libID||this.code!==i.result.code?this.symbolData=null:(this._drawingLayer._cacheSymbolData(i.result),this.symbolData=i.result,this.plotting=L.supermap.plotting.PlottingObject.createSymbol(this.libID,this.code,[],{symbolData:this.symbolData,serverUrl:this._drawingLayer.serverUrl,serviceParams:this._drawingLayer.serviceParams,map:this._map}),this._control.fire(SuperMap.Plot.Event.beforefeatureadded,{feature:this.plotting}),this._tempDrawingLayer.addFeatures(this.plotting),this.plotting.isEdit=!1,"function"==typeof t&&t()):this.symbolData=null},this)}else this.plotting=L.supermap.plotting.PlottingObject.createSymbol(this.libID,this.code,[],{symbolData:this.symbolData,serverUrl:this._drawingLayer.serverUrl,serviceParams:this._drawingLayer.serviceParams,map:this._map}),this._control.fire(SuperMap.Plot.Event.beforefeatureadded,{feature:this.plotting}),this._tempDrawingLayer.addFeatures(this.plotting),this.plotting.isEdit=!1,"function"==typeof t&&t();else if(this.plotting=L.supermap.plotting.PlottingObject.createSymbol(this.libID,this.code,[],{serverUrl:this._drawingLayer.serverUrl,spatialAnalystUrl:this._drawingLayer.spatialAnalystUrl,serviceParams:this._drawingLayer.serviceParams,map:this._map}),this.plotting.subSymbols&&0!==this.plotting.subSymbols.length){for(var o=[],n=0,l=this.plotting.subSymbols.length;n<l;n++)null===this.plotting.subSymbols[n].symbolData&&(this.plotting.subSymbols[n].symbolData=this._drawingLayer._getSymbolDataFromCache(this.plotting.subSymbols[n].libID,this.plotting.subSymbols[n].code),null===this.plotting.subSymbols[n].symbolData&&-1===SuperMap.Util.indexOf(o,this.plotting.subSymbols[n])&&o.push(this.plotting.subSymbols[n]));for(var s=o.slice(),a=0;a<o.length;a++){var r=new SuperMap.GetSymbolInfoParameters({libID:o[a].libID,code:o[a].code});L.supermap.symbolInfoService(this.serverUrl,this._drawingLayer.options.serviceParams).getSymbolInfo(r,function(e){this._drawingLayer._cacheSymbolData(e.result);for(var i=0,o=this.plotting.subSymbols.length;i<o;i++)if(null===this.plotting.subSymbols[i].symbolData&&this.plotting.subSymbols[i].libID===e.result.libID&&this.plotting.subSymbols[i].code===e.result.code){var n=SuperMap.Util.indexOf(s,this.plotting.subSymbols[i]);-1!==n&&s.splice(n,1),this.plotting.subSymbols[i].symbolData=SuperMap.Plot.PlottingUtil.cloneObject(e.result)}0===s.length&&(this._control.fire(SuperMap.Plot.Event.beforefeatureadded,{feature:this.plotting}),this._tempDrawingLayer.addFeatures(this.plotting),this.plotting.isEdit=!1,"function"==typeof t&&t())},this)}0===o.length&&(this._control.fire(SuperMap.Plot.Event.beforefeatureadded,{feature:this.plotting}),this._tempDrawingLayer.addFeatures(this.plotting),this.plotting.isEdit=!1,"function"==typeof t&&t())}else this._control.fire(SuperMap.Plot.Event.beforefeatureadded,{feature:this.plotting}),this._tempDrawingLayer.addFeatures(this.plotting),this.plotting.isEdit=!1,"function"==typeof t&&t();else this.plotting=L.supermap.plotting.PlottingObject.createSymbol(this.libID,this.code,[],{serverUrl:this._drawingLayer.serverUrl,spatialAnalystUrl:this._drawingLayer.spatialAnalystUrl,serviceParams:this._drawingLayer.serviceParams,map:this._map,path:this.path,name:this.name,img:this.img}),this._control.fire(SuperMap.Plot.Event.beforefeatureadded,{feature:this.plotting}),this._tempDrawingLayer.addFeatures(this.plotting),this.plotting.isEdit=!1,"function"==typeof t&&t()},_vertexChanged:function(){var t=this._markers.length;t>1&&(this._markers[t-1].on("click",this._finishShape,this),this._markers[t-1].on("contextmenu",this._finishShape,this)),t>2&&(this._markers[t-2].off("click",this._finishShape,this),this._markers[t-2].off("contextmenu",this._finishShape,this))},_onMouseDown:function(t){if(t&&2===t.originalEvent.button&&0===this._latlngs.length)this.disable();else if(!this._clickHandled&&!this._touchHandled&&!this._disableMarkers&&this._drawingLayer&&this._drawingLayer.isEditable&&this._drawingLayer._map){this._onMouseMove(t),this._clickHandled=!0,this._disableNewMarkers();var e=t.originalEvent,i=e.clientX,o=e.clientY;this._startPoint.call(this,i,o)}},_startPoint:function(t,e){0===this.libID&&this.code===SuperMap.Plot.SymbolType.FREECURVE&&(this.isFreeCure=!0),this._mouseDownOrigin=L.point(t,e)},_onMouseUp:function(t){if(t&&2===t.originalEvent.button&&0===this._latlngs.length)L.DomEvent.stopPropagation(t);else{!L.Browser.ie||null!==this._mouseDownOrigin&&void 0!==this._mouseDownOrigin||this._onMouseDown.call(this,t);var e=t.originalEvent,i=e.clientX,o=e.clientY;this._endPoint.call(this,i,o,t),this._clickHandled=null,L.DomEvent.stopPropagation(t)}},_endPoint:function(t,e,i){if(this._mouseDownOrigin){var o=L.point(t,e).distanceTo(this._mouseDownOrigin),n=this._calculateFinishDistance(i.latlng);if(L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode()&&null==this.plotting){var l=this;this._createFeature(function(){l._latlngs.push(i.latlng),l.plotting.setLatLngs(l._latlngs),(l.plotting instanceof xh||l.plotting instanceof L.supermap.plotting.Route)&&(l._latlngs.length+1>=l.plotting.maxEditPts||n<20&&L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode())?l._finishShape():Math.abs(o)<90*(window.devicePixelRatio||1)&&l.addVertex(i.latlng),l._enableNewMarkers()})}else(this.plotting instanceof xh||this.plotting instanceof L.supermap.plotting.Route)&&(i&&2===i.originalEvent.button||this._latlngs.length+1>=this.plotting.maxEditPts||n<20&&L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode())?this._finishShape():this.addVertex(i.latlng),this._enableNewMarkers()}this._mouseDownOrigin=null},_onTouch:function(t){var e,i,o=t.originalEvent;!o.touches||!o.touches[0]||this._clickHandled||this._touchHandled||this._disableMarkers||(e=o.touches[0].clientX,i=o.touches[0].clientY,this._disableNewMarkers(),this._touchHandled=!0,this._startPoint.call(this,e,i),this._endPoint.call(this,e,i,t),this._touchHandled=null),this._clickHandled=null},_calculateFinishDistance:function(t){var e;if(this._markers.length>0){var i=this._markers[this._markers.length-1],o=this._map.latLngToContainerPoint(i.getLatLng()),n=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),l=this._map.latLngToContainerPoint(n.getLatLng());e=o.distanceTo(l)}else e=1/0;return e},_createMarker:function(t){var e=new L.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_disableNewMarkers:function(){this._disableMarkers=!0},_enableNewMarkers:function(){setTimeout(function(){this._disableMarkers=!1}.bind(this),50)},_freeCurveResample:function(t){var e=t.slice(),i=[];if(e.length<3)i=e.slice();else{if(!this.plotting.isEdit){var o=this._map.layerPointToLatLng(L.point(0,0)),n=this._map.layerPointToLatLng(L.point(100,100)),l=Math.abs(o.lng-n.lng),s=this._reSample(L.Util.latLngsToSuperMapPoints(e),l/50);(s=L.Util.superMapPointsToLatLngs(s)).length<3&&(s=e),e=(e=[]).concat(s)}var a=SuperMap.Plot.PlottingUtil.computeBeizerPoints(this.plotting.isEdit,L.Util.latLngsToSuperMapPoints(e),[]);i=SuperMap.Plot.PlottingUtil.clonePoints(L.Util.superMapPointsToLatLngs(a.beizerPoints))}return i},_reSample:function(t,e){var i=[];if(null==t||e<0)return i;var o=t.length;if(o>2){var n=new SuperMapAlgoPlot.Point(0,0),l=0,s=0,a=0,r=2*Math.PI;n=t[0],i.push(n);for(var u=!1,p=!1,h=!1,c=1;c<o;c++)if(s=Math.sqrt((t[c].y-n.y)*(t[c].y-n.y)+(t[c].x-n.x)*(t[c].x-n.x)),SuperMapAlgoPlot.PlottingUtil.equalFuzzy(0,s))u&&(n=t[c-1],c--,i.push(n),a=0,r=2*Math.PI,u=!1,p=!1,h=!1);else{var y=(t[c].x-n.x)/s,g=(t[c].y-n.y)/s;if(l=g>0||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(0,g)?Math.acos(y):2*Math.PI-Math.acos(y),r>2*Math.PI&&l+2*Math.PI<r?(l+=2*Math.PI,a<0&&(a+=2*Math.PI)):a<0&&l-2*Math.PI>a&&(l-=2*Math.PI,r>2*Math.PI&&(r-=2*Math.PI)),l>a&&l<r||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(0,l-a)||SuperMapAlgoPlot.PlottingUtil.equalFuzzy(0,l-r)){var f=Math.atan(e/s);p?a<l-f&&(a=l-f):(p=!0,a=l-f),h?r>l+f&&(r=l+f):(h=!0,r=l+f),u=!0}else n=t[c-1],c--,i.push(n),a=0,r=2*Math.PI,u=!1,p=!1,h=!1}return i.push(t[o-1]),i}return i}}),af=tf.extend({drawingLayer:null,initialize:function(t,e){if(L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");this.drawingLayer=t,null!=this.drawingLayer&&this.drawingLayer instanceof Iy&&(L.supermap.plotting.getControl().plotMapManager.activePlottingLayer=this.drawingLayer,L.supermap.plotting.getControl().plotMapManager.activeChildPlotLayer=this.drawingLayer.getChildPlotLayers()[0]),L.Control.prototype.initialize.call(this,e)},onAdd:function(t){var e=L.DomUtil.create("div","supermap-iclient");return this._map=t,this.handler=new sf(this._map,this.drawingLayer),this.handler._control=this,this._map._plotDrawControl=this,this.handler._drawingLayer=this.drawingLayer,this.drawingLayer&&(this.handler._tempDrawingLayer.serverUrl=this.drawingLayer.serverUrl,this.handler._tempDrawingLayer.symScaleDefinition=this.drawingLayer.symScaleDefinition,this.handler._tempDrawingLayer.enableSymScale=this.drawingLayer.enableSymScale,this.handler._drawingLayer.serviceParams=this.drawingLayer.serviceParams),e},onRemove:function(){this._map._plotDrawControl=null,this._map=null,this.handler=null},setDrawingLayer:function(t,e){t&&(this.drawingLayer=t,this.handler._drawingLayer=t,this.handler._tempDrawingLayer.serverUrl=t.serverUrl,this.handler._tempDrawingLayer.symScaleDefinition=t.symScaleDefinition,this.handler._tempDrawingLayer.enableSymScale=t.enableSymScale,this.handler._drawingLayer.serviceParams=t.serviceParams,this.drawingLayer instanceof Iy&&(L.supermap.plotting.getControl().plotMapManager.activePlottingLayer=this.drawingLayer,null!=e&&-1!=SuperMap.Util.indexOf(this.drawingLayer.getChildPlotLayers(),e)?L.supermap.plotting.getControl().plotMapManager.activeChildPlotLayer=e:L.supermap.plotting.getControl().plotMapManager.activeChildPlotLayer=this.drawingLayer.getChildPlotLayers()[0]))}});L.Map.include({_getPlotDrawControl:function(){return this._plotDrawControl?this._plotDrawControl:null}});var rf=function(t,e){return new af(t,e)};L.supermap.plotting.drawControl=rf,L.supermap.plotting.DrawControl=af;var uf=tf.extend({_dragStartScale:null,_dragStartRotate:null,_dragStartBounds:null,_dragStartLatLngs:null,_dragStartScaleValues:null,_dragStartPositionOffset:null,_dragStartScalePoints:null,_editMarkers:null,_disEditBox:null,_editFrames:null,_editFeatures:null,_mouseTolerance:10,touchTolerance:20,_editMode:SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE,_avoidEditing:!1,_isMultiSelect:!1,_callback:null,selectedFeatures:[],selectedSignSymbols:[],rotateValue:null,rotateMarker:null,options:{highlightFlag:!0,highlightStyle:{color:"#ffffff",opacity:1,weight:1},unEditIconClassName:"icon iconfont icon-xuanzhong1",draggable:!0,editIcon:L.divIcon({className:"leaflet-supermap-plot-control-icon-path",iconSize:[10,10]}),scaleIcon:L.divIcon({className:"leaflet-supermap-plot-scale-icon-path",iconSize:[10,10]}),rotateIcon:L.divIcon({className:"leaflet-supermap-plot-rotate-icon-path",iconSize:[15,15]}),lockedIcon:L.divIcon({className:"leaflet-supermap-plot-locked-icon-path",iconSize:[10,10]}),avoidIcon:L.divIcon({className:"leaflet-supermap-plot-avoid-icon-path",iconSize:[8,8]}),leftTopIcon:L.divIcon({className:"leaflet-supermap-plot-left-top-icon-path",iconSize:[15,15]}),rightTopIcon:L.divIcon({className:"leaflet-supermap-plot-right-top-icon-path",iconSize:[15,15]}),leftBottomIcon:L.divIcon({className:"leaflet-supermap-plot-left-bottom-icon-path",iconSize:[15,15]}),rightBottomIcon:L.divIcon({className:"leaflet-supermap-plot-right-bottom-icon-path",iconSize:[15,15]}),centerCrossIcon:L.divIcon({className:"leaflet-supermap-plot-center-icon-path",iconSize:[24,24]})},initialize:function(t,e){if(L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode()&&(this.options.editIcon=L.divIcon({className:"leaflet-supermap-plot-control-icon-path",iconSize:[20,20]}),this.options.scaleIcon=L.divIcon({className:"leaflet-supermap-plot-scale-icon-path",iconSize:[20,20]}),this.options.rotateIcon=L.divIcon({className:"leaflet-supermap-plot-rotate-icon-path",iconSize:[25,25]}),this.options.lockedIcon=L.divIcon({className:"leaflet-supermap-plot-locked-icon-path",iconSize:[20,20]}),this.options.avoidIcon=L.divIcon({className:"leaflet-supermap-plot-avoid-icon-path",iconSize:[15,15]})),L.version<"0.7")throw new Error("Leaflet.draw 0.2.3+ requires Leaflet 0.7.0+. Download latest from https://github.com/Leaflet/Leaflet/");L.Control.prototype.initialize.call(this,e),L.setOptions(this,e),this._editMarkers={},this._disEditBox={},this._editFrames={},this._dragStartScale={},this._dragStartRotate={},this._dragStartBounds={},this._dragStartLatLngs={},this._dragStartPositionOffset={},this._dragStartScaleValues={},this._dragStartScalePoints={},this._editFeatures={},this._mouseTolerance=10,this.touchTolerance=20,this._editMode=SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE,this._avoidEditing=!1,this._isMultiSelect=!1,this._callback=null,this.selectedFeatures=[],this.selectedSignSymbols=[],this.rotateValue=null,this.rotateMarker=null},onAdd:function(t){this.controlDiv=L.DomUtil.create("div","supermap-iclient"),this._map=t,this._map.on("click",this._onMapClick,this),this._map._plotEditControl=this;for(var e=0;e<this._map.getPlottingLayers().length;e++)if(this._map.getPlottingLayers()[e].isSelected){this.enableEditFeatures(this._map.getPlottingLayers()[e].features);for(var i=0;i<this._map.getPlottingLayers()[e].features.length;i++)(this._map.getPlottingLayers()[e].features[i]instanceof vh||this._map.getPlottingLayers()[e].features[i]instanceof _y)&&this.enableEditFeatures(this._map.getPlottingLayers()[e].features[i].components)}return this.controlDiv},onRemove:function(){for(var t in this._map.off("click",this._onMapClick,this),this.unselectFeatures(),this._map._plotEditControl=null,this._map=null,this._editFeatures)this._disableFeatureEdit(this._editFeatures[t])},enableEditFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++)if(t[e]instanceof bh){if(1005===t[e].symbolType)for(var i=0;i<t[e].components.length;i++)24!=t[e].components[i].symbolType&&(t[e].components[i].enableEdit=!0,this._editFeatures[t[e].components[i].uuid]=t[e].components[i],this._enableFeatureEdit(t[e].components[i]));t[e].enableEdit=!0,this._editFeatures[t[e].uuid]=t[e],this._enableFeatureEdit(t[e])}},disableEditFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++)t[e]instanceof bh&&(t[e].enableEdit=!1,delete this._editFeatures[t[e].uuid],this._disableFeatureEdit(t[e]))},enableSelectedSignSymbol:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++)t[e]instanceof Ch&&(t[e].enableSelected=!0,this._editFeatures[t[e].uuid]=t[e])},disableSelectedSignSymbol:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++)t[e]instanceof Ch&&(t[e].enableSelected=!1,delete this._editFeatures[t[e].uuid])},avoidEdit:function(t){if(void 0===t&&(t=!this._avoidEditing),this._avoidEditing!==t)if(t&&1===this.selectedFeatures.length&&!this.selectedFeatures[0].getLocked()){for(var e in this._avoidRegionControl=new Cy(this.selectedFeatures[0]),this._map.addControl(this._avoidRegionControl),this._editFeatures)this._disableFeatureEdit(this._editFeatures[e]);this._collectEditMarkers(this._avoidRegionControl.feature),this._avoidEditing=t}else if(!t){if(this._avoidRegionControl){for(var i in this._editFeatures)this._enableFeatureEdit(this._editFeatures[i]);if(!SuperMap.Util.isArray(this._avoidRegionControl.feature))var o=[this._avoidRegionControl.feature];this.selectFeatures(o),this._map.removeControl(this._avoidRegionControl),this._avoidRegionControl=null}this._avoidEditing=t}return this._avoidEditing},setEditMode:function(t){if(this._editMode!==t){this._editMode=t;for(var e=0;e<this.selectedFeatures.length;e++)this._collectEditMarkers(this.selectedFeatures[e])}},canCopy:function(){return this.getSelectedFeatures().length>0},canCut:function(){return this.getSelectedFeatures().length>0},canPaste:function(){return!!(this.pasteGeoAry&&this.pasteGeoAry.length>0)},copy:function(){this.pasteGeoAry=[],this.pasteGeoSel=[];for(var t=0,e=this._map.getPlottingLayers().length;t<e;t++){var i=this._map.getPlottingLayers()[t];if(!0!==i.isLocked&&!1!==i.isEditable)for(var o=0,n=i.getFeatures().length;o<n;o++){var l=i.getFeatures()[o];if(l.isSelected&&!1===l.isLocked&&(l.layer=i,l instanceof bh))if(l.symbolType===SuperMap.Plot.SymbolType.ROUTENODE)this.pasteGeoAry.push(l.route);else if(this.pasteGeoAry.push(l),this.pasteGeoSel.push(l.isSelected),(l.symbolType===SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS||l.symbolType===SuperMap.Plot.SymbolType.SATELLITE)&&Object.prototype.hasOwnProperty.call(l,"timeWindows")&&0!==l.timeWindows.length)for(var s=0,a=l.timeWindows.length;s<a;s++)Object.prototype.hasOwnProperty.call(l.timeWindows[s],"symbolType")&&l.timeWindows[s].symbolType===SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS&&this.pasteGeoAry.push(l.timeWindows[s])}}},copyFeatures:function(t){this.pasteGeoAry=[],this.pasteGeoSel=[],SuperMap.Util.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var i=t[e];i instanceof bh&&(this.pasteGeoAry.push(i),this.pasteGeoSel.push(i.isSelected),i.isSelected&&this.selectedFeatures.push(i))}},cut:function(){this.pasteGeoAry=[],this.pasteGeoSel=[];var t=[],e=new SuperMap.Plot.Transaction;e.transType=SuperMap.Plot.TransactionType.REMOVE;for(var i=this.getSelectedFeatures().slice(),o=0;o<i.length;o++){var n=i[o];if(!0!==n.layer.isLocked&&!1!==n.layer.isEditable&&!1===n.isLocked){if(n instanceof bh)if(n.symbolType===SuperMap.Plot.SymbolType.ROUTENODE)this.pasteGeoAry.push(n.route),this.pasteGeoSel.push(n.route.isSelected),n.layer.removeFeatures(n.route);else{if(this.pasteGeoAry.push(n),this.pasteGeoSel.push(n.isSelected),Object.prototype.hasOwnProperty.call(n,"geoSymbolTexts")&&0!==n.geoSymbolTexts.length)for(var l=0,s=n.geoSymbolTexts.length;l<s;l++)Object.prototype.hasOwnProperty.call(n.geoSymbolTexts[l],"isSelected")&&!0===n.geoSymbolTexts[l].isSelected&&t.push(n.geoSymbolTexts[l].clone());if((n.symbolType===SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS||n.symbolType===SuperMap.Plot.SymbolType.SATELLITE)&&Object.prototype.hasOwnProperty.call(n,"timeWindows")&&0!==n.timeWindows.length)for(var a=0,r=n.timeWindows.length;a<r;a++)Object.prototype.hasOwnProperty.call(n.timeWindows[a],"symbolType")&&n.timeWindows[a].symbolType===SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS&&(this.pasteGeoAry.push(n.timeWindows[a]),n.layer.removeFeatures(n.timeWindows[a]));var u=new SuperMap.Plot.TransactionInfo;u.layerId=n.layer._leaflet_id,u.feature=n,e.transInfos.push(u),n.layer.removeFeatures(n)}0!==e.transInfos.length&&L.supermap.plotting.getControl().getTransManager().add(e)}}if(0!==t.length)for(var p=0,h=t.length;p<h;p++){var c=t[p];if(c.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT||c.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT1)for(var y=0,g=this.pasteGeoAry.length;y<g;y++)c.associatedUuid===this.pasteGeoAry[y].uuid&&this.pasteGeoAry[y].geoSymbolTexts.push(t[p])}},cutFeatures:function(t){this.pasteGeoAry=[],this.pasteGeoSel=[],t=SuperMap.Util.isArray(t)?t.slice():[t];for(var e=0;e<t.length;e++){var i=t[e],o=i.layer;i instanceof bh&&(this.pasteGeoAry.push(i),this.pasteGeoSel.push(i.isSelected),i instanceof My?(i.isSelected&&this.unselectFeatures(i),o.removeFeatures(i.route)):o.removeFeatures(i),i.layer=o)}},paste:function(t){return this._pasteToPosition.apply(this,arguments)},align:function(t){if(0!==this.getSelectedFeatures().length){var e=new SuperMap.Plot.Transaction;L.supermap.plotting.getControl().getTransManager().add(e);var i=function(t,e,i,o,n,l){var s=new SuperMap.Plot.TransactionInfo;s.layerId=t,s.uuid=e,s.functionName=i,s.undoParams=o,s.redoParams=n,l.transInfos.push(s)},o=1,n=this.getSelectedFeatures().length,l=null,s=null,a=null,r=this.getSelectedFeatures()[0].getBounds();if(t===SuperMap.Plot.AlignType.LEFT)for(;o<n;o++)l=this.getSelectedFeatures()[o].getBounds(),s=r.getWest()-l.getWest(),this.getSelectedFeatures()[o].move(0,s),this._collectEditMarkers(this.getSelectedFeatures()[o]),i(this.getSelectedFeatures()[o].layer._leaflet_id,this.getSelectedFeatures()[o].uuid,"move",[0,-s],[0,s],e);if(t===SuperMap.Plot.AlignType.RIGHT)for(;o<n;o++)l=this.getSelectedFeatures()[o].getBounds(),s=r.getEast()-l.getEast(),this.getSelectedFeatures()[o].move(0,s),this._collectEditMarkers(this.getSelectedFeatures()[o]),i(this.getSelectedFeatures()[o].layer._leaflet_id,this.getSelectedFeatures()[o].uuid,"move",[0,-s],[0,s],e);if(t===SuperMap.Plot.AlignType.UP)for(;o<n;o++)l=this.getSelectedFeatures()[o].getBounds(),a=r.getNorth()-l.getNorth(),this.getSelectedFeatures()[o].move(a,0),this._collectEditMarkers(this.getSelectedFeatures()[o]),i(this.getSelectedFeatures()[o].layer._leaflet_id,this.getSelectedFeatures()[o].uuid,"move",[-a,0],[a,0],e);if(t===SuperMap.Plot.AlignType.DOWN)for(;o<n;o++)l=this.getSelectedFeatures()[o].getBounds(),a=r.getSouth()-l.getSouth(),this.getSelectedFeatures()[o].move(a,0),this._collectEditMarkers(this.getSelectedFeatures()[o]),i(this.getSelectedFeatures()[o].layer._leaflet_id,this.getSelectedFeatures()[o].uuid,"move",[-a,0],[a,0],e);if(t===SuperMap.Plot.AlignType.VERTICALCENTER)for(;o<n;o++)l=this.getSelectedFeatures()[o].getBounds(),a=r.getCenter().lat-l.getCenter().lat,this.getSelectedFeatures()[o].move(a,0),this._collectEditMarkers(this.getSelectedFeatures()[o]),i(this.getSelectedFeatures()[o].layer._leaflet_id,this.getSelectedFeatures()[o].uuid,"move",[-a,0],[a,0],e);if(t===SuperMap.Plot.AlignType.HORIZONTALCENTER)for(;o<n;o++)l=this.getSelectedFeatures()[o].getBounds(),s=r.getCenter().lng-l.getCenter().lng,this.getSelectedFeatures()[o].move(0,s),this._collectEditMarkers(this.getSelectedFeatures()[o]),i(this.getSelectedFeatures()[o].layer._leaflet_id,this.getSelectedFeatures()[o].uuid,"move",[0,-s],[0,s],e)}},deleteSelectedFeatures:function(){if(0===Object.keys(this.getSelectedFeatures()).length)return null;if(Object.keys(this.getSelectedFeatures()).length){var t=this.getSelectedFeatures(),e=t.slice(),i=new SuperMap.Plot.Transaction;i.transType=SuperMap.Plot.TransactionType.REMOVE,L.supermap.plotting.getControl().getTransManager().add(i);for(var o=0,n=e.length;o<n;o++){var l=new SuperMap.Plot.TransactionInfo;l.layerId=e[o].layer._leaflet_id,l.feature=e[o],i.transInfos.push(l)}for(var s=0,a=t.length;s<a;s++)t[s].layer.removeFeatures(t[s])}},getSelectedFeatures:function(){return this.selectedFeatures.slice()},getSelectedSignSymbols:function(){return this.selectedSignSymbols.slice()},multiSelect:function(t){L.DomEvent.on(this._map._container,"mousedown",this._onMapMouseDown,this),this._map.dragging.enabled()&&(this._map.dragging.disable(),this._mapDraggingWasEnabled=!0),this._isMultiSelect=!this._isMultiSelect,this._callback=t},lockedFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++)t[e].layer instanceof gy&&null!=t[e].graphic?(this.enableEditFeatures(t[e]),t[e].locked=!0,this._collectEditMarkers(t[e])):t.splice(e,1)},unlockedFeatures:function(t){SuperMap.Util.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++)t[e].layer instanceof gy&&null!=t[e].graphic?(this.disableEditFeatures(t[e]),this._removeMarkers(t[e])):t.splice(e,1)},selectFeatures:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];SuperMap.Util.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++)t[i].layer instanceof gy&&null!=t[i].graphic&&(!0===t[i].layer.isEditable&&!1===t[i].layer.isLocked?(t[i].layer.removeFeatures(t[i]),t[i].layer._editLayer.addFeatures(t[i]),this.enableEditFeatures(t[i])):this.enableEditFeatures(t[i]));if(!1!==this.fire(SuperMap.Plot.Event.beforefeaturesselected,{features:t})){for(var o=[],n=0;n<t.length;n++)null!==t[n]._map&&t[n].enableEdit&&!1===t[n].isSelected&&(t[n].isSelected=!0,this.selectedFeatures.push(t[n]),this._collectEditMarkers(t[n]),t[n].layer instanceof Iy&&this.options.draggable&&!t[n].layer.isLocked&&t[n].layer.isEditable&&t[n].dragging.enable(),null!==t[n].ownerGroup&&(t[n].ownerGroup.isSelected=!0),t[n]instanceof My&&(t[n].route.isSelected=!0,this.options.highlightFlag&&t[n].route.highlight(this.options.highlightStyle)),o.push(t[n]));e&&this.fire(SuperMap.Plot.Event.featuresselected,{features:o})}},unselectFeatures:function(t){void 0===t&&(t=this.selectedFeatures.slice()),SuperMap.Util.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++)t[e].layer instanceof gy&&null!=t[e].graphic&&-1!=L.Util.indexOf(this.selectedFeatures,t[e])&&(!0===t[e].layer.isEditable&&!1===t[e].layer.isLocked?(t[e].layer._editLayer.removeFeatures(t[e]),t[e].layer.addFeatures(t[e])):this.disableEditFeatures(t[e]));if(!1!==this.fire(SuperMap.Plot.Event.beforefeaturesunselected,{features:t})){for(var i=t.slice(),o=0;o<i.length;){var n=L.Util.indexOf(this.selectedFeatures,i[o]);if(-1!==n){this._removeMarkers(i[o]);for(var l=0;l<i[o].symbolAnnotations.length;l++){var s=i[o].symbolAnnotations[l];this._removeMarkers(s)}i[o].isSelected=!1,null!=i[o].dragging&&i[o].dragging.disable(),null!==i[o].ownerGroup&&(i[o].ownerGroup.isSelected=!1),i[o]instanceof My&&(i[o].route.isSelected=!1,i[o].route.unhighlight()),this.selectedFeatures.splice(n,1),o++}else i.splice(o,1)}t.length>0&&!t[0].isAnimation&&this.fire(SuperMap.Plot.Event.featuresunselected,{features:i}),this.transaction&&0!==this.transaction.transInfos.length&&(L.supermap.plotting.getControl().getTransManager().add(this.transaction),this.transaction=null,this.isAddTransInfo=!1)}},_onMapMouseDown:function(t){this.multiple=!1,L.DomUtil.disableTextSelection(),L.DomUtil.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(t),L.DomEvent.on(document,{contextmenu:L.DomEvent.stop,mousemove:this._onMapMouseMove,mouseup:this._onMapMouseUp},this)},_onMapMouseMove:function(t){this.multiple||(this.multiple=!0,this._box=L.DomUtil.create("div","leaflet-zoom-box",this._map._container),L.DomUtil.addClass(this._map._container,"leaflet-crosshair")),this._endPoint=this._map.mouseEventToContainerPoint(t);var e=new L.Bounds(this._endPoint,this._startPoint),i=e.getSize();L.DomUtil.setPosition(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_onMapMouseUp:function(){if(L.DomEvent.off(this._map._container,"mousedown",this._onMapMouseDown,this),this.multiple&&(L.DomUtil.remove(this._box),L.DomUtil.removeClass(this._map._container,"leaflet-crosshair")),L.DomUtil.enableTextSelection(),L.DomUtil.enableImageDrag(),L.DomEvent.off(document,{contextmenu:L.DomEvent.stop,mousemove:this._onMapMouseMove,mouseup:this._onMapMouseUp},this),this.multiple){var t=new L.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._endPoint)),e=this._map._layers;for(var i in e)if(e[i]instanceof gy){var o=e[i].getFeaturesInBounds();e[i].isSelected&&this.enableEditFeatures(o)}o=[];for(var n in this._editFeatures)o.push(this._editFeatures[n]);for(var l=[],s=0,a=o.length;s<a;s++)if(!o[s].isSelected)if(o[s]instanceof My||o[s].symbolType===SuperMap.Plot.SymbolType.LITERATESIGN)t.contains(o[s].route.getBounds().getCenter())&&-1===SuperMap.Util.indexOf(l,o[s].route)&&l.push(o[s].route);else if(null!==o[s].ownerGroup)t.contains(o[s].ownerGroup.getBounds().getCenter())&&-1===SuperMap.Util.indexOf(l,o[s].ownerGroup)&&l.push(o[s].ownerGroup);else if(o[s].getBounds().isValid()&&t.contains(o[s].getBounds().getCenter()))l.push(o[s]);else if(o[s].layer instanceof gy&&o[s].graphic.getBounds().isValid()){var r=this._map.containerPointToLatLng(o[s].graphic.getBounds().max),u=this._map.containerPointToLatLng(o[s].graphic.getBounds().min);o[s]._boundslatlng=new L.LatLngBounds,o[s]._boundslatlng._northEast=r,o[s]._boundslatlng._southWest=u,t.contains(o[s].getBounds().getCenter())&&l.push(o[s])}var p=l;if(0!==l.length){this.selectFeatures(p);for(var h=0;h<p.length;h++)p[h].layer.layer instanceof gy&&(p[h].layer.layer.selectedFeatures.push(p[h]),p[h].layer.layer.notHandleClick=!0)}this._mapDraggingWasEnabled&&this._map.dragging.enable(),this.multiple=!1,this._callback&&this._callback()}},_enableFeatureEdit:function(t){t instanceof bh&&t.on("click",this._onClick,this).on("mousemove",this._onMouseMove,this).on("mouseout",this._onMouseOut,this).on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this).on("reseteditmarkersvalues",this._onResetEditMarkersValues,this).on("reseteditmarkers",this._onResetEditMarkers,this)},_disableFeatureEdit:function(t){t instanceof bh&&t.off("click",this._onClick,this).off("mousemove",this._onMouseMove,this).off("mouseout",this._onMouseOut,this).off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this).off("reseteditmarkersvalues",this._onResetEditMarkersValues,this).off("reseteditmarkers",this._onResetEditMarkers,this)},_onSelectedLayers:function(t){this.selectFeatures(t.target)},_onUnSelectLayers:function(t){this.unselectFeatures(t.target)},_onMouseMove:function(t){var e=t.target,i="";if(e.isSelected)if(this._editMode===SuperMap.Plot.EditMode.ADDCONTROLPOINT&&(SuperMap.Plot.AddPoint_WayType.UNKNOWN!==e._getSymbolWayType()||e instanceof My&&(e._isFirstNode()||e._isLastNode())||e.symbolType===SuperMap.Plot.SymbolType.ANNOFRAMESYMBOLM))i="crosshair";else if(this._editMode===SuperMap.Plot.EditMode.ADDCONTROLPOINT&&e instanceof _y){var o=this._getAddPointTolerance(),n=e._selectNodeLayer(t.latlng,o);null===n||n instanceof My&&(n._isFirstNode()||n._isLastNode())?i="crosshair":null!==n&&(i="pointer")}else i="move";else i="pointer";e.layer._setCursorStyle(i)},_onMouseOut:function(t){t.target.layer._setCursorStyle()},_onDragStart:function(){if(!this._map.isDraggingSymbolText)for(var t=0;t<this.selectedFeatures.length;t++){if(!this.selectedFeatures[t].getLocked()){for(var e=this._editMarkers[this.selectedFeatures[t].uuid],i=0;i<e.length;i++)e[i].setOpacity(0);for(var o=0;o<this.selectedFeatures[t].symbolAnnotations.length;o++){if((e=this._editMarkers[this.selectedFeatures[t].symbolAnnotations[o].uuid])&&e.length>0)for(var n=0;n<e.length;n++)e[n].setOpacity(0)}}this.selectedFeatures[t]instanceof vh?this._dragStartLatLngs[this.selectedFeatures[t].uuid]=this._editMarkers[this.selectedFeatures[t].uuid]:this._dragStartLatLngs[this.selectedFeatures[t].uuid]=L.Util.cloneLatLngs(this.selectedFeatures[t].getLatLngs()),this.selectedFeatures[t].symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&(this._dragStartPositionOffset[this.selectedFeatures[t].uuid]={x:this.selectedFeatures[t].positionOffsetX,y:this.selectedFeatures[t].positionOffsetY}),this.transaction||(this.transaction=new SuperMap.Plot.Transaction,this.transaction.transType=SuperMap.Plot.TransactionType.EDIT,this.isAddTransInfo=!0)}},_onDrag:function(t){if(!this._map.isDraggingSymbolText){for(var e=0,i=this.selectedFeatures.length;e<i;e++)if((this._editMode!==SuperMap.Plot.EditMode.ADDCONTROLPOINT||SuperMap.Plot.AddPoint_WayType.UNKNOWN===this.selectedFeatures[e]._getSymbolWayType())&&!this.selectedFeatures[e].getLocked()){var o=this.selectedFeatures[e].symbolType;if(o===SuperMap.Plot.SymbolType.SYMBOLTEXT1||o===SuperMap.Plot.SymbolType.AIRROUTE||o===SuperMap.Plot.SymbolType.NAVYROUTE||o===SuperMap.Plot.SymbolType.MISSILEROUTE)break;if(this.selectedFeatures[e].move(t.dLat,t.dLng),this.isAddTransInfo){var n=new SuperMap.Plot.TransactionInfo;n.layerId=this.selectedFeatures[e].layer._leaflet_id,n.uuid=this.selectedFeatures[e].uuid,n.functionName="move",this.transaction.transInfos.push(n)}}this.isAddTransInfo=!1}},_onDragEnd:function(){if(!this._map.isDraggingSymbolText){for(var t=0;t<this.selectedFeatures.length;t++)this.selectedFeatures[t].getLocked()||(this._collectEditMarkers(this.selectedFeatures[t]),this.selectedFeatures[t].graphic&&this.selectedFeatures[t].graphic.updateImage());this._saveHistoryInfomation(),this.transaction&&0!==this.transaction.transInfos.length&&(L.supermap.plotting.getControl().getTransManager().add(this.transaction),this.transaction=new SuperMap.Plot.Transaction,this.isAddTransInfo=!0),this.fire(SuperMap.Plot.Event.featuresmodified,{features:this.selectedFeatures});for(var e=0;e<this.selectedFeatures.length;e++)this.selectedFeatures[e].fire("latlngchanged",{feature:this.selectedFeatures[e]})}},_saveHistoryInfomation:function(){if(this.transaction)for(var t=0;t<this.transaction.transInfos.length;t++){var e=this.transaction.transInfos[t].uuid,i=this._map.getFeatureByUuid(e);if(null===i)for(var o=0;o<this.selectedFeatures.length;o++)if(this.selectedFeatures[o].uuid===e){i=this.selectedFeatures[o];break}if(null!==i){if("setRotate"===this.transaction.transInfos[t].functionName)i._isDot()?(this.transaction.transInfos[t].undoParams=[this._dragStartRotate[e]],this.transaction.transInfos[t].redoParams=[i.getRotate()]):(this.transaction.transInfos[t].undoParams=[360-(i.getRotate()-this._dragStartRotate[e])],this.transaction.transInfos[t].redoParams=[i.getRotate()-this._dragStartRotate[e]]);else if("setScale"===this.transaction.transInfos[t].functionName){var n=this._dragStartScale[e];!1===i.limitWidthHeight?(this.transaction.transInfos[t].undoParams=[n.x,n.y],this.transaction.transInfos[t].redoParams=[i.getScale().x,i.getScale().y]):(this.transaction.transInfos[t].undoParams=[n],this.transaction.transInfos[t].redoParams=[i.getScale()])}else if("setLatLngs"===this.transaction.transInfos[t].functionName)i.symbolType===SuperMap.Plot.SymbolType.LINERELATION?this.transaction.transInfos[t].undoParams=[this._dragStartLatLngs[e]]:this.transaction.transInfos[t].undoParams=[L.Util.cloneLatLngs(this._dragStartLatLngs[e])],this.transaction.transInfos[t].redoParams=[L.Util.cloneLatLngs(i.getLatLngs())],i.symbolType===SuperMap.Plot.SymbolType.ARCREGION&&1===this.transaction.transInfos[t].redoParams[0].length&&this.transaction.transInfos[t].redoParams[0].push(i.scalePoints[0]);else if("setScaleValues"===this.transaction.transInfos[t].functionName){for(var l=[],s=[],a=0;a<this._dragStartScaleValues[e].length;a++)l.push(this._dragStartScaleValues[e][a]);for(var r=0;r<i.scaleValues.length;r++)s.push(i.scaleValues[r]);this.transaction.transInfos[t].undoParams=[l],this.transaction.transInfos[t].redoParams=[s]}else if("modifyPoint"===this.transaction.transInfos[t].functionName){var u=this.transaction.transInfos[t].undoParams[0];this.transaction.transInfos[t].undoParams.push(this._dragStartScalePoints[e][u]),this.transaction.transInfos[t].undoParams[1].isScalePoint=!0;var p=this.transaction.transInfos[t].redoParams[0];this.transaction.transInfos[t].redoParams.push(i.scalePoints[p]),this.transaction.transInfos[t].redoParams[1].isScalePoint=!0}else if("move"===this.transaction.transInfos[t].functionName){if(i.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&!0===i.positionOffset){var h=0,c=0,y=this._map.latLngToLayerPoint(i.getLatLngs()[0]),g={x:y.x+this._dragStartPositionOffset[e].x,y:y.y+this._dragStartPositionOffset[e].y},f=this._map.layerPointToLatLng(g);y.x+=i.positionOffsetX,y.y+=i.positionOffsetY;var d=this._map.layerPointToLatLng(y);h=f.lng-d.lng,c=f.lat-d.lat}else i instanceof vh?(h=this._dragStartLatLngs[e][0].getLatLng().lng-this._editMarkers[i.uuid][0].getLatLng().lng,c=this._dragStartLatLngs[e][0].getLatLng().lat-this._editMarkers[i.uuid][0].getLatLng().lat):0!==i.getLatLngs().length&&(h=this._dragStartLatLngs[e][0].lng-i.getLatLngs()[0].lng,c=this._dragStartLatLngs[e][0].lat-i.getLatLngs()[0].lat);i instanceof vh?(this.transaction.transInfos[t].undoParams=[c,h],this.transaction.transInfos[t].redoParams=[-c,-h]):0!==i.getLatLngs().length&&(this.transaction.transInfos[t].undoParams=[c,h],this.transaction.transInfos[t].redoParams=[-c,-h])}}else this.transaction.transInfos.splice(t,1),t--}},_onResetEditMarkers:function(t){-1!==L.Util.indexOf(this.selectedFeatures,t.target)&&this._collectEditMarkers(t.target)},_onResetEditMarkersValues:function(t){this._resetEditMarkersValue(t.target)},_onSignSymbolResetEditMarkersValues:function(t){this._resetSignEditMarkerValue(t.target)},_onMapClick:function(t){return!1===this._onTriggerMapClick||this._dragDot?(this._onTriggerMapClick=!0,void(this._dragDot=!1)):this._startPoint&&this._endPoint?(this._startPoint=null,void(this._endPoint=null)):(this.getSelectedFeatures().length>0&&this.unselectFeatures(),void L.DomEvent.stopPropagation(t))},_onClick:function(t){this._onTriggerMapClick=!1;var e=t.target,i=!1;if(e.symbolAnnotations.length>0)for(var o=0;o<e.components.length;o++){if(e.components[o]._bounds.contains(t.latlng)){i=!0;break}}if(i||e.getBounds().contains(t.latlng)){if(e.isSelected&&e.symbolType===SuperMap.Plot.SymbolType.SATELLITE&&e.timeWindows.length>0){var n=e.layer._getFeatureFromEvent(t);n.symbolType===SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS&&(e=n)}if(this.transaction||(this.transaction=new SuperMap.Plot.Transaction,this.transaction.transType=SuperMap.Plot.TransactionType.EDIT,this.isAddTransInfo=!0),e instanceof bh)if(e instanceof vh&&e.moveend)e.moveend=!1;else if(null!==e.ownerGroup&&e.ownerGroup.moveend)e.ownerGroup.moveend=!1;else{var l,s;if(this._editMode!==SuperMap.Plot.EditMode.ADDCONTROLPOINT)if(e instanceof vh&&!e.isSelected)!1===t.originalEvent.ctrlKey&&this.unselectFeatures(),this.selectFeatures(e);else if(e instanceof _y||e.isSelected){if(e instanceof _y){var a=this._getAddPointTolerance();null!=(g=e._selectNodeLayer(t.latlng,a))&&(this.unselectFeatures(),this.selectFeatures(g))}}else null!==e.ownerGroup&&!0!==e.ownerGroup.isSelected||(!1===t.originalEvent.ctrlKey&&this.unselectFeatures(),this.selectFeatures(e));else if(e instanceof _y||e.isSelected){if(!1===e.isLocked&&e.isSelected)if(e instanceof _y){a=this._getAddPointTolerance();if(null===(g=e._selectNodeLayer(t.latlng,a))){var r=this._getAddPointTolerance(),u=e._addRouteNodeByPosWithoutLast(t.latlng,r);null!==u&&(this.unselectFeatures(),this.selectFeatures(u))}}else if(e instanceof My&&e.route.isSelected){var p=e._isFirstNode(),h=e._isLastNode();if(!0===p||!0===h){var c=e.route._addRouteNodeByNode(e.routeNode,p,h);if(null!==c){this.unselectFeatures(),this.selectFeatures(c);var y=new SuperMap.Plot.TransactionInfo;y.layerId=c.layer._leaflet_id,y.uuid=c.uuid,y.functionName="setLatLngs",y.undoParams=[L.Util.cloneLatLngs(c.getLatLngs())],y.redoParams=[L.Util.cloneLatLngs(c.getLatLngs())],this.transaction.transInfos.push(y),this.transaction&&(L.supermap.plotting.getControl().getTransManager().add(this.transaction),this.transaction=new SuperMap.Plot.Transaction,this.isAddTransInfo=!0)}}else this.unselectFeatures(),this.selectFeatures(e)}else this._addPoint(e,t.latlng)}else if(!1===t.originalEvent.ctrlKey&&this.unselectFeatures(),this.selectFeatures(e),e instanceof My&&((l=e._isFirstNode())||(s=e._isLastNode()))){var g=e.route._addRouteNodeByNode(e.routeNode,l,s);null!==g&&(this.unselectFeatures(),this.selectFeatures(g))}if(t.layer&&t.layer.isSymbolAnnotation&&!e.isLocked){for(var f=0;f<e.symbolAnnotations.length;f++){var d=e.symbolAnnotations[f];this._removeMarkers(d)}var m=L.supermap.plotting.editMarker(t.layer._latlng,{icon:this.options.editIcon,nHandle:-1});m.owner=t.layer,this._addToMapAndBindMarker(m),this._editMarkers[t.layer.symbolAnnotation.uuid]=[m]}}}},_addPoint:function(t,e){if(null!==t&&void 0!==t){var i=t.scaleValues.slice(),o=L.Util.cloneLatLngs(t.getLatLngs());L.Util.latLngsToSuperMapPoints(t.getLatLngs());if(t.symbolType===SuperMap.Plot.SymbolType.ANNOFRAMESYMBOLM){var n=L.supermap.plotting.editMarker(e,{icon:this.options.scaleIcon,nHandle:-2,tag:t.scalePoints.length});n.owner=t,this._addToMapAndBindMarker(n),this._editMarkers[t.uuid].push(n),t.scalePoints.push(e),t._modifyPoint(t.scalePoints.length-1,e);var l=new SuperMap.Plot.TransactionInfo;l.layerId=t.layer._leaflet_id,l.uuid=t.uuid,l.functionName="setScaleValues",l.undoParams=[i],l.redoParams=[t.scaleValues],this.transaction.transInfos.push(l),this.transaction&&(L.supermap.plotting.getControl().getTransManager().add(this.transaction),this.transaction=new SuperMap.Plot.Transaction,this.isAddTransInfo=!0)}else{if(t.getLatLngs().length>=t.maxEditPts)return;var s=t._getSymbolWayType();if(SuperMap.Plot.AddPoint_WayType.UNKNOWN===s)return;void 0!==SuperMap.Plot.AlgoSymbolFactory&&SuperMap.Plot.AlgoSymbolFactory.canPolylineConnect(t.libID,t.code)&&!0===t.polylineConnectLocationPoint&&(s=SuperMap.Plot.AddPoint_WayType.POLYLINE);var a=new SuperMap.Geometry.Point(e.lng,e.lat),r=-1;if(SuperMap.Plot.AddPoint_WayType.CURVE!==s&&SuperMap.Plot.AddPoint_WayType.CURVE_CLOSE!==s||(r=this._addPointByCurve(t,a)),SuperMap.Plot.AddPoint_WayType.POLYLINE!==s&&SuperMap.Plot.AddPoint_WayType.POLYLINE_CLOSE!==s||(r=this._addPointByPolyLine(t,a)),r>0){var u=L.supermap.plotting.editMarker(new L.LatLng(a.y,a.x),{icon:this.options.editIcon,nHandle:-1});if(u.owner=t,this._addToMapAndBindMarker(u),this._editMarkers[t.uuid].splice(r,0,u),0===t.libID&&590===t.code||100===t.libID&&(17703===t.code||17704===t.code))this._addPointByPolybezier(t,r,a),this._resetEditMarkersValue(t);else{var p=L.Util.latLngsToSuperMapPoints(t.getLatLngs());p.splice(r,0,a),t.latLngs=L.Util.superMapPointsToLatLngs(p)}var h=new SuperMap.Plot.Transaction;L.supermap.plotting.getControl().getTransManager().add(h);var c=new SuperMap.Plot.TransactionInfo;if(c.layerId=t.layer._leaflet_id,c.uuid=t.uuid,c.functionName="setLatLngs",c.undoParams=[o],c.redoParams=[L.Util.cloneLatLngs(t.getLatLngs())],h.transInfos.push(c),0===t.libID&&590===t.code||100===t.libID&&(17703===t.code||17704===t.code)){var y=new SuperMap.Plot.TransactionInfo;y.layerId=t.layer._leaflet_id,y.uuid=t.uuid,y.functionName="setScaleValues",y.undoParams=[i],y.redoParams=[t.scaleValues],h.transInfos.push(y)}t.redraw()}}}},_addPointByCurve:function(t,e){var i,o=L.Util.latLngsToSuperMapPoints(t.getLatLngs());if(t._getSymbolWayType()===SuperMap.Plot.AddPoint_WayType.CURVE_CLOSE){if(2===t.getLatLngs().length)i=L.Util.latLngsToSuperMapPoints(t.getLatLngs());else if(3===t.getLatLngs().length){i=SuperMapAlgoPlot.Primitives.getSpatialData(SuperMapAlgoPlot.SymbolType.KIDNEY,o);for(var n=-1,l=!1,s=0;s<i.length;s++)i[s].x===o[0].x&&i[s].y===o[0].y&&(n=s);for(var a=[],r=n;r<i.length;r++)a.push(i[r]);for(r=0;r<n;r++)a.push(i[r]);for(r=0;r<a.length;r++){for(var u=!1,p=1;p<o.length;p++)if(a[r].x===o[p].x&&a[r].y===o[p].y){2==p&&(l=!0),u=!0;break}if(!0===u)break}i=l?a.reverse():a}else i=SuperMap.Plot.PlottingUtil.generateBeizerPointsNoCtrlPt(o,!0);o[0].x==o[o.length-1].x&&o[0].y==o[o.length-1].y||o.push(new SuperMapAlgoPlot.Point(o[0].x,o[0].y))}else 2===t.getLatLngs().length?i=L.Util.latLngsToSuperMapPoints(t.getLatLngs()):(i=SuperMap.Plot.PlottingUtil.generateBeizerPointsNoCtrlPt(o),360==t.code&&(i=SuperMap.Plot.Primitives.getSpatialData(t.symbolType,o)));if(2>i.length)return-1;for(var h=[],c=0,y=1,g=o.length;y<g;y++)for(var f=[],d=c,m=i.length;d<m;d++){if(SuperMap.Plot.PlottingUtil.equalFuzzy(o[y].x,i[d].x,1e-10)&&SuperMap.Plot.PlottingUtil.equalFuzzy(o[y].y,i[d].y,1e-10)){if(f.length<1)continue;f.push(i[d]),h.push(f),f=[],c=d;break}f.push(i[d])}for(var S=-1,P=0;P<h.length;P++){this._computePointToLineMinDis(e,h[P]).index<0||(S=P+1)}return S>=0&&S<o.length?S:-1},_addPointByPolyLine:function(t,e){var i=-1,o=this._getSuperMapPoints(t);return(i=this._computePointToLineMinDis(e,o).index)>=0&&i<o.length&&i++,i},_getSuperMapPoints:function(t){var e=L.Util.latLngsToSuperMapPoints(t.getLatLngs());if(t._getSymbolWayType()===SuperMap.Plot.AddPoint_WayType.POLYLINE_CLOSE){if(2==e.length&&100==t.libID&&(32900==t.code||25501==t.code||25502==t.code||25503==t.code||25600==t.code||25700==t.code||25701==t.code||2570201==t.code||2570301==t.code||2570501==t.code||25800==t.code||25801==t.code||25900==t.code||25901==t.code)){var i=new SuperMapAlgoPlot.Point(e[1].x,e[1].y),o=SuperMapAlgoPlot.PlottingUtil.rotateAngle(e[0],60*SuperMapAlgoPlot.PlottingUtil.DTOR,i);e.push(o)}e[0].x==e[e.length-1].x&&e[0].y==e[e.length-1].y||e.push(new SuperMapAlgoPlot.Point(e[0].x,e[0].y))}return e},_addPointByPolybezier:function(t,e,i){var o=L.Util.latLngsToSuperMapPoints(t.getLatLngs()),n=[];if(t.scaleValues.length==4*(o.length-1)){var l=SuperMapAlgoPlot.PlottingUtil.polylineDistance(o);n.push(new SuperMap.Geometry.Point(o[0].x,o[0].y)),n.push(new SuperMap.Geometry.Point(o[0].x,o[0].y));var s=t.scaleValues[0],a=t.scaleValues[1],r=o[0].x+l*s,u=o[0].y+l*a;n.push(new SuperMap.Geometry.Point(r,u));for(var p=1;p<o.length-1;p++){n.push(new SuperMap.Geometry.Point(o[p].x,o[p].y));var h=t.scaleValues[4*p-2],c=t.scaleValues[4*p-1],y=o[p].x+l*h,g=o[p].y+l*c;n.push(new SuperMap.Geometry.Point(y,g)),h=t.scaleValues[4*p],c=t.scaleValues[4*p+1],y=o[p].x+l*h,g=o[p].y+l*c,n.push(new SuperMap.Geometry.Point(y,g))}var f=o.length-1;n.push(new SuperMap.Geometry.Point(o[f].x,o[f].y)),s=t.scaleValues[4*f-2],s=t.scaleValues[4*f-1],r=o[f].x+l*s,u=o[f].y+l*s,n.push(new SuperMap.Geometry.Point(r,u)),n.push(new SuperMap.Geometry.Point(o[f].x,o[f].y)),o.splice(e,0,i);var d=o.length;if(0==e){var m=new SuperMap.Geometry.Point(0,0),S=new SuperMap.Geometry.Point(0,0),P=new SuperMap.Geometry.Point(0,0);SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(8,3,o[0],o[1],o[2],S,P),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.6,o[0],o[1],S,m),n.splice(1,1,S),n.splice(0,0,new SuperMap.Geometry.Point(o[0].x,o[0].y)),n.splice(1,0,new SuperMap.Geometry.Point(o[0].x,o[0].y)),n.splice(2,0,m)}else if(e==d-1){var b=new SuperMap.Geometry.Point(0,0);m=new SuperMap.Geometry.Point(0,0),S=new SuperMap.Geometry.Point(0,0);SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(8,3,o[d-3],o[d-2],o[d-1],b,m),SuperMapAlgoPlot.PlottingUtil.getTrapezoidPoints(.6,o[d-1],o[d-2],m,S),n.splice(n.length-1,1,m),n.push(new SuperMap.Geometry.Point(o[o.length-1].x,o[o.length-1].y)),n.push(S),n.push(new SuperMap.Geometry.Point(o[o.length-1].x,o[o.length-1].y))}else{var v=new SuperMap.Geometry.Point(0,0),M=new SuperMap.Geometry.Point(0,0);SuperMapAlgoPlot.PlottingUtil.getTrianglePoints(8,3,o[e-1],o[e],o[e+1],v,M),n.splice(3*e,0,new SuperMap.Geometry.Point(o[e].x,o[e].y)),n.splice(3*e+1,0,v),n.splice(3*e+2,0,M)}t.scaleValues.length=0;var _=(n[2].x-n[0].x)/l,A=(n[2].y-n[0].y)/l;t.scaleValues.push(_),t.scaleValues.push(A);for(var T=1;T<o.length-1;T++){_=(n[3*T+1].x-n[3*T].x)/l,A=(n[3*T+1].y-n[3*T].y)/l;t.scaleValues.push(_),t.scaleValues.push(A);var x=(n[3*T+2].x-n[3*T].x)/l,O=(n[3*T+2].y-n[3*T].y)/l;t.scaleValues.push(x),t.scaleValues.push(O)}_=(n[3*(o.length-1)+1].x-n[3*(o.length-1)].x)/l,A=(n[3*(o.length-1)+1].y-n[3*(o.length-1)].y)/l,t.scaleValues.push(_),t.scaleValues.push(A)}else{o.splice(e,0,i);var w=SuperMap.Plot.PlottingUtil.computeBeizerPoints(!1,o,t.scaleValues);t.scaleValues=w.scaleValues}t.setLatLngs(L.Util.superMapPointsToLatLngs(o))},_isKidney:function(t){if(100==t.libID)switch(t.code){case 16500:case 17400:case 17401:case 17500:case 17501:case 22200:case 23400:case 23500:case 23600:case 23700:case 235001:case 27300:case 2730101:case 27701:case 28200:case 28300:case 28400:case 3032e3:case 4011100:case 4011101:case 4022100:case 4022101:case 4022102:case 37600:case 37601:case 37700:case 39e3:case 39101:case 40100:case 40101:case 42200:case 42400:case 44300:return!0;default:return!1}},_computePointToLineMinDis:function(t,e){var i=this._getAddPointTolerance(),o=SuperMap.Plot.PlottingUtil.computePointToLineMinDis(t,e);return(o.minDis<0||o.minDis>i)&&(o.index=-1),o},_getAddPointTolerance:function(){var t=this._mouseTolerance;L.Browser.touch&&L.supermap.plotting.getControl().getTouchMode()&&(t=this.touchTolerance);var e=this._map.layerPointToLatLng(L.point(0,0)),i=this._map.layerPointToLatLng(L.point(t,0));return SuperMap.Plot.PlottingUtil.distance(new SuperMap.Geometry.Point(e.lng,e.lat),new SuperMap.Geometry.Point(i.lng,i.lat))},_collectEditMarkers:function(t){void 0!==this._editMarkers[t.uuid]&&this._removeMarkers(t);for(var e=0;e<t.symbolAnnotations.length;e++){var i=t.symbolAnnotations[e];this._removeMarkers(i)}var o,n=[];if(t.layer instanceof gy){for(var l=t.graphic._getHandleAndCenterPoints(),s=0,a=l.handlePoints.length;s<a;s++){var r=new L.LatLng(l.handlePoints[s].lat,l.handlePoints[s].lng),u=void 0;0===l.handlePoints[s].tag?u=L.supermap.plotting.editMarker(r,{icon:this.options.leftBottomIcon,nHandle:-3,tag:s}):1===l.handlePoints[s].tag?u=L.supermap.plotting.editMarker(r,{icon:this.options.leftTopIcon,nHandle:-3,tag:s}):2===l.handlePoints[s].tag?u=L.supermap.plotting.editMarker(r,{icon:this.options.rightTopIcon,nHandle:-3,tag:s}):3===l.handlePoints[s].tag&&(u=L.supermap.plotting.editMarker(r,{icon:this.options.rightBottomIcon,nHandle:-3,tag:s})),this._addToMapAndBindMarker(u),u.owner=t,n.push(u)}if(!0===t.locked)for(var p=0,h=l.centerPoints.length;p<h;p++){var c=new L.LatLng(l.centerPoints[p].lat,l.centerPoints[p].lng),y=L.supermap.plotting.editMarker(c,{icon:this.options.centerCrossIcon,nHandle:-3});this._addToMapAndBindMarker(y),n.push(y),y.owner=t}}else if(t.layer instanceof Iy&&(t.layer.getLocked()||!t.layer.getEditable())){var g=t.getBounds();if(null!==g&&g.isValid()){var f=L.latLng(g.getNorth(),g.getEast()),d=L.latLng(g.getNorth(),g.getWest()),m=L.latLng(g.getSouth(),g.getEast()),S=L.latLng(g.getSouth(),g.getWest()),P=new L.Polygon([f,d,S,m],{smoothFactor:.5});L.setOptions(P,{weight:1,opacity:.5,color:"#0000ff",fillOpacity:.3,fillColor:"#0000ff"}),this._map.addLayer(P),o=P}}else if(t.getLocked())for(var b=t._getHandlePointsByBounds(),v=0;v<b.length;v++){var M=new L.LatLng(b[v].lat,b[v].lng),_=L.supermap.plotting.editMarker(M,{icon:this.options.lockedIcon,nHandle:-3});this._addToMapAndBindMarker(_),_.owner=t,n.push(_)}else if(t instanceof vh||t instanceof My)if(t instanceof Oy&&this._editMode!==SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE)for(var A=0;A<t.scalePoints.length;A++){var T=new L.LatLng(t.scalePoints[A].lat,t.scalePoints[A].lng),x=t.scalePoints[A].tag?t.scalePoints[A].tag:A,O=L.supermap.plotting.editMarker(T,{icon:this.options.scaleIcon,nHandle:t.enableEdit?-2:-3,tag:x});this._addToMapAndBindMarker(O),n.push(O),O.owner=t}else{for(var w=t._getHandleAndRotatePoints(),C=0;C<w.handlePoints.length;C++){var E=w.handlePoints[C].nHandle;(this._editMode!==SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE||t instanceof My)&&(E=-3);var I=new L.LatLng(w.handlePoints[C].lat,w.handlePoints[C].lng),D=L.supermap.plotting.editMarker(I,{icon:this.options.editIcon,nHandle:E,tag:C});this._addToMapAndBindMarker(D),D.owner=t,n.push(D)}if(this._editMode===SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE)for(var U=0;U<w.rotatePoints.length;U++){var R=new L.LatLng(w.rotatePoints[U].lat,w.rotatePoints[U].lng),N=L.supermap.plotting.editMarker(R,{icon:this.options.rotateIcon,nHandle:0});this._addToMapAndBindMarker(N),n.push(N),N.owner=t}}else if(this._editMode===SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE){for(var B=t._getHandleAndRotatePoints(),k=0,F=B.handlePoints.length;k<F;k++){var j=B.handlePoints[k].nHandle;t.enableEdit&&t.symbolType!==SuperMap.Plot.SymbolType.TEXTSYMBOL?t._getHandleCount()>9&&(j=-1):j=-3;var V=new L.LatLng(B.handlePoints[k].lat,B.handlePoints[k].lng);if(20==t.symbolType||21==t.symbolType||999==t.symbolType)(W=this._map.latLngToContainerPoint(V)).x+=t.style.graphicXOffset,W.y+=t.style.graphicYOffset,V=this._map.containerPointToLatLng(W);var z=L.supermap.plotting.editMarker(V,{icon:this.options.editIcon,nHandle:j,tag:k});this._addToMapAndBindMarker(z),z.owner=t,n.push(z)}for(var Y=0,G=B.rotatePoints.length;Y<G;Y++){var W,X=new L.LatLng(B.rotatePoints[Y].lat,B.rotatePoints[Y].lng);if(20==t.symbolType||21==t.symbolType||999==t.symbolType)(W=this._map.latLngToContainerPoint(X)).x+=t.style.graphicXOffset,W.y+=t.style.graphicYOffset,X=this._map.containerPointToLatLng(W);var H=L.supermap.plotting.editMarker(X,{icon:this.options.rotateIcon,nHandle:t.enableEdit?0:-3});this._addToMapAndBindMarker(H),n.push(H),H.owner=t}}else if(t.symbolType===SuperMap.Plot.SymbolType.REGULARPOLYGON){for(var Z=[t.latLngs[0],t.components[0].getLatLngs()[0][0]],J=0;J<Z.length;J++){var q=L.supermap.plotting.editMarker(Z[J],{icon:this.options.editIcon,nHandle:t.enableEdit?-1:-3,tag:J});this._addToMapAndBindMarker(q),n.push(q),q.owner=t}for(var K=0;K<t.scalePoints.length;K++){var Q=new L.LatLng(t.scalePoints[K].lat,t.scalePoints[K].lng),$=t.scalePoints[K].tag?t.scalePoints[K].tag:K,tt=L.supermap.plotting.editMarker(Q,{icon:this.options.scaleIcon,nHandle:t.enableEdit?-2:-3,tag:$});this._addToMapAndBindMarker(tt),n.push(tt),tt.owner=t}}else if(t.symbolType===SuperMap.Plot.SymbolType.PARALLELLINE){var et=L.Util.superMapPointsToLatLngs(t.superMapAlgoSymbol.controlPoints[0]);t.getLatLngs()[0]=L.latLng(et[0].lat,et[0].lng);for(var it=0;it<t.latLngs.length;it++){var ot=new L.LatLng(t.latLngs[it].lat,t.latLngs[it].lng),nt=L.supermap.plotting.editMarker(ot,{icon:this.options.editIcon,nHandle:t.enableEdit?-1:-3,tag:it});this._addToMapAndBindMarker(nt),n.push(nt),nt.owner=t}}else if(t.symbolType===SuperMap.Plot.SymbolType.NEWPIESYMBOL||t.symbolType===SuperMap.Plot.SymbolType.NEWCHORDSYMBOL||t.symbolType===SuperMap.Plot.SymbolType.NEWARCSYMBOL){for(var lt=0;lt<t.latLngs.length;lt++){var st={};if(2===lt){var at=t.components[0]._latlngs;st=at.length>1?new L.LatLng(at[1].lat,at[1].lng):new L.LatLng(at[0][1].lat,at[0][1].lng)}else st=new L.LatLng(t.latLngs[lt].lat,t.latLngs[lt].lng);var rt=L.supermap.plotting.editMarker(st,{icon:this.options.editIcon,nHandle:t.enableEdit?-1:-3,tag:lt});this._addToMapAndBindMarker(rt),n.push(rt),rt.owner=t}for(var ut=0;ut<t.scalePoints.length;ut++){var pt=new L.LatLng(t.scalePoints[ut].lat,t.scalePoints[ut].lng),ht=t.scalePoints[ut].tag?t.scalePoints[ut].tag:ut,ct=L.supermap.plotting.editMarker(pt,{icon:this.options.scaleIcon,nHandle:t.enableEdit?-2:-3,tag:ht});this._addToMapAndBindMarker(ct),n.push(ct),ct.owner=t}}else if(t.symbolType!==SuperMap.Plot.SymbolType.SATELLITE){if(123===t.libID&&21003===t.code&&t.superMapAlgoSymbol.controlPoints.length>2){var yt=t.components[0].getLatLngs()[t.components[0].getLatLngs().length-1];t.getLatLngs()[2].lat=yt.lat,t.getLatLngs()[2].lng=yt.lng}for(var gt=0;gt<t.latLngs.length;gt++){var ft=new L.LatLng(t.latLngs[gt].lat,t.latLngs[gt].lng),dt=L.supermap.plotting.editMarker(ft,{icon:this.options.editIcon,nHandle:t.enableEdit?-1:-3,tag:gt});this._addToMapAndBindMarker(dt),n.push(dt),dt.owner=t}if(1!=t.symbolType)for(var mt=0;mt<t.scalePoints.length;mt++){var St=new L.LatLng(t.scalePoints[mt].lat,t.scalePoints[mt].lng),Pt=t.scalePoints[mt].tag?t.scalePoints[mt].tag:mt,bt=L.supermap.plotting.editMarker(St,{icon:this.options.scaleIcon,nHandle:t.enableEdit?-2:-3,tag:Pt});this._addToMapAndBindMarker(bt),n.push(bt),bt.owner=t}}else if((t.symbolType===SuperMap.Plot.SymbolType.SATELLITE||t.timeWindows.length>1)&&t.scalePoints)for(var vt=0;vt<t.scalePoints.length;vt++){var Lt=new L.LatLng(t.scalePoints[vt].lat,t.scalePoints[vt].lng),Mt=t.scalePoints[vt].tag?t.scalePoints[vt].tag:vt,_t=L.supermap.plotting.editMarker(Lt,{icon:this.options.scaleIcon,nHandle:t.enableEdit?-2:-3,tag:Mt});this._addToMapAndBindMarker(_t),n.push(_t),_t.owner=t}this._editMarkers[t.uuid]=n,this._disEditBox[t.uuid]=o},_resetSignEditMarkerValue:function(t){if(Object.prototype.hasOwnProperty.call(this._editFrames,t.uuid))for(var e=0;e<this.selectedSignSymbols.length;e++)if(this.selectedSignSymbols[e].isSelected&&!this.selectedSignSymbols[e].getLocked()){var i=this._editFrames[this.selectedSignSymbols[e].uuid],o=t.getBounds();if(void 0==o||null==o)return;var n=L.latLng(o.getNorth(),o.getEast()),l=L.latLng(o.getNorth(),o.getWest()),s=L.latLng(o.getSouth(),o.getEast()),a=L.latLng(o.getSouth(),o.getWest()),r=null;null==t.associatedUuid&&(r=t.getPolyLine().getLatLngs()[0].clone());for(var u=[n,l,s,a,r],p=0;p<i.length;p++)null!=u[p]&&(i[p]._latlng=u[p],i[p].update())}},_resetEditMarkersValue:function(t){if(Object.prototype.hasOwnProperty.call(this._editMarkers,t.uuid)){var e=this._editMarkers[t.uuid],i=this._disEditBox[t.uuid];if(t.layer instanceof gy&&null!=t.graphic){for(var o=t.graphic._getHandleAndCenterPoints(),n=0;n<o.handlePoints.length;n++)e[n]._latlng=o.handlePoints[n],e[n].update();!0===t.locked&&(e[4]._latlng=o.centerPoints[0],e[4].update())}else if(null==i||!t.layer.getLocked()&&t.layer.getEditable())if(t.getLocked())for(var l=t._getHandlePointsByBounds(),s=0;s<l.length;s++)e[s]._latlng=l[s],e[s].update();else if(t instanceof vh||t instanceof My)if(t instanceof Oy&&this._editMode!==SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE)for(var a=0;a<t.scalePoints.length;a++)e[a]._latlng=t.scalePoints[a],e[a].update();else{for(var r=t._getHandleAndRotatePoints(),u=0;u<r.handlePoints.length;u++)e[u]._latlng=r.handlePoints[u],e[u].update();if(this._editMode===SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE)for(var p=r.handlePoints.length,h=0;h<r.rotatePoints.length;h++)e[p+parseInt(h)]._latlng=r.rotatePoints[h],e[p+parseInt(h)].update()}else if(this._editMode===SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE){for(var c=t._getHandleAndRotatePoints(),y=0;y<c.handlePoints.length;y++){if(e[y]._latlng=c.handlePoints[y],20==t.symbolType||21==t.symbolType||999==t.symbolType)(d=this._map.latLngToContainerPoint(e[y]._latlng)).x+=t.style.graphicXOffset,d.y+=t.style.graphicYOffset,e[y]._latlng=this._map.containerPointToLatLng(d);e[y].update()}for(var g=c.handlePoints.length,f=0;f<c.rotatePoints.length;f++){var d;if(e[g+parseInt(f)]._latlng=c.rotatePoints[f],20==t.symbolType||21==t.symbolType||999==t.symbolType)(d=this._map.latLngToContainerPoint(e[g+parseInt(f)]._latlng)).x+=t.style.graphicXOffset,d.y+=t.style.graphicYOffset,e[g+parseInt(f)]._latlng=this._map.containerPointToLatLng(d);e[g+parseInt(f)].update()}}else if(void 0!==t.scalePoints&&null!==t.scalePoints||(t.scalePoints=[]),t.symbolType===SuperMap.Plot.SymbolType.REGULARPOLYGON)for(var m=[t.getLatLngs()[0],t.components[0].getLatLngs()[0][0]],S=0;S<m.length;S++)e[S]._latlng=m[S],e[S].update();else if(t.symbolType===SuperMap.Plot.SymbolType.PARALLELLINE){var P=L.Util.superMapPointsToLatLngs(t.superMapAlgoSymbol.controlPoints[0]);t.getLatLngs()[0]=L.latLng(P[0].lat,P[0].lng);for(var b=0;b<t.getLatLngs().length;b++)e[b]._latlng=t.getLatLngs()[b],e[b].update()}else if(t.symbolType===SuperMap.Plot.SymbolType.SATELLITE||t.timeWindows&&t.timeWindows.length>1)for(var v=0;v<t.scalePoints.length;v++){var M=parseInt(v);e[M]._latlng=t.scalePoints[v],e[M].update()}else if(t.getLatLngs().length+t.scalePoints.length===e.length){for(var _=0;_<t.getLatLngs().length;_++)e[_]._latlng=t.getLatLngs()[_],e[_].update();var A=t.getLatLngs().length;for(v=0;v<t.scalePoints.length;v++){var T=A+parseInt(v);e[T]._latlng=t.scalePoints[v],e[T].update()}}else this._collectEditMarkers(t);else{var x=t.getBounds();if(null!==x&&x.isValid()){var O=L.latLng(x.getNorth(),x.getEast()),w=L.latLng(x.getNorth(),x.getWest()),C=L.latLng(x.getSouth(),x.getEast()),E=L.latLng(x.getSouth(),x.getWest());i.setLatLngs([O,w,E,C])}}}},_removeMarkers:function(t){var e=this._editMarkers[t.uuid];if(e)for(var i=0;i<e.length;i++)this._unbindMarkerEvents(e[i]),this._map.removeLayer(e[i]);delete this._editMarkers[t.uuid];var o=this._disEditBox[t.uuid];o&&this._map.removeLayer(o),delete this._disEditBox[t.uuid]},_unbindMarkerEvents:function(t){null!=t&&(t.off("mousemove",this._moveMove,this),t.off("mouseout",this._moveOut,this),-3!==t.options.nHandle&&(t.off("click",this._removePoint,this),t.off("dragstart",this._dragStart,this),t.off("drag",this._dragPoint,this),t.off("dragend",this._dragEnd,this),t.dragging.disable()))},_addToMapAndBindMarker:function(t){t.addTo(this._map),t.on("mousemove",this._moveMove,this),t.on("mouseout",this._moveOut,this),-3!==t.options.nHandle&&(t.on("click",this._removePoint,this),t.on("dragstart",this._dragStart,this),t.on("drag",this._dragPoint,this),t.on("dragend",this._dragEnd,this),t.dragging.enable()),-3===t.options.nHandle&&(t.on("dragstart",this._dragStart,this),t.on("dragend",this._dragEnd,this),t.dragging.enable())},_moveMove:function(t){switch(t.target.options.nHandle){case 1:case 8:t.target._icon.style.cursor="se-resize";break;case 3:case 6:t.target._icon.style.cursor="ne-resize";break;case 4:case 5:t.target._icon.style.cursor="e-resize";break;case 2:case 7:t.target._icon.style.cursor="n-resize";break;case-1:case-2:t.target._icon.style.cursor="pointer";break;case 0:t.target._icon.style.cursor="default"}},_moveOut:function(t){t.target._icon.style.cursor=""},_removePoint:function(t){if(this._editMode===SuperMap.Plot.EditMode.ADDCONTROLPOINT&&t.target.owner.isSelected){var e=L.Util.cloneLatLngs(t.target.owner.getLatLngs()),i=this._editMarkers[t.target.owner.uuid],o=i.indexOf(t.target);this._map.removeLayer(i[o]),i.splice(o,1),t.target.owner.latLngs.splice(o,1),t.target.owner.redraw();var n=new SuperMap.Plot.Transaction;L.supermap.plotting.getControl().getTransManager().add(n);var l=new SuperMap.Plot.TransactionInfo;l.layerId=t.target.owner.layer._leaflet_id,l.uuid=t.target.owner.layer.uuid,l.functionName="setLatLngs",l.undoParams=[e],l.redoParams=[L.Util.cloneLatLngs(t.target.owner.getLatLngs())],n.transInfos.push(l)}else if(this._editMode===SuperMap.Plot.EditMode.REMOVECONTROLPOINT&&t.target.owner.isSelected){var s=this._editMarkers[t.target.owner.uuid],a=s.indexOf(t.target),r=L.Util.cloneLatLngs(t.target.owner.getLatLngs());if(t.target.owner.getLatLngs().length<=t.target.owner.minEditPts)return this._editMode=SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE,void this._collectEditMarkers(t.target.owner);this._map.removeLayer(s[a]),s.splice(a,1),t.target.owner.latLngs.splice(a,1),t.target.owner.redraw();var u=new SuperMap.Plot.Transaction;L.supermap.plotting.getControl().getTransManager().add(u);var p=new SuperMap.Plot.TransactionInfo;p.layerId=t.target.owner.layer._leaflet_id,p.uuid=t.target.owner.uuid,p.functionName="setLatLngs",p.undoParams=[r],p.redoParams=[L.Util.cloneLatLngs(t.target.owner.getLatLngs())],u.transInfos.push(p)}},_dragStart:function(t){this.transaction||(this.transaction=new SuperMap.Plot.Transaction,this.transaction.transType=SuperMap.Plot.TransactionType.EDIT,this.isAddTransInfo=!0);for(var e=0;e<this.selectedFeatures.length;e++){var i=this.selectedFeatures[e];if(i._isDot()&&(this._dragStartScale[i.uuid]=i.getScale()),i.scaleValues&&i.scaleValues.length&&0!==i.scaleValues.length){this._dragStartScaleValues[i.uuid]=[];for(var o=0;o<i.scaleValues.length;o++)this._dragStartScaleValues[i.uuid].push(i.scaleValues[o])}else this._dragStartScaleValues[i.uuid]=[];if(i.scalePoints&&i.scalePoints.length&&0!==i.scalePoints.length&&(this._dragStartScalePoints[i.uuid]=L.Util.cloneLatLngs(i.scalePoints)),this._dragStartRotate[i.uuid]=i.getRotate(),this.selectedFeatures[e]instanceof vh?this._dragStartLatLngs[i.uuid]=this._editMarkers[this.selectedFeatures[e].uuid]:this._dragStartLatLngs[i.uuid]=L.Util.cloneLatLngs(i.getLatLngs()),i.symbolType===SuperMap.Plot.SymbolType.ARCREGION&&1===this._dragStartLatLngs[i.uuid].length&&this._dragStartLatLngs[i.uuid].push(i.scalePoints[0].clone()),i.symbolType===SuperMap.Plot.SymbolType.LINERELATION&&(null!==i.startAssociatedUuid?this._dragStartLatLngs[i.uuid].push(i.startAssociatedUuid):null!==i.endAssociatedUuid&&this._dragStartLatLngs[i.uuid].push(i.endAssociatedUuid)),this._dragStartBounds[i.uuid]=i.getBounds(),i.symbolType===SuperMap.Plot.SymbolType.FLAGGROUP)i.anchorPoint=L.latLng(i.getBounds().getSouth(),i.getBounds().getWest());else if(i.symbolType===SuperMap.Plot.SymbolType.TEXTSYMBOL)i.anchorPoint=L.latLng(i.getLatLngs()[0].lat,i.getLatLngs()[0].lng);else if(i.symbolType===SuperMap.Plot.SymbolType.CONCENTRICCIRCLE)i.anchorPoint=L.latLng(i.getLatLngs()[0].lat,i.getLatLngs()[0].lng);else if(i.symbolType!==SuperMap.Plot.SymbolType.DOTSYMBOL){var n=i.getBounds();n.isValid()&&(i.anchorPoint=n.getCenter())}for(var l=this._editMarkers[i.uuid],s=0;s<l.length;s++){var a=l[s];-3===a.options.nHandle&&a.setOpacity(0),a.setOpacity(0)}}this.transaction||(this.transaction=new SuperMap.Plot.Transaction,this.transaction.transType=SuperMap.Plot.TransactionType.EDIT,this.isAddTransInfo=!0),this.oldLatLng=t.target._latlng,this._lastPixel=this._map.latLngToLayerPoint(t.target._latlng)},_dragEnd:function(){for(var t=0;t<this.selectedFeatures.length;t++)this._collectEditMarkers(this.selectedFeatures[t]),this.selectedFeatures[t].graphic&&this.selectedFeatures[t].graphic.updateImage();this.fire(SuperMap.Plot.Event.featuresmodified,{features:this.selectedFeatures}),this._saveHistoryInfomation(),this.transaction&&0!==this.transaction.transInfos.length&&(L.supermap.plotting.getControl().getTransManager().add(this.transaction),this.transaction=new SuperMap.Plot.Transaction,this.isAddTransInfo=!0),this._dragDot=!0},_dragPoint:function(t){if(!1!==this.fire(SuperMap.Plot.Event.beforefeaturesmodified,{features:this.selectedFeatures})){var e=t.target.owner;if(-3===t.target.options.nHandle||this._avoidRegionControl)this._avoidRegionControl&&this._collectEditMarkers(e);else if(this._editMode===SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE&&0===t.target.options.nHandle){if(this._dragRotate(t),1===e.symbolType){this.rotateMarker&&this._map.removeLayer(this.rotateMarker);var i=this._map.latLngToContainerPoint(e.latLngs[0]);window.x=i.x-5,i.y=i.y+15;var o=L.point([i.x,i.y]),n=this._map.containerPointToLatLng(o),l=Math.round(this.rotateValue).toString()+"°",s=L.divIcon({html:l,className:"rotateIcon",iconSize:20});this.rotateMarker=L.marker([n.lat,n.lng],{icon:s}).addTo(this._map),this._map.on("mouseup",function(t){this.rotateMarker&&this._map.removeLayer(this.rotateMarker)}.bind(this));var a=document.getElementsByClassName("rotateIcon");a[0].style.fontSize="30px",a[0].style.color="black"}for(var r=0;r<this.selectedFeatures.length;r++)this.selectedFeatures[r].fire("latlngchanged",{feature:this.selectedFeatures[r]})}else this._editMode===SuperMap.Plot.EditMode.EDITCIRCUMRECTANGLE&&t.target.options.nHandle>0?this._dragResize(t,t.target.options.nHandle):this._dragLatLngs(t);this.fire(SuperMap.Plot.Event.featuresmodifing,{features:this.selectedFeatures})}},_dragRotate:function(t){var e=this;var i=t.target.owner,o=null;o=i.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL||i.symbolType===SuperMap.Plot.SymbolType.CONCENTRICCIRCLE||i.symbolType===SuperMap.Plot.SymbolType.PICTURE||i.symbolType===SuperMap.Plot.SymbolType.MODELPLOT||3e3===i.symbolType?i.getLatLngs()[0]:i.anchorPoint;var n=this._map.latLngToLayerPoint(o);i.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&!0===i.positionOffset&&(n.x+=i.positionOffsetX*i.dScale,n.y+=i.positionOffsetY*i.dScale);var l=this._map.latLngToLayerPoint(t.latlng),s=this._map.latLngToLayerPoint(t.oldLatLng),a=l.x-n.x-(s.x-n.x),r=l.y-n.y-(s.y-n.y);if(0!==a&&0!==r){var u=180*(Math.atan2(s.y-n.y,s.x-n.x)-Math.atan2(l.y-n.y,l.x-n.x))/Math.PI,p=u;if(void 0!==this._lastPixel)p=180*(Math.atan2(this._lastPixel.y-n.y,this._lastPixel.x-n.x)-Math.atan2(l.y-n.y,l.x-n.x))/Math.PI;this.rotateValue=function(t,i){for(var o=0;o<e.selectedFeatures.length;o++){var n=0;if(n=e.selectedFeatures[o].symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL||e.selectedFeatures[o].symbolType===SuperMap.Plot.SymbolType.PICTURE||e.selectedFeatures[o].symbolType===SuperMap.Plot.SymbolType.MODELPLOT||3e3===e.selectedFeatures[o].symbolType?t+e._dragStartRotate[e.selectedFeatures[o].uuid]:i,(n%=360)<0&&(n+=360),e.selectedFeatures[o].setRotate(n),e.isAddTransInfo){var l=new SuperMap.Plot.TransactionInfo;l.layerId=e.selectedFeatures[o].layer._leaflet_id,l.uuid=e.selectedFeatures[o].uuid,l.functionName="setRotate",e.transaction.transInfos.push(l)}}return e.isAddTransInfo=!1,n}(u,p)}this._lastPixel=l},_dragResize:function(t,e){var i=this;function o(t,o,l){for(var s=[],a=0;a<i.selectedFeatures.length;a++)if(!0!==i.selectedFeatures[a].getLocked())if(i.selectedFeatures[a]._isDot()){var r=i._dragStartScale[i.selectedFeatures[a].uuid];if(i.selectedFeatures[a].symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&!1===i.selectedFeatures[a].limitWidthHeight)r.x=0===r.x?.05:r.x,r.y=0===r.y?.05:r.y,i.selectedFeatures[a].setScale(t*r.x,o*r.y);else{var u=t*(r=!0===Boolean(r)?r:1);u>0&&i.selectedFeatures[a].setScale(u)}if(i.isAddTransInfo){var p=new SuperMap.Plot.TransactionInfo;p.layerId=i.selectedFeatures[a].layer._leaflet_id,p.uuid=i.selectedFeatures[a].uuid,p.functionName="setScale",i.transaction.transInfos.push(p)}}else{if(9===i.selectedFeatures[a]._getHandleCount()&&e&&e>0){var h=i._dragStartBounds[i.selectedFeatures[a].uuid],c=i._dragStartLatLngs[i.selectedFeatures[a].uuid],y=i.selectedFeatures[a]._getLatLng(e,h,l);i.selectedFeatures[a]._resizeLatLngs(y,e,h,c)}if(SuperMap.Plot.AlgoSymbolFactory.isAccessServer(i.selectedFeatures[a].libID,i.selectedFeatures[a].code)){var g=new SuperMap.GetSymbolInfoParameters;g.libID=i.selectedFeatures[a].libID,g.code=i.selectedFeatures[a].code,g.inputPoints=L.Util.latLngsToSuperMapPoints(i.selectedFeatures[a].getLatLngs()),g.scaleValues=i.selectedFeatures[a].scaleValues,g.subSymbols=i.selectedFeatures[a].subSymbols,s.push(i.selectedFeatures[a]),L.supermap.symbolInfoService(n.serverUrl,n.serviceParams).getSymbolInfo(g,function(t){for(var e=0;e<s.length;e++)s[e].libID===t.result.libID&&s[e].code===t.result.code&&(s[e].symbolData.innerCells=t.result.innerCells,s[e].symbolData.scalePoints=t.result.scalePoints,s[e].symbolData.scaleValues=t.result.scaleValues,s[e].redraw(),s[e]._updateSymbolTexts(),s.splice(0,1))},this)}else if(i.selectedFeatures[a].redraw(),i.selectedFeatures[a]._updateSymbolTexts(),i.selectedFeatures[a].symbolType===SuperMap.Plot.SymbolType.ANNOFRAMESYMBOL&&i.selectedFeatures[a].ownerGroup&&(i.selectedFeatures[a].ownerGroup.symbolType===SuperMap.Plot.SymbolType.NAVYDEPLOYMENT||i.selectedFeatures[a].ownerGroup.symbolType===SuperMap.Plot.SymbolType.AIRDEPLOYMENT))for(var f in i.selectedFeatures[a].ownerGroup.subObjects)i.selectedFeatures[a].ownerGroup.subObjects[f].redraw();if(i.isAddTransInfo){var d=new SuperMap.Plot.TransactionInfo;d.layerId=i.selectedFeatures[a].layer._leaflet_id,d.uuid=i.selectedFeatures[a].uuid,d.functionName="setLatLngs",i.transaction.transInfos.push(d)}}}var n=t.target.owner,l=this._dragStartBounds[n.uuid],s=l.getEast()-l.getWest(),a=l.getNorth()-l.getSouth(),r=n._resizeOffset(t.latlng,e,l);!0===t.originalEvent.altKey&&(0===r.lng&&0!==r.lat?r.lng=r.lat*s/a:0===r.lat&&0!==r.lng?r.lat=r.lng*a/s:Math.abs(r.lng)<Math.abs(r.lat)?r.lng<0&&r.lat>0||r.lng>0&&r.lat<0?r.lng=r.lat*s/a*-1:r.lng=r.lat*s/a:r.lat<0&&r.lng>0||r.lat>0&&r.lng<0?r.lat=r.lng*a/s*-1:r.lat=r.lng*a/s);var u=1,p=n._resizeBounds(t.latlng,e,l),h=!0===Boolean(s)?(p.getEast()-p.getWest())/s:.5,c=!0===Boolean(a)?(p.getNorth()-p.getSouth())/a:.5;u=2===e||7===e?c:4===e||5===e?h:h<c?h:c,n.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&!1===n.limitWidthHeight?o(h,c,r):o(u,null,r),this.oldLatLng=t.latlng},_dragLatLngs:function(t){var e=t.target.owner,i=this._editMarkers[e.uuid],o=SuperMap.Util.indexOf(i,t.target),n=!1;if(e.symbolAnnotation&&e.symbolAnnotation instanceof Ui){var l=this._map.latLngToLayerPoint(e.symbolAnnotation._positionPoint),s=this._map.latLngToLayerPoint(t.latlng),a=this._map.getZoom();e.symbolAnnotation.offsetX=(s.x-l.x)/a,e.symbolAnnotation.offsetY=(s.y-l.y)/a;var r=this._map.getFeatureByUuid(e.symbolAnnotation._parentUuid);r&&r.redraw()}else{if(-2===t.target.options.nHandle&&(n=!0),this.transaction||(this.transaction=new SuperMap.Plot.Transaction,this.transaction.transType=SuperMap.Plot.TransactionType.EDIT,this.isAddTransInfo=!0),SuperMap.Plot.AlgoSymbolFactory.isAccessServer(e.libID,e.code)){var u=(new Date).getTime(),p=this._map.latLngToLayerPoint(t.latlng);if(n&&void 0!==this._lastDragPixel&&null!==this._lastDragPixel&&!((Math.abs(p.x-this._lastDragPixel.x)>3||Math.abs(p.y-this._lastDragPixel.y)>3)&&u-this.lastDownTime>100))return;var h=new SuperMap.GetSymbolInfoParameters;h.libID=e.libID,h.code=e.code,n?(h.inputPoints=L.Util.latLngsToSuperMapPoints(e.getLatLngs()),h.scalePoints=L.Util.latLngsToSuperMapPoints(e.scalePoints),h.scaleValues=e.scaleValues,h.newScalePoint=new SuperMap.Geometry.Point(t.latlng.lng,t.latlng.lat),h.newScalePointIndex=parseInt(t.target.options.tag)):(e.getLatLngs()[o]=t.target.getLatLng(),h.inputPoints=L.Util.latLngsToSuperMapPoints(e.getLatLngs()),h.scaleValues=e.scaleValues),h.subSymbols=e.subSymbols,L.supermap.symbolInfoService(e.serverUrl,e.serviceParams).getSymbolInfo(h,function(t){e.symbolData.innerCells=t.result.innerCells,e.symbolData.scalePoints=t.result.scalePoints,e.symbolData.scaleValues=t.result.scaleValues,e.redraw(),e._updateSymbolTexts(),this._resetEditMarkersValue(e)},this),this._lastDragPixel=p,this.lastDownTime=(new Date).getTime()}else if(-1===t.target.options.nHandle){if(e.symbolType===SuperMap.Plot.SymbolType.REGULARPOLYGON)1===o?e.getLatLngs()[e.getLatLngs().length-1]=t.latlng:e.getLatLngs()[0]=t.latlng;else if(e.symbolType===SuperMap.Plot.SymbolType.ELLIPSESYMBOL)e.getLatLngs()[o]=t.latlng;else if(e.symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL){if(!0===e.positionOffset?e.setLatLngs(t.latlng):e.setLatLngs(e.latLngs[0]),this.isAddTransInfo){var c=new SuperMap.Plot.TransactionInfo;c.layerId=e.layer._leaflet_id,c.uuid=e.uuid,c.functionName="setLatLngs",this.transaction.transInfos.push(c)}}else e.getLatLngs()[o]=t.latlng;if(e.symbolType===SuperMap.Plot.SymbolType.LINERELATION||e.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT||e.symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT1||e.symbolType===SuperMap.Plot.SymbolType.ELLIPSESYMBOL)e._modifyPoint(parseInt(t.target.options.tag),t.latlng);else if(e.redraw(),e.symbolType===SuperMap.Plot.SymbolType.ANNOFRAMESYMBOL&&e.ownerGroup&&(e.ownerGroup.symbolType===SuperMap.Plot.SymbolType.NAVYDEPLOYMENT||e.ownerGroup.symbolType===SuperMap.Plot.SymbolType.AIRDEPLOYMENT))for(var y in e.ownerGroup.subObjects)e.ownerGroup.subObjects[y].redraw();e._updateSymbolTexts(),this._resetEditMarkersValue(e)}else if(-2===t.target.options.nHandle){var g=t.target.getLatLng();if(g.isScalePoint=!0,e._modifyPoint(parseInt(t.target.options.tag),g),e.symbolType===SuperMap.Plot.SymbolType.FLAGGROUP)for(var f=0,d=e.components.length;f<d;f++)e.components[f]._updateSymbolTexts();else e._updateSymbolTexts();this._resetEditMarkersValue(e)}if(this.isAddTransInfo){var m=new SuperMap.Plot.TransactionInfo;if(m.layerId=e.layer._leaflet_id,m.uuid=e.uuid,m.functionName="setLatLngs",-2===t.target.options.nHandle&&(m.functionName="setScaleValues",e.symbolType!==SuperMap.Plot.SymbolType.ARCREGION&&e.symbolType!==SuperMap.Plot.SymbolType.FLAGGROUP||(m.functionName="modifyPoint",m.undoParams=[parseInt(t.target.options.tag)],m.redoParams=[parseInt(t.target.options.tag)])),this.transaction.transInfos.push(m),-2!==t.target.options.nHandle&&0===e.libID&&590===e.code||100===e.libID&&(17703===e.code||17704===e.code)){var S=new SuperMap.Plot.TransactionInfo;S.layerId=e.layer._leaflet_id,S.uuid=e.uuid,S.functionName="setScaleValues"}}this.isAddTransInfo=!1}},_pasteToPosition:function(){if(this.pasteGeoAry&&0!==this.pasteGeoAry.length){var t=new SuperMap.Plot.Transaction;t.transType=SuperMap.Plot.TransactionType.CREATE,L.supermap.plotting.getControl().getTransManager().add(t);var e=function(t,e,i,o){var n=new SuperMap.Plot.TransactionInfo;n.layerId=t,n.uuid=e,n.feature=i,o.transInfos.push(n)},i=null,o=null,n=this.pasteGeoAry.slice(),l=null;if(0!==arguments.length){for(var s=new L.LatLngBounds,a=0,r=n.length;a<r;a++)if((l=n[a])instanceof vh)for(var u=0;u<l.subObjects.length;u++){var p=l.subObjects[u];s.extend(p._bounds)}else l instanceof bh&&s.extend(l._bounds);i=1===l.getLatLngs().length?l.getLatLngs()[0]:s.getCenter()}0!==this.getSelectedFeatures().length&&this.unselectFeatures();for(var h=this._map.getPlottingLayers(),c=0;c<n.length;c++)if(n[c]instanceof bh&&(o=n[c].clone()),0!==arguments.length&&null!==i){for(var y=0,g=h.length;y<g;y++)if(h[y].getEditable()&&!h[y].getLocked()){h[y].addFeatures(o);break}if(!(o instanceof _y))if(arguments[0]instanceof Array)for(var f=0;f<arguments[0].length;f++)1020===l.symbolData.symbolType?o.move(arguments[0][f].lat-l.components[f].symbolData.localePoints[0].y,arguments[0][f].lng-l.components[f].symbolData.localePoints[0].x):o.move(arguments[0][f].lat-l.symbolData.localePoints[f].y,arguments[0][f].lng-l.symbolData.localePoints[f].x);else o.move(arguments[0].lat-i.lat,arguments[0].lng-i.lng);if(this.selectFeatures(o),e(o.layer._leaflet_id,o.uuid,o,t),n[c]&&n[c].geoSymbolTexts)for(var d=0;d<n[c].geoSymbolTexts.length;d++){var m=n[c].geoSymbolTexts[d].getSymbolData();m.associatedUuid=o.uuid;for(var S=0;S<n.length;S++)if(n[S].symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT||n[S].symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT1){var P=n[c].layer.createSymbol(m.libID,m.code,null,{symbolData:m});this.selectFeatures(P),n.splice(S,1),e(P.layer._leaflet_id,P.uuid,P,t);break}}if(n[c]&&n[c].deployments)for(var b=0;b<n[c].deployments.length;b++){var v=n[c].deployments[b].getSymbolData();v.associatedUuid=o.uuid;for(var M=0;M<n.length;M++)if(n[M].symbolType===SuperMap.Plot.SymbolType.NAVYDEPLOYMENT||n[M].symbolType===SuperMap.Plot.SymbolType.AIRDEPLOYMENT){var _=n[c].layer.createSymbol(v.libID,v.code,null,{symbolData:v});this.selectFeatures(_),n.splice(M,1),e(_.layer._leaflet_id,_.uuid,_,t);break}}if(n[c]&&n[c].timeWindows)for(var A=0;A<n[c].timeWindows.length;A++){var T=n[c].timeWindows[A].getSymbolData();T.associatedUuid=o.uuid;for(var x=0;x<n.length;x++)if(n[x].symbolType===SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS){var O=n[c].layer.createSymbol(T.libID,T.code,null,{symbolData:T});this.selectFeatures(O),n.splice(x,1),e(O.layer._leaflet_id,O.uuid,O,t);break}}}else for(var w=0,C=h.length;w<C;w++)if(h[w].getEditable()&&!h[w].getLocked()){if(h[w].addFeatures(o),1012!==o.code&&this.selectFeatures(o),e(o.layer._leaflet_id,o.uuid,o,t),n[c]&&n[c].geoSymbolTexts)for(var E=0;E<n[c].geoSymbolTexts.length;E++){var I=n[c].geoSymbolTexts[E].getSymbolData();I.associatedUuid=o.uuid;for(var D=0;D<n.length;D++)if(n[D].symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT||n[D].symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT1){var U=n[c].layer.createSymbol(I.libID,I.code,null,{symbolData:I});this.selectFeatures(U),n.splice(D,1),e(U.layer._leaflet_id,U.uuid,U,t);break}}if(n[c]&&n[c].deployments)for(var R=0;R<n[c].deployments.length;R++){var N=n[c].deployments[R].getSymbolData();N.associatedUuid=o.uuid;for(var B=0;B<n.length;B++)if(n[B].symbolType===SuperMap.Plot.SymbolType.NAVYDEPLOYMENT||n[B].symbolType===SuperMap.Plot.SymbolType.AIRDEPLOYMENT){var k=n[c].layer.createSymbol(N.libID,N.code,null,{symbolData:N});this.selectFeatures(k),n.splice(B,1),e(k.layer._leaflet_id,k.uuid,k,t);break}}if(n[c]&&n[c].timeWindows)for(var F=0;F<n[c].timeWindows.length;F++){if(!Object.prototype.hasOwnProperty.call(n[c].timeWindows[F],"symbolType"))return;var j=n[c].timeWindows[F].getSymbolData();j.associatedUuid=o.uuid;for(var V=0;V<n.length;V++)if(n[V].symbolType===SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS){var z=n[c].layer.createSymbol(j.libID,j.code,null,{symbolData:j});this.selectFeatures(z),n.splice(V,1),e(z.layer._leaflet_id,z.uuid,z,t);break}}break}}},pasteToPositionAndLayer:function(t,e){var i=!0;e&&e instanceof Iy&&(i=!1);var o=!1;null!==t&&void 0!==t||(o=!0);var n=null,l=this.pasteGeoAry.slice();if(!o){for(var s=new L.LatLngBounds,a=0;a<l.length;a++){var r=l[a];r instanceof _y&&s.extend(r._bounds),s.extend(r._bounds)}n=s.getCenter()}for(var u=0;u<this.selectedFeatures.length;u++){var p=this.selectedFeatures[u];this.unselectFeatures(p)}this.selectedFeatures=[];for(var h=0;h<l.length;h++){var c=l[h];if(!0!==c.layer.isLocked&&!1!==c.layer.isEditable){var y=null;if(y=c instanceof _y?c.route.clone():c.clone(),i?c.layer.addFeatures(y):e.addFeatures(y),o||null===n||y instanceof _y||y.move(t.lat-n.lat,t.lng-n.lng),void 0!==this.pasteGeoSel&&this.pasteGeoSel.length>h&&!0===this.pasteGeoSel[h])if(c instanceof _y){var g=y._getNodeFeature(y._getNodeByUuid(c.routeNode.id));this.selectedFeatures(g)}else this.selectFeatures(y);if(l[h]&&l[h].geoSymbolTexts)for(var f=0;f<l[h].geoSymbolTexts.length;f++){var d=l[h].geoSymbolTexts[f].getSymbolData();d.associatedUuid=y.uuid;for(var m=0;m<l.length;m++)if(l[a].symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT||l[a].symbolType===SuperMap.Plot.SymbolType.SYMBOLTEXT1){var S=l[m].layer.createSymbol(d.libID,d.code,null,{symbolData:d});this.selectFeatures(S),l.splice(a,1);break}}if(l[h]&&l[h].deployments)for(var P=0;P<l[h].deployments.length;P++){var b=l[h].deployments[P].getSymbolData();b.associatedUuid=y.uuid;for(var v=0;v<l.length;v++)if(l[a].symbolType===SuperMap.Plot.SymbolType.NAVYDEPLOYMENT||l[a].symbolType===SuperMap.Plot.SymbolType.AIRDEPLOYMENT){var M=l[v].layer.createSymbol(b.libID,b.code,null,{symbolData:b});this.selectFeatures(M),l.splice(a,1);break}}if(l[h]&&l[h].timeWindows)for(var _=0;_<l[h].timeWindows.length;_++){var A=l[h].timeWindows[_].getSymbolData();A.associatedUuid=y.uuid;for(var T=0;T<l.length;T++)if(l[T].symbolType===SuperMap.Plot.SymbolType.SATELLITETIMEWINDOWS){var x=l[h].layer.createSymbol(A.libID,A.code,null,{symbolData:A});this.selectFeatures(x),l.splice(T,1);break}}}}},selectSignSymbol:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];SuperMap.Util.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++)if(null!==t[i]._map&&t[i].enableEdit&&!1===t[i].isSelected&&t[i].enableSelected&&(t[i].isSelected=!0,this.selectedSignSymbols.push(t[i]),this._collectedSignFrame(t[i]),!t[i].layer.isLocked&&t[i].layer.isEditable&&!t[i].getLocked()&&(t[i].dragging.enable(),t[i].on("dragstart",this._onSignSymbolDragStart,this).on("drag",this._onSignSymbolDrag,this).on("dragend",this._onSignSymbolDragEnd,this).on("reseteditmarkersvalues",this._onSignSymbolResetEditMarkersValues,this),null==t[i].associatedUuid)))for(var o=this._editFrames[t[i].uuid],n=0;n<markers.length;n++)-1==o[n].options.nHandle&&(o[n].dragging.enable(),o[n].on("dragstart",this._onSignSymbolDragStart,this).on("drag",this._dragSignMark,this).on("dragend",this._onSignSymbolDragEnd,this));1==e&&this.fire(SuperMap.Plot.Event.signsymbolselected,{signSymbols:t})},unselectSignSymbol:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];void 0===t&&(t=this.selectedSignSymbols.slice()),SuperMap.Util.isArray(t)||(t=[t]);for(var i=t.slice(),o=0;o<i.length;o++){var n=L.Util.indexOf(this.selectedSignSymbols,i[o]);if(-1!==n){if(this._removeSignFrame(i[o]),i[o].isSelected){if(null==i[o].associatedUuid)for(var l=this._editFrames[i[o].uuid],s=0;s<markers.length;s++)-1==l[s].options.nHandle&&(l[s].off("dragstart",this._onSignSymbolDragStart,this).off("drag",this._dragSignMark,this).off("dragend",this._onSignSymbolDragEnd,this),null!=l[s].dragging&&l[s].dragging.disable());i[o].off("dragstart",this._onSignSymbolDragStart,this).off("drag",this._onSignSymbolDrag,this).off("dragend",this._onSignSymbolDragEnd,this).off("reseteditmarkersvalues",this._onSignSymbolResetEditMarkersValues,this)}i[o].isSelected=!1,null!=i[o].dragging&&i[o].dragging.disable(),this.selectedSignSymbols.splice(n,1)}else i.slice(o,1)}!0===e&&this.fire(SuperMap.Plot.Event.signsymbolunselected,{signSymbols:t})},_collectedSignFrame:function(t){void 0!==this._editFrames[t.uuid]&&this._removeMarkers(t);var e=[];if(t.layer instanceof Ty&&(t.layer.getLocked()||t.layer.getEditable())){var i=t.getBounds();if(null!==i&&i.isValid()){var o,n,l=L.latLng(i.getNorth(),i.getEast()),s=L.latLng(i.getNorth(),i.getWest()),a=L.latLng(i.getSouth(),i.getEast()),r=L.latLng(i.getSouth(),i.getWest()),u=L.supermap.plotting.editMarker(l,{icon:this.options.rightTopIcon,nHandle:-3}),p=L.supermap.plotting.editMarker(s,{icon:this.options.leftTopIcon,nHandle:-3}),h=L.supermap.plotting.editMarker(a,{icon:this.options.rightBottomIcon,nHandle:-3}),c=L.supermap.plotting.editMarker(r,{icon:this.options.leftBottomIcon,nHandle:-3});null==t.associatedUuid&&t.getPolyLine()&&(o=t.getPolyLine().getLatLngs()[0].clone(),n=L.supermap.plotting.editMarker(o,{icon:this.options.editIcon,nHandle:-1})),e.push(u),e.push(p),e.push(h),e.push(c),n&&e.push(n);for(var y=0;y<e.length;y++)e[y].addTo(this._map)}}this._editFrames[t.uuid]=e},_removeSignFrame:function(t){for(var e=this._editFrames[t.uuid],i=0;i<e.length;i++)this._map.removeLayer(e[i]);delete this._editFrames[t.uuid]},_onSignSymbolDragStart:function(){for(var t=0;t<this.selectedSignSymbols.length;t++)if(this.selectedSignSymbols[t].isSelected&&!this.selectedSignSymbols[t].getLocked())for(var e=this._editFrames[this.selectedSignSymbols[t].uuid],i=0;i<e.length;i++)e[i].setOpacity(0)},_onSignSymbolDrag:function(t){for(var e=0;e<this.selectedSignSymbols.length;e++)this.selectedSignSymbols[e].isSelected&&!this.selectedSignSymbols[e].getLocked()&&this.selectedSignSymbols[e]._move(t.dLat,t.dLng,1);this.fire(SuperMap.Plot.Event.signsymboldrag,{signSymbols:this.selectedSignSymbols})},_onSignSymbolDragEnd:function(){for(var t=0;t<this.selectedSignSymbols.length;t++)this.selectedSignSymbols[t].isSelected&&!this.selectedSignSymbols[t].getLocked()&&this._collectedSignFrame(this.selectedSignSymbols[t])},_dragSignMark:function(t){for(var e=0;e<this.selectedSignSymbols.length;e++)if(this.selectedSignSymbols[e].isSelected&&!this.selectedSignSymbols[e].getLocked()){var i=this.selectedSignSymbols[e].getPolyLine(),o=i.getLatLngs(),n=L.latLng(t.latlng.lat,t.latlng.lng);o[0]=n,i.setLatLngs(o);var l=this._map.latLngToContainerPoint(o[0]),s=this._map.latLngToContainerPoint(o[1]);this.selectedSignSymbols[e].symbolText.offsetX=Math.round(s.x-l.x),this.selectedSignSymbols[e].symbolText.offsetY=Math.round(s.y-l.y),this.selectedSignSymbols[e].latLngs=n.clone(),this.selectedSignSymbols[e]._calculatePositionByPoint(this.selectedSignSymbols[e].latLngs)}this.fire(SuperMap.Plot.Event.signsymboldrag,{signSymbols:this.selectedSignSymbols})},equalLarge:function(t){for(var e=[],i=0;i<this.getSelectedFeatures().length;i++)this.getSelectedFeatures()[i].symbolType===SuperMap.Plot.SymbolType.DOTSYMBOL&&e.push(this.getSelectedFeatures()[i]);if(!(e.length<2)){var o=new SuperMap.Plot.Transaction;L.supermap.plotting.getControl().getTransManager().add(o);var n=function(t,e,i,o,n){var l=new SuperMap.Plot.TransactionInfo;l.layerId=t,l.uuid=e,l.functionName="setSymbolSize",l.undoParams=i,l.redoParams=o,n.transInfos.push(l)};if(t===SuperMap.Plot.EqualLargeType.WIDTH)for(var l=e[e.length-1].symbolSize.w,s=0;s<e.length-1;s++){var a=e[s].symbolSize.w;e[s].setSymbolSize(l,e[s].symbolSize.h),n(e[s].layer._leaflet_id,e[s].uuid,[a,e[s].symbolSize.h],[l,e[s].symbolSize.h],o)}else if(t===SuperMap.Plot.EqualLargeType.HEIGHT)for(var r=e[e.length-1].symbolSize.h,u=0;u<e.length-1;u++){var p=e[u].symbolSize.h;e[u].setSymbolSize(e[u].symbolSize.w,r),n(e[u].layer._leaflet_id,e[u].uuid,[e[u].symbolSize.w,p],[e[u].symbolSize.w,r],o)}else if(t===SuperMap.Plot.EqualLargeType.SAME)for(var h=e[e.length-1].symbolSize.w,c=e[e.length-1].symbolSize.h,y=0;y<e.length-1;y++){var g=e[y].symbolSize.w,f=e[y].symbolSize.h;e[y].setSymbolSize(h,c),n(e[y].layer._leaflet_id,e[y].uuid,[g,f],[h,c],o)}}},uniformDistribution:function(t){if(!(this.getSelectedFeatures().length<3)){var e=new SuperMap.Plot.Transaction;L.supermap.plotting.getControl().getTransManager().add(e);for(var i=function(t,e,i,o,n){var l=new SuperMap.Plot.TransactionInfo;l.layerId=t,l.uuid=e,l.functionName="move",l.undoParams=i,l.redoParams=o,n.transInfos.push(l)},o=[],n=0;n<this.getSelectedFeatures().length;n++){var l=this.getSelectedFeatures()[n].getBounds();o.push(new SuperMap.Geometry.Point(l.getCenter().lng,l.getCenter().lat))}var s=this.getSelectedFeatures().slice();if(t===SuperMap.Plot.UniformDistributionType.LEVEL){for(var a=0;a<o.length;a++)for(var r=0;r<o.length-1-a;r++)if(o[r].x>o[r+1].x){var u=o[r+1];o[r+1]=o[r],o[r]=u;var p=s[r+1];s[r+1]=s[r],s[r]=p}for(var h=Math.abs(o[o.length-1].x-o[0].x)/(o.length-1),c=1;c<o.length-1;c++){var y=o[o.length-1].x-h*c-o[c].x;s[c].move(0,y),this._resetEditMarkersValue(s[c]),i(s[c].layer._leaflet_id,s[c].uuid,[0,-y],[0,y],e)}}else if(t===SuperMap.Plot.UniformDistributionType.VERTICAL){for(var g=0;g<o.length;g++)for(var f=0;f<o.length-1-g;f++)if(o[f].y>o[f+1].y){var d=o[f+1];o[f+1]=o[f],o[f]=d;var m=s[f+1];s[f+1]=s[f],s[f]=m}for(var S=Math.abs(o[o.length-1].y-o[0].y)/(o.length-1),P=1;P<o.length-1;P++){var b=o[o.length-1].y-S*P-o[P].y;s[P].move(b,0),this._resetEditMarkersValue(s[P]),i(s[P].layer._leaflet_id,s[P].uuid,[-b,0],[b,0],e)}}}}});L.Map.include({_getPlotEditControl:function(){return void 0!=this._plotEditControl?this._plotEditControl:null}});var pf=function(t){return new uf(t)};L.supermap.plotting.editControl=pf,L.supermap.plotting.EditControl=uf;var hf=L.supermap.ServiceBase.extend({initialize:function(t,e){var i=SuperMap.MGISCredential.normalizedUrl(t);L.supermap.ServiceBase.prototype.initialize.call(this,i,e)},getSMLInfos:function(t,e,i){var o=this;return i||(i=o),new bt(o.url,{proxy:o.options.proxy,withCredentials:o.options.withCredentials,crossOrigin:o.options.crossOrigin,headers:o.options.headers,serverType:o.options.serverType,eventListeners:{scope:i,processCompleted:e,processFailed:e}}).processAsync(t),o},editSMLFile:function(t,e,i){var o=this;return i||(i=o),new V(o.url,{proxy:o.options.proxy,withCredentials:o.options.withCredentials,crossOrigin:o.options.crossOrigin,headers:o.options.headers,serverType:o.options.serverType,eventListeners:{scope:i,processCompleted:e,processFailed:e}}).processAsync(t),o}}),cf=function(t,e){return new hf(t,e)};L.supermap.smlFileService=cf,L.supermap.SmlFileService=hf;var yf=L.supermap.ServiceBase.extend({initialize:function(t,e){var i=SuperMap.MGISCredential.normalizedUrl(t);L.supermap.ServiceBase.prototype.initialize.call(this,i,e)},getSymbolInfo:function(t,e,i){var o=this;return i||(i=o),new It(o.url,{proxy:o.options.proxy,withCredentials:o.options.withCredentials,crossOrigin:o.options.crossOrigin,headers:o.options.headers,serverType:o.options.serverType,eventListeners:{scope:i,processCompleted:e,processFailed:e}}).processAsync(t),o}}),gf=function(t,e){return new yf(t,e)};L.supermap.symbolInfoService=gf,L.supermap.SymbolInfoService=yf;var ff=L.supermap.ServiceBase.extend({initialize:function(t,e){var i=SuperMap.MGISCredential.normalizedUrl(t);L.supermap.ServiceBase.prototype.initialize.call(this,i,e)},getLibIDs:function(t,e){var i=this;return e||(e=i),new J(i.url,{proxy:i.options.proxy,withCredentials:i.options.withCredentials,crossOrigin:i.options.crossOrigin,headers:i.options.headers,serverType:i.options.serverType,eventListeners:{scope:e,processCompleted:t,processFailed:t}}).processAsync(),i},getLibInfo:function(t,e,i){var o=this;return i||(i=o),new rt(o.url,{proxy:o.options.proxy,withCredentials:o.options.withCredentials,crossOrigin:o.options.crossOrigin,headers:o.options.headers,serverType:o.options.serverType,eventListeners:{scope:i,processCompleted:e,processFailed:e}}).processAsync(t),o}});L.supermap.symbolLibService=function(t,e){return new ff(t,e)},L.supermap.SymbolLibService=ff}(),o}()});